//     Underscore.js 1.7.0
//     http://underscorejs.org
//     (c) 2009-2014 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
//     Underscore may be freely distributed under the MIT license.

/*! Dust - Asynchronous Templating - v2.5.1
* http://linkedin.github.io/dustjs/
* Copyright (c) 2014 Aleksander Williams; Released under the MIT License */

/*! dustjs-helpers - v1.5.0
* https://github.com/linkedin/dustjs-helpers
* Copyright (c) 2014 Aleksander Williams; Released under the MIT License */

/*! Sortable 1.1.1 - MIT | git://github.com/rubaxa/Sortable.git */

/*!
 * version=#version
 */

(function(){var e=this,t=e._,n=Array.prototype,r=Object.prototype,i=Function.prototype,s=n.push,o=n.slice,u=n.concat,a=r.toString,f=r.hasOwnProperty,l=Array.isArray,c=Object.keys,h=i.bind,p=function(e){return e instanceof p?e:this instanceof p?void (this._wrapped=e):new p(e)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=p),exports._=p):e._=p,p.VERSION="1.7.0";var d=function(e,t,n){if(t===void 0)return e;switch(null==n?3:n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)};case 4:return function(n,r,i,s){return e.call(t,n,r,i,s)}}return function(){return e.apply(t,arguments)}};p.iteratee=function(e,t,n){return null==e?p.identity:p.isFunction(e)?d(e,t,n):p.isObject(e)?p.matches(e):p.property(e)},p.each=p.forEach=function(e,t,n){if(null==e)return e;t=d(t,n);var r,i=e.length;if(i===+i)for(r=0;i>r;r++)t(e[r],r,e);else{var s=p.keys(e);for(r=0,i=s.length;i>r;r++)t(e[s[r]],s[r],e)}return e},p.map=p.collect=function(e,t,n){if(null==e)return[];t=p.iteratee(t,n);for(var r,i=e.length!==+e.length&&p.keys(e),s=(i||e).length,o=Array(s),u=0;s>u;u++)r=i?i[u]:u,o[u]=t(e[r],r,e);return o};var v="Reduce of empty array with no initial value";p.reduce=p.foldl=p.inject=function(e,t,n,r){null==e&&(e=[]),t=d(t,r,4);var i,s=e.length!==+e.length&&p.keys(e),o=(s||e).length,u=0;if(arguments.length<3){if(!o)throw new TypeError(v);n=e[s?s[u++]:u++]}for(;o>u;u++)i=s?s[u]:u,n=t(n,e[i],i,e);return n},p.reduceRight=p.foldr=function(e,t,n,r){null==e&&(e=[]),t=d(t,r,4);var i,s=e.length!==+e.length&&p.keys(e),o=(s||e).length;if(arguments.length<3){if(!o)throw new TypeError(v);n=e[s?s[--o]:--o]}for(;o--;)i=s?s[o]:o,n=t(n,e[i],i,e);return n},p.find=p.detect=function(e,t,n){var r;return t=p.iteratee(t,n),p.some(e,function(e,n,i){return t(e,n,i)?(r=e,!0):void 0}),r},p.filter=p.select=function(e,t,n){var r=[];return null==e?r:(t=p.iteratee(t,n),p.each(e,function(e,n,i){t(e,n,i)&&r.push(e)}),r)},p.reject=function(e,t,n){return p.filter(e,p.negate(p.iteratee(t)),n)},p.every=p.all=function(e,t,n){if(null==e)return!0;t=p.iteratee(t,n);var r,i,s=e.length!==+e.length&&p.keys(e),o=(s||e).length;for(r=0;o>r;r++)if(i=s?s[r]:r,!t(e[i],i,e))return!1;return!0},p.some=p.any=function(e,t,n){if(null==e)return!1;t=p.iteratee(t,n);var r,i,s=e.length!==+e.length&&p.keys(e),o=(s||e).length;for(r=0;o>r;r++)if(i=s?s[r]:r,t(e[i],i,e))return!0;return!1},p.contains=p.include=function(e,t){return null==e?!1:(e.length!==+e.length&&(e=p.values(e)),p.indexOf(e,t)>=0)},p.invoke=function(e,t){var n=o.call(arguments,2),r=p.isFunction(t);return p.map(e,function(e){return(r?t:e[t]).apply(e,n)})},p.pluck=function(e,t){return p.map(e,p.property(t))},p.where=function(e,t){return p.filter(e,p.matches(t))},p.findWhere=function(e,t){return p.find(e,p.matches(t))},p.max=function(e,t,n){var r,i,s=-1/0,o=-1/0;if(null==t&&null!=e){e=e.length===+e.length?e:p.values(e);for(var u=0,a=e.length;a>u;u++)r=e[u],r>s&&(s=r)}else t=p.iteratee(t,n),p.each(e,function(e,n,r){i=t(e,n,r),(i>o||i===-1/0&&s===-1/0)&&(s=e,o=i)});return s},p.min=function(e,t,n){var r,i,s=1/0,o=1/0;if(null==t&&null!=e){e=e.length===+e.length?e:p.values(e);for(var u=0,a=e.length;a>u;u++)r=e[u],s>r&&(s=r)}else t=p.iteratee(t,n),p.each(e,function(e,n,r){i=t(e,n,r),(o>i||1/0===i&&1/0===s)&&(s=e,o=i)});return s},p.shuffle=function(e){for(var t,n=e&&e.length===+e.length?e:p.values(e),r=n.length,i=Array(r),s=0;r>s;s++)t=p.random(0,s),t!==s&&(i[s]=i[t]),i[t]=n[s];return i},p.sample=function(e,t,n){return null==t||n?(e.length!==+e.length&&(e=p.values(e)),e[p.random(e.length-1)]):p.shuffle(e).slice(0,Math.max(0,t))},p.sortBy=function(e,t,n){return t=p.iteratee(t,n),p.pluck(p.map(e,function(e,n,r){return{value:e,index:n,criteria:t(e,n,r)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||n===void 0)return 1;if(r>n||r===void 0)return-1}return e.index-t.index}),"value")};var m=function(e){return function(t,n,r){var i={};return n=p.iteratee(n,r),p.each(t,function(r,s){var o=n(r,s,t);e(i,r,o)}),i}};p.groupBy=m(function(e,t,n){p.has(e,n)?e[n].push(t):e[n]=[t]}),p.indexBy=m(function(e,t,n){e[n]=t}),p.countBy=m(function(e,t,n){p.has(e,n)?e[n]++:e[n]=1}),p.sortedIndex=function(e,t,n,r){n=p.iteratee(n,r,1);for(var i=n(t),s=0,o=e.length;o>s;){var u=s+o>>>1;n(e[u])<i?s=u+1:o=u}return s},p.toArray=function(e){return e?p.isArray(e)?o.call(e):e.length===+e.length?p.map(e,p.identity):p.values(e):[]},p.size=function(e){return null==e?0:e.length===+e.length?e.length:p.keys(e).length},p.partition=function(e,t,n){t=p.iteratee(t,n);var r=[],i=[];return p.each(e,function(e,n,s){(t(e,n,s)?r:i).push(e)}),[r,i]},p.first=p.head=p.take=function(e,t,n){return null==e?void 0:null==t||n?e[0]:0>t?[]:o.call(e,0,t)},p.initial=function(e,t,n){return o.call(e,0,Math.max(0,e.length-(null==t||n?1:t)))},p.last=function(e,t,n){return null==e?void 0:null==t||n?e[e.length-1]:o.call(e,Math.max(e.length-t,0))},p.rest=p.tail=p.drop=function(e,t,n){return o.call(e,null==t||n?1:t)},p.compact=function(e){return p.filter(e,p.identity)};var g=function(e,t,n,r){if(t&&p.every(e,p.isArray))return u.apply(r,e);for(var i=0,o=e.length;o>i;i++){var a=e[i];p.isArray(a)||p.isArguments(a)?t?s.apply(r,a):g(a,t,n,r):n||r.push(a)}return r};p.flatten=function(e,t){return g(e,t,!1,[])},p.without=function(e){return p.difference(e,o.call(arguments,1))},p.uniq=p.unique=function(e,t,n,r){if(null==e)return[];p.isBoolean(t)||(r=n,n=t,t=!1),null!=n&&(n=p.iteratee(n,r));for(var i=[],s=[],o=0,u=e.length;u>o;o++){var a=e[o];if(t)o&&s===a||i.push(a),s=a;else if(n){var f=n(a,o,e);p.indexOf(s,f)<0&&(s.push(f),i.push(a))}else p.indexOf(i,a)<0&&i.push(a)}return i},p.union=function(){return p.uniq(g(arguments,!0,!0,[]))},p.intersection=function(e){if(null==e)return[];for(var t=[],n=arguments.length,r=0,i=e.length;i>r;r++){var s=e[r];if(!p.contains(t,s)){for(var o=1;n>o&&p.contains(arguments[o],s);o++);o===n&&t.push(s)}}return t},p.difference=function(e){var t=g(o.call(arguments,1),!0,!0,[]);return p.filter(e,function(e){return!p.contains(t,e)})},p.zip=function(e){if(null==e)return[];for(var t=p.max(arguments,"length").length,n=Array(t),r=0;t>r;r++)n[r]=p.pluck(arguments,r);return n},p.object=function(e,t){if(null==e)return{};for(var n={},r=0,i=e.length;i>r;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n},p.indexOf=function(e,t,n){if(null==e)return-1;var r=0,i=e.length;if(n){if("number"!=typeof n)return r=p.sortedIndex(e,t),e[r]===t?r:-1;r=0>n?Math.max(0,i+n):n}for(;i>r;r++)if(e[r]===t)return r;return-1},p.lastIndexOf=function(e,t,n){if(null==e)return-1;var r=e.length;for("number"==typeof n&&(r=0>n?r+n+1:Math.min(r,n+1));--r>=0;)if(e[r]===t)return r;return-1},p.range=function(e,t,n){arguments.length<=1&&(t=e||0,e=0),n=n||1;for(var r=Math.max(Math.ceil((t-e)/n),0),i=Array(r),s=0;r>s;s++,e+=n)i[s]=e;return i};var y=function(){};p.bind=function(e,t){var n,r;if(h&&e.bind===h)return h.apply(e,o.call(arguments,1));if(!p.isFunction(e))throw new TypeError("Bind must be called on a function");return n=o.call(arguments,2),r=function(){if(this instanceof r){y.prototype=e.prototype;var i=new y;y.prototype=null;var s=e.apply(i,n.concat(o.call(arguments)));return p.isObject(s)?s:i}return e.apply(t,n.concat(o.call(arguments)))}},p.partial=function(e){var t=o.call(arguments,1);return function(){for(var n=0,r=t.slice(),i=0,s=r.length;s>i;i++)r[i]===p&&(r[i]=arguments[n++]);for(;n<arguments.length;)r.push(arguments[n++]);return e.apply(this,r)}},p.bindAll=function(e){var t,n,r=arguments.length;if(1>=r)throw new Error("bindAll must be passed function names");for(t=1;r>t;t++)n=arguments[t],e[n]=p.bind(e[n],e);return e},p.memoize=function(e,t){var n=function(r){var i=n.cache,s=t?t.apply(this,arguments):r;return p.has(i,s)||(i[s]=e.apply(this,arguments)),i[s]};return n.cache={},n},p.delay=function(e,t){var n=o.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},p.defer=function(e){return p.delay.apply(p,[e,1].concat(o.call(arguments,1)))},p.throttle=function(e,t,n){var r,i,s,o=null,u=0;n||(n={});var a=function(){u=n.leading===!1?0:p.now(),o=null,s=e.apply(r,i),o||(r=i=null)};return function(){var f=p.now();u||n.leading!==!1||(u=f);var l=t-(f-u);return r=this,i=arguments,0>=l||l>t?(clearTimeout(o),o=null,u=f,s=e.apply(r,i),o||(r=i=null)):o||n.trailing===!1||(o=setTimeout(a,l)),s}},p.debounce=function(e,t,n){var r,i,s,o,u,a=function(){var f=p.now()-o;t>f&&f>0?r=setTimeout(a,t-f):(r=null,n||(u=e.apply(s,i),r||(s=i=null)))};return function(){s=this,i=arguments,o=p.now();var f=n&&!r;return r||(r=setTimeout(a,t)),f&&(u=e.apply(s,i),s=i=null),u}},p.wrap=function(e,t){return p.partial(t,e)},p.negate=function(e){return function(){return!e.apply(this,arguments)}},p.compose=function(){var e=arguments,t=e.length-1;return function(){for(var n=t,r=e[t].apply(this,arguments);n--;)r=e[n].call(this,r);return r}},p.after=function(e,t){return function(){return--e<1?t.apply(this,arguments):void 0}},p.before=function(e,t){var n;return function(){return--e>0?n=t.apply(this,arguments):t=null,n}},p.once=p.partial(p.before,2),p.keys=function(e){if(!p.isObject(e))return[];if(c)return c(e);var t=[];for(var n in e)p.has(e,n)&&t.push(n);return t},p.values=function(e){for(var t=p.keys(e),n=t.length,r=Array(n),i=0;n>i;i++)r[i]=e[t[i]];return r},p.pairs=function(e){for(var t=p.keys(e),n=t.length,r=Array(n),i=0;n>i;i++)r[i]=[t[i],e[t[i]]];return r},p.invert=function(e){for(var t={},n=p.keys(e),r=0,i=n.length;i>r;r++)t[e[n[r]]]=n[r];return t},p.functions=p.methods=function(e){var t=[];for(var n in e)p.isFunction(e[n])&&t.push(n);return t.sort()},p.extend=function(e){if(!p.isObject(e))return e;for(var t,n,r=1,i=arguments.length;i>r;r++){t=arguments[r];for(n in t)f.call(t,n)&&(e[n]=t[n])}return e},p.pick=function(e,t,n){var r,i={};if(null==e)return i;if(p.isFunction(t)){t=d(t,n);for(r in e){var s=e[r];t(s,r,e)&&(i[r]=s)}}else{var a=u.apply([],o.call(arguments,1));e=new Object(e);for(var f=0,l=a.length;l>f;f++)r=a[f],r in e&&(i[r]=e[r])}return i},p.omit=function(e,t,n){if(p.isFunction(t))t=p.negate(t);else{var r=p.map(u.apply([],o.call(arguments,1)),String);t=function(e,t){return!p.contains(r,t)}}return p.pick(e,t,n)},p.defaults=function(e){if(!p.isObject(e))return e;for(var t=1,n=arguments.length;n>t;t++){var r=arguments[t];for(var i in r)e[i]===void 0&&(e[i]=r[i])}return e},p.clone=function(e){return p.isObject(e)?p.isArray(e)?e.slice():p.extend({},e):e},p.tap=function(e,t){return t(e),e};var b=function(e,t,n,r){if(e===t)return 0!==e||1/e===1/t;if(null==e||null==t)return e===t;e instanceof p&&(e=e._wrapped),t instanceof p&&(t=t._wrapped);var i=a.call(e);if(i!==a.call(t))return!1;switch(i){case"[object RegExp]":case"[object String]":return""+e==""+t;case"[object Number]":return+e!==+e?+t!==+t:0===+e?1/+e===1/t:+e===+t;case"[object Date]":case"[object Boolean]":return+e===+t}if("object"!=typeof e||"object"!=typeof t)return!1;for(var s=n.length;s--;)if(n[s]===e)return r[s]===t;var o=e.constructor,u=t.constructor;if(o!==u&&"constructor"in e&&"constructor"in t&&!(p.isFunction(o)&&o instanceof o&&p.isFunction(u)&&u instanceof u))return!1;n.push(e),r.push(t);var f,l;if("[object Array]"===i){if(f=e.length,l=f===t.length)for(;f--&&(l=b(e[f],t[f],n,r)););}else{var c,h=p.keys(e);if(f=h.length,l=p.keys(t).length===f)for(;f--&&(c=h[f],l=p.has(t,c)&&b(e[c],t[c],n,r)););}return n.pop(),r.pop(),l};p.isEqual=function(e,t){return b(e,t,[],[])},p.isEmpty=function(e){if(null==e)return!0;if(p.isArray(e)||p.isString(e)||p.isArguments(e))return 0===e.length;for(var t in e)if(p.has(e,t))return!1;return!0},p.isElement=function(e){return!!e&&1===e.nodeType},p.isArray=l||function(e){return"[object Array]"===a.call(e)},p.isObject=function(e){var t=typeof e;return"function"===t||"object"===t&&!!e},p.each(["Arguments","Function","String","Number","Date","RegExp"],function(e){p["is"+e]=function(t){return a.call(t)==="[object "+e+"]"}}),p.isArguments(arguments)||(p.isArguments=function(e){return p.has(e,"callee")}),"function"!=typeof /./&&(p.isFunction=function(e){return"function"==typeof e||!1}),p.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},p.isNaN=function(e){return p.isNumber(e)&&e!==+e},p.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"===a.call(e)},p.isNull=function(e){return null===e},p.isUndefined=function(e){return e===void 0},p.has=function(e,t){return null!=e&&f.call(e,t)},p.noConflict=function(){return e._=t,this},p.identity=function(e){return e},p.constant=function(e){return function(){return e}},p.noop=function(){},p.property=function(e){return function(t){return t[e]}},p.matches=function(e){var t=p.pairs(e),n=t.length;return function(e){if(null==e)return!n;e=new Object(e);for(var r=0;n>r;r++){var i=t[r],s=i[0];if(i[1]!==e[s]||!(s in e))return!1}return!0}},p.times=function(e,t,n){var r=Array(Math.max(0,e));t=d(t,n,1);for(var i=0;e>i;i++)r[i]=t(i);return r},p.random=function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))},p.now=Date.now||function(){return(new Date).getTime()};var w={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},E=p.invert(w),S=function(e){var t=function(t){return e[t]},n="(?:"+p.keys(e).join("|")+")",r=RegExp(n),i=RegExp(n,"g");return function(e){return e=null==e?"":""+e,r.test(e)?e.replace(i,t):e}};p.escape=S(w),p.unescape=S(E),p.result=function(e,t){if(null==e)return void 0;var n=e[t];return p.isFunction(n)?e[t]():n};var x=0;p.uniqueId=function(e){var t=++x+"";return e?e+t:t},p.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var T=/(.)^/,N={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},C=/\\|'|\r|\n|\u2028|\u2029/g,k=function(e){return"\\"+N[e]};p.template=function(e,t,n){!t&&n&&(t=n),t=p.defaults({},t,p.templateSettings);var r=RegExp([(t.escape||T).source,(t.interpolate||T).source,(t.evaluate||T).source].join("|")+"|$","g"),i=0,s="__p+='";e.replace(r,function(t,n,r,o,u){return s+=e.slice(i,u).replace(C,k),i=u+t.length,n?s+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":r?s+="'+\n((__t=("+r+"))==null?'':__t)+\n'":o&&(s+="';\n"+o+"\n__p+='"),t}),s+="';\n",t.variable||(s="with(obj||{}){\n"+s+"}\n"),s="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+s+"return __p;\n";try{var o=new Function(t.variable||"obj","_",s)}catch(u){throw u.source=s,u}var a=function(e){return o.call(this,e,p)},f=t.variable||"obj";return a.source="function("+f+"){\n"+s+"}",a},p.chain=function(e){var t=p(e);return t._chain=!0,t};var L=function(e){return this._chain?p(e).chain():e};p.mixin=function(e){p.each(p.functions(e),function(t){var n=p[t]=e[t];p.prototype[t]=function(){var e=[this._wrapped];return s.apply(e,arguments),L.call(this,n.apply(p,e))}})},p.mixin(p),p.each(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=n[e];p.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),"shift"!==e&&"splice"!==e||0!==n.length||delete n[0],L.call(this,n)}}),p.each(["concat","join","slice"],function(e){var t=n[e];p.prototype[e]=function(){return L.call(this,t.apply(this._wrapped,arguments))}}),p.prototype.value=function(){return this._wrapped},"function"==typeof define&&define.amd&&define("underscore",[],function(){return p})}).call(this),!function(root){function Context(e,t,n,r){this.stack=e,this.global=t,this.blocks=n,this.templateName=r}function Stack(e,t,n,r){this.tail=t,this.isObject=e&&"object"==typeof e,this.head=e,this.index=n,this.of=r}function Stub(e){this.head=new Chunk(this),this.callback=e,this.out=""}function Stream(){this.head=new Chunk(this)}function Chunk(e,t,n){this.root=e,this.next=t,this.data=[],this.flushable=!1,this.taps=n}function Tap(e,t){this.head=e,this.tail=t}var dust={},NONE="NONE",ERROR="ERROR",WARN="WARN",INFO="INFO",DEBUG="DEBUG",loggingLevels=[DEBUG,INFO,WARN,ERROR,NONE],EMPTY_FUNC=function(){},logger={},originalLog,loggerContext;dust.debugLevel=NONE,dust.config={whitespace:!1},dust._aliases={write:"w",end:"e",map:"m",render:"r",reference:"f",section:"s",exists:"x",notexists:"nx",block:"b",partial:"p",helper:"h"},root&&root.console&&root.console.log&&(loggerContext=root.console,originalLog=root.console.log),logger.log=loggerContext?function(){logger.log="function"==typeof originalLog?function(){originalLog.apply(loggerContext,arguments)}:function(){var e=Array.prototype.slice.apply(arguments).join(" ");originalLog(e)},logger.log.apply(this,arguments)}:function(){},dust.log=function(e,t){t=t||INFO,dust.debugLevel!==NONE&&dust.indexInArray(loggingLevels,t)>=dust.indexInArray(loggingLevels,dust.debugLevel)&&(dust.logQueue||(dust.logQueue=[]),dust.logQueue.push({message:e,type:t}),logger.log("[DUST "+t+"]: "+e))},dust.helpers={},dust.cache={},dust.register=function(e,t){e&&(dust.cache[e]=t)},dust.render=function(e,t,n){var r=(new Stub(n)).head;try{dust.load(e,r,Context.wrap(t,e)).end()}catch(i){r.setError(i)}},dust.stream=function(e,t){var n=new Stream,r=n.head;return dust.nextTick(function(){try{dust.load(e,n.head,Context.wrap(t,e)).end()}catch(i){r.setError(i)}}),n},dust.renderSource=function(e,t,n){return dust.compileFn(e)(t,n)},dust.compileFn=function(e,t){t=t||null;var n=dust.loadSource(dust.compile(e,t));return function(e,r){var i=r?new Stub(r):new Stream;return dust.nextTick(function(){"function"==typeof n?n(i.head,Context.wrap(e,t)).end():dust.log(new Error("Template ["+t+"] cannot be resolved to a Dust function"),ERROR)}),i}},dust.load=function(e,t,n){var r=dust.cache[e];return r?r(t,n):dust.onLoad?t.map(function(t){dust.onLoad(e,function(r,i){return r?t.setError(r):(dust.cache[e]||dust.loadSource(dust.compile(i,e)),void dust.cache[e](t,n).end())})}):t.setError(new Error("Template Not Found: "+e))},dust.loadSource=function(source,path){return eval(source)},dust.isArray=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},dust.indexInArray=function(e,t,n){if(n=+n||0,Array.prototype.indexOf)return e.indexOf(t,n);if(void 0===e||null===e)throw new TypeError('cannot call method "indexOf" of null');var r=e.length;for(1/0===Math.abs(n)&&(n=0),0>n&&(n+=r,0>n&&(n=0));r>n;n++)if(e[n]===t)return n;return-1},dust.nextTick=function(){return function(e){setTimeout(e,0)}}(),dust.isEmpty=function(e){return dust.isArray(e)&&!e.length?!0:0===e?!1:!e},dust.filter=function(e,t,n){if(n)for(var r=0,i=n.length;i>r;r++){var s=n[r];"s"===s?t=null:"function"==typeof dust.filters[s]?e=dust.filters[s](e):dust.log("Invalid filter ["+s+"]",WARN)}return t&&(e=dust.filters[t](e)),e},dust.filters={h:function(e){return dust.escapeHtml(e)},j:function(e){return dust.escapeJs(e)},u:encodeURI,uc:encodeURIComponent,js:function(e){return JSON?JSON.stringify(e):(dust.log("JSON is undefined.  JSON stringify has not been used on ["+e+"]",WARN),e)},jp:function(e){return JSON?JSON.parse(e):(dust.log("JSON is undefined.  JSON parse has not been used on ["+e+"]",WARN),e)}},dust.makeBase=function(e){return new Context(new Stack,e)},Context.wrap=function(e,t){return e instanceof Context?e:new Context(new Stack(e),{},null,t)},Context.prototype.get=function(e,t){return"string"==typeof e&&("."===e[0]&&(t=!0,e=e.substr(1)),e=e.split(".")),this._get(t,e)},Context.prototype._get=function(e,t){var n,r,i,s,o,u=this.stack,a=1;if(r=t[0],i=t.length,e&&0===i)s=u,u=u.head;else{if(e)u&&(u=u.head?u.head[r]:void 0);else{for(;u&&(!u.isObject||(s=u.head,n=u.head[r],void 0===n));)u=u.tail;u=void 0!==n?n:this.global?this.global[r]:void 0}for(;u&&i>a;)s=u,u=u[t[a]],a++}return"function"==typeof u?(o=function(){try{return u.apply(s,arguments)}catch(e){throw dust.log(e,ERROR),e}},o.__dustBody=!!u.__dustBody,o):(void 0===u&&dust.log("Cannot find the value for reference [{"+t.join(".")+"}] in template ["+this.getTemplateName()+"]"),u)},Context.prototype.getPath=function(e,t){return this._get(e,t)},Context.prototype.push=function(e,t,n){return new Context(new Stack(e,this.stack,t,n),this.global,this.blocks,this.getTemplateName())},Context.prototype.rebase=function(e){return new Context(new Stack(e),this.global,this.blocks,this.getTemplateName())},Context.prototype.current=function(){return this.stack.head},Context.prototype.getBlock=function(e){if("function"==typeof e){var t=new Chunk;e=e(t,this).data.join("")}var n=this.blocks;if(!n)return void dust.log("No blocks for context[{"+e+"}] in template ["+this.getTemplateName()+"]",DEBUG);for(var r,i=n.length;i--;)if(r=n[i][e])return r},Context.prototype.shiftBlocks=function(e){var t,n=this.blocks;return e?(t=n?n.concat([e]):[e],new Context(this.stack,this.global,t,this.getTemplateName())):this},Context.prototype.getTemplateName=function(){return this.templateName},Stub.prototype.flush=function(){for(var e=this.head;e;){if(!e.flushable)return e.error?(this.callback(e.error),dust.log("Chunk error ["+e.error+"] thrown. Ceasing to render this template.",WARN),void (this.flush=EMPTY_FUNC)):void 0;this.out+=e.data.join(""),e=e.next,this.head=e}this.callback(null,this.out)},Stream.prototype.flush=function(){for(var e=this.head;e;){if(!e.flushable)return e.error?(this.emit("error",e.error),dust.log("Chunk error ["+e.error+"] thrown. Ceasing to render this template.",WARN),void (this.flush=EMPTY_FUNC)):void 0;this.emit("data",e.data.join("")),e=e.next,this.head=e}this.emit("end")},Stream.prototype.emit=function(e,t){if(!this.events)return dust.log("No events to emit",INFO),!1;var n=this.events[e];if(!n)return dust.log("Event type ["+e+"] does not exist",WARN),!1;if("function"==typeof n)n(t);else if(dust.isArray(n))for(var r=n.slice(0),i=0,s=r.length;s>i;i++)r[i](t);else dust.log("Event Handler ["+n+"] is not of a type that is handled by emit",WARN)},Stream.prototype.on=function(e,t){return this.events||(this.events={}),this.events[e]?"function"==typeof this.events[e]?this.events[e]=[this.events[e],t]:this.events[e].push(t):t?this.events[e]=t:dust.log("Callback for type ["+e+"] does not exist. Listener not registered.",WARN),this},Stream.prototype.pipe=function(e){return this.on("data",function(t){try{e.write(t,"utf8")}catch(n){dust.log(n,ERROR)}}).on("end",function(){try{return e.end()}catch(t){dust.log(t,ERROR)}}).on("error",function(t){e.error(t)}),this},Chunk.prototype.write=function(e){var t=this.taps;return t&&(e=t.go(e)),this.data.push(e),this},Chunk.prototype.end=function(e){return e&&this.write(e),this.flushable=!0,this.root.flush(),this},Chunk.prototype.map=function(e){var t=new Chunk(this.root,this.next,this.taps),n=new Chunk(this.root,t,this.taps);this.next=n,this.flushable=!0;try{e(n)}catch(r){dust.log(r,ERROR),n.setError(r)}return t},Chunk.prototype.tap=function(e){var t=this.taps;return this.taps=t?t.push(e):new Tap(e),this},Chunk.prototype.untap=function(){return this.taps=this.taps.tail,this},Chunk.prototype.render=function(e,t){return e(this,t)},Chunk.prototype.reference=function(e,t,n,r){return"function"==typeof e&&(e=e.apply(t.current(),[this,t,null,{auto:n,filters:r}]),e instanceof Chunk)?e:dust.isEmpty(e)?this:this.write(dust.filter(e,n,r))},Chunk.prototype.section=function(e,t,n,r){if("function"==typeof e&&!e.__dustBody){try{e=e.apply(t.current(),[this,t,n,r])}catch(i){return dust.log(i,ERROR),this.setError(i)}if(e instanceof Chunk)return e}var s=n.block,o=n["else"];if(r&&(t=t.push(r)),dust.isArray(e)){if(s){var u=e.length,a=this;if(u>0){t.stack.head&&(t.stack.head.$len=u);for(var f=0;u>f;f++)t.stack.head&&(t.stack.head.$idx=f),a=s(a,t.push(e[f],f,u));return t.stack.head&&(t.stack.head.$idx=void 0,t.stack.head.$len=void 0),a}if(o)return o(this,t)}}else if(e===!0){if(s)return s(this,t)}else if(e||0===e){if(s)return s(this,t.push(e))}else if(o)return o(this,t);return dust.log("Not rendering section (#) block in template ["+t.getTemplateName()+"], because above key was not found",DEBUG),this},Chunk.prototype.exists=function(e,t,n){var r=n.block,i=n["else"];if(dust.isEmpty(e)){if(i)return i(this,t)}else if(r)return r(this,t);return dust.log("Not rendering exists (?) block in template ["+t.getTemplateName()+"], because above key was not found",DEBUG),this},Chunk.prototype.notexists=function(e,t,n){var r=n.block,i=n["else"];if(dust.isEmpty(e)){if(r)return r(this,t)}else if(i)return i(this,t);return dust.log("Not rendering not exists (^) block check in template ["+t.getTemplateName()+"], because above key was found",DEBUG),this},Chunk.prototype.block=function(e,t,n){var r=n.block;return e&&(r=e),r?r(this,t):this},Chunk.prototype.partial=function(e,t,n){var r;r=dust.makeBase(t.global),r.blocks=t.blocks,t.stack&&t.stack.tail&&(r.stack=t.stack.tail),n&&(r=r.push(n)),"string"==typeof e&&(r.templateName=e),r=r.push(t.stack.head);var i;return i="function"==typeof e?this.capture(e,r,function(e,t){r.templateName=r.templateName||e,dust.load(e,t,r).end()}):dust.load(e,this,r)},Chunk.prototype.helper=function(e,t,n,r){var i=this;if(!dust.helpers[e])return dust.log("Invalid helper ["+e+"]",WARN),i;try{return dust.helpers[e](i,t,n,r)}catch(s){return dust.log("Error in "+e+" helper: "+s,ERROR),i.setError(s)}},Chunk.prototype.capture=function(e,t,n){return this.map(function(r){var i=new Stub(function(e,t){e?r.setError(e):n(t,r)});e(i.head,t).end()})},Chunk.prototype.setError=function(e){return this.error=e,this.root.flush(),this};for(var f in Chunk.prototype)dust._aliases[f]&&(Chunk.prototype[dust._aliases[f]]=Chunk.prototype[f]);Tap.prototype.push=function(e){return new Tap(e,this)},Tap.prototype.go=function(e){for(var t=this;t;)e=t.head(e),t=t.tail;return e};var HCHARS=/[&<>"']/,AMP=/&/g,LT=/</g,GT=/>/g,QUOT=/\"/g,SQUOT=/\'/g;dust.escapeHtml=function(e){return"string"==typeof e&&HCHARS.test(e)?e.replace(AMP,"&amp;").replace(LT,"&lt;").replace(GT,"&gt;").replace(QUOT,"&quot;").replace(SQUOT,"&#39;"):e};var BS=/\\/g,FS=/\//g,CR=/\r/g,LS=/\u2028/g,PS=/\u2029/g,NL=/\n/g,LF=/\f/g,SQ=/'/g,DQ=/"/g,TB=/\t/g;dust.escapeJs=function(e){return"string"==typeof e?e.replace(BS,"\\\\").replace(FS,"\\/").replace(DQ,'\\"').replace(SQ,"\\'").replace(CR,"\\r").replace(LS,"\\u2028").replace(PS,"\\u2029").replace(NL,"\\n").replace(LF,"\\f").replace(TB,"\\t"):e},"object"==typeof exports?module.exports=dust:root.dust=dust}(function(){return this}()),function(e,t){"object"==typeof exports?module.exports=t(require("./dust")):t(e.dust)}(this,function(e){var t=function(){function e(e,t){function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n}function t(e,t,n,r,i,s){this.message=e,this.expected=t,this.found=n,this.offset=r,this.line=i,this.column=s,this.name="SyntaxError"}function n(e){function n(){return s(vr).line}function r(){return s(vr).column}function i(e){throw u(e,null,vr)}function s(t){function n(t,n,r){var i,s;for(i=n;r>i;i++)s=e.charAt(i),"\n"===s?(t.seenCR||t.line++,t.column=1,t.seenCR=!1):"\r"===s||"\u2028"===s||"\u2029"===s?(t.line++,t.column=1,t.seenCR=!0):(t.column++,t.seenCR=!1)}return mr!==t&&(mr>t&&(mr=0,gr={line:1,column:1,seenCR:!1}),n(gr,mr,t),mr=t),gr}function o(e){yr>dr||(dr>yr&&(yr=dr,br=[]),br.push(e))}function u(n,r,i){function o(e){var t=1;for(e.sort(function(e,t){return e.description<t.description?-1:e.description>t.description?1:0});t<e.length;)e[t-1]===e[t]?e.splice(t,1):t++}function u(e,t){function n(e){function t(e){return e.charCodeAt(0).toString(16).toUpperCase()}return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(e){return"\\x0"+t(e)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(e){return"\\x"+t(e)}).replace(/[\u0180-\u0FFF]/g,function(e){return"\\u0"+t(e)}).replace(/[\u1080-\uFFFF]/g,function(e){return"\\u"+t(e)})}var r,i,s,o=new Array(e.length);for(s=0;s<e.length;s++)o[s]=e[s].description;return r=e.length>1?o.slice(0,-1).join(", ")+" or "+o[e.length-1]:o[0],i=t?'"'+n(t)+'"':"end of input","Expected "+r+" but "+i+" found."}var a=s(i),f=i<e.length?e.charAt(i):null;return null!==r&&o(r),new t(null!==n?n:u(r,f),r,f,i,a.line,a.column)}function a(){var e;return e=f()}function f(){var e,t,n;for(e=dr,t=[],n=l();n!==V;)t.push(n),n=l();return t!==V&&(vr=e,t=K(t)),e=t}function l(){var e;return e=H(),e===V&&(e=B(),e===V&&(e=c(),e===V&&(e=y(),e===V&&(e=E(),e===V&&(e=g(),e===V&&(e=_())))))),e}function c(){var t,n,r,i,s,u,a,l;if(wr++,t=dr,n=h(),n!==V){for(r=[],i=z();i!==V;)r.push(i),i=z();r!==V?(i=I(),i!==V?(s=f(),s!==V?(u=m(),u!==V?(a=p(),a===V&&(a=Y),a!==V?(vr=dr,l=Z(n,s,u,a),l=l?et:G,l!==V?(vr=t,n=tt(n,s,u,a),t=n):(dr=t,t=G)):(dr=t,t=G)):(dr=t,t=G)):(dr=t,t=G)):(dr=t,t=G)):(dr=t,t=G)}else dr=t,t=G;if(t===V)if(t=dr,n=h(),n!==V){for(r=[],i=z();i!==V;)r.push(i),i=z();r!==V?(47===e.charCodeAt(dr)?(i=nt,dr++):(i=V,0===wr&&o(rt)),i!==V?(s=I(),s!==V?(vr=t,n=it(n),t=n):(dr=t,t=G)):(dr=t,t=G)):(dr=t,t=G)}else dr=t,t=G;return wr--,t===V&&(n=V,0===wr&&o(Q)),t}function h(){var t,n,r,i,s,u,a;if(t=dr,n=F(),n!==V)if(st.test(e.charAt(dr))?(r=e.charAt(dr),dr++):(r=V,0===wr&&o(ot)),r!==V){for(i=[],s=z();s!==V;)i.push(s),s=z();i!==V?(s=S(),s!==V?(u=d(),u!==V?(a=v(),a!==V?(vr=t,n=ut(r,s,u,a),t=n):(dr=t,t=G)):(dr=t,t=G)):(dr=t,t=G)):(dr=t,t=G)}else dr=t,t=G;else dr=t,t=G;return t}function p(){var t,n,r,i,s,u,a;if(wr++,t=dr,n=F(),n!==V)if(47===e.charCodeAt(dr)?(r=nt,dr++):(r=V,0===wr&&o(rt)),r!==V){for(i=[],s=z();s!==V;)i.push(s),s=z();if(i!==V)if(s=S(),s!==V){for(u=[],a=z();a!==V;)u.push(a),a=z();u!==V?(a=I(),a!==V?(vr=t,n=ft(s),t=n):(dr=t,t=G)):(dr=t,t=G)}else dr=t,t=G;else dr=t,t=G}else dr=t,t=G;else dr=t,t=G;return wr--,t===V&&(n=V,0===wr&&o(at)),t}function d(){var t,n,r,i;return t=dr,n=dr,58===e.charCodeAt(dr)?(r=lt,dr++):(r=V,0===wr&&o(ct)),r!==V?(i=S(),i!==V?(vr=n,r=ht(i),n=r):(dr=n,n=G)):(dr=n,n=G),n===V&&(n=Y),n!==V&&(vr=t,n=pt(n)),t=n}function v(){var t,n,r,i,s,u,a;if(wr++,t=dr,n=[],r=dr,i=[],s=z(),s!==V)for(;s!==V;)i.push(s),s=z();else i=G;for(i!==V?(s=k(),s!==V?(61===e.charCodeAt(dr)?(u=vt,dr++):(u=V,0===wr&&o(mt)),u!==V?(a=x(),a===V&&(a=S(),a===V&&(a=O())),a!==V?(vr=r,i=gt(s,a),r=i):(dr=r,r=G)):(dr=r,r=G)):(dr=r,r=G)):(dr=r,r=G);r!==V;){if(n.push(r),r=dr,i=[],s=z(),s!==V)for(;s!==V;)i.push(s),s=z();else i=G;i!==V?(s=k(),s!==V?(61===e.charCodeAt(dr)?(u=vt,dr++):(u=V,0===wr&&o(mt)),u!==V?(a=x(),a===V&&(a=S(),a===V&&(a=O())),a!==V?(vr=r,i=gt(s,a),r=i):(dr=r,r=G)):(dr=r,r=G)):(dr=r,r=G)):(dr=r,r=G)}return n!==V&&(vr=t,n=yt(n)),t=n,wr--,t===V&&(n=V,0===wr&&o(dt)),t}function m(){var t,n,r,i,s,u,a,l;for(wr++,t=dr,n=[],r=dr,i=F(),i!==V?(58===e.charCodeAt(dr)?(s=lt,dr++):(s=V,0===wr&&o(ct)),s!==V?(u=k(),u!==V?(a=I(),a!==V?(l=f(),l!==V?(vr=r,i=gt(u,l),r=i):(dr=r,r=G)):(dr=r,r=G)):(dr=r,r=G)):(dr=r,r=G)):(dr=r,r=G);r!==V;)n.push(r),r=dr,i=F(),i!==V?(58===e.charCodeAt(dr)?(s=lt,dr++):(s=V,0===wr&&o(ct)),s!==V?(u=k(),u!==V?(a=I(),a!==V?(l=f(),l!==V?(vr=r,i=gt(u,l),r=i):(dr=r,r=G)):(dr=r,r=G)):(dr=r,r=G)):(dr=r,r=G)):(dr=r,r=G);return n!==V&&(vr=t,n=wt(n)),t=n,wr--,t===V&&(n=V,0===wr&&o(bt)),t}function g(){var e,t,n,r,i;return wr++,e=dr,t=F(),t!==V?(n=S(),n!==V?(r=w(),r!==V?(i=I(),i!==V?(vr=e,t=St(n,r),e=t):(dr=e,e=G)):(dr=e,e=G)):(dr=e,e=G)):(dr=e,e=G),wr--,e===V&&(t=V,0===wr&&o(Et)),e}function y(){var t,n,r,i,s,u,a,f,l,c;if(wr++,t=dr,n=F(),n!==V)if(62===e.charCodeAt(dr)?(r=Tt,dr++):(r=V,0===wr&&o(Nt)),r===V&&(43===e.charCodeAt(dr)?(r=Ct,dr++):(r=V,0===wr&&o(kt))),r!==V){for(i=[],s=z();s!==V;)i.push(s),s=z();if(i!==V)if(s=dr,u=k(),u!==V&&(vr=s,u=Lt(u)),s=u,s===V&&(s=O()),s!==V)if(u=d(),u!==V)if(a=v(),a!==V){for(f=[],l=z();l!==V;)f.push(l),l=z();f!==V?(47===e.charCodeAt(dr)?(l=nt,dr++):(l=V,0===wr&&o(rt)),l!==V?(c=I(),c!==V?(vr=t,n=At(r,s,u,a),t=n):(dr=t,t=G)):(dr=t,t=G)):(dr=t,t=G)}else dr=t,t=G;else dr=t,t=G;else dr=t,t=G;else dr=t,t=G}else dr=t,t=G;else dr=t,t=G;return wr--,t===V&&(n=V,0===wr&&o(xt)),t}function w(){var t,n,r,i,s;for(wr++,t=dr,n=[],r=dr,124===e.charCodeAt(dr)?(i=Mt,dr++):(i=V,0===wr&&o(_t)),i!==V?(s=k(),s!==V?(vr=r,i=ht(s),r=i):(dr=r,r=G)):(dr=r,r=G);r!==V;)n.push(r),r=dr,124===e.charCodeAt(dr)?(i=Mt,dr++):(i=V,0===wr&&o(_t)),i!==V?(s=k(),s!==V?(vr=r,i=ht(s),r=i):(dr=r,r=G)):(dr=r,r=G);return n!==V&&(vr=t,n=Dt(n)),t=n,wr--,t===V&&(n=V,0===wr&&o(Ot)),t}function E(){var t,n,r,i,s;return wr++,t=dr,n=F(),n!==V?(126===e.charCodeAt(dr)?(r=Ht,dr++):(r=V,0===wr&&o(Bt)),r!==V?(i=k(),i!==V?(s=I(),s!==V?(vr=t,n=jt(i),t=n):(dr=t,t=G)):(dr=t,t=G)):(dr=t,t=G)):(dr=t,t=G),wr--,t===V&&(n=V,0===wr&&o(Pt)),t}function S(){var e,t;return wr++,e=dr,t=C(),t!==V&&(vr=e,t=It(t)),e=t,e===V&&(e=dr,t=k(),t!==V&&(vr=e,t=qt(t)),e=t),wr--,e===V&&(t=V,0===wr&&o(Ft)),e}function x(){var e,t;return wr++,e=dr,t=T(),t===V&&(t=N()),t!==V&&(vr=e,t=Ut(t)),e=t,wr--,e===V&&(t=V,0===wr&&o(Rt)),e}function T(){var t,n,r,i,s;if(wr++,t=dr,n=N(),n!==V)if(46===e.charCodeAt(dr)?(r=Wt,dr++):(r=V,0===wr&&o(Xt)),r!==V){if(i=[],s=N(),s!==V)for(;s!==V;)i.push(s),s=N();else i=G;i!==V?(vr=t,n=Vt(n,i),t=n):(dr=t,t=G)}else dr=t,t=G;else dr=t,t=G;return wr--,t===V&&(n=V,0===wr&&o(zt)),t}function N(){var t,n,r;if(wr++,t=dr,n=[],Jt.test(e.charAt(dr))?(r=e.charAt(dr),dr++):(r=V,0===wr&&o(Kt)),r!==V)for(;r!==V;)n.push(r),Jt.test(e.charAt(dr))?(r=e.charAt(dr),dr++):(r=V,0===wr&&o(Kt));else n=G;return n!==V&&(vr=t,n=Qt(n)),t=n,wr--,t===V&&(n=V,0===wr&&o($t)),t}function C(){var t,n,r,i;if(wr++,t=dr,n=k(),n===V&&(n=Y),n!==V){if(r=[],i=A(),i===V&&(i=L()),i!==V)for(;i!==V;)r.push(i),i=A(),i===V&&(i=L());else r=G;r!==V?(vr=t,n=Yt(n,r),t=n):(dr=t,t=G)}else dr=t,t=G;if(t===V)if(t=dr,46===e.charCodeAt(dr)?(n=Wt,dr++):(n=V,0===wr&&o(Xt)),n!==V){for(r=[],i=A(),i===V&&(i=L());i!==V;)r.push(i),i=A(),i===V&&(i=L());r!==V?(vr=t,n=Zt(r),t=n):(dr=t,t=G)}else dr=t,t=G;return wr--,t===V&&(n=V,0===wr&&o(Gt)),t}function k(){var t,n,r,i;if(wr++,t=dr,tn.test(e.charAt(dr))?(n=e.charAt(dr),dr++):(n=V,0===wr&&o(nn)),n!==V){for(r=[],rn.test(e.charAt(dr))?(i=e.charAt(dr),dr++):(i=V,0===wr&&o(sn));i!==V;)r.push(i),rn.test(e.charAt(dr))?(i=e.charAt(dr),dr++):(i=V,0===wr&&o(sn));r!==V?(vr=t,n=on(n,r),t=n):(dr=t,t=G)}else dr=t,t=G;return wr--,t===V&&(n=V,0===wr&&o(en)),t}function L(){var t,n,r,i,s,u;if(wr++,t=dr,n=dr,r=q(),r!==V){if(i=dr,s=[],Jt.test(e.charAt(dr))?(u=e.charAt(dr),dr++):(u=V,0===wr&&o(Kt)),u!==V)for(;u!==V;)s.push(u),Jt.test(e.charAt(dr))?(u=e.charAt(dr),dr++):(u=V,0===wr&&o(Kt));else s=G;s!==V&&(vr=i,s=an(s)),i=s,i===V&&(i=S()),i!==V?(s=R(),s!==V?(vr=n,r=fn(i),n=r):(dr=n,n=G)):(dr=n,n=G)}else dr=n,n=G;return n!==V?(r=A(),r===V&&(r=Y),r!==V?(vr=t,n=ln(n,r),t=n):(dr=t,t=G)):(dr=t,t=G),wr--,t===V&&(n=V,0===wr&&o(un)),t}function A(){var t,n,r,i,s;if(wr++,t=dr,n=[],r=dr,46===e.charCodeAt(dr)?(i=Wt,dr++):(i=V,0===wr&&o(Xt)),i!==V?(s=k(),s!==V?(vr=r,i=hn(s),r=i):(dr=r,r=G)):(dr=r,r=G),r!==V)for(;r!==V;)n.push(r),r=dr,46===e.charCodeAt(dr)?(i=Wt,dr++):(i=V,0===wr&&o(Xt)),i!==V?(s=k(),s!==V?(vr=r,i=hn(s),r=i):(dr=r,r=G)):(dr=r,r=G);else n=G;return n!==V?(r=L(),r===V&&(r=Y),r!==V?(vr=t,n=pn(n,r),t=n):(dr=t,t=G)):(dr=t,t=G),wr--,t===V&&(n=V,0===wr&&o(cn)),t}function O(){var t,n,r,i;if(wr++,t=dr,34===e.charCodeAt(dr)?(n=vn,dr++):(n=V,0===wr&&o(mn)),n!==V?(34===e.charCodeAt(dr)?(r=vn,dr++):(r=V,0===wr&&o(mn)),r!==V?(vr=t,n=gn(),t=n):(dr=t,t=G)):(dr=t,t=G),t===V&&(t=dr,34===e.charCodeAt(dr)?(n=vn,dr++):(n=V,0===wr&&o(mn)),n!==V?(r=D(),r!==V?(34===e.charCodeAt(dr)?(i=vn,dr++):(i=V,0===wr&&o(mn)),i!==V?(vr=t,n=yn(r),t=n):(dr=t,t=G)):(dr=t,t=G)):(dr=t,t=G),t===V))if(t=dr,34===e.charCodeAt(dr)?(n=vn,dr++):(n=V,0===wr&&o(mn)),n!==V){if(r=[],i=M(),i!==V)for(;i!==V;)r.push(i),i=M();else r=G;r!==V?(34===e.charCodeAt(dr)?(i=vn,dr++):(i=V,0===wr&&o(mn)),i!==V?(vr=t,n=bn(r),t=n):(dr=t,t=G)):(dr=t,t=G)}else dr=t,t=G;return wr--,t===V&&(n=V,0===wr&&o(dn)),t}function M(){var e,t;return e=E(),e===V&&(e=g(),e===V&&(e=dr,t=D(),t!==V&&(vr=e,t=wn(t)),e=t)),e}function _(){var t,n,r,i,s,u,a,f;if(wr++,t=dr,n=U(),n!==V){for(r=[],i=z();i!==V;)r.push(i),i=z();r!==V?(vr=t,n=Sn(n,r),t=n):(dr=t,t=G)}else dr=t,t=G;if(t===V){if(t=dr,n=[],r=dr,i=dr,wr++,s=j(),wr--,s===V?i=et:(dr=i,i=G),i!==V?(s=dr,wr++,u=H(),wr--,u===V?s=et:(dr=s,s=G),s!==V?(u=dr,wr++,a=B(),wr--,a===V?u=et:(dr=u,u=G),u!==V?(a=dr,wr++,f=U(),wr--,f===V?a=et:(dr=a,a=G),a!==V?(e.length>dr?(f=e.charAt(dr),dr++):(f=V,0===wr&&o(xn)),f!==V?(vr=r,i=Tn(f),r=i):(dr=r,r=G)):(dr=r,r=G)):(dr=r,r=G)):(dr=r,r=G)):(dr=r,r=G),r!==V)for(;r!==V;)n.push(r),r=dr,i=dr,wr++,s=j(),wr--,s===V?i=et:(dr=i,i=G),i!==V?(s=dr,wr++,u=H(),wr--,u===V?s=et:(dr=s,s=G),s!==V?(u=dr,wr++,a=B(),wr--,a===V?u=et:(dr=u,u=G),u!==V?(a=dr,wr++,f=U(),wr--,f===V?a=et:(dr=a,a=G),a!==V?(e.length>dr?(f=e.charAt(dr),dr++):(f=V,0===wr&&o(xn)),f!==V?(vr=r,i=Tn(f),r=i):(dr=r,r=G)):(dr=r,r=G)):(dr=r,r=G)):(dr=r,r=G)):(dr=r,r=G);else n=G;n!==V&&(vr=t,n=Nn(n)),t=n}return wr--,t===V&&(n=V,0===wr&&o(En)),t}function D(){var t,n,r,i,s;if(wr++,t=dr,n=[],r=dr,i=dr,wr++,s=j(),wr--,s===V?i=et:(dr=i,i=G),i!==V?(s=P(),s===V&&(kn.test(e.charAt(dr))?(s=e.charAt(dr),dr++):(s=V,0===wr&&o(Ln))),s!==V?(vr=r,i=Tn(s),r=i):(dr=r,r=G)):(dr=r,r=G),r!==V)for(;r!==V;)n.push(r),r=dr,i=dr,wr++,s=j(),wr--,s===V?i=et:(dr=i,i=G),i!==V?(s=P(),s===V&&(kn.test(e.charAt(dr))?(s=e.charAt(dr),dr++):(s=V,0===wr&&o(Ln))),s!==V?(vr=r,i=Tn(s),r=i):(dr=r,r=G)):(dr=r,r=G);else n=G;return n!==V&&(vr=t,n=An(n)),t=n,wr--,t===V&&(n=V,0===wr&&o(Cn)),t}function P(){var t,n;return t=dr,e.substr(dr,2)===On?(n=On,dr+=2):(n=V,0===wr&&o(Mn)),n!==V&&(vr=t,n=_n()),t=n}function H(){var t,n,r,i,s,u;if(wr++,t=dr,e.substr(dr,2)===Pn?(n=Pn,dr+=2):(n=V,0===wr&&o(Hn)),n!==V){for(r=[],i=dr,s=dr,wr++,e.substr(dr,2)===Bn?(u=Bn,dr+=2):(u=V,0===wr&&o(jn)),wr--,u===V?s=et:(dr=s,s=G),s!==V?(e.length>dr?(u=e.charAt(dr),dr++):(u=V,0===wr&&o(xn)),u!==V?(vr=i,s=Fn(u),i=s):(dr=i,i=G)):(dr=i,i=G);i!==V;)r.push(i),i=dr,s=dr,wr++,e.substr(dr,2)===Bn?(u=Bn,dr+=2):(u=V,0===wr&&o(jn)),wr--,u===V?s=et:(dr=s,s=G),s!==V?(e.length>dr?(u=e.charAt(dr),dr++):(u=V,0===wr&&o(xn)),u!==V?(vr=i,s=Fn(u),i=s):(dr=i,i=G)):(dr=i,i=G);r!==V?(e.substr(dr,2)===Bn?(i=Bn,dr+=2):(i=V,0===wr&&o(jn)),i!==V?(vr=t,n=In(r),t=n):(dr=t,t=G)):(dr=t,t=G)}else dr=t,t=G;return wr--,t===V&&(n=V,0===wr&&o(Dn)),t}function B(){var t,n,r,i,s,u;if(wr++,t=dr,e.substr(dr,2)===Rn?(n=Rn,dr+=2):(n=V,0===wr&&o(Un)),n!==V){for(r=[],i=dr,s=dr,wr++,e.substr(dr,2)===zn?(u=zn,dr+=2):(u=V,0===wr&&o(Wn)),wr--,u===V?s=et:(dr=s,s=G),s!==V?(e.length>dr?(u=e.charAt(dr),dr++):(u=V,0===wr&&o(xn)),u!==V?(vr=i,s=Tn(u),i=s):(dr=i,i=G)):(dr=i,i=G);i!==V;)r.push(i),i=dr,s=dr,wr++,e.substr(dr,2)===zn?(u=zn,dr+=2):(u=V,0===wr&&o(Wn)),wr--,u===V?s=et:(dr=s,s=G),s!==V?(e.length>dr?(u=e.charAt(dr),dr++):(u=V,0===wr&&o(xn)),u!==V?(vr=i,s=Tn(u),i=s):(dr=i,i=G)):(dr=i,i=G);r!==V?(e.substr(dr,2)===zn?(i=zn,dr+=2):(i=V,0===wr&&o(Wn)),i!==V?(vr=t,n=Xn(r),t=n):(dr=t,t=G)):(dr=t,t=G)}else dr=t,t=G;return wr--,t===V&&(n=V,0===wr&&o(qn)),t}function j(){var t,n,r,i,s,u,a,f,l,c;if(t=dr,n=F(),n!==V){for(r=[],i=z();i!==V;)r.push(i),i=z();if(r!==V)if(Vn.test(e.charAt(dr))?(i=e.charAt(dr),dr++):(i=V,0===wr&&o($n)),i!==V){for(s=[],u=z();u!==V;)s.push(u),u=z();if(s!==V){if(u=[],a=dr,f=dr,wr++,l=I(),wr--,l===V?f=et:(dr=f,f=G),f!==V?(l=dr,wr++,c=U(),wr--,c===V?l=et:(dr=l,l=G),l!==V?(e.length>dr?(c=e.charAt(dr),dr++):(c=V,0===wr&&o(xn)),c!==V?(f=[f,l,c],a=f):(dr=a,a=G)):(dr=a,a=G)):(dr=a,a=G),a!==V)for(;a!==V;)u.push(a),a=dr,f=dr,wr++,l=I(),wr--,l===V?f=et:(dr=f,f=G),f!==V?(l=dr,wr++,c=U(),wr--,c===V?l=et:(dr=l,l=G),l!==V?(e.length>dr?(c=e.charAt(dr),dr++):(c=V,0===wr&&o(xn)),c!==V?(f=[f,l,c],a=f):(dr=a,a=G)):(dr=a,a=G)):(dr=a,a=G);else u=G;if(u!==V){for(a=[],f=z();f!==V;)a.push(f),f=z();a!==V?(f=I(),f!==V?(n=[n,r,i,s,u,a,f],t=n):(dr=t,t=G)):(dr=t,t=G)}else dr=t,t=G}else dr=t,t=G}else dr=t,t=G;else dr=t,t=G}else dr=t,t=G;return t===V&&(t=g()),t}function F(){var t;return 123===e.charCodeAt(dr)?(t=Jn,dr++):(t=V,0===wr&&o(Kn)),t}function I(){var t;return 125===e.charCodeAt(dr)?(t=Qn,dr++):(t=V,0===wr&&o(Gn)),t}function q(){var t;return 91===e.charCodeAt(dr)?(t=Yn,dr++):(t=V,0===wr&&o(Zn)),t}function R(){var t;return 93===e.charCodeAt(dr)?(t=er,dr++):(t=V,0===wr&&o(tr)),t}function U(){var t;return 10===e.charCodeAt(dr)?(t=nr,dr++):(t=V,0===wr&&o(rr)),t===V&&(e.substr(dr,2)===ir?(t=ir,dr+=2):(t=V,0===wr&&o(sr)),t===V&&(13===e.charCodeAt(dr)?(t=or,dr++):(t=V,0===wr&&o(ur)),t===V&&(8232===e.charCodeAt(dr)?(t=ar,dr++):(t=V,0===wr&&o(fr)),t===V&&(8233===e.charCodeAt(dr)?(t=lr,dr++):(t=V,0===wr&&o(cr)))))),t}function z(){var t;return hr.test(e.charAt(dr))?(t=e.charAt(dr),dr++):(t=V,0===wr&&o(pr)),t===V&&(t=U()),t}var W,X=arguments.length>1?arguments[1]:{},V={},$={start:a},J=a,K=function(e){return["body"].concat(e).concat([["line",n()],["col",r()]])},Q={type:"other",description:"section"},G=V,Y=null,Z=function(e,t,n,r){return r&&e[1].text===r.text||i("Expected end tag for "+e[1].text+" but it was not found."),!0},et=void 0,tt=function(e,t,i){return i.push(["param",["literal","block"],t]),e.push(i),e.concat([["line",n()],["col",r()]])},nt="/",rt={type:"literal",value:"/",description:'"/"'},it=function(e){return e.push(["bodies"]),e.concat([["line",n()],["col",r()]])},st=/^[#?\^<+@%]/,ot={type:"class",value:"[#?\\^<+@%]",description:"[#?\\^<+@%]"},ut=function(e,t,n,r){return[e,t,n,r]},at={type:"other",description:"end tag"},ft=function(e){return e},lt=":",ct={type:"literal",value:":",description:'":"'},ht=function(e){return e},pt=function(e){return e?["context",e]:["context"]},dt={type:"other",description:"params"},vt="=",mt={type:"literal",value:"=",description:'"="'},gt=function(e,t){return["param",["literal",e],t]},yt=function(e){return["params"].concat(e)},bt={type:"other",description:"bodies"},wt=function(e){return["bodies"].concat(e)},Et={type:"other",description:"reference"},St=function(e,t){return["reference",e,t].concat([["line",n()],["col",r()]])},xt={type:"other",description:"partial"},Tt=">",Nt={type:"literal",value:">",description:'">"'},Ct="+",kt={type:"literal",value:"+",description:'"+"'},Lt=function(e){return["literal",e]},At=function(e,t,i,s){var o=">"===e?"partial":e;return[o,t,i,s].concat([["line",n()],["col",r()]])},Ot={type:"other",description:"filters"},Mt="|",_t={type:"literal",value:"|",description:'"|"'},Dt=function(e){return["filters"].concat(e)},Pt={type:"other",description:"special"},Ht="~",Bt={type:"literal",value:"~",description:'"~"'},jt=function(e){return["special",e].concat([["line",n()],["col",r()]])},Ft={type:"other",description:"identifier"},It=function(e){var t=["path"].concat(e);return t.text=e[1].join(".").replace(/,line,\d+,col,\d+/g,""),t},qt=function(e){var t=["key",e];return t.text=e,t},Rt={type:"other",description:"number"},Ut=function(e){return["literal",e]},zt={type:"other",description:"float"},Wt=".",Xt={type:"literal",value:".",description:'"."'},Vt=function(e,t){return parseFloat(e+"."+t.join(""))},$t={type:"other",description:"integer"},Jt=/^[0-9]/,Kt={type:"class",value:"[0-9]",description:"[0-9]"},Qt=function(e){return parseInt(e.join(""),10)},Gt={type:"other",description:"path"},Yt=function(e,t){return t=t[0],e&&t?(t.unshift(e),[!1,t].concat([["line",n()],["col",r()]])):[!0,t].concat([["line",n()],["col",r()]])},Zt=function(e){return e.length>0?[!0,e[0]].concat([["line",n()],["col",r()]]):[!0,[]].concat([["line",n()],["col",r()]])},en={type:"other",description:"key"},tn=/^[a-zA-Z_$]/,nn={type:"class",value:"[a-zA-Z_$]",description:"[a-zA-Z_$]"},rn=/^[0-9a-zA-Z_$\-]/,sn={type:"class",value:"[0-9a-zA-Z_$\\-]",description:"[0-9a-zA-Z_$\\-]"},on=function(e,t){return e+t.join("")},un={type:"other",description:"array"},an=function(e){return e.join("")},fn=function(e){return e},ln=function(e,t){return t?t.unshift(e):t=[e],t},cn={type:"other",description:"array_part"},hn=function(e){return e},pn=function(e,t){return t?e.concat(t):e},dn={type:"other",description:"inline"},vn='"',mn={type:"literal",value:'"',description:'"\\""'},gn=function(){return["literal",""].concat([["line",n()],["col",r()]])},yn=function(e){return["literal",e].concat([["line",n()],["col",r()]])},bn=function(e){return["body"].concat(e).concat([["line",n()],["col",r()]])},wn=function(e){return["buffer",e]},En={type:"other",description:"buffer"},Sn=function(e,t){return["format",e,t.join("")].concat([["line",n()],["col",r()]])},xn={type:"any",description:"any character"},Tn=function(e){return e},Nn=function(e){return["buffer",e.join("")].concat([["line",n()],["col",r()]])},Cn={type:"other",description:"literal"},kn=/^[^"]/,Ln={type:"class",value:'[^"]',description:'[^"]'},An=function(e){return e.join("")},On='\\"',Mn={type:"literal",value:'\\"',description:'"\\\\\\""'},_n=function(){return'"'},Dn={type:"other",description:"raw"},Pn="{`",Hn={type:"literal",value:"{`",description:'"{`"'},Bn="`}",jn={type:"literal",value:"`}",description:'"`}"'},Fn=function(e){return e},In=function(e){return["raw",e.join("")].concat([["line",n()],["col",r()]])},qn={type:"other",description:"comment"},Rn="{!",Un={type:"literal",value:"{!",description:'"{!"'},zn="!}",Wn={type:"literal",value:"!}",description:'"!}"'},Xn=function(e){return["comment",e.join("")].concat([["line",n()],["col",r()]])},Vn=/^[#?\^><+%:@\/~%]/,$n={type:"class",value:"[#?\\^><+%:@\\/~%]",description:"[#?\\^><+%:@\\/~%]"},Jn="{",Kn={type:"literal",value:"{",description:'"{"'},Qn="}",Gn={type:"literal",value:"}",description:'"}"'},Yn="[",Zn={type:"literal",value:"[",description:'"["'},er="]",tr={type:"literal",value:"]",description:'"]"'},nr="\n",rr={type:"literal",value:"\n",description:'"\\n"'},ir="\r\n",sr={type:"literal",value:"\r\n",description:'"\\r\\n"'},or="\r",ur={type:"literal",value:"\r",description:'"\\r"'},ar="\u2028",fr={type:"literal",value:"\u2028",description:'"\\u2028"'},lr="\u2029",cr={type:"literal",value:"\u2029",description:'"\\u2029"'},hr=/^[\t\x0B\f \xA0\uFEFF]/,pr={type:"class",value:"[\\t\\x0B\\f \\xA0\\uFEFF]",description:"[\\t\\x0B\\f \\xA0\\uFEFF]"},dr=0,vr=0,mr=0,gr={line:1,column:1,seenCR:!1},yr=0,br=[],wr=0;if("startRule"in X){if(!(X.startRule in $))throw new Error("Can't start parsing from rule \""+X.startRule+'".');J=$[X.startRule]}if(W=J(),W!==V&&dr===e.length)return W;throw W!==V&&dr<e.length&&o({type:"end",description:"end of input"}),u(null,br,yr)}return e(t,Error),{SyntaxError:t,parse:n}}();return e.parse=t.parse,t}),function(e,t){"object"==typeof exports?module.exports=t(require("./parser").parse,require("./dust")):t(e.dust.parse,e.dust)}(this,function(e,t){function n(e){var t={};return v.filterNode(t,e)}function r(e,t){var n,r,i,s=[t[0]];for(n=1,r=t.length;r>n;n++)i=v.filterNode(e,t[n]),i&&s.push(i);return s}function i(e,t){var n,r,i,s,o=[t[0]];for(r=1,i=t.length;i>r;r++)s=v.filterNode(e,t[r]),s&&("buffer"===s[0]||"format"===s[0]?n?(n[0]="buffer"===s[0]?"buffer":n[0],n[1]+=s.slice(1,-2).join("")):(n=s,o.push(s)):(n=null,o.push(s)));return o}function s(e,t){return["buffer",g[t[1]],t[2],t[3]]}function o(e,t){return t}function u(){}function a(e,n){return t.config.whitespace?n:null}function f(e,t){var n={name:t,bodies:[],blocks:{},index:0,auto:"h"};return"(function(){dust.register("+(t?'"'+t+'"':"null")+","+v.compileNode(n,e)+");"+l(n)+c(n)+"return body_0;})();"}function l(e){var t,n=[],r=e.blocks;for(t in r)n.push('"'+t+'":'+r[t]);return n.length?(e.blocks="ctx=ctx.shiftBlocks(blocks);","var blocks={"+n.join(",")+"};"):e.blocks=""}function c(e){var t,n,r=[],i=e.bodies,s=e.blocks;for(t=0,n=i.length;n>t;t++)r[t]="function body_"+t+"(chk,ctx){"+s+"return chk"+i[t]+";}body_"+t+".__dustBody=!0;";return r.join("")}function h(e,t){var n,r,i="";for(n=1,r=t.length;r>n;n++)i+=v.compileNode(e,t[n]);return i}function p(e,n,r){return"."+(t._aliases[r]||r)+"("+v.compileNode(e,n[1])+","+v.compileNode(e,n[2])+","+v.compileNode(e,n[4])+","+v.compileNode(e,n[3])+")"}function d(e){return e.replace(y,"\\\\").replace(b,'\\"').replace(w,"\\f").replace(E,"\\n").replace(S,"\\r").replace(x,"\\t")}var v={},m=t.isArray;v.compile=function(t,r){if(!r&&null!==r)throw new Error("Template name parameter cannot be undefined when calling dust.compile");try{var i=n(e(t));return f(i,r)}catch(s){throw!s.line||!s.column?s:new SyntaxError(s.message+" At line : "+s.line+", column : "+s.column)}},v.filterNode=function(e,t){return v.optimizers[t[0]](e,t)},v.optimizers={body:i,buffer:o,special:s,format:a,reference:r,"#":r,"?":r,"^":r,"<":r,"+":r,"@":r,"%":r,partial:r,context:r,params:r,bodies:r,param:r,filters:o,key:o,path:o,literal:o,raw:o,comment:u,line:u,col:u},v.pragmas={esc:function(e,t,n){var r,i=e.auto;return t||(t="h"),e.auto="s"===t?"":t,r=h(e,n.block),e.auto=i,r}};var g={s:" ",n:"\n",r:"\r",lb:"{",rb:"}"};v.compileNode=function(e,t){return v.nodes[t[0]](e,t)},v.nodes={body:function(e,t){var n=e.index++,r="body_"+n;return e.bodies[n]=h(e,t),r},buffer:function(e,t){return".w("+T(t[1])+")"},format:function(e,t){return".w("+T(t[1]+t[2])+")"},reference:function(e,t){return".f("+v.compileNode(e,t[1])+",ctx,"+v.compileNode(e,t[2])+")"},"#":function(e,t){return p(e,t,"section")},"?":function(e,t){return p(e,t,"exists")},"^":function(e,t){return p(e,t,"notexists")},"<":function(e,t){for(var n=t[4],r=1,i=n.length;i>r;r++){var s=n[r],o=s[1][1];if("block"===o)return e.blocks[t[1].text]=v.compileNode(e,s[2]),""}return""},"+":function(e,t){return"undefined"==typeof t[1].text&&"undefined"==typeof t[4]?".block(ctx.getBlock("+v.compileNode(e,t[1])+",chk, ctx),"+v.compileNode(e,t[2])+", {},"+v.compileNode(e,t[3])+")":".block(ctx.getBlock("+T(t[1].text)+"),"+v.compileNode(e,t[2])+","+v.compileNode(e,t[4])+","+v.compileNode(e,t[3])+")"},"@":function(e,t){return".h("+T(t[1].text)+","+v.compileNode(e,t[2])+","+v.compileNode(e,t[4])+","+v.compileNode(e,t[3])+")"},"%":function(e,t){var n,r,i,s,o,u,a,f,l,c=t[1][1];if(!v.pragmas[c])return"";for(n=t[4],r={},f=1,l=n.length;l>f;f++)u=n[f],r[u[1][1]]=u[2];for(i=t[3],s={},f=1,l=i.length;l>f;f++)a=i[f],s[a[1][1]]=a[2][1];return o=t[2][1]?t[2][1].text:null,v.pragmas[c](e,o,r,s)},partial:function(e,t){return".p("+v.compileNode(e,t[1])+","+v.compileNode(e,t[2])+","+v.compileNode(e,t[3])+")"},context:function(e,t){return t[1]?"ctx.rebase("+v.compileNode(e,t[1])+")":"ctx"},params:function(e,t){for(var n=[],r=1,i=t.length;i>r;r++)n.push(v.compileNode(e,t[r]));return n.length?"{"+n.join(",")+"}":"{}"},bodies:function(e,t){for(var n=[],r=1,i=t.length;i>r;r++)n.push(v.compileNode(e,t[r]));return"{"+n.join(",")+"}"},param:function(e,t){return v.compileNode(e,t[1])+":"+v.compileNode(e,t[2])},filters:function(e,t){for(var n=[],r=1,i=t.length;i>r;r++){var s=t[r];n.push('"'+s+'"')}return'"'+e.auto+'"'+(n.length?",["+n.join(",")+"]":"")},key:function(e,t){return'ctx.get(["'+t[1]+'"], false)'},path:function(e,t){for(var n=t[1],r=t[2],i=[],s=0,o=r.length;o>s;s++)i.push(m(r[s])?v.compileNode(e,r[s]):'"'+r[s]+'"');return"ctx.getPath("+n+", ["+i.join(",")+"])"},literal:function(e,t){return T(t[1])},raw:function(e,t){return".w("+T(t[1])+")"}};var y=/\\/g,b=/"/g,w=/\f/g,E=/\n/g,S=/\r/g,x=/\t/g,T="undefined"==typeof JSON?function(e){return'"'+d(e)+'"'}:JSON.stringify;return t.compile=v.compile,t.filterNode=v.filterNode,t.optimizers=v.optimizers,t.pragmas=v.pragmas,t.compileNode=v.compileNode,t.nodes=v.nodes,v}),define("dust",function(){}),!function(dust){function _deprecated(e){_deprecatedCache[e]||(_log("Deprecation warning: "+e+" is deprecated and will be removed in a future version of dustjs-helpers","WARN"),_log("For help and a deprecation timeline, see https://github.com/linkedin/dustjs-helpers/wiki/Deprecated-Features#"+e.replace(/\W+/g,""),"WARN"),_deprecatedCache[e]=!0)}function isSelect(e){var t=e.current();return"object"==typeof t&&t.isSelect===!0}function jsonFilter(e,t){return"function"==typeof t?t.toString().replace(/(^\s+|\s+$)/gm,"").replace(/\n/gm,"").replace(/,\s*/gm,", ").replace(/\)\{/gm,") {"):t}function filter(e,t,n,r,i){r=r||{};var s,o,u=n.block,a=r.filterOpType||"";if(r.hasOwnProperty("key"))s=dust.helpers.tap(r.key,e,t);else{if(!isSelect(t))return _log("No key specified for filter in:"+a+" helper "),e;s=t.current().selectKey,t.current().isResolved&&(i=function(){return!1})}return o=dust.helpers.tap(r.value,e,t),i(coerce(o,r.type,t),coerce(s,r.type,t))?(isSelect(t)&&(t.current().isResolved=!0),u?e.render(u,t):(_log("No body specified for "+a+" helper "),e)):n["else"]?e.render(n["else"],t):e}function coerce(e,t,n){if("undefined"!=typeof e)switch(t||typeof e){case"number":return+e;case"string":return String(e);case"boolean":return e="false"===e?!1:e,Boolean(e);case"date":return new Date(e);case"context":return n.get(e)}return e}var _log=dust.log?function(e,t){t=t||"INFO",dust.log(e,t)}:function(){},_deprecatedCache={},helpers={tap:function(e,t,n){if("function"!=typeof e)return e;var r,i="";return r=t.tap(function(e){return i+=e,""}).render(e,n),t.untap(),r.constructor!==t.constructor?r:""===i?!1:i},sep:function(e,t,n){var r=n.block;return t.stack.index===t.stack.of-1?e:r?r(e,t):e},idx:function(e,t,n){var r=n.block;return _deprecated("{@idx}"),r?r(e,t.push(t.stack.index)):e},contextDump:function(e,t,n,r){var i,s=r||{},o=s.to||"output",u=s.key||"current";return o=dust.helpers.tap(o,e,t),u=dust.helpers.tap(u,e,t),i="full"===u?JSON.stringify(t.stack,jsonFilter,2):JSON.stringify(t.stack.head,jsonFilter,2),"console"===o?(_log(i),e):(i=i.replace(/</g,"\\u003c"),e.write(i))},"if":function(chunk,context,bodies,params){var body=bodies.block,skip=bodies["else"],cond;if(params&&params.cond){if(_deprecated("{@if}"),cond=dust.helpers.tap(params.cond,chunk,context),eval(cond))return body?chunk.render(bodies.block,context):(_log("Missing body block in the if helper!"),chunk);if(skip)return chunk.render(bodies["else"],context)}else _log("No condition given in the if helper!");return chunk},math:function(e,t,n,r){if(r&&"undefined"!=typeof r.key&&r.method){var i=r.key,s=r.method,o=r.operand,u=r.round,a=null;switch(i=dust.helpers.tap(i,e,t),o=dust.helpers.tap(o,e,t),s){case"mod":(0===o||o===0)&&_log("operand for divide operation is 0/-0: expect Nan!"),a=parseFloat(i)%parseFloat(o);break;case"add":a=parseFloat(i)+parseFloat(o);break;case"subtract":a=parseFloat(i)-parseFloat(o);break;case"multiply":a=parseFloat(i)*parseFloat(o);break;case"divide":(0===o||o===0)&&_log("operand for divide operation is 0/-0: expect Nan/Infinity!"),a=parseFloat(i)/parseFloat(o);break;case"ceil":a=Math.ceil(parseFloat(i));break;case"floor":a=Math.floor(parseFloat(i));break;case"round":a=Math.round(parseFloat(i));break;case"abs":a=Math.abs(parseFloat(i));break;default:_log("method passed is not supported")}return null!==a?(u&&(a=Math.round(a)),n&&n.block?e.render(n.block,t.push({isSelect:!0,isResolved:!1,selectKey:a})):e.write(a)):e}return _log("Key is a required parameter for math helper along with method/operand!"),e},select:function(e,t,n,r){var i=n.block;if(r&&"undefined"!=typeof r.key){var s=dust.helpers.tap(r.key,e,t);return i?e.render(n.block,t.push({isSelect:!0,isResolved:!1,selectKey:s})):(_log("Missing body block in the select helper "),e)}return _log("No key given in the select helper!"),e},eq:function(e,t,n,r){return r?(r.filterOpType="eq",filter(e,t,n,r,function(e,t){return t===e})):e},ne:function(e,t,n,r){return r?(r.filterOpType="ne",filter(e,t,n,r,function(e,t){return t!==e})):e},lt:function(e,t,n,r){return r?(r.filterOpType="lt",filter(e,t,n,r,function(e,t){return e>t})):e},lte:function(e,t,n,r){return r?(r.filterOpType="lte",filter(e,t,n,r,function(e,t){return e>=t})):e},gt:function(e,t,n,r){return r?(r.filterOpType="gt",filter(e,t,n,r,function(e,t){return t>e})):e},gte:function(e,t,n,r){return r?(r.filterOpType="gte",filter(e,t,n,r,function(e,t){return t>=e})):e},"default":function(e,t,n,r){return r&&(r.filterOpType="default"),filter(e,t,n,r,function(){return!0})},size:function(e,t,n,r){var i,s,o,u=0;if(r=r||{},i=r.key,i&&i!==!0)if(dust.isArray(i))u=i.length;else if(!isNaN(parseFloat(i))&&isFinite(i))u=i;else if("object"==typeof i){s=0;for(o in i)Object.hasOwnProperty.call(i,o)&&s++;u=s}else u=(i+"").length;else u=0;return e.write(u)}};for(var key in helpers)dust.helpers[key]=helpers[key];"undefined"!=typeof exports&&(module.exports=dust)}("undefined"!=typeof exports?require("dustjs-linkedin"):dust),define("dust-helpers",["dust"],function(){}),!function(){function e(e,t){return e.write('<div class="tt-gallery-prev disabled gallery-prev"><i class="fa fa-chevron-left fa-3x"></i></div><div class="tt-gallery-item gallery-item"></div><div class="tt-gallery-next disabled gallery-next"><i class="fa fa-chevron-right fa-3x next"></i></div><div class="tt-gallery-carousel gallery-carousel"><div class="tt-gallery-left gallery-left"><i class="fa fa-chevron-left fa-2x"></i></div><div class="tt-gallery-thumbs gallery-thumbs"><div><ul></ul></div> </div><div class="tt-gallery-right gallery-right"><i class="fa fa-chevron-right fa-2x right"></i></div><div class="clear"></div></div><div class="tt-gallery-action gallery-action"><a title="Cut" data-action="4"><i class="fa fa-scissors fa-2x"></i></a><a title="Interpret" data-action="3"><i class="fa fa-video-camera fa-2x"></i></a><a data-action="2"><i class="fa fa-expand fa-2x"></i></a><a data-action="1"><i class="fa fa-times fa-2x"></i></a></div>')}return dust.register("gallery_common",e),e}(),!function(){function e(e,t){return e.write('<div id="').reference(t.get(["identifier"],!1),t,"h").write('" class="tt-gallery-inline gallery-inner">').partial("gallery_common",t,null).write("</div>")}return dust.register("gallery_inline",e),e}(),!function(){function e(e,t){return e.write('<div id="').reference(t.get(["identifier"],!1),t,"h").write('" class="tt-gallery-background gallery-inner"></div><div id="').reference(t.get(["identifier"],!1),t,"h").write('" class="tt-gallery-preview gallery-inner">').partial("gallery_common",t,null).write("</div>")}return dust.register("gallery_preview",e),e}(),!function(){function e(e,n){return e.section(n.get(["media"],!1),n,{block:t},null)}function t(e,t){return e.write('<li data-mid="').reference(t.getPath(!1,["data","id"]),t,"h").write('">').exists(t.get(["can_edit"],!1),t,{block:n},null).write("<div>").exists(t.getPath(!1,["data","thumbnail_path"]),t,{block:r},null).write("</div> </li>")}function n(e,t){return e.write('<span class="gallery-thumb-remove" title="Remove" data-mid="').reference(t.getPath(!1,["data","id"]),t,"h").write('"><i class="fa fa-times-circle"></i></span>')}function r(e,t){return e.write('<img src="').helper("generateUrl",t,{},{path:t.getPath(!1,["data","thumbnail_path"])}).write('" />')}return dust.register("gallery_thumbnail",e),e}(),!function(){function e(e,n){return e.helper("select",n,{block:t},{key:n.getPath(!1,["media","type"])})}function t(e,t){return e.helper("eq",t,{block:n},{value:1}).helper("eq",t,{block:a},{value:2}).helper("eq",t,{block:l},{value:0}).helper("eq",t,{block:c},{value:9})}function n(e,t){return e.exists(t.getPath(!1,["media","is_interpretation"]),t,{block:r},null).write('<video class="tt-media-video"').exists(t.get(["enable_controls"],!1),t,{block:o},null).exists(t.getPath(!1,["media","thumbnail_path"]),t,{block:u},null).write('preload="none"><source src="').helper("generateUrl",t,{},{path:t.getPath(!1,["media","resource","web_path"])}).write('" /></video>')}function r(e,t){return e.write('<video class="tt-media-pip-video"').exists(t.get(["enable_controls"],!1),t,{block:i},null).exists(t.getPath(!1,["media","source","thumbnail_path"]),t,{block:s},null).write('preload="none"><source src="').helper("generateUrl",t,{},{path:t.getPath(!1,["media","source","resource","web_path"])}).write('" /></video>')}function i(e,t){return e.write(" controls ")}function s(e,t){return e.write(' poster="').helper("generateUrl",t,{},{path:t.getPath(!1,["media","source","thumbnail_path"])}).write('" ')}function o(e,t){return e.write(" controls ")}function u(e,t){return e.write(' poster="').helper("generateUrl",t,{},{path:t.getPath(!1,["media","thumbnail_path"])}).write('" ')}function a(e,t){return e.write('<audio class="tt-media-audio"').exists(t.get(["enable_controls"],!1),t,{block:f},null).write('><source src="').helper("generateUrl",t,{},{path:t.getPath(!1,["media","resource","web_path"])}).write('" /></audio>')}function f(e,t){return e.write(" controls")}function l(e,t){return e.write('<img class="img-responsive center-block tt-media-img" src="').helper("generateUrl",t,{},{path:t.getPath(!1,["media","resource","web_path"])}).write('" title="').reference(t.get(["title"],!1),t,"h").write('" alt="').reference(t.get(["title"],!1),t,"h").write('" />')}function c(e,t){return e.write('<div class="row"><div class="col-md-3 thumbnail text-center"><a href="').helper("generateUrl",t,{},{path:t.getPath(!1,["media","resource","web_path"])}).write('"><p><i class="fa fa-file fa-5x"></i></p><div>').reference(t.get(["title"],!1),t,"h").write("</div></a></div></div>")}return dust.register("media_element",e),e}(),!function(){function e(e,t){return e.write('<div class="modal fade my-files-selector-modal"><div class="modal-dialog" style="width: 80%;"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button><h4 class="modal-title">Select from My Files</h4></div><div class="modal-body"><div class="text-center"><i class="fa fa-spinner fa-4x fa-spin"></i></div></div><div class="modal-footer"><a class="btn btn-default" data-dismiss="modal"><i class="fa fa-times"></i> Cancel</a><a class="btn btn-primary my-files-selector-select-selected" disabled="disabled" data-loading-text="<i class=&quot;fa fa-spinner fa-spin&quot;></i> Downloading data..."><i class="fa fa-check"></i> Select</a></div></div></div></div>')}return dust.register("myFilesSelector",e),e}(),!function(){function e(e,t){return e.write('<div class="modal fade recorder-modal"><div class="modal-dialog modal-lg"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button><h4 class="modal-title">Recorder</h4></div><div class="modal-body"><div class="recorder-container-record"><ul class="nav nav-tabs" role="tablist"><li class="active"><a href=".recorder-normal" role="tab" data-toggle="tab">Normal</a></li><li><a href=".recorder-interp" role="tab" data-toggle="tab">Interpretation</a></li></ul><div class="tab-content" style="padding-top: 15px;"><div class="tab-pane active recorder-normal"><div class="tt-media-preview-title"><input class="recorder-normal-title" style="display: none;" type="text" value="" /></div><video class="recorder-normal-video" width="100%" preload="auto" muted="muted"><source src="" /></video></div><div class="tab-pane recorder-interp"><div style="border: 2px dashed #ccc; line-height: 200px; height: 200px; text-align: center; display: none;"><button class="btn btn-primary btn-lg recorder-interp-select">Select a video to interpret</button></div><div class="row"><div class="col-md-6"><video class="recorder-interp-video-p" style="display: none;" width="100%" preload="auto" muted="muted"><source src="" /></video></div><div class="col-md-6"><div class="tt-media-preview-title"><input class="recorder-interp-title" style="display: none;" type="text" value="" /></div><video class="recorder-interp-video-r" style="display: none;" width="100%" preload="auto" muted="muted"><source src="" /></video></div></div></div></div><div class="recorder-controls"></div></div><div class="recorder-container-upload" style="display: none;"><label>Uploading...</label><div class="progress"><div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;">0%</div></div></div></div></div></div></div>')}return dust.register("recorder",e),e}(),define("templates",["dust-helpers"],function(){}),Function.prototype.extend=function(e){for(var t in e)this[t]=e[t];this.prototype=Object.create(e.prototype),this.prototype.constructor=this},define("extra",function(){}),define("core/subscriber",["underscore"],function(){"use strict";var e=function(){this.subscriptions=[]};return e.prototype._dispatch=function(e,t){var n={type:e};_.isObject(t)&&!_.isArray(t)&&!_.isFunction(t)&&_.each(t,function(e,t,r){n[t]=e}),_.each(this.subscriptions[e],function(e,t,r){_.isFunction(e)&&e.call(this,n)},this)},e.prototype.subscribe=function(e,t){_.contains(this.subscriptions,e)||(this.subscriptions[e]=[]),_.contains(this.subscriptions[e],t)||this.subscriptions[e].push(t)},e.prototype.unsubscribe=function(e){_.each(this.subscriptions,function(t,n,r){if(_.contains(t,e)){var i=_.indexOf(t,e);t.splice(i,1)}})},e}),define("model/model",["core/subscriber","extra","underscore"],function(e){"use strict";var t=function(t){e.prototype.constructor.apply(this),t=t||{};if(!_.isObject(t)||_.isArray(t)||_.isFunction(t))throw new Error("data must be an object");this.data=t};return t.extend(e),t.Event={CHANGE:"eventChange"},t._stringToKeyPath=function(e){return e.split(".")},t.prototype._findKeyPath=function(e,n){var r=t._stringToKeyPath(n);while(r.length!==0){var i=r.shift();if(!_.has(e,i))return undefined;e=e[i]}return e},t.prototype._setKeyPath=function(e,n,r){var i=t._stringToKeyPath(n);while(i.length>1){var s=i.shift();_.has(e,s)?e=e[s]:e[s]={}}e[i.shift()]=r},t.prototype._dispatch=function(t,n,r){r=_.extend(r||{},{keyPath:n,model:this}),e.prototype._dispatch.call(this,t,r)},t.prototype.get=function(e,t){var n=this._findKeyPath(this.data,e);return typeof n!="undefined"?n:t},t.prototype.set=function(e,n,r){r=typeof r!="undefined"?r:!0;var i=this._findKeyPath(this.data,e);this._setKeyPath(this.data,e,n),r&&i!==n&&this._dispatch(t.Event.CHANGE,e)},t.prototype.update=function(e,t){_.each(e,function(e,n,r){var i=t?t+"."+n:n;_.isObject(e)||_.isArray(e)?(console.log("update: "+i),this.update(e,i)):(console.log("set: "+i),this.set(i,e))},this)},t.prototype.forceChange=function(e){e=typeof e!="undefined"?e:"",this._dispatch(t.Event.CHANGE,e)},t}),define("model/mediaModel",["model/model","extra"],function(e){"use strict";var t=function(t){e.prototype.constructor.apply(this,arguments)};return t.extend(e),t}),define("factory/mediaFactory",["model/mediaModel"],function(e){"use strict";var t={};return t.list=function(t){var n=$.Deferred(),r={url:Routing.generate("imdc_media_list"),data:{}};return t&&(r.data.id=t.join()),$.ajax(r).then(function(t,r,i){t.media.forEach(function(t,n,r){r[n]=new e(t)}),n.resolve(t)},function(e,t,r){console.log(e.responseText),n.reject()}),n.promise()},t.edit=function(e){var t=$.Deferred(),n={url:Routing.generate("imdc_media_edit",{mediaId:e.get("id")}),type:"POST",data:{media:JSON.stringify(e.data)}};return $.ajax(n).then(function(n,r,i){n.responseCode==200?(e.update(n.media),t.resolve(n)):(console.error(n.feedback),t.reject(n))},function(e,n,r){console.log(e.responseText),t.reject()}),t.promise()},t.delete=function(e,t){var n=$.Deferred(),r={url:Routing.generate("imdc_media_delete",{mediaId:e.get("id")}),type:"POST",data:{confirm:t||!1}};return $.ajax(r).then(function(e,t,r){if(e.responseCode==200)n.resolve(e);else{console.error(e.feedback);var i=[];e.mediaInUse.forEach(function(e,t,n){i.push(Translator.trans("filesGateway.deleteMediaInUseConfirmation."+e))}),e.confirmText=Translator.trans("filesGateway.deleteMediaInUseConfirmation.finalMessage",{mediaUsedLocations:i.join(", ")}),n.reject(e)}},function(e,t,r){console.log(e.responseText),n.reject()}),n.promise()},t.trim=function(t,n,r){var i=$.Deferred(),s={url:Routing.generate("imdc_media_trim",{mediaId:t.get("id")}),type:"POST",data:{startTime:n,endTime:r}};return $.ajax(s).then(function(n,r,s){n.responseCode==200?(t=new e(n.media),i.resolve(n)):(console.error(n.feedback),i.reject(n))},function(e,t,n){console.log(e.responseText),i.reject()}),i.promise()},t}),define("factory/myFilesFactory",["model/mediaModel"],function(e){"use strict";var t={};return t._prepForFormPost=function(e,t,n){t.type="POST",t.contentType=!1,e&&(t.data=new FormData(e)),t.processData=!1,t.xhr=function(){var e=$.ajaxSettings.xhr();return e.upload.addEventListener("progress",function(e){e.lengthComputable&&n.notify(Math.floor(e.loaded/e.total*100))},!1),e}},t.addRecording=function(n,r,i){var s=new FormData,o=!!navigator.mozGetUserMedia,u=$.Deferred(),a={url:Routing.generate("imdc_myfiles_add_recording")};return s.append("isFirefox",o),o||s.append("video-blob",n),s.append("audio-blob",r),i&&(s.append("isInterpretation",!0),s.append("sourceStartTime",i.sourceStartTime),s.append("sourceId",i.sourceId)),t._prepForFormPost(null,a,u),a.data=s,$.ajax(a).then(function(t,n,r){t.responseCode==200?(t.media=new e(t.media),u.resolve(t)):u.reject(t)},function(e,t,n){console.log(e.responseText),u.reject()}),u.promise()},t.add=function(n){var r=$.Deferred(),i={url:Routing.generate("imdc_myfiles_add")};return t._prepForFormPost(n,i,r),$.ajax(i).then(function(t,n,i){t.wasUploaded?(t.media=new e(t.media),r.resolve(t)):(console.error(t.error),r.reject(t))},function(e,t,n){console.log(e.responseText),r.reject()}),r.promise()},t}),define("service",["require"],function(e){"use strict";var t=function(){};return t.get=function(t){if(!$tt._services[t]){var n=e("service/"+t+"Service");$tt._services[t]=new n}return $tt._services[t]},t}),define("component/tableComponent",["core/subscriber","extra"],function(e){"use strict";var t=function(n){e.prototype.constructor.apply(this),this.options=n,this.bind__onClickToggleSelection=this._onClickToggleSelection.bind(this),this.bind__onClickBulkAction=this._onClickBulkAction.bind(this),this.bind__onChangeItems=this._onChangeItems.bind(this),this.$table=this.options.$table,this.$toggleSelection=this.$table.find(t.Binder.TOGGLE_SELECTION),this.$bulkActions=this.$table.find(t.Binder.BULK_ACTION),this.$items=this.$table.find(t.Binder.ITEM),this.setMultiSelect(this.options.multiSelect),this.$toggleSelection.on("click",this.bind__onClickToggleSelection),this.$bulkActions.on("click",this.bind__onClickBulkAction),this.$items.on("change",this.bind__onChangeItems)};return t.extend(e),t.TAG="TableComponent",t.Binder={TOGGLE_SELECTION:".table-component-toggle-selection",BULK_ACTION:".table-component-bulk-action",ITEM:"input.table-component-item:not([disabled])"},t.Event={SELECTION_CHANGE:"eventSelectionChange",CLICK_BULK_ACTION:"eventClickBulkAction"},t.prototype._dispatchToggleEvent=function(e){var n=this.getSelection();this._dispatch(t.Event.SELECTION_CHANGE,{$selection:n,tableComponent:this,parentEvent:e})},t.prototype._onClickToggleSelection=function(e){this.$items.prop("checked",$(e.target).is('input[type="checkbox"]')?e.target.checked:this.getSelection().length==0),this._dispatchToggleEvent(e)},t.prototype._onClickBulkAction=function(e){var n=$(e.currentTarget);this._dispatch(t.Event.CLICK_BULK_ACTION,{$bulkAction:n,action:n.data("action"),$selection:this.getSelection(),tableComponent:this,parentEvent:e})},t.prototype._onChangeItems=function(e){var n=e.target.checked;this.options.multiSelect||this.$items.prop("checked",!1),e.target.checked=n;var r=this.getSelection();this._dispatch(t.Event.SELECTION_CHANGE,{$selection:r,tableComponent:this,parentEvent:e});var i=r.length==this.$items.length;this.$toggleSelection.prop("checked",i),i&&this._dispatchToggleEvent(e)},t.prototype.setMultiSelect=function(e){this.options.multiSelect=e,this.$toggleSelection.attr("disabled",!this.options.multiSelect)},t.prototype.getTable=function(){return this.$table},t.prototype.getBulkActions=function(){return this.$bulkActions},t.prototype.getSelection=function(){return this.$items.filter(":checked")},t.table=function(e,n){var r={multiSelect:!0};n=n||r;for(var i in r)n[i]=typeof n[i]!="undefined"?n[i]:r[i];return n.$table=e,new t(n)},t}),define("component/myFilesSelectorComponent",["core/subscriber","service","component/tableComponent","factory/mediaFactory","extra"],function(e,t,n,r){"use strict";var i=function(n){e.prototype.constructor.apply(this),this.options=n,this.bind__onShownModal=this._onShownModal.bind(this),this.bind__onHiddenModal=this._onHiddenModal.bind(this),this.bind__onLoadPageSuccess=this._onLoadPageSuccess.bind(this),this.bind__onLoadPageError=this._onLoadPageError.bind(this),this.bind__onClickSelectSelected=this._onClickSelectSelected.bind(this),this.bind__onMyFilesListViewViewLoaded=this._onMyFilesListViewViewLoaded.bind(this),this.bind__onSelectionChange=this._onSelectionChange.bind(this),this.$container=this.options.$container,this.$modalDialog=this.$container.find(i.Binder.MODAL_DIALOG),this.$selectSelected=this.$container.find(i.Binder.SELECT_SELECTED),this.$modalDialog.modal({backdrop:"static",show:!1}),this.$modalDialog.on("shown.bs.modal",this.bind__onShownModal),this.$modalDialog.on("hidden.bs.modal",this.bind__onHiddenModal),this.$selectSelected.on("click",this.bind__onClickSelectSelected);var r=t.get("subscriber");r.subscribe("onViewLoaded",this.bind__onMyFilesListViewViewLoaded)};return i.extend(e),i.TAG="MyFilesSelectorComponent",i.Binder={MODAL_DIALOG:".my-files-selector-modal",SELECT_SELECTED:".my-files-selector-select-selected"},i.Event={DONE:"eventDone",HIDDEN:"eventHidden"},i.prototype._onSelectionChange=function(e){this.$selectSelected.attr("disabled",e.$selection.length==0)},i.prototype._onMyFilesListViewViewLoaded=function(e){var t=require("views/myFiles/listView");if(e.tag!==t.TAG)return;this.tblCmp=e.view.getTableComponent(),this.tblCmp.setMultiSelect(this.options.multiSelect),this.tblCmp.subscribe(n.Event.SELECTION_CHANGE,this.bind__onSelectionChange);var r=function(e){e.preventDefault(),this._loadPage($(e.currentTarget).attr("href"))}.bind(this);this.$modalDialog.find(t.Binder.TOGGLE_STYLE).on("click",r),this.$modalDialog.find("ul.pagination li a").on("click",r)},i.prototype._onLoadPageSuccess=function(e,t,n){this.$modalDialog.find(".modal-body").html(e.page)},i.prototype._onLoadPageError=function(e,t,n){console.log(e)},i.prototype._makeUrl=function(e){if(typeof e=="undefined")return Routing.generate("imdc_myfiles_list",this.options.filter);for(var t in this.filter)e+=(e.substr("?")?"&":"?")+t+"="+this.options.filter[t];return e},i.prototype._loadPage=function(e){$.ajax({url:this._makeUrl(e),success:this.bind__onLoadPageSuccess,error:this.bind__onLoadPageError})},i.prototype._onShownModal=function(e){this._loadPage()},i.prototype._onHiddenModal=function(e){this._dispatch(i.Event.HIDDEN,{myFilesSelectorComponent:this})},i.prototype._onClickSelectSelected=function(e){e.preventDefault(),this.$selectSelected.button("loading");var t=this.tblCmp.getSelection(),n=[];this.options.multiSelect?t.each(function(e,t){n.push($(t).data("mid"))}):n.push(t.first().data("mid")),r.list(n).done(function(e){this._dispatch(i.Event.DONE,{media:e.media,myFilesSelectorComponent:this})}.bind(this)).fail(function(){this.$selectSelected.button("reset"),console.error("%s: media factory list",i.TAG)}.bind(this))},i.prototype.show=function(){this.$modalDialog.modal("show")},i.prototype.hide=function(){this.$modalDialog.modal("hide")},i.prototype.destroy=function(){this.$modalDialog.remove()},i.render=function(e,t){var n={$container:$("body"),multiSelect:!0,filter:{}};e=e||n;for(var r in n)e[r]=typeof e[r]!="undefined"?e[r]:n[r];dust.render("myFilesSelector",{},function(n,r){e.$container.append(r);var s=new i(e);t.call(s,{myFilesSelectorComponent:s})})},i}),define("core/helper",[],function(){"use strict";var e=function(){};return e.TAG="Helper",e.isFullscreen=function(){return document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement?!0:!1},e.toggleFullScreen=function(t){console.log("%s: %s",e.TAG,"toggleFullScreen");var n=t[0];e.isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen():n.requestFullscreen?n.requestFullscreen():n.mozRequestFullScreen?n.mozRequestFullScreen():n.webkitRequestFullscreen?n.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT):n.msRequestFullscreen&&n.msRequestFullscreen()},e.updateProgressBar=function(e,t){var n=e.find(".progress-bar");n.attr("aria-valuenow",t),n.css("width",t+"%"),n.html(t+"%")},e.generateUrl=function(e,t){t=typeof t!="undefined"?t:!1;var n=Routing.getBaseUrl()+"/";return t?n+e:n.replace(/\w+\.php\/$/gi,"")+e},e.autoSize=function(){$(".autosize").autosize({append:""})},e}),define("component/recorderComponent",["core/subscriber","component/myFilesSelectorComponent","model/mediaModel","factory/mediaFactory","core/helper","extra"],function(e,t,n,r,i){"use strict";var s=function(t){e.prototype.constructor.apply(this),this.options=t,this.player=null,this.recorder=null,this.sourceMedia=null,this.recordedMedia=null,this.forwardButton='<button class="forwardButton"></button>',this.doneButton='<button class="doneButton"></button>',this.doneAndPostButton='<button class="doneAndPostButton"></button>',this.backButton='<button class="backButton"></button>',this.bind__onShownModal=this._onShownModal.bind(this),this.bind__onHiddenModal=this._onHiddenModal.bind(this),this.bind__onShowTab=this._onShowTab.bind(this),this.bind__onShownTab=this._onShownTab.bind(this),this.bind__onBlurPlayerTitle=this._onBlurPlayerTitle.bind(this),this.bind__onClickInterpSelect=this._onClickInterpSelect.bind(this),this.bind__onPageAnimate=this._onPageAnimate.bind(this),this.bind__onRecordingStarted=this._onRecordingStarted.bind(this),this.bind__onRecordingStopped=this._onRecordingStopped.bind(this),this.bind__onRecordingUploadProgress=this._onRecordingUploadProgress.bind(this),this.bind__onRecordingUploaded=this._onRecordingUploaded.bind(this),this.bind__onRecordingSuccess=this._onRecordingSuccess.bind(this),this.bind__onRecordingError=this._onRecordingError.bind(this),this.bind__preview=this._preview.bind(this),this.bind__cut=this._cut.bind(this),this.bind__back=this._back.bind(this),this.bind__done=this._done.bind(this),this.bind__doneAndPost=this._doneAndPost.bind(this),this.$container=this.options.$container,this.$modalDialog=this.$container.find(s.Binder.MODAL_DIALOG),this.$tabPanes=this.$container.find(s.Binder.TAB_PANES),this.$normalTitle=this.$container.find(s.Binder.NORMAL_TITLE),this.$normalVideo=this.$container.find(s.Binder.NORMAL_VIDEO),this.$interpSelect=this.$container.find(s.Binder.INTERP_SELECT),this.$interpVideoP=this.$container.find(s.Binder.INTERP_VIDEO_P),this.$interpTitle=this.$container.find(s.Binder.INTERP_TITLE),this.$interpVideoR=this.$container.find(s.Binder.INTERP_VIDEO_R),this.$controls=this.$container.find(s.Binder.CONTROLS);var n=this.options.tab==s.Tab.NORMAL?s.Binder.NORMAL:s.Binder.INTERP;this.$modalDialog.find('a[href!="'+n+'"]').parent().removeClass("active"),this.$modalDialog.find('a[href="'+n+'"]').parent().addClass("active"),this.$modalDialog.find('.tab-pane:not("'+n+'")').removeClass("active"),this.$modalDialog.find(".tab-pane"+n).addClass("active"),this.$modalDialog.modal({backdrop:"static",show:!1}),this.$modalDialog.on("shown.bs.modal",this.bind__onShownModal),this.$modalDialog.on("hidden.bs.modal",this.bind__onHiddenModal),this.$tabPanes.on("show.bs.tab",this.bind__onShowTab),this.$tabPanes.on("shown.bs.tab",this.bind__onShownTab),this.$normalTitle.blur(this.bind__onBlurPlayerTitle),this.$interpSelect.on("click",this.bind__onClickInterpSelect),this.$interpTitle.blur(this.bind__onBlurPlayerTitle),this.options.mode==s.Mode.PREVIEW&&this.$modalDialog.find('a[href="'+s.Binder.INTERP+'"]').hide()};return s.extend(e),s.TAG="RecorderComponent",s.MAX_RECORDING_TIME=720,s.Binder={MODAL_DIALOG:".recorder-modal",TAB_PANES:'a[data-toggle="tab"]',NORMAL:".recorder-normal",INTERP:".recorder-interp",CONTAINER_RECORD:".recorder-container-record",NORMAL_TITLE:".recorder-normal-title",NORMAL_VIDEO:".recorder-normal-video",INTERP_SELECT:".recorder-interp-select",INTERP_MY_FILES_SELECTOR:".recorder-interp-my-files-selector",INTERP_VIDEO_P:".recorder-interp-video-p",INTERP_TITLE:".recorder-interp-title",INTERP_VIDEO_R:".recorder-interp-video-r",CONTROLS:".recorder-controls",CONTAINER_UPLOAD:".recorder-container-upload"},s.Tab={NORMAL:0,INTERPRETATION:1},s.Mode={RECORD:0,PREVIEW:1},s.Event={DONE:"eventDone",HIDDEN:"eventHidden"},s.prototype._createPlayer=function(e){console.log("%s: %s",s.TAG,"_createPlayer"),e=typeof e!="undefined"?e:!1;var t=[],n=[];if(this.options.tab==s.Tab.NORMAL||e)t.push(this.doneButton),n.push(e?this.bind__cut:this.bind__done);this.options.enableDoneAndPost&&e&&(t.push(this.doneAndPostButton),n.push(this.bind__doneAndPost));var r,i;e&&this.wasRecording&&(r=[this.backButton],i=[this.bind__back]);var o=this.options.tab==s.Tab.NORMAL?this.$normalVideo:e?this.$interpVideoR:this.$interpVideoP,u=new Player(o,{areaSelectionEnabled:e,audioBar:!1,updateTimeType:Player.DENSITY_BAR_UPDATE_TYPE_RELATIVE,controlBarElement:this.$controls,forwardButtons:t,forwardFunctions:n,backButtons:r,backFunctions:i,selectedRegionColor:"#0000ff"});u.createControls(),$(u.elementID).find(".videoControlsContainer.controlsBar.doneButton").eq(0).attr("title",Translator.trans("player.previewing.doneButton")),$(u.elementID).find(".videoControlsContainer.controlsBar.doneAndPostButton").eq(0).attr("title",Translator.trans("player.previewing.doneAndPostButton")),$(u.elementID).find(".videoControlsContainer.controlsBar.backButton").eq(0).attr("title",Translator.trans("player.previewing.backToRecordingButton")),e?this.recorder=u:this.player=u},s.prototype._cut=function(e){console.log("%s: %s",s.TAG,"_cut"),e.preventDefault();var t=this.recorder.getCurrentMinMaxTime(),n=this.recorder.getAreaSelectionTimes();this.recorder.setCurrentMinMaxTime(n.minTime,n.maxTime),console.log("Current Min/Max Times %s %s",n.minTime,n.maxTime),console.log("Cutting to Min/Max Times %s %s",n.minTime-t.minTime,n.maxTime-t.minTime),r.trim(this.recordedMedia,n.minTime-t.minTime,n.maxTime-t.minTime),this._done(e)},s.prototype._back=function(e){console.log("%s: %s",s.TAG,"_back"),e.preventDefault(),this._destroyPlayers(),r.delete(this.recordedMedia),this.setRecordedMedia(null),this.wasRecording=!1,this.options.mode=s.Mode.RECORD,this.options.tab==s.Tab.INTERPRETATION&&this._createPlayer(),this._createRecorder()},s.prototype._createRecorder=function(){console.log("%s: %s",s.TAG,"_createRecorder");var e=[this.forwardButton,this.doneButton],t=[this.bind__preview,this.bind__done];this.options.enableDoneAndPost&&(e.push(this.doneAndPostButton),t.push(this.bind__doneAndPost));var n,r={};this.options.tab==s.Tab.NORMAL?n=this.$normalVideo:(n=this.$interpVideoR,r={isInterpretation:!0,sourceId:this.sourceMedia.get("id")}),this.recorder=new Player(n,{areaSelectionEnabled:!1,audioBar:!1,updateTimeType:Player.DENSITY_BAR_UPDATE_TYPE_ABSOLUTE,controlBarElement:this.$controls,type:Player.DENSITY_BAR_TYPE_RECORDER,volumeControl:!1,maxRecordingTime:s.MAX_RECORDING_TIME,recordingSuccessFunction:this.bind__onRecordingSuccess,recordingErrorFunction:this.bind__onRecordingError,recordingPostURL:Routing.generate("imdc_myfiles_add_recording"),additionalDataToPost:r,forwardButtons:e,forwardFunctions:t}),this.options.tab==s.Tab.INTERPRETATION&&($(this.recorder).on(Player.EVENT_RECORDING_STARTED,this.bind__onRecordingStarted),$(this.recorder).on(Player.EVENT_RECORDING_STOPPED,this.bind__onRecordingStopped)),$(this.recorder).on(Player.EVENT_RECORDING_UPLOAD_PROGRESS,this.bind__onRecordingUploadProgress),$(this.recorder).on(Player.EVENT_RECORDING_UPLOADED,this.bind__onRecordingUploaded),this.recorder.createControls(),$(this.recorder.elementID).find(".videoControlsContainer.controlsBar.videoControls.recordButton").eq(0).attr("title",Translator.trans("player.recording.recordingButton")),$(this.recorder.elementID).find(".videoControlsContainer.controlsBar.forwardButton").eq(0).attr("title",Translator.trans("player.recording.forwardButton")),$(this.recorder.elementID).find(".videoControlsContainer.controlsBar.doneButton").eq(0).attr("title",Translator.trans("player.recording.doneButton")),$(this.recorder.elementID).find(".videoControlsContainer.controlsBar.doneAndPostButton").eq(0).attr("title",Translator.trans("player.recording.doneAndPostButton"))},s.prototype._onRecordingStarted=function(){console.log("%s: %s",s.TAG,"_onRecordingStarted"),this.player.setControlsEnabled(!1),this.recorder.options.additionalDataToPost.sourceStartTime=this.player.getCurrentTime(),this.player.play()},s.prototype._onRecordingStopped=function(){this.player.pause(),this.player.setControlsEnabled(!0)},s.prototype._onRecordingUploadProgress=function(e,t){i.updateProgressBar(this._getElement(s.Binder.CONTAINER_UPLOAD).show(),t)},s.prototype._onRecordingUploaded=function(e){i.updateProgressBar(this._getElement(s.Binder.CONTAINER_UPLOAD).hide(),0)},s.prototype._onRecordingSuccess=function(e){console.log("%s: %s- mediaId=%d",s.TAG,"_onRecordingSuccess",e.media.id),this.setRecordedMedia(new n(e.media))},s.prototype._onRecordingError=function(e){console.log("%s: %s- e=%s",s.TAG,"_onRecordingError",e)},s.prototype._preview=function(e){console.log("%s: %s",s.TAG,"_preview"),e.preventDefault(),this._destroyPlayers(),this.options.tab==s.Tab.INTERPRETATION&&this._createPlayer(),this.wasRecording=!0,this.options.mode=s.Mode.PREVIEW,this._createPlayer(!0)},s.prototype._done=function(e){console.log("%s: %s",s.TAG,"_done"),e.preventDefault(),this._dispatch(s.Event.DONE,{media:this.recordedMedia,doPost:!1,recorderComponent:this})},s.prototype._doneAndPost=function(e){console.log("%s: %s",s.TAG,"_doneAndPost"),e.preventDefault(),this._dispatch(s.Event.DONE,{media:this.recordedMedia,doPost:!0,recorderComponent:this})},s.prototype._destroyPlayers=function(){console.log("%s: %s",s.TAG,"_destroyPlayers");var e=function(e){var t=e.parent();e.removeAttr("src"),t.hide(),t.after(e.detach()),t.remove()}.bind(this);this.player!=null&&(this.player.destroyRecorder(),this.options.tab==s.Tab.NORMAL?e(this.$normalVideo):this.sourceMedia!=null&&e(this.$interpVideoP),this.player=null),this.recorder!=null&&(this.recorder.destroyRecorder(),this.options.tab==s.Tab.NORMAL?e(this.$normalVideo):this.sourceMedia!=null&&e(this.$interpVideoR),this.recorder=null),this.$controls.html("")},s.prototype._onPageAnimate=function(){try{if(this.options.mode==s.Mode.PREVIEW&&this.recordedMedia!=null){if(this.options.tab==s.Tab.INTERPRETATION&&this.sourceMedia!=null)return;this._createPlayer(!0)}else{if(this.options.tab==s.Tab.INTERPRETATION){if(this.sourceMedia==null)return;this._createPlayer()}this._createRecorder()}}catch(e){console.error("%s: %s- err=%o",s.TAG,"_loadPage",e)}},s.prototype._loadPage=function(){this.options.tab==s.Tab.INTERPRETATION&&(this.sourceMedia!=null?(this.$interpSelect.parent().hide(),this.$interpVideoP.show(),this.$interpVideoR.show()):(this.$interpSelect.parent().show(),this.$interpVideoP.hide(),this.$interpVideoR.hide())),this.$modalDialog.find(".modal-dialog").animate({width:4*($(window).height()*.9-220)/3},{complete:this.bind__onPageAnimate})},s.prototype._onShownModal=function(e){this._destroyPlayers(),this._loadPage()},s.prototype._onHiddenModal=function(e){this._destroyPlayers();if(this.paused)return;this._dispatch(s.Event.HIDDEN,{recorderComponent:this})},s.prototype._onShowTab=function(e){this._destroyPlayers(),this.options.tab=$(e.target).attr("href")==s.Binder.NORMAL?s.Tab.NORMAL:s.Tab.INTERPRETATION,this._loadPage()},s.prototype._onShownTab=function(e){this.$interpVideoP[0].load()},s.prototype._onBlurPlayerTitle=function(e){console.log("updated title"),this.recordedMedia.set("title",$(e.target).val()),r.edit(this.recordedMedia)},s.prototype._onClickInterpSelect=function(e){e.preventDefault(),t.render({multiSelect:!1,filter:{type:1}},function(e){this.mfsCmp=e.myFilesSelectorComponent,this.mfsCmp.subscribe(t.Event.DONE,function(e){this.mfsCmp.hide(),this.setSourceMedia(e.media[0])}.bind(this)),this.mfsCmp.subscribe(t.Event.HIDDEN,function(e){this.mfsCmp.destroy(),this.show(),this.paused=!1}.bind(this)),this.paused=!0,this.hide(),this.mfsCmp.show()}.bind(this))},s.prototype.show=function(){this.$modalDialog.modal("show")},s.prototype.hide=function(){this.$modalDialog.modal("hide")},s.prototype.destroy=function(){this.$modalDialog.remove()},s.prototype._injectMedia=function(e,t){var n=e.find("source");e.removeAttr("src"),n.attr("src",i.generateUrl(t.get("resource.web_path")))},s.prototype.setSourceMedia=function(e){this.sourceMedia=e,this.sourceMedia!=null&&this._injectMedia(this.$interpVideoP,this.sourceMedia),this._destroyPlayers(),this._loadPage()},s.prototype._togglePlayerTitle=function(){var e=this.recordedMedia!=null?this.recordedMedia.get("title"):"";this.options.tab==s.Tab.NORMAL?(this.$interpTitle.hide().val(""),this.$normalTitle.toggle().val(e)):(this.$normalTitle.hide().val(""),this.$interpTitle.toggle().val(e))},s.prototype.setRecordedMedia=function(e){this.recordedMedia=e,this.recordedMedia!=null&&this._injectMedia(this.options.tab==s.Tab.NORMAL?this.$normalVideo:this.$interpVideoR,this.recordedMedia),this._togglePlayerTitle()},s.prototype._getElement=function(e){return this.$container.find(e)},s.render=function(e,t){var n={$container:$("body"),tab:s.Tab.NORMAL,mode:s.Mode.RECORD,enableDoneAndPost:!1};e=e||n;for(var r in n)e[r]=typeof e[r]!="undefined"?e[r]:n[r];dust.render("recorder",{},function(n,r){e.$container.append(r);var i=new s(e);t.call(i,{recorderComponent:i})})},s}),!function(e){"use strict";"function"==typeof define&&define.amd?define("Sortable",e):"undefined"!=typeof module&&"undefined"!=typeof module.exports?module.exports=e():"undefined"!=typeof Package?Sortable=e():window.Sortable=e()}(function(){"use strict";function e(e,t){this.el=e,this.options=t=t||{};var r={group:Math.random(),sort:!0,disabled:!1,store:null,handle:null,scroll:!0,scrollSensitivity:30,scrollSpeed:10,draggable:/[uo]l/i.test(e.nodeName)?"li":">*",ghostClass:"sortable-ghost",ignore:"a, img",filter:null,animation:0,setData:function(e,t){e.setData("Text",t.textContent)},dropBubble:!1,dragoverBubble:!1};for(var i in r)!(i in t)&&(t[i]=r[i]);var o=t.group;o&&"object"==typeof o||(o=t.group={name:o}),["pull","put"].forEach(function(e){e in o||(o[e]=!0)}),F.forEach(function(r){t[r]=n(this,t[r]||I),s(e,r.substr(2).toLowerCase(),t[r])},this),t.groups=" "+o.name+(o.put.join?" "+o.put.join(" "):"")+" ",e[M]=t;for(var u in this)"_"===u.charAt(0)&&(this[u]=n(this,this[u]));s(e,"mousedown",this._onTapStart),s(e,"touchstart",this._onTapStart),s(e,"dragover",this),s(e,"dragenter",this),U.push(this._onDragOver),t.store&&this.sort(t.store.get(this))}function t(e){y&&y.state!==e&&(a(y,"display",e?"none":""),!e&&y.state&&b.insertBefore(y,m),y.state=e)}function n(e,t){var n=R.call(arguments,2);return t.bind?t.bind.apply(t,[e].concat(n)):function(){return t.apply(e,n.concat(R.call(arguments)))}}function r(e,t,n){if(e){n=n||D,t=t.split(".");var r=t.shift().toUpperCase(),i=new RegExp("\\s("+t.join("|")+")\\s","g");do if(">*"===r&&e.parentNode===n||(""===r||e.nodeName.toUpperCase()==r)&&(!t.length||((" "+e.className+" ").match(i)||[]).length==t.length))return e;while(e!==n&&(e=e.parentNode))}return null}function i(e){e.dataTransfer.dropEffect="move",e.preventDefault()}function s(e,t,n){e.addEventListener(t,n,!1)}function o(e,t,n){e.removeEventListener(t,n,!1)}function u(e,t,n){if(e)if(e.classList)e.classList[n?"add":"remove"](t);else{var r=(" "+e.className+" ").replace(/\s+/g," ").replace(" "+t+" ","");e.className=r+(n?" "+t:"")}}function a(e,t,n){var r=e&&e.style;if(r){if(void 0===n)return D.defaultView&&D.defaultView.getComputedStyle?n=D.defaultView.getComputedStyle(e,""):e.currentStyle&&(n=e.currentStyle),void 0===t?n:n[t];t in r||(t="-webkit-"+t),r[t]=n+("string"==typeof n?"":"px")}}function f(e,t,n){if(e){var r=e.getElementsByTagName(t),i=0,s=r.length;if(n)for(;s>i;i++)n(r[i],i);return r}return[]}function l(e){e.draggable=!1}function c(){B=!1}function h(e,t){var n=e.lastElementChild,r=n.getBoundingClientRect();return t.clientY-(r.top+r.height)>5&&n}function p(e){for(var t=e.tagName+e.className+e.src+e.href+e.textContent,n=t.length,r=0;n--;)r+=t.charCodeAt(n);return r.toString(36)}function d(e){for(var t=0;e&&(e=e.previousElementSibling);)"TEMPLATE"!==e.nodeName.toUpperCase()&&t++;return t}function v(e,t){var n,r;return function(){void 0===n&&(n=arguments,r=this,setTimeout(function(){1===n.length?e.call(r,n[0]):e.apply(r,n),n=void 0},t))}}var m,g,y,b,w,E,S,x,T,N,C,k,L,A,O={},M="Sortable"+(new Date).getTime(),_=window,D=_.document,P=_.parseInt,H="draggable"in D.createElement("div"),B=!1,j=function(e,t,n,r,i,s){var o=D.createEvent("Event");o.initEvent(t,!0,!0),o.item=n||e,o.from=r||e,o.clone=y,o.oldIndex=i,o.newIndex=s,e.dispatchEvent(o)},F="onAdd onUpdate onRemove onStart onEnd onFilter onSort".split(" "),I=function(){},q=Math.abs,R=[].slice,U=[],z=v(function(e,t,n){if(n&&t.scroll){var r,i,s,o,u=t.scrollSensitivity,a=t.scrollSpeed,f=e.clientX,l=e.clientY,c=window.innerWidth,h=window.innerHeight;if(S!==n&&(E=t.scroll,S=n,E===!0)){E=n;do if(E.offsetWidth<E.scrollWidth||E.offsetHeight<E.scrollHeight)break;while(E=E.parentNode)}E&&(r=E,i=E.getBoundingClientRect(),s=(q(i.right-f)<=u)-(q(i.left-f)<=u),o=(q(i.bottom-l)<=u)-(q(i.top-l)<=u)),s||o||(s=(u>=c-f)-(u>=f),o=(u>=h-l)-(u>=l),(s||o)&&(r=_)),(O.vx!==s||O.vy!==o||O.el!==r)&&(O.el=r,O.vx=s,O.vy=o,clearInterval(O.pid),r&&(O.pid=setInterval(function(){r===_?_.scrollTo(_.scrollX+s*a,_.scrollY+o*a):(o&&(r.scrollTop+=o*a),s&&(r.scrollLeft+=s*a))},24)))}},30);return e.prototype={constructor:e,_dragStarted:function(){b&&m&&(u(m,this.options.ghostClass,!0),e.active=this,j(b,"start",m,b,N))},_onTapStart:function(e){var t=e.type,n=e.touches&&e.touches[0],i=(n||e).target,o=i,u=this.options,a=this.el,c=u.filter;if(!("mousedown"===t&&0!==e.button||u.disabled)&&(i=r(i,u.draggable,a))){if(N=d(i),"function"==typeof c){if(c.call(this,e,i,this))return j(o,"filter",i,a,N),void e.preventDefault()}else if(c&&(c=c.split(",").some(function(e){return e=r(o,e.trim(),a),e?(j(e,"filter",i,a,N),!0):void 0})))return void e.preventDefault();if((!u.handle||r(o,u.handle,a))&&i&&!m&&i.parentNode===a){L=e,b=this.el,m=i,w=m.nextSibling,k=this.options.group,m.draggable=!0,u.ignore.split(",").forEach(function(e){f(i,e.trim(),l)}),n&&(L={target:i,clientX:n.clientX,clientY:n.clientY},this._onDragStart(L,"touch"),e.preventDefault()),s(D,"mouseup",this._onDrop),s(D,"touchend",this._onDrop),s(D,"touchcancel",this._onDrop),s(m,"dragend",this),s(b,"dragstart",this._onDragStart),H||this._onDragStart(L,!0);try{D.selection?D.selection.empty():window.getSelection().removeAllRanges()}catch(h){}}}},_emulateDragOver:function(){if(A){a(g,"display","none");var e=D.elementFromPoint(A.clientX,A.clientY),t=e,n=" "+this.options.group.name,r=U.length;if(t)do{if(t[M]&&t[M].groups.indexOf(n)>-1){for(;r--;)U[r]({clientX:A.clientX,clientY:A.clientY,target:e,rootEl:t});break}e=t}while(t=t.parentNode);a(g,"display","")}},_onTouchMove:function(e){if(L){var t=e.touches?e.touches[0]:e,n=t.clientX-L.clientX,r=t.clientY-L.clientY,i=e.touches?"translate3d("+n+"px,"+r+"px,0)":"translate("+n+"px,"+r+"px)";A=t,a(g,"webkitTransform",i),a(g,"mozTransform",i),a(g,"msTransform",i),a(g,"transform",i),e.preventDefault()}},_onDragStart:function(e,t){var n=e.dataTransfer,r=this.options;if(this._offUpEvents(),"clone"==k.pull&&(y=m.cloneNode(!0),a(y,"display","none"),b.insertBefore(y,m)),t){var i,o=m.getBoundingClientRect(),u=a(m);g=m.cloneNode(!0),a(g,"top",o.top-P(u.marginTop,10)),a(g,"left",o.left-P(u.marginLeft,10)),a(g,"width",o.width),a(g,"height",o.height),a(g,"opacity","0.8"),a(g,"position","fixed"),a(g,"zIndex","100000"),b.appendChild(g),i=g.getBoundingClientRect(),a(g,"width",2*o.width-i.width),a(g,"height",2*o.height-i.height),"touch"===t?(s(D,"touchmove",this._onTouchMove),s(D,"touchend",this._onDrop),s(D,"touchcancel",this._onDrop)):(s(D,"mousemove",this._onTouchMove),s(D,"mouseup",this._onDrop)),this._loopId=setInterval(this._emulateDragOver,150)}else n&&(n.effectAllowed="move",r.setData&&r.setData.call(this,n,m)),s(D,"drop",this);setTimeout(this._dragStarted,0)},_onDragOver:function(e){var n,i,s,o=this.el,u=this.options,f=u.group,l=f.put,p=k===f,d=u.sort;if(m&&(void 0!==e.preventDefault&&(e.preventDefault(),!u.dragoverBubble&&e.stopPropagation()),k&&!u.disabled&&(p?d||(s=!b.contains(m)):k.pull&&l&&(k.name===f.name||l.indexOf&&~l.indexOf(k.name)))&&(void 0===e.rootEl||e.rootEl===this.el))){if(z(e,u,this.el),B)return;if(n=r(e.target,u.draggable,o),i=m.getBoundingClientRect(),s)return t(!0),void (y||w?b.insertBefore(m,y||w):d||b.appendChild(m));if(0===o.children.length||o.children[0]===g||o===e.target&&(n=h(o,e))){if(n){if(n.animated)return;E=n.getBoundingClientRect()}t(p),o.appendChild(m),this._animate(i,m),n&&this._animate(E,n)}else if(n&&!n.animated&&n!==m&&void 0!==n.parentNode[M]){x!==n&&(x=n,T=a(n));var v,E=n.getBoundingClientRect(),S=E.right-E.left,N=E.bottom-E.top,C=/left|right|inline/.test(T.cssFloat+T.display),L=n.offsetWidth>m.offsetWidth,A=n.offsetHeight>m.offsetHeight,O=(C?(e.clientX-E.left)/S:(e.clientY-E.top)/N)>.5,_=n.nextElementSibling;B=!0,setTimeout(c,30),t(p),v=C?n.previousElementSibling===m&&!L||O&&L:_!==m&&!A||O&&A,v&&!_?o.appendChild(m):n.parentNode.insertBefore(m,v?_:n),this._animate(i,m),this._animate(E,n)}}},_animate:function(e,t){var n=this.options.animation;if(n){var r=t.getBoundingClientRect();a(t,"transition","none"),a(t,"transform","translate3d("+(e.left-r.left)+"px,"+(e.top-r.top)+"px,0)"),t.offsetWidth,a(t,"transition","all "+n+"ms"),a(t,"transform","translate3d(0,0,0)"),clearTimeout(t.animated),t.animated=setTimeout(function(){a(t,"transition",""),a(t,"transform",""),t.animated=!1},n)}},_offUpEvents:function(){o(D,"mouseup",this._onDrop),o(D,"touchmove",this._onTouchMove),o(D,"touchend",this._onDrop),o(D,"touchcancel",this._onDrop)},_onDrop:function(t){var n=this.el,r=this.options;clearInterval(this._loopId),clearInterval(O.pid),o(D,"drop",this),o(D,"mousemove",this._onTouchMove),o(n,"dragstart",this._onDragStart),this._offUpEvents(),t&&(t.preventDefault(),!r.dropBubble&&t.stopPropagation(),g&&g.parentNode.removeChild(g),m&&(o(m,"dragend",this),l(m),u(m,this.options.ghostClass,!1),b!==m.parentNode?(C=d(m),j(m.parentNode,"sort",m,b,N,C),j(b,"sort",m,b,N,C),j(m,"add",m,b,N,C),j(b,"remove",m,b,N,C)):(y&&y.parentNode.removeChild(y),m.nextSibling!==w&&(C=d(m),j(b,"update",m,b,N,C),j(b,"sort",m,b,N,C))),e.active&&j(b,"end",m,b,N,C)),b=m=g=w=y=E=S=L=A=x=T=k=e.active=null,this.save())},handleEvent:function(e){var t=e.type;"dragover"===t||"dragenter"===t?(this._onDragOver(e),i(e)):("drop"===t||"dragend"===t)&&this._onDrop(e)},toArray:function(){for(var e,t=[],n=this.el.children,i=0,s=n.length;s>i;i++)e=n[i],r(e,this.options.draggable,this.el)&&t.push(e.getAttribute("data-id")||p(e));return t},sort:function(e){var t={},n=this.el;this.toArray().forEach(function(e,i){var s=n.children[i];r(s,this.options.draggable,n)&&(t[e]=s)},this),e.forEach(function(e){t[e]&&(n.removeChild(t[e]),n.appendChild(t[e]))})},save:function(){var e=this.options.store;e&&e.set(this)},closest:function(e,t){return r(e,t||this.options.draggable,this.el)},option:function(e,t){var n=this.options;return void 0===t?n[e]:void (n[e]=t)},destroy:function(){var e=this.el,t=this.options;F.forEach(function(n){o(e,n.substr(2).toLowerCase(),t[n])}),o(e,"mousedown",this._onTapStart),o(e,"touchstart",this._onTapStart),o(e,"dragover",this),o(e,"dragenter",this),Array.prototype.forEach.call(e.querySelectorAll("[draggable]"),function(e){e.removeAttribute("draggable")}),U.splice(U.indexOf(this._onDragOver),1),this._onDrop(),this.el=null}},e.utils={on:s,off:o,css:a,find:f,bind:n,is:function(e,t){return!!r(e,t,e)},throttle:v,closest:r,toggleClass:u,dispatchEvent:j,index:d},e.version="1.1.1",e.create=function(t,n){return new e(t,n)},e}),define("component/galleryComponent",["core/subscriber","factory/mediaFactory","component/recorderComponent","core/helper","Sortable","extra"],function(e,t,n,r,i){"use strict";var s=function(n){e.prototype.constructor.apply(this),this.options=n,this.activeMedia=this.options.activeMedia,this.thumbsBounds={width:0,shiftWidth:0,thumbsWidth:0},this.bind__onClickItemContainer=this._onClickItemContainer.bind(this),this.bind__onClickPrevNext=this._onClickPrevNext.bind(this),this.bind__onClickAction=this._onClickAction.bind(this),this.bind__onClickLeftRight=this._onClickLeftRight.bind(this),this.bind__onClickThumbnail=this._onClickThumbnail.bind(this),this.bind__onClickThumbRemove=this._onClickThumbRemove.bind(this),this.bind__onRenderMedia=this._onRenderMedia.bind(this),this.bind__onRenderThumbnails=this._onRenderThumbnails.bind(this),this.bind__onWindowResize=this._onWindowResize.bind(this),this.$container=this.options.$container,this.$inner=this.$container.find('[id="'+this.options.identifier+'"]'+s.Binder.INNER),this.$item=this.$inner.find(s.Binder.ITEM),this.$prev=this.$inner.find(s.Binder.PREV),this.$next=this.$inner.find(s.Binder.NEXT),this.$actions=this.$inner.find(s.Binder.ACTION),this.$carousel=this.$inner.find(s.Binder.CAROUSEL),this.$thumbs=this.$inner.find(s.Binder.THUMBS),this.$left=this.$inner.find(s.Binder.LEFT),this.$right=this.$inner.find(s.Binder.RIGHT),this.$item.on("click",this.bind__onClickItemContainer),this.$prev.find("i.fa").on("click",this.bind__onClickPrevNext),this.$next.find("i.fa").on("click",this.bind__onClickPrevNext),this.$actions.on("click",this.bind__onClickAction),this.$left.find("i.fa").on("click",this.bind__onClickLeftRight),this.$right.find("i.fa").on("click",this.bind__onClickLeftRight),$(window).on("resize",this.bind__onWindowResize),this.options.canEdit&&(this.sortable=i.create(this.$thumbs.find("ul")[0],{onSort:function(e){var t=this.options.media[e.oldIndex],n=this.options.media[e.newIndex];this.options.media[e.newIndex]=t,this.options.media[e.oldIndex]=n,this._updateButtonStates(),this._dispatch(s.Event.CHANGE,{galleryComponent:this})}.bind(this)})),typeof this.options.mediaIds!="undefined"&&t.list(this.options.mediaIds).done(function(e){this.options.media=e.media,this._populate()}.bind(this)).fail(function(){console.error("%s: media factory list",s.TAG)})};return s.extend(e),s.TAG="GalleryComponent",s.Mode={PREVIEW:0,INLINE:1},s.Event={CHANGE:"eventChange",REMOVED_MEDIA:"eventRemovedMedia",DONE:"eventDone",HIDDEN:"eventHidden"},s.Binder={INNER:".gallery-inner",ITEM:".gallery-item",PREV:".gallery-prev",NEXT:".gallery-next",ACTION:".gallery-action a",CAROUSEL:".gallery-carousel",THUMBS:".gallery-thumbs",THUMB_REMOVE:".gallery-thumb-remove",LEFT:".gallery-left",RIGHT:".gallery-right"},s.prototype._launchRecorder=function(e,t,r){n.render(e,function(e){this.recorderCmp=e.recorderComponent,this.recorderCmp.subscribe(n.Event.DONE,function(e){this.recorderCmp.hide(),e.doPost&&window.location.assign(Routing.generate("imdc_thread_new_from_media",{mediaId:e.media.get("id")}))}.bind(this)),this.recorderCmp.subscribe(n.Event.HIDDEN,function(e){this.recorderCmp.destroy(),this.options.mode==s.Mode.PREVIEW&&this.show(),this.paused=!1}.bind(this)),this.paused=!0,this.options.mode==s.Mode.PREVIEW&&this.hide(),t&&this.recorderCmp.setSourceMedia(this.activeMedia),r&&this.recorderCmp.setRecordedMedia(this.activeMedia),this.recorderCmp.show()}.bind(this))},s.prototype._onClickItemContainer=function(e){if(this.options.mode!=s.Mode.PREVIEW)return;e.target===this.$item[0]&&this.hide()},s.prototype._onClickPrevNext=function(e){e.preventDefault();var t=$(e.currentTarget).hasClass("next"),n=$.inArray(this.activeMedia,this.options.media);if(!t&&n-1<0||t&&n+1>=this.options.media.length)return;this.activeMedia=this.options.media[n+(t?1:-1)],this._renderMedia()},s.prototype._onClickAction=function(e){var t=$(e.currentTarget).data("action");switch(t){case 1:this.hide();break;case 2:r.toggleFullScreen(this.$item);break;case 3:this._launchRecorder({tab:n.Tab.INTERPRETATION,enableDoneAndPost:!0},!0);break;case 4:this._launchRecorder({tab:n.Tab.NORMAL,mode:n.Mode.PREVIEW},!1,!0)}},s.prototype._calcCarouselPosition=function(e){var t=Math.abs(parseInt(this.$thumbs.find("ul").css("left"),10)),n,r,i,s;return e?(n=t+this.thumbsBounds.width,r=t+(this.thumbsBounds.thumbsWidth-n),i=t+this.thumbsBounds.shiftWidth,s=-Math.min(i,n>=this.thumbsBounds.thumbsWidth?t:r)):(n=t-this.thumbsBounds.shiftWidth,s=Math.min(0,-n)),s},s.prototype._onClickLeftRight=function(e){e.preventDefault();var t=this._calcCarouselPosition($(e.currentTarget).hasClass("right"));this._updateButtonStates(t),this.$thumbs.find("ul").css({left:t})},s.prototype._onClickThumbnail=function(e){e.preventDefault();var t=$(e.currentTarget).data("mid");this.activeMedia=$.grep(this.options.media,function(e,n){return e.get("id")==t})[0],this._renderMedia()},s.prototype._onClickThumbRemove=function(e){e.preventDefault();var t=$(e.currentTarget).data("mid"),n=$.grep(this.options.media,function(e,n){return e.get("id")==t})[0];this.removeMedia(n),this._dispatch(s.Event.REMOVED_MEDIA,{media:n,galleryComponent:this})},s.prototype.clear=function(){for(var e in this.options.media){var t=this.options.media[e];this.removeMedia(t),this._dispatch(s.Event.REMOVED_MEDIA,{media:t,galleryComponent:this})}},s.prototype._updateButtonStates=function(e){var t=this.$thumbs.find('li[data-mid="'+this.activeMedia.get("id")+'"]');this.$thumbs.find("div").removeClass("selected");var n=this.$actions.filter('[data-action="1"]'),r=this.$actions.filter('[data-action="2"]'),i=this.$actions.filter('[data-action="3"]'),o=this.$actions.filter('[data-action="4"]'),u=this.options.mode==s.Mode.PREVIEW;n.toggle(u),r.show(),this.activeMedia.get("type")==1?(i.show(),o.toggle(u)):(i.hide(),o.hide()),this.$prev.toggleClass("disabled",t.is(":first-child")),this.$next.toggleClass("disabled",t.is(":last-child"));var e=Math.abs(e!==undefined?e:parseInt(this.$thumbs.find("ul").css("left"),10));this.$left.find("i.fa").toggleClass("disabled",e<=0),this.$right.find("i.fa").toggleClass("disabled",e+this.thumbsBounds.width>=this.thumbsBounds.thumbsWidth),t.find("div").addClass("selected")},s.prototype._focusSelectedThumbnail=function(){var e=this.$thumbs.find('li[data-mid="'+this.activeMedia.get("id")+'"]'),t=e.position();if(!t)return;var n=e.outerWidth(!0);t.right=t.left+n,t.center=t.left+n/2;var r=Math.abs(parseInt(this.$thumbs.find("ul").css("left"),10)),i={left:r,right:r+this.thumbsBounds.width,center:r+this.thumbsBounds.width/2},s=t.center>i.center,o=Math.abs(t.center-i.center),u=r+(s?o:-o);s?u=-Math.min(u,i.right>=this.thumbsBounds.thumbsWidth?i.left:this.thumbsBounds.thumbsWidth-this.thumbsBounds.width):u=Math.min(0,-u),this.$thumbs.find("ul").css({left:u}),this._updateButtonStates(u)},s.prototype._onWindowResize=function(e){var t=this.$container.prop("tagName").toLowerCase()==="body"?$(window):this.$container,n=r.isFullscreen()?$(window).height():t.height()-this.$carousel.outerHeight(!0),i=t.width()-(this.$left.outerWidth(!0)+this.$right.outerWidth(!0))-.5,s=function(e,t){return n/2-$(this).height()/2};this.$item.css({height:n,"line-height":n+"px"}),this.$thumbs.width(i),this.$prev.css("top",s),this.$next.css("top",s),this.$item.find(".tt-media-video").css({height:n}),this.$item.find(".tt-media-img").css({"max-height":n});var o=this.$thumbs.width(),u=this.$thumbs.find("li"),a=parseInt(u.eq(0).css("margin-left"),10),f=u.eq(0).outerWidth(!0)-a,l=Math.floor(o/f);this.thumbsBounds.width=o,this.thumbsBounds.shiftWidth=f*l,this.thumbsBounds.thumbsWidth=f*u.length+a;if(!this.activeMedia){this.$actions.hide(),this.$prev.addClass("disabled"),this.$next.addClass("disabled"),this.$left.find("i.fa").addClass("disabled"),this.$right.find("i.fa").addClass("disabled");return}this._focusSelectedThumbnail(),this.$item.toggleClass("fullscreen",r.isFullscreen())},s.prototype._onRenderMedia=function(e,t){this.$item.html(t),$(window).trigger("resize")},s.prototype._onRenderThumbnails=function(e,t){this.$thumbs.find("ul").html(t),this.$thumbs.find("li").on("click",this.bind__onClickThumbnail),this.$thumbs.find("li").find("span").on("click",this.bind__onClickThumbRemove),$(window).trigger("resize")},s.prototype._renderMedia=function(){dust.render("media_element",{media:this.activeMedia?this.activeMedia.data:null,enable_controls:!0,preload_media:!1},this.bind__onRenderMedia)},s.prototype._renderMediaAndThumbnails=function(){if(!this.activeMedia){this.$item.html(""),this.$thumbs.find("ul").html(""),$(window).trigger("resize");return}this._renderMedia(),dust.render("gallery_thumbnail",{media:this.options.media,can_edit:this.options.canEdit},this.bind__onRenderThumbnails)},s.prototype._populate=function(){this.activeMedia=this.options.media.length==0?null:this.activeMedia?this.activeMedia:this.options.media[0],this._renderMediaAndThumbnails()},s.prototype.show=function(e){e=e!==undefined?e:this.options.mode==s.Mode.PREVIEW,this.options.mode==s.Mode.PREVIEW&&this.$container.addClass("tt-gallery-modal");var t=function(){this._populate()}.bind(this);e?this.$inner.fadeIn().promise().done(t):this.$inner.show().promise().done(t)},s.prototype.hide=function(e){e=e!==undefined?e:this.options.mode==s.Mode.PREVIEW,this.options.mode==s.Mode.PREVIEW&&!this.paused&&this.$container.removeClass("tt-gallery-modal");var t=function(){if(this.paused)return;this._dispatch(s.Event.HIDDEN,{galleryComponent:this})}.bind(this);e?this.$inner.fadeOut().promise().done(t):this.$inner.show().promise().done(t)},s.prototype.destroy=function(){this.$inner.remove()},s.prototype.setMedia=function(e){this.options.media=e,this._populate()},s.prototype.addMedia=function(e){this.options.media.push(e),this._populate()},s.prototype.removeMedia=function(e){var t=$.inArray(e,this.options.media);if(t==-1)return;this.options.media.splice(t,1),this.options.media.length==0?this.activeMedia=null:(t>=this.options.media.length&&t--,this.activeMedia=this.options.media[t]),this._populate()},s.render=function(e,t){if(e.mode!=="undefined"&&e.mode==s.Mode.INLINE&&e.$container==="undefined")throw new Error("Inline mode requires the $container option to be set explicitly.");var n={$container:$("body"),identifier:Math.random(),mode:s.Mode.PREVIEW,canEdit:!1,media:[],activeMedia:null};e=e||n;for(var r in n)e[r]=typeof e[r]!="undefined"?e[r]:n[r];var i=e.mode==s.Mode.INLINE?"gallery_inline":"gallery_preview";dust.render(i,{identifier:e.identifier},function(n,r){e.$container.append(r);var i=new s(e);t.call(i,{galleryComponent:i})})},s}),define("component/mediaChooserComponent",["core/subscriber","factory/mediaFactory","factory/myFilesFactory","component/recorderComponent","component/myFilesSelectorComponent","component/galleryComponent","model/mediaModel","core/helper","extra"],function(e,t,n,r,i,s,o,u){"use strict";var a=function(t){e.prototype.constructor.apply(this),this.options=t,this.media=[],this.bind__onClickRecordVideo=this._onClickRecordVideo.bind(this),this.bind__onClickUploadFile=this._onClickUploadFile.bind(this),this.bind__onClickSelect=this._onClickSelect.bind(this),this.bind__onChangeResourceFile=this._onChangeResourceFile.bind(this),this.$container=this.options.$container,this.$containerUpload=this.$container.find(a.Binder.CONTAINER_UPLOAD),this.$uploadForm=$(this.$containerUpload.data("form")),this.$resourceFile=this._getFormField("resource_file"),this.$recordVideo=this.$container.find(a.Binder.RECORD_VIDEO),this.$uploadFile=this.$container.find(a.Binder.UPLOAD_FILE),this.$select=this.$container.find(a.Binder.SELECT),this.$uploadTitle=this.$container.find(a.Binder.UPLOAD_TITLE),this.$working=this.$container.find(a.Binder.WORKING),this.$gallery=this.$container.find(a.Binder.GALLERY),this.$resourceFile.on("change",this.bind__onChangeResourceFile),this.$recordVideo.on("click",this.bind__onClickRecordVideo),this.$uploadFile.on("click",this.bind__onClickUploadFile),this.$select.on("click",this.bind__onClickSelect),this.$gallery.length>0&&s.render({$container:this.$gallery,mode:s.Mode.INLINE,canEdit:!0},function(e){this.galleryCmp=e.galleryComponent,this.galleryCmp.subscribe(s.Event.CHANGE,function(e){this.media=this.galleryCmp.options.media,this._invokeSuccess()}.bind(this)),this.galleryCmp.subscribe(s.Event.REMOVED_MEDIA,function(e){e.galleryComponent.options.media.length==0&&(this.galleryCmp.hide(!0),this.$gallery.slideUp()),this._removeSelectedMedia(e.media),this._invokeSuccess()}.bind(this))}.bind(this))};return a.extend(e),a.TAG="MediaChooserComponent",a.Binder={RECORD_VIDEO:".mediachooser-record-video",UPLOAD_FILE:".mediachooser-upload-file",SELECT:".mediachooser-select",CONTAINER_UPLOAD:".mediachooser-container-upload",UPLOAD_TITLE:".mediachooser-upload-title",WORKING:".mediachooser-working",GALLERY:".mediachooser-gallery"},a.Event={UPLOAD_START:"eventUploadStart",SUCCESS:"eventSuccess",SUCCESS_AND_POST:"eventSuccessAndPost",ERROR:"eventError",RESET:"eventReset"},a.FORM_NAME="media",a.prototype._getFormField=function(e){return this.$uploadForm.find("#"+a.FORM_NAME+"_"+e)},a.prototype._addSelectedMedia=function(e){for(var t in this.media){var n=this.media[t];if(n.get("id")==e.get("id"))return}this.media.push(e);if(this.$gallery.length==0)return;this.$gallery.slideDown(),this.galleryCmp.addMedia(e),this.galleryCmp.show(!0)},a.prototype._removeSelectedMedia=function(e){for(var t in this.media){var n=this.media[t];n.get("id")==e.get("id")&&(this.media.splice(t,1),this.galleryCmp.removeMedia(t))}},a.prototype._resetUpload=function(){this.$containerUpload.hide(),this.$uploadTitle.html("")},a.prototype._invokeSuccess=function(e){this._resetUpload();var t=typeof e!="undefined"&&e==1?a.Event.SUCCESS_AND_POST:a.Event.SUCCESS,n={media:this.media,mediaChooserComponent:this};this._dispatch(t,n)},a.prototype._onClickRecordVideo=function(e){e.preventDefault(),r.render({enableDoneAndPost:this.options.enableDoneAndPost},function(e){this.recorderCmp=e.recorderComponent,this.recorderCmp.subscribe(r.Event.DONE,function(e){this.recorderCmp.hide(),this._addSelectedMedia(e.media),this._invokeSuccess(e.doPost)}.bind(this)),this.recorderCmp.subscribe(r.Event.HIDDEN,function(e){this.recorderCmp.destroy()}.bind(this)),this.recorderCmp.show()}.bind(this))},a.prototype._onClickUploadFile=function(e){e.preventDefault(),this.$resourceFile.click()},a.prototype._onClickSelect=function(e){e.preventDefault(),i.render({},function(e){this.mfsCmp=e.myFilesSelectorComponent,this.mfsCmp.subscribe(i.Event.DONE,function(e){this.mfsCmp.hide(),$.each(e.media,function(e,t){this._addSelectedMedia(t)}.bind(this)),this._invokeSuccess()}.bind(this)),this.mfsCmp.subscribe(i.Event.HIDDEN,function(e){this.mfsCmp.destroy()}.bind(this)),this.mfsCmp.show()}.bind(this))},a.prototype._onChangeResourceFile=function(e){e.preventDefault(),this._toggleForm(!0);var t=this.$resourceFile.data("maxsize"),r=this.$resourceFile[0].files[0].size;if(r>t){alert(Translator.trans("form.upload.maxFileSizeExceeded",{fileSize:(r/1048576).toFixed(1)+"MB",maxUploadSize:(t/1048576).toFixed(1)+"MB"})),this.$resourceFile.val(""),this._toggleForm(!1);return}n.add(this.$uploadForm[0]).progress(function(e){u.updateProgressBar(this.$containerUpload.show(),e)}.bind(this)).done(function(e){this._addSelectedMedia(e.media),this._invokeSuccess(),this._toggleForm(!1)}.bind(this)).fail(function(e){this._resetUpload(),this._dispatch(a.Event.ERROR,{mediaChooserComponent:this,error:e?e.error:"Unknown error"}),this._toggleForm(!1)}.bind(this)),this._dispatch(a.Event.UPLOAD_START,{mediaChooserComponent:this}),this.$resourceFile.val("")},a.prototype._toggleForm=function(e){this.$recordVideo.attr("disabled",e),this.$uploadFile.attr("disabled",e),this.$select.attr("disabled",e)},a.prototype.setMedia=function(e){console.log("%s: %s",a.TAG,"setMedia");if(typeof e=="undefined")return;this._toggleForm(!0),this.$working.show(),t.list(e).done(function(e){this.$working.hide(),this._toggleForm(!1),$.each(e.media,function(e,t){this._addSelectedMedia(t)}.bind(this)),this._invokeSuccess()}.bind(this)).fail(function(){this.$working.hide(),this._toggleForm(!1),console.error("%s: media factory list",a.TAG)}.bind(this))},a.prototype.generateFormData=function(e){var t="";return $.each(this.media,function(n,r){var i=$(e.replace(/__name__/g,n));i.val(r.get("id")),t+=i[0].outerHTML}),t},a.prototype.reset=function(){console.log("%s: %s",a.TAG,"reset"),this._resetUpload(),this.galleryCmp.clear(),this._dispatch(a.Event.RESET,{mediaChooserComponent:this})},a.render=function(e,t){var n={enableDoneAndPost:!1};t=t||n;for(var r in n)t[r]=typeof t[r]!="undefined"?t[r]:n[r];return t.$container=e,new a(t)},a}),define("controller/message",["component/mediaChooserComponent"],function(e){"use strict";var t=function(e){console.log("%s: %s- options=%o",t.TAG,"constructor",e),this.page=e.page,this.mcCmp=null,this.bind__onSuccess=this._onSuccess.bind(this),this.bind__onReset=this._onReset.bind(this),this.bind__onError=this._onError.bind(this),$tt._instances.push(this)};return t.TAG="Message",t.Page={NEW:0,REPLY:1,VIEW:2},t.Binder={SUBMIT:".message-submit"},t.FORM_NAME="PrivateMessageForm",t.prototype.getContainer=function(){return $("body")},t.prototype._getElement=function(e){return this.getContainer().find(e)},t.prototype.getForm=function(){return this.getContainer().find("form[name="+t.FORM_NAME+"]")},t.prototype.getFormField=function(e){return this.getForm().find("#"+t.FORM_NAME+"_"+e)},t.prototype.bindUIEvents=function(){console.log("%s: %s",t.TAG,"bindUIEvents");switch(this.page){case t.Page.NEW:case t.Page.REPLY:this._bindUIEventsNewReply(this.page==t.Page.REPLY);break;case t.Page.VIEW:this._bindUIEventsView()}},t.prototype._bindUIEventsNewReply=function(n){console.log("%s: %s- isReply=%s",t.TAG,"_bindUIEventsNewReply",n),this.mcCmp=e.render(this.getContainer()),this.mcCmp.subscribe(e.Event.SUCCESS,this.bind__onSuccess),this.mcCmp.subscribe(e.Event.RESET,this.bind__onReset),this.mcCmp.subscribe(e.Event.ERROR,this.bind__onError);var r=[];this.getFormField("attachedMedia").children().each(function(e,t){r.push($(t).val())}),r.length>0&&(this._getElement(t.Binder.SUBMIT).attr("disabled",!0),this.mcCmp.setMedia(r)),this.getFormField("recipients").tagit()},t.prototype._bindUIEventsView=function(){console.log("%s: %s",t.TAG,"_bindUIEventsView");var e=$(".tt-message-div").first().data("mid");$.post(Routing.generate("imdc_message_mark_as_read",{messageid:e}),{msgId:e},function(e){console.log("%s: %s: data=%o","mark message as read","success",e)})},t.prototype._updateForm=function(){var e=this.getFormField("attachedMedia");e.html(this.mcCmp.generateFormData(e.data("prototype")))},t.prototype._onSuccess=function(e){this._getElement(t.Binder.SUBMIT).attr("disabled",!1),this._updateForm()},t.prototype._onReset=function(e){this._updateForm()},t.prototype._onError=function(e){alert("Error: "+e.error)},t}),define("controller/profile",[],function(){"use strict";var e=function(t){console.log("%s: %s- options=%o",e.TAG,"constructor",t),this.page=t.page,$tt._instances.push(this)};return e.TAG="Profile",e.Page={EDIT:0},e.prototype.bindUIEvents=function(){console.log("%s: %s",e.TAG,"bindUIEvents");switch(this.page){case e.Page.EDIT:this._bindUIEventsEdit()}},e.prototype._bindUIEventsEdit=function(){console.log("%s: %s",e.TAG,"_bindUIEventsEdit"),$("#addAnotherLanguage").on("click",function(t){t.preventDefault(),e.addLanguage(this)}),$(".tt-delete-language").on("click",function(t){t.preventDefault(),e.deleteLanguage(this)})},e.addLanguage=function(t){var n=$("#foss_user_profile_form_languages"),r,i=n.data("delete-language-text"),s=n.data("prototype"),o=$("#foss_user_profile_form_languages > li").length;$("#no-languages").remove(),r=$('<button class="btn btn-danger btn-sm tt-delete-language"></a>').html(i),r.click(function(n){n.preventDefault(),e.deleteLanguage(t)}),s=s.replace(/__name__/g,o),o++;var u=$("<li></li>").html(s);u.append(r),$("#foss_user_profile_form_languages").append(u)},e.deleteLanguage=function(e){var t=$("#foss_user_profile_form_languages"),n=t.data("no-languages-text"),r=$('<span id="no-languages"></span>').html(n);$(e).parent().remove(),$("#foss_user_profile_form_languages > li").length==0&&$("#foss_user_profile_form_languages").append(r)},e}),define("bootstrap",[],function(){"use strict";var e=function(e,t,n,r){var i=new t(e,r);new n(i,r),i.onViewLoaded()};return e}),define("factory/contactFactory",[],function(){"use strict";var e={};return e.delete=function(e,t){var n=$.Deferred(),r={url:Routing.generate("imdc_contact_delete"),type:"POST",data:{userIds:e,contactList:t}};return $.ajax(r).then(function(e,t,r){e.success?n.resolve(e):n.reject(e)},function(e,t,r){console.log(e.responseText),n.reject()}),n.promise()},e}),define("factory/forumFactory",[],function(){"use strict";var e={};return e.delete=function(e){var t=$.Deferred(),n={url:Routing.generate("imdc_forum_delete",{forumid:e.get("id")}),type:"POST"};return $.ajax(n).then(function(e,n,r){e.wasDeleted?t.resolve(e):t.reject()},function(e,n,r){console.log(e.responseText),t.reject()}),t.promise()},e}),define("factory/groupFactory",[],function(){"use strict";var e={};return e.delete=function(e){var t=$.Deferred(),n={url:Routing.generate("imdc_group_delete",{groupId:e.get("id")}),type:"POST"};return $.ajax(n).then(function(e,n,r){e.wasDeleted?t.resolve(e):t.reject()},function(e,n,r){console.log(e.responseText),t.reject()}),t.promise()},e}),define("factory/postFactory",[],function(){"use strict";var e={};return e._prepForFormPost=function(e,t){t.type="POST",t.contentType=!1,e&&(t.data=new FormData(e)),t.processData=!1},e.new=function(t,n){var r=t.get("id",-1),i=Routing.getRoute("imdc_post_new"),s=$.Deferred(),o={url:Routing.generate("imdc_post_new",{threadId:t.get("parent_thread.id"),pid:t.get("parent_post.id")||(r>0?r:null)||i.defaults.pid})};return e._prepForFormPost(n,o),$.ajax(o).then(function(e,t,n){s.resolve(e)},function(e,t,n){console.log(e.responseText),s.reject()}),s.promise()},e.view=function(e){var t=$.Deferred(),n={url:Routing.generate("imdc_post_view",{pid:e.get("id")})};return $.ajax(n).then(function(e,n,r){t.resolve(e)},function(e,n,r){console.log(e.responseText),t.reject()}),t.promise()},e.edit=function(t,n){var r=$.Deferred(),i={url:Routing.generate("imdc_post_edit",{pid:t.get("id")})};return e._prepForFormPost(n,i),$.ajax(i).then(function(e,n,i){e.wasEdited&&(t.set("start_time",e.post.start_time),t.set("end_time",e.post.end_time),t.set("is_temporal",e.post.is_temporal),t.set("parent_post",e.post.parent_post),t.set("parent_thread",e.post.parent_thread),t.set("keyPoint.startTime",t.get("start_time")),t.set("keyPoint.endTime",t.get("end_time"))),r.resolve(e)},function(e,t,n){console.log(e.responseText),r.reject()}),r.promise()},e.delete=function(e){var t=$.Deferred(),n={url:Routing.generate("imdc_post_delete",{pid:e.get("id")}),type:"POST"};return $.ajax(n).then(function(e,n,r){e.wasDeleted?t.resolve(e):t.reject()},function(e,n,r){console.log(e.responseText),t.reject()}),t.promise()},e}),define("factory/threadFactory",[],function(){"use strict";var e={};return e.delete=function(e){var t=$.Deferred(),n={url:Routing.generate("imdc_thread_delete",{threadid:e.get("id")}),type:"POST"};return $.ajax(n).then(function(e,n,r){e.wasDeleted?t.resolve(e):t.reject()},function(e,n,r){console.log(e.responseText),t.reject()}),t.promise()},e}),define("service/keyPointService",["underscore"],function(){"use strict";var e=function(){this.name="KeyPoint",this.keyPoints=[],this.subscriptions=[]};return e.Event={ADD:"eventAdd",DURATION:"eventDuration",SELECTION_TIMES:"eventSelectionTimes",HOVER:"eventHover",CLICK:"eventClick",EDIT:"eventEdit",REMOVE:"eventRemove"},e._kIndex=function(e){return _.isString(e)?e:"K"+e},e.prototype.register=function(t){var n=e._kIndex(t.id);_.isObject(t)&&(this.keyPoints[n]=t)},e.prototype.deregister=function(t){var n=e._kIndex(t);_.has(this.keyPoints,n)&&this.keyPoints.splice(n,1)},e.prototype.subscribe=function(t,n){var r=e._kIndex(t);_.has(this.subscriptions,r)||(this.subscriptions[r]=[]),_.contains(this.subscriptions[r],n)||this.subscriptions[r].push(n)},e.prototype.unsubscribe=function(t,n){var r=e._kIndex(t);if(_.has(this.subscriptions,r)){var i=this.subscriptions[r];if(_.contains(i,n)){var s=_.indexOf(i,n);i.splice(s,1)}}},e.prototype.dispatch=function(t,n,r){var i=e._kIndex(t);if(i!=="all"&&!_.has(this.keyPoints,i)||!_.contains(e.Event,n))return;var s=i==="all"?_.values(this.subscriptions):[this.subscriptions[i]],o=function(e,t,s){var o={type:n};i==="all"?o.keyPoints=this.keyPoints:o.keyPoint=this.keyPoints[i],_.isObject(r)&&_.each(r,function(e,t,n){o[t]=e}),_.each(e,function(e,t,n){_.isFunction(e)&&e.call(this,o)},this)};_.each(s,o,this),i!=="all"&&_.each([this.subscriptions.all],o,this)},e}),define("service/subscriberService",["core/subscriber"],function(e){"use strict";var t=function(){e.prototype.constructor.apply(this)};return t.extend(e),t.prototype.dispatch=function(t,n,r){r=r||{},r.tag=t,e.prototype._dispatch.call(this,n,r)},t}),define("model/forumModel",["model/model","model/mediaModel","extra"],function(e,t){"use strict";var n=function(n){e.prototype.constructor.apply(this,arguments),this.data.ordered_media&&this.data.ordered_media.forEach(function(e,n,r){r[n]=new t(e)})};return n.extend(e),n}),define("model/groupModel",["model/model","model/mediaModel","extra"],function(e,t){"use strict";var n=function(n){e.prototype.constructor.apply(this,arguments),this.data.ordered_media&&this.data.ordered_media.forEach(function(e,n,r){r[n]=new t(e)})};return n.extend(e),n}),define("model/myFilesModel",["model/model","model/mediaModel","extra","underscore"],function(e,t){"use strict";var n=function(n){e.prototype.constructor.apply(this,arguments);if(this.data.media){var r=this.data.media;this.data.media=[],_.each(r,function(n,r,i){var s=new t(n);s.subscribe(e.Event.CHANGE,function(t){var n=_.findIndex(this.data.media,t.model);n>-1&&this._dispatch(e.Event.CHANGE,"media."+n)}.bind(this)),this.data.media.push(s)},this),r=null}};return n.extend(e),n.prototype.getMedia=function(e){return _.find(this.data.media,function(t){return t.get("id")==e})},n}),define("model/postModel",["model/model","model/mediaModel","extra"],function(e,t){"use strict";var n=function(n){e.prototype.constructor.apply(this,arguments),this.data.keyPoint=null,this.data.ordered_media&&this.data.ordered_media.forEach(function(e,n,r){r[n]=new t(e)})};return n.extend(e),n.prototype.isNew=function(){return String(this.data.id).substr(0,1)==="0"},n}),define("model/threadModel",["model/model","extra","underscore"],function(e){"use strict";var t=function(t){e.prototype.constructor.apply(this,arguments),this.data.keyPoints=[]};return t.extend(e),t.prototype.addKeyPoint=function(t){this.removeKeyPoint(t.id),this.data.keyPoints.push(t),this._dispatch(e.Event.CHANGE,"keyPoints."+(this.data.keyPoints.length-1))},t.prototype._findKeyPoint=function(e){for(var t in this.data.keyPoints)if(this.data.keyPoints[t].id==e)return t},t.prototype.setKeyPointProperty=function(e,t,n,r){var i=this._findKeyPoint(e);i&&this.set("keyPoints."+i+"."+t,n,r)},t.prototype.removeKeyPoint=function(t){var n=this._findKeyPoint(t);n&&(this.data.keyPoints.splice(n,1),this._dispatch(e.Event.CHANGE,"keyPoints"))},t.prototype.forceChangeKeyPoint=function(e,t){var n=this._findKeyPoint(e);n&&this.forceChange("keyPoints."+n+"."+t)},t}),define("controller/contactController",["factory/contactFactory"],function(e){"use strict";var t=function(e,n){console.log("%s: %s- model=%o, options=%o",t.TAG,"constructor",e,n),this.model=e,this.options=n,$tt._instances.push(this)};return t.TAG="Contact",t.prototype.onViewLoaded=function(){},t.prototype.delete=function(t,n){return e.delete(t,n).done(function(e){window.location.reload(!0)})},t}),define("controller/forumController",["factory/forumFactory"],function(e){"use strict";var t=function(e,n){console.log("%s: %s- model=%o, options=%o",t.TAG,"constructor",e,n),this.model=e,this.options=n,$tt._instances.push(this)};return t.TAG="Forum",t.prototype.onViewLoaded=function(){},t.prototype.delete=function(){return e.delete(this.model).done(function(e){window.location.assign(e.redirectUrl)})},t}),define("controller/groupController",["factory/groupFactory"],function(e){"use strict";var t=function(e,n){console.log("%s: %s- model=%o, options=%o",t.TAG,"constructor",e,n),this.model=e,this.options=n,$tt._instances.push(this)};return t.TAG="Group",t.prototype.onViewLoaded=function(){},t.prototype.delete=function(){return e.delete(this.model).done(function(e){window.location.assign(e.redirectUrl)})},t}),define("controller/myFilesController",["factory/mediaFactory"],function(e){"use strict";var t=function(e,n){console.log("%s: %s- model=%o, options=%o",t.TAG,"constructor",e,n),this.model=e,this.options=n,$tt._instances.push(this)};return t.TAG="MyFiles",t.prototype.onViewLoaded=function(){},t.prototype.edit=function(t,n){var r=this.model.getMedia(t);if(!r)throw new Error("media not found");return Object.keys(n).forEach(function(e,t,i){r.set(e,n[e])}),e.edit(r)},t.prototype.delete=function(t,n){var r=this.model.getMedia(t);if(!r)throw new Error("media not found");return e.delete(r,n)},t}),define("controller/postController",["factory/postFactory","service","service/keyPointService"],function(e,t,n){"use strict";var r=function(e,n){console.log("%s: %s- model=%o, options=%o",r.TAG,"constructor",e,n),this.model=e,this.options=n,this.keyPointService=t.get("keyPoint"),this.model.set("keyPoint",new KeyPoint(this.model.get("id"),this.model.get("start_time"),this.model.get("end_time"),"",{drawOnTimeLine:this.model.get("is_temporal",!1)})),this.bind__onKeyPointEvent=this._onKeyPointEvent.bind(this),$tt._instances.push(this)};return r.TAG="Post",r.prototype._onKeyPointEvent=function(e){switch(e.type){case n.Event.DURATION:this.model.set("keyPoint.videoDuration",e.duration);break;case n.Event.SELECTION_TIMES:this.model.set("keyPoint.selection",e.selection);break;case n.Event.HOVER:case n.Event.CLICK:this.model.forceChange()}},r.prototype.onViewLoaded=function(){this.addKeyPoint()},r.prototype.addKeyPoint=function(){var e=this.model.get("keyPoint");this.keyPointService.register(e),this.keyPointService.subscribe(e.id,this.bind__onKeyPointEvent),this.keyPointService.dispatch(e.id,n.Event.ADD)},r.prototype.hoverKeyPoint=function(e){this.model.set("keyPoint.isHovering",e.isMouseOver),this.keyPointService.dispatch(this.model.get("keyPoint.id"),n.Event.HOVER,e)},r.prototype.clickKeyPoint=function(e){var t="keyPoint."+(e.isDblClick?"isPlaying":"isSeeking");this.model.set(t,!0),setTimeout(function(){this.model.set(t,!1,!1)}.bind(this),100),this.keyPointService.dispatch(this.model.get("keyPoint.id"),n.Event.CLICK,e)},r.prototype.editKeyPoint=function(e){this.keyPointService.dispatch(this.model.get("keyPoint.id"),n.Event.EDIT,e)},r.prototype.removeKeyPoint=function(){var e=this.model.get("keyPoint");this.keyPointService.dispatch(e.id,n.Event.REMOVE),this.keyPointService.unsubscribe(e.id,this.bind__onKeyPointEvent),this.keyPointService.deregister(e.id)},r.prototype.new=function(t){return e.new(this.model,t).done(function(e){e.wasReplied})},r.prototype.edit=function(t){return e.edit(this.model,t).done(function(e){})},r.prototype.view=function(){return e.view(this.model).done(function(e){})},r.prototype.delete=function(){return e.delete(this.model).done(function(e){this.removeKeyPoint()}.bind(this))},r}),define("controller/threadController",["factory/threadFactory","service","service/keyPointService"],function(e,t,n){"use strict";var r=function(e,n){console.log("%s: %s- model=%o, options=%o",r.TAG,"constructor",e,n),this.model=e,this.options=n,this.keyPointService=t.get("keyPoint"),this.videoSpeed=0,this.bind__onKeyPointEvent=this._onKeyPointEvent.bind(this),$tt._instances.push(this)};return r.TAG="Thread",r.prototype._onKeyPointEvent=function(e){switch(e.type){case n.Event.ADD:this.model.addKeyPoint(e.keyPoint);break;case n.Event.HOVER:case n.Event.CLICK:this.model.forceChangeKeyPoint(e.keyPoint.id);break;case n.Event.EDIT:if(!e.cancel){this.model.setKeyPointProperty(e.keyPoint.id,"options.drawOnTimeLine",!1),this.model.setKeyPointProperty(e.keyPoint.id,"isEditing",!0);break};case n.Event.REMOVE:this.model.setKeyPointProperty(e.keyPoint.id,"isEditing",!1),this.model.setKeyPointProperty(e.keyPoint.id,"options.drawOnTimeLine",!0),e.type==n.Event.REMOVE&&this.model.removeKeyPoint(e.keyPoint.id)}},r.prototype.onViewLoaded=function(){this.keyPointService.subscribe("all",this.bind__onKeyPointEvent)},r.prototype.updateKeyPointDuration=function(e){isNaN(e)||this.keyPointService.dispatch("all",n.Event.DURATION,{duration:e})},r.prototype.updateKeyPointSelectionTimes=function(e){this.keyPointService.dispatch("all",n.Event.SELECTION_TIMES,{selection:{startTime:parseFloat(e.minTime).toFixed(2),endTime:parseFloat(e.maxTime).toFixed(2)}})},r.prototype.hoverKeyPoint=function(e,t){this.model.setKeyPointProperty(e,"isPlayerHovering",t.isMouseOver),this.keyPointService.dispatch(e,n.Event.HOVER,t)},r.prototype.clickKeyPoint=function(e){this.model.setKeyPointProperty(e,"isPlayerPlaying",!0),setTimeout(function(){this.model.setKeyPointProperty(e,"isPlayerPlaying",!1,!1)}.bind(this),100),this.keyPointService.dispatch(e,n.Event.CLICK)},r.prototype.adjustVideoSpeed=function(){this.videoSpeed=(this.videoSpeed+1)%3;switch(this.videoSpeed){case 0:return{value:1,image:this.options.player.speedImages.normal};case 1:return{value:2,image:this.options.player.speedImages.fast};case 2:return{value:.5,image:this.options.player.speedImages.slow};default:return{value:1,image:this.options.player.speedImages.normal}}},r.prototype.delete=function(){return e.delete(this.model).done(function(e){window.location.assign(e.redirectUrl)})},r}),define("component/accessTypeComponent",[],function(){"use strict";var e=function(e){this.options=e,this.typeToFieldMap=[{filter:'[value="4"]',fields:["accessType_data_users"]},{filter:'[value="6"]',fields:["group"]}],this.bind__onChangeAccessType=this._onChangeAccessType.bind(this),this.$container=this.options.$container,this.$accessTypes=this.$container.find("input:radio"),this.$accessTypes.on("change",this.bind__onChangeAccessType),this.$accessTypes.filter(":checked").trigger("change")};return e.TAG="AccessTypeComponent",e.prototype._getFormField=function(e){return this.$container.find('[id$="_'+e+'"]')},e.prototype._onChangeAccessType=function(e){var t=$(e.target),n=function(e,n){var r=n.parent();t.attr("id")==e.attr("id")?(r.find("label").addClass("required"),n.attr("required",!0),r.children().show()):(r.find("label").removeClass("required"),n.attr("required",!1),r.children().hide())};$.each(this.typeToFieldMap,function(e,t){var r=this.$accessTypes.filter(t.filter);$.each(t.fields,function(e,t){n(r,this._getFormField(t))}.bind(this))}.bind(this))},e.render=function(t,n){var r={};n=n||r;for(var i in r)n[i]=typeof n[i]!="undefined"?n[i]:r[i];return n.$container=t,new e(n)},e}),define("views/contact/listView",["component/tableComponent"],function(e){"use strict";var t=function(n,r){this.controller=n,this.bind__onSelectionChange=this._onSelectionChange.bind(this),this.bind__onClickBulkAction=this._onClickBulkAction.bind(this),this.$container=r.container,this.$form=this.$container.find("form[name^="+t.FORM_NAME+"]"),this.$tabPanes=this.$container.find(t.Binder.TAB_PANES),this.tabPaneTblCmps=[],this.$tabPanes.each(function(t,n){this.tabPaneTblCmps[n.id]=e.table($(n)),this.tabPaneTblCmps[n.id].subscribe(e.Event.SELECTION_CHANGE,this.bind__onSelectionChange),this.tabPaneTblCmps[n.id].subscribe(e.Event.CLICK_BULK_ACTION,this.bind__onClickBulkAction)}.bind(this)),$tt._instances.push(this)};return t.TAG="ContactListView",t.Binder={TAB_PANES:".tab-pane[id^=tab]"},t.FORM_NAME="users_select",t.prototype._getFormField=function(e,t){return e.find("#"+e.attr("name")+"_"+t)},t.prototype._onSelectionChange=function(e){var t=e.tableComponent.getBulkActions();t.attr("disabled",e.$selection.length==0)},t.prototype._updateUsersSelectForm=function(e){var t=this._getFormField(this.$form,"users");t.html(""),e.each(function(e,n){var r=t.data("prototype");r=$(r.replace(/__name__/g,e)),r.val($(n).data("uid")),t.append(r)})},t.prototype._onClickBulkAction=function(e){switch(e.action){case 1:var t=e.tableComponent.getTable().attr("id").replace(/^tab/,"").toLowerCase();if(t=="all"&&!confirm("This will delete the selected contacts from all lists. Continue?"))break;e.$bulkAction.attr("disabled",!0);var n=[];e.$selection.each(function(e,t){n.push($(t).data("uid"))}),this.controller.delete(n,t).fail(function(t){t?alert(t.message):alert("Something went wrong."),e.$bulkAction.attr("disabled",!1)});break;case 2:e.$bulkAction.attr("disabled",!0),this._updateUsersSelectForm(e.$selection),this.$form.attr("action",Routing.generate("imdc_group_new")),this.$form.submit();break;case 3:e.$bulkAction.attr("disabled",!0),this._updateUsersSelectForm(e.$selection),this.$form.attr("action",Routing.generate("imdc_message_new")),this.$form.submit()}},t}),define("views/forum/newView",["component/mediaChooserComponent","component/accessTypeComponent"],function(e,t){"use strict";var n=function(r,i){this.controller=r,this.bind__onClickSubmit=this._onClickSubmit.bind(this),this.bind__onUploadStart=this._onUploadStart.bind(this),this.bind__onSuccess=this._onSuccess.bind(this),this.bind__onReset=this._onReset.bind(this),this.bind__onError=this._onError.bind(this),this.$container=i.container,this.$form=this.$container.find("form[name^="+n.FORM_NAME+"]"),this.$submit=this.$container.find(n.Binder.SUBMIT),this.$submit.on("click",this.bind__onClickSubmit),this.atCmp=t.render(this.$form),this.mcCmp=e.render(this.$form),this.mcCmp.subscribe(e.Event.UPLOAD_START,this.bind__onUploadStart),this.mcCmp.subscribe(e.Event.SUCCESS,this.bind__onSuccess),this.mcCmp.subscribe(e.Event.RESET,this.bind__onReset),this.mcCmp.subscribe(e.Event.ERROR,this.bind__onError);var s=[];this._getFormField("titleMedia").children().each(function(e,t){s.push($(t).val())}),s.length>0&&(this.$submit.attr("disabled",!0),this.mcCmp.setMedia(s)),$tt._instances.push(this)};return n.TAG="ForumNewView",n.Binder={SUBMIT:".forum-submit"},n.FORM_NAME="forum",n.prototype._getFormField=function(e){return this.$form.find("#"+n.FORM_NAME+"_"+e)},n.prototype._onClickSubmit=function(e){this.$form[0].checkValidity()&&this.$submit.button("loading")},n.prototype._updateForm=function(){var e=this._getFormField("titleMedia");e.html(this.mcCmp.generateFormData(e.data("prototype")))},n.prototype._onUploadStart=function(e){this.$submit.attr("disabled",!0)},n.prototype._onSuccess=function(e){this.$submit.attr("disabled",!1),this._getFormField("titleText").attr("required",!1).parent().find("label").removeClass("required"),this._updateForm()},n.prototype._onReset=function(e){this.mcCmp.media.length==0&&this._getFormField("titleText").attr("required",!0).parent().find("label").addClass("required"),this._updateForm()},n.prototype._onError=function(e){alert("Error: "+e.error)},n}),define("views/forum/editView",["views/forum/newView"],function(e){"use strict";var t=function(n,r){e.prototype.constructor.apply(this,arguments),this.bind__onClickDelete=this._onClickDelete.bind(this),this.$deleteModal=this.$container.find(t.Binder.DELETE_MODAL),this.$delete=this.$container.find(t.Binder.DELETE),this.$delete.on("click",this.bind__onClickDelete)};return t.extend(e),t.TAG="ForumEditView",t.Binder.DELETE_MODAL=".forum-delete-modal",t.Binder.DELETE=".forum-delete",t.prototype._onClickDelete=function(e){e.preventDefault(),this.$delete.button("loading"),this.controller.delete().done(function(e){this.$deleteModal.find(".modal-body").html("Forum deleted successfully.")}.bind(this)).fail(function(){this.$container.find(".modal-body").prepend("Something went wrong. Try again."),this.$delete.button("reset")}.bind(this))},t}),define("views/forum/viewView",["component/galleryComponent"],function(e){"use strict";var t=function(n,r){this.controller=n,this.$container=r.container,this.$gallery=this.$container.find(t.Binder.GALLERY);var i=this.controller.model.get("ordered_media");i.length>0&&e.render({$container:this.$gallery,mode:e.Mode.INLINE,media:i},function(e){this.galleryCmp=e.galleryComponent,this.galleryCmp.show()}.bind(this)),$tt._instances.push(this)};return t.TAG="ForumViewView",t.Binder={GALLERY:".forum-gallery"},t}),define("views/group/newView",["component/mediaChooserComponent"],function(e){"use strict";var t=function(n,r){this.controller=n,this.bind__onClickSubmit=this._onClickSubmit.bind(this),this.bind__onUploadStart=this._onUploadStart.bind(this),this.bind__onSuccess=this._onSuccess.bind(this),this.bind__onReset=this._onReset.bind(this),this.bind__onError=this._onError.bind(this),this.$container=r.container,this.$form=this.$container.find("form[name^="+t.FORM_NAME+"]"),this.$submit=this.$container.find(t.Binder.SUBMIT),this.$submit.on("click",this.bind__onClickSubmit),this.mcCmp=e.render(this.$form),this.mcCmp.subscribe(e.Event.UPLOAD_START,this.bind__onUploadStart),this.mcCmp.subscribe(e.Event.SUCCESS,this.bind__onSuccess),this.mcCmp.subscribe(e.Event.RESET,this.bind__onReset),this.mcCmp.subscribe(e.Event.ERROR,this.bind__onError);var i=[];this._getFormField("media").children().each(function(e,t){i.push($(t).val())}),i.length>0&&(this.$submit.attr("disabled",!0),this.mcCmp.setMedia(i)),$tt._instances.push(this)};return t.TAG="GroupNewView",t.Binder={SUBMIT:".group-submit"},t.FORM_NAME="user_group",t.prototype._getFormField=function(e){return this.$form.find("#"+t.FORM_NAME+"_"+e)},t.prototype._onClickSubmit=function(e){this.$form[0].checkValidity()&&this.$submit.button("loading")},t.prototype._updateForm=function(){var e=this._getFormField("media");e.html(this.mcCmp.generateFormData(e.data("prototype")))},t.prototype._onUploadStart=function(e){this.$submit.attr("disabled",!0)},t.prototype._onSuccess=function(e){this._updateForm(),this.$submit.attr("disabled",!1)},t.prototype._onReset=function(e){this._updateForm()},t.prototype._onError=function(e){alert("Error: "+e.error)},t}),define("views/group/editView",["views/group/newView"],function(e){"use strict";var t=function(n,r){e.prototype.constructor.apply(this,arguments),this.bind__onClickDelete=this._onClickDelete.bind(this),this.$deleteModal=this.$container.find(t.Binder.DELETE_MODAL),this.$delete=this.$container.find(t.Binder.DELETE),this.$delete.on("click",this.bind__onClickDelete)};return t.extend(e),t.TAG="GroupEditView",t.Binder.DELETE_MODAL=".group-delete-modal",t.Binder.DELETE=".group-delete",t.prototype._onClickDelete=function(e){e.preventDefault(),this.$delete.button("loading"),this.controller.delete().done(function(e){this.$deleteModal.find(".modal-body").html("Group deleted successfully.")}.bind(this)).fail(function(){this.$container.find(".modal-body").prepend("Something went wrong. Try again."),this.$delete.button("reset")}.bind(this))},t}),define("views/group/viewView",["component/galleryComponent"],function(e){"use strict";var t=function(n,r){this.controller=n,this.$container=r.container,this.$gallery=this.$container.find(t.Binder.GALLERY);var i=this.controller.model.get("ordered_media");i.length>0&&e.render({$container:this.$gallery,mode:e.Mode.INLINE,media:i},function(e){this.galleryCmp=e.galleryComponent,this.galleryCmp.show()}.bind(this)),$tt._instances.push(this)};return t.TAG="GroupViewView",t.Binder={GALLERY:".group-gallery"},t}),define("views/group/manageView",["component/tableComponent"],function(e){"use strict";var t=function(n,r){this.controller=n,this.bind___onClickFormCheckboxLink=this._onClickFormCheckboxLink.bind(this),this.bind__onShownTab=this._onShownTab.bind(this),this.bind__onClickRemove=this._onClickRemove.bind(this),this.bind__onClickAdd=this._onClickAdd.bind(this),this.$container=r.container,this.$formSearch=this.$container.find("form[name^="+t.FORM_NAME_SEARCH+"]"),this.$formRemove=this.$container.find("form[name^="+t.FORM_NAME_REMOVE+"]"),this.$formAdd=this.$container.find("form[name^="+t.FORM_NAME_ADD+"]"),this.$formCheckboxLinks=this.$formSearch.find('label[class^="checkbox"] a'),this.$tabs=this.$container.find(t.Binder.TABS),this.$tabPanes=this.$container.find(t.Binder.TAB_PANES),this.$remove=this.$container.find(t.Binder.REMOVE),this.$add=this.$container.find(t.Binder.ADD),this.$formCheckboxLinks.on("click",this.bind___onClickFormCheckboxLink),this.$tabs.on("shown.bs.tab",this.bind__onShownTab),this.$remove.on("click",this.bind__onClickRemove),this.$add.on("click",this.bind__onClickAdd);var i=function(e){this.$remove.attr("disabled",e.$selection.length==0)}.bind(this),s=function(e){this.$add.attr("disabled",e.$selection.length==0)}.bind(this),o=function(e){return e=="remove"?i:s};this.tableCmps=[],this.$tabPanes.each(function(t,n){var r=$(n),i=o(r.data("type")),s=e.table(r);s.subscribe(e.Event.SELECTION_CHANGE,i),this.tableCmps.push(s)}.bind(this)),this.$tabs.filter('[href="'+(location.hash?"#tab"+location.hash.substr(1):"#tabMembers")+'"]').tab("show"),$tt._instances.push(this)};return t.TAG="GroupManageView",t.Binder={TABS:'a[data-toggle="tab"]',TAB_PANES:"[id^=tab]",REMOVE:".group-remove",ADD:".group-add"},t.FORM_NAME="ugm_",t.FORM_NAME_SEARCH=t.FORM_NAME+"search",t.FORM_NAME_REMOVE=t.FORM_NAME+"remove",t.FORM_NAME_ADD=t.FORM_NAME+"add",t.prototype._getFormField=function(e,t){return e.find("#"+e.attr("name")+"_"+t)},t.prototype._onClickFormCheckboxLink=function(e){e.preventDefault();var t=this.$formSearch.find('input[type="checkbox"]'),n=$(e.target).parent().find('input[type="checkbox"]'),r=n.prop("checked");t.prop("checked",!1),n.prop("checked",!r),this.$formSearch[0].submit()},t.prototype._onShownTab=function(e){var t="#"+$(e.target).attr("href").substr(4);history.pushState?history.pushState(null,null,t):location.hash=t,this.$tabPanes.find("ul.pagination li a").each(function(e,n){var r=$(n),i=r.attr("href"),e=i.lastIndexOf("#");e>0&&(i=i.substring(0,e)),r.attr("href",i+t)})},t.prototype._updateUsersSelectForm=function(e,t){var n=this._getFormField(e,"users");t.button("loading"),t.toggleClass("disabled"),n.html(""),$.each(this.tableCmps,function(e,t){t.getSelection().each(function(e,t){var r=n.data("prototype");r=$(r.replace(/__name__/g,e)),r.val($(t).data("uid")),n.append(r)})}.bind(this))},t.prototype._onClickRemove=function(e){e.preventDefault(),this._updateUsersSelectForm(this.$formRemove,this.$remove),this.$formRemove.submit()},t.prototype._onClickAdd=function(e){e.preventDefault(),this._updateUsersSelectForm(this.$formAdd,this.$add),this.$formAdd.submit()},t}),define("views/myFiles/listView",["service","model/model","component/tableComponent","component/mediaChooserComponent","component/galleryComponent"],function(e,t,n,r,i){"use strict";var s=function(i,o){this.controller=i,this.bind__onClickBulkAction=this._onClickBulkAction.bind(this),this.bind__onClickFile=this._onClickFile.bind(this),this.bind__onSuccess=this._onSuccess.bind(this),this.bind__onError=this._onError.bind(this),this.$container=o.container,this.$filesList=this.$container.find(s.Binder.FILES_LIST),this.$files=this.$container.find(s.Binder.FILE),this.tblCmp=n.table(this.$filesList),this.tblCmp.subscribe(n.Event.CLICK_BULK_ACTION,this.bind__onClickBulkAction),this.$filesList.find("button.edit-title").on("click",function(e){e.stopPropagation(),$(this).parent().prev().editable("toggle")}),this.$files.not(":disabled").on("click",this.bind__onClickFile),this.mcCmp=r.render(this.$container),this.mcCmp.subscribe(r.Event.SUCCESS,this.bind__onSuccess),this.mcCmp.subscribe(r.Event.RESET,this.bind__onReset),this.mcCmp.subscribe(r.Event.ERROR,this.bind__onError),this.$filesList.find("span.edit-title").editable({toggle:"manual",unsavedclass:null,pk:function(){return $(this).data("mid")},url:function(e){return this.controller.edit(e.pk,{title:e.value})}.bind(this)});var u=e.get("subscriber");u.dispatch(s.TAG,"onViewLoaded",{view:this}),this.controller.model.subscribe(t.Event.CHANGE,function(e){var t=e.model.get(e.keyPath),n=this.$files.filter('span[data-mid="'+t.get("id")+'"]');n.html(t.get("title"))}.bind(this)),$tt._instances.push(this)};return s.TAG="MyFilesListView",s.Binder={TOGGLE_STYLE:".my-files-selector-toggle-style",FILES_LIST:".my-files-selector-files-list",FILE:".my-files-selector-file"},s.prototype._onClickBulkAction=function(e){switch(e.action){case 1:confirm(Translator.trans("filesGateway.deleteConfirmMessage"))&&$.each(e.$selection,function(e,t){this.controller.delete($(t).data("mid"),!0)}.bind(this)),setTimeout(function(){window.location.reload(!0)},2e3)}},s.prototype._onClickFile=function(e){e.stopPropagation();var t=this.controller.model.getMedia($(e.currentTarget).data("mid"));if(!t)throw new Error("media not found");i.render({media:this.controller.model.get("media"),activeMedia:t},function(e){this.galleryCmp=e.galleryComponent,this.galleryCmp.subscribe(i.Event.HIDDEN,function(e){this.galleryCmp.destroy()}.bind(this)),this.galleryCmp.show()}.bind(this))},s.prototype.getTableComponent=function(){return this.tblCmp},s.prototype._onSuccess=function(e){window.location.reload(!0)},s.prototype._onError=function(e){alert("Error: "+e.error)},s}),define("views/post/newView",["model/model","component/mediaChooserComponent"],function(e,t){"use strict";var n=function(r,i){this.controller=r,this.bind__onClickSubmitNew=this._onClickSubmitNew.bind(this),this.bind__onClickReset=this._onClickReset.bind(this),this.bind__onClickCancelNew=this._onClickCancelNew.bind(this),this.bind__onUploadStart=this._onUploadStart.bind(this),this.bind__onSuccess=this._onSuccess.bind(this),this.bind__onSuccessAndPost=this._onSuccessAndPost.bind(this),this.bind__onReset=this._onReset.bind(this),this.bind__onModelChange=this._onModelChange.bind(this),this.bind__onError=this._onError.bind(this),this.$container=$(n.Binder.CONTAINER+'[data-pid="'+this.controller.model.get("id")+'"]'),this.$form=this.$container.find("form[name^="+n.FORM_NAME+"]"),this.$submitNew=this.$container.find(n.Binder.SUBMIT_NEW),this.$reset=this.$container.find(n.Binder.RESET),this.$cancelNew=this.$container.find(n.Binder.CANCEL_NEW),this.$submitNew.on("click",this.bind__onClickSubmitNew),this.$reset.on("click",this.bind__onClickReset),this.$cancelNew.on("click",this.bind__onClickCancelNew),this.mcCmp=t.render(this.$form,{enableDoneAndPost:!0}),this.mcCmp.subscribe(t.Event.UPLOAD_START,this.bind__onUploadStart),this.mcCmp.subscribe(t.Event.SUCCESS,this.bind__onSuccess),this.mcCmp.subscribe(t.Event.SUCCESS_AND_POST,this.bind__onSuccessAndPost),this.mcCmp.subscribe(t.Event.RESET,this.bind__onReset),this.mcCmp.subscribe(t.Event.ERROR,this.bind__onError);var s=[];this._getFormField("attachedFile").children().each(function(e,t){s.push($(t).val())}),s.length>0&&this.mcCmp.setMedia(s),this.controller.model.subscribe(e.Event.CHANGE,this.bind__onModelChange),$tt._instances.push(this)};return n.TAG="PostNewView",n.Binder={CONTAINER:".post-container",SUBMIT_NEW:".post-submit-new",RESET:".post-reset",CANCEL_NEW:".post-cancel-new"},n.FORM_NAME="post",n.prototype._getFormField=function(e){return this.$form.find("#"+n.FORM_NAME+"_"+e)},n.prototype._toggleForm=function(e){this.$submitNew.button(e?"loading":"reset"),this.$reset.attr("disabled",e),this.$cancelNew.attr("disabled",e)},n.prototype._preSubmit=function(){return this._getFormField("content").val()==""&&this.mcCmp.media.length==0?(alert("Your post cannot be blank. You must either select a file or write a comment."),!1):(this._toggleForm(!0),!0)},n.prototype._onClickSubmitNew=function(e){e.preventDefault();if(!this._preSubmit())return;this.controller.new(this.$form[0]).done(function(e){if(!e.wasReplied){this.$container.replaceWith(e.html),this.controller.removeKeyPoint();var t=this;t=new n(this.controller,this.controller.options),this.controller.onViewLoaded()}else{this.mcCmp.reset(),this._getFormField("content").val(""),this._getFormField("startTime").val(this.controller.model.get("keyPoint.startTime")),this._getFormField("endTime").val(this.controller.model.get("keyPoint.endTime")),this.controller.editKeyPoint({cancel:!0}),this.controller.editKeyPoint({cancel:!1}),this._toggleForm(!1);var r=require("views/post/viewView"),i=require("controller/postController"),s=require("model/postModel"),o=require("bootstrap");e.post.parent_post?(this.$container.remove(),this.controller.removeKeyPoint(),$(n.Binder.CONTAINER+'[data-pid="'+this.controller.model.get("parent_post.id")+'"]').after(e.html),o(new s(e.post),i,r,{}),$(n.Binder.CONTAINER+'[data-pid="'+this.controller.model.get("parent_post.id")+'"]').find(".post-new").show()):(this.$form.trigger("reset"),$("#replyContainerSpacer").siblings(".lead").length>0&&$("#replyContainerSpacer").siblings(".lead").remove(),$("#replyContainerSpacer").before(e.html),o(new s(e.post),i,r,{}))}}.bind(this)).fail(function(){this._toggleForm(!1)}.bind(this))},n.prototype._onClickReset=function(e){e.preventDefault(),this.mcCmp.reset(),this._getFormField("startTime").val(this.controller.model.get("keyPoint.startTime")),this._getFormField("endTime").val(this.controller.model.get("keyPoint.endTime")),this._getFormField("content").val(""),this.controller.editKeyPoint({cancel:!0})},n.prototype._onClickCancelNew=function(e){e.preventDefault(),this.$container.remove(),this.controller.removeKeyPoint(),$(n.Binder.CONTAINER+'[data-pid="'+this.controller.model.get("parent_post.id")+'"]').find(".post-new").show()},n.prototype._onSelectionTimes=function(e,t){this._getFormField("startTime").val(e),this._getFormField("endTime").val(t)},n.prototype._onModelChange=function(e){this._onSelectionTimes(e.model.get("keyPoint.selection.startTime",""),e.model.get("keyPoint.selection.endTime",""))},n.prototype._updateForm=function(){var e=this._getFormField("attachedFile");e.html(this.mcCmp.generateFormData(e.data("prototype")))},n.prototype._onUploadStart=function(e){this.$submitNew.attr("disabled",!0)},n.prototype._onSuccess=function(e){this._updateForm(),this.$submitNew.attr("disabled",!1),this._toggleForm(!1)},n.prototype._onSuccessAndPost=function(e){this._updateForm(),this.$submitNew.trigger("click")},n.prototype._onReset=function(e){this._updateForm()},n.prototype._onError=function(e){alert("Error: "+e.error)},n}),define("views/post/editView",["views/post/newView"],function(e){"use strict";var t=function(n,r){e.prototype.constructor.apply(this,arguments),this.bind__onClickSubmitEdit=this._onClickSubmitEdit.bind(this),this.bind__onClickCancelEdit=this._onClickCancelEdit.bind(this),this.$submitEdit=this.$container.find(t.Binder.SUBMIT_EDIT),this.$cancelEdit=this.$container.find(t.Binder.CANCEL_EDIT),this.$submitEdit.on("click",this.bind__onClickSubmitEdit),this.$cancelEdit.on("click",this.bind__onClickCancelEdit)};return t.extend(e),t.TAG="PostEditView",t.Binder.SUBMIT_EDIT=".post-submit-edit",t.Binder.CANCEL_EDIT=".post-cancel-edit",t.prototype._toggleForm=function(e){this.$submitEdit.button(e?"loading":"reset"),this.$cancelEdit.attr("disabled",e)},t.prototype._onClickSubmitEdit=function(e){e.preventDefault();if(!this._preSubmit())return;this.controller.edit(this.$form[0]).done(function(e){this.$container.replaceWith(e.html),this.controller.model.get("is_temporal",!1)&&this.controller.editKeyPoint({cancel:!0});var t=this,n=require("views/post/viewView");t=new n(this.controller,this.controller.options),this.controller.onViewLoaded(),this.controller.model.forceChange()}.bind(this)).fail(function(){this._toggleForm(!1)}.bind(this))},t.prototype._onClickCancelEdit=function(e){e.preventDefault(),this.controller.view().done(function(e){this.$container.replaceWith(e.html),this.controller.model.get("is_temporal",!1)&&this.controller.editKeyPoint({cancel:!0});var t=this,n=require("views/post/viewView");t=new n(this.controller,this.controller.options),this.controller.onViewLoaded(),this.controller.model.forceChange()}.bind(this))},t}),define("views/post/viewView",["model/model","component/galleryComponent","views/post/editView"],function(e,t,n){"use strict";var r=function(n,i){this.controller=n,this.bind__onClickHoverKeyPoint=this._onClickHoverKeyPoint.bind(this),this.bind__onClickNew=this._onClickNew.bind(this),this.bind__onClickEdit=this._onClickEdit.bind(this),this.bind__onClickDelete=this._onClickDelete.bind(this),this.bind__onModelChange=this._onModelChange.bind(this),this.$container=$(r.Binder.CONTAINER+'[data-pid="'+this.controller.model.get("id")+'"]'),this.$timelineKeyPoint=this.$container.find(r.Binder.TIMELINE_KEYPOINT),this.$gallery=this.$container.find(r.Binder.GALLERY),this.$new=this.$container.find(r.Binder.NEW),this.$edit=this.$container.find(r.Binder.EDIT),this.$deleteModal=this.$container.find(r.Binder.DELETE_MODAL),this.$delete=this.$container.find(r.Binder.DELETE),this.$timelineKeyPoint.on("click",this.bind__onClickHoverKeyPoint),this.$timelineKeyPoint.on("dblclick",this.bind__onClickHoverKeyPoint),this.$timelineKeyPoint.hover(this.bind__onClickHoverKeyPoint,this.bind__onClickHoverKeyPoint),this.$new.on("click",this.bind__onClickNew),this.$edit.on("click",this.bind__onClickEdit),this.$delete.on("click",this.bind__onClickDelete),this.controller.model.subscribe(e.Event.CHANGE,this.bind__onModelChange);var s=this.controller.model.get("ordered_media");s&&s.length>0&&t.render({$container:this.$gallery,mode:t.Mode.INLINE,media:s},function(e){this.galleryCmp=e.galleryComponent,this.galleryCmp.show()}.bind(this)),$tt._instances.push(this)};return r.TAG="PostViewView",r.Binder={CONTAINER:".post-container",TIMELINE_KEYPOINT:".post-timeline-keypoint",GALLERY:".post-gallery",NEW:".post-new",EDIT:".post-edit",DELETE_MODAL:".post-delete-modal",DELETE:".post-delete"},r.prototype._onClickHoverKeyPoint=function(e){switch(e.type){case"mouseenter":case"mouseleave":this.controller.hoverKeyPoint({isMouseOver:e.type=="mouseenter"});break;case"click":case"dblclick":e.preventDefault(),this.controller.clickKeyPoint({isDblClick:e.type=="dblclick"})}},r.prototype._onClickNew=function(e){e.preventDefault(),this.$new.hide(),this.controller.new(null).done(function(e){this.$container.after(e.html)}.bind(this)).fail(function(){this.$new.show()}.bind(this))},r.prototype._onClickEdit=function(e){e.preventDefault(),this.controller.edit(null).done(function(e){this.$container.replaceWith(e.html),this.controller.model.get("is_temporal",!1)&&this.controller.editKeyPoint({cancel:!1});var t=this;t=new n(this.controller,this.controller.options),this.controller.onViewLoaded()}.bind(this))},r.prototype._onClickDelete=function(e){e.preventDefault(),this.$delete.button("loading"),this.controller.delete().done(function(e){this.$deleteModal.find(".modal-body").html("Post deleted successfully."),this.$deleteModal.data("bs.modal").isShown?(this.$deleteModal.on("hidden.bs.modal",function(e){this.$container.remove()}.bind(this)),this.$deleteModal.modal("hide"),this.$container.fadeOut("slow")):this.$container.fadeOut("slow",function(e){this.$container.remove()}.bind(this))}.bind(this)).fail(function(){this.$container.find(".modal-body").prepend("Something went wrong. Try again."),this.$delete.button("reset")}.bind(this))},r.prototype._renderKeyPoint=function(e,t,n){console.log("%s: %s",r.TAG,"_renderKeyPoint");var i=(100*e/n).toFixed(2),s=(100*t/n).toFixed(2),o=(s-i).toFixed(2);this.$timelineKeyPoint.css({left:i+"%",width:o+"%"})},r.prototype._hoverKeyPoint=function(e){e?this.$container.addClass("tt-post-container-highlight"):this.$container.removeClass("tt-post-container-highlight")},r.prototype._clickKeyPoint=function(e){var t=this.$container.find("video")[0];t&&e&&(t.currentTime=0,t.play())},r.prototype._onModelChange=function(e){this._renderKeyPoint(e.model.get("keyPoint.startTime",""),e.model.get("keyPoint.endTime",""),e.model.get("keyPoint.videoDuration","")),this._hoverKeyPoint(e.model.get("keyPoint.isPlayerHovering",!1)),this._clickKeyPoint(e.model.get("keyPoint.isPlayerPlaying",!1))},r}),define("views/thread/newView",["component/mediaChooserComponent","component/accessTypeComponent"],function(e,t){"use strict";var n=function(r,i){this.controller=r,this.bind__onClickSubmit=this._onClickSubmit.bind(this),this.bind__onUploadStart=this._onUploadStart.bind(this),this.bind__onSuccess=this._onSuccess.bind(this),this.bind__onReset=this._onReset.bind(this),this.bind__onError=this._onError.bind(this),this.$container=i.container,this.$form=this.$container.find("form[name^="+n.FORM_NAME+"]"),this.$submit=this.$container.find(n.Binder.SUBMIT),this.$submit.on("click",this.bind__onClickSubmit),this.atCmp=t.render(this.$form),this.mcCmp=e.render(this.$form),this.mcCmp.subscribe(e.Event.UPLOAD_START,this.bind__onUploadStart),this.mcCmp.subscribe(e.Event.SUCCESS,this.bind__onSuccess),this.mcCmp.subscribe(e.Event.RESET,this.bind__onReset),this.mcCmp.subscribe(e.Event.ERROR,this.bind__onError);var s=[];this._getFormField("mediaIncluded").children().each(function(e,t){s.push($(t).val())}),s.length>0&&(this.$submit.attr("disabled",!0),this.mcCmp.setMedia(s)),$tt._instances.push(this)};return n.TAG="ThreadNewView",n.Binder={SUBMIT:".thread-submit"},n.FORM_NAME="thread",n.prototype._getFormField=function(e){return this.$form.find("#"+n.FORM_NAME+"_"+e)},n.prototype._onClickSubmit=function(e){this.$form[0].checkValidity()&&this.$submit.button("loading")},n.prototype._updateForm=function(){var e=this._getFormField("mediaIncluded");e.html(this.mcCmp.generateFormData(e.data("prototype")))},n.prototype._onUploadStart=function(e){this.$submit.attr("disabled",!0)},n.prototype._onSuccess=function(e){this._updateForm(),this.$submit.attr("disabled",!1),this.mcCmp.media.length>0&&this._getFormField("title").attr("required",!1).parent().find("label").removeClass("required")},n.prototype._onReset=function(e){this._updateForm(),this.mcCmp.media.length==0&&this._getFormField("title").attr("required",!0).parent().find("label").addClass("required")},n.prototype._onError=function(e){alert("Error: "+e.error)},n}),define("views/thread/editView",["views/thread/newView"],function(e){"use strict";var t=function(n,r){e.prototype.constructor.apply(this,arguments),this.bind__onClickDelete=this._onClickDelete.bind(this),this.$deleteModal=this.$container.find(t.Binder.DELETE_MODAL),this.$delete=this.$container.find(t.Binder.DELETE),this.$delete.on("click",this.bind__onClickDelete)};return t.extend(e),t.TAG="ThreadEditView",t.Binder.DELETE_MODAL=".thread-delete-modal",t.Binder.DELETE=".thread-delete",t.prototype._onClickDelete=function(e){e.preventDefault(),this.$delete.button("loading"),this.controller.delete().done(function(e){this.$deleteModal.find(".modal-body").html("Topic deleted successfully.")}.bind(this)).fail(function(){this.$container.find(".modal-body").prepend("Something went wrong. Try again."),this.$delete.button("reset")}.bind(this))},t}),define("views/thread/viewView",["model/model"],function(e){"use strict";var t=function(n,r){this.controller=n,this.options=r,this.player=null,this.playingKeyPoint=null,this.bind__onClickVideoSpeed=this._onClickVideoSpeed.bind(this),this.bind__onClickClosedCaptions=this._onClickClosedCaptions.bind(this),this.bind__onAreaSelectionChanged=this._onAreaSelectionChanged.bind(this),this.bind__onMouseOverKeyPoint=this._onMouseOverKeyPoint.bind(this),this.bind__onMouseOutKeyPoint=this._onMouseOutKeyPoint.bind(this),this.bind__onClickKeyPoint=this._onClickKeyPoint.bind(this),this.bind__onEndKeyPoint=this._onEndKeyPoint.bind(this),this.bind__onPlaybackStarted=this._onPlaybackStarted.bind(this),this.bind__onPlaybackStopped=this._onPlaybackStopped.bind(this),this.bind__onSeek=this._onSeek.bind(this),this.bind__onModelChange=this._onModelChange.bind(this),this.$container=r.container;var i=this.$container.find(t.Binder.MEDIA_ELEMENT+" video");this.$video=i.eq(i.length==2?1:0),this.$pipVideo=i.eq(i.length==2?0:1),$("#videoSpeed").on("click",this.bind__onClickVideoSpeed),$("#closedCaptions").on("click",this.bind__onClickClosedCaptions);if(this.controller.model.get("type")===1&&this.controller.model.get("ordered_media").length>0){this.$video.on("loadedmetadata",function(e){this.controller.updateKeyPointDuration(e.target.duration)}.bind(this)),this._createPlayer();var s=this.controller.model.get("ordered_media.0");s&&s.is_interpretation&&(this.$pipVideo[0].currentTime=s.source_start_time)}this.controller.model.subscribe(e.Event.CHANGE,this.bind__onModelChange),$tt._instances.push(this)};return t.TAG="ThreadViewView",t.DEFAULT_TEMPORAL_COMMENT_LENGTH=3,t.Binder={MEDIA_ELEMENT:".thread-media-element"},t.prototype._createPlayer=function(){console.log("%s: %s",t.TAG,"_createPlayer"),this.player=new Player(this.$video,{areaSelectionEnabled:!1,updateTimeType:Player.DENSITY_BAR_UPDATE_TYPE_ABSOLUTE,audioBar:!1,overlayControls:!0,playHeadImage:this.options.player.playHeadImage,playHeadImageOnClick:function(){var e=this.player.getCurrentTime(),n=new KeyPoint(-1,e,e+t.DEFAULT_TEMPORAL_COMMENT_LENGTH,"",{drawOnTimeLine:!0});this._toggleTemporal(!1,n)}.bind(this)}),$(this.player).on(Player.EVENT_AREA_SELECTION_CHANGED,this.bind__onAreaSelectionChanged),$(this.player).on(Player.EVENT_KEYPOINT_MOUSE_OVER,this.bind__onMouseOverKeyPoint),$(this.player).on(Player.EVENT_KEYPOINT_MOUSE_OUT,this.bind__onMouseOutKeyPoint),$(this.player).on(Player.EVENT_KEYPOINT_CLICK,this.bind__onClickKeyPoint),$(this.player).on(Player.EVENT_KEYPOINT_END,this.bind__onEndKeyPoint),$(this.player).on(Player.EVENT_PLAYBACK_STARTED,this.bind__onPlaybackStarted),$(this.player).on(Player.EVENT_PLAYBACK_STOPPED,this.bind__onPlaybackStopped),$(this.player).on(Player.EVENT_SEEK,this.bind__onSeek),this.player.createControls()},t.prototype._onAreaSelectionChanged=function(e){console.log("%s: %s",t.TAG,Player.EVENT_AREA_SELECTION_CHANGED),this.controller.updateKeyPointSelectionTimes(this.player.getAreaSelectionTimes())},t.prototype._onMouseOverKeyPoint=function(e,n,r){console.log("%s: %s- keyPoint=%o, coords=%o",t.TAG,Player.EVENT_KEYPOINT_MOUSE_OVER,n,r),this.controller.hoverKeyPoint(n.id,{isMouseOver:!0}),$("#threadReplyContainer").is(":animated")||$("#threadReplyContainer").animate({scrollTop:$(".post-container[data-pid="+n.id+"]").position().top})},t.prototype._onMouseOutKeyPoint=function(e,n){console.log("%s: %s- keyPoint=%o",t.TAG,Player.EVENT_KEYPOINT_MOUSE_OUT,n),this.controller.hoverKeyPoint(n.id,{isMouseOver:!1})},t.prototype._onClickKeyPoint=function(e,n,r){console.log("%s: %s- keyPoint=%o, coords=%o",t.TAG,Player.EVENT_KEYPOINT_CLICK,n,r),this.controller.clickKeyPoint(n.id)},t.prototype._onEndKeyPoint=function(e,n){console.log("%s: %s- keyPoint=%o",t.TAG,Player.EVENT_KEYPOINT_END,n),this.playingKeyPoint&&this.playingKeyPoint.id==n.id&&this.player.pause()},t.prototype._onPlaybackStarted=function(e){console.log("%s: %s",t.TAG,Player.EVENT_PLAYBACK_STARTED);if(this.$pipVideo.length==0)return;this.$pipVideo[0].play()},t.prototype._onPlaybackStopped=function(e){console.log("%s: %s",t.TAG,Player.EVENT_PLAYBACK_STOPPED);if(this.$pipVideo.length==0)return;this.$pipVideo[0].pause()},t.prototype._onSeek=function(e,n){console.log("%s: %s- time=%s",t.TAG,Player.EVENT_SEEK,n);if(this.$pipVideo.length==0)return;this.$pipVideo[0].currentTime=Math.min(this.player.getCurrentTime()+this.controller.model.get("ordered_media.0.source_start_time"),this.$pipVideo[0].duration)},t.prototype._toggleTemporal=function(e,t){this.player.pause(),this.playingKeyPoint=null,!e&&t?(this.player.setPlayHeadImage(""),this.player.seek(t.startTime),this.player.setAreaSelectionStartTime(t.startTime),this.player.setAreaSelectionEndTime(t.endTime),this.player.setAreaSelectionEnabled(!0)):(this.player.setPlayHeadImage(this.options.player.playHeadImage),this.player.setAreaSelectionEnabled(!1))},t.prototype._onModelChange=function(e){if(!this.player)return;this.player.setKeyPoints(e.model.get("keyPoints",[])),this.controller.updateKeyPointDuration(this.$video[0].duration);if(e.keyPath.indexOf("keyPoints.")==0){var t=e.model.get(e.keyPath.substr(0,e.keyPath.lastIndexOf(".")));t instanceof KeyPoint&&(t.isEditing?this._toggleTemporal(!t.startTime||!t.endTime,t):this._toggleTemporal(!0),t.isSeeking&&(t.paintHighlightedTimeout=!0,t.paintHighlighted=!0,this.player.seek(t.startTime),this.player.redrawKeyPoints=!0,setTimeout(function(){t.paintHighlightedTimeout=!1,t.paintHighlighted=!1,this.player.redrawKeyPoints=!0,this.player.repaint()}.bind(this),3e3)),t.isPlaying?(this.playingKeyPoint=t,this.player.seek(t.startTime),this.player.play()):t.isHovering?(t.paintHighlighted=!0,this.player.redrawKeyPoints=!0):t.paintHighlightedTimeout||(t.paintHighlighted=!1,this.player.redrawKeyPoints=!0),this.player.repaint())}},t.prototype._onClickVideoSpeed=function(e){e.preventDefault();var t=this.controller.adjustVideoSpeed();this.$video[0].playbackRate=t.value,this.$pipVideo.length!=0&&(this.$pipVideo[0].playbackRate=t.value),$(e.target).attr("src",t.image)},t.prototype._onClickClosedCaptions=function(e){e.preventDefault();var t=$("#closed-caption-button img").attr("src");t=t==this.options.player.captionImages.on?this.options.player.captionImages.off:this.options.player.captionImages.on,$("#closed-caption-button img").attr("src",t)},t}),define("main",["controller/message","controller/profile","bootstrap","service","core/helper","core/subscriber","factory/contactFactory","factory/forumFactory","factory/groupFactory","factory/mediaFactory","factory/myFilesFactory","factory/postFactory","factory/threadFactory","service/keyPointService","service/subscriberService","model/forumModel","model/groupModel","model/mediaModel","model/myFilesModel","model/postModel","model/threadModel","controller/contactController","controller/forumController","controller/groupController","controller/myFilesController","controller/postController","controller/threadController","component/accessTypeComponent","component/galleryComponent","component/mediaChooserComponent","component/myFilesSelectorComponent","component/recorderComponent","component/tableComponent","views/contact/listView","views/forum/newView","views/forum/editView","views/forum/viewView","views/group/newView","views/group/editView","views/group/viewView","views/group/manageView","views/myFiles/listView","views/post/newView","views/post/editView","views/post/viewView","views/thread/newView","views/thread/editView","views/thread/viewView"],function(){"use strict";var e={};e.Controller={},e.Controller.Message=require("controller/message"),e.Controller.Profile=require("controller/profile"),e._services=[],e._instances=[],window.TerpTube=e,window.$tt=window.TerpTube;var t=require("core/helper");t.autoSize(),dust.helpers.generateUrl=function(e,n,r,i){return e.write(t.generateUrl(i.path))}}),require(["main"]);