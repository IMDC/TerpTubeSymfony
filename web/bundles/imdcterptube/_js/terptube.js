/*! Dust - Asynchronous Templating - v2.5.1
* http://linkedin.github.io/dustjs/
* Copyright (c) 2014 Aleksander Williams; Released under the MIT License */

/*! dustjs-helpers - v1.5.0
* https://github.com/linkedin/dustjs-helpers
* Copyright (c) 2014 Aleksander Williams; Released under the MIT License */

//     Underscore.js 1.7.0
//     http://underscorejs.org
//     (c) 2009-2014 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
//     Underscore may be freely distributed under the MIT license.

!function(root){function Context(e,t,n,r){this.stack=e,this.global=t,this.blocks=n,this.templateName=r}function Stack(e,t,n,r){this.tail=t,this.isObject=e&&"object"==typeof e,this.head=e,this.index=n,this.of=r}function Stub(e){this.head=new Chunk(this),this.callback=e,this.out=""}function Stream(){this.head=new Chunk(this)}function Chunk(e,t,n){this.root=e,this.next=t,this.data=[],this.flushable=!1,this.taps=n}function Tap(e,t){this.head=e,this.tail=t}var dust={},NONE="NONE",ERROR="ERROR",WARN="WARN",INFO="INFO",DEBUG="DEBUG",loggingLevels=[DEBUG,INFO,WARN,ERROR,NONE],EMPTY_FUNC=function(){},logger={},originalLog,loggerContext;dust.debugLevel=NONE,dust.config={whitespace:!1},dust._aliases={write:"w",end:"e",map:"m",render:"r",reference:"f",section:"s",exists:"x",notexists:"nx",block:"b",partial:"p",helper:"h"},root&&root.console&&root.console.log&&(loggerContext=root.console,originalLog=root.console.log),logger.log=loggerContext?function(){logger.log="function"==typeof originalLog?function(){originalLog.apply(loggerContext,arguments)}:function(){var e=Array.prototype.slice.apply(arguments).join(" ");originalLog(e)},logger.log.apply(this,arguments)}:function(){},dust.log=function(e,t){t=t||INFO,dust.debugLevel!==NONE&&dust.indexInArray(loggingLevels,t)>=dust.indexInArray(loggingLevels,dust.debugLevel)&&(dust.logQueue||(dust.logQueue=[]),dust.logQueue.push({message:e,type:t}),logger.log("[DUST "+t+"]: "+e))},dust.helpers={},dust.cache={},dust.register=function(e,t){e&&(dust.cache[e]=t)},dust.render=function(e,t,n){var r=(new Stub(n)).head;try{dust.load(e,r,Context.wrap(t,e)).end()}catch(i){r.setError(i)}},dust.stream=function(e,t){var n=new Stream,r=n.head;return dust.nextTick(function(){try{dust.load(e,n.head,Context.wrap(t,e)).end()}catch(i){r.setError(i)}}),n},dust.renderSource=function(e,t,n){return dust.compileFn(e)(t,n)},dust.compileFn=function(e,t){t=t||null;var n=dust.loadSource(dust.compile(e,t));return function(e,r){var i=r?new Stub(r):new Stream;return dust.nextTick(function(){"function"==typeof n?n(i.head,Context.wrap(e,t)).end():dust.log(new Error("Template ["+t+"] cannot be resolved to a Dust function"),ERROR)}),i}},dust.load=function(e,t,n){var r=dust.cache[e];return r?r(t,n):dust.onLoad?t.map(function(t){dust.onLoad(e,function(r,i){return r?t.setError(r):(dust.cache[e]||dust.loadSource(dust.compile(i,e)),void dust.cache[e](t,n).end())})}):t.setError(new Error("Template Not Found: "+e))},dust.loadSource=function(source,path){return eval(source)},dust.isArray=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},dust.indexInArray=function(e,t,n){if(n=+n||0,Array.prototype.indexOf)return e.indexOf(t,n);if(void 0===e||null===e)throw new TypeError('cannot call method "indexOf" of null');var r=e.length;for(1/0===Math.abs(n)&&(n=0),0>n&&(n+=r,0>n&&(n=0));r>n;n++)if(e[n]===t)return n;return-1},dust.nextTick=function(){return function(e){setTimeout(e,0)}}(),dust.isEmpty=function(e){return dust.isArray(e)&&!e.length?!0:0===e?!1:!e},dust.filter=function(e,t,n){if(n)for(var r=0,i=n.length;i>r;r++){var s=n[r];"s"===s?t=null:"function"==typeof dust.filters[s]?e=dust.filters[s](e):dust.log("Invalid filter ["+s+"]",WARN)}return t&&(e=dust.filters[t](e)),e},dust.filters={h:function(e){return dust.escapeHtml(e)},j:function(e){return dust.escapeJs(e)},u:encodeURI,uc:encodeURIComponent,js:function(e){return JSON?JSON.stringify(e):(dust.log("JSON is undefined.  JSON stringify has not been used on ["+e+"]",WARN),e)},jp:function(e){return JSON?JSON.parse(e):(dust.log("JSON is undefined.  JSON parse has not been used on ["+e+"]",WARN),e)}},dust.makeBase=function(e){return new Context(new Stack,e)},Context.wrap=function(e,t){return e instanceof Context?e:new Context(new Stack(e),{},null,t)},Context.prototype.get=function(e,t){return"string"==typeof e&&("."===e[0]&&(t=!0,e=e.substr(1)),e=e.split(".")),this._get(t,e)},Context.prototype._get=function(e,t){var n,r,i,s,o,u=this.stack,a=1;if(r=t[0],i=t.length,e&&0===i)s=u,u=u.head;else{if(e)u&&(u=u.head?u.head[r]:void 0);else{for(;u&&(!u.isObject||(s=u.head,n=u.head[r],void 0===n));)u=u.tail;u=void 0!==n?n:this.global?this.global[r]:void 0}for(;u&&i>a;)s=u,u=u[t[a]],a++}return"function"==typeof u?(o=function(){try{return u.apply(s,arguments)}catch(e){throw dust.log(e,ERROR),e}},o.__dustBody=!!u.__dustBody,o):(void 0===u&&dust.log("Cannot find the value for reference [{"+t.join(".")+"}] in template ["+this.getTemplateName()+"]"),u)},Context.prototype.getPath=function(e,t){return this._get(e,t)},Context.prototype.push=function(e,t,n){return new Context(new Stack(e,this.stack,t,n),this.global,this.blocks,this.getTemplateName())},Context.prototype.rebase=function(e){return new Context(new Stack(e),this.global,this.blocks,this.getTemplateName())},Context.prototype.current=function(){return this.stack.head},Context.prototype.getBlock=function(e){if("function"==typeof e){var t=new Chunk;e=e(t,this).data.join("")}var n=this.blocks;if(!n)return void dust.log("No blocks for context[{"+e+"}] in template ["+this.getTemplateName()+"]",DEBUG);for(var r,i=n.length;i--;)if(r=n[i][e])return r},Context.prototype.shiftBlocks=function(e){var t,n=this.blocks;return e?(t=n?n.concat([e]):[e],new Context(this.stack,this.global,t,this.getTemplateName())):this},Context.prototype.getTemplateName=function(){return this.templateName},Stub.prototype.flush=function(){for(var e=this.head;e;){if(!e.flushable)return e.error?(this.callback(e.error),dust.log("Chunk error ["+e.error+"] thrown. Ceasing to render this template.",WARN),void (this.flush=EMPTY_FUNC)):void 0;this.out+=e.data.join(""),e=e.next,this.head=e}this.callback(null,this.out)},Stream.prototype.flush=function(){for(var e=this.head;e;){if(!e.flushable)return e.error?(this.emit("error",e.error),dust.log("Chunk error ["+e.error+"] thrown. Ceasing to render this template.",WARN),void (this.flush=EMPTY_FUNC)):void 0;this.emit("data",e.data.join("")),e=e.next,this.head=e}this.emit("end")},Stream.prototype.emit=function(e,t){if(!this.events)return dust.log("No events to emit",INFO),!1;var n=this.events[e];if(!n)return dust.log("Event type ["+e+"] does not exist",WARN),!1;if("function"==typeof n)n(t);else if(dust.isArray(n))for(var r=n.slice(0),i=0,s=r.length;s>i;i++)r[i](t);else dust.log("Event Handler ["+n+"] is not of a type that is handled by emit",WARN)},Stream.prototype.on=function(e,t){return this.events||(this.events={}),this.events[e]?"function"==typeof this.events[e]?this.events[e]=[this.events[e],t]:this.events[e].push(t):t?this.events[e]=t:dust.log("Callback for type ["+e+"] does not exist. Listener not registered.",WARN),this},Stream.prototype.pipe=function(e){return this.on("data",function(t){try{e.write(t,"utf8")}catch(n){dust.log(n,ERROR)}}).on("end",function(){try{return e.end()}catch(t){dust.log(t,ERROR)}}).on("error",function(t){e.error(t)}),this},Chunk.prototype.write=function(e){var t=this.taps;return t&&(e=t.go(e)),this.data.push(e),this},Chunk.prototype.end=function(e){return e&&this.write(e),this.flushable=!0,this.root.flush(),this},Chunk.prototype.map=function(e){var t=new Chunk(this.root,this.next,this.taps),n=new Chunk(this.root,t,this.taps);this.next=n,this.flushable=!0;try{e(n)}catch(r){dust.log(r,ERROR),n.setError(r)}return t},Chunk.prototype.tap=function(e){var t=this.taps;return this.taps=t?t.push(e):new Tap(e),this},Chunk.prototype.untap=function(){return this.taps=this.taps.tail,this},Chunk.prototype.render=function(e,t){return e(this,t)},Chunk.prototype.reference=function(e,t,n,r){return"function"==typeof e&&(e=e.apply(t.current(),[this,t,null,{auto:n,filters:r}]),e instanceof Chunk)?e:dust.isEmpty(e)?this:this.write(dust.filter(e,n,r))},Chunk.prototype.section=function(e,t,n,r){if("function"==typeof e&&!e.__dustBody){try{e=e.apply(t.current(),[this,t,n,r])}catch(i){return dust.log(i,ERROR),this.setError(i)}if(e instanceof Chunk)return e}var s=n.block,o=n["else"];if(r&&(t=t.push(r)),dust.isArray(e)){if(s){var u=e.length,a=this;if(u>0){t.stack.head&&(t.stack.head.$len=u);for(var f=0;u>f;f++)t.stack.head&&(t.stack.head.$idx=f),a=s(a,t.push(e[f],f,u));return t.stack.head&&(t.stack.head.$idx=void 0,t.stack.head.$len=void 0),a}if(o)return o(this,t)}}else if(e===!0){if(s)return s(this,t)}else if(e||0===e){if(s)return s(this,t.push(e))}else if(o)return o(this,t);return dust.log("Not rendering section (#) block in template ["+t.getTemplateName()+"], because above key was not found",DEBUG),this},Chunk.prototype.exists=function(e,t,n){var r=n.block,i=n["else"];if(dust.isEmpty(e)){if(i)return i(this,t)}else if(r)return r(this,t);return dust.log("Not rendering exists (?) block in template ["+t.getTemplateName()+"], because above key was not found",DEBUG),this},Chunk.prototype.notexists=function(e,t,n){var r=n.block,i=n["else"];if(dust.isEmpty(e)){if(r)return r(this,t)}else if(i)return i(this,t);return dust.log("Not rendering not exists (^) block check in template ["+t.getTemplateName()+"], because above key was found",DEBUG),this},Chunk.prototype.block=function(e,t,n){var r=n.block;return e&&(r=e),r?r(this,t):this},Chunk.prototype.partial=function(e,t,n){var r;r=dust.makeBase(t.global),r.blocks=t.blocks,t.stack&&t.stack.tail&&(r.stack=t.stack.tail),n&&(r=r.push(n)),"string"==typeof e&&(r.templateName=e),r=r.push(t.stack.head);var i;return i="function"==typeof e?this.capture(e,r,function(e,t){r.templateName=r.templateName||e,dust.load(e,t,r).end()}):dust.load(e,this,r)},Chunk.prototype.helper=function(e,t,n,r){var i=this;if(!dust.helpers[e])return dust.log("Invalid helper ["+e+"]",WARN),i;try{return dust.helpers[e](i,t,n,r)}catch(s){return dust.log("Error in "+e+" helper: "+s,ERROR),i.setError(s)}},Chunk.prototype.capture=function(e,t,n){return this.map(function(r){var i=new Stub(function(e,t){e?r.setError(e):n(t,r)});e(i.head,t).end()})},Chunk.prototype.setError=function(e){return this.error=e,this.root.flush(),this};for(var f in Chunk.prototype)dust._aliases[f]&&(Chunk.prototype[dust._aliases[f]]=Chunk.prototype[f]);Tap.prototype.push=function(e){return new Tap(e,this)},Tap.prototype.go=function(e){for(var t=this;t;)e=t.head(e),t=t.tail;return e};var HCHARS=/[&<>"']/,AMP=/&/g,LT=/</g,GT=/>/g,QUOT=/\"/g,SQUOT=/\'/g;dust.escapeHtml=function(e){return"string"==typeof e&&HCHARS.test(e)?e.replace(AMP,"&amp;").replace(LT,"&lt;").replace(GT,"&gt;").replace(QUOT,"&quot;").replace(SQUOT,"&#39;"):e};var BS=/\\/g,FS=/\//g,CR=/\r/g,LS=/\u2028/g,PS=/\u2029/g,NL=/\n/g,LF=/\f/g,SQ=/'/g,DQ=/"/g,TB=/\t/g;dust.escapeJs=function(e){return"string"==typeof e?e.replace(BS,"\\\\").replace(FS,"\\/").replace(DQ,'\\"').replace(SQ,"\\'").replace(CR,"\\r").replace(LS,"\\u2028").replace(PS,"\\u2029").replace(NL,"\\n").replace(LF,"\\f").replace(TB,"\\t"):e},"object"==typeof exports?module.exports=dust:root.dust=dust}(function(){return this}()),function(e,t){"object"==typeof exports?module.exports=t(require("./dust")):t(e.dust)}(this,function(e){var t=function(){function e(e,t){function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n}function t(e,t,n,r,i,s){this.message=e,this.expected=t,this.found=n,this.offset=r,this.line=i,this.column=s,this.name="SyntaxError"}function n(e){function n(){return s(vr).line}function r(){return s(vr).column}function i(e){throw u(e,null,vr)}function s(t){function n(t,n,r){var i,s;for(i=n;r>i;i++)s=e.charAt(i),"\n"===s?(t.seenCR||t.line++,t.column=1,t.seenCR=!1):"\r"===s||"\u2028"===s||"\u2029"===s?(t.line++,t.column=1,t.seenCR=!0):(t.column++,t.seenCR=!1)}return mr!==t&&(mr>t&&(mr=0,gr={line:1,column:1,seenCR:!1}),n(gr,mr,t),mr=t),gr}function o(e){yr>dr||(dr>yr&&(yr=dr,br=[]),br.push(e))}function u(n,r,i){function o(e){var t=1;for(e.sort(function(e,t){return e.description<t.description?-1:e.description>t.description?1:0});t<e.length;)e[t-1]===e[t]?e.splice(t,1):t++}function u(e,t){function n(e){function t(e){return e.charCodeAt(0).toString(16).toUpperCase()}return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(e){return"\\x0"+t(e)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(e){return"\\x"+t(e)}).replace(/[\u0180-\u0FFF]/g,function(e){return"\\u0"+t(e)}).replace(/[\u1080-\uFFFF]/g,function(e){return"\\u"+t(e)})}var r,i,s,o=new Array(e.length);for(s=0;s<e.length;s++)o[s]=e[s].description;return r=e.length>1?o.slice(0,-1).join(", ")+" or "+o[e.length-1]:o[0],i=t?'"'+n(t)+'"':"end of input","Expected "+r+" but "+i+" found."}var a=s(i),f=i<e.length?e.charAt(i):null;return null!==r&&o(r),new t(null!==n?n:u(r,f),r,f,i,a.line,a.column)}function a(){var e;return e=f()}function f(){var e,t,n;for(e=dr,t=[],n=l();n!==V;)t.push(n),n=l();return t!==V&&(vr=e,t=K(t)),e=t}function l(){var e;return e=H(),e===V&&(e=B(),e===V&&(e=c(),e===V&&(e=y(),e===V&&(e=E(),e===V&&(e=g(),e===V&&(e=_())))))),e}function c(){var t,n,r,i,s,u,a,l;if(wr++,t=dr,n=h(),n!==V){for(r=[],i=z();i!==V;)r.push(i),i=z();r!==V?(i=I(),i!==V?(s=f(),s!==V?(u=m(),u!==V?(a=p(),a===V&&(a=Y),a!==V?(vr=dr,l=Z(n,s,u,a),l=l?et:G,l!==V?(vr=t,n=tt(n,s,u,a),t=n):(dr=t,t=G)):(dr=t,t=G)):(dr=t,t=G)):(dr=t,t=G)):(dr=t,t=G)):(dr=t,t=G)}else dr=t,t=G;if(t===V)if(t=dr,n=h(),n!==V){for(r=[],i=z();i!==V;)r.push(i),i=z();r!==V?(47===e.charCodeAt(dr)?(i=nt,dr++):(i=V,0===wr&&o(rt)),i!==V?(s=I(),s!==V?(vr=t,n=it(n),t=n):(dr=t,t=G)):(dr=t,t=G)):(dr=t,t=G)}else dr=t,t=G;return wr--,t===V&&(n=V,0===wr&&o(Q)),t}function h(){var t,n,r,i,s,u,a;if(t=dr,n=F(),n!==V)if(st.test(e.charAt(dr))?(r=e.charAt(dr),dr++):(r=V,0===wr&&o(ot)),r!==V){for(i=[],s=z();s!==V;)i.push(s),s=z();i!==V?(s=S(),s!==V?(u=d(),u!==V?(a=v(),a!==V?(vr=t,n=ut(r,s,u,a),t=n):(dr=t,t=G)):(dr=t,t=G)):(dr=t,t=G)):(dr=t,t=G)}else dr=t,t=G;else dr=t,t=G;return t}function p(){var t,n,r,i,s,u,a;if(wr++,t=dr,n=F(),n!==V)if(47===e.charCodeAt(dr)?(r=nt,dr++):(r=V,0===wr&&o(rt)),r!==V){for(i=[],s=z();s!==V;)i.push(s),s=z();if(i!==V)if(s=S(),s!==V){for(u=[],a=z();a!==V;)u.push(a),a=z();u!==V?(a=I(),a!==V?(vr=t,n=ft(s),t=n):(dr=t,t=G)):(dr=t,t=G)}else dr=t,t=G;else dr=t,t=G}else dr=t,t=G;else dr=t,t=G;return wr--,t===V&&(n=V,0===wr&&o(at)),t}function d(){var t,n,r,i;return t=dr,n=dr,58===e.charCodeAt(dr)?(r=lt,dr++):(r=V,0===wr&&o(ct)),r!==V?(i=S(),i!==V?(vr=n,r=ht(i),n=r):(dr=n,n=G)):(dr=n,n=G),n===V&&(n=Y),n!==V&&(vr=t,n=pt(n)),t=n}function v(){var t,n,r,i,s,u,a;if(wr++,t=dr,n=[],r=dr,i=[],s=z(),s!==V)for(;s!==V;)i.push(s),s=z();else i=G;for(i!==V?(s=k(),s!==V?(61===e.charCodeAt(dr)?(u=vt,dr++):(u=V,0===wr&&o(mt)),u!==V?(a=x(),a===V&&(a=S(),a===V&&(a=O())),a!==V?(vr=r,i=gt(s,a),r=i):(dr=r,r=G)):(dr=r,r=G)):(dr=r,r=G)):(dr=r,r=G);r!==V;){if(n.push(r),r=dr,i=[],s=z(),s!==V)for(;s!==V;)i.push(s),s=z();else i=G;i!==V?(s=k(),s!==V?(61===e.charCodeAt(dr)?(u=vt,dr++):(u=V,0===wr&&o(mt)),u!==V?(a=x(),a===V&&(a=S(),a===V&&(a=O())),a!==V?(vr=r,i=gt(s,a),r=i):(dr=r,r=G)):(dr=r,r=G)):(dr=r,r=G)):(dr=r,r=G)}return n!==V&&(vr=t,n=yt(n)),t=n,wr--,t===V&&(n=V,0===wr&&o(dt)),t}function m(){var t,n,r,i,s,u,a,l;for(wr++,t=dr,n=[],r=dr,i=F(),i!==V?(58===e.charCodeAt(dr)?(s=lt,dr++):(s=V,0===wr&&o(ct)),s!==V?(u=k(),u!==V?(a=I(),a!==V?(l=f(),l!==V?(vr=r,i=gt(u,l),r=i):(dr=r,r=G)):(dr=r,r=G)):(dr=r,r=G)):(dr=r,r=G)):(dr=r,r=G);r!==V;)n.push(r),r=dr,i=F(),i!==V?(58===e.charCodeAt(dr)?(s=lt,dr++):(s=V,0===wr&&o(ct)),s!==V?(u=k(),u!==V?(a=I(),a!==V?(l=f(),l!==V?(vr=r,i=gt(u,l),r=i):(dr=r,r=G)):(dr=r,r=G)):(dr=r,r=G)):(dr=r,r=G)):(dr=r,r=G);return n!==V&&(vr=t,n=wt(n)),t=n,wr--,t===V&&(n=V,0===wr&&o(bt)),t}function g(){var e,t,n,r,i;return wr++,e=dr,t=F(),t!==V?(n=S(),n!==V?(r=w(),r!==V?(i=I(),i!==V?(vr=e,t=St(n,r),e=t):(dr=e,e=G)):(dr=e,e=G)):(dr=e,e=G)):(dr=e,e=G),wr--,e===V&&(t=V,0===wr&&o(Et)),e}function y(){var t,n,r,i,s,u,a,f,l,c;if(wr++,t=dr,n=F(),n!==V)if(62===e.charCodeAt(dr)?(r=Tt,dr++):(r=V,0===wr&&o(Nt)),r===V&&(43===e.charCodeAt(dr)?(r=Ct,dr++):(r=V,0===wr&&o(kt))),r!==V){for(i=[],s=z();s!==V;)i.push(s),s=z();if(i!==V)if(s=dr,u=k(),u!==V&&(vr=s,u=Lt(u)),s=u,s===V&&(s=O()),s!==V)if(u=d(),u!==V)if(a=v(),a!==V){for(f=[],l=z();l!==V;)f.push(l),l=z();f!==V?(47===e.charCodeAt(dr)?(l=nt,dr++):(l=V,0===wr&&o(rt)),l!==V?(c=I(),c!==V?(vr=t,n=At(r,s,u,a),t=n):(dr=t,t=G)):(dr=t,t=G)):(dr=t,t=G)}else dr=t,t=G;else dr=t,t=G;else dr=t,t=G;else dr=t,t=G}else dr=t,t=G;else dr=t,t=G;return wr--,t===V&&(n=V,0===wr&&o(xt)),t}function w(){var t,n,r,i,s;for(wr++,t=dr,n=[],r=dr,124===e.charCodeAt(dr)?(i=Mt,dr++):(i=V,0===wr&&o(_t)),i!==V?(s=k(),s!==V?(vr=r,i=ht(s),r=i):(dr=r,r=G)):(dr=r,r=G);r!==V;)n.push(r),r=dr,124===e.charCodeAt(dr)?(i=Mt,dr++):(i=V,0===wr&&o(_t)),i!==V?(s=k(),s!==V?(vr=r,i=ht(s),r=i):(dr=r,r=G)):(dr=r,r=G);return n!==V&&(vr=t,n=Dt(n)),t=n,wr--,t===V&&(n=V,0===wr&&o(Ot)),t}function E(){var t,n,r,i,s;return wr++,t=dr,n=F(),n!==V?(126===e.charCodeAt(dr)?(r=Ht,dr++):(r=V,0===wr&&o(Bt)),r!==V?(i=k(),i!==V?(s=I(),s!==V?(vr=t,n=jt(i),t=n):(dr=t,t=G)):(dr=t,t=G)):(dr=t,t=G)):(dr=t,t=G),wr--,t===V&&(n=V,0===wr&&o(Pt)),t}function S(){var e,t;return wr++,e=dr,t=C(),t!==V&&(vr=e,t=It(t)),e=t,e===V&&(e=dr,t=k(),t!==V&&(vr=e,t=qt(t)),e=t),wr--,e===V&&(t=V,0===wr&&o(Ft)),e}function x(){var e,t;return wr++,e=dr,t=T(),t===V&&(t=N()),t!==V&&(vr=e,t=Ut(t)),e=t,wr--,e===V&&(t=V,0===wr&&o(Rt)),e}function T(){var t,n,r,i,s;if(wr++,t=dr,n=N(),n!==V)if(46===e.charCodeAt(dr)?(r=Wt,dr++):(r=V,0===wr&&o(Xt)),r!==V){if(i=[],s=N(),s!==V)for(;s!==V;)i.push(s),s=N();else i=G;i!==V?(vr=t,n=Vt(n,i),t=n):(dr=t,t=G)}else dr=t,t=G;else dr=t,t=G;return wr--,t===V&&(n=V,0===wr&&o(zt)),t}function N(){var t,n,r;if(wr++,t=dr,n=[],Jt.test(e.charAt(dr))?(r=e.charAt(dr),dr++):(r=V,0===wr&&o(Kt)),r!==V)for(;r!==V;)n.push(r),Jt.test(e.charAt(dr))?(r=e.charAt(dr),dr++):(r=V,0===wr&&o(Kt));else n=G;return n!==V&&(vr=t,n=Qt(n)),t=n,wr--,t===V&&(n=V,0===wr&&o($t)),t}function C(){var t,n,r,i;if(wr++,t=dr,n=k(),n===V&&(n=Y),n!==V){if(r=[],i=A(),i===V&&(i=L()),i!==V)for(;i!==V;)r.push(i),i=A(),i===V&&(i=L());else r=G;r!==V?(vr=t,n=Yt(n,r),t=n):(dr=t,t=G)}else dr=t,t=G;if(t===V)if(t=dr,46===e.charCodeAt(dr)?(n=Wt,dr++):(n=V,0===wr&&o(Xt)),n!==V){for(r=[],i=A(),i===V&&(i=L());i!==V;)r.push(i),i=A(),i===V&&(i=L());r!==V?(vr=t,n=Zt(r),t=n):(dr=t,t=G)}else dr=t,t=G;return wr--,t===V&&(n=V,0===wr&&o(Gt)),t}function k(){var t,n,r,i;if(wr++,t=dr,tn.test(e.charAt(dr))?(n=e.charAt(dr),dr++):(n=V,0===wr&&o(nn)),n!==V){for(r=[],rn.test(e.charAt(dr))?(i=e.charAt(dr),dr++):(i=V,0===wr&&o(sn));i!==V;)r.push(i),rn.test(e.charAt(dr))?(i=e.charAt(dr),dr++):(i=V,0===wr&&o(sn));r!==V?(vr=t,n=on(n,r),t=n):(dr=t,t=G)}else dr=t,t=G;return wr--,t===V&&(n=V,0===wr&&o(en)),t}function L(){var t,n,r,i,s,u;if(wr++,t=dr,n=dr,r=q(),r!==V){if(i=dr,s=[],Jt.test(e.charAt(dr))?(u=e.charAt(dr),dr++):(u=V,0===wr&&o(Kt)),u!==V)for(;u!==V;)s.push(u),Jt.test(e.charAt(dr))?(u=e.charAt(dr),dr++):(u=V,0===wr&&o(Kt));else s=G;s!==V&&(vr=i,s=an(s)),i=s,i===V&&(i=S()),i!==V?(s=R(),s!==V?(vr=n,r=fn(i),n=r):(dr=n,n=G)):(dr=n,n=G)}else dr=n,n=G;return n!==V?(r=A(),r===V&&(r=Y),r!==V?(vr=t,n=ln(n,r),t=n):(dr=t,t=G)):(dr=t,t=G),wr--,t===V&&(n=V,0===wr&&o(un)),t}function A(){var t,n,r,i,s;if(wr++,t=dr,n=[],r=dr,46===e.charCodeAt(dr)?(i=Wt,dr++):(i=V,0===wr&&o(Xt)),i!==V?(s=k(),s!==V?(vr=r,i=hn(s),r=i):(dr=r,r=G)):(dr=r,r=G),r!==V)for(;r!==V;)n.push(r),r=dr,46===e.charCodeAt(dr)?(i=Wt,dr++):(i=V,0===wr&&o(Xt)),i!==V?(s=k(),s!==V?(vr=r,i=hn(s),r=i):(dr=r,r=G)):(dr=r,r=G);else n=G;return n!==V?(r=L(),r===V&&(r=Y),r!==V?(vr=t,n=pn(n,r),t=n):(dr=t,t=G)):(dr=t,t=G),wr--,t===V&&(n=V,0===wr&&o(cn)),t}function O(){var t,n,r,i;if(wr++,t=dr,34===e.charCodeAt(dr)?(n=vn,dr++):(n=V,0===wr&&o(mn)),n!==V?(34===e.charCodeAt(dr)?(r=vn,dr++):(r=V,0===wr&&o(mn)),r!==V?(vr=t,n=gn(),t=n):(dr=t,t=G)):(dr=t,t=G),t===V&&(t=dr,34===e.charCodeAt(dr)?(n=vn,dr++):(n=V,0===wr&&o(mn)),n!==V?(r=D(),r!==V?(34===e.charCodeAt(dr)?(i=vn,dr++):(i=V,0===wr&&o(mn)),i!==V?(vr=t,n=yn(r),t=n):(dr=t,t=G)):(dr=t,t=G)):(dr=t,t=G),t===V))if(t=dr,34===e.charCodeAt(dr)?(n=vn,dr++):(n=V,0===wr&&o(mn)),n!==V){if(r=[],i=M(),i!==V)for(;i!==V;)r.push(i),i=M();else r=G;r!==V?(34===e.charCodeAt(dr)?(i=vn,dr++):(i=V,0===wr&&o(mn)),i!==V?(vr=t,n=bn(r),t=n):(dr=t,t=G)):(dr=t,t=G)}else dr=t,t=G;return wr--,t===V&&(n=V,0===wr&&o(dn)),t}function M(){var e,t;return e=E(),e===V&&(e=g(),e===V&&(e=dr,t=D(),t!==V&&(vr=e,t=wn(t)),e=t)),e}function _(){var t,n,r,i,s,u,a,f;if(wr++,t=dr,n=U(),n!==V){for(r=[],i=z();i!==V;)r.push(i),i=z();r!==V?(vr=t,n=Sn(n,r),t=n):(dr=t,t=G)}else dr=t,t=G;if(t===V){if(t=dr,n=[],r=dr,i=dr,wr++,s=j(),wr--,s===V?i=et:(dr=i,i=G),i!==V?(s=dr,wr++,u=H(),wr--,u===V?s=et:(dr=s,s=G),s!==V?(u=dr,wr++,a=B(),wr--,a===V?u=et:(dr=u,u=G),u!==V?(a=dr,wr++,f=U(),wr--,f===V?a=et:(dr=a,a=G),a!==V?(e.length>dr?(f=e.charAt(dr),dr++):(f=V,0===wr&&o(xn)),f!==V?(vr=r,i=Tn(f),r=i):(dr=r,r=G)):(dr=r,r=G)):(dr=r,r=G)):(dr=r,r=G)):(dr=r,r=G),r!==V)for(;r!==V;)n.push(r),r=dr,i=dr,wr++,s=j(),wr--,s===V?i=et:(dr=i,i=G),i!==V?(s=dr,wr++,u=H(),wr--,u===V?s=et:(dr=s,s=G),s!==V?(u=dr,wr++,a=B(),wr--,a===V?u=et:(dr=u,u=G),u!==V?(a=dr,wr++,f=U(),wr--,f===V?a=et:(dr=a,a=G),a!==V?(e.length>dr?(f=e.charAt(dr),dr++):(f=V,0===wr&&o(xn)),f!==V?(vr=r,i=Tn(f),r=i):(dr=r,r=G)):(dr=r,r=G)):(dr=r,r=G)):(dr=r,r=G)):(dr=r,r=G);else n=G;n!==V&&(vr=t,n=Nn(n)),t=n}return wr--,t===V&&(n=V,0===wr&&o(En)),t}function D(){var t,n,r,i,s;if(wr++,t=dr,n=[],r=dr,i=dr,wr++,s=j(),wr--,s===V?i=et:(dr=i,i=G),i!==V?(s=P(),s===V&&(kn.test(e.charAt(dr))?(s=e.charAt(dr),dr++):(s=V,0===wr&&o(Ln))),s!==V?(vr=r,i=Tn(s),r=i):(dr=r,r=G)):(dr=r,r=G),r!==V)for(;r!==V;)n.push(r),r=dr,i=dr,wr++,s=j(),wr--,s===V?i=et:(dr=i,i=G),i!==V?(s=P(),s===V&&(kn.test(e.charAt(dr))?(s=e.charAt(dr),dr++):(s=V,0===wr&&o(Ln))),s!==V?(vr=r,i=Tn(s),r=i):(dr=r,r=G)):(dr=r,r=G);else n=G;return n!==V&&(vr=t,n=An(n)),t=n,wr--,t===V&&(n=V,0===wr&&o(Cn)),t}function P(){var t,n;return t=dr,e.substr(dr,2)===On?(n=On,dr+=2):(n=V,0===wr&&o(Mn)),n!==V&&(vr=t,n=_n()),t=n}function H(){var t,n,r,i,s,u;if(wr++,t=dr,e.substr(dr,2)===Pn?(n=Pn,dr+=2):(n=V,0===wr&&o(Hn)),n!==V){for(r=[],i=dr,s=dr,wr++,e.substr(dr,2)===Bn?(u=Bn,dr+=2):(u=V,0===wr&&o(jn)),wr--,u===V?s=et:(dr=s,s=G),s!==V?(e.length>dr?(u=e.charAt(dr),dr++):(u=V,0===wr&&o(xn)),u!==V?(vr=i,s=Fn(u),i=s):(dr=i,i=G)):(dr=i,i=G);i!==V;)r.push(i),i=dr,s=dr,wr++,e.substr(dr,2)===Bn?(u=Bn,dr+=2):(u=V,0===wr&&o(jn)),wr--,u===V?s=et:(dr=s,s=G),s!==V?(e.length>dr?(u=e.charAt(dr),dr++):(u=V,0===wr&&o(xn)),u!==V?(vr=i,s=Fn(u),i=s):(dr=i,i=G)):(dr=i,i=G);r!==V?(e.substr(dr,2)===Bn?(i=Bn,dr+=2):(i=V,0===wr&&o(jn)),i!==V?(vr=t,n=In(r),t=n):(dr=t,t=G)):(dr=t,t=G)}else dr=t,t=G;return wr--,t===V&&(n=V,0===wr&&o(Dn)),t}function B(){var t,n,r,i,s,u;if(wr++,t=dr,e.substr(dr,2)===Rn?(n=Rn,dr+=2):(n=V,0===wr&&o(Un)),n!==V){for(r=[],i=dr,s=dr,wr++,e.substr(dr,2)===zn?(u=zn,dr+=2):(u=V,0===wr&&o(Wn)),wr--,u===V?s=et:(dr=s,s=G),s!==V?(e.length>dr?(u=e.charAt(dr),dr++):(u=V,0===wr&&o(xn)),u!==V?(vr=i,s=Tn(u),i=s):(dr=i,i=G)):(dr=i,i=G);i!==V;)r.push(i),i=dr,s=dr,wr++,e.substr(dr,2)===zn?(u=zn,dr+=2):(u=V,0===wr&&o(Wn)),wr--,u===V?s=et:(dr=s,s=G),s!==V?(e.length>dr?(u=e.charAt(dr),dr++):(u=V,0===wr&&o(xn)),u!==V?(vr=i,s=Tn(u),i=s):(dr=i,i=G)):(dr=i,i=G);r!==V?(e.substr(dr,2)===zn?(i=zn,dr+=2):(i=V,0===wr&&o(Wn)),i!==V?(vr=t,n=Xn(r),t=n):(dr=t,t=G)):(dr=t,t=G)}else dr=t,t=G;return wr--,t===V&&(n=V,0===wr&&o(qn)),t}function j(){var t,n,r,i,s,u,a,f,l,c;if(t=dr,n=F(),n!==V){for(r=[],i=z();i!==V;)r.push(i),i=z();if(r!==V)if(Vn.test(e.charAt(dr))?(i=e.charAt(dr),dr++):(i=V,0===wr&&o($n)),i!==V){for(s=[],u=z();u!==V;)s.push(u),u=z();if(s!==V){if(u=[],a=dr,f=dr,wr++,l=I(),wr--,l===V?f=et:(dr=f,f=G),f!==V?(l=dr,wr++,c=U(),wr--,c===V?l=et:(dr=l,l=G),l!==V?(e.length>dr?(c=e.charAt(dr),dr++):(c=V,0===wr&&o(xn)),c!==V?(f=[f,l,c],a=f):(dr=a,a=G)):(dr=a,a=G)):(dr=a,a=G),a!==V)for(;a!==V;)u.push(a),a=dr,f=dr,wr++,l=I(),wr--,l===V?f=et:(dr=f,f=G),f!==V?(l=dr,wr++,c=U(),wr--,c===V?l=et:(dr=l,l=G),l!==V?(e.length>dr?(c=e.charAt(dr),dr++):(c=V,0===wr&&o(xn)),c!==V?(f=[f,l,c],a=f):(dr=a,a=G)):(dr=a,a=G)):(dr=a,a=G);else u=G;if(u!==V){for(a=[],f=z();f!==V;)a.push(f),f=z();a!==V?(f=I(),f!==V?(n=[n,r,i,s,u,a,f],t=n):(dr=t,t=G)):(dr=t,t=G)}else dr=t,t=G}else dr=t,t=G}else dr=t,t=G;else dr=t,t=G}else dr=t,t=G;return t===V&&(t=g()),t}function F(){var t;return 123===e.charCodeAt(dr)?(t=Jn,dr++):(t=V,0===wr&&o(Kn)),t}function I(){var t;return 125===e.charCodeAt(dr)?(t=Qn,dr++):(t=V,0===wr&&o(Gn)),t}function q(){var t;return 91===e.charCodeAt(dr)?(t=Yn,dr++):(t=V,0===wr&&o(Zn)),t}function R(){var t;return 93===e.charCodeAt(dr)?(t=er,dr++):(t=V,0===wr&&o(tr)),t}function U(){var t;return 10===e.charCodeAt(dr)?(t=nr,dr++):(t=V,0===wr&&o(rr)),t===V&&(e.substr(dr,2)===ir?(t=ir,dr+=2):(t=V,0===wr&&o(sr)),t===V&&(13===e.charCodeAt(dr)?(t=or,dr++):(t=V,0===wr&&o(ur)),t===V&&(8232===e.charCodeAt(dr)?(t=ar,dr++):(t=V,0===wr&&o(fr)),t===V&&(8233===e.charCodeAt(dr)?(t=lr,dr++):(t=V,0===wr&&o(cr)))))),t}function z(){var t;return hr.test(e.charAt(dr))?(t=e.charAt(dr),dr++):(t=V,0===wr&&o(pr)),t===V&&(t=U()),t}var W,X=arguments.length>1?arguments[1]:{},V={},$={start:a},J=a,K=function(e){return["body"].concat(e).concat([["line",n()],["col",r()]])},Q={type:"other",description:"section"},G=V,Y=null,Z=function(e,t,n,r){return r&&e[1].text===r.text||i("Expected end tag for "+e[1].text+" but it was not found."),!0},et=void 0,tt=function(e,t,i){return i.push(["param",["literal","block"],t]),e.push(i),e.concat([["line",n()],["col",r()]])},nt="/",rt={type:"literal",value:"/",description:'"/"'},it=function(e){return e.push(["bodies"]),e.concat([["line",n()],["col",r()]])},st=/^[#?\^<+@%]/,ot={type:"class",value:"[#?\\^<+@%]",description:"[#?\\^<+@%]"},ut=function(e,t,n,r){return[e,t,n,r]},at={type:"other",description:"end tag"},ft=function(e){return e},lt=":",ct={type:"literal",value:":",description:'":"'},ht=function(e){return e},pt=function(e){return e?["context",e]:["context"]},dt={type:"other",description:"params"},vt="=",mt={type:"literal",value:"=",description:'"="'},gt=function(e,t){return["param",["literal",e],t]},yt=function(e){return["params"].concat(e)},bt={type:"other",description:"bodies"},wt=function(e){return["bodies"].concat(e)},Et={type:"other",description:"reference"},St=function(e,t){return["reference",e,t].concat([["line",n()],["col",r()]])},xt={type:"other",description:"partial"},Tt=">",Nt={type:"literal",value:">",description:'">"'},Ct="+",kt={type:"literal",value:"+",description:'"+"'},Lt=function(e){return["literal",e]},At=function(e,t,i,s){var o=">"===e?"partial":e;return[o,t,i,s].concat([["line",n()],["col",r()]])},Ot={type:"other",description:"filters"},Mt="|",_t={type:"literal",value:"|",description:'"|"'},Dt=function(e){return["filters"].concat(e)},Pt={type:"other",description:"special"},Ht="~",Bt={type:"literal",value:"~",description:'"~"'},jt=function(e){return["special",e].concat([["line",n()],["col",r()]])},Ft={type:"other",description:"identifier"},It=function(e){var t=["path"].concat(e);return t.text=e[1].join(".").replace(/,line,\d+,col,\d+/g,""),t},qt=function(e){var t=["key",e];return t.text=e,t},Rt={type:"other",description:"number"},Ut=function(e){return["literal",e]},zt={type:"other",description:"float"},Wt=".",Xt={type:"literal",value:".",description:'"."'},Vt=function(e,t){return parseFloat(e+"."+t.join(""))},$t={type:"other",description:"integer"},Jt=/^[0-9]/,Kt={type:"class",value:"[0-9]",description:"[0-9]"},Qt=function(e){return parseInt(e.join(""),10)},Gt={type:"other",description:"path"},Yt=function(e,t){return t=t[0],e&&t?(t.unshift(e),[!1,t].concat([["line",n()],["col",r()]])):[!0,t].concat([["line",n()],["col",r()]])},Zt=function(e){return e.length>0?[!0,e[0]].concat([["line",n()],["col",r()]]):[!0,[]].concat([["line",n()],["col",r()]])},en={type:"other",description:"key"},tn=/^[a-zA-Z_$]/,nn={type:"class",value:"[a-zA-Z_$]",description:"[a-zA-Z_$]"},rn=/^[0-9a-zA-Z_$\-]/,sn={type:"class",value:"[0-9a-zA-Z_$\\-]",description:"[0-9a-zA-Z_$\\-]"},on=function(e,t){return e+t.join("")},un={type:"other",description:"array"},an=function(e){return e.join("")},fn=function(e){return e},ln=function(e,t){return t?t.unshift(e):t=[e],t},cn={type:"other",description:"array_part"},hn=function(e){return e},pn=function(e,t){return t?e.concat(t):e},dn={type:"other",description:"inline"},vn='"',mn={type:"literal",value:'"',description:'"\\""'},gn=function(){return["literal",""].concat([["line",n()],["col",r()]])},yn=function(e){return["literal",e].concat([["line",n()],["col",r()]])},bn=function(e){return["body"].concat(e).concat([["line",n()],["col",r()]])},wn=function(e){return["buffer",e]},En={type:"other",description:"buffer"},Sn=function(e,t){return["format",e,t.join("")].concat([["line",n()],["col",r()]])},xn={type:"any",description:"any character"},Tn=function(e){return e},Nn=function(e){return["buffer",e.join("")].concat([["line",n()],["col",r()]])},Cn={type:"other",description:"literal"},kn=/^[^"]/,Ln={type:"class",value:'[^"]',description:'[^"]'},An=function(e){return e.join("")},On='\\"',Mn={type:"literal",value:'\\"',description:'"\\\\\\""'},_n=function(){return'"'},Dn={type:"other",description:"raw"},Pn="{`",Hn={type:"literal",value:"{`",description:'"{`"'},Bn="`}",jn={type:"literal",value:"`}",description:'"`}"'},Fn=function(e){return e},In=function(e){return["raw",e.join("")].concat([["line",n()],["col",r()]])},qn={type:"other",description:"comment"},Rn="{!",Un={type:"literal",value:"{!",description:'"{!"'},zn="!}",Wn={type:"literal",value:"!}",description:'"!}"'},Xn=function(e){return["comment",e.join("")].concat([["line",n()],["col",r()]])},Vn=/^[#?\^><+%:@\/~%]/,$n={type:"class",value:"[#?\\^><+%:@\\/~%]",description:"[#?\\^><+%:@\\/~%]"},Jn="{",Kn={type:"literal",value:"{",description:'"{"'},Qn="}",Gn={type:"literal",value:"}",description:'"}"'},Yn="[",Zn={type:"literal",value:"[",description:'"["'},er="]",tr={type:"literal",value:"]",description:'"]"'},nr="\n",rr={type:"literal",value:"\n",description:'"\\n"'},ir="\r\n",sr={type:"literal",value:"\r\n",description:'"\\r\\n"'},or="\r",ur={type:"literal",value:"\r",description:'"\\r"'},ar="\u2028",fr={type:"literal",value:"\u2028",description:'"\\u2028"'},lr="\u2029",cr={type:"literal",value:"\u2029",description:'"\\u2029"'},hr=/^[\t\x0B\f \xA0\uFEFF]/,pr={type:"class",value:"[\\t\\x0B\\f \\xA0\\uFEFF]",description:"[\\t\\x0B\\f \\xA0\\uFEFF]"},dr=0,vr=0,mr=0,gr={line:1,column:1,seenCR:!1},yr=0,br=[],wr=0;if("startRule"in X){if(!(X.startRule in $))throw new Error("Can't start parsing from rule \""+X.startRule+'".');J=$[X.startRule]}if(W=J(),W!==V&&dr===e.length)return W;throw W!==V&&dr<e.length&&o({type:"end",description:"end of input"}),u(null,br,yr)}return e(t,Error),{SyntaxError:t,parse:n}}();return e.parse=t.parse,t}),function(e,t){"object"==typeof exports?module.exports=t(require("./parser").parse,require("./dust")):t(e.dust.parse,e.dust)}(this,function(e,t){function n(e){var t={};return v.filterNode(t,e)}function r(e,t){var n,r,i,s=[t[0]];for(n=1,r=t.length;r>n;n++)i=v.filterNode(e,t[n]),i&&s.push(i);return s}function i(e,t){var n,r,i,s,o=[t[0]];for(r=1,i=t.length;i>r;r++)s=v.filterNode(e,t[r]),s&&("buffer"===s[0]||"format"===s[0]?n?(n[0]="buffer"===s[0]?"buffer":n[0],n[1]+=s.slice(1,-2).join("")):(n=s,o.push(s)):(n=null,o.push(s)));return o}function s(e,t){return["buffer",g[t[1]],t[2],t[3]]}function o(e,t){return t}function u(){}function a(e,n){return t.config.whitespace?n:null}function f(e,t){var n={name:t,bodies:[],blocks:{},index:0,auto:"h"};return"(function(){dust.register("+(t?'"'+t+'"':"null")+","+v.compileNode(n,e)+");"+l(n)+c(n)+"return body_0;})();"}function l(e){var t,n=[],r=e.blocks;for(t in r)n.push('"'+t+'":'+r[t]);return n.length?(e.blocks="ctx=ctx.shiftBlocks(blocks);","var blocks={"+n.join(",")+"};"):e.blocks=""}function c(e){var t,n,r=[],i=e.bodies,s=e.blocks;for(t=0,n=i.length;n>t;t++)r[t]="function body_"+t+"(chk,ctx){"+s+"return chk"+i[t]+";}body_"+t+".__dustBody=!0;";return r.join("")}function h(e,t){var n,r,i="";for(n=1,r=t.length;r>n;n++)i+=v.compileNode(e,t[n]);return i}function p(e,n,r){return"."+(t._aliases[r]||r)+"("+v.compileNode(e,n[1])+","+v.compileNode(e,n[2])+","+v.compileNode(e,n[4])+","+v.compileNode(e,n[3])+")"}function d(e){return e.replace(y,"\\\\").replace(b,'\\"').replace(w,"\\f").replace(E,"\\n").replace(S,"\\r").replace(x,"\\t")}var v={},m=t.isArray;v.compile=function(t,r){if(!r&&null!==r)throw new Error("Template name parameter cannot be undefined when calling dust.compile");try{var i=n(e(t));return f(i,r)}catch(s){throw!s.line||!s.column?s:new SyntaxError(s.message+" At line : "+s.line+", column : "+s.column)}},v.filterNode=function(e,t){return v.optimizers[t[0]](e,t)},v.optimizers={body:i,buffer:o,special:s,format:a,reference:r,"#":r,"?":r,"^":r,"<":r,"+":r,"@":r,"%":r,partial:r,context:r,params:r,bodies:r,param:r,filters:o,key:o,path:o,literal:o,raw:o,comment:u,line:u,col:u},v.pragmas={esc:function(e,t,n){var r,i=e.auto;return t||(t="h"),e.auto="s"===t?"":t,r=h(e,n.block),e.auto=i,r}};var g={s:" ",n:"\n",r:"\r",lb:"{",rb:"}"};v.compileNode=function(e,t){return v.nodes[t[0]](e,t)},v.nodes={body:function(e,t){var n=e.index++,r="body_"+n;return e.bodies[n]=h(e,t),r},buffer:function(e,t){return".w("+T(t[1])+")"},format:function(e,t){return".w("+T(t[1]+t[2])+")"},reference:function(e,t){return".f("+v.compileNode(e,t[1])+",ctx,"+v.compileNode(e,t[2])+")"},"#":function(e,t){return p(e,t,"section")},"?":function(e,t){return p(e,t,"exists")},"^":function(e,t){return p(e,t,"notexists")},"<":function(e,t){for(var n=t[4],r=1,i=n.length;i>r;r++){var s=n[r],o=s[1][1];if("block"===o)return e.blocks[t[1].text]=v.compileNode(e,s[2]),""}return""},"+":function(e,t){return"undefined"==typeof t[1].text&&"undefined"==typeof t[4]?".block(ctx.getBlock("+v.compileNode(e,t[1])+",chk, ctx),"+v.compileNode(e,t[2])+", {},"+v.compileNode(e,t[3])+")":".block(ctx.getBlock("+T(t[1].text)+"),"+v.compileNode(e,t[2])+","+v.compileNode(e,t[4])+","+v.compileNode(e,t[3])+")"},"@":function(e,t){return".h("+T(t[1].text)+","+v.compileNode(e,t[2])+","+v.compileNode(e,t[4])+","+v.compileNode(e,t[3])+")"},"%":function(e,t){var n,r,i,s,o,u,a,f,l,c=t[1][1];if(!v.pragmas[c])return"";for(n=t[4],r={},f=1,l=n.length;l>f;f++)u=n[f],r[u[1][1]]=u[2];for(i=t[3],s={},f=1,l=i.length;l>f;f++)a=i[f],s[a[1][1]]=a[2][1];return o=t[2][1]?t[2][1].text:null,v.pragmas[c](e,o,r,s)},partial:function(e,t){return".p("+v.compileNode(e,t[1])+","+v.compileNode(e,t[2])+","+v.compileNode(e,t[3])+")"},context:function(e,t){return t[1]?"ctx.rebase("+v.compileNode(e,t[1])+")":"ctx"},params:function(e,t){for(var n=[],r=1,i=t.length;i>r;r++)n.push(v.compileNode(e,t[r]));return n.length?"{"+n.join(",")+"}":"{}"},bodies:function(e,t){for(var n=[],r=1,i=t.length;i>r;r++)n.push(v.compileNode(e,t[r]));return"{"+n.join(",")+"}"},param:function(e,t){return v.compileNode(e,t[1])+":"+v.compileNode(e,t[2])},filters:function(e,t){for(var n=[],r=1,i=t.length;i>r;r++){var s=t[r];n.push('"'+s+'"')}return'"'+e.auto+'"'+(n.length?",["+n.join(",")+"]":"")},key:function(e,t){return'ctx.get(["'+t[1]+'"], false)'},path:function(e,t){for(var n=t[1],r=t[2],i=[],s=0,o=r.length;o>s;s++)i.push(m(r[s])?v.compileNode(e,r[s]):'"'+r[s]+'"');return"ctx.getPath("+n+", ["+i.join(",")+"])"},literal:function(e,t){return T(t[1])},raw:function(e,t){return".w("+T(t[1])+")"}};var y=/\\/g,b=/"/g,w=/\f/g,E=/\n/g,S=/\r/g,x=/\t/g,T="undefined"==typeof JSON?function(e){return'"'+d(e)+'"'}:JSON.stringify;return t.compile=v.compile,t.filterNode=v.filterNode,t.optimizers=v.optimizers,t.pragmas=v.pragmas,t.compileNode=v.compileNode,t.nodes=v.nodes,v}),define("dust",function(){}),!function(dust){function _deprecated(e){_deprecatedCache[e]||(_log("Deprecation warning: "+e+" is deprecated and will be removed in a future version of dustjs-helpers","WARN"),_log("For help and a deprecation timeline, see https://github.com/linkedin/dustjs-helpers/wiki/Deprecated-Features#"+e.replace(/\W+/g,""),"WARN"),_deprecatedCache[e]=!0)}function isSelect(e){var t=e.current();return"object"==typeof t&&t.isSelect===!0}function jsonFilter(e,t){return"function"==typeof t?t.toString().replace(/(^\s+|\s+$)/gm,"").replace(/\n/gm,"").replace(/,\s*/gm,", ").replace(/\)\{/gm,") {"):t}function filter(e,t,n,r,i){r=r||{};var s,o,u=n.block,a=r.filterOpType||"";if(r.hasOwnProperty("key"))s=dust.helpers.tap(r.key,e,t);else{if(!isSelect(t))return _log("No key specified for filter in:"+a+" helper "),e;s=t.current().selectKey,t.current().isResolved&&(i=function(){return!1})}return o=dust.helpers.tap(r.value,e,t),i(coerce(o,r.type,t),coerce(s,r.type,t))?(isSelect(t)&&(t.current().isResolved=!0),u?e.render(u,t):(_log("No body specified for "+a+" helper "),e)):n["else"]?e.render(n["else"],t):e}function coerce(e,t,n){if("undefined"!=typeof e)switch(t||typeof e){case"number":return+e;case"string":return String(e);case"boolean":return e="false"===e?!1:e,Boolean(e);case"date":return new Date(e);case"context":return n.get(e)}return e}var _log=dust.log?function(e,t){t=t||"INFO",dust.log(e,t)}:function(){},_deprecatedCache={},helpers={tap:function(e,t,n){if("function"!=typeof e)return e;var r,i="";return r=t.tap(function(e){return i+=e,""}).render(e,n),t.untap(),r.constructor!==t.constructor?r:""===i?!1:i},sep:function(e,t,n){var r=n.block;return t.stack.index===t.stack.of-1?e:r?r(e,t):e},idx:function(e,t,n){var r=n.block;return _deprecated("{@idx}"),r?r(e,t.push(t.stack.index)):e},contextDump:function(e,t,n,r){var i,s=r||{},o=s.to||"output",u=s.key||"current";return o=dust.helpers.tap(o,e,t),u=dust.helpers.tap(u,e,t),i="full"===u?JSON.stringify(t.stack,jsonFilter,2):JSON.stringify(t.stack.head,jsonFilter,2),"console"===o?(_log(i),e):(i=i.replace(/</g,"\\u003c"),e.write(i))},"if":function(chunk,context,bodies,params){var body=bodies.block,skip=bodies["else"],cond;if(params&&params.cond){if(_deprecated("{@if}"),cond=dust.helpers.tap(params.cond,chunk,context),eval(cond))return body?chunk.render(bodies.block,context):(_log("Missing body block in the if helper!"),chunk);if(skip)return chunk.render(bodies["else"],context)}else _log("No condition given in the if helper!");return chunk},math:function(e,t,n,r){if(r&&"undefined"!=typeof r.key&&r.method){var i=r.key,s=r.method,o=r.operand,u=r.round,a=null;switch(i=dust.helpers.tap(i,e,t),o=dust.helpers.tap(o,e,t),s){case"mod":(0===o||o===0)&&_log("operand for divide operation is 0/-0: expect Nan!"),a=parseFloat(i)%parseFloat(o);break;case"add":a=parseFloat(i)+parseFloat(o);break;case"subtract":a=parseFloat(i)-parseFloat(o);break;case"multiply":a=parseFloat(i)*parseFloat(o);break;case"divide":(0===o||o===0)&&_log("operand for divide operation is 0/-0: expect Nan/Infinity!"),a=parseFloat(i)/parseFloat(o);break;case"ceil":a=Math.ceil(parseFloat(i));break;case"floor":a=Math.floor(parseFloat(i));break;case"round":a=Math.round(parseFloat(i));break;case"abs":a=Math.abs(parseFloat(i));break;default:_log("method passed is not supported")}return null!==a?(u&&(a=Math.round(a)),n&&n.block?e.render(n.block,t.push({isSelect:!0,isResolved:!1,selectKey:a})):e.write(a)):e}return _log("Key is a required parameter for math helper along with method/operand!"),e},select:function(e,t,n,r){var i=n.block;if(r&&"undefined"!=typeof r.key){var s=dust.helpers.tap(r.key,e,t);return i?e.render(n.block,t.push({isSelect:!0,isResolved:!1,selectKey:s})):(_log("Missing body block in the select helper "),e)}return _log("No key given in the select helper!"),e},eq:function(e,t,n,r){return r?(r.filterOpType="eq",filter(e,t,n,r,function(e,t){return t===e})):e},ne:function(e,t,n,r){return r?(r.filterOpType="ne",filter(e,t,n,r,function(e,t){return t!==e})):e},lt:function(e,t,n,r){return r?(r.filterOpType="lt",filter(e,t,n,r,function(e,t){return e>t})):e},lte:function(e,t,n,r){return r?(r.filterOpType="lte",filter(e,t,n,r,function(e,t){return e>=t})):e},gt:function(e,t,n,r){return r?(r.filterOpType="gt",filter(e,t,n,r,function(e,t){return t>e})):e},gte:function(e,t,n,r){return r?(r.filterOpType="gte",filter(e,t,n,r,function(e,t){return t>=e})):e},"default":function(e,t,n,r){return r&&(r.filterOpType="default"),filter(e,t,n,r,function(){return!0})},size:function(e,t,n,r){var i,s,o,u=0;if(r=r||{},i=r.key,i&&i!==!0)if(dust.isArray(i))u=i.length;else if(!isNaN(parseFloat(i))&&isFinite(i))u=i;else if("object"==typeof i){s=0;for(o in i)Object.hasOwnProperty.call(i,o)&&s++;u=s}else u=(i+"").length;else u=0;return e.write(u)}};for(var key in helpers)dust.helpers[key]=helpers[key];"undefined"!=typeof exports&&(module.exports=dust)}("undefined"!=typeof exports?require("dustjs-linkedin"):dust),define("dust-helpers",["dust"],function(){}),!function(){function e(e,n){return e.helper("select",n,{block:t},{key:n.getPath(!1,["media","type"])})}function t(e,t){return e.helper("eq",t,{block:n},{value:1}).helper("eq",t,{block:i},{value:2}).helper("eq",t,{block:o},{value:0}).helper("eq",t,{block:u},{value:9})}function n(e,t){return e.write('<video class="tt-media-video" style="height: 100%;" ').notexists(t.get(["enableControls"],!1),t,{block:r},null).write(' poster="').helper("generateUrl",t,{},{path:t.getPath(!1,["media","thumbnail"])}).write('" preload="metadata"><source src="').helper("generateUrl",t,{},{path:t.getPath(!1,["media","resource","pathMPEG"])}).write('" /></video>')}function r(e){return e.write("controls")}function i(e,t){return e.write('<audio class="tt-media-audio" ').notexists(t.get(["enableControls"],!1),t,{block:s},null).write('><source src="').helper("generateUrl",t,{},{path:t.getPath(!1,["media","resource","pathMPEG"])}).write('" /></audio>')}function s(e){return e.write("controls")}function o(e,t){return e.write('<img class="" style="max-height: 100%; max-width: 100%;" src="').helper("generateUrl",t,{},{path:t.getPath(!1,["media","resource","pathMPEG"])}).write('" title="').reference(t.get(["title"],!1),t,"h").write('" alt="').reference(t.get(["title"],!1),t,"h").write('" /><span style="vertical-align: middle; display: inline-block; height: 100%;"></span>')}function u(e,t){return e.write('<div class="row"><div class="col-md-3 thumbnail text-center"><a href="').helper("generateUrl",t,{},{path:t.getPath(!1,["media","resource","pathMPEG"])}).write('"><p><i class="fa fa-file fa-5x"></i></p><div>').reference(t.get(["title"],!1),t,"h").write("</div></a></div></div>")}return dust.register("gallery_media",e),e}(),!function(){function e(e){return e.write('<div class="gallery-normal" style="position: relative;"><div class="gallery-normal-item"></div><div class="gallery-normal-action" style="position: absolute; top: 10px; right: 10px; background-color: #000; opacity: 0.8;"><a style="color: #fff; padding: 4px 8px; cursor: pointer; display: none;" title="Interpret" data-action="3"><i class="fa fa-video-camera fa-2x"></i></a></div><div style="position: relative; width:100%; margin-bottom: 8px;"><div style="overflow: hidden; position: relative; height: 90px;  margin-left: 55px; margin-right: 55px;"><ol class="gallery-normal-thumbs" style="width: 10000px; margin: 0; list-style: none; position: absolute; left: 0; overflow: hidden; padding: 0px; height: 100%; white-space: nowrap; text-align: center;"></ol></div><div class="gallery-normal-left" style="position: absolute; left: 10px; bottom: 24px; cursor: pointer; display: none;"><i class="fa fa-chevron-left fa-3x"></i></div><div class="gallery-normal-right" style="position: absolute; right: 10px; bottom: 24px; cursor: pointer; display: none;"><i class="fa fa-chevron-right fa-3x"></i></div></div></div>')}return dust.register("gallery_normal",e),e}(),!function(){function e(e){return e.write('<div class="gallery-preview" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 100000; background-color: #000; opacity: 0.8; display: none;"></div><div class="gallery-preview" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 100001; display: none;"><div class="gallery-preview-action" style="position: absolute; top: 10px; right: 10px; background-color: #000; opacity: 0.8;"><a style="color: #fff; padding: 4px 8px; cursor: pointer; display: none;" title="Cut" data-action="4"><i class="fa fa-scissors fa-3x"></i></a><a style="color: #fff; padding: 4px 8px; cursor: pointer; display: none;" title="Interpret" data-action="3"><i class="fa fa-video-camera fa-3x"></i></a><a style="color: #fff; padding: 4px 8px; cursor: pointer;" data-action="2"><i class="fa fa-expand fa-3x" style="font-size: 2.5em;"></i></a><a style="color: #fff; padding: 4px 8px; cursor: pointer;" data-action="1"><i class="fa fa-times fa-3x"></i></a></div><div class="gallery-preview-prev" style="left: 0; background-color: #000; color: #fff; opacity: 0.8; position: absolute; line-height: 80px; cursor: pointer; height: 80px; width: 80px; text-align: center; display: none;"><i class="fa fa-chevron-left fa-3x" style="vertical-align: middle;"></i></div><div class="gallery-preview-next" style="right: 0; background-color: #000; color: #fff; opacity: 0.8; position: absolute; line-height: 80px; cursor: pointer; height: 80px; width: 80px; text-align: center; display: none;"><i class="fa fa-chevron-right fa-3x" style="vertical-align: middle;"></i></div><div class="gallery-preview-item" style="width: 70%; top: 70px; margin: 0 auto; transition: 0.2s; -webkit-transition: 0.2s; text-align: center; white-space: nowrap; position: relative; border: 0px solid red; color: #fff;"><i class="fa fa-spinner fa-4x fa-spin"></i><span style="vertical-align: middle; display: inline-block; height: 100%;"></span></div><div style="overflow: hidden; position: absolute; left: 0; right: 0; bottom: 0; margin-bottom: 8px; margin-left: 55px; margin-right: 55px;"><ol class="gallery-preview-thumbs" style="width: 10000px; margin: 0; list-style: none; position: relative; overflow: hidden; padding: 0; height: 100%; white-space: nowrap; text-align: center; display: none;"></ol></div><div class="gallery-preview-left" style="color: #fff; position: absolute; left: 10px; bottom: 0; line-height: 90px; cursor: pointer; display: none;"><i class="fa fa-chevron-left fa-3x"></i></div><div class="gallery-preview-right" style="color: #fff; position: absolute; right: 10px; bottom: 0; line-height: 90px; cursor: pointer; display: none;"><i class="fa fa-chevron-right fa-3x"></i></div></div>')}return dust.register("gallery_preview",e),e}(),!function(){function e(e,n){return e.section(n.get(["media"],!1),n,{block:t},null)}function t(e,t){return e.write('<li style="float: left; list-style: none; margin-right: 5px; cursor: pointer; height: 100%; border: 2px solid black;" data-mid="').reference(t.get(["id"],!1),t,"h").write('"><img style="max-height: 100%; width: 100%;" src="').helper("generateUrl",t,{},{path:t.get(["thumbnail"],!1)}).write('" /><span style="vertical-align: middle; display: inline-block; height: 100%;"></span></li>')}return dust.register("gallery_thumbnail",e),e}(),!function(){function e(e){return e.write('<div class="modal fade my-files-selector-modal"><div class="modal-dialog" style="width: 80%;"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button><h4 class="modal-title">Select from My Files</h4></div><div class="modal-body"><div class="text-center"><i class="fa fa-spinner fa-4x fa-spin"></i></div></div><div class="modal-footer"><a class="btn btn-default" data-dismiss="modal"><i class="fa fa-times"></i> Cancel</a><a class="btn btn-primary my-files-selector-select-selected" disabled="disabled" data-loading-text="<i class=&quot;fa fa-spinner fa-spin&quot;></i> Downloading data..."><i class="fa fa-check"></i> Select</a></div></div></div></div>')}return dust.register("myFilesSelector",e),e}(),!function(){function e(e){return e.write('<div class="modal fade recorder-modal"><div class="modal-dialog modal-lg"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button><h4 class="modal-title">Recorder</h4></div><div class="modal-body"><div class="recorder-container-record"><ul class="nav nav-tabs" role="tablist"><li class="active"><a href=".recorder-normal" role="tab" data-toggle="tab">Normal</a></li><li><a href=".recorder-interp" role="tab" data-toggle="tab">Interpretation</a></li></ul><div class="tab-content" style="padding-top: 15px;"><div class="tab-pane active recorder-normal"><div class="tt-media-preview-title"><input class="recorder-normal-title" style="display: none;" type="text" value="" /></div><video class="recorder-normal-video" width="100%" preload="auto" muted="muted"><source src="" /></video></div><div class="tab-pane recorder-interp"><div style="border: 2px dashed #ccc; line-height: 200px; height: 200px; text-align: center; display: none;"><button class="btn btn-primary btn-lg recorder-interp-select">Select a video to interpret</button></div><div class="row"><div class="col-md-6"><video class="recorder-interp-video-p" style="display: none;" width="100%" preload="auto" muted="muted"><source src="" /></video></div><div class="col-md-6"><div class="tt-media-preview-title"><input class="recorder-interp-title" style="display: none;" type="text" value="" /></div><video class="recorder-interp-video-r" style="display: none;" width="100%" preload="auto" muted="muted"><source src="" /></video></div></div></div></div><div class="recorder-controls"></div></div><div class="recorder-container-upload" style="display: none;"><label>Uploading...</label><div class="progress"><div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;">0%</div></div></div></div></div></div></div>')}return dust.register("recorder",e),e}(),define("templates",["dust-helpers"],function(){}),Function.prototype.extend=function(e){for(var t in e)this[t]=e[t];for(var t in e.prototype)this.prototype[t]=e.prototype[t];return this.prototype.constructor=this,this.prototype.parent=e.prototype,this},define("extra",function(){}),define("core/mediaManager",[],function(){var e=function(){};return e.EVENT_DELETE_SUCCESS="delete_media_success",e.EVENT_DELETE_ERROR="delete_media_error",e.EVENT_UPDATE_SUCCESS="update_media_success",e.EVENT_UPDATE_ERROR="update_media_error",e.Event={GET_INFO_SUCCESS:"eventGetInfoSuccess",GET_INFO_ERROR:"eventGetInfoError"},e.prototype.deleteMedia=function(t,n,r){var i=this;if(typeof n!="undefined"&&n!==!1){var s=confirm(n);if(!s)return!1}typeof r=="undefined"&&(r=!1);var o=Routing.generate("imdc_myfiles_delete",{mediaId:t,confirm:r}),u={mediaId:t,confirm:r};$.ajax({url:o,type:"POST",contentType:"application/x-www-form-urlencoded",data:u,success:function(n){if(n.responseCode==200)$(i).trigger(e.EVENT_DELETE_SUCCESS);else if(n.responseCode==400){var r="";n.mediaInUse.forEach(function(e,t,n){t>0&&(r+=", "),r+=Translator.trans("filesGateway.deleteMediaInUseConfirmation."+e)}),r=Translator.trans("filesGateway.deleteMediaInUseConfirmation.finalMessage",{mediaUsedLocations:r}),console.log(n),confirm(r)&&i.deleteMedia(t,!1,!0),console.log("Error: "+n.feedback)}else $(i).trigger(e.EVENT_DELETE_ERROR,"Unknown Error"),console.log("An unexpected error occured")},error:function(t){$(i).trigger(e.EVENT_DELETE_ERROR,t),console.log(t)}})},e.prototype.trimMedia=function(e,t,n){var r=this,i=Routing.generate("imdc_myfiles_trim",{mediaId:e,startTime:t,endTime:n}),s={mediaId:e,startTime:t,endTime:n};$.ajax({url:i,type:"POST",contentType:"application/x-www-form-urlencoded",data:s,success:function(e){console.log(e),e.responseCode==200?r.media=e.media:e.responseCode==400?console.log("Error: "+e.feedback):console.log("An unexpected error occured")},error:function(e){console.log(e)}})},e.prototype.updateMedia=function(t){var n=this;typeof t=="undefined"&&($(n).trigger(e.EVENT_UPDATE_ERROR,"Must send a media object"),console.log("Error: Must send a media object"));var r=Routing.generate("imdc_myfiles_update",{mediaId:t.id});console.log(t);var i={mediaId:t.id,media:JSON.stringify(t)};console.log(i),$.ajax({url:r,type:"POST",contentType:"application/x-www-form-urlencoded",data:i,success:function(t){t.responseCode==200?$(n).trigger(e.EVENT_UPDATE_SUCCESS):t.responseCode==400?($(n).trigger(e.EVENT_UPDATE_ERROR,t.feedback),console.log("Error: "+t.feedback)):($(n).trigger(e.EVENT_UPDATE_ERROR,"Unknown Error"),console.log("An unexpected error occured"))},error:function(t){$(n).trigger(e.EVENT_UPDATE_ERROR,t),console.log(t)}})},e.prototype.getInfo=function(t){$.ajax({url:Routing.generate("imdc_myfiles_get_info"),data:{mediaIds:t},type:"POST",success:function(t,n,r){$(this).trigger($.Event(e.Event.GET_INFO_SUCCESS,{payload:t}))}.bind(this),error:function(t,n,r){$(this).trigger($.Event(e.Event.GET_INFO_ERROR,{jqXHR:t}))}.bind(this)})},e}),define("core/helper",[],function(){var e=function(){};return e.TAG="Helper",e.isFullscreen=function(){return document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement?!0:!1},e.toggleFullScreen=function(t){console.log("%s: %s",e.TAG,"toggleFullScreen");var n=t[0];e.isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen():n.requestFullscreen?n.requestFullscreen():n.mozRequestFullScreen?n.mozRequestFullScreen():n.webkitRequestFullscreen?n.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT):n.msRequestFullscreen&&n.msRequestFullscreen()},e.updateProgressBar=function(e,t){var n=e.find(".progress-bar");n.attr("aria-valuenow",t),n.css("width",t+"%"),n.html(t+"%")},e.generateUrl=function(e,t){var t=typeof t!="undefined"?t:!1,n=Routing.getBaseUrl();return t?n+e:n.replace(/\w+\.php$/gi,"")+e},e.autoSize=function(){$(".autosize").autosize({append:""})},e}),define("core/myFilesSelector",["core/mediaManager"],function(e){var t=function(t){var n={multiSelect:!0,filter:{}};t=t||n;for(var r in n)this[r]=typeof t[r]!="undefined"?t[r]:n[r];this.mediaManager=new e,this.bind__onRender=this._onRender.bind(this),this.bind__onShownModal=this._onShownModal.bind(this),this.bind__onHiddenModal=this._onHiddenModal.bind(this),this.bind__onClickBulkAction=this._onClickBulkAction.bind(this),this.bind__onClickFile=this._onClickFile.bind(this),this.bind__onClickSelectSelected=this._onClickSelectSelected.bind(this),this.bind__onGetMediaInfoSuccess=this._onGetMediaInfoSuccess.bind(this),this.bind__onGetMediaInfoError=this._onGetMediaInfoError.bind(this),this.bind__onLoadPageSuccess=this._onLoadPageSuccess.bind(this),this.bind__onLoadPageError=this._onLoadPageError.bind(this),$(this.mediaManager).on(e.Event.GET_INFO_SUCCESS,this.bind__onGetMediaInfoSuccess),$(this.mediaManager).on(e.Event.GET_INFO_ERROR,this.bind__onGetMediaInfoError)};return t.TAG="MyFilesSelector",t.Event={READY:"eventReady",DONE:"eventDone",HIDDEN:"eventHidden"},t.Binder={MODAL_DIALOG:".my-files-selector-modal",BULK_ACTION:".my-files-selector-bulk-action",TOGGLE_SELECTION:".my-files-selector-toggle-selection",TOGGLE_STYLE:".my-files-selector-toggle-style",FILES_LIST:".my-files-selector-files-list",FILE:".my-files-selector-file",SELECT_SELECTED:".my-files-selector-select-selected"},t.prototype.getContainer=function(){return $("body")},t.prototype._getElement=function(e){return this.getContainer().find(e)},t.prototype._onClickBulkAction=function(e){var n=this._getElement(t.Binder.BULK_ACTION).data("action"),r=this._getSelectedFiles();switch(n){case 1:$.each(r,function(e,t){this.mediaManager.deleteMedia($(t).data("mid"))}.bind(this)),setTimeout(function(){window.location.reload(!0)},1e3)}},t.prototype._onClickFile=function(e){e.stopPropagation(),this.gallery=new $tt.Core.Gallery({mode:$tt.Core.Gallery.Mode.PREVIEW}),$(this.gallery).on($tt.Core.Gallery.Event.READY,function(e){this.gallery.show()}.bind(this)),$(this.gallery).on($tt.Core.Gallery.Event.HIDDEN,function(e){this.gallery.destroy()}.bind(this)),this.gallery.render([$(e.currentTarget).data("mid")])},t.prototype._bindUIEventsFilesList=function(){var e=this._getElement(t.Binder.FILES_LIST),n=e.find("input[type='checkbox']");this._getElement(t.Binder.BULK_ACTION).on("click",this.bind__onClickBulkAction),this.multiSelect&&(this._getElement("input"+t.Binder.TOGGLE_SELECTION).on("change",function(e){n.prop("checked",$(e.target).prop("checked"))}),this._getElement("button"+t.Binder.TOGGLE_SELECTION).on("click",function(t){n.prop("checked",e.find("input:checked").length==0)}),this._getElement(t.Binder.TOGGLE_SELECTION).attr("disabled",!1)),n.on("change",function(e){var r=$(e.target).prop("checked");this.multiSelect||n.prop("checked",!1),$(e.target).prop("checked",r),this._getElement(t.Binder.SELECT_SELECTED).attr("disabled",this._getSelectedFiles().length==0)}.bind(this)),n.trigger("change"),this._getElement(t.Binder.FILE).not("disabled").on("click",this.bind__onClickFile);var r=this;e.find("span.edit-title").editable({toggle:"manual",unsavedclass:null,success:function(e,t){r.mediaManager.updateMedia({id:$(this).data("mid"),title:t})}}),e.find("button.edit-title").on("click",function(e){e.stopPropagation(),$(this).parent().prev().editable("toggle")});var i=function(e){e.preventDefault(),this._loadPage($(e.currentTarget).attr("href"))}.bind(this);this._getElement(t.Binder.MODAL_DIALOG).find(t.Binder.TOGGLE_STYLE).on("click",i),this._getElement(t.Binder.MODAL_DIALOG).find("ul.pagination li a").on("click",i)},t.prototype._onLoadPageSuccess=function(e,n,r){this._getElement(t.Binder.MODAL_DIALOG).find(".modal-body").html(e.page),this._bindUIEventsFilesList()},t.prototype._onLoadPageError=function(e,t,n){console.log(e)},t.prototype._makeUrl=function(e){if(typeof e=="undefined")return Routing.generate("imdc_myfiles_list",this.filter);for(var t in this.filter)e+=(e.substr("?")?"&":"?")+t+"="+this.filter[t];return e},t.prototype._loadPage=function(e){$.ajax({url:this._makeUrl(e),success:this.bind__onLoadPageSuccess,error:this.bind__onLoadPageError})},t.prototype._onShownModal=function(e){this._loadPage()},t.prototype._onHiddenModal=function(e){$(this).trigger($.Event(t.Event.HIDDEN,{}))},t.prototype._onGetMediaInfoSuccess=function(e){$(this).trigger($.Event(t.Event.DONE,{media:e.payload.media}))},t.prototype._onGetMediaInfoError=function(e){this._getElement(t.Binder.SELECT_SELECTED).button("reset"),console.log(e.jqXHR)},t.prototype._getSelectedFiles=function(e){return this._getElement(t.Binder.FILES_LIST).find("input:checked")},t.prototype._onClickSelectSelected=function(e){e.preventDefault(),$(e.target).button("loading");var t=this._getSelectedFiles(),n=[];this.multiSelect?t.each(function(e,t){n.push($(t).data("mid"))}):n.push(t.first().data("mid")),this.mediaManager.getInfo(n)},t.prototype._bindUIEvents=function(){var e=this._getElement(t.Binder.MODAL_DIALOG);e.modal({backdrop:"static",show:!1}),e.on("shown.bs.modal",this.bind__onShownModal),e.on("hidden.bs.modal",this.bind__onHiddenModal),this._getElement(t.Binder.SELECT_SELECTED).on("click",this.bind__onClickSelectSelected)},t.prototype._onRender=function(e,n){this.getContainer().append(n),this._bindUIEvents(),$(this).trigger($.Event(t.Event.READY,{}))},t.prototype.render=function(){dust.render("myFilesSelector",{},this.bind__onRender)},t.prototype.show=function(){this._getElement(t.Binder.MODAL_DIALOG).modal("show")},t.prototype.hide=function(){this._getElement(t.Binder.MODAL_DIALOG).modal("hide")},t.prototype.destroy=function(){this._getElement(t.Binder.MODAL_DIALOG).remove()},t.prototype.bindUIEvents=function(){this._bindUIEventsFilesList()},t}),define("core/recorder",["core/helper","core/mediaManager","core/myFilesSelector"],function(e,t,n){var r=function(e){var n={mode:r.Mode.RECORD,enableDoneAndPost:!1};e=e||n;for(var i in n)this[i]=typeof e[i]!="undefined"?e[i]:n[i];this.page=e.page,this.player=null,this.recorder=null,this.sourceMedia=null,this.recordedMedia=null,this.mediaManager=new t,this.forwardButton="<button class='forwardButton'></button>",this.doneButton="<button class='doneButton'></button>",this.doneAndPostButton="<button class='doneAndPostButton'></button>",this.backButton="<button class='backButton'></button>",this.bind__onRender=this._onRender.bind(this),this.bind__onShownModal=this._onShownModal.bind(this),this.bind__onHiddenModal=this._onHiddenModal.bind(this),this.bind__onShowTab=this._onShowTab.bind(this),this.bind__onShownTab=this._onShownTab.bind(this),this.bind__onBlurPlayerTitle=this._onBlurPlayerTitle.bind(this),this.bind__onClickInterpSelect=this._onClickInterpSelect.bind(this),this.bind__onPageAnimate=this._onPageAnimate.bind(this),this.bind__onRecordingStarted=this._onRecordingStarted.bind(this),this.bind__onRecordingStopped=this._onRecordingStopped.bind(this),this.bind__onRecordingUploadProgress=this._onRecordingUploadProgress.bind(this),this.bind__onRecordingUploaded=this._onRecordingUploaded.bind(this),this.bind__onRecordingSuccess=this._onRecordingSuccess.bind(this),this.bind__onRecordingError=this._onRecordingError.bind(this),this.bind__preview=this._preview.bind(this),this.bind__cut=this._cut.bind(this),this.bind__back=this._back.bind(this),this.bind__done=this._done.bind(this),this.bind__doneAndPost=this._doneAndPost.bind(this)};return r.TAG="Recorder",r.MAX_RECORDING_TIME=720,r.Page={NORMAL:0,INTERPRETATION:1},r.Mode={RECORD:0,PREVIEW:1},r.Event={READY:"eventReady",DONE:"eventDone",HIDDEN:"eventHidden"},r.Binder={MODAL_DIALOG:".recorder-modal",NORMAL:".recorder-normal",INTERP:".recorder-interp",CONTAINER_RECORD:".recorder-container-record",NORMAL_TITLE:".recorder-normal-title",NORMAL_VIDEO:".recorder-normal-video",INTERP_SELECT:".recorder-interp-select",INTERP_MY_FILES_SELECTOR:".recorder-interp-my-files-selector",INTERP_VIDEO_P:".recorder-interp-video-p",INTERP_TITLE:".recorder-interp-title",INTERP_VIDEO_R:".recorder-interp-video-r",CONTROLS:".recorder-controls",CONTAINER_UPLOAD:".recorder-container-upload"},r.prototype.getContainer=function(){return $("body")},r.prototype._getElement=function(e){return this.getContainer().find(e)},r.prototype._createPlayer=function(e){console.log("%s: %s",r.TAG,"_createPlayer"),e=typeof e!="undefined"?e:!1;var t=[],n=[];if(this.page==r.Page.NORMAL||e)t.push(this.doneButton),n.push(e?this.bind__cut:this.bind__done);this.enableDoneAndPost&&e&&(t.push(this.doneAndPostButton),n.push(this.bind__doneAndPost));var i,s;e&&this.wasRecording&&(i=[this.backButton],s=[this.bind__back]);var o=this._getElement(this.page==r.Page.NORMAL?r.Binder.NORMAL_VIDEO:e?r.Binder.INTERP_VIDEO_R:r.Binder.INTERP_VIDEO_P),u=new Player(o,{areaSelectionEnabled:e,audioBar:!1,updateTimeType:Player.DENSITY_BAR_UPDATE_TYPE_RELATIVE,controlBarElement:this._getElement(r.Binder.CONTROLS),forwardButtons:t,forwardFunctions:n,backButtons:i,backFunctions:s,selectedRegionColor:"#0000ff"});u.createControls(),$(u.elementID).find(".videoControlsContainer.controlsBar.doneButton").eq(0).attr("title",Translator.trans("player.previewing.doneButton")),$(u.elementID).find(".videoControlsContainer.controlsBar.doneAndPostButton").eq(0).attr("title",Translator.trans("player.previewing.doneAndPostButton")),$(u.elementID).find(".videoControlsContainer.controlsBar.backButton").eq(0).attr("title",Translator.trans("player.previewing.backToRecordingButton")),e?this.recorder=u:this.player=u},r.prototype._cut=function(e){console.log("%s: %s",r.TAG,"_cut"),e.preventDefault();var t=this.recorder.getCurrentMinMaxTime(),n=this.recorder.getAreaSelectionTimes();this.recorder.setCurrentMinMaxTime(n.minTime,n.maxTime),console.log("Current Min/Max Times %s %s",n.minTime,n.maxTime),console.log("Cutting to Min/Max Times %s %s",n.minTime-t.minTime,n.maxTime-t.minTime),this.mediaManager.trimMedia(this.recordedMedia.id,n.minTime-t.minTime,n.maxTime-t.minTime)},r.prototype._back=function(e){console.log("%s: %s",r.TAG,"_back"),e.preventDefault(),this._destroyPlayers(),this.mediaManager.deleteMedia(this.recordedMedia.id),this.setRecordedMedia(null),this.wasRecording=!1,this.mode=r.Mode.RECORD,this.page==r.Page.INTERPRETATION&&this._createPlayer(),this._createRecorder()},r.prototype._createRecorder=function(){console.log("%s: %s",r.TAG,"_createRecorder");var e=[this.forwardButton,this.doneButton],t=[this.bind__preview,this.bind__done];this.enableDoneAndPost&&(e.push(this.doneAndPostButton),t.push(this.bind__doneAndPost));var n;this.page==r.Page.NORMAL?n=this._getElement(r.Binder.NORMAL_VIDEO):n=this._getElement(r.Binder.INTERP_VIDEO_R),this.recorder=new Player(n,{areaSelectionEnabled:!1,audioBar:!1,updateTimeType:Player.DENSITY_BAR_UPDATE_TYPE_ABSOLUTE,controlBarElement:this._getElement(r.Binder.CONTROLS),type:Player.DENSITY_BAR_TYPE_RECORDER,volumeControl:!1,maxRecordingTime:r.MAX_RECORDING_TIME,recordingSuccessFunction:this.bind__onRecordingSuccess,recordingErrorFunction:this.bind__onRecordingError,recordingPostURL:Routing.generate("imdc_myfiles_add_recording"),forwardButtons:e,forwardFunctions:t}),this.page==r.Page.INTERPRETATION&&($(this.recorder).on(Player.EVENT_RECORDING_STARTED,this.bind__onRecordingStarted),$(this.recorder).on(Player.EVENT_RECORDING_STOPPED,this.bind__onRecordingStopped)),$(this.recorder).on(Player.EVENT_RECORDING_UPLOAD_PROGRESS,this.bind__onRecordingUploadProgress),$(this.recorder).on(Player.EVENT_RECORDING_UPLOADED,this.bind__onRecordingUploaded),this.recorder.createControls(),$(this.recorder.elementID).find(".videoControlsContainer.controlsBar.videoControls.recordButton").eq(0).attr("title",Translator.trans("player.recording.recordingButton")),$(this.recorder.elementID).find(".videoControlsContainer.controlsBar.forwardButton").eq(0).attr("title",Translator.trans("player.recording.forwardButton")),$(this.recorder.elementID).find(".videoControlsContainer.controlsBar.doneButton").eq(0).attr("title",Translator.trans("player.recording.doneButton")),$(this.recorder.elementID).find(".videoControlsContainer.controlsBar.doneAndPostButton").eq(0).attr("title",Translator.trans("player.recording.doneAndPostButton"))},r.prototype._onRecordingStarted=function(){console.log("%s: %s",r.TAG,"_onRecordingStarted"),this.player.setControlsEnabled(!1),this.player.play()},r.prototype._onRecordingStopped=function(){this.player.pause(),this.player.setControlsEnabled(!0)},r.prototype._onRecordingUploadProgress=function(t,n){e.updateProgressBar(this._getElement(r.Binder.CONTAINER_UPLOAD).show(),n)},r.prototype._onRecordingUploaded=function(t){e.updateProgressBar(this._getElement(r.Binder.CONTAINER_UPLOAD).hide(),0)},r.prototype._onRecordingSuccess=function(e){console.log("%s: %s- mediaId=%d",r.TAG,"_onRecordingSuccess",e.media.id),this.setRecordedMedia(e.media)},r.prototype._onRecordingError=function(e){console.log("%s: %s- e=%s",r.TAG,"_onRecordingError",e)},r.prototype._preview=function(e){console.log("%s: %s",r.TAG,"_preview"),e.preventDefault(),this._destroyPlayers(),this.page==r.Page.INTERPRETATION&&this._createPlayer(),this.wasRecording=!0,this.mode=r.Mode.PREVIEW,this._createPlayer(!0)},r.prototype._done=function(e){console.log("%s: %s",r.TAG,"_done"),e.preventDefault(),$(this).trigger($.Event(r.Event.DONE,{media:this.recordedMedia,doPost:!1}))},r.prototype._doneAndPost=function(e){console.log("%s: %s",r.TAG,"_doneAndPost"),e.preventDefault(),$(this).trigger($.Event(r.Event.DONE,{media:this.recordedMedia,doPost:!0}))},r.prototype._destroyPlayers=function(){console.log("%s: %s",r.TAG,"_destroyPlayers");var e=function(e){var t=this._getElement(e),n=t.parent();t.removeAttr("src"),n.hide(),n.after(t.detach()),n.remove()}.bind(this);this.player!=null&&(this.player.destroyRecorder(),this.page==r.Page.NORMAL?e(r.Binder.NORMAL_VIDEO):this.sourceMedia!=null&&e(r.Binder.INTERP_VIDEO_P),this.player=null),this.recorder!=null&&(this.recorder.destroyRecorder(),this.page==r.Page.NORMAL?e(r.Binder.NORMAL_VIDEO):this.sourceMedia!=null&&e(r.Binder.INTERP_VIDEO_R),this.recorder=null),this._getElement(r.Binder.CONTROLS).html("")},r.prototype._onPageAnimate=function(){try{if(this.mode==r.Mode.PREVIEW&&this.recordedMedia!=null){if(this.page==r.Page.INTERPRETATION&&this.sourceMedia!=null)return;this._createPlayer(!0)}else{if(this.page==r.Page.INTERPRETATION){if(this.sourceMedia==null)return;this._createPlayer()}this._createRecorder()}}catch(e){console.error("%s: %s- err=%o",r.TAG,"_loadPage",e)}},r.prototype._loadPage=function(){this.page==r.Page.INTERPRETATION&&(this.sourceMedia!=null?(this._getElement(r.Binder.INTERP_SELECT).parent().hide(),this._getElement(r.Binder.INTERP_VIDEO_P).show(),this._getElement(r.Binder.INTERP_VIDEO_R).show()):(this._getElement(r.Binder.INTERP_SELECT).parent().show(),this._getElement(r.Binder.INTERP_VIDEO_P).hide(),this._getElement(r.Binder.INTERP_VIDEO_R).hide())),this._getElement(r.Binder.MODAL_DIALOG).find(".modal-dialog").animate({width:this.page==r.Page.NORMAL?"900px":this.sourceMedia!=null?"90%":"900px"},{complete:this.bind__onPageAnimate})},r.prototype._onShownModal=function(e){this._destroyPlayers(),this._loadPage()},r.prototype._onHiddenModal=function(e){this._destroyPlayers();if(this.paused)return;$(this).trigger($.Event(r.Event.HIDDEN,{}))},r.prototype._onShowTab=function(e){this._destroyPlayers(),this.page=$(e.target).attr("href")==r.Binder.NORMAL?r.Page.NORMAL:r.Page.INTERPRETATION,this._loadPage()},r.prototype._onShownTab=function(e){this._getElement(r.Binder.INTERP_VIDEO_P)[0].load()},r.prototype._onBlurPlayerTitle=function(e){console.log("updated title"),this.recordedMedia.title=$(e.target).val(),this.mediaManager.updateMedia(this.recordedMedia)},r.prototype._onClickInterpSelect=function(e){e.preventDefault(),this.myFilesSelector=new n({multiSelect:!1,filter:{type:1}}),$(this.myFilesSelector).on(n.Event.READY,function(e){this.paused=!0,this.hide(),this.myFilesSelector.show()}.bind(this)),$(this.myFilesSelector).on(n.Event.DONE,function(e){this.myFilesSelector.hide(),this.setSourceMedia(e.media[0])}.bind(this)),$(this.myFilesSelector).on(n.Event.HIDDEN,function(e){this.myFilesSelector.destroy(),this.show(),this.paused=!1}.bind(this)),this.myFilesSelector.render()},r.prototype._bindUIEvents=function(){var e=this._getElement(r.Binder.MODAL_DIALOG);e.modal({backdrop:"static",show:!1}),e.on("shown.bs.modal",this.bind__onShownModal),e.on("hidden.bs.modal",this.bind__onHiddenModal);var t=e.find("a[data-toggle='tab']");t.on("show.bs.tab",this.bind__onShowTab),t.on("shown.bs.tab",this.bind__onShownTab),this._getElement(r.Binder.NORMAL_TITLE).blur(this.bind__onBlurPlayerTitle),this._getElement(r.Binder.INTERP_TITLE).blur(this.bind__onBlurPlayerTitle),this._getElement(r.Binder.INTERP_SELECT).on("click",this.bind__onClickInterpSelect)},r.prototype._onRender=function(e,t){this.getContainer().append(t);var n=this.page==r.Page.NORMAL?r.Binder.NORMAL:r.Binder.INTERP,i=this._getElement(r.Binder.MODAL_DIALOG);i.find("a[href!='"+n+"']").parent().removeClass("active"),i.find("a[href='"+n+"']").parent().addClass("active"),i.find(".tab-pane:not('"+n+"')").removeClass("active"),i.find(".tab-pane"+n).addClass("active"),this.mode==r.Mode.PREVIEW&&i.find("a[href='"+r.Binder.INTERP+"']").hide(),this._bindUIEvents(),$(this).trigger($.Event(r.Event.READY,{}))},r.prototype.render=function(){dust.render("recorder",{},this.bind__onRender)},r.prototype.show=function(){this._getElement(r.Binder.MODAL_DIALOG).modal("show")},r.prototype.hide=function(){this._getElement(r.Binder.MODAL_DIALOG).modal("hide")},r.prototype.destroy=function(){this._getElement(r.Binder.MODAL_DIALOG).remove()},r.prototype._injectMedia=function(t,n){var r=this._getElement(t),i=r.find("source");r.removeAttr("src"),i.attr("src",e.generateUrl(n.resource.pathMPEG))},r.prototype.setSourceMedia=function(e){this.sourceMedia=e,this.sourceMedia!=null&&this._injectMedia(r.Binder.INTERP_VIDEO_P,this.sourceMedia),this._destroyPlayers(),this._loadPage()},r.prototype._togglePlayerTitle=function(){var e=this._getElement(r.Binder.NORMAL_TITLE),t=this._getElement(r.Binder.INTERP_TITLE),n=this.recordedMedia!=null?this.recordedMedia.title:"";this.page==r.Page.NORMAL?(t.hide().val(""),e.toggle().val(n)):(e.hide().val(""),t.toggle().val(n))},r.prototype.setRecordedMedia=function(e){this.recordedMedia=e,this.recordedMedia!=null&&this._injectMedia(this.page==r.Page.NORMAL?r.Binder.NORMAL_VIDEO:r.Binder.INTERP_VIDEO_R,this.recordedMedia),this._togglePlayerTitle()},r}),define("core/mediaChooser",["core/mediaManager","core/recorder","core/helper","core/myFilesSelector"],function(e,t,n,r){var i=function(t){var n={isFileSelection:!0,enableDoneAndPost:!1};t=t||n;for(var r in n)this[r]=typeof t[r]!="undefined"?t[r]:n[r];this.container=null,this.media=[],this.recorder=null,this.player=null,this.mediaManager=new e,this.bind__onGetMediaInfoSuccess=this._onGetMediaInfoSuccess.bind(this),this.bind__onGetMediaInfoError=this._onGetMediaInfoError.bind(this),this.bind__onLoadPageSuccess=this._onLoadPageSuccess.bind(this),this.bind__onClickRemoveSelectedMedia=this._onClickRemoveSelectedMedia.bind(this),$(this.mediaManager).on(e.Event.GET_INFO_SUCCESS,this.bind__onGetMediaInfoSuccess),$(this.mediaManager).on(e.Event.GET_INFO_ERROR,this.bind__onGetMediaInfoError)};return i.TAG="MediaChooser",i.Page={RECORD_VIDEO:"recordVideo",SELECT:"select",PREVIEW:"preview"},i.Event={SUCCESS:"eventSuccess",SUCCESS_AND_POST:"eventSuccessAndPost",ERROR:"eventError",RESET:"eventReset"},i.Binder={CONTAINER_CHOOSE:".mediachooser-container-choose",RECORD_VIDEO:".mediachooser-record-video",UPLOAD_FILE:".mediachooser-upload-file",SELECT:".mediachooser-select",CONTAINER_UPLOAD:".mediachooser-container-upload",UPLOAD_TITLE:".mediachooser-upload-title",CONTAINER_SELECTED:".mediachooser-container-selected",WORKING:".mediachooser-working",SELECTED:".mediachooser-selected",SELECTED_MEDIA:".mediachooser-selected-media",REMOVE:".mediachooser-remove"},i.FORM_NAME="media",i.MEDIA_TYPE={AUDIO:{id:2,str:"audio"},VIDEO:{id:1,str:"video"},IMAGE:{id:0,str:"image"},OTHER:{id:9,str:"other"}},i.DIALOG_TITLE_SELECT="Select from My Files",i.DIALOG_TITLE_PREVIEW="Preview",i.prototype.getContainer=function(){return this.container},i.prototype._getElement=function(e){return this.getContainer().find(e)},i.prototype.getForm=function(){return typeof this.uploadForm=="undefined"&&(this.uploadForm=$(this._getElement(i.Binder.CONTAINER_UPLOAD).data("form"))),this.uploadForm},i.prototype.getFormField=function(e){return this.getForm().find("#"+i.FORM_NAME+"_"+e)},i.prototype.bindUIEvents=function(){console.log("%s: %s",i.TAG,"bindUIEvents"),this._getElement(i.Binder.RECORD_VIDEO).on("click",function(e){e.preventDefault(),this.page=i.Page.RECORD_VIDEO,this.recorder=new t({page:t.Page.NORMAL,enableDoneAndPost:this.enableDoneAndPost}),$(this.recorder).on(t.Event.READY,function(e){this.recorder.show()}.bind(this)),$(this.recorder).on(t.Event.DONE,function(e){this.recorder.hide(),this._addSelectedMedia(e.media),this._invokeSuccess(e.doPost)}.bind(this)),$(this.recorder).on(t.Event.HIDDEN,function(e){this.recorder.destroy()}.bind(this)),this.recorder.render()}.bind(this)),this._getElement(i.Binder.UPLOAD_FILE).on("click",function(e){e.preventDefault(),this.getFormField("resource_file").click()}.bind(this)),this.getFormField("resource_file").on("change",function(e){e.preventDefault();var t=this.getFormField("resource_file").data("maxsize"),n=this.getFormField("resource_file")[0].files[0].size;if(n>t){alert(Translator.trans("form.upload.maxFileSizeExceeded",{fileSize:(n/1048576).toFixed(1)+"MB",maxUploadSize:(t/1048576).toFixed(1)+"MB"})),this.getFormField("resource_file").val("");return}this._loadPage({showPopup:!1,url:Routing.generate("imdc_myfiles_add"),method:"POST",data:new FormData(this.getForm()[0]),uploadProgress:!0}),this.getFormField("resource_file").val("")}.bind(this)),this._getElement(i.Binder.SELECT).on("click",function(e){e.preventDefault(),this.myFilesSelector=new r,$(this.myFilesSelector).on(r.Event.READY,function(e){this.myFilesSelector.show()}.bind(this)),$(this.myFilesSelector).on(r.Event.DONE,function(e){this.myFilesSelector.hide(),$.each(e.media,function(e,t){this._addSelectedMedia(t)}.bind(this)),this._invokeSuccess()}.bind(this)),$(this.myFilesSelector).on(r.Event.HIDDEN,function(e){this.myFilesSelector.destroy()}.bind(this)),this.myFilesSelector.render()}.bind(this)),this._getElement(i.Binder.SELECTED).sortable({update:function(e,t){$(this).trigger($.Event(i.Event.SUCCESS,{}))}.bind(this)})},i.prototype._loadPage=function(e){console.log("%s: %s",i.TAG,"_loadPage");var t={url:e.url,type:e.method,success:this.bind__onLoadPageSuccess,error:function(e,t,n){console.log("%s: %s: %s",i.TAG,"_loadPage","error"),this._invokeError(e)}.bind(this)};t.type!="GET"&&(t.processData=!1,t.data=e.data,t.contentType=!1,e.uploadProgress&&(t.xhr=function(){var e=$.ajaxSettings.xhr();return e.upload.addEventListener("progress",function(e){if(!e.lengthComputable)return;n.updateProgressBar(this._getElement(i.Binder.CONTAINER_UPLOAD).show(),Math.floor(e.loaded/e.total*100))}.bind(this),!1),e}.bind(this))),$.ajax(t)},i.prototype._onLoadPageSuccess=function(e,t,n){console.log("%s: %s- finished=%s",i.TAG,"_onLoadPageSuccess",e.finished),e.finished&&(this._addSelectedMedia(e.media),this._invokeSuccess())},i.prototype._onClickRemoveSelectedMedia=function(e){e.preventDefault();var t=$(e.currentTarget).data("mid");this._removeSelectedMedia(t),$(this).trigger($.Event(i.Event.SUCCESS,{}))},i.prototype._addSelectedMedia=function(e){var t=this._getElement(i.Binder.SELECTED_MEDIA).filter("[data-mid='"+e.id+"']").length;if(t>0)return;var n=this._getElement(i.Binder.SELECTED),r=n.data("prototype");r=r.replace(/__id__/g,e.id),r=r.replace(/__title__/g,e.title),r=r.replace(/__resource_webPath__/g,e.resource.pathMPEG),n.append(r),this._getElement(i.Binder.SELECTED_MEDIA).filter("[data-mid='"+e.id+"']").find(i.Binder.REMOVE).on("click",this.bind__onClickRemoveSelectedMedia),this._addMedia(e)},i.prototype._removeSelectedMedia=function(e){this._removeMedia(e),this._getElement(i.Binder.SELECTED_MEDIA).filter("[data-mid='"+e+"']").remove()},i.prototype._invokeSuccess=function(e){console.log("%s: %s",i.TAG,"_invokeSuccess");var t={media:this.media};this._getElement(i.Binder.UPLOAD_TITLE).html(""),this._getElement(i.Binder.CONTAINER_UPLOAD).hide(),typeof e!="undefined"&&e==1?$(this).trigger($.Event(i.Event.SUCCESS_AND_POST,t)):$(this).trigger($.Event(i.Event.SUCCESS,t))},i.prototype._invokeError=function(e){console.log("%s: %s- jqXHR=%o",i.TAG,"_invokeError",e),this._getElement(i.Binder.UPLOAD_TITLE).html(""),this._getElement(i.Binder.CONTAINER_UPLOAD).hide(),$(this).trigger($.Event(i.Event.ERROR,{jqXHR:e}))},i.prototype._invokeReset=function(){console.log("%s: %s",i.TAG,"_invokeReset"),this._getElement(i.Binder.UPLOAD_TITLE).html(""),this._getElement(i.Binder.CONTAINER_UPLOAD).hide(),this.media=[],$(this).trigger($.Event(i.Event.RESET,{}))},i.prototype.setContainer=function(e){console.log("%s: %s",i.TAG,"setContainer"),this.container=typeof e!="undefined"?e:this.container},i.prototype._addMedia=function(e){console.log("%s: %s",i.TAG,"_addMedia");if(typeof e=="undefined")return;this.media.push(e)},i.prototype._removeMedia=function(e){console.log("%s: %s",i.TAG,"_removeMedia");for(var t in this.media){var n=this.media[t];if(n.id==e){this.media.splice(t,1);break}}},i.prototype._toggleForm=function(e){this._getElement(i.Binder.RECORD_VIDEO).attr("disabled",e),this._getElement(i.Binder.UPLOAD_FILE).attr("disabled",e),this._getElement(i.Binder.SELECT).attr("disabled",e)},i.prototype._onGetMediaInfoSuccess=function(e){this._getElement(i.Binder.WORKING).hide(),this._toggleForm(!1),$.each(e.payload.media,function(e,t){this._addSelectedMedia(t)}.bind(this)),this._invokeSuccess()},i.prototype._onGetMediaInfoError=function(e){this._getElement(i.Binder.WORKING).hide(),this._toggleForm(!1),console.log(e.jqXHR)},i.prototype.setMedia=function(e){console.log("%s: %s",i.TAG,"setMedia");if(typeof e=="undefined")return;this._toggleForm(!0),this._getElement(i.Binder.WORKING).show(),this._getElement(i.Binder.SELECTED_MEDIA).html(""),this.mediaManager.getInfo(e)},i.prototype.generateFormData=function(e){var t="";return this._getElement(i.Binder.SELECTED_MEDIA).each(function(n,r){var i=$(e.replace(/__name__/g,n));i.val($(r).data("mid")),t+=i[0].outerHTML}),t},i.prototype.reset=function(){this._invokeReset()},i}),define("controller/myFiles",["core/mediaChooser","core/mediaManager","core/myFilesSelector"],function(e,t,n){var r=function(e){console.log("%s: %s- options=%o",r.TAG,"constructor",e),this.mediaChooser=null,this.bind__onSuccess=this._onSuccess.bind(this),$tt._instances.push(this)};return r.TAG="MyFiles",r.prototype.getContainer=function(){return $("body")},r.prototype.bindUIEvents=function(){console.log("%s: %s",r.TAG,"bindUIEvents"),this._bindUIEventsIndex()},r.prototype._bindUIEventsIndex=function(){console.log("%s: %s",r.TAG,"_bindUIEventsIndex"),this.mediaChooser=new e({isFileSelection:!1}),$(this.mediaChooser).on(e.Event.SUCCESS,this.bind__onSuccess),this.mediaChooser.setContainer(this.getContainer()),this.mediaChooser.bindUIEvents(),this.myFilesSelector=new n({container:this.getContainer()}),this.myFilesSelector.bindUIEvents()},r.prototype._onSuccess=function(e){window.location.reload()},r}),define("controller/forum",["core/mediaChooser"],function(e){var t=function(e){console.log("%s: %s- options=%o",t.TAG,"constructor",e);var n={id:-1,media:[]};e=e||n;for(var r in n)this[r]=typeof e[r]!="undefined"?e[r]:n[r];this.page=e.page,this.mediaChooser=null,this.bind__onChangeAccessType=this._onChangeAccessType.bind(this),this.bind__onClickSubmit=this._onClickSubmit.bind(this),this.bind__onClickDelete=this._onClickDelete.bind(this),this.bind__onDeleteSuccess=this._onDeleteSuccess.bind(this),this.bind__onDeleteError=this._onDeleteError.bind(this),this.bind__onSuccess=this._onSuccess.bind(this),this.bind__onReset=this._onReset.bind(this),$tt._instances.push(this)};return t.TAG="Forum",t.Page={NEW:0,EDIT:1,DELETE:2,VIEW:3},t.Binder={SUBMIT:".forum-submit",DELETE_MODAL:".forum-delete-modal",DELETE:".forum-delete"},t.FORM_NAME="forum",t.prototype.getContainer=function(){return $("body")},t.prototype._getElement=function(e){return this.getContainer().find(e)},t.prototype.getForm=function(){return this.getContainer().find("form[name="+t.FORM_NAME+"]")},t.prototype.getFormField=function(e){return this.getContainer().find("#"+t.FORM_NAME+"_"+e)},t.prototype.bindUIEvents=function(){console.log("%s: %s",t.TAG,"bindUIEvents");switch(this.page){case t.Page.NEW:case t.Page.EDIT:this._bindUIEventsNewEdit();break;case t.Page.VIEW:this._bindUIEventsView()}},t.prototype._bindUIEventsNewEdit=function(){console.log("%s: %s",t.TAG,"_bindUIEventsNewEdit"),this.mediaChooser=new e,$(this.mediaChooser).on(e.Event.SUCCESS,this.bind__onSuccess),$(this.mediaChooser).on(e.Event.RESET,this.bind__onReset),this.mediaChooser.setContainer(this.getContainer()),this.mediaChooser.bindUIEvents();var n=[];this.getFormField("titleMedia").children().each(function(e,t){n.push($(t).val())}),n.length>0&&(this._getElement(t.Binder.SUBMIT).attr("disabled",!0),this.mediaChooser.setMedia(n)),this.getForm().find("input:radio").on("change",this.bind__onChangeAccessType),this._getElement(t.Binder.SUBMIT).on("click",this.bind__onClickSubmit),this._getElement(t.Binder.DELETE).on("click",this.bind__onClickDelete),this.getForm().find("input:radio:checked").trigger("change")},t.prototype._bindUIEventsView=function(){console.log("%s: %s",t.TAG,"_bindUIEventsView"),this.gallery=new $tt.Core.Gallery({container:$(".gallery-container")}),$(this.gallery).on($tt.Core.Gallery.Event.READY,function(e){this.gallery.setMedia(this.media)}.bind(this)),this.gallery.render()},t.prototype._onChangeAccessType=function(e){var t=this.getFormField("group"),n=t.parent();$(e.target).attr("id")==this.getForm().find("input:radio[value=6]").attr("id")?(n.find("label").addClass("required"),t.attr("required",!0),n.children().show()):(n.find("label").removeClass("required"),t.attr("required",!1),n.children().hide())},t.prototype._onClickSubmit=function(e){this.getForm()[0].checkValidity()&&$(e.target).button("loading")},t.prototype._onClickDelete=function(e){$(e.target).button("loading"),$.ajax({url:Routing.generate("imdc_forum_delete",{forumid:this.id}),type:"POST",success:this.bind__onDeleteSuccess,error:this.bind__onDeleteError})},t.prototype._onDeleteSuccess=function(e,n,r){if(!e.wasDeleted){this._onDeleteError(r,n,null);return}this._getElement(t.Binder.DELETE_MODAL).find(".modal-body").html("Forum deleted successfully."),window.location.assign(e.redirectUrl)},t.prototype._onDeleteError=function(e,n,r){this._getElement(t.Binder.DELETE_MODAL).find(".modal-body").prepend("Something went wrong. Try again."),this._getElement(t.Binder.DELETE).button("reset")},t.prototype._updateForm=function(){var e=this.getFormField("titleMedia");e.html(this.mediaChooser.generateFormData(e.data("prototype")))},t.prototype._onSuccess=function(e){this._getElement(t.Binder.SUBMIT).attr("disabled",!1),this.getFormField("titleText").attr("required",!1).parent().find("label").removeClass("required"),this._updateForm()},t.prototype._onReset=function(e){this.mediaChooser.media.length==0&&this.getFormField("titleText").attr("required",!0).parent().find("label").addClass("required"),this._updateForm()},t}),define("controller/group",["core/mediaChooser"],function(e){var t=function(e){console.log("%s: %s- options=%o",t.TAG,"constructor",e);var n={id:-1};e=e||n;for(var r in n)this[r]=typeof e[r]!="undefined"?e[r]:n[r];this.page=e.page,this.mediaChooser=null,this.bind__onClickSubmit=this._onClickSubmit.bind(this),this.bind__onClickDelete=this._onClickDelete.bind(this),this.bind__onDeleteSuccess=this._onDeleteSuccess.bind(this),this.bind__onDeleteError=this._onDeleteError.bind(this),this.bind__onClickUserSelect=this._onClickUserSelect.bind(this),this.bind__submitSelectedUsersForm=this._submitSelectedUsersForm.bind(this),this.bind__onSuccess=this._onSuccess.bind(this),this.bind__onReset=this._onReset.bind(this),$tt._instances.push(this)};return t.TAG="Group",t.Page={NEW:0,EDIT:1,ADD_MEMBERS:2,VIEW:3},t.Binder={CONTAINER_MEDIA:".group-container-media",CONTAINER_INFO:".group-container-info",CONTAINER_FORUMS:".group-container-forums",TOGGLE_MEMBER_SELECT:".group-toggle-member-select",USER_CONTAINER_SELECT:".user-container-select",USER_SELECT:".user-select",USER_SELECTED:".user-selected",SUBMIT:".group-submit",DELETE_MODAL:".group-delete-modal",DELETE:".group-delete"},t.FORM_NAME="user_group",t.prototype.getContainer=function(){return $("body")},t.prototype._getElement=function(e){return this.getContainer().find(e)},t.prototype.getForm=function(){return this.getContainer().find("form[name="+t.FORM_NAME+"]")},t.prototype.getFormField=function(e){return this.getForm().find("#"+t.FORM_NAME+"_"+e)},t.prototype.bindUIEvents=function(){console.log("%s: %s",t.TAG,"bindUIEvents");switch(this.page){case t.Page.NEW:case t.Page.EDIT:this._bindUIEventsNewEdit();break;case t.Page.ADD_MEMBERS:this._bindUIEventsAddMembers();break;case t.Page.VIEW:this._bindUIEventsView()}},t.prototype._bindUIEventsNewEdit=function(){console.log("%s: %s",t.TAG,"_bindUIEventsNewEdit"),this.mediaChooser=new e,$(this.mediaChooser).on(e.Event.SUCCESS,this.bind__onSuccess),$(this.mediaChooser).on(e.Event.RESET,this.bind__onReset),this.mediaChooser.setContainer(this.getContainer()),this.mediaChooser.bindUIEvents();var n=[];this.getFormField("media").children().each(function(e,t){n.push($(t).val())}),n.length>0&&(this._getElement(t.Binder.SUBMIT).attr("disabled",!0),this.mediaChooser.setMedia(n)),this._getElement(t.Binder.SUBMIT).on("click",this.bind__onClickSubmit),this._getElement(t.Binder.DELETE).on("click",this.bind__onClickDelete)},t.prototype._bindUIEventsAddMembers=function(){console.log("%s: %s",t.TAG,"_bindUIEventsAddMembers"),$(t.Binder.USER_SELECT).on("click",this.bind__onClickUserSelect),$(t.Binder.USER_SELECT).each(function(e,t){$(t).html($(t).data("select"))}),$("#addSelected").on("click",this.bind__submitSelectedUsersForm)},t.prototype._bindUIEventsView=function(){console.log("%s: %s",t.TAG,"_bindUIEventsView"),$(t.Binder.USER_SELECT).on("click",this.bind__onClickUserSelect),$(t.Binder.USER_SELECT).each(function(e,t){$(t).html($(t).data("select"))}),$(t.Binder.TOGGLE_MEMBER_SELECT).on("click",function(e){e.preventDefault(),$(t.Binder.CONTAINER_MEDIA).toggle(),$(t.Binder.CONTAINER_INFO).toggle(),$(t.Binder.CONTAINER_FORUMS).toggle(),$(t.Binder.USER_CONTAINER_SELECT).toggle(),$("#deleteSelected").parent().toggleClass("disabled")}),$("#deleteSelected").on("click",this.bind__submitSelectedUsersForm)},t.prototype._onClickSubmit=function(e){this.getForm()[0].checkValidity()&&$(e.target).button("loading")},t.prototype._onClickDelete=function(e){$(e.target).button("loading"),$.ajax({url:Routing.generate("imdc_group_delete",{groupId:this.id}),type:"POST",success:this.bind__onDeleteSuccess,error:this.bind__onDeleteError})},t.prototype._onDeleteSuccess=function(e,n,r){if(!e.wasDeleted){this._onDeleteError(r,n,null);return}this._getElement(t.Binder.DELETE_MODAL).find(".modal-body").html("Group deleted successfully."),window.location.assign(e.redirectUrl)},t.prototype._onDeleteError=function(e,n,r){this._getElement(t.Binder.DELETE_MODAL).find(".modal-body").prepend("Something went wrong. Try again."),this._getElement(t.Binder.DELETE).button("reset")},t.prototype._onClickUserSelect=function(e){e&&e.preventDefault&&e.preventDefault();var t=$(e.target),n=t.html()==t.data("selected");t.html(n?t.data("select"):t.data("selected")),t.toggleClass("btn-default btn-success user-selected")},t.prototype._submitSelectedUsersForm=function(e){e&&e.preventDefault&&e.preventDefault();if($(e.target).parent().hasClass("disabled"))return!1;if($(t.Binder.USER_SELECTED).length==0)return alert("No members selected."),!0;$(e.target).button("loading"),$(e.target).parent().toggleClass("disabled");var n=$("#selectedUsersForm .selected-users"),r=0;return n.html(""),$(t.Binder.USER_SELECTED).each(function(e,t){var i=n.data("prototype");i=i.replace(/__name__/g,r),n.append(i),$("."+r+"-id").val($(t).data("uid")),r++}),$("#selectedUsersForm form").submit(),!0},t.prototype._updateForm=function(){var e=this.getFormField("media");e.html(this.mediaChooser.generateFormData(e.data("prototype")))},t.prototype._onSuccess=function(e){this._getElement(t.Binder.SUBMIT).attr("disabled",!1),this._updateForm()},t.prototype._onReset=function(e){this._updateForm()},t}),define("controller/message",["core/mediaChooser"],function(e){var t=function(e){console.log("%s: %s- options=%o",t.TAG,"constructor",e),this.page=e.page,this.mediaChooser=null,this.bind__onSuccess=this._onSuccess.bind(this),this.bind__onReset=this._onReset.bind(this),$tt._instances.push(this)};return t.TAG="Message",t.Page={NEW:0,REPLY:1,VIEW:2},t.Binder={SUBMIT:".message-submit"},t.FORM_NAME="PrivateMessageForm",t.prototype.getContainer=function(){return $("body")},t.prototype._getElement=function(e){return this.getContainer().find(e)},t.prototype.getForm=function(){return this.getContainer().find("form[name="+t.FORM_NAME+"]")},t.prototype.getFormField=function(e){return this.getForm().find("#"+t.FORM_NAME+"_"+e)},t.prototype.bindUIEvents=function(){console.log("%s: %s",t.TAG,"bindUIEvents");switch(this.page){case t.Page.NEW:case t.Page.REPLY:this._bindUIEventsNewReply(this.page==t.Page.REPLY);break;case t.Page.VIEW:this._bindUIEventsView()}},t.prototype._bindUIEventsNewReply=function(n){console.log("%s: %s- isReply=%s",t.TAG,"_bindUIEventsNewReply",n),this.mediaChooser=new e,$(this.mediaChooser).on(e.Event.SUCCESS,this.bind__onSuccess),$(this.mediaChooser).on(e.Event.RESET,this.bind__onReset),this.mediaChooser.setContainer(this.getContainer()),this.mediaChooser.bindUIEvents();var r=[];this.getFormField("attachedMedia").children().each(function(e,t){r.push($(t).val())}),r.length>0&&(this._getElement(t.Binder.SUBMIT).attr("disabled",!0),this.mediaChooser.setMedia(r)),this.getFormField("recipients").tagit()},t.prototype._bindUIEventsView=function(){console.log("%s: %s",t.TAG,"_bindUIEventsView");var e=$(".tt-message-div").first().data("mid");$.post(Routing.generate("imdc_message_mark_as_read",{messageid:e}),{msgId:e},function(e){console.log("%s: %s: data=%o","mark message as read","success",e)})},t.prototype._updateForm=function(){var e=this.getFormField("attachedMedia");e.html(this.mediaChooser.generateFormData(e.data("prototype")))},t.prototype._onSuccess=function(e){this._getElement(t.Binder.SUBMIT).attr("disabled",!1),this._updateForm()},t.prototype._onReset=function(e){this._updateForm()},t}),define("controller/profile",[],function(){var e=function(t){console.log("%s: %s- options=%o",e.TAG,"constructor",t),this.page=t.page,$tt._instances.push(this)};return e.TAG="Profile",e.Page={EDIT:0},e.prototype.bindUIEvents=function(){console.log("%s: %s",e.TAG,"bindUIEvents");switch(this.page){case e.Page.EDIT:this._bindUIEventsEdit()}},e.prototype._bindUIEventsEdit=function(){console.log("%s: %s",e.TAG,"_bindUIEventsEdit"),$("#addAnotherLanguage").on("click",function(t){t.preventDefault(),e.addLanguage(this)}),$(".tt-delete-language").on("click",function(t){t.preventDefault(),e.deleteLanguage(this)})},e.addLanguage=function(t){var n=$("#foss_user_profile_form_languages"),r,i=n.data("delete-language-text"),s=n.data("prototype"),o=$("#foss_user_profile_form_languages > li").length;$("#no-languages").remove(),r=$('<button class="btn btn-danger btn-sm tt-delete-language"></a>').html(i),r.click(function(n){n.preventDefault(),e.deleteLanguage(t)}),s=s.replace(/__name__/g,o),o++;var u=$("<li></li>").html(s);u.append(r),$("#foss_user_profile_form_languages").append(u)},e.deleteLanguage=function(e){var t=$("#foss_user_profile_form_languages"),n=t.data("no-languages-text"),r=$('<span id="no-languages"></span>').html(n);$(e).parent().remove(),$("#foss_user_profile_form_languages > li").length==0&&$("#foss_user_profile_form_languages").append(r)},e}),define("core/gallery",["core/mediaChooser","core/recorder","core/mediaManager","core/helper"],function(e,t,n,r){var i=function(e){console.log("%s: %s- options=%o",i.TAG,"constructor",e);var t={mode:i.Mode.NORMAL};e=e||t;for(var r in t)this[r]=typeof e[r]!="undefined"?e[r]:t[r];this.container=e.container,this.mediaManager=new n,this.media=null,this.activeMedia=null,this.thumbsContainerBounds={width:null,thumbWidth:null,thumbsWidth:null},this.bind__onRender=this._onRender.bind(this),this.bind__onClickAction=this._onClickAction.bind(this),this.bind__onGetMediaInfoSuccess=this._onGetMediaInfoSuccess.bind(this),this.bind__onGetMediaInfoError=this._onGetMediaInfoError.bind(this),this.bind__onRenderMedia=this._onRenderMedia.bind(this),this.bind__onRenderThumbnails=this._onRenderThumbnails.bind(this),this.bind__onClickThumbnail=this._onClickThumbnail.bind(this),this.bind__onClickNormalLeft=this._onClickNormalLeft.bind(this),this.bind__onClickNormalRight=this._onClickNormalRight.bind(this),$(this.mediaManager).on(n.Event.GET_INFO_SUCCESS,this.bind__onGetMediaInfoSuccess),$(this.mediaManager).on(n.Event.GET_INFO_ERROR,this.bind__onGetMediaInfoError)};return i.TAG="Gallery",i.Mode={NORMAL:0,PREVIEW:1},i.Event={READY:"eventReady",DONE:"eventDone",HIDDEN:"eventHidden"},i.Binder={NORMAL:".gallery-normal",NORMAL_ITEM:".gallery-normal-item",NORMAL_ACTION:".gallery-normal-action a",NORMAL_THUMBS:".gallery-normal-thumbs",NORMAL_LEFT:".gallery-normal-left",NORMAL_RIGHT:".gallery-normal-right",PREVIEW:".gallery-preview",PREVIEW_ACTION:".gallery-preview-action a",PREVIEW_PREV:".gallery-preview-prev",PREVIEW_NEXT:".gallery-preview-next",PREVIEW_ITEM:".gallery-preview-item",PREVIEW_THUMBS:".gallery-preview-thumbs"},i.prototype.getContainer=function(){return this.mode==i.Mode.NORMAL?this.container:$("body")},i.prototype._getElement=function(e){return this.getContainer().find(e)},i.prototype._resize=function(e){var t=this._getElement(i.Binder.PREVIEW_ITEM),n=$(window).height(),s=$(window).width();t.css("height",r.isFullscreen()?n:n-210),t.css("top",r.isFullscreen()?0:70),t.css("background-color",r.isFullscreen()?"#000":"transparent"),t.css("width",r.isFullscreen()?"100%":"76%"),t.find("img").css("height",r.isFullscreen()?"100%":"auto")},i.prototype._launchRecorder=function(e,n,r){this.recorder=new t(e),$(this.recorder).on(t.Event.READY,function(e){this.paused=!0,this.hide(),n&&this.recorder.setSourceMedia(this.activeMedia),r&&this.recorder.setRecordedMedia(this.activeMedia),this.recorder.show()}.bind(this)),$(this.recorder).on(t.Event.DONE,function(e){this.recorder.hide(),e.doPost&&window.location.assign(Routing.generate("imdc_thread_new_from_media",{mediaId:e.media.id}))}.bind(this)),$(this.recorder).on(t.Event.HIDDEN,function(e){this.recorder.destroy(),this.show(),this.paused=!1}.bind(this)),this.recorder.render()},i.prototype._onClickAction=function(e){var n=$(e.currentTarget).data("action");switch(n){case 1:this.hide();break;case 2:this._resize(),r.toggleFullScreen(this.$item);break;case 3:this._launchRecorder({page:t.Page.INTERPRETATION,enableDoneAndPost:!0},!0);break;case 4:this._launchRecorder({page:t.Page.NORMAL,mode:t.Mode.PREVIEW},!1,!0)}},i.prototype._onClickThumbnail=function(e){e.preventDefault();var t=$(e.currentTarget).data("mid");this.activeMedia=$.grep(this.media,function(e,n){return e.id==t})[0],dust.render("gallery_media",{media:this.activeMedia},this.bind__onRenderMedia)},i.prototype._calcSlidePosition=function(e){var t=parseInt(this.$thumbs.css("left"),10),n=t+this.thumbsContainerBounds.width,r;return e?r=Math.max(-this.thumbsContainerBounds.thumbsWidth,Math.min(t,n)):r=Math.min(0,Math.max(t,n)),console.log(r),{cPos:t,nPos:n,bound:r}},i.prototype._onClickNormalLeft=function(e){e.preventDefault();var t=this._calcSlidePosition();this.$thumbs.animate({left:t.bound})},i.prototype._onClickNormalRight=function(e){e.preventDefault();var t=this._calcSlidePosition();this.$thumbs.animate({left:t.bound})},i.prototype._onRenderMedia=function(e,t){this.$item.html(t);var n=this.$action.filter("[data-action=3]"),r=this.$action.filter("[data-action=4]");this.activeMedia.type==1?(n.show(),this.mode==i.Mode.PREVIEW&&r.show()):(n.hide(),r.hide()),$(window).trigger("resize")},i.prototype._onRenderThumbnails=function(e,t){this.$thumbs.html(t),this.$thumbs.find("li").on("click",this.bind__onClickThumbnail)},i.prototype._populate=function(){if(typeof this.media=="undefined"||this.media.length==0)return;this.activeMedia=this.media[0],dust.render("gallery_media",{media:this.activeMedia},this.bind__onRenderMedia),dust.render("gallery_thumbnail",{media:this.media},this.bind__onRenderThumbnails)},i.prototype._determineBounds=function(){var e=this.$thumbs.find("li");this.thumbsContainerBounds.width=this.$thumbs.parent().width(),this.thumbsContainerBounds.thumbWidth=e.first().width(),this.thumbsContainerBounds.thumbsWidth=e.length*this.thumbsContainerBounds.thumbWidth,this.thumbsContainerBounds.thumbsWidth<=this.thumbsContainerBounds.width&&(this.$left.attr("disabled",!0).hide(),this.$right.attr("disabled",!0).hide())},i.prototype._bindUIEventsNormal=function(){this.$left.on("click",this.bind__onClickNormalLeft),this.$right.on("click",this.bind__onClickNormalRight),this._determineBounds()},i.prototype._bindUIEventsPreview=function(){$(window).on("resize",function(e){var t=function(e,t){return($(window).height()-70)/2-$(this).height()/2};this.$prev.css("top",t),this.$next.css("top",t),this._resize()}.bind(this)),$(window).trigger("resize")},i.prototype._cacheDomObjects=function(){this.mode==i.Mode.NORMAL?(this.$item=this._getElement(i.Binder.NORMAL_ITEM),this.$action=this._getElement(i.Binder.NORMAL_ACTION),this.$thumbs=this._getElement(i.Binder.NORMAL_THUMBS),this.$left=this._getElement(i.Binder.NORMAL_LEFT),this.$right=this._getElement(i.Binder.NORMAL_RIGHT)):(this.$action=this._getElement(i.Binder.PREVIEW_ACTION),this.$prev=this._getElement(i.Binder.PREVIEW_PREV),this.$next=this._getElement(i.Binder.PREVIEW_NEXT),this.$item=this._getElement(i.Binder.PREVIEW_ITEM),this.$thumbs=this._getElement(i.Binder.PREVIEW_THUMBS))},i.prototype._bindUIEvents=function(){this.$action.on("click",this.bind__onClickAction),this.mode==i.Mode.NORMAL?this._bindUIEventsNormal():this._bindUIEventsPreview()},i.prototype._onRender=function(e,t){this.getContainer().append(t),this._cacheDomObjects(),this._bindUIEvents(),$(this).trigger($.Event(i.Event.READY,{}))},i.prototype._onGetMediaInfoSuccess=function(e){this.media=e.payload.media,this._populate()},i.prototype._onGetMediaInfoError=function(e){console.log(e.jqXHR)},i.prototype.render=function(e){dust.render(this.mode==i.Mode.NORMAL?"gallery_normal":"gallery_preview",this.media,this.bind__onRender),typeof e!="undefined"&&this.mediaManager.getInfo(e)},i.prototype.show=function(){if(this.mode!=i.Mode.PREVIEW)return;this.getContainer().css({overflow:"hidden"}),this._getElement(i.Binder.PREVIEW).fadeIn()},i.prototype.hide=function(){if(this.mode!=i.Mode.PREVIEW)return;this.paused||this.getContainer().removeAttr("style"),this._getElement(i.Binder.PREVIEW).fadeOut({complete:function(){if(this.paused)return;$(this).trigger($.Event(i.Event.HIDDEN,{}))}.bind(this)})},i.prototype.destroy=function(){this._getElement(this.mode==i.Mode.NORMAL?i.Binder.NORMAL:i.Binder.PREVIEW).remove()},i.prototype.setMedia=function(e){this.media=e,this._populate()},i}),define("bootstrap",[],function(){var e=function(e,t,n,r){var i=new t(e,r);new n(i,r),i.onViewLoaded()};return e}),define("service",["require"],function(e){var t=function(){};return t.get=function(t){if(!$tt._services[t]){var n=e("service/"+t+"Service");$tt._services[t]=new n}return $tt._services[t]},t}),define("factory/groupFactory",[],function(){var e={};return e.delete=function(e){var t={url:Routing.generate("imdc_group_delete",{groupId:e.id}),type:"POST"};return $.ajax(t).then(function(e,t,n){return e.wasDeleted?$.Deferred().resolve(e):$.Deferred().reject()},function(e,t,n){return console.log(e.responseText),$.Deferred().reject()})},e}),define("factory/postFactory",[],function(){var e={};return e._prepForm=function(e,t){e&&(t.type="POST",t.contentType=!1,t.data=new FormData(e),t.processData=!1)},e.new=function(t,n){var r={url:Routing.generate("imdc_post_new",{threadId:t.get("threadId"),pid:t.get("parentPostId")||t.get("id")})};return e._prepForm(n,r),$.ajax(r).then(function(e,t,n){return $.Deferred().resolve(e)},function(e,t,n){return console.log(e.responseText),$.Deferred().reject()})},e.view=function(e){var t={url:Routing.generate("imdc_post_view",{pid:e.get("id")})};return $.ajax(t).then(function(e,t,n){return $.Deferred().resolve(e)},function(e,t,n){return console.log(e.responseText),$.Deferred().reject()})},e.edit=function(t,n){var r={url:Routing.generate("imdc_post_edit",{pid:t.get("id")})};return e._prepForm(n,r),$.ajax(r).then(function(e,n,r){return e.wasEdited&&(t.set("startTime",e.post.startTime),t.set("endTime",e.post.endTime),t.set("isTemporal",e.post.isTemporal)),$.Deferred().resolve(e)},function(e,t,n){return console.log(e.responseText),$.Deferred().reject()})},e.delete=function(e){var t={url:Routing.generate("imdc_post_delete",{pid:e.get("id")}),type:"POST"};return $.ajax(t).then(function(e,t,n){return e.wasDeleted?$.Deferred().resolve(e):$.Deferred().reject()},function(e,t,n){return console.log(e.responseText),$.Deferred().reject()})},e}),define("factory/threadFactory",[],function(){var e={};return e.delete=function(e){var t={url:Routing.generate("imdc_thread_delete",{threadid:e.id}),type:"POST"};return $.ajax(t).then(function(e,t,n){return e.wasDeleted?$.Deferred().resolve(e):$.Deferred().reject()},function(e,t,n){return console.log(e.responseText),$.Deferred().reject()})},e}),function(){var e=this,t=e._,n=Array.prototype,r=Object.prototype,i=Function.prototype,s=n.push,o=n.slice,u=n.concat,a=r.toString,f=r.hasOwnProperty,l=Array.isArray,c=Object.keys,h=i.bind,p=function(e){return e instanceof p?e:this instanceof p?void (this._wrapped=e):new p(e)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=p),exports._=p):e._=p,p.VERSION="1.7.0";var d=function(e,t,n){if(t===void 0)return e;switch(null==n?3:n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)};case 4:return function(n,r,i,s){return e.call(t,n,r,i,s)}}return function(){return e.apply(t,arguments)}};p.iteratee=function(e,t,n){return null==e?p.identity:p.isFunction(e)?d(e,t,n):p.isObject(e)?p.matches(e):p.property(e)},p.each=p.forEach=function(e,t,n){if(null==e)return e;t=d(t,n);var r,i=e.length;if(i===+i)for(r=0;i>r;r++)t(e[r],r,e);else{var s=p.keys(e);for(r=0,i=s.length;i>r;r++)t(e[s[r]],s[r],e)}return e},p.map=p.collect=function(e,t,n){if(null==e)return[];t=p.iteratee(t,n);for(var r,i=e.length!==+e.length&&p.keys(e),s=(i||e).length,o=Array(s),u=0;s>u;u++)r=i?i[u]:u,o[u]=t(e[r],r,e);return o};var v="Reduce of empty array with no initial value";p.reduce=p.foldl=p.inject=function(e,t,n,r){null==e&&(e=[]),t=d(t,r,4);var i,s=e.length!==+e.length&&p.keys(e),o=(s||e).length,u=0;if(arguments.length<3){if(!o)throw new TypeError(v);n=e[s?s[u++]:u++]}for(;o>u;u++)i=s?s[u]:u,n=t(n,e[i],i,e);return n},p.reduceRight=p.foldr=function(e,t,n,r){null==e&&(e=[]),t=d(t,r,4);var i,s=e.length!==+e.length&&p.keys(e),o=(s||e).length;if(arguments.length<3){if(!o)throw new TypeError(v);n=e[s?s[--o]:--o]}for(;o--;)i=s?s[o]:o,n=t(n,e[i],i,e);return n},p.find=p.detect=function(e,t,n){var r;return t=p.iteratee(t,n),p.some(e,function(e,n,i){return t(e,n,i)?(r=e,!0):void 0}),r},p.filter=p.select=function(e,t,n){var r=[];return null==e?r:(t=p.iteratee(t,n),p.each(e,function(e,n,i){t(e,n,i)&&r.push(e)}),r)},p.reject=function(e,t,n){return p.filter(e,p.negate(p.iteratee(t)),n)},p.every=p.all=function(e,t,n){if(null==e)return!0;t=p.iteratee(t,n);var r,i,s=e.length!==+e.length&&p.keys(e),o=(s||e).length;for(r=0;o>r;r++)if(i=s?s[r]:r,!t(e[i],i,e))return!1;return!0},p.some=p.any=function(e,t,n){if(null==e)return!1;t=p.iteratee(t,n);var r,i,s=e.length!==+e.length&&p.keys(e),o=(s||e).length;for(r=0;o>r;r++)if(i=s?s[r]:r,t(e[i],i,e))return!0;return!1},p.contains=p.include=function(e,t){return null==e?!1:(e.length!==+e.length&&(e=p.values(e)),p.indexOf(e,t)>=0)},p.invoke=function(e,t){var n=o.call(arguments,2),r=p.isFunction(t);return p.map(e,function(e){return(r?t:e[t]).apply(e,n)})},p.pluck=function(e,t){return p.map(e,p.property(t))},p.where=function(e,t){return p.filter(e,p.matches(t))},p.findWhere=function(e,t){return p.find(e,p.matches(t))},p.max=function(e,t,n){var r,i,s=-1/0,o=-1/0;if(null==t&&null!=e){e=e.length===+e.length?e:p.values(e);for(var u=0,a=e.length;a>u;u++)r=e[u],r>s&&(s=r)}else t=p.iteratee(t,n),p.each(e,function(e,n,r){i=t(e,n,r),(i>o||i===-1/0&&s===-1/0)&&(s=e,o=i)});return s},p.min=function(e,t,n){var r,i,s=1/0,o=1/0;if(null==t&&null!=e){e=e.length===+e.length?e:p.values(e);for(var u=0,a=e.length;a>u;u++)r=e[u],s>r&&(s=r)}else t=p.iteratee(t,n),p.each(e,function(e,n,r){i=t(e,n,r),(o>i||1/0===i&&1/0===s)&&(s=e,o=i)});return s},p.shuffle=function(e){for(var t,n=e&&e.length===+e.length?e:p.values(e),r=n.length,i=Array(r),s=0;r>s;s++)t=p.random(0,s),t!==s&&(i[s]=i[t]),i[t]=n[s];return i},p.sample=function(e,t,n){return null==t||n?(e.length!==+e.length&&(e=p.values(e)),e[p.random(e.length-1)]):p.shuffle(e).slice(0,Math.max(0,t))},p.sortBy=function(e,t,n){return t=p.iteratee(t,n),p.pluck(p.map(e,function(e,n,r){return{value:e,index:n,criteria:t(e,n,r)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||n===void 0)return 1;if(r>n||r===void 0)return-1}return e.index-t.index}),"value")};var m=function(e){return function(t,n,r){var i={};return n=p.iteratee(n,r),p.each(t,function(r,s){var o=n(r,s,t);e(i,r,o)}),i}};p.groupBy=m(function(e,t,n){p.has(e,n)?e[n].push(t):e[n]=[t]}),p.indexBy=m(function(e,t,n){e[n]=t}),p.countBy=m(function(e,t,n){p.has(e,n)?e[n]++:e[n]=1}),p.sortedIndex=function(e,t,n,r){n=p.iteratee(n,r,1);for(var i=n(t),s=0,o=e.length;o>s;){var u=s+o>>>1;n(e[u])<i?s=u+1:o=u}return s},p.toArray=function(e){return e?p.isArray(e)?o.call(e):e.length===+e.length?p.map(e,p.identity):p.values(e):[]},p.size=function(e){return null==e?0:e.length===+e.length?e.length:p.keys(e).length},p.partition=function(e,t,n){t=p.iteratee(t,n);var r=[],i=[];return p.each(e,function(e,n,s){(t(e,n,s)?r:i).push(e)}),[r,i]},p.first=p.head=p.take=function(e,t,n){return null==e?void 0:null==t||n?e[0]:0>t?[]:o.call(e,0,t)},p.initial=function(e,t,n){return o.call(e,0,Math.max(0,e.length-(null==t||n?1:t)))},p.last=function(e,t,n){return null==e?void 0:null==t||n?e[e.length-1]:o.call(e,Math.max(e.length-t,0))},p.rest=p.tail=p.drop=function(e,t,n){return o.call(e,null==t||n?1:t)},p.compact=function(e){return p.filter(e,p.identity)};var g=function(e,t,n,r){if(t&&p.every(e,p.isArray))return u.apply(r,e);for(var i=0,o=e.length;o>i;i++){var a=e[i];p.isArray(a)||p.isArguments(a)?t?s.apply(r,a):g(a,t,n,r):n||r.push(a)}return r};p.flatten=function(e,t){return g(e,t,!1,[])},p.without=function(e){return p.difference(e,o.call(arguments,1))},p.uniq=p.unique=function(e,t,n,r){if(null==e)return[];p.isBoolean(t)||(r=n,n=t,t=!1),null!=n&&(n=p.iteratee(n,r));for(var i=[],s=[],o=0,u=e.length;u>o;o++){var a=e[o];if(t)o&&s===a||i.push(a),s=a;else if(n){var f=n(a,o,e);p.indexOf(s,f)<0&&(s.push(f),i.push(a))}else p.indexOf(i,a)<0&&i.push(a)}return i},p.union=function(){return p.uniq(g(arguments,!0,!0,[]))},p.intersection=function(e){if(null==e)return[];for(var t=[],n=arguments.length,r=0,i=e.length;i>r;r++){var s=e[r];if(!p.contains(t,s)){for(var o=1;n>o&&p.contains(arguments[o],s);o++);o===n&&t.push(s)}}return t},p.difference=function(e){var t=g(o.call(arguments,1),!0,!0,[]);return p.filter(e,function(e){return!p.contains(t,e)})},p.zip=function(e){if(null==e)return[];for(var t=p.max(arguments,"length").length,n=Array(t),r=0;t>r;r++)n[r]=p.pluck(arguments,r);return n},p.object=function(e,t){if(null==e)return{};for(var n={},r=0,i=e.length;i>r;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n},p.indexOf=function(e,t,n){if(null==e)return-1;var r=0,i=e.length;if(n){if("number"!=typeof n)return r=p.sortedIndex(e,t),e[r]===t?r:-1;r=0>n?Math.max(0,i+n):n}for(;i>r;r++)if(e[r]===t)return r;return-1},p.lastIndexOf=function(e,t,n){if(null==e)return-1;var r=e.length;for("number"==typeof n&&(r=0>n?r+n+1:Math.min(r,n+1));--r>=0;)if(e[r]===t)return r;return-1},p.range=function(e,t,n){arguments.length<=1&&(t=e||0,e=0),n=n||1;for(var r=Math.max(Math.ceil((t-e)/n),0),i=Array(r),s=0;r>s;s++,e+=n)i[s]=e;return i};var y=function(){};p.bind=function(e,t){var n,r;if(h&&e.bind===h)return h.apply(e,o.call(arguments,1));if(!p.isFunction(e))throw new TypeError("Bind must be called on a function");return n=o.call(arguments,2),r=function(){if(this instanceof r){y.prototype=e.prototype;var i=new y;y.prototype=null;var s=e.apply(i,n.concat(o.call(arguments)));return p.isObject(s)?s:i}return e.apply(t,n.concat(o.call(arguments)))}},p.partial=function(e){var t=o.call(arguments,1);return function(){for(var n=0,r=t.slice(),i=0,s=r.length;s>i;i++)r[i]===p&&(r[i]=arguments[n++]);for(;n<arguments.length;)r.push(arguments[n++]);return e.apply(this,r)}},p.bindAll=function(e){var t,n,r=arguments.length;if(1>=r)throw new Error("bindAll must be passed function names");for(t=1;r>t;t++)n=arguments[t],e[n]=p.bind(e[n],e);return e},p.memoize=function(e,t){var n=function(r){var i=n.cache,s=t?t.apply(this,arguments):r;return p.has(i,s)||(i[s]=e.apply(this,arguments)),i[s]};return n.cache={},n},p.delay=function(e,t){var n=o.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},p.defer=function(e){return p.delay.apply(p,[e,1].concat(o.call(arguments,1)))},p.throttle=function(e,t,n){var r,i,s,o=null,u=0;n||(n={});var a=function(){u=n.leading===!1?0:p.now(),o=null,s=e.apply(r,i),o||(r=i=null)};return function(){var f=p.now();u||n.leading!==!1||(u=f);var l=t-(f-u);return r=this,i=arguments,0>=l||l>t?(clearTimeout(o),o=null,u=f,s=e.apply(r,i),o||(r=i=null)):o||n.trailing===!1||(o=setTimeout(a,l)),s}},p.debounce=function(e,t,n){var r,i,s,o,u,a=function(){var f=p.now()-o;t>f&&f>0?r=setTimeout(a,t-f):(r=null,n||(u=e.apply(s,i),r||(s=i=null)))};return function(){s=this,i=arguments,o=p.now();var f=n&&!r;return r||(r=setTimeout(a,t)),f&&(u=e.apply(s,i),s=i=null),u}},p.wrap=function(e,t){return p.partial(t,e)},p.negate=function(e){return function(){return!e.apply(this,arguments)}},p.compose=function(){var e=arguments,t=e.length-1;return function(){for(var n=t,r=e[t].apply(this,arguments);n--;)r=e[n].call(this,r);return r}},p.after=function(e,t){return function(){return--e<1?t.apply(this,arguments):void 0}},p.before=function(e,t){var n;return function(){return--e>0?n=t.apply(this,arguments):t=null,n}},p.once=p.partial(p.before,2),p.keys=function(e){if(!p.isObject(e))return[];if(c)return c(e);var t=[];for(var n in e)p.has(e,n)&&t.push(n);return t},p.values=function(e){for(var t=p.keys(e),n=t.length,r=Array(n),i=0;n>i;i++)r[i]=e[t[i]];return r},p.pairs=function(e){for(var t=p.keys(e),n=t.length,r=Array(n),i=0;n>i;i++)r[i]=[t[i],e[t[i]]];return r},p.invert=function(e){for(var t={},n=p.keys(e),r=0,i=n.length;i>r;r++)t[e[n[r]]]=n[r];return t},p.functions=p.methods=function(e){var t=[];for(var n in e)p.isFunction(e[n])&&t.push(n);return t.sort()},p.extend=function(e){if(!p.isObject(e))return e;for(var t,n,r=1,i=arguments.length;i>r;r++){t=arguments[r];for(n in t)f.call(t,n)&&(e[n]=t[n])}return e},p.pick=function(e,t,n){var r,i={};if(null==e)return i;if(p.isFunction(t)){t=d(t,n);for(r in e){var s=e[r];t(s,r,e)&&(i[r]=s)}}else{var a=u.apply([],o.call(arguments,1));e=new Object(e);for(var f=0,l=a.length;l>f;f++)r=a[f],r in e&&(i[r]=e[r])}return i},p.omit=function(e,t,n){if(p.isFunction(t))t=p.negate(t);else{var r=p.map(u.apply([],o.call(arguments,1)),String);t=function(e,t){return!p.contains(r,t)}}return p.pick(e,t,n)},p.defaults=function(e){if(!p.isObject(e))return e;for(var t=1,n=arguments.length;n>t;t++){var r=arguments[t];for(var i in r)e[i]===void 0&&(e[i]=r[i])}return e},p.clone=function(e){return p.isObject(e)?p.isArray(e)?e.slice():p.extend({},e):e},p.tap=function(e,t){return t(e),e};var b=function(e,t,n,r){if(e===t)return 0!==e||1/e===1/t;if(null==e||null==t)return e===t;e instanceof p&&(e=e._wrapped),t instanceof p&&(t=t._wrapped);var i=a.call(e);if(i!==a.call(t))return!1;switch(i){case"[object RegExp]":case"[object String]":return""+e==""+t;case"[object Number]":return+e!==+e?+t!==+t:0===+e?1/+e===1/t:+e===+t;case"[object Date]":case"[object Boolean]":return+e===+t}if("object"!=typeof e||"object"!=typeof t)return!1;for(var s=n.length;s--;)if(n[s]===e)return r[s]===t;var o=e.constructor,u=t.constructor;if(o!==u&&"constructor"in e&&"constructor"in t&&!(p.isFunction(o)&&o instanceof o&&p.isFunction(u)&&u instanceof u))return!1;n.push(e),r.push(t);var f,l;if("[object Array]"===i){if(f=e.length,l=f===t.length)for(;f--&&(l=b(e[f],t[f],n,r)););}else{var c,h=p.keys(e);if(f=h.length,l=p.keys(t).length===f)for(;f--&&(c=h[f],l=p.has(t,c)&&b(e[c],t[c],n,r)););}return n.pop(),r.pop(),l};p.isEqual=function(e,t){return b(e,t,[],[])},p.isEmpty=function(e){if(null==e)return!0;if(p.isArray(e)||p.isString(e)||p.isArguments(e))return 0===e.length;for(var t in e)if(p.has(e,t))return!1;return!0},p.isElement=function(e){return!!e&&1===e.nodeType},p.isArray=l||function(e){return"[object Array]"===a.call(e)},p.isObject=function(e){var t=typeof e;return"function"===t||"object"===t&&!!e},p.each(["Arguments","Function","String","Number","Date","RegExp"],function(e){p["is"+e]=function(t){return a.call(t)==="[object "+e+"]"}}),p.isArguments(arguments)||(p.isArguments=function(e){return p.has(e,"callee")}),"function"!=typeof /./&&(p.isFunction=function(e){return"function"==typeof e||!1}),p.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},p.isNaN=function(e){return p.isNumber(e)&&e!==+e},p.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"===a.call(e)},p.isNull=function(e){return null===e},p.isUndefined=function(e){return e===void 0},p.has=function(e,t){return null!=e&&f.call(e,t)},p.noConflict=function(){return e._=t,this},p.identity=function(e){return e},p.constant=function(e){return function(){return e}},p.noop=function(){},p.property=function(e){return function(t){return t[e]}},p.matches=function(e){var t=p.pairs(e),n=t.length;return function(e){if(null==e)return!n;e=new Object(e);for(var r=0;n>r;r++){var i=t[r],s=i[0];if(i[1]!==e[s]||!(s in e))return!1}return!0}},p.times=function(e,t,n){var r=Array(Math.max(0,e));t=d(t,n,1);for(var i=0;e>i;i++)r[i]=t(i);return r},p.random=function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))},p.now=Date.now||function(){return(new Date).getTime()};var w={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},E=p.invert(w),S=function(e){var t=function(t){return e[t]},n="(?:"+p.keys(e).join("|")+")",r=RegExp(n),i=RegExp(n,"g");return function(e){return e=null==e?"":""+e,r.test(e)?e.replace(i,t):e}};p.escape=S(w),p.unescape=S(E),p.result=function(e,t){if(null==e)return void 0;var n=e[t];return p.isFunction(n)?e[t]():n};var x=0;p.uniqueId=function(e){var t=++x+"";return e?e+t:t},p.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var T=/(.)^/,N={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},C=/\\|'|\r|\n|\u2028|\u2029/g,k=function(e){return"\\"+N[e]};p.template=function(e,t,n){!t&&n&&(t=n),t=p.defaults({},t,p.templateSettings);var r=RegExp([(t.escape||T).source,(t.interpolate||T).source,(t.evaluate||T).source].join("|")+"|$","g"),i=0,s="__p+='";e.replace(r,function(t,n,r,o,u){return s+=e.slice(i,u).replace(C,k),i=u+t.length,n?s+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":r?s+="'+\n((__t=("+r+"))==null?'':__t)+\n'":o&&(s+="';\n"+o+"\n__p+='"),t}),s+="';\n",t.variable||(s="with(obj||{}){\n"+s+"}\n"),s="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+s+"return __p;\n";try{var o=new Function(t.variable||"obj","_",s)}catch(u){throw u.source=s,u}var a=function(e){return o.call(this,e,p)},f=t.variable||"obj";return a.source="function("+f+"){\n"+s+"}",a},p.chain=function(e){var t=p(e);return t._chain=!0,t};var L=function(e){return this._chain?p(e).chain():e};p.mixin=function(e){p.each(p.functions(e),function(t){var n=p[t]=e[t];p.prototype[t]=function(){var e=[this._wrapped];return s.apply(e,arguments),L.call(this,n.apply(p,e))}})},p.mixin(p),p.each(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=n[e];p.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),"shift"!==e&&"splice"!==e||0!==n.length||delete n[0],L.call(this,n)}}),p.each(["concat","join","slice"],function(e){var t=n[e];p.prototype[e]=function(){return L.call(this,t.apply(this._wrapped,arguments))}}),p.prototype.value=function(){return this._wrapped},"function"==typeof define&&define.amd&&define("underscore",[],function(){return p})}.call(this),define("service/keyPointService",["underscore"],function(){var e=function(){this.name="KeyPoint",this.keyPoints=[],this.subscriptions=[]};return e.Event={TIMELINE:"eventTimeline",DURATION:"eventDuration",SELECTION_TIMES:"eventSelectionTimes",HOVER:"eventHover",CLICK:"eventClick"},e._kIndex=function(e){return _.isString(e)?e:"K"+e},e.prototype.register=function(t){var n=e._kIndex(t.id);_.isObject(t)&&(this.keyPoints[n]=t)},e.prototype.deregister=function(t){var n=e._kIndex(t);_.contains(this.keyPoints,n)&&this.keyPoints.splice(n,1)},e.prototype.subscribe=function(t,n){var r=e._kIndex(t);_.contains(this.subscriptions,r)||(this.subscriptions[r]=[]),_.contains(this.subscriptions[r],n)||this.subscriptions[r].push(n)},e.prototype.unsubscribe=function(t,n){var r=e._kIndex(t);if(_.contains(this.subscriptions,r)){var i=this.subscriptions[r];if(_.contains(i,n)){var s=_.indexOf(i,n);i.splice(s,1)}}},e.prototype.dispatch=function(t,n,r){var i=e._kIndex(t);if((i!=="all"||!_.contains(this.keyPoints,i))&&!_.contains(e.Event,n))return;var s=i==="all"?_.values(this.subscriptions):[this.subscriptions[i]],o=function(e,t,s){var o={type:n};i==="all"?o.keyPoints=this.keyPoints:o.keyPoint=this.keyPoints[i],_.isObject(r)&&_.each(r,function(e,t,n){o[t]=e}),_.each(e,function(e,t,n){_.isFunction(e)&&e.call(this,o)},this)};_.each(s,o,this),i!=="all"&&_.each([this.subscriptions.all],o,this)},e}),define("model/model",["underscore"],function(){var e=function(e){e=e||{};if(!_.isObject(e))throw"data must be an object";this.data=e,this.subscriptions=[]};return e.Event={CHANGE:"eventChange"},e._stringToKeyPath=function(e){return e.split(".")},e.prototype._findKeyPath=function(t,n){var r=e._stringToKeyPath(n);while(r.length!==0){var i=r.shift();if(!_.has(t,i))return undefined;t=t[i]}return t},e.prototype._setKeyPath=function(t,n,r){var i=e._stringToKeyPath(n);while(i.length>1){var s=i.shift();_.has(t,s)?t=t[s]:t[s]={}}t[i.shift()]=r},e.prototype._dispatch=function(e,t){var n={type:e,model:this};_.isObject(t)&&_.each(t,function(e,t,r){n[t]=e}),_.each(this.subscriptions[e],function(e,t,r){_.isFunction(e)&&e.call(this,n)},this)},e.prototype.get=function(e,t){var n=this._findKeyPath(this.data,e);return typeof n!="undefined"?n:t},e.prototype.set=function(t,n,r){var r=typeof r!="undefined"?r:!0,i=this._findKeyPath(this.data,t);this._setKeyPath(this.data,t,n),r&&i!==n&&this._dispatch(e.Event.CHANGE)},e.prototype.subscribe=function(e,t){_.contains(this.subscriptions,e)||(this.subscriptions[e]=[]),_.contains(this.subscriptions[e],t)||this.subscriptions[e].push(t)},e.prototype.unsubscribe=function(e){_.each(this.subscriptions,function(t,n,r){if(_.contains(t,e)){var n=_.indexOf(t,e);t.splice(n,1)}})},e}),define("model/postModel",["model/model","extra"],function(e){var t=function(t){e.prototype.constructor.apply(this,arguments)};return t.extend(e),t.prototype.isNew=function(){return this.data.id.substr(0,1)==="0"},t}),define("controller/groupController",["factory/groupFactory"],function(e){var t=function(e,n){console.log("%s: %s- model=%o, options=%o",t.TAG,"constructor",e,n),this.model=e,this.options=n,$tt._instances.push(this)};return t.TAG="Group",t.prototype.onViewLoaded=function(){},t.prototype.delete=function(t){return e.delete(this.model).done(function(e){window.location.assign(e.redirectUrl)}.bind(this))},t}),define("controller/postController",["factory/postFactory","service","service/keyPointService"],function(e,t,n){var r=function(e,n){console.log("%s: %s- model=%o, options=%o",r.TAG,"constructor",e,n),this.model=e,this.options=n,this.keyPointService=t.get("keyPoint"),this.model.set("keyPoint",new KeyPoint(this.model.get("id"),this.model.get("startTime"),this.model.get("endTime"),"",{drawOnTimeLine:this.model.get("isTemporal")})),this.bind__onKeyPointEvent=this._onKeyPointEvent.bind(this),$tt._instances.push(this)};return r.TAG="Post",r.Event={TIMELINE_KEYPOINT:"eventTimelineKeyPoint"},r.prototype._onKeyPointEvent=function(e){switch(e.type){case n.Event.DURATION:this.model.set("keyPoint.videoDuration",e.duration);break;case n.Event.SELECTION_TIMES:this.model.set("keyPoint.selection",e.selection);break;case n.Event.HOVER:this.model.set("keyPoint.isHovering",e.isMouseOver);break;case n.Event.CLICK:this.model.set("keyPoint.isPlaying",!0),setTimeout(function(){this.model.set("keyPoint.isPlaying",!1)}.bind(this))}},r.prototype.onViewLoaded=function(){var e=this.model.get("keyPoint");this.keyPointService.register(e),this.keyPointService.subscribe(e.id,this.bind__onKeyPointEvent),this.keyPointService.dispatch(e.id,n.Event.TIMELINE,{action:this.options.editing?"edit":"add"})},r.prototype.new=function(t){return e.new(this.model,t).done(function(e){e.wasReplied&&window.location.replace(e.redirectUrl)}.bind(this))},r.prototype.edit=function(t){return e.edit(this.model,t).done(function(e){e.wasEdited&&(this.keyPointService.dispatch(this.model.get("keyPoint").id,n.Event.TIMELINE,{action:"cancel"}),this.options.editing=!1),this.options.editing=!0}.bind(this))},r.prototype.delete=function(){return e.delete(this.model).done(function(e){this.removeKeyPoint()}.bind(this))},r.prototype.interactKeyPoint=function(e){this.keyPointService.dispatch(this.model.get("keyPoint").id,n.Event.TIMELINE,{action:e})},r.prototype.editKeyPoint=function(){this.keyPointService.dispatch(this.model.get("keyPoint").id,n.Event.TIMELINE,{action:"edit"})},r.prototype.removeKeyPoint=function(){var e=this.model.get("keyPoint");this.keyPointService.dispatch(e.id,n.Event.TIMELINE,{action:"remove"}),this.keyPointService.deregister(e.id)},r.prototype.view=function(){return this.options.editing=!1,e.view(this.model).done(function(e){this.keyPointService.dispatch(this.model.get("keyPoint").id,n.Event.TIMELINE,{action:"cancel"})}.bind(this))},r}),define("controller/threadController",["factory/threadFactory","service","service/keyPointService"],function(e,t,n){var r=function(e,n){console.log("%s: %s- model=%o, options=%o",r.TAG,"constructor",e,n),this.model=e,this.options=n,this.keyPointService=t.get("keyPoint"),this.videoSpeed=0,this.player=null,this.keyPoints=[],this.playingKeyPoint=null,this.bind__onTimelineKeyPoint=this._onTimelineKeyPoint.bind(this),$tt._instances.push(this)};return r.TAG="Thread",r.DEFAULT_TEMPORAL_COMMENT_LENGTH=3,r.Event={DURATION:"eventDuration",SELECTION_TIMES:"eventSelectionTimes",KEYPOINT_HOVER:"eventKeyPointHover",KEYPOINT_CLICK:"eventKeyPointClick"},r.prototype._toggleTemporal=function(e,t){this.player.pause(),this.playingKeyPoint=null,!e&&t&&t.options.drawOnTimeLine?(this.player.setPlayHeadImage(""),this.player.seek(t.startTime),this.player.setAreaSelectionStartTime(t.startTime),this.player.setAreaSelectionEndTime(t.endTime),this.player.setAreaSelectionEnabled(!0)):(this.player.setPlayHeadImage(this.options.player.playHeadImage),this.player.setAreaSelectionEnabled(!1))},r.prototype._createPlayer=function(){console.log("%s: %s",r.TAG,"_createPlayer"),this.player=new Player(this.options.player.mediaElement,{areaSelectionEnabled:!1,updateTimeType:Player.DENSITY_BAR_UPDATE_TYPE_ABSOLUTE,audioBar:!1,overlayControls:!0,playHeadImage:this.options.player.playHeadImage,playHeadImageOnClick:function(){var e=this.player.getCurrentTime(),t=new KeyPoint(-1,e,e+r.DEFAULT_TEMPORAL_COMMENT_LENGTH,"",{drawOnTimeLine:!0});this._toggleTemporal(!1,t)}.bind(this)}),this.player.setKeyPoints(this.keyPoints),this.player.createControls(),$(this.player).on(Player.EVENT_AREA_SELECTION_CHANGED,function(e){console.log("%s: %s",r.TAG,Player.EVENT_AREA_SELECTION_CHANGED);var t=this.player.getAreaSelectionTimes();this.keyPointService.dispatch("all",n.Event.SELECTION_TIMES,{selection:{startTime:parseFloat(t.minTime).toFixed(2),endTime:parseFloat(t.maxTime).toFixed(2)}})}.bind(this)),$(this.player).on(Player.EVENT_KEYPOINT_MOUSE_OVER,function(e,t,i){console.log("%s: %s- keyPoint=%o, coords=%o",r.TAG,Player.EVENT_KEYPOINT_MOUSE_OVER,t,i),this.keyPointService.dispatch(t.id,n.Event.HOVER,{isMouseOver:!0}),$("#threadReplyContainer").is(":animated")||$("#threadReplyContainer").animate({scrollTop:$(".post-container[data-pid="+t.id+"]").position().top})}.bind(this)),$(this.player).on(Player.EVENT_KEYPOINT_MOUSE_OUT,function(e,t){console.log("%s: %s- keyPoint=%o",r.TAG,Player.EVENT_KEYPOINT_MOUSE_OUT,t),this.keyPointService.dispatch(t.id,n.Event.HOVER,{isMouseOver:!1})}.bind(this)),$(this.player).on(Player.EVENT_KEYPOINT_CLICK,function(e,t,i){console.log("%s: %s- keyPoint=%o, coords=%o",r.TAG,Player.EVENT_KEYPOINT_CLICK,t,i),this.keyPointService.dispatch(t.id,n.Event.CLICK)}.bind(this)),$(this.player).on(Player.EVENT_KEYPOINT_BEGIN,function(e,t){console.log("%s: %s- keyPoint=%o",r.TAG,Player.EVENT_KEYPOINT_BEGIN,t)}),$(this.player).on(Player.EVENT_KEYPOINT_END,function(e,t){console.log("%s: %s- keyPoint=%o",r.TAG,Player.EVENT_KEYPOINT_END,t),this.playingKeyPoint&&this.playingKeyPoint.id==t.id&&this.player.pause()}.bind(this))},r.prototype._removeKeyPoint=function(e){for(var t in this.keyPoints)if(this.keyPoints[t].id==e.id){this.keyPoints.splice(t,1);break}},r.prototype._onTimelineKeyPoint=function(e){if(e.action=="add"){this._removeKeyPoint(e.keyPoint),e.keyPoint.startTime&&e.keyPoint.endTime&&this.keyPoints.push(e.keyPoint);var t=this.options.player.mediaElement[0].duration;isNaN(t)||this.keyPointService.dispatch("all",n.Event.DURATION,{duration:t})}e.action=="edit"&&(this._removeKeyPoint(e.keyPoint),this._toggleTemporal(!e.keyPoint.startTime||!e.keyPoint.endTime,e.keyPoint)),e.action=="remove"&&(this._toggleTemporal(!0),this._removeKeyPoint(e.keyPoint)),e.action=="cancel"&&this._toggleTemporal(!0),e.action=="click"&&(e.keyPoint.paintHighlightedTimeout=!0,e.keyPoint.paintHighlighted=!0,this.player.seek(e.keyPoint.startTime),this.player.redrawKeyPoints=!0,this.player.repaint(),setTimeout(function(){e.keyPoint.paintHighlightedTimeout=!1,e.keyPoint.paintHighlighted=!1,this.player.redrawKeyPoints=!0,this.player.repaint()}.bind(this),3e3)),e.action=="dblclick"&&(this.playingKeyPoint=e.keyPoint,this.player.seek(e.keyPoint.startTime),this.player.play()),e.action=="mouseenter"&&(e.keyPoint.paintHighlighted=!0,this.player.redrawKeyPoints=!0,this.player.repaint()),e.action=="mouseleave"&&(e.keyPoint.paintHighlightedTimeout||(e.keyPoint.paintHighlighted=!1,this.player.redrawKeyPoints=!0,this.player.repaint()))},r.prototype.onViewLoaded=function(){this.keyPointService.subscribe("all",this.bind__onTimelineKeyPoint),this.options.player&&(this.options.player.mediaElement.on("loadedmetadata",function(e){this.keyPointService.dispatch("all",n.DURATION,{duration:e.target.duration})}),this._createPlayer())},r.prototype.delete=function(t){return e.delete(this.model).done(function(e){window.location.assign(e.redirectUrl)}.bind(this))},r.prototype.adjustVideoSpeed=function(){this.videoSpeed=(this.videoSpeed+1)%3;switch(this.videoSpeed){case 0:return this.options.player.mediaElement[0].playbackRate=1,this.options.player.speedImages.normal;case 1:return this.options.player.mediaElement[0].playbackRate=2,this.options.player.speedImages.fast;case 2:return this.options.player.mediaElement[0].playbackRate=.5,this.options.player.speedImages.slow;default:return this.options.player.mediaElement[0].playbackRate=1,this.options.player.speedImages.normal}},r.prototype.toggleClosedCaptions=function(){},r}),define("views/group/newView",["core/mediaChooser"],function(e){var t=function(n,r){this.controller=n,this.bind__onClickSubmit=this._onClickSubmit.bind(this),this.bind__onSuccess=this._onSuccess.bind(this),this.bind__onReset=this._onReset.bind(this),this.$container=r.container,this.$form=this.$container.find("form[name^="+t.FORM_NAME+"]"),this.$submit=this.$container.find(t.Binder.SUBMIT),this.$submit.on("click",this.bind__onClickSubmit),this.mediaChooser=new e,$(this.mediaChooser).on(e.Event.SUCCESS,this.bind__onSuccess),$(this.mediaChooser).on(e.Event.RESET,this.bind__onReset),this.mediaChooser.setContainer(this.$form),this.mediaChooser.bindUIEvents();var i=[];this._getFormField("media").children().each(function(e,t){i.push($(t).val())}),i.length>0&&(this.$submit.attr("disabled",!0),this.mediaChooser.setMedia(i)),$tt._instances.push(this)};return t.TAG="GroupNewView",t.Binder={SUBMIT:".group-submit"},t.FORM_NAME="user_group",t.prototype._getFormField=function(e){return this.$form.find("#"+t.FORM_NAME+"_"+e)},t.prototype._onClickSubmit=function(e){this.$form[0].checkValidity()&&$(e.target).button("loading")},t.prototype._updateForm=function(){var e=this._getFormField("media");e.html(this.mediaChooser.generateFormData(e.data("prototype")))},t.prototype._onSuccess=function(e){this._updateForm(),this.$submit.attr("disabled",!1)},t.prototype._onReset=function(e){this._updateForm()},t}),define("views/group/editView",["views/group/newView"],function(e){var t=function(n,r){e.prototype.constructor.apply(this,arguments),this.bind__onClickDelete=this._onClickDelete.bind(this),this.$deleteModal=this.$container.find(t.Binder.DELETE_MODAL),this.$delete=this.$container.find(t.Binder.DELETE),this.$delete.on("click",this.bind__onClickDelete)};return t.extend(e),t.TAG="GroupEditView",t.Binder.DELETE_MODAL=".group-delete-modal",t.Binder.DELETE=".group-delete",t.prototype._onClickDelete=function(e){e.preventDefault(),this.$delete.button("loading"),this.controller.delete().done(function(e){this.$deleteModal.find(".modal-body").html("Group deleted successfully.")}.bind(this)).fail(function(){this.$container.find(".modal-body").prepend("Something went wrong. Try again."),this.$delete.button("reset")}.bind(this))},t}),define("views/group/manageView",[],function(){var e=function(t,n){this.controller=t,this.bind__onShownTab=this._onShownTab.bind(this),this.bind__onClickRemove=this._onClickRemove.bind(this),this.bind__onClickAdd=this._onClickAdd.bind(this),this.$container=n.container,this.$form=this.$container.find("form[name^="+e.FORM_NAME+"]"),this.$tabs=this.$container.find(e.Binder.TABS),this.$remove=this.$container.find(e.Binder.REMOVE),this.$add=this.$container.find(e.Binder.ADD),this.$tabs.on("shown.bs.tab",this.bind__onShownTab),this.$remove.on("click",this.bind__onClickRemove),this.$add.on("click",this.bind__onClickAdd),$tt._instances.push(this)};return e.TAG="GroupManageView",e.Binder={TABS:'.group-tabs a[data-toggle="tab"]',REMOVE:".group-remove",ADD:".group-add"},e.FORM_NAME="user_group_manage_search",e.prototype._getFormField=function(t){return this.$form.find("#"+e.FORM_NAME+"_"+t)},e.prototype._onShownTab=function(e){this._getFormField("active_tab").val($(e.target).attr("href"))},e.prototype._onClickRemove=function(e){},e.prototype._onClickAdd=function(e){},e}),define("views/thread/newView",["core/mediaChooser"],function(e){var t=function(n,r){this.controller=n,this.bind__onClickSubmit=this._onClickSubmit.bind(this),this.bind__onSuccess=this._onSuccess.bind(this),this.bind__onReset=this._onReset.bind(this),this.$container=r.container,this.$form=this.$container.find("form[name^="+t.FORM_NAME+"]"),this.$submit=this.$container.find(t.Binder.SUBMIT),this.$submit.on("click",this.bind__onClickSubmit),this.mediaChooser=new e,$(this.mediaChooser).on(e.Event.SUCCESS,this.bind__onSuccess),$(this.mediaChooser).on(e.Event.RESET,this.bind__onReset),this.mediaChooser.setContainer(this.$form),this.mediaChooser.bindUIEvents();var i=[];this._getFormField("mediaIncluded").children().each(function(e,t){i.push($(t).val())}),i.length>0&&(this.$submit.attr("disabled",!0),this.mediaChooser.setMedia(i)),$tt._instances.push(this)};return t.TAG="ThreadNewView",t.Binder={SUBMIT:".thread-submit"},t.FORM_NAME="thread",t.prototype._getFormField=function(e){return this.$form.find("#"+t.FORM_NAME+"_"+e)},t.prototype._onClickSubmit=function(e){this.$form[0].checkValidity()&&$(e.target).button("loading")},t.prototype._updateForm=function(){var e=this._getFormField("mediaIncluded");e.html(this.mediaChooser.generateFormData(e.data("prototype")))},t.prototype._onSuccess=function(e){this._updateForm(),this.$submit.attr("disabled",!1),this.mediaChooser.media.length>0&&this._getFormField("title").attr("required",!1).parent().find("label").removeClass("required")},t.prototype._onReset=function(e){this._updateForm(),this.mediaChooser.media.length==0&&this._getFormField("title").attr("required",!0).parent().find("label").addClass("required")},t}),define("views/thread/editView",["views/thread/newView"],function(e){var t=function(n,r){e.prototype.constructor.apply(this,arguments),this.bind__onClickDelete=this._onClickDelete.bind(this),this.$deleteModal=this.$container.find(t.Binder.DELETE_MODAL),this.$delete=this.$container.find(t.Binder.DELETE),this.$delete.on("click",this.bind__onClickDelete)};return t.extend(e),t.TAG="ThreadEditView",t.Binder.DELETE_MODAL=".thread-delete-modal",t.Binder.DELETE=".thread-delete",t.prototype._onClickDelete=function(e){e.preventDefault(),this.$delete.button("loading"),this.controller.delete().done(function(e){this.$deleteModal.find(".modal-body").html("Topic deleted successfully.")}.bind(this)).fail(function(){this.$container.find(".modal-body").prepend("Something went wrong. Try again."),this.$delete.button("reset")}.bind(this))},t}),define("views/thread/viewView",[],function(){var e=function(e,t){this.controller=e,this.bind__onClickVideoSpeed=this._onClickVideoSpeed.bind(this),this.bind__onClickClosedCaptions=this._onClickClosedCaptions.bind(this),this.$container=t.container,$("#videoSpeed").on("click",this.bind__onClickVideoSpeed),$("#closedCaptions").on("click",this.bind__onClickClosedCaptions),$tt._instances.push(this)};return e.TAG="ThreadViewView",e.Binder={},e.prototype._onClickVideoSpeed=function(e){e.preventDefault();var t=this.controller.adjustVideoSpeed();$("#videoSpeed img").attr("src",t)},e.prototype._onClickClosedCaptions=function(e){e.preventDefault();var t=this.controller.toggleClosedCaptions();$("#closed-caption-button img").attr("src",t)},e}),define("views/post",["model/model","core/mediaChooser","service/keyPointService"],function(e,t,n){var r=function(n,i){this.controller=n,this.bind__onClickHoverTimelineKeyPoint=this._onClickHoverTimelineKeyPoint.bind(this),this.bind__onClickNew=this._onClickNew.bind(this),this.bind__onClickEdit=this._onClickEdit.bind(this),this.bind__onClickDelete=this._onClickDelete.bind(this),this.bind__onClickSubmitNew=this._onClickSubmitNew.bind(this),this.bind__onClickSubmitEdit=this._onClickSubmitEdit.bind(this),this.bind__onClickReset=this._onClickReset.bind(this),this.bind__onClickCancelNew=this._onClickCancelNew.bind(this),this.bind__onClickCancelEdit=this._onClickCancelEdit.bind(this),this.bind__onSuccess=this._onSuccess.bind(this),this.bind__onSuccessAndPost=this._onSuccessAndPost.bind(this),this.bind__onReset=this._onReset.bind(this),this.bind__onModelChange=this._onModelChange.bind(this),this.$container=$(r.Binder.CONTAINER+"[data-pid='"+this.controller.model.get("id")+"']"),this.$form=this.$container.find("form[name^="+r.FORM_NAME+"]"),this.$timelineKeyPoint=this.$container.find(r.Binder.TIMELINE_KEYPOINT),this.$new=this.$container.find(r.Binder.NEW),this.$edit=this.$container.find(r.Binder.EDIT),this.$deleteModal=this.$container.find(r.Binder.DELETE_MODAL),this.$delete=this.$container.find(r.Binder.DELETE),this.$submitNew=this.$container.find(r.Binder.SUBMIT_NEW),this.$submitEdit=this.$container.find(r.Binder.SUBMIT_EDIT),this.$reset=this.$container.find(r.Binder.RESET),this.$cancelNew=this.$container.find(r.Binder.CANCEL_NEW),this.$cancelEdit=this.$container.find(r.Binder.CANCEL_EDIT),this.$timelineKeyPoint.on("click",this.bind__onClickHoverTimelineKeyPoint),this.$timelineKeyPoint.on("dblclick",this.bind__onClickHoverTimelineKeyPoint),this.$timelineKeyPoint.hover(this.bind__onClickHoverTimelineKeyPoint,this.bind__onClickHoverTimelineKeyPoint),this.$new.on("click",this.bind__onClickNew),this.$edit.on("click",this.bind__onClickEdit),this.$delete.on("click",this.bind__onClickDelete),this.$submitNew.on("click",this.bind__onClickSubmitNew),this.$submitEdit.on("click",this.bind__onClickSubmitEdit),this.$reset.on("click",this.bind__onClickReset),this.$cancelNew.on("click",this.bind__onClickCancelNew),this.$cancelEdit.on("click",this.bind__onClickCancelEdit),this.mediaChooser=new t({enableDoneAndPost:!0}),$(this.mediaChooser).on(t.Event.SUCCESS,this.bind__onSuccess),$(this.mediaChooser).on(t.Event.SUCCESS_AND_POST,this.bind__onSuccessAndPost),$(this.mediaChooser).on(t.Event.RESET,this.bind__onReset),this.mediaChooser.setContainer(this.$form),this.mediaChooser.bindUIEvents();var s=[];this._getFormField("attachedFile").children().each(function(e,t){s.push($(t).val())}),s.length>0&&(this._toggleForm(!0),this.mediaChooser.setMedia(s)),this.controller.model.subscribe(e.Event.CHANGE,this.bind__onModelChange)};return r.TAG="PostView",r.Binder={CONTAINER:".post-container",TIMELINE_KEYPOINT:".post-timeline-keypoint",NEW:".post-new",EDIT:".post-edit",DELETE_MODAL:".post-delete-modal",DELETE:".post-delete",SUBMIT_NEW:".post-submit-new",SUBMIT_EDIT:".post-submit-edit",RESET:".post-reset",CANCEL_NEW:".post-cancel-new",CANCEL_EDIT:".post-cancel-edit"},r.FORM_NAME="post",r.prototype._getFormField=function(e){return this.$form.find("#"+r.FORM_NAME+"_"+e)},r.prototype._onClickHoverTimelineKeyPoint=function(e){e&&e.type=="click"&&e.preventDefault(),this.controller.interactKeyPoint(e.type)},r.prototype._onClickNew=function(e){e.preventDefault(),this.$new.hide(),this.controller.new(null).done(function(e){this.$container.after(e.html)}.bind(this)).fail(function(){this.$new.show()}.bind(this))},r.prototype._onClickEdit=function(e){e.preventDefault(),this.controller.edit(null).done(function(e){this.$container.replaceWith(e.html);var t=this;t=new r(this.controller.model,this.controller.options)}.bind(this))},r.prototype._onClickDelete=function(e){e.preventDefault(),this.view.$delete.button("loading"),this.controller.delete().done(function(e){this.$deleteModal.find(".modal-body").html("Post deleted successfully."),this.$deleteModal.data("bs.modal").isShown?(this.$deleteModal.on("hidden.bs.modal",function(e){this.$container.remove()}),this.$deleteModal.modal("hide"),this.$container.fadeOut("slow")):this.$container.fadeOut("slow",function(e){this.$container.remove()})}.bind(this)).fail(function(){this.$container.find(".modal-body").prepend("Something went wrong. Try again."),this.$delete.button("reset")}.bind(this))},r.prototype._toggleForm=function(e){this.$submitNew.button(e?"loading":"reset"),this.$submitEdit.button(e?"loading":"reset"),this.$reset.attr("disabled",e),this.$cancelNew.attr("disabled",e),this.$cancelEdit.attr("disabled",e)},r.prototype._preSubmit=function(){return this._getFormField("content").val()==""&&this.mediaChooser.media.length==0?(alert("Your post cannot be blank. You must either select a file or write a comment."),!1):(this._toggleForm(!0),!0)},r.prototype._onClickSubmitNew=function(e){e.preventDefault();if(!this._preSubmit())return;this.controller.new(this.$form[0]).done(function(e){if(!e.wasReplied){this.$container.replaceWith(e.html);var t=this;t=new r(this.controller.model,this.controller.options)}}.bind(this)).fail(function(){this._toggleForm(!1)}.bind(this))},r.prototype._onClickSubmitEdit=function(e){e.preventDefault();if(!this._preSubmit())return;this.controller.edit(this.$form[0]).done(function(e){this.$container.replaceWith(e.html);var t=this;t=new r(this.controller.model,this.controller.options)}.bind(this)).fail(function(){this._toggleForm(!1)}.bind(this))},r.prototype._onClickReset=function(e){e.preventDefault(),this.mediaChooser.reset(),this._getFormField("startTime").val(this.controller.model.get("keyPoint.startTime")),this._getFormField("endTime").val(this.controller.model.get("keyPoint.endTime")),this._getFormField("content").val(""),this.controller.editKeyPoint()},r.prototype._onClickCancelNew=function(e){e.preventDefault(),this.$container.remove(),this.controller.removeKeyPoint(),$(r.Binder.CONTAINER+"[data-pid='"+this.controller.model.get("parentPostId")+"']").find(r.Binder.NEW).show()},r.prototype._onClickCancelEdit=function(e){e.preventDefault(),this.controller.view().done(function(e){this.$container.replaceWith(e.html);var t=this;t=new r(this.controller.model,this.controller.options)}.bind(this))},r.prototype._updateForm=function(){var e=this._getFormField("attachedFile");e.html(this.mediaChooser.generateFormData(e.data("prototype")))},r.prototype._onSuccess=function(e){this._updateForm(),this._toggleForm(!1)},r.prototype._onSuccessAndPost=function(e){this._updateForm(),this.$submit.trigger("click")},r.prototype._onReset=function(e){this._updateForm()},r.prototype._onModelChange=function(e){this._renderTimelineKeyPoint(e.model.get("keyPoint.startTime",""),e.model.get("keyPoint.endTime",""),e.model.get("keyPoint.videoDuration","")),this._onSelectionTimes(e.model.get("keyPoint.selection.startTime",""),e.model.get("keyPoint.selection.endTime","")),this._onHoverKeyPoint(e.model.get("keyPoint.isHovering",!1)),this._onClickKeyPoint(e.model.get("keyPoint.isPlaying",!1))},r.prototype._renderTimelineKeyPoint=function(e,t,n){console.log("%s: %s",r.TAG,"_renderTimelineKeyPoint");var i=(100*e/n).toFixed(2),s=(100*t/n).toFixed(2),o=(s-i).toFixed(2);this.$timelineKeyPoint.css({left:i+"%",width:o+"%"})},r.prototype._onSelectionTimes=function(e,t){this._getFormField("startTime").val(e),this._getFormField("endTime").val(t)},r.prototype._onHoverKeyPoint=function(e){e?this.$container.addClass("tt-post-container-highlight"):this.$container.removeClass("tt-post-container-highlight")},r.prototype._onClickKeyPoint=function(e){var t=this.$container.find("video")[0];t&&e&&(t.currentTime=0,t.play())},r}),define("main",["controller/myFiles","controller/forum","controller/group","controller/message","controller/profile","core/helper","core/mediaManager","core/myFilesSelector","core/recorder","core/mediaChooser","core/gallery","bootstrap","service","factory/groupFactory","factory/postFactory","factory/threadFactory","service/keyPointService","model/postModel","controller/groupController","controller/postController","controller/threadController","views/group/newView","views/group/editView","views/group/manageView","views/thread/newView","views/thread/editView","views/thread/viewView","views/post"],function(){var e={};e.Controller={},e.Controller.MyFiles=require("controller/myFiles"),e.Controller.Forum=require("controller/forum"),e.Controller.Group=require("controller/group"),e.Controller.Message=require("controller/message"),e.Controller.Profile=require("controller/profile"),e.Core={},e.Core.Helper=require("core/helper"),e.Core.MediaManager=require("core/mediaManager"),e.Core.MyFilesSelector=require("core/myFilesSelector"),e.Core.Recorder=require("core/recorder"),e.Core.MediaChooser=require("core/mediaChooser"),e.Core.Gallery=require("core/gallery"),e._services=[],e._instances=[],window.TerpTube=e,window.$tt=window.TerpTube,$tt.Core.Helper.autoSize(),dust.helpers.generateUrl=function(e,t,n,r){return e.write($tt.Core.Helper.generateUrl(r.path))}}),require(["main"]);