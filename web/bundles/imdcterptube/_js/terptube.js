Function.prototype.extend=function(e){for(var t in e.prototype)this.prototype[t]=e.prototype[t];return this.prototype.constructor=this,this.prototype.parent=e.prototype,this},define("extra",function(){}),define("core/mediaManager",[],function(){var e=function(){};return e.EVENT_DELETE_SUCCESS="delete_media_success",e.EVENT_DELETE_ERROR="delete_media_error",e.EVENT_UPDATE_SUCCESS="update_media_success",e.EVENT_UPDATE_ERROR="update_media_error",e.prototype.deleteMedia=function(t,n,r){var i=this;if(typeof n!="undefined"&&n!==!1){var s=confirm(n);if(!s)return!1}typeof r=="undefined"&&(r=!1);var o=Routing.generate("imdc_myfiles_delete",{mediaId:t,confirm:r}),u={mediaId:t,confirm:r};$.ajax({url:o,type:"POST",contentType:"application/x-www-form-urlencoded",data:u,success:function(n){if(n.responseCode==200)$(i).trigger(e.EVENT_DELETE_SUCCESS);else if(n.responseCode==400){var r="";n.mediaInUse.forEach(function(e,t,n){t>0&&(r+=", "),r+=Translator.trans("filesGateway.deleteMediaInUseConfirmation."+e)}),r=Translator.trans("filesGateway.deleteMediaInUseConfirmation.finalMessage",{mediaUsedLocations:r}),console.log(n),confirm(r)&&i.deleteMedia(t,!1,!0),console.log("Error: "+n.feedback)}else $(i).trigger(e.EVENT_DELETE_ERROR,"Unknown Error"),console.log("An unexpected error occured")},error:function(t){$(i).trigger(e.EVENT_DELETE_ERROR,t),console.log(t)}})},e.prototype.trimMedia=function(e,t,n){var r=this,i=Routing.generate("imdc_myfiles_trim",{mediaId:e,startTime:t,endTime:n}),s={mediaId:e,startTime:t,endTime:n};$.ajax({url:i,type:"POST",contentType:"application/x-www-form-urlencoded",data:s,success:function(e){console.log(e),e.responseCode==200?r.media=e.media:e.responseCode==400?console.log("Error: "+e.feedback):console.log("An unexpected error occured")},error:function(e){console.log(e)}})},e.prototype.updateMedia=function(t){var n=this;typeof t=="undefined"&&($(n).trigger(e.EVENT_UPDATE_ERROR,"Must send a media object"),console.log("Error: Must send a media object"));var r=Routing.generate("imdc_myfiles_update",{mediaId:t.id});console.log(t);var i={mediaId:t.id,media:JSON.stringify(t)};console.log(i),$.ajax({url:r,type:"POST",contentType:"application/x-www-form-urlencoded",data:i,success:function(t){t.responseCode==200?$(n).trigger(e.EVENT_UPDATE_SUCCESS):t.responseCode==400?($(n).trigger(e.EVENT_UPDATE_ERROR,t.feedback),console.log("Error: "+t.feedback)):($(n).trigger(e.EVENT_UPDATE_ERROR,"Unknown Error"),console.log("An unexpected error occured"))},error:function(t){$(n).trigger(e.EVENT_UPDATE_ERROR,t),console.log(t)}})},e}),define("core/helper",[],function(){var e=function(){};return e.TAG="Helper",e.isFullscreen=function(){return document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement?!0:!1},e.toggleFullScreen=function(t){console.log("%s: %s",e.TAG,"toggleFullScreen");var n=t[0];e.isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen():n.requestFullscreen?n.requestFullscreen():n.mozRequestFullScreen?n.mozRequestFullScreen():n.webkitRequestFullscreen?n.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT):n.msRequestFullscreen&&n.msRequestFullscreen()},e.updateProgressBar=function(e,t){var n=e.find(".progress-bar");n.attr("aria-valuenow",t),n.css("width",t+"%"),n.html(t+"%")},e}),define("core/recorder",["core/helper","core/mediaManager"],function(e,t){var n=function(e){var n={enableDoneAndPost:!1};if(typeof e=="undefined")e=n;else for(var r in e)this[r]=typeof e[r]!="undefined"?e[r]:n[r];this.container=e.container,this.page=e.page,this.inPreviewMode=!1,this.player=null,this.recorder=null,this.sourceMedia=null,this.recordedMedia=null,this.mediaManager=new t,this.forwardButton="<button class='forwardButton'></button>",this.doneButton="<button class='doneButton'></button>",this.doneAndPostButton="<button class='doneAndPostButton'></button>",this.backButton="<button class='backButton'></button>",this.bind__onRender=this._onRender.bind(this),this.bind__onShownModal=this._onShownModal.bind(this),this.bind__onHiddenModal=this._onHiddenModal.bind(this),this.bind__onShowTab=this._onShowTab.bind(this),this.bind__onShownTab=this._onShownTab.bind(this),this.bind__onBlurPlayerTitle=this._onBlurPlayerTitle.bind(this),this.bind__onClickInterpSelect=this._onClickInterpSelect.bind(this),this.bind__onPageAnimate=this._onPageAnimate.bind(this),this.bind__onRecordingStarted=this._onRecordingStarted.bind(this),this.bind__onRecordingStopped=this._onRecordingStopped.bind(this),this.bind__onRecordingUploadProgress=this._onRecordingUploadProgress.bind(this),this.bind__onRecordingUploaded=this._onRecordingUploaded.bind(this),this.bind__onRecordingSuccess=this._onRecordingSuccess.bind(this),this.bind__onRecordingError=this._onRecordingError.bind(this),this.bind__preview=this._preview.bind(this),this.bind__cut=this._cut.bind(this),this.bind__back=this._back.bind(this),this.bind__done=this._done.bind(this),this.bind__doneAndPost=this._doneAndPost.bind(this),dust.compileFn($("#recorder").html(),"recorder")};return n.TAG="Recorder",n.MAX_RECORDING_TIME=720,n.Page={NORMAL:"normal",INTERPRETATION:"interpretation"},n.Event={READY:"eventReady",DONE:"eventDone"},n.Binder={MODAL_DIALOG:".recorder-modal",NORMAL:".recorder-normal",INTERP:".recorder-interp",CONTAINER_RECORD:".recorder-container-record",NORMAL_TITLE:".recorder-normal-title",NORMAL_VIDEO:".recorder-normal-video",INTERP_SELECT:".recorder-interp-select",INTERP_VIDEO_P:".recorder-interp-video-p",INTERP_TITLE:".recorder-interp-title",INTERP_VIDEO_R:".recorder-interp-video-r",CONTROLS:".recorder-controls",CONTAINER_UPLOAD:".recorder-container-upload"},n.prototype.getContainer=function(){return this.container},n.prototype._getElement=function(e){return this.getContainer().find(e)},n.prototype._createPlayer=function(){console.log("%s: %s",n.TAG,"_createPlayer");var e=[],t=[];if(this.page==n.Page.NORMAL||this.inPreviewMode)e.push(this.doneButton),t.push(this.inPreviewMode?this.bind__done:this.bind__cut);this.enableDoneAndPost&&this.inPreviewMode&&(e.push(this.doneAndPostButton),t.push(this.bind__doneAndPost));var r,i;this.inPreviewMode&&(r=[this.backButton],i=[this.bind__back]);var s=this._getElement(this.page==n.Page.NORMAL?n.Binder.NORMAL_VIDEO:this.inPreviewMode?n.Binder.INTERP_VIDEO_R:n.Binder.INTERP_VIDEO_P),o=new Player(s,{areaSelectionEnabled:this.inPreviewMode,audioBar:!1,updateTimeType:Player.DENSITY_BAR_UPDATE_TYPE_RELATIVE,controlBarElement:this._getElement(n.Binder.CONTROLS),forwardButtons:e,forwardFunctions:t,backButtons:r,backFunctions:i,selectedRegionColor:"#0000ff"});o.createControls(),$(o.elementID).find(".videoControlsContainer.controlsBar.doneButton").eq(0).attr("title",Translator.trans("player.previewing.doneButton")),$(o.elementID).find(".videoControlsContainer.controlsBar.doneAndPostButton").eq(0).attr("title",Translator.trans("player.previewing.doneAndPostButton")),$(o.elementID).find(".videoControlsContainer.controlsBar.backButton").eq(0).attr("title",Translator.trans("player.previewing.backToRecordingButton")),this.inPreviewMode?this.recorder=o:this.player=o},n.prototype._cut=function(e){console.log("%s: %s",n.TAG,"_cut"),e.preventDefault();var t=this.player.getCurrentMinMaxTime(),r=this.player.getAreaSelectionTimes();this.player.setCurrentMinMaxTime(r.minTime,r.maxTime),console.log("Current Min/Max Times %s %s",r.minTime,r.maxTime),console.log("Cutting to Min/Max Times %s %s",r.minTime-t.minTime,r.maxTime-t.minTime),this.mediaManager.trimMedia(this.activeMedia.id,r.minTime-t.minTime,r.maxTime-t.minTime)},n.prototype._back=function(e){console.log("%s: %s",n.TAG,"_back"),e.preventDefault(),this._destroyPlayers(),this.mediaManager.deleteMedia(this.recordedMedia.id),this.setRecordedMedia(null),this.inPreviewMode=!1,this.page==n.Page.INTERPRETATION&&this._createPlayer(),this._createRecorder()},n.prototype._createRecorder=function(){console.log("%s: %s",n.TAG,"_createRecorder");var e=[this.forwardButton,this.doneButton],t=[this.bind__preview,this.bind__done];this.enableDoneAndPost&&(e.push(this.doneAndPostButton),t.push(this.bind__doneAndPost));var r;this.page==n.Page.NORMAL?r=this._getElement(n.Binder.NORMAL_VIDEO):r=this._getElement(n.Binder.INTERP_VIDEO_R),this.recorder=new Player(r,{areaSelectionEnabled:!1,audioBar:!1,updateTimeType:Player.DENSITY_BAR_UPDATE_TYPE_ABSOLUTE,controlBarElement:this._getElement(n.Binder.CONTROLS),type:Player.DENSITY_BAR_TYPE_RECORDER,volumeControl:!1,maxRecordingTime:n.MAX_RECORDING_TIME,recordingSuccessFunction:this.bind__onRecordingSuccess,recordingErrorFunction:this.bind__onRecordingError,recordingPostURL:Routing.generate("imdc_myfiles_add_recording"),forwardButtons:e,forwardFunctions:t}),this.page==n.Page.INTERPRETATION&&($(this.recorder).on(Player.EVENT_RECORDING_STARTED,this.bind__onRecordingStarted),$(this.recorder).on(Player.EVENT_RECORDING_STOPPED,this.bind__onRecordingStopped)),$(this.recorder).on(Player.EVENT_RECORDING_UPLOAD_PROGRESS,this.bind__onRecordingUploadProgress),$(this.recorder).on(Player.EVENT_RECORDING_UPLOADED,this.bind__onRecordingUploaded),this.recorder.createControls(),$(this.recorder.elementID).find(".videoControlsContainer.controlsBar.videoControls.recordButton").eq(0).attr("title",Translator.trans("player.recording.recordingButton")),$(this.recorder.elementID).find(".videoControlsContainer.controlsBar.forwardButton").eq(0).attr("title",Translator.trans("player.recording.forwardButton")),$(this.recorder.elementID).find(".videoControlsContainer.controlsBar.doneButton").eq(0).attr("title",Translator.trans("player.recording.doneButton")),$(this.recorder.elementID).find(".videoControlsContainer.controlsBar.doneAndPostButton").eq(0).attr("title",Translator.trans("player.recording.doneAndPostButton"))},n.prototype._onRecordingStarted=function(){console.log("%s: %s",n.TAG,"_onRecordingStarted"),this.player.setControlsEnabled(!1),this.player.play()},n.prototype._onRecordingStopped=function(){this.player.pause(),this.player.setControlsEnabled(!0)},n.prototype._onRecordingUploadProgress=function(t,r){e.updateProgressBar(this._getElement(n.Binder.CONTAINER_UPLOAD).show(),r)},n.prototype._onRecordingUploaded=function(t){e.updateProgressBar(this._getElement(n.Binder.CONTAINER_UPLOAD).hide(),0)},n.prototype._onRecordingSuccess=function(e){console.log("%s: %s- mediaId=%d",n.TAG,"_onRecordingSuccess",e.media.id),this.setRecordedMedia(e.media)},n.prototype._onRecordingError=function(e){console.log("%s: %s- e=%s",n.TAG,"_onRecordingError",e)},n.prototype._preview=function(e){console.log("%s: %s",n.TAG,"_preview"),e.preventDefault(),this._destroyPlayers(),this.page==n.Page.INTERPRETATION&&this._createPlayer(),this.inPreviewMode=!0,this._createPlayer()},n.prototype._done=function(e){console.log("%s: %s",n.TAG,"_done"),e.preventDefault(),$(this).trigger($.Event(n.Event.DONE,{media:this.recordedMedia,doPost:!1}))},n.prototype._doneAndPost=function(e){console.log("%s: %s",n.TAG,"_doneAndPost"),e.preventDefault(),$(this).trigger($.Event(n.Event.DONE,{media:this.recordedMedia,doPost:!0}))},n.prototype._destroyPlayers=function(){console.log("%s: %s",n.TAG,"_destroyPlayers");var e=function(e){var t=this._getElement(e),n=t.parent();t.removeAttr("src"),n.hide(),n.after(t.detach()),n.remove()}.bind(this);this.player!=null&&(this.player.destroyRecorder(),this.page==n.Page.NORMAL?e(n.Binder.NORMAL_VIDEO):this.sourceMedia!=null&&e(n.Binder.INTERP_VIDEO_P),this.player=null),this.recorder!=null&&(this.recorder.destroyRecorder(),this.page==n.Page.NORMAL?e(n.Binder.NORMAL_VIDEO):this.sourceMedia!=null&&e(n.Binder.INTERP_VIDEO_R),this.recorder=null),this._getElement(n.Binder.CONTROLS).html("")},n.prototype._onPageAnimate=function(){try{if(this.page==n.Page.INTERPRETATION){if(this.sourceMedia==null)return;this._createPlayer()}this._createRecorder()}catch(e){console.error("%s: %s- err=%o",n.TAG,"_loadPage",e)}},n.prototype._loadPage=function(){this.page==n.Page.INTERPRETATION&&(this.sourceMedia!=null?(this._getElement(n.Binder.INTERP_SELECT).parent().hide(),this._getElement(n.Binder.INTERP_VIDEO_P).show(),this._getElement(n.Binder.INTERP_VIDEO_R).show()):(this._getElement(n.Binder.INTERP_SELECT).parent().show(),this._getElement(n.Binder.INTERP_VIDEO_P).hide(),this._getElement(n.Binder.INTERP_VIDEO_R).hide())),this._getElement(n.Binder.MODAL_DIALOG).find(".modal-dialog").animate({width:this.page==n.Page.NORMAL?"900px":this.sourceMedia!=null?"90%":"900px"},{complete:this.bind__onPageAnimate})},n.prototype._onShownModal=function(e){this._destroyPlayers(),this._loadPage()},n.prototype._onHiddenModal=function(e){this._destroyPlayers()},n.prototype._onShowTab=function(e){this._destroyPlayers(),this.page=$(e.target).attr("href")==n.Binder.NORMAL?n.Page.NORMAL:n.Page.INTERPRETATION,this._loadPage()},n.prototype._onShownTab=function(e){this._getElement(n.Binder.INTERP_VIDEO_P)[0].load()},n.prototype._onBlurPlayerTitle=function(e){console.log("updated title"),this.recordedMedia.title=$(e.target).val(),this.mediaManager.updateMedia(this.recordedMedia)},n.prototype._onClickInterpSelect=function(e){e.preventDefault(),alert("Not implemented.")},n.prototype._bindUIEvents=function(){var e=this._getElement(n.Binder.MODAL_DIALOG);e.modal({backdrop:"static",show:!1}),e.on("show.bs.modal",function(e){var t=1040+10*$(".modal:visible").length;$(this).css("z-index",t),setTimeout(function(){$(".modal-backdrop").not(".modal-stack").css("z-index",t-1).addClass("modal-stack")},0)}),e.on("shown.bs.modal",this.bind__onShownModal),e.on("hidden.bs.modal",this.bind__onHiddenModal);var t=e.find("a[data-toggle='tab']");t.on("show.bs.tab",this.bind__onShowTab),t.on("shown.bs.tab",this.bind__onShownTab),this._getElement(n.Binder.NORMAL_TITLE).blur(this.bind__onBlurPlayerTitle),this._getElement(n.Binder.INTERP_TITLE).blur(this.bind__onBlurPlayerTitle),this._getElement(n.Binder.INTERP_SELECT).on("click",this.bind__onClickInterpSelect)},n.prototype._onRender=function(e,t){this.container.html(t);var r=this.page==n.Page.NORMAL?n.Binder.NORMAL:n.Binder.INTERP,i=this._getElement(n.Binder.MODAL_DIALOG);i.find("a[href!='"+r+"']").parent().removeClass("active"),i.find("a[href='"+r+"']").parent().addClass("active"),i.find(".tab-pane:not('"+r+"')").removeClass("active"),i.find(".tab-pane"+r).addClass("active"),this._bindUIEvents(),$(this).trigger($.Event(n.Event.READY,{}))},n.prototype.render=function(){dust.render("recorder",{},this.bind__onRender)},n.prototype.show=function(){this._getElement(n.Binder.MODAL_DIALOG).modal("show")},n.prototype.hide=function(){this._getElement(n.Binder.MODAL_DIALOG).modal("hide")},n.prototype._injectMedia=function(e,t){var n=this._getElement(e),r=n.find("source"),i=r.data("baseurl");n.removeAttr("src"),r.attr("src",t!=null?i+t.resource.pathMPEG:"")},n.prototype.setSourceMedia=function(e){this.sourceMedia=e,this._injectMedia(n.Binder.INTERP_VIDEO_P,this.sourceMedia)},n.prototype._togglePlayerTitle=function(){var e=this._getElement(n.Binder.NORMAL_TITLE),t=this._getElement(n.Binder.INTERP_TITLE),r=this.recordedMedia!=null?this.recordedMedia.title:"";this.page==n.Page.NORMAL?(t.hide().val(""),e.toggle().val(r)):(e.hide().val(""),t.toggle().val(r))},n.prototype.setRecordedMedia=function(e){this.recordedMedia=e,this._injectMedia(this.page==n.Page.NORMAL?n.Binder.NORMAL_VIDEO:n.Binder.INTERP_VIDEO_R,this.recordedMedia),this._togglePlayerTitle()},n}),define("core/mediaChooser",["core/mediaManager","core/recorder","core/helper"],function(e,t,n){var r=function(t){var n={isFileSelection:!0,enableDoneAndPost:!1};if(typeof t=="undefined")t=n;else for(var r in t)this[r]=typeof t[r]!="undefined"?t[r]:n[r];this.isFileSelection=t.isFileSelection,this.enableDoneAndPost=t.enableDoneAndPost,this.doneButton="<button class='doneButton'></button>",this.doneAndPostButton="<button class='doneAndPostButton'></button>",this.backButton="<button class='backButton'></button>",this.container=null,this.activeMedia=null,this.media=[],this.modalDialog=null,this.recorder=null,this.player=null,this.mediaManager=new e,this.bind__onLoadPageSuccess=this._onLoadPageSuccess.bind(this),this.bind__loadSelectFromMyFilesFunction=this._loadSelectFromMyFilesFunction.bind(this),this.bind__terminatingFunction=this._terminatingFunction.bind(this),this.bind__onClickRemoveSelectedMedia=this._onClickRemoveSelectedMedia.bind(this),this.bind__forwardFunction=this._forwardFunction.bind(this),this.bind__doneAndPostFunction=this._doneAndPostFunction.bind(this)};return r.TAG="MediaChooser",r.Page={RECORD_VIDEO:"recordVideo",SELECT:"select",PREVIEW:"preview"},r.Event={PAGE_LOADED:"eventPageLoaded",SUCCESS:"eventSuccess",SUCCESS_AND_POST:"eventSuccessAndPost",ERROR:"eventError",RESET:"eventReset",DIALOG_CLOSE:"eventDialogClose"},r.Binder={CONTAINER_CHOOSE:".mediachooser-container-choose",RECORD_VIDEO:".mediachooser-record-video",UPLOAD_FILE:".mediachooser-upload-file",SELECT:".mediachooser-select",RECORDER:".mediachooser-recorder",MODAL_DIALOG:".mediachooser-modal",CONTAINER_UPLOAD:".mediachooser-container-upload",UPLOAD_TITLE:".mediachooser-upload-title",CONTAINER_SELECTED:".mediachooser-container-selected",WORKING:".mediachooser-working",SELECTED:".mediachooser-selected",SELECTED_MEDIA:".mediachooser-selected-media",REMOVE:".mediachooser-remove",CONTAINER_SELECT:".mediachooser-container-select"},r.FORM_NAME="Media",r.MEDIA_TYPE={AUDIO:{id:2,str:"audio"},VIDEO:{id:1,str:"video"},IMAGE:{id:0,str:"image"},OTHER:{id:9,str:"other"}},r.DIALOG_TITLE_SELECT="Select from My Files",r.DIALOG_TITLE_PREVIEW="Preview",r.prototype.getContainer=function(){return this.container},r.prototype._getElement=function(e){return this.getContainer().find(e)},r.prototype.getForm=function(){return typeof this.uploadForm=="undefined"&&(this.uploadForm=$(this._getElement(r.Binder.CONTAINER_UPLOAD).data("form"))),this.uploadForm},r.prototype.getFormField=function(e){return this.getForm().find("#"+r.FORM_NAME+"_"+e)},r.prototype.bindUIEvents=function(){console.log("%s: %s",r.TAG,"bindUIEvents"),this.modalDialog=this._getElement(r.Binder.MODAL_DIALOG).modal({show:!1}),this.modalDialog.on("hidden.bs.modal",this.bind__terminatingFunction),this._getElement(r.Binder.RECORD_VIDEO).on("click",function(e){e.preventDefault(),this.page=r.Page.RECORD_VIDEO,this.recorder=new t({container:this._getElement(r.Binder.RECORDER),page:t.Page.NORMAL,enableDoneAndPost:this.enableDoneAndPost}),$(this.recorder).on(t.Event.READY,function(e){this.recorder.show()}.bind(this)),$(this.recorder).on(t.Event.DONE,function(e){this.recorder.hide(),this.activeMedia=e.media,this._invokeSuccess(e.doPost),this._terminatingFunction()}.bind(this)),this.recorder.render()}.bind(this)),this._getElement(r.Binder.UPLOAD_FILE).on("click",function(e){e.preventDefault(),this.getFormField("resource_file").click()}.bind(this)),this.getFormField("resource_file").on("change",function(e){e.preventDefault();var t=this.getFormField("resource_file").data("maxsize"),n=this.getFormField("resource_file")[0].files[0].size;if(n>t){alert(Translator.trans("form.upload.maxFileSizeExceeded",{fileSize:(n/1048576).toFixed(1)+"MB",maxUploadSize:(t/1048576).toFixed(1)+"MB"})),this.getFormField("resource_file").val("");return}this._loadPage({showPopup:!1,url:Routing.generate("imdc_myfiles_add"),method:"POST",data:new FormData(this.getForm()[0]),uploadProgress:!0}),this.getFormField("resource_file").val("")}.bind(this)),this._getElement(r.Binder.SELECT).on("click",function(e){e.preventDefault(),this.bind__loadSelectFromMyFilesFunction()}.bind(this)),this._getElement(r.Binder.SELECTED).sortable({update:function(e,t){$(this).trigger($.Event(r.Event.SUCCESS,{}))}.bind(this)})},r.prototype._bindUIEventsSelectFromMyFiles=function(){console.log("%s: %s",r.TAG,"_bindUIEventsSelectFromMyFiles");var t=$(r.Binder.CONTAINER_SELECT),n=this;t.find(".preview-button").on("click",function(e){e.preventDefault();if($(e.currentTarget).hasClass("disabled"))return!1;this.previewMedia($(e.currentTarget).data("val"))}.bind(this)),t.find("span.edit-title").editable({toggle:"manual",unsavedclass:null,success:function(e,t){n.mediaManager.updateMedia({id:$(this).data("val"),title:t})}}),t.find("a.edit-title").on("click",function(e){e.stopPropagation(),$(this).prev().editable("toggle")}),t.find(".delete-button").on("click",function(t){t.preventDefault();var n=$(t.target);return $(this.mediaManager).one(e.EVENT_DELETE_SUCCESS,function(){n.parent().parent().parent().remove()}),$(this.mediaManager).one(e.EVENT_DELETE_ERROR,function(e,t){t.status==500?alert(t.statusText):alert("Error: "+e)}),this.mediaManager.deleteMedia(n.data("val"),Translator.trans("filesGateway.deleteConfirmMessage"))}.bind(this)),t.find(".select-button").on("click",function(e){e.preventDefault();var t=$.grep(this.media,function(t,n){return t.id==$(e.target).data("val")}).length>0;t||(this.activeMedia={id:$(e.target).data("val"),title:$(e.target).data("title"),resource:{pathMPEG:$(e.target).data("resourcewebpath")}},this._invokeSuccess()),this._terminatingFunction()}.bind(this)),t.find("ul.pagination li a").on("click",function(e){e.preventDefault(),this._loadPage({showPopup:!0,url:$(e.target).attr("href"),method:"GET"})}.bind(this))},r.prototype._bindUIEventsPreview=function(){console.log("%s: %s",r.TAG,"_bindUIEventsPreview"),$("#mediaPreviewTitle").blur(function(e){console.log("updated title"),this.activeMedia.title=$("#mediaPreviewTitle").val(),this.mediaManager.updateMedia(this.activeMedia)}.bind(this))},r.prototype.previewMedia=function(e){console.log("%s: %s",r.TAG,"previewMedia"),this.page=r.Page.PREVIEW,this._loadPage({showPopup:!0,url:Routing.generate("imdc_myfiles_preview",{mediaId:e}),method:"GET"})},r.prototype._getPopupDialogTitle=function(){console.log("%s: %s",r.TAG,"_getPopupDialogTitle");switch(this.page){case r.Page.SELECT:return r.DIALOG_TITLE_SELECT;case r.Page.PREVIEW:return r.DIALOG_TITLE_PREVIEW}},r.prototype._loadPage=function(e){console.log("%s: %s",r.TAG,"_loadPage"),this.modalDialog.modal(e.showPopup?"show":"hide"),this.modalDialog.find(".modal-title").html(this._getPopupDialogTitle()),this.modalDialog.find(".modal-body").html("");var t={url:e.url,type:e.method,success:this.bind__onLoadPageSuccess,error:function(e,t,n){console.log("%s: %s: %s",r.TAG,"_loadPage","error"),this._invokeError(e)}.bind(this)};t.type!="GET"&&(t.processData=!1,t.data=e.data,t.contentType=!1,e.uploadProgress&&(t.xhr=function(){var e=$.ajaxSettings.xhr();return e.upload.addEventListener("progress",function(e){if(!e.lengthComputable)return;n.updateProgressBar(this._getElement(r.Binder.CONTAINER_UPLOAD).show(),Math.floor(e.loaded/e.total*100))}.bind(this),!1),e}.bind(this))),$.ajax(t)},r.prototype._onLoadPageSuccess=function(e,t,n){console.log("%s: %s- finished=%s",r.TAG,"_onLoadPageSuccess",e.finished),e.finished?(this.activeMedia=e.media,this._invokeSuccess(),this._terminatingFunction()):(this.modalDialog.find(".modal-body").html(e.page),this.page==r.Page.SELECT&&this._bindUIEventsSelectFromMyFiles(),this.page==r.Page.PREVIEW&&(this.activeMedia=e.media,this._bindUIEventsPreview())),$(this).trigger($.Event(r.Event.PAGE_LOADED,{payload:e}))},r.prototype.createVideoPlayer=function(){console.log("%s: %s",r.TAG,"createVideoPlayer");var e=[this.doneButton],t=[this.bind__forwardFunction];this.enableDoneAndPost&&(e.push(this.doneAndPostButton),t.push(this.bind__doneAndPostFunction));var n,i;this.isFileSelection&&(n=[this.backButton],i=[this.bind__loadSelectFromMyFilesFunction]),this.player=new Player($("#"+this.activeMedia.id),{areaSelectionEnabled:!0,audioBar:!1,updateTimeType:Player.DENSITY_BAR_UPDATE_TYPE_RELATIVE,forwardButtons:e,forwardFunctions:t,backButtons:n,backFunctions:i,selectedRegionColor:"#0000ff"}),this.player.createControls(),$(this.player.elementID).find(".videoControlsContainer.controlsBar.doneButton").eq(0).attr("title",Translator.trans("player.previewing.doneButton")),$(this.player.elementID).find(".videoControlsContainer.controlsBar.doneAndPostButton").eq(0).attr("title",Translator.trans("player.previewing.doneAndPostButton")),$(this.player.elementID).find(".videoControlsContainer.controlsBar.backButton").eq(0).attr("title",Translator.trans("player.previewing.backToRecordingButton"))},r.prototype._forwardFunction=function(e){console.log("%s: %s",r.TAG,"_forwardFunction"),e.preventDefault();var t=this.player.getCurrentMinMaxTime(),n=this.player.getAreaSelectionTimes();this.player.setCurrentMinMaxTime(n.minTime,n.maxTime),console.log("Current Min/Max Times %s %s",n.minTime,n.maxTime),console.log("Cutting to Min/Max Times %s %s",n.minTime-t.minTime,n.maxTime-t.minTime),this.mediaManager.trimMedia(this.activeMedia.id,n.minTime-t.minTime,n.maxTime-t.minTime)},r.prototype._doneAndPostFunction=function(e){console.log("%s: %s",r.TAG,"_doneAndPostFunction"),e.preventDefault(),this.destroyVideoRecorder(),this.activeMedia&&this._invokeSuccess(!0),this._terminatingFunction()},r.prototype._loadSelectFromMyFilesFunction=function(e){e&&e.preventDefault(),this.page=r.Page.SELECT,this._loadPage({showPopup:!0,url:Routing.generate("imdc_myfiles_list"),method:"GET"})},r.prototype.destroyVideoRecorder=function(){console.log("%s: %s",r.TAG,"destroyVideoRecorder"),this.player!==null&&this.player.destroyRecorder()},r.prototype._terminatingFunction=function(){console.log("%s: %s",r.TAG,"_terminatingFunction"),this.modalDialog.find(".modal-body").html(""),this.modalDialog.data("bs.modal").isShown&&(this.modalDialog.off("hidden.bs.modal"),this.modalDialog.modal("hide")),$(this).trigger($.Event(r.Event.DIALOG_CLOSE,{media:this.activeMedia}))},r.prototype._onClickRemoveSelectedMedia=function(e){e.preventDefault();var t=$(e.currentTarget).data("mid");this._removeSelectedMedia(t),this.removeMedia(t),$(this).trigger($.Event(r.Event.RESET,{}))},r.prototype._addSelectedMedia=function(e){var t=this._getElement(r.Binder.SELECTED),n=t.data("prototype");n=n.replace(/__id__/g,e.id),n=n.replace(/__title__/g,e.title),n=n.replace(/__resource_webPath__/g,e.resource.pathMPEG),t.append(n),this._getElement(r.Binder.SELECTED_MEDIA).filter("[data-mid='"+e.id+"']").find(r.Binder.REMOVE).on("click",this.bind__onClickRemoveSelectedMedia)},r.prototype._removeSelectedMedia=function(e){this._getElement(r.Binder.SELECTED_MEDIA).filter("[data-mid='"+e+"']").remove()},r.prototype._invokeSuccess=function(e){console.log("%s: %s",r.TAG,"_invokeSuccess");var t={media:this.activeMedia};this._getElement(r.Binder.UPLOAD_TITLE).html(""),this._getElement(r.Binder.CONTAINER_UPLOAD).hide(),this._getElement(r.Binder.SELECTED_MEDIA).filter("[data-mid='"+this.activeMedia.id+"']").length==0&&(this.addMedia(this.activeMedia),this.isFileSelection&&this._addSelectedMedia(this.activeMedia)),typeof e!="undefined"&&e==1?$(this).trigger($.Event(r.Event.SUCCESS_AND_POST,t)):$(this).trigger($.Event(r.Event.SUCCESS,t))},r.prototype._invokeError=function(e){console.log("%s: %s- jqXHR=%o",r.TAG,"_invokeError",e),this._getElement(r.Binder.UPLOAD_TITLE).html(""),this._getElement(r.Binder.CONTAINER_UPLOAD).hide(),$(this).trigger($.Event(r.Event.ERROR,{jqXHR:e}))},r.prototype._invokeReset=function(){console.log("%s: %s",r.TAG,"_invokeReset"),this._getElement(r.Binder.UPLOAD_TITLE).html(""),this._getElement(r.Binder.CONTAINER_UPLOAD).hide(),this.activeMedia=null,this.media=[],$(this).trigger($.Event(r.Event.RESET,{}))},r.prototype.setContainer=function(e){console.log("%s: %s",r.TAG,"setContainer"),this.container=typeof e!="undefined"?e:this.container},r.prototype.addMedia=function(e){console.log("%s: %s",r.TAG,"addMedia");if(typeof e=="undefined")return;this.media.push(e)},r.prototype.removeMedia=function(e){console.log("%s: %s",r.TAG,"removeMedia");for(var t in this.media){var n=this.media[t];if(n.id==e){this.media.splice(t,1);break}}},r.prototype._toggleForm=function(e){this._getElement(r.Binder.RECORD_VIDEO).attr("disabled",e),this._getElement(r.Binder.UPLOAD_FILE).attr("disabled",e),this._getElement(r.Binder.SELECT).attr("disabled",e)},r.prototype.setMedia=function(e){console.log("%s: %s",r.TAG,"setMedia");if(typeof e=="undefined")return;e.length>0&&(this._toggleForm(!0),this._getElement(r.Binder.WORKING).show(),this._getElement(r.Binder.SELECTED_MEDIA).html(""),$.ajax({url:Routing.generate("imdc_myfiles_get_info"),data:{mediaIds:e},type:"POST",success:function(e,t,n){this.media=e.media,this.isFileSelection&&$.each(this.media,function(e,t){this._addSelectedMedia(t)}.bind(this)),this._getElement(r.Binder.WORKING).hide(),this._toggleForm(!1),$(this).trigger($.Event(r.Event.SUCCESS,{}))}.bind(this),error:function(e){console.log(e.statusText),this._getElement(r.Binder.WORKING).hide(),this._toggleForm(!1)}.bind(this)}))},r.prototype.generateFormData=function(e){var t="";return this._getElement(r.Binder.SELECTED_MEDIA).each(function(n,r){var i=$(e.replace(/__name__/g,n));i.val($(r).data("mid")),t+=i[0].outerHTML}),t},r.prototype.reset=function(){this._invokeReset()},r}),define("controller/myFiles",["core/mediaChooser","core/mediaManager"],function(e,t){var n=function(e){console.log("%s: %s- options=%o",n.TAG,"constructor",e),this.page=e.page,this.mediaChooser=null,this.mediaManager=new t,this.bind__onPreviewButtonClick=this.onPreviewButtonClick.bind(this),this.bind__onDeleteButtonClick=this.onDeleteButtonClick.bind(this),this.bind__onPageLoaded=this._onPageLoaded.bind(this),this.bind__onSuccess=this._onSuccess.bind(this),this.bind__onDialogClose=this._onDialogClose.bind(this),dust.compileFn($("#mediaRow").html(),"mediaRow"),$tt._instances.push(this)};return n.TAG="MyFiles",n.Page={INDEX:0,PREVIEW:1},n.prototype.getContainer=function(){return $("body")},n.prototype.bindUIEvents=function(){console.log("%s: %s",n.TAG,"bindUIEvents");switch(this.page){case n.Page.INDEX:this._bindUIEventsIndex();break;case n.Page.PREVIEW:}},n.prototype._bindUIEventsIndex=function(){console.log("%s: %s",n.TAG,"_bindUIEventsIndex"),this.mediaChooser=new e({isFileSelection:!1}),$(this.mediaChooser).on(e.Event.PAGE_LOADED,this.bind__onPageLoaded),$(this.mediaChooser).on(e.Event.SUCCESS,this.bind__onSuccess),$(this.mediaChooser).on(e.Event.DIALOG_CLOSE,this.bind__onDialogClose),this.mediaChooser.setContainer(this.getContainer()),this.mediaChooser.bindUIEvents(),$(".preview-button").on("click",this.bind__onPreviewButtonClick),$(".delete-button").on("click",this.bind__onDeleteButtonClick);var t=this;$("span.edit-title").editable({toggle:"manual",unsavedclass:null,success:function(e,n){t.mediaManager.updateMedia({id:$(this).data("val"),title:n})}}),$("a.edit-title").on("click",function(e){e.stopPropagation(),e.preventDefault(),$(this).prev().editable("toggle")})},n.prototype.onPreviewButtonClick=function(e){e.preventDefault(),console.log("Preview");if($(e.currentTarget).hasClass("disabled"))return!1;this.page=n.Page.PREVIEW,this.mediaChooser.previewMedia($(e.currentTarget).data("val"))},n.prototype.onDeleteButtonClick=function(e){e.preventDefault();var n=$(e.target),r=this;return $(this.mediaManager).one(t.EVENT_DELETE_SUCCESS,function(){n.parent().parent().parent().remove()}),$(this.mediaManager).one(t.EVENT_DELETE_ERROR,function(e,t){t.status==500?(console.log("500"),alert(t.statusText)):t.status==404?(console.log("404"),alert(t.statusText)):alert(t.feedback)}),this.mediaManager.deleteMedia(n.data("val"),Translator.trans("filesGateway.deleteConfirmMessage"))},n.prototype._onPageLoaded=function(t){console.log("%s: %s",n.TAG,"_onPageLoaded");switch(this.mediaChooser.page){case e.Page.RECORD_VIDEO:this.mediaChooser.createVideoRecorder();break;case e.Page.PREVIEW:t.payload.media.type==e.MEDIA_TYPE.VIDEO.id&&this.mediaChooser.createVideoPlayer()}},n.prototype._onSuccess=function(e){switch(this.page){case n.Page.INDEX:this._addMediaRow(e.media);break;case n.Page.PREVIEW:console.log("Done previewing")}},n.prototype._onDialogClose=function(e){switch(this.page){case n.Page.PREVIEW:this.page=n.Page.INDEX,console.log("Terminating function called"),console.log(e.media),this._updateMediaRow(e.media)}},n.prototype._addMediaRow=function(e){console.log("%s: %s",n.TAG,"_addMediaRow");var t={media:e};e.isReady==0&&(t.previewDisabled=!0);switch(e.type){case 0:t.icon="fa-picture-o",t.mediaType="Image";break;case 1:t.icon="fa-film",t.mediaType="Video",t.canInterpret=!0;break;case 2:t.icon="fa-headphones",t.mediaType="Audio",t.canInterpret=!0;break;default:t.icon="fa-file-o",t.mediaType="Other"}var r=new Date(e.metaData.timeUploaded.date),i=r.getHours()>=12?"pm":"am",s=r.getHours()>12?r.getHours()-12:r.getHours();s=s<10?"0"+s:s;var o=s+":"+(r.getMinutes()<10?"0"+r.getMinutes():r.getMinutes())+i,u=o+" "+$.datepicker.formatDate("M d",r);t.dateString=u,e.metaData.size>0&&(t.mediaSize=(e.metaData.size/1024/1024).toFixed(2));var a=this;t.deleteUrl=Routing.generate("imdc_myfiles_delete",{mediaId:e.id}),t.previewUrl=Routing.generate("imdc_myfiles_preview",{mediaId:e.id}),t.newThreadUrl=Routing.generate("imdc_thread_new_from_media",{mediaId:e.id}),t.simulRecordUrl="",t.thumbnail=e.thumbnail,dust.render("mediaRow",t,function(e,t){$(".tt-myFiles-table").append(t)}),$(".preview-button:last").on("click",this.bind__onPreviewButtonClick),$(".delete-button:last").on("click",this.bind__onDeleteButtonClick),$("span.edit-title:last").editable({toggle:"manual",unsavedclass:null,success:function(e,t){a.mediaManager.updateMedia({id:$(this).data("val"),title:t})}}),$("a.edit-title:last").on("click",function(e){e.stopPropagation(),e.preventDefault(),$(this).prev().editable("toggle")})},n.prototype._updateMediaRow=function(e){console.log("%s: %s",n.TAG,"_updateMediaRow");var t={media:e};e.metaData.size>0&&(t.mediaSize=(e.metaData.size/1024/1024).toFixed(2)+" MB"),t.title=e.title;var r=$("a[data-val|="+t.media.id+"]").eq(0).parents("tr").eq(0);console.log(r),r.children().eq(2).children().eq(0).text(t.title),r.children().eq(5).text(t.mediaSize);var i=this},n}),define("controller/forum",["core/mediaChooser"],function(e){var t=function(e){this.page=e.page,this.id=e.id,this.mediaChooser=null,this.bind__onChangeAccessType=this._onChangeAccessType.bind(this),this.bind__onClickSubmit=this._onClickSubmit.bind(this),this.bind__onClickDelete=this._onClickDelete.bind(this),this.bind__onDeleteSuccess=this._onDeleteSuccess.bind(this),this.bind__onDeleteError=this._onDeleteError.bind(this),this.bind__onPageLoaded=this._onPageLoaded.bind(this),this.bind__onSuccess=this._onSuccess.bind(this),this.bind__onReset=this._onReset.bind(this),$tt._instances.push(this)};return t.TAG="Forum",t.Page={NEW:0,EDIT:1,DELETE:2,VIEW:3},t.Binder={SUBMIT:".forum-submit",DELETE_MODAL:".forum-delete-modal",DELETE:".forum-delete"},t.FORM_NAME="ForumForm",t.prototype.getContainer=function(){return $("body")},t.prototype._getElement=function(e){return this.getContainer().find(e)},t.prototype.getForm=function(){return this.getContainer().find("form[name="+t.FORM_NAME+"]")},t.prototype.getFormField=function(e){return this.getContainer().find("#"+t.FORM_NAME+"_"+e)},t.prototype.bindUIEvents=function(){console.log("%s: %s",t.TAG,"bindUIEvents");switch(this.page){case t.Page.NEW:case t.Page.EDIT:this._bindUIEventsNewEdit();break;case t.Page.VIEW:this._bindUIEventsView()}},t.prototype._bindUIEventsNewEdit=function(){console.log("%s: %s",t.TAG,"_bindUIEventsNewEdit"),this.mediaChooser=new e,$(this.mediaChooser).on(e.Event.PAGE_LOADED,this.bind__onPageLoaded),$(this.mediaChooser).on(e.Event.SUCCESS,this.bind__onSuccess),$(this.mediaChooser).on(e.Event.RESET,this.bind__onReset),this.mediaChooser.setContainer(this.getContainer()),this.mediaChooser.bindUIEvents();var n=[];this.getFormField("titleMedia").children().each(function(e,t){n.push($(t).val())}),n.length>0&&(this._getElement(t.Binder.SUBMIT).attr("disabled",!0),this.mediaChooser.setMedia(n)),this.getForm().find("input:radio").on("change",this.bind__onChangeAccessType),this._getElement(t.Binder.SUBMIT).on("click",this.bind__onClickSubmit),this._getElement(t.Binder.DELETE).on("click",this.bind__onClickDelete),this.getForm().find("input:radio:checked").trigger("change")},t.prototype._bindUIEventsView=function(){console.log("%s: %s",t.TAG,"_bindUIEventsView"),this.gallery=new $tt.Core.Gallery({container:$(".gallery-container")}),this.gallery.bindUIEvents()},t.prototype._onChangeAccessType=function(e){var t=this.getFormField("group"),n=t.parent();$(e.target).attr("id")==this.getForm().find("input:radio[value=6]").attr("id")?(n.find("label").addClass("required"),t.attr("required",!0),n.children().show()):(n.find("label").removeClass("required"),t.attr("required",!1),n.children().hide())},t.prototype._onClickSubmit=function(e){$(e.target).button("loading")},t.prototype._onClickDelete=function(e){$(e.target).button("loading"),$.ajax({url:Routing.generate("imdc_forum_delete",{forumid:this.id}),type:"POST",success:this.bind__onDeleteSuccess,error:this.bind__onDeleteError})},t.prototype._onDeleteSuccess=function(e,n,r){if(!e.wasDeleted){this._onDeleteError(r,n,null);return}this._getElement(t.Binder.DELETE_MODAL).find(".modal-body").html("Forum deleted successfully."),window.location.assign(e.redirectUrl)},t.prototype._onDeleteError=function(e,n,r){this._getElement(t.Binder.DELETE_MODAL).find(".modal-body").prepend("Something went wrong. Try again."),this._getElement(t.Binder.DELETE).button("reset")},t.prototype._onPageLoaded=function(n){console.log("%s: %s",t.TAG,"_onPageLoaded");switch(this.mediaChooser.page){case e.Page.RECORD_VIDEO:this.mediaChooser.createVideoRecorder();break;case e.Page.PREVIEW:n.payload.media.type==e.MEDIA_TYPE.VIDEO.id&&this.mediaChooser.createVideoPlayer()}},t.prototype._onSuccess=function(e){this._getElement(t.Binder.SUBMIT).attr("disabled",!1),this.getFormField("titleText").attr("required",!1).parent().find("label").removeClass("required");var n=this.getFormField("titleMedia");n.html(this.mediaChooser.generateFormData(n.data("prototype")))},t.prototype._onReset=function(e){this.mediaChooser.media.length==0&&this.getFormField("titleText").attr("required",!0).parent().find("label").addClass("required")},t}),define("controller/post",["core/mediaChooser"],function(e){var t=function(e){console.log("%s: %s- options=%o",t.TAG,"constructor",e),this.page=e.page,this.id=e.id,this.threadId=e.threadId,this.mediaChooser=null,this.bind__onClickSubmit=this._onClickSubmit.bind(this),this.bind__onSubmitSuccess=this._onSubmitSuccess.bind(this),this.bind__onSubmitError=this._onSubmitError.bind(this),this.bind__onClickCancel=this._onClickCancel.bind(this),this.bind__onClickReset=this._onClickReset.bind(this),this.bind__onPageLoaded=this._onPageLoaded.bind(this),this.bind__onSuccess=this._onSuccess.bind(this),this.bind__onSuccessAndPost=this._onSuccessAndPost.bind(this),this.bind__onReset=this._onReset.bind(this),$tt._instances.push(this)};return t.TAG="Post",t.Page={NEW:0,REPLY:1,EDIT:2,DELETE:3},t.Event={FORM:"eventForm",SUBMIT_SUCCESS:"eventSubmitSuccess",RESET:"eventReset",CANCEL:"eventCancel"},t.Binder={CONTAINER:".post-container",CONTAINER_VIEW:".post-container-view",CONTAINER_REPLY:".post-container-reply",CONTAINER_EDIT:".post-container-edit",CONTAINER_DELETE:".post-container-delete",REPLY_LINK:".post-reply",SUBMIT:".post-submit",RESET:".post-reset",CANCEL:".post-cancel",DELETE_MODAL:".post-delete-modal",DELETE:".post-delete"},t.FORM_NAME="PostForm",t.prototype.getContainer=function(){return $(t.Binder.CONTAINER+"[data-pid="+this.id+"]")},t.prototype._getElement=function(e){return this.getContainer().find(e)},t.prototype.getForm=function(){return this.getContainer().find("form[name="+t.FORM_NAME+"]")},t.prototype.getFormField=function(e){return this.getForm().find("#"+t.FORM_NAME+"_"+e)},t.prototype._getUrl=function(){switch(this.page){case t.Page.NEW:return Routing.generate("imdc_thread_new_post",{threadId:this.threadId});case t.Page.REPLY:return Routing.generate("imdc_post_reply",{pid:this.id});case t.Page.EDIT:return Routing.generate("imdc_post_edit",{pid:this.id});case t.Page.DELETE:return Routing.generate("imdc_post_delete",{pid:this.id})}},t.prototype.handlePage=function(){$.ajax({url:this._getUrl(),success:function(e,n,r){console.log("%s: %s: %s",t.TAG,"handlePage","success");switch(this.page){case t.Page.REPLY:this._getElement(t.Binder.REPLY_LINK).hide();var i=this._getElement(t.Binder.CONTAINER_REPLY);i.html(e.html),i.show();break;case t.Page.EDIT:this._getElement(t.Binder.CONTAINER_VIEW).hide();var i=this._getElement(t.Binder.CONTAINER_EDIT);i.html(e.html),i.show()}$(this).trigger($.Event(t.Event.FORM,{post:this}))}.bind(this),error:function(e){console.log("%s: %s: %s",t.TAG,"handlePage","error"),console.log(e.statusText)}})},t.prototype.bindUIEvents=function(){console.log("%s: %s",t.TAG,"bindUIEvents");var n=new Array;this.getFormField("attachedFile").children().each(function(e,t){n.push($(t).val())}),this.mediaChooser=new e({enableDoneAndPost:!0}),$(this.mediaChooser).on(e.Event.PAGE_LOADED,this.bind__onPageLoaded),$(this.mediaChooser).on(e.Event.SUCCESS_AND_POST,this.bind__onSuccessAndPost),this.mediaChooser.setContainer(this.getContainer()),this.mediaChooser.setMedia(n),this.mediaChooser.bindUIEvents(),this._getElement(t.Binder.SUBMIT).on("click",this.bind__onClickSubmit),this.page!=t.Page.EDIT&&this.page!=t.Page.DELETE&&this._getElement(t.Binder.RESET).on("click",this.bind__onClickReset),this._getElement(t.Binder.CANCEL).on("click",this.bind__onClickCancel)},t.prototype._onPageLoaded=function(n){console.log("%s: %s",t.TAG,"_onPageLoaded");switch(this.mediaChooser.page){case e.Page.RECORD_VIDEO:this.mediaChooser.createVideoRecorder();break;case e.Page.PREVIEW:n.payload.media.type==e.MEDIA_TYPE.VIDEO.id&&this.mediaChooser.createVideoPlayer()}},t.prototype._onClickSubmit=function(e){e&&e.preventDefault&&e.preventDefault();if(this.page!=t.Page.DELETE&&this.getFormField("content").val()==""&&this.mediaChooser.media==null){alert("Your post cannot be blank. You must either select a file or write a comment.");return}this._toggleForm(!0);if(this.page!=t.Page.DELETE){var n=this.getFormField("attachedFile");n.html(this.mediaChooser.generateFormData(n.data("prototype")))}this.page==t.Page.DELETE&&$(e.target).button("loading"),$.ajax({url:this._getUrl(),type:"POST",contentType:!1,data:new FormData(this.getForm()[0]),processData:!1,success:this.bind__onSubmitSuccess,error:this.bind__onSubmitError})},t.prototype._toggleForm=function(e){this._getElement(t.Binder.SUBMIT).button(e?"loading":"reset"),this.page!=t.Page.EDIT&&this.page!=t.Page.DELETE&&this._getElement(t.Binder.RESET).attr("disabled",e),this._getElement(t.Binder.CANCEL).attr("disabled",e)},t.prototype._onSubmitSuccess=function(e,n,r){console.log("%s: %s: %s",t.TAG,"_onSubmitSuccess","success");switch(this.page){case t.Page.NEW:case t.Page.REPLY:e.wasReplied?window.location.replace(e.redirectUrl):(this._getElement(t.Binder.CONTAINER_REPLY).html(e.html),this.bindUIEvents(),this._toggleForm(!1));break;case t.Page.EDIT:if(e.wasEdited){var i=this._getElement(t.Binder.CONTAINER_VIEW);i.data("starttime",e.startTime),i.data("endtime",e.endTime),i.data("istemporal",e.isTemporal),i.html(e.html),this._onClickCancel()}else this._getElement(t.Binder.CONTAINER_EDIT).html(e.html),this.bindUIEvents(),this._toggleForm(!1);break;case t.Page.DELETE:$(t.Binder.DELETE).button("reset"),$(t.Binder.DELETE).off("click",this.bind__onClickSubmit);if(!e.wasDeleted)break;$(t.Binder.DELETE_MODAL).modal("hide"),this.getContainer().fadeOut("slow",function(e){$(this).remove()})}$(this).trigger($.Event(t.Event.SUBMIT_SUCCESS,{post:this,payload:e}))},t.prototype._onSubmitError=function(e){console.log("%s: %s: %s",t.TAG,"_onClickSubmit","error"),console.log(e.statusText),this._toggleForm(!1),this.page==t.Page.DELETE&&$(t.Binder.DELETE).button("reset")},t.prototype._onClickReset=function(e){e&&e.preventDefault&&e.preventDefault(),this.mediaChooser.reset(),this.getFormField("content").val(""),this.getFormField("startTime").val(""),this.getFormField("endTime").val(""),$(this).trigger($.Event(t.Event.RESET,{post:this}))},t.prototype._onClickCancel=function(e){e&&e.preventDefault&&e.preventDefault();switch(this.page){case t.Page.NEW:case t.Page.REPLY:var n=this._getElement(t.Binder.CONTAINER_REPLY);n.hide(),n.html(""),this._getElement(t.Binder.REPLY_LINK).show();break;case t.Page.EDIT:var n=this._getElement(t.Binder.CONTAINER_EDIT);n.hide(),n.html(""),this._getElement(t.Binder.CONTAINER_VIEW).show()}$(this).trigger($.Event(t.Event.CANCEL,{post:this}))},t.prototype._onSuccess=function(e){this.getFormField("mediatextarea").val(e.media.id)},t.prototype._onSuccessAndPost=function(e){this._getElement(t.Binder.SUBMIT).trigger("click")},t.prototype._onReset=function(e){this.getFormField("mediatextarea").val("")},t}),define("controller/thread",["core/mediaChooser","controller/post"],function(t,n){var r=function(e){console.log("%s: %s- options=%o",r.TAG,"constructor",e),this.page=e.page,this.threadId=e.threadId,this.posts=new Array,this.mediaChooser=null,this.player=null,this.playerOptions=null,this.keyPoints=new Array,this.videoSpeed=0,this.bind__onClickSubmit=this._onClickSubmit.bind(this),this.bind__onClickDelete=this._onClickDelete.bind(this),this.bind__onDeleteSuccess=this._onDeleteSuccess.bind(this),this.bind__onDeleteError=this._onDeleteError.bind(this),this.bind__onClickPostTimelineKeyPoint=this._onClickPostTimelineKeyPoint.bind(this),this.bind__onMouseEnterPostTimelineKeyPoint=this._onMouseEnterPostTimelineKeyPoint.bind(this),this.bind__onMouseLeavePostTimelineKeyPoint=this._onMouseLeavePostTimelineKeyPoint.bind(this),this.bind__onClickPostReply=this._onClickPostReply.bind(this),this.bind__onClickPostEdit=this._onClickPostEdit.bind(this),this.bind__onClickPostDelete=this._onClickPostDelete.bind(this),this.bind__onPostForm=this._onPostForm.bind(this),this.bind__onPostSubmitSuccess=this._onPostSubmitSuccess.bind(this),this.bind__onPostReset=this._onPostReset.bind(this),this.bind__onPostCancel=this._onPostCancel.bind(this),this.bind__onPageLoaded=this._onPageLoaded.bind(this),this.bind__onSuccess=this._onSuccess.bind(this),this.bind__onReset=this._onReset.bind(this),$tt._instances.push(this)};return r.TAG="Thread",r.DEFAULT_TEMPORAL_COMMENT_LENGTH=3,r.Page={NEW:0,EDIT:1,VIEW:2},r.Binder={SUBMIT:".thread-submit",DELETE_MODAL:".thread-delete-modal",DELETE:".thread-delete"},r.FORM_NAME="Thread",r.prototype.getContainer=function(){return $("body")},r.prototype._getElement=function(e){return this.getContainer().find(e)},r.prototype.getForm=function(){return this.getContainer().find("form[name^="+r.FORM_NAME+"]")},r.prototype.getFormField=function(e){return this.getForm().find("[id^="+r.FORM_NAME+"]").filter("[id$=_"+e+"]")},r.prototype.bindUIEvents=function(){console.log("%s: %s",r.TAG,"bindUIEvents");switch(this.page){case r.Page.NEW:case r.Page.EDIT:this._bindUIEventsNewEdit(this.page==r.Page.EDIT);break;case r.Page.VIEW:this._bindUIEventsView()}},r.prototype._bindUIEventsNewEdit=function(e){console.log("%s: %s- isEdit=%s",r.TAG,"_bindUIEventsNewEdit",e),this.mediaChooser=new t,$(this.mediaChooser).on(t.Event.PAGE_LOADED,this.bind__onPageLoaded),$(this.mediaChooser).on(t.Event.SUCCESS,this.bind__onSuccess),$(this.mediaChooser).on(t.Event.RESET,this.bind__onReset),this.mediaChooser.setContainer(this.getContainer()),this.mediaChooser.bindUIEvents();var n=[];this.getFormField("mediaIncluded").children().each(function(e,t){n.push($(t).val())}),n.length>0&&(this._getElement(r.Binder.SUBMIT).attr("disabled",!0),this.mediaChooser.setMedia(n)),this._getElement(r.Binder.SUBMIT).on("click",this.bind__onClickSubmit),this._getElement(r.Binder.DELETE).on("click",this.bind__onClickDelete)},r.prototype._bindUIEventsView=function(){console.log("%s: %s",r.TAG,"_bindUIEventsView");var e=new n({page:n.Page.NEW,id:-1,threadId:this.threadId});this.posts.push(e),$(e).on(n.Event.RESET,this.bind__onPostReset),e.bindUIEvents(),$("#videoSpeed").on("click",function(e){e.preventDefault(),this.videoSpeed=(this.videoSpeed+1)%3;switch(this.videoSpeed){case 0:this.playerOptions.mediaElement[0].playbackRate=1,$("#videoSpeed img").attr("src",this.playerOptions.speedImages.normal);break;case 1:this.playerOptions.mediaElement[0].playbackRate=2,$("#videoSpeed img").attr("src",this.playerOptions.speedImages.fast);break;case 2:this.playerOptions.mediaElement[0].playbackRate=.5,$("#videoSpeed img").attr("src",this.playerOptions.speedImages.slow);break;default:this.playerOptions.mediaElement[0].playbackRate=1,$("#videoSpeed img").attr("src",this.playerOptions.speedImages.normal)}}.bind(this)),$("#closedCaptions").on("click",function(e){e.preventDefault()}.bind(this)),$(".post-timeline-keypoint").on("click",this.bind__onClickPostTimelineKeyPoint),$(".post-timeline-keypoint").hover(this.bind__onMouseEnterPostTimelineKeyPoint,this.bind__onMouseLeavePostTimelineKeyPoint),$(".post-edit").on("click",this.bind__onClickPostEdit),$(".post-delete-A").on("click",this.bind__onClickPostDelete),$(".post-reply").on("click",this.bind__onClickPostReply)},r.prototype._onClickSubmit=function(e){$(e.target).button("loading")},r.prototype._onClickDelete=function(e){$(e.target).button("loading"),$.ajax({url:Routing.generate("imdc_thread_delete",{threadid:this.threadId}),type:"POST",success:this.bind__onDeleteSuccess,error:this.bind__onDeleteError})},r.prototype._onDeleteSuccess=function(e,t,n){if(!e.wasDeleted){this._onDeleteError(n,t,null);return}this._getElement(r.Binder.DELETE_MODAL).find(".modal-body").html("Topic deleted successfully."),window.location.assign(e.redirectUrl)},r.prototype._onDeleteError=function(e,t,n){this._getElement(r.Binder.DELETE_MODAL).find(".modal-body").prepend("Something went wrong. Try again."),this._getElement(r.Binder.DELETE).button("reset")},r.prototype._getPost=function(e){console.log("%s: %s- id=%d",r.TAG,"_getPost",e);for(var t in this.posts){var n=this.posts[t];if(n.id==e)return n}return null},r.prototype._deletePost=function(e){console.log("%s: %s- id=%d",r.TAG,"_deletePost",e);for(var t in this.posts){var n=this.posts[t];if(n.id==e){this.posts.splice(t,1);break}}},r.prototype._onClickPostTimelineKeyPoint=function(e){e&&e.preventDefault&&e.preventDefault();var t=this._getKeyPoint($(e.currentTarget).data("pid"));t.paintHighlightedTimeout=!0,t.paintHighlighted=!0,this.player.seek(t.startTime),this.player.redrawKeyPoints=!0,this.player.repaint(),setTimeout(function(){t.paintHighlightedTimeout=!1,t.paintHighlighted=!1,this.player.redrawKeyPoints=!0,this.player.repaint()}.bind(this),3e3)},r.prototype._onMouseEnterPostTimelineKeyPoint=function(e){var t=this._getKeyPoint($(e.currentTarget).data("pid"));t.paintHighlighted=!0,this.player.redrawKeyPoints=!0,this.player.repaint()},r.prototype._onMouseLeavePostTimelineKeyPoint=function(e){var t=this._getKeyPoint($(e.currentTarget).data("pid"));if(t.paintHighlightedTimeout==1)return;t.paintHighlighted=!1,this.player.redrawKeyPoints=!0,this.player.repaint()},r.prototype._postEventBind=function(e,t){t?($(e).on(n.Event.FORM,this.bind__onPostForm),e.page==n.Page.REPLY&&$(e).on(n.Event.RESET,this.bind__onPostReset),$(e).on(n.Event.SUBMIT_SUCCESS,this.bind__onPostSubmitSuccess),$(e).on(n.Event.CANCEL,this.bind__onPostCancel)):($(e).off(n.Event.FORM,this.bind__onPostForm),e.page==n.Page.REPLY&&$(e).off(n.Event.RESET,this.bind__onPostReset),$(e).off(n.Event.SUBMIT_SUCCESS,this.bind__onPostSubmitSuccess),$(e).off(n.Event.CANCEL,this.bind__onPostCancel))},r.prototype._onClickPostReply=function(e){e&&e.preventDefault&&e.preventDefault();var t=$(e.currentTarget).data("pid"),r=this._getPost(t);r||(r=new n({page:n.Page.REPLY,id:t,threadId:this.threadId}),this.posts.push(r)),r.page=n.Page.REPLY,this._postEventBind(r,!1),this._postEventBind(r,!0),r.handlePage()},r.prototype._onClickPostEdit=function(e){e&&e.preventDefault&&e.preventDefault();var t=$(e.currentTarget).data("pid"),r=this._getPost(t);r||(r=new n({page:n.Page.EDIT,id:t,threadId:this.threadId}),this.posts.push(r)),r.page=n.Page.EDIT,this._postEventBind(r,!1),this._postEventBind(r,!0),r.handlePage()},r.prototype._onClickPostDelete=function(e){e&&e.preventDefault&&e.preventDefault();var t=$(e.currentTarget).data("pid"),r=this._getPost(t);r||(r=new n({page:n.Page.DELETE,id:t,threadId:this.threadId}),this.posts.push(r)),r.page=n.Page.DELETE,this._postEventBind(r,!1),this._postEventBind(r,!0),$(n.Binder.DELETE).off("click",r.bind__onClickSubmit),$(n.Binder.DELETE).on("click",r.bind__onClickSubmit)},r.prototype._onPostForm=function(e){e.post.page==n.Page.EDIT&&this._toggleTemporal(this._getKeyPoint(e.post.id),!1),e.post.bindUIEvents()},r.prototype._toggleTemporal=function(e,t){!t&&e&&e.options.drawOnTimeLine?(this.player.pause(),this.player.setPlayHeadImage(""),this.player.setVideoTime(e.startTime),this.player.setAreaSelectionStartTime(e.startTime),this.player.setAreaSelectionEndTime(e.endTime),this.player.setAreaSelectionEnabled(!0)):(this.player.pause(),this.player.setPlayHeadImage(this.playerOptions.playHeadImage),this.player.setAreaSelectionEnabled(!1))},r.prototype._onPostSubmitSuccess=function(e){switch(e.post.page){case n.Page.EDIT:var t=e.post._getElement(n.Binder.CONTAINER_VIEW);t.data("istemporal")&&this._replaceKeyPoint(new KeyPoint(t.data("pid"),t.data("starttime"),t.data("endtime"),"",{drawOnTimeLine:t.data("istemporal")}));break;case n.Page.DELETE:this._deleteKeyPoint(e.post.id),this._deletePost(e.post.id),$("#modaldiv").modal("hide")}},r.prototype._onPostReset=function(e){var t=e.post.page==n.Page.EDIT?!1:!0;this._toggleTemporal(this._getKeyPoint(e.post.id),t)},r.prototype._onPostCancel=function(e){this._toggleTemporal(this._getKeyPoint(e.post.id),!0)},r.prototype._createKeyPoints=function(){console.log("%s: %s",r.TAG,"_createKeyPoints"),this.keyPoints=new Array,$(n.Binder.CONTAINER_VIEW).each(function(e,t){this.keyPoints.push(new KeyPoint($(t).data("pid"),$(t).data("starttime"),$(t).data("endtime"),"",{drawOnTimeLine:$(t).data("istemporal")}))}.bind(this))},r.prototype._getKeyPoint=function(e){console.log("%s: %s- postId=%d",r.TAG,"_getKeyPoint",e);for(var t in this.keyPoints){var n=this.keyPoints[t];if(n.id==e)return n}return null},r.prototype._replaceKeyPoint=function(e){console.log("%s: %s- keyPoint=%o",r.TAG,"_replaceKeyPoint",e);for(var t in this.keyPoints){var n=this.keyPoints[t];if(n.id==e.id){this.keyPoints[t]=e;break}}this.player&&(this.player.setKeyPoints(this.keyPoints),this.player.repaint(),this._renderPostTimelinePoints()),$(".post-timeline-keypoint[data-pid="+e.id+"]").on("click",this.bind__onClickPostTimelineKeyPoint),$(".post-timeline-keypoint[data-pid="+e.id+"]").hover(this.bind__onMouseEnterPostTimelineKeyPoint,this.bind__onMouseLeavePostTimelineKeyPoint)},r.prototype._deleteKeyPoint=function(e){console.log("%s: %s- postId=%d",r.TAG,"_deleteKeyPoint",e);for(var t in this.keyPoints){var n=this.keyPoints[t];if(n.id==e){this.keyPoints.splice(t,1);break}}this.player&&(this.player.setKeyPoints(this.keyPoints),this.player.repaint(),this._renderPostTimelinePoints())},r.prototype._renderPostTimelinePoints=function(){console.log("%s: %s",r.TAG,"_renderPostTimelinePoints"),$(n.Binder.CONTAINER_VIEW).each(function(e,t){var n=this.playerOptions.mediaElement[0].duration,r=(100*$(t).data("starttime")/n).toFixed(2),i=(100*$(t).data("endtime")/n).toFixed(2),s=(i-r).toFixed(2);$(".post-timeline-keypoint[data-pid="+$(t).data("pid")+"]").css({left:r+"%",width:s+"%"})}.bind(this))},r.prototype.createPlayer=function(e){console.log("%s: %s",r.TAG,"createPlayer"),this.playerOptions=e,this.player=new Player(this.playerOptions.mediaElement,{areaSelectionEnabled:!1,updateTimeType:Player.DENSITY_BAR_UPDATE_TYPE_ABSOLUTE,audioBar:!1,overlayControls:!0,playHeadImage:this.playerOptions.playHeadImage,playHeadImageOnClick:function(){var e=this.player.getCurrentTime();this._toggleTemporal(new KeyPoint(-1,e,e+r.DEFAULT_TEMPORAL_COMMENT_LENGTH,"",{drawOnTimeLine:!0}),!1)}.bind(this)}),this._createKeyPoints(),this.playerOptions.mediaElement.on("loadedmetadata",function(e){this._renderPostTimelinePoints()}.bind(this)),isNaN(this.playerOptions.mediaElement[0].duration)||this.playerOptions.mediaElement.trigger("loadedmetadata"),this.player.setKeyPoints(this.keyPoints),this.player.createControls(),$(this.player).on(Player.EVENT_AREA_SELECTION_CHANGED,function(e){console.log("%s: %s",r.TAG,Player.EVENT_AREA_SELECTION_CHANGED);for(var t in this.posts){var n=this.posts[t],i=this.player.getAreaSelectionTimes();n.getFormField("startTime").val(parseFloat(i.minTime).toFixed(2)),n.getFormField("endTime").val(parseFloat(i.maxTime).toFixed(2))}}.bind(this)),$(this.player).on(Player.EVENT_KEYPOINT_MOUSE_OVER,function(e,t,n){console.log("%s: %s- keyPoint=%o, coords=%o",r.TAG,Player.EVENT_KEYPOINT_MOUSE_OVER,t,n),$(".tt-post-container[data-pid="+t.id+"]").addClass("tt-post-container-highlight"),$("#threadReplyContainer").is(":animated")||$("#threadReplyContainer").animate({scrollTop:$(".tt-post-container[data-pid="+t.id+"]").position().top},200)}),$(this.player).on(Player.EVENT_KEYPOINT_MOUSE_OUT,function(e,t){console.log("%s: %s- keyPoint=%o",r.TAG,Player.EVENT_KEYPOINT_MOUSE_OUT,t),$(".tt-post-container[data-pid="+t.id+"]").removeClass("tt-post-container-highlight")}),$(this.player).on(Player.EVENT_KEYPOINT_CLICK,function(e,t,n){console.log("%s: %s- keyPoint=%o, coords=%o",r.TAG,Player.EVENT_KEYPOINT_CLICK,t,n)}),$(this.player).on(Player.EVENT_KEYPOINT_BEGIN,function(e,t){console.log("%s: %s- keyPoint=%o",r.TAG,Player.EVENT_KEYPOINT_BEGIN,t)}),$(this.player).on(Player.EVENT_KEYPOINT_END,function(e,t){console.log("%s: %s- keyPoint=%o",r.TAG,Player.EVENT_KEYPOINT_END,t)})},r.prototype._onPageLoaded=function(){console.log("%s: %s",r.TAG,"_onPageLoaded");switch(this.mediaChooser.page){case t.Page.RECORD_VIDEO:this.mediaChooser.createVideoRecorder();break;case t.Page.PREVIEW:e.data.media.type==t.MEDIA_TYPE.VIDEO.id&&this.mediaChooser.createVideoPlayer()}},r.prototype._onSuccess=function(e){this._getElement(r.Binder.SUBMIT).attr("disabled",!1),this.getFormField("title").attr("required",!1).parent().find("label").removeClass("required");var t=this.getFormField("mediaIncluded");t.html(this.mediaChooser.generateFormData(t.data("prototype")))},r.prototype._onReset=function(e){this.mediaChooser.media.length==0&&this.getFormField("title").attr("required",!0).parent().find("label").addClass("required")},r}),define("controller/group",["core/mediaChooser"],function(e){var t=function(e){console.log("%s: %s- options=%o",t.TAG,"constructor",e),this.page=e.page,this.mediaChooser=null,this.bind__onClickUserSelect=this._onClickUserSelect.bind(this),this.bind__submitSelectedUsersForm=this._submitSelectedUsersForm.bind(this),this.bind__onPageLoaded=this._onPageLoaded.bind(this),this.bind__onSuccess=this._onSuccess.bind(this),this.bind__onReset=this._onReset.bind(this),$tt._instances.push(this)};return t.TAG="Group",t.Page={NEW:0,EDIT:1,ADD_MEMBERS:2,VIEW:3},t.Binder={CONTAINER_MEDIA:".group-container-media",CONTAINER_INFO:".group-container-info",CONTAINER_FORUMS:".group-container-forums",TOGGLE_MEMBER_SELECT:".group-toggle-member-select",USER_CONTAINER_SELECT:".user-container-select",USER_SELECT:".user-select",USER_SELECTED:".user-selected",SUBMIT:".group-submit"},t.FORM_NAME="UserGroupForm",t.prototype.getContainer=function(){return $("body")},t.prototype._getElement=function(e){return this.getContainer().find(e)},t.prototype.getForm=function(){return this.getContainer().find("form[name="+t.FORM_NAME+"]")},t.prototype.getFormField=function(e){return this.getForm().find("#"+t.FORM_NAME+"_"+e)},t.prototype.bindUIEvents=function(){console.log("%s: %s",t.TAG,"bindUIEvents");switch(this.page){case t.Page.NEW:case t.Page.EDIT:this._bindUIEventsNewEdit();break;case t.Page.ADD_MEMBERS:this._bindUIEventsAddMembers();break;case t.Page.VIEW:this._bindUIEventsView()}},t.prototype._bindUIEventsNewEdit=function(){console.log("%s: %s",t.TAG,"_bindUIEventsNewEdit");var n=new Array;this.getFormField("media").children().each(function(e,t){n.push($(t).val())}),this.mediaChooser=new e,$(this.mediaChooser).on(e.Event.PAGE_LOADED,this.bind__onPageLoaded),$(this.mediaChooser).on(e.Event.SUCCESS,this.bind__onSuccess),this.mediaChooser.setContainer(this.getContainer()),n.length>0&&(this._getElement(t.Binder.SUBMIT).attr("disabled",!0),this.mediaChooser.setMedia(n)),this.mediaChooser.bindUIEvents()},t.prototype._bindUIEventsAddMembers=function(){console.log("%s: %s",t.TAG,"_bindUIEventsAddMembers"),$(t.Binder.USER_SELECT).on("click",this.bind__onClickUserSelect),$(t.Binder.USER_SELECT).each(function(e,t){$(t).html($(t).data("select"))}),$("#addSelected").on("click",this.bind__submitSelectedUsersForm)},t.prototype._bindUIEventsView=function(){console.log("%s: %s",t.TAG,"_bindUIEventsView"),$(t.Binder.USER_SELECT).on("click",this.bind__onClickUserSelect),$(t.Binder.USER_SELECT).each(function(e,t){$(t).html($(t).data("select"))}),$(t.Binder.TOGGLE_MEMBER_SELECT).on("click",function(e){e.preventDefault(),$(t.Binder.CONTAINER_MEDIA).toggle(),$(t.Binder.CONTAINER_INFO).toggle(),$(t.Binder.CONTAINER_FORUMS).toggle(),$(t.Binder.USER_CONTAINER_SELECT).toggle(),$("#deleteSelected").parent().toggleClass("disabled")}),$("#deleteSelected").on("click",this.bind__submitSelectedUsersForm)},t.prototype._onClickUserSelect=function(e){e&&e.preventDefault&&e.preventDefault();var t=$(e.target),n=t.html()==t.data("selected");t.html(n?t.data("select"):t.data("selected")),t.toggleClass("btn-default btn-success user-selected")},t.prototype._submitSelectedUsersForm=function(e){e&&e.preventDefault&&e.preventDefault();if($(e.target).parent().hasClass("disabled"))return!1;if($(t.Binder.USER_SELECTED).length==0)return alert("No members selected."),!0;$(e.target).button("loading"),$(e.target).parent().toggleClass("disabled");var n=$("#selectedUsersForm .selected-users"),r=0;return n.html(""),$(t.Binder.USER_SELECTED).each(function(e,t){var i=n.data("prototype");i=i.replace(/__name__/g,r),n.append(i),$("."+r+"-id").val($(t).data("uid")),r++}),$("#selectedUsersForm form").submit(),!0},t.prototype._onPageLoaded=function(n){console.log("%s: %s",t.TAG,"_onPageLoaded");switch(this.mediaChooser.page){case e.Page.RECORD_VIDEO:this.mediaChooser.createVideoRecorder();break;case e.Page.PREVIEW:n.payload.media.type==e.MEDIA_TYPE.VIDEO.id&&this.mediaChooser.createVideoPlayer()}},t.prototype._onSuccess=function(e){this._getElement(t.Binder.SUBMIT).attr("disabled",!1);var n=this.getFormField("media");n.html(this.mediaChooser.generateFormData(n.data("prototype")))},t.prototype._onReset=function(e){this.getFormField("mediatextarea").val("")},t}),define("controller/message",["core/mediaChooser"],function(e){var t=function(e){console.log("%s: %s- options=%o",t.TAG,"constructor",e),this.page=e.page,this.mediaChooser=null,this.bind__onPageLoaded=this._onPageLoaded.bind(this),this.bind__onSuccess=this._onSuccess.bind(this),this.bind__onReset=this._onReset.bind(this),$tt._instances.push(this)};return t.TAG="Message",t.Page={NEW:0,REPLY:1,VIEW:2},t.Binder={SUBMIT:".message-submit"},t.FORM_NAME="PrivateMessageForm",t.prototype.getContainer=function(){return $("body")},t.prototype._getElement=function(e){return this.getContainer().find(e)},t.prototype.getForm=function(){return this.getContainer().find("form[name="+t.FORM_NAME+"]")},t.prototype.getFormField=function(e){return this.getForm().find("#"+t.FORM_NAME+"_"+e)},t.prototype.bindUIEvents=function(){console.log("%s: %s",t.TAG,"bindUIEvents");switch(this.page){case t.Page.NEW:case t.Page.REPLY:this._bindUIEventsNewReply(this.page==t.Page.REPLY);break;case t.Page.VIEW:this._bindUIEventsView()}},t.prototype._bindUIEventsNewReply=function(n){console.log("%s: %s- isReply=%s",t.TAG,"_bindUIEventsNewReply",n);var r=new Array;this.getFormField("attachedMedia").children().each(function(e,t){r.push($(t).val())}),this.mediaChooser=new e,$(this.mediaChooser).on(e.Event.PAGE_LOADED,this.bind__onPageLoaded),$(this.mediaChooser).on(e.Event.SUCCESS,this.bind__onSuccess),this.mediaChooser.setContainer(this.getContainer()),r.length>0&&(this._getElement(t.Binder.SUBMIT).attr("disabled",!0),this.mediaChooser.setMedia(r)),this.mediaChooser.bindUIEvents(),this.getFormField("recipients").tagit()},t.prototype._bindUIEventsView=function(){console.log("%s: %s",t.TAG,"_bindUIEventsView");var e=$(".tt-message-div").first().data("mid");$.post(Routing.generate("imdc_message_mark_as_read",{messageid:e}),{msgId:e},function(e){console.log("%s: %s: data=%o","mark message as read","success",e)})},t.prototype._onPageLoaded=function(n){console.log("%s: %s",t.TAG,"_onPageLoaded");switch(this.mediaChooser.page){case e.Page.RECORD_VIDEO:this.mediaChooser.createVideoRecorder();break;case e.Page.PREVIEW:n.payload.media.type==e.MEDIA_TYPE.VIDEO.id&&this.mediaChooser.createVideoPlayer()}},t.prototype._onSuccess=function(e){this._getElement(t.Binder.SUBMIT).attr("disabled",!1);var n=this.getFormField("attachedMedia");n.html(this.mediaChooser.generateFormData(n.data("prototype")))},t.prototype._onReset=function(e){this.getFormField("mediatextarea").val("")},t}),define("controller/profile",[],function(){var e=function(t){console.log("%s: %s- options=%o",e.TAG,"constructor",t),this.page=t.page,$tt._instances.push(this)};return e.TAG="Profile",e.Page={EDIT:0},e.prototype.bindUIEvents=function(){console.log("%s: %s",e.TAG,"bindUIEvents");switch(this.page){case e.Page.EDIT:this._bindUIEventsEdit()}},e.prototype._bindUIEventsEdit=function(){console.log("%s: %s",e.TAG,"_bindUIEventsEdit"),$("#addAnotherLanguage").on("click",function(t){t.preventDefault(),e.addLanguage(this)}),$(".tt-delete-language").on("click",function(t){t.preventDefault(),e.deleteLanguage(this)})},e.addLanguage=function(t){var n=$("#foss_user_profile_form_languages"),r,i=n.data("delete-language-text"),s=n.data("prototype"),o=$("#foss_user_profile_form_languages > li").length;$("#no-languages").remove(),r=$('<button class="btn btn-danger btn-sm tt-delete-language"></a>').html(i),r.click(function(n){n.preventDefault(),e.deleteLanguage(t)}),s=s.replace(/__name__/g,o),o++;var u=$("<li></li>").html(s);u.append(r),$("#foss_user_profile_form_languages").append(u)},e.deleteLanguage=function(e){var t=$("#foss_user_profile_form_languages"),n=t.data("no-languages-text"),r=$('<span id="no-languages"></span>').html(n);$(e).parent().remove(),$("#foss_user_profile_form_languages > li").length==0&&$("#foss_user_profile_form_languages").append(r)},e}),define("core/gallery",["core/mediaChooser","core/recorder"],function(e,t){var n=function(e){this.container=e.container,this.media=null,this.thumbsContainerBounds={width:null,thumbWidth:null,thumbsWidth:null},this.bind__onClickArrowLeft=this._onClickArrowLeft.bind(this),this.bind__onClickArrowRight=this._onClickArrowRight.bind(this),this.bind__onClickThumbnail=this._onClickThumbnail.bind(this),dust.compileFn($("#mediaElementVideo").html(),"mediaElementVideo"),dust.compileFn($("#mediaElementAudio").html(),"mediaElementAudio"),dust.compileFn($("#mediaElementImage").html(),"mediaElementImage"),dust.compileFn($("#mediaElementOther").html(),"mediaElementOther")};return n.TAG="Gallery",n.Binder={WORKING:".gallery-working",CONTAINER_INNER:".gallery-container-inner",CONTENT:".gallery-content",ARROW_LEFT:".gallery-arrow-left",ARROW_RIGHT:".gallery-arrow-right",CONTAINER_THUMBS:".gallery-container-thumbs",RECORDER:".gallery-recorder"},n.prototype.getContainer=function(){return this.container},n.prototype._getElement=function(e){return this.getContainer().find(e)},n.prototype.bindUIEvents=function(){this._getElement(n.Binder.ARROW_LEFT).on("click",this.bind__onClickArrowLeft),this._getElement(n.Binder.ARROW_RIGHT).on("click",this.bind__onClickArrowRight),this._getElement(n.Binder.CONTAINER_THUMBS).find("li").on("click",this.bind__onClickThumbnail),this._getMediaInfo(),this._determineBounds()},n.prototype._onClickArrowLeft=function(e){e.preventDefault();var t=this._calcSlidePosition();this._getElement(n.Binder.CONTAINER_THUMBS).animate({left:t.bound})},n.prototype._onClickArrowRight=function(e){e.preventDefault();var t=this._calcSlidePosition();this._getElement(n.Binder.CONTAINER_THUMBS).animate({left:t.bound})},n.prototype._onClickThumbnail=function(r){r.preventDefault();var i=$.grep(this.media,function(e,t){return e.id==$(r.currentTarget).data("mid")})[0],s=function(t){switch(t){case e.MEDIA_TYPE.VIDEO.id:return"mediaElementVideo";case e.MEDIA_TYPE.AUDIO.id:return"mediaElementAudio";case e.MEDIA_TYPE.IMAGE.id:return"mediaElementImage";case e.MEDIA_TYPE.OTHER.id:return"mediaElementOther"}};dust.render(s(i.type),{media:i},function(r,s){var o=this._getElement(n.Binder.CONTENT);o.html(s),i.type==e.MEDIA_TYPE.VIDEO.id&&o.find("button").on("click",function(e){this.recorder=new t({container:this._getElement(n.Binder.RECORDER),page:t.Page.INTERPRETATION,enableDoneAndPost:!0}),$(this.recorder).on(t.Event.READY,function(e){this.recorder.setSourceMedia(i),this.recorder.show()}.bind(this)),$(this.recorder).on(t.Event.DONE,function(e){this.recorder.hide(),e.doPost&&window.location.assign(Routing.generate("imdc_thread_new_from_media",{mediaId:e.media.id}))}.bind(this)),this.recorder.render()}.bind(this))}.bind(this))},n.prototype._getMediaInfo=function(){var e=[];this._getElement(n.Binder.CONTAINER_THUMBS).find("li").each(function(t,n){e.push($(n).data("mid"))}),this._getElement(n.Binder.WORKING).show(),$.ajax({url:Routing.generate("imdc_myfiles_get_info"),data:{mediaIds:e},type:"POST",success:function(e,t,r){this.media=e.media,this._getElement(n.Binder.WORKING).hide(),this._getElement(n.Binder.CONTAINER_INNER).show(),this._getElement(n.Binder.CONTAINER_THUMBS).find("li").first().click()}.bind(this),error:function(e){console.log(e.statusText)}.bind(this)})},n.prototype._determineBounds=function(){var e=this._getElement(n.Binder.CONTAINER_THUMBS),t=e.find("li");this.thumbsContainerBounds.width=this._getElement(n.Binder.CONTAINER_THUMBS).width(),this.thumbsContainerBounds.thumbWidth=t.width(),this.thumbsContainerBounds.thumbsWidth=t.length*this.thumbsContainerBounds.thumbWidth,this.thumbsContainerBounds.thumbsWidth<=this.thumbsContainerBounds.width&&(this._getElement(n.Binder.ARROW_LEFT).attr("disabled",!0).hide(),this._getElement(n.Binder.ARROW_RIGHT).attr("disabled",!0).hide())},n.prototype._getThumbsSliderPosition=function(){return parseInt(this._getElement(n.Binder.CONTAINER_THUMBS).find("ol").css("left"),10)},n.prototype._calcSlidePosition=function(e){var t=this._getThumbsSliderPosition(),n=t+this.thumbsContainerBounds.width,r;return e?r=Math.max(-this.thumbsContainerBounds.thumbsWidth,Math.min(t,n)):r=Math.min(0,Math.max(t,n)),console.log(r),{cPos:t,nPos:n,bound:r}},n}),define("main",["require","controller/myFiles","controller/forum","controller/thread","controller/post","controller/group","controller/message","controller/profile","core/mediaChooser","core/mediaManager","core/gallery","core/recorder","core/helper"],function(e){var t={};t.Controller={},t.Controller.MyFiles=e("controller/myFiles"),t.Controller.Forum=e("controller/forum"),t.Controller.Thread=e("controller/thread"),t.Controller.Post=e("controller/post"),t.Controller.Group=e("controller/group"),t.Controller.Message=e("controller/message"),t.Controller.Profile=e("controller/profile"),t.Core={},t.Core.MediaChooser=e("core/mediaChooser"),t.Core.MediaManager=e("core/mediaManager"),t.Core.Gallery=e("core/gallery"),t.Core.Recorder=e("core/recorder"),t.Core.Helper=e("core/helper"),t._instances=[],window.TerpTube=t,window.$tt=window.TerpTube,$(".autosize").autosize()}),require(["main"]);