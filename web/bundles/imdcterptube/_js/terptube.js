(function(){function e(e){function t(t,n,i,r,o,s){for(;o>=0&&s>o;o+=e){var a=r?r[o]:o;i=n(i,t[a],a,t)}return i}return function(n,i,r,o){i=y(i,o,4);var s=!k(n)&&b.keys(n),a=(s||n).length,l=e>0?0:a-1;return arguments.length<3&&(r=n[s?s[l]:l],l+=e),t(n,i,r,s,l,a)}}function t(e){return function(t,n,i){n=_(n,i);for(var r=S(t),o=e>0?0:r-1;o>=0&&r>o;o+=e)if(n(t[o],o,t))return o;return-1}}function n(e,t,n){return function(i,r,o){var s=0,a=S(i);if("number"==typeof o)e>0?s=o>=0?o:Math.max(o+a,s):a=o>=0?Math.min(o+1,a):o+a+1;else if(n&&o&&a)return o=n(i,r),i[o]===r?o:-1;if(r!==r)return o=t(d.call(i,s,a),b.isNaN),o>=0?o+s:-1;for(o=e>0?s:a-1;o>=0&&a>o;o+=e)if(i[o]===r)return o;return-1}}function i(e,t){var n=R.length,i=e.constructor,r=b.isFunction(i)&&i.prototype||a,o="constructor";for(b.has(e,o)&&!b.contains(t,o)&&t.push(o);n--;)o=R[n],o in e&&e[o]!==r[o]&&!b.contains(t,o)&&t.push(o)}var r=this,o=r._,s=Array.prototype,a=Object.prototype,l=Function.prototype,c=s.push,d=s.slice,u=a.toString,h=a.hasOwnProperty,p=Array.isArray,f=Object.keys,m=l.bind,g=Object.create,v=function(){},b=function(e){return e instanceof b?e:this instanceof b?void(this._wrapped=e):new b(e)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=b),exports._=b):r._=b,b.VERSION="1.8.3";var y=function(e,t,n){if(void 0===t)return e;switch(null==n?3:n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,i){return e.call(t,n,i)};case 3:return function(n,i,r){return e.call(t,n,i,r)};case 4:return function(n,i,r,o){return e.call(t,n,i,r,o)}}return function(){return e.apply(t,arguments)}},_=function(e,t,n){return null==e?b.identity:b.isFunction(e)?y(e,t,n):b.isObject(e)?b.matcher(e):b.property(e)};b.iteratee=function(e,t){return _(e,t,1/0)};var w=function(e,t){return function(n){var i=arguments.length;if(2>i||null==n)return n;for(var r=1;i>r;r++)for(var o=arguments[r],s=e(o),a=s.length,l=0;a>l;l++){var c=s[l];t&&void 0!==n[c]||(n[c]=o[c])}return n}},E=function(e){if(!b.isObject(e))return{};if(g)return g(e);v.prototype=e;var t=new v;return v.prototype=null,t},C=function(e){return function(t){return null==t?void 0:t[e]}},T=Math.pow(2,53)-1,S=C("length"),k=function(e){var t=S(e);return"number"==typeof t&&t>=0&&T>=t};b.each=b.forEach=function(e,t,n){t=y(t,n);var i,r;if(k(e))for(i=0,r=e.length;r>i;i++)t(e[i],i,e);else{var o=b.keys(e);for(i=0,r=o.length;r>i;i++)t(e[o[i]],o[i],e)}return e},b.map=b.collect=function(e,t,n){t=_(t,n);for(var i=!k(e)&&b.keys(e),r=(i||e).length,o=Array(r),s=0;r>s;s++){var a=i?i[s]:s;o[s]=t(e[a],a,e)}return o},b.reduce=b.foldl=b.inject=e(1),b.reduceRight=b.foldr=e(-1),b.find=b.detect=function(e,t,n){var i;return i=k(e)?b.findIndex(e,t,n):b.findKey(e,t,n),void 0!==i&&-1!==i?e[i]:void 0},b.filter=b.select=function(e,t,n){var i=[];return t=_(t,n),b.each(e,function(e,n,r){t(e,n,r)&&i.push(e)}),i},b.reject=function(e,t,n){return b.filter(e,b.negate(_(t)),n)},b.every=b.all=function(e,t,n){t=_(t,n);for(var i=!k(e)&&b.keys(e),r=(i||e).length,o=0;r>o;o++){var s=i?i[o]:o;if(!t(e[s],s,e))return!1}return!0},b.some=b.any=function(e,t,n){t=_(t,n);for(var i=!k(e)&&b.keys(e),r=(i||e).length,o=0;r>o;o++){var s=i?i[o]:o;if(t(e[s],s,e))return!0}return!1},b.contains=b.includes=b.include=function(e,t,n,i){return k(e)||(e=b.values(e)),("number"!=typeof n||i)&&(n=0),b.indexOf(e,t,n)>=0},b.invoke=function(e,t){var n=d.call(arguments,2),i=b.isFunction(t);return b.map(e,function(e){var r=i?t:e[t];return null==r?r:r.apply(e,n)})},b.pluck=function(e,t){return b.map(e,b.property(t))},b.where=function(e,t){return b.filter(e,b.matcher(t))},b.findWhere=function(e,t){return b.find(e,b.matcher(t))},b.max=function(e,t,n){var i,r,o=-1/0,s=-1/0;if(null==t&&null!=e){e=k(e)?e:b.values(e);for(var a=0,l=e.length;l>a;a++)i=e[a],i>o&&(o=i)}else t=_(t,n),b.each(e,function(e,n,i){r=t(e,n,i),(r>s||r===-1/0&&o===-1/0)&&(o=e,s=r)});return o},b.min=function(e,t,n){var i,r,o=1/0,s=1/0;if(null==t&&null!=e){e=k(e)?e:b.values(e);for(var a=0,l=e.length;l>a;a++)i=e[a],o>i&&(o=i)}else t=_(t,n),b.each(e,function(e,n,i){r=t(e,n,i),(s>r||1/0===r&&1/0===o)&&(o=e,s=r)});return o},b.shuffle=function(e){for(var t,n=k(e)?e:b.values(e),i=n.length,r=Array(i),o=0;i>o;o++)t=b.random(0,o),t!==o&&(r[o]=r[t]),r[t]=n[o];return r},b.sample=function(e,t,n){return null==t||n?(k(e)||(e=b.values(e)),e[b.random(e.length-1)]):b.shuffle(e).slice(0,Math.max(0,t))},b.sortBy=function(e,t,n){return t=_(t,n),b.pluck(b.map(e,function(e,n,i){return{value:e,index:n,criteria:t(e,n,i)}}).sort(function(e,t){var n=e.criteria,i=t.criteria;if(n!==i){if(n>i||void 0===n)return 1;if(i>n||void 0===i)return-1}return e.index-t.index}),"value")};var $=function(e){return function(t,n,i){var r={};return n=_(n,i),b.each(t,function(i,o){var s=n(i,o,t);e(r,i,s)}),r}};b.groupBy=$(function(e,t,n){b.has(e,n)?e[n].push(t):e[n]=[t]}),b.indexBy=$(function(e,t,n){e[n]=t}),b.countBy=$(function(e,t,n){b.has(e,n)?e[n]++:e[n]=1}),b.toArray=function(e){return e?b.isArray(e)?d.call(e):k(e)?b.map(e,b.identity):b.values(e):[]},b.size=function(e){return null==e?0:k(e)?e.length:b.keys(e).length},b.partition=function(e,t,n){t=_(t,n);var i=[],r=[];return b.each(e,function(e,n,o){(t(e,n,o)?i:r).push(e)}),[i,r]},b.first=b.head=b.take=function(e,t,n){return null==e?void 0:null==t||n?e[0]:b.initial(e,e.length-t)},b.initial=function(e,t,n){return d.call(e,0,Math.max(0,e.length-(null==t||n?1:t)))},b.last=function(e,t,n){return null==e?void 0:null==t||n?e[e.length-1]:b.rest(e,Math.max(0,e.length-t))},b.rest=b.tail=b.drop=function(e,t,n){return d.call(e,null==t||n?1:t)},b.compact=function(e){return b.filter(e,b.identity)};var x=function(e,t,n,i){for(var r=[],o=0,s=i||0,a=S(e);a>s;s++){var l=e[s];if(k(l)&&(b.isArray(l)||b.isArguments(l))){t||(l=x(l,t,n));var c=0,d=l.length;for(r.length+=d;d>c;)r[o++]=l[c++]}else n||(r[o++]=l)}return r};b.flatten=function(e,t){return x(e,t,!1)},b.without=function(e){return b.difference(e,d.call(arguments,1))},b.uniq=b.unique=function(e,t,n,i){b.isBoolean(t)||(i=n,n=t,t=!1),null!=n&&(n=_(n,i));for(var r=[],o=[],s=0,a=S(e);a>s;s++){var l=e[s],c=n?n(l,s,e):l;t?(s&&o===c||r.push(l),o=c):n?b.contains(o,c)||(o.push(c),r.push(l)):b.contains(r,l)||r.push(l)}return r},b.union=function(){return b.uniq(x(arguments,!0,!0))},b.intersection=function(e){for(var t=[],n=arguments.length,i=0,r=S(e);r>i;i++){var o=e[i];if(!b.contains(t,o)){for(var s=1;n>s&&b.contains(arguments[s],o);s++);s===n&&t.push(o)}}return t},b.difference=function(e){var t=x(arguments,!0,!0,1);return b.filter(e,function(e){return!b.contains(t,e)})},b.zip=function(){return b.unzip(arguments)},b.unzip=function(e){for(var t=e&&b.max(e,S).length||0,n=Array(t),i=0;t>i;i++)n[i]=b.pluck(e,i);return n},b.object=function(e,t){for(var n={},i=0,r=S(e);r>i;i++)t?n[e[i]]=t[i]:n[e[i][0]]=e[i][1];return n},b.findIndex=t(1),b.findLastIndex=t(-1),b.sortedIndex=function(e,t,n,i){n=_(n,i,1);for(var r=n(t),o=0,s=S(e);s>o;){var a=Math.floor((o+s)/2);n(e[a])<r?o=a+1:s=a}return o},b.indexOf=n(1,b.findIndex,b.sortedIndex),b.lastIndexOf=n(-1,b.findLastIndex),b.range=function(e,t,n){null==t&&(t=e||0,e=0),n=n||1;for(var i=Math.max(Math.ceil((t-e)/n),0),r=Array(i),o=0;i>o;o++,e+=n)r[o]=e;return r};var A=function(e,t,n,i,r){if(!(i instanceof t))return e.apply(n,r);var o=E(e.prototype),s=e.apply(o,r);return b.isObject(s)?s:o};b.bind=function(e,t){if(m&&e.bind===m)return m.apply(e,d.call(arguments,1));if(!b.isFunction(e))throw new TypeError("Bind must be called on a function");var n=d.call(arguments,2),i=function(){return A(e,i,t,this,n.concat(d.call(arguments)))};return i},b.partial=function(e){var t=d.call(arguments,1),n=function(){for(var i=0,r=t.length,o=Array(r),s=0;r>s;s++)o[s]=t[s]===b?arguments[i++]:t[s];for(;i<arguments.length;)o.push(arguments[i++]);return A(e,n,this,this,o)};return n},b.bindAll=function(e){var t,n,i=arguments.length;if(1>=i)throw new Error("bindAll must be passed function names");for(t=1;i>t;t++)n=arguments[t],e[n]=b.bind(e[n],e);return e},b.memoize=function(e,t){var n=function(i){var r=n.cache,o=""+(t?t.apply(this,arguments):i);return b.has(r,o)||(r[o]=e.apply(this,arguments)),r[o]};return n.cache={},n},b.delay=function(e,t){var n=d.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},b.defer=b.partial(b.delay,b,1),b.throttle=function(e,t,n){var i,r,o,s=null,a=0;n||(n={});var l=function(){a=n.leading===!1?0:b.now(),s=null,o=e.apply(i,r),s||(i=r=null)};return function(){var c=b.now();a||n.leading!==!1||(a=c);var d=t-(c-a);return i=this,r=arguments,0>=d||d>t?(s&&(clearTimeout(s),s=null),a=c,o=e.apply(i,r),s||(i=r=null)):s||n.trailing===!1||(s=setTimeout(l,d)),o}},b.debounce=function(e,t,n){var i,r,o,s,a,l=function(){var c=b.now()-s;t>c&&c>=0?i=setTimeout(l,t-c):(i=null,n||(a=e.apply(o,r),i||(o=r=null)))};return function(){o=this,r=arguments,s=b.now();var c=n&&!i;return i||(i=setTimeout(l,t)),c&&(a=e.apply(o,r),o=r=null),a}},b.wrap=function(e,t){return b.partial(t,e)},b.negate=function(e){return function(){return!e.apply(this,arguments)}},b.compose=function(){var e=arguments,t=e.length-1;return function(){for(var n=t,i=e[t].apply(this,arguments);n--;)i=e[n].call(this,i);return i}},b.after=function(e,t){return function(){return--e<1?t.apply(this,arguments):void 0}},b.before=function(e,t){var n;return function(){return--e>0&&(n=t.apply(this,arguments)),1>=e&&(t=null),n}},b.once=b.partial(b.before,2);var P=!{toString:null}.propertyIsEnumerable("toString"),R=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];b.keys=function(e){if(!b.isObject(e))return[];if(f)return f(e);var t=[];for(var n in e)b.has(e,n)&&t.push(n);return P&&i(e,t),t},b.allKeys=function(e){if(!b.isObject(e))return[];var t=[];for(var n in e)t.push(n);return P&&i(e,t),t},b.values=function(e){for(var t=b.keys(e),n=t.length,i=Array(n),r=0;n>r;r++)i[r]=e[t[r]];return i},b.mapObject=function(e,t,n){t=_(t,n);for(var i,r=b.keys(e),o=r.length,s={},a=0;o>a;a++)i=r[a],s[i]=t(e[i],i,e);return s},b.pairs=function(e){for(var t=b.keys(e),n=t.length,i=Array(n),r=0;n>r;r++)i[r]=[t[r],e[t[r]]];return i},b.invert=function(e){for(var t={},n=b.keys(e),i=0,r=n.length;r>i;i++)t[e[n[i]]]=n[i];return t},b.functions=b.methods=function(e){var t=[];for(var n in e)b.isFunction(e[n])&&t.push(n);return t.sort()},b.extend=w(b.allKeys),b.extendOwn=b.assign=w(b.keys),b.findKey=function(e,t,n){t=_(t,n);for(var i,r=b.keys(e),o=0,s=r.length;s>o;o++)if(i=r[o],t(e[i],i,e))return i},b.pick=function(e,t,n){var i,r,o={},s=e;if(null==s)return o;b.isFunction(t)?(r=b.allKeys(s),i=y(t,n)):(r=x(arguments,!1,!1,1),i=function(e,t,n){return t in n},s=Object(s));for(var a=0,l=r.length;l>a;a++){var c=r[a],d=s[c];i(d,c,s)&&(o[c]=d)}return o},b.omit=function(e,t,n){if(b.isFunction(t))t=b.negate(t);else{var i=b.map(x(arguments,!1,!1,1),String);t=function(e,t){return!b.contains(i,t)}}return b.pick(e,t,n)},b.defaults=w(b.allKeys,!0),b.create=function(e,t){var n=E(e);return t&&b.extendOwn(n,t),n},b.clone=function(e){return b.isObject(e)?b.isArray(e)?e.slice():b.extend({},e):e},b.tap=function(e,t){return t(e),e},b.isMatch=function(e,t){var n=b.keys(t),i=n.length;if(null==e)return!i;for(var r=Object(e),o=0;i>o;o++){var s=n[o];if(t[s]!==r[s]||!(s in r))return!1}return!0};var O=function(e,t,n,i){if(e===t)return 0!==e||1/e===1/t;if(null==e||null==t)return e===t;e instanceof b&&(e=e._wrapped),t instanceof b&&(t=t._wrapped);var r=u.call(e);if(r!==u.call(t))return!1;switch(r){case"[object RegExp]":case"[object String]":return""+e==""+t;case"[object Number]":return+e!==+e?+t!==+t:0===+e?1/+e===1/t:+e===+t;case"[object Date]":case"[object Boolean]":return+e===+t}var o="[object Array]"===r;if(!o){if("object"!=typeof e||"object"!=typeof t)return!1;var s=e.constructor,a=t.constructor;if(s!==a&&!(b.isFunction(s)&&s instanceof s&&b.isFunction(a)&&a instanceof a)&&"constructor"in e&&"constructor"in t)return!1}n=n||[],i=i||[];for(var l=n.length;l--;)if(n[l]===e)return i[l]===t;if(n.push(e),i.push(t),o){if(l=e.length,l!==t.length)return!1;for(;l--;)if(!O(e[l],t[l],n,i))return!1}else{var c,d=b.keys(e);if(l=d.length,b.keys(t).length!==l)return!1;for(;l--;)if(c=d[l],!b.has(t,c)||!O(e[c],t[c],n,i))return!1}return n.pop(),i.pop(),!0};b.isEqual=function(e,t){return O(e,t)},b.isEmpty=function(e){return null==e?!0:k(e)&&(b.isArray(e)||b.isString(e)||b.isArguments(e))?0===e.length:0===b.keys(e).length},b.isElement=function(e){return!(!e||1!==e.nodeType)},b.isArray=p||function(e){return"[object Array]"===u.call(e)},b.isObject=function(e){var t=typeof e;return"function"===t||"object"===t&&!!e},b.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(e){b["is"+e]=function(t){return u.call(t)==="[object "+e+"]"}}),b.isArguments(arguments)||(b.isArguments=function(e){return b.has(e,"callee")}),"function"!=typeof/./&&"object"!=typeof Int8Array&&(b.isFunction=function(e){return"function"==typeof e||!1}),b.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},b.isNaN=function(e){return b.isNumber(e)&&e!==+e},b.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"===u.call(e)},b.isNull=function(e){return null===e},b.isUndefined=function(e){return void 0===e},b.has=function(e,t){return null!=e&&h.call(e,t)},b.noConflict=function(){return r._=o,this},b.identity=function(e){return e},b.constant=function(e){return function(){return e}},b.noop=function(){},b.property=C,b.propertyOf=function(e){return null==e?function(){}:function(t){return e[t]}},b.matcher=b.matches=function(e){return e=b.extendOwn({},e),function(t){return b.isMatch(t,e)}},b.times=function(e,t,n){var i=Array(Math.max(0,e));t=y(t,n,1);for(var r=0;e>r;r++)i[r]=t(r);return i},b.random=function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))},b.now=Date.now||function(){return(new Date).getTime()};var N={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},M=b.invert(N),I=function(e){var t=function(t){return e[t]},n="(?:"+b.keys(e).join("|")+")",i=RegExp(n),r=RegExp(n,"g");return function(e){return e=null==e?"":""+e,i.test(e)?e.replace(r,t):e}};b.escape=I(N),b.unescape=I(M),b.result=function(e,t,n){var i=null==e?void 0:e[t];return void 0===i&&(i=n),b.isFunction(i)?i.call(e):i};var D=0;b.uniqueId=function(e){var t=++D+"";return e?e+t:t},b.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var F=/(.)^/,L={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},B=/\\|'|\r|\n|\u2028|\u2029/g,j=function(e){return"\\"+L[e]};b.template=function(e,t,n){!t&&n&&(t=n),t=b.defaults({},t,b.templateSettings);var i=RegExp([(t.escape||F).source,(t.interpolate||F).source,(t.evaluate||F).source].join("|")+"|$","g"),r=0,o="__p+='";e.replace(i,function(t,n,i,s,a){return o+=e.slice(r,a).replace(B,j),r=a+t.length,n?o+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":i?o+="'+\n((__t=("+i+"))==null?'':__t)+\n'":s&&(o+="';\n"+s+"\n__p+='"),t}),o+="';\n",t.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{var s=new Function(t.variable||"obj","_",o)}catch(a){throw a.source=o,a}var l=function(e){return s.call(this,e,b)},c=t.variable||"obj";return l.source="function("+c+"){\n"+o+"}",l},b.chain=function(e){var t=b(e);return t._chain=!0,t};var U=function(e,t){return e._chain?b(t).chain():t};b.mixin=function(e){b.each(b.functions(e),function(t){var n=b[t]=e[t];b.prototype[t]=function(){var e=[this._wrapped];return c.apply(e,arguments),U(this,n.apply(b,e))}})},b.mixin(b),b.each(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=s[e];b.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),"shift"!==e&&"splice"!==e||0!==n.length||delete n[0],U(this,n)}}),b.each(["concat","join","slice"],function(e){var t=s[e];b.prototype[e]=function(){return U(this,t.apply(this._wrapped,arguments))}}),b.prototype.value=function(){return this._wrapped},b.prototype.valueOf=b.prototype.toJSON=b.prototype.value,b.prototype.toString=function(){return""+this._wrapped},"function"==typeof define&&define.amd&&define("underscore",[],function(){return b})}).call(this),!function(e,t){"function"==typeof define&&define.amd&&define.amd.dust===!0?define("dust.core",[],t):"object"==typeof exports?module.exports=t():e.dust=t()}(this,function(){function getTemplate(e,t){return e?"function"==typeof e&&e.template?e.template:dust.isTemplateFn(e)?e:t!==!1?dust.cache[e]:void 0:void 0}function load(e,t,n){if(!e)return t.setError(new Error("No template or template name provided to render"));var i=getTemplate(e,dust.config.cache);return i?i(t,Context.wrap(n,i.templateName)):dust.onLoad?t.map(function(t){function i(e,i){var o;if(e)return t.setError(e);if(o=getTemplate(i,!1)||getTemplate(r,dust.config.cache),!o){if(!dust.compile)return t.setError(new Error("Dust compiler not available"));o=dust.loadSource(dust.compile(i,r))}o(t,Context.wrap(n,o.templateName)).end()}var r=e;3===dust.onLoad.length?dust.onLoad(r,n.options,i):dust.onLoad(r,i)}):t.setError(new Error("Template Not Found: "+e))}function Context(e,t,n,i,r){void 0===e||e instanceof Stack||(e=new Stack(e)),this.stack=e,this.global=t,this.options=n,this.blocks=i,this.templateName=r}function getWithResolvedData(e,t,n){return function(i){return e.push(i)._get(t,n)}}function Stack(e,t,n,i){this.tail=t,this.isObject=e&&"object"==typeof e,this.head=e,this.index=n,this.of=i}function Stub(e){this.head=new Chunk(this),this.callback=e,this.out=""}function Stream(){this.head=new Chunk(this)}function Chunk(e,t,n){this.root=e,this.next=t,this.data=[],this.flushable=!1,this.taps=n}function Tap(e,t){this.head=e,this.tail=t}var dust={version:"2.7.2"},NONE="NONE",ERROR="ERROR",WARN="WARN",INFO="INFO",DEBUG="DEBUG",EMPTY_FUNC=function(){};dust.config={whitespace:!1,amd:!1,cjs:!1,cache:!0},dust._aliases={write:"w",end:"e",map:"m",render:"r",reference:"f",section:"s",exists:"x",notexists:"nx",block:"b",partial:"p",helper:"h"},function(){var e,t,n={DEBUG:0,INFO:1,WARN:2,ERROR:3,NONE:4};"undefined"!=typeof console&&console.log?(e=console.log,t="function"==typeof e?function(){e.apply(console,arguments)}:function(){e(Array.prototype.slice.apply(arguments).join(" "))}):t=EMPTY_FUNC,dust.log=function(e,i){i=i||INFO,n[i]>=n[dust.debugLevel]&&t("[DUST:"+i+"]",e)},dust.debugLevel=NONE,"undefined"!=typeof process&&process.env&&/\bdust\b/.test(process.env.DEBUG)&&(dust.debugLevel=DEBUG)}(),dust.helpers={},dust.cache={},dust.register=function(e,t){e&&(t.templateName=e,dust.config.cache!==!1&&(dust.cache[e]=t))},dust.render=function(e,t,n){var i=new Stub(n).head;try{load(e,i,t).end()}catch(r){i.setError(r)}},dust.stream=function(e,t){var n=new Stream,i=n.head;return dust.nextTick(function(){try{load(e,i,t).end()}catch(n){i.setError(n)}}),n},dust.loadSource=function(source){return eval(source)},dust.isArray=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},dust.nextTick=function(){return function(e){setTimeout(e,0)}}(),dust.isEmpty=function(e){return 0===e?!1:dust.isArray(e)&&!e.length?!0:!e},dust.isEmptyObject=function(e){var t;if(null===e)return!1;if(void 0===e)return!1;if(e.length>0)return!1;for(t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0},dust.isTemplateFn=function(e){return"function"==typeof e&&e.__dustBody},dust.isThenable=function(e){return e&&"object"==typeof e&&"function"==typeof e.then},dust.isStreamable=function(e){return e&&"function"==typeof e.on&&"function"==typeof e.pipe},dust.filter=function(e,t,n,i){var r,o,s,a;if(n)for(r=0,o=n.length;o>r;r++)s=n[r],s.length&&(a=dust.filters[s],"s"===s?t=null:"function"==typeof a?e=a(e,i):dust.log("Invalid filter `"+s+"`",WARN));return t&&(e=dust.filters[t](e,i)),e},dust.filters={h:function(e){return dust.escapeHtml(e)},j:function(e){return dust.escapeJs(e)},u:encodeURI,uc:encodeURIComponent,js:function(e){return dust.escapeJSON(e)},jp:function(e){return JSON?JSON.parse(e):(dust.log("JSON is undefined; could not parse `"+e+"`",WARN),e)}},dust.makeBase=dust.context=function(e,t){return new Context(void 0,e,t)},Context.wrap=function(e,t){return e instanceof Context?e:new Context(e,{},{},null,t)},Context.prototype.get=function(e,t){return"string"==typeof e&&("."===e[0]&&(t=!0,e=e.substr(1)),e=e.split(".")),this._get(t,e)},Context.prototype._get=function(e,t){var n,i,r,o,s,a=this.stack||{},l=1;if(i=t[0],r=t.length,e&&0===r)o=a,a=a.head;else{if(e)a&&(a=a.head?a.head[i]:void 0);else{for(;a&&(!a.isObject||(o=a.head,n=a.head[i],void 0===n));)a=a.tail;a=void 0!==n?n:this.global&&this.global[i]}for(;a&&r>l;){if(dust.isThenable(a))return a.then(getWithResolvedData(this,e,t.slice(l)));o=a,a=a[t[l]],l++}}return"function"==typeof a?(s=function(){try{return a.apply(o,arguments)}catch(e){throw dust.log(e,ERROR),e}},s.__dustBody=!!a.__dustBody,s):(void 0===a&&dust.log("Cannot find reference `{"+t.join(".")+"}` in template `"+this.getTemplateName()+"`",INFO),a)},Context.prototype.getPath=function(e,t){return this._get(e,t)},Context.prototype.push=function(e,t,n){return void 0===e?(dust.log("Not pushing an undefined variable onto the context",INFO),this):this.rebase(new Stack(e,this.stack,t,n))},Context.prototype.pop=function(){var e=this.current();return this.stack=this.stack&&this.stack.tail,e},Context.prototype.rebase=function(e){return new Context(e,this.global,this.options,this.blocks,this.getTemplateName())},Context.prototype.clone=function(){var e=this.rebase();return e.stack=this.stack,e},Context.prototype.current=function(){return this.stack&&this.stack.head},Context.prototype.getBlock=function(e){var t,n,i;if("function"==typeof e&&(e=e(new Chunk,this).data.join("")),t=this.blocks,!t)return dust.log("No blocks for context `"+e+"` in template `"+this.getTemplateName()+"`",DEBUG),!1;for(n=t.length;n--;)if(i=t[n][e])return i;return dust.log("Malformed template `"+this.getTemplateName()+"` was missing one or more blocks."),!1},Context.prototype.shiftBlocks=function(e){var t,n=this.blocks;return e?(t=n?n.concat([e]):[e],new Context(this.stack,this.global,this.options,t,this.getTemplateName())):this},Context.prototype.resolve=function(e){var t;return"function"!=typeof e?e:(t=(new Chunk).render(e,this),t instanceof Chunk?t.data.join(""):t)},Context.prototype.getTemplateName=function(){return this.templateName},Stub.prototype.flush=function(){for(var e=this.head;e;){if(!e.flushable)return e.error?(this.callback(e.error),dust.log("Rendering failed with error `"+e.error+"`",ERROR),void(this.flush=EMPTY_FUNC)):void 0;this.out+=e.data.join(""),e=e.next,this.head=e}this.callback(null,this.out)},Stream.prototype.flush=function(){for(var e=this.head;e;){if(!e.flushable)return e.error?(this.emit("error",e.error),this.emit("end"),dust.log("Streaming failed with error `"+e.error+"`",ERROR),void(this.flush=EMPTY_FUNC)):void 0;this.emit("data",e.data.join("")),e=e.next,this.head=e}this.emit("end")},Stream.prototype.emit=function(e,t){var n,i,r=this.events||{},o=r[e]||[];if(!o.length)return dust.log("Stream broadcasting, but no listeners for `"+e+"`",DEBUG),!1;for(o=o.slice(0),n=0,i=o.length;i>n;n++)o[n](t);return!0},Stream.prototype.on=function(e,t){var n=this.events=this.events||{},i=n[e]=n[e]||[];return"function"!=typeof t?dust.log("No callback function provided for `"+e+"` event listener",WARN):i.push(t),this},Stream.prototype.pipe=function(e){if("function"!=typeof e.write||"function"!=typeof e.end)return dust.log("Incompatible stream passed to `pipe`",WARN),this;var t=!1;return"function"==typeof e.emit&&e.emit("pipe",this),"function"==typeof e.on&&e.on("error",function(){t=!0}),this.on("data",function(n){if(!t)try{e.write(n,"utf8")}catch(i){dust.log(i,ERROR)}}).on("end",function(){if(!t)try{e.end(),t=!0}catch(n){dust.log(n,ERROR)}})},Chunk.prototype.write=function(e){var t=this.taps;return t&&(e=t.go(e)),this.data.push(e),this},Chunk.prototype.end=function(e){return e&&this.write(e),this.flushable=!0,this.root.flush(),this},Chunk.prototype.map=function(e){var t=new Chunk(this.root,this.next,this.taps),n=new Chunk(this.root,t,this.taps);this.next=n,this.flushable=!0;try{e(n)}catch(i){dust.log(i,ERROR),n.setError(i)}return t},Chunk.prototype.tap=function(e){var t=this.taps;return this.taps=t?t.push(e):new Tap(e),this},Chunk.prototype.untap=function(){return this.taps=this.taps.tail,this},Chunk.prototype.render=function(e,t){return e(this,t)},Chunk.prototype.reference=function(e,t,n,i){return"function"==typeof e?(e=e.apply(t.current(),[this,t,null,{auto:n,filters:i}]),e instanceof Chunk?e:this.reference(e,t,n,i)):dust.isThenable(e)?this.await(e,t,null,n,i):dust.isStreamable(e)?this.stream(e,t,null,n,i):dust.isEmpty(e)?this:this.write(dust.filter(e,n,i,t))},Chunk.prototype.section=function(e,t,n,i){var r,o,s,a=n.block,l=n["else"],c=this;if("function"==typeof e&&!dust.isTemplateFn(e)){try{e=e.apply(t.current(),[this,t,n,i])}catch(d){return dust.log(d,ERROR),this.setError(d)}if(e instanceof Chunk)return e}if(dust.isEmptyObject(n))return c;if(dust.isEmptyObject(i)||(t=t.push(i)),dust.isArray(e)){if(a){if(o=e.length,o>0){for(s=t.stack&&t.stack.head||{},s.$len=o,r=0;o>r;r++)s.$idx=r,c=a(c,t.push(e[r],r,o));return s.$idx=void 0,s.$len=void 0,c}if(l)return l(this,t)}}else{if(dust.isThenable(e))return this.await(e,t,n);if(dust.isStreamable(e))return this.stream(e,t,n);if(e===!0){if(a)return a(this,t)}else if(e||0===e){if(a)return a(this,t.push(e))}else if(l)return l(this,t)}return dust.log("Section without corresponding key in template `"+t.getTemplateName()+"`",DEBUG),this},Chunk.prototype.exists=function(e,t,n){var i=n.block,r=n["else"];if(dust.isEmpty(e)){if(r)return r(this,t)}else{if(i)return i(this,t);dust.log("No block for exists check in template `"+t.getTemplateName()+"`",DEBUG)}return this},Chunk.prototype.notexists=function(e,t,n){var i=n.block,r=n["else"];if(dust.isEmpty(e)){if(i)return i(this,t);dust.log("No block for not-exists check in template `"+t.getTemplateName()+"`",DEBUG)}else if(r)return r(this,t);return this},Chunk.prototype.block=function(e,t,n){var i=e||n.block;return i?i(this,t):this},Chunk.prototype.partial=function(e,t,n,i){var r;return void 0===i&&(i=n,n=t),dust.isEmptyObject(i)||(n=n.clone(),r=n.pop(),n=n.push(i).push(r)),dust.isTemplateFn(e)?this.capture(e,t,function(e,t){n.templateName=e,load(e,t,n).end()}):(n.templateName=e,load(e,this,n))},Chunk.prototype.helper=function(e,t,n,i,r){var o,s=this,a=i.filters;if(void 0===r&&(r="h"),!dust.helpers[e])return dust.log("Helper `"+e+"` does not exist",WARN),s;try{return o=dust.helpers[e](s,t,n,i),o instanceof Chunk?o:("string"==typeof a&&(a=a.split("|")),dust.isEmptyObject(n)?s.reference(o,t,r,a):s.section(o,t,n,i))}catch(l){return dust.log("Error in helper `"+e+"`: "+l.message,ERROR),s.setError(l)}},Chunk.prototype.await=function(e,t,n,i,r){return this.map(function(o){e.then(function(e){o=n?o.section(e,t,n):o.reference(e,t,i,r),o.end()},function(e){var i=n&&n.error;i?o.render(i,t.push(e)).end():(dust.log("Unhandled promise rejection in `"+t.getTemplateName()+"`",INFO),o.end())})})},Chunk.prototype.stream=function(e,t,n,i,r){var o=n&&n.block,s=n&&n.error;return this.map(function(a){var l=!1;e.on("data",function(e){l||(o?a=a.map(function(n){n.render(o,t.push(e)).end()}):n||(a=a.reference(e,t,i,r)))}).on("error",function(e){l||(s?a.render(s,t.push(e)):dust.log("Unhandled stream error in `"+t.getTemplateName()+"`",INFO),l||(l=!0,a.end()))}).on("end",function(){l||(l=!0,a.end())})})},Chunk.prototype.capture=function(e,t,n){return this.map(function(i){var r=new Stub(function(e,t){e?i.setError(e):n(t,i)});e(r.head,t).end()})},Chunk.prototype.setError=function(e){return this.error=e,this.root.flush(),this};for(var f in Chunk.prototype)dust._aliases[f]&&(Chunk.prototype[dust._aliases[f]]=Chunk.prototype[f]);Tap.prototype.push=function(e){return new Tap(e,this)},Tap.prototype.go=function(e){for(var t=this;t;)e=t.head(e),t=t.tail;return e};var HCHARS=/[&<>"']/,AMP=/&/g,LT=/</g,GT=/>/g,QUOT=/\"/g,SQUOT=/\'/g;dust.escapeHtml=function(e){return"string"==typeof e||e&&"function"==typeof e.toString?("string"!=typeof e&&(e=e.toString()),HCHARS.test(e)?e.replace(AMP,"&amp;").replace(LT,"&lt;").replace(GT,"&gt;").replace(QUOT,"&quot;").replace(SQUOT,"&#39;"):e):e};var BS=/\\/g,FS=/\//g,CR=/\r/g,LS=/\u2028/g,PS=/\u2029/g,NL=/\n/g,LF=/\f/g,SQ=/'/g,DQ=/"/g,TB=/\t/g;return dust.escapeJs=function(e){return"string"==typeof e?e.replace(BS,"\\\\").replace(FS,"\\/").replace(DQ,'\\"').replace(SQ,"\\'").replace(CR,"\\r").replace(LS,"\\u2028").replace(PS,"\\u2029").replace(NL,"\\n").replace(LF,"\\f").replace(TB,"\\t"):e},dust.escapeJSON=function(e){return JSON?JSON.stringify(e).replace(LS,"\\u2028").replace(PS,"\\u2029").replace(LT,"\\u003c"):(dust.log("JSON is undefined; could not escape `"+e+"`",WARN),e)},dust}),function(e,t){"function"==typeof define&&define.amd&&define.amd.dust===!0?define("dust.parse",["dust.core"],function(e){return t(e).parse}):"object"==typeof exports?module.exports=t(require("./dust")):t(e.dust)}(this,function(e){var t=function(){function e(e,t){function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n}function t(e,t,n,i,r,o){this.message=e,this.expected=t,this.found=n,this.offset=i,this.line=r,this.column=o,this.name="SyntaxError"}function n(e){function n(){return o(Cn).line}function i(){return o(Cn).column}function r(e){throw a(e,null,Cn)}function o(t){function n(t,n,i){var r,o;for(r=n;i>r;r++)o=e.charAt(r),"\n"===o?(t.seenCR||t.line++,t.column=1,t.seenCR=!1):"\r"===o||"\u2028"===o||"\u2029"===o?(t.line++,t.column=1,t.seenCR=!0):(t.column++,t.seenCR=!1)}return Tn!==t&&(Tn>t&&(Tn=0,Sn={line:1,column:1,seenCR:!1}),n(Sn,Tn,t),Tn=t),Sn}function s(e){kn>En||(En>kn&&(kn=En,$n=[]),$n.push(e))}function a(n,i,r){function s(e){var t=1;for(e.sort(function(e,t){return e.description<t.description?-1:e.description>t.description?1:0});t<e.length;)e[t-1]===e[t]?e.splice(t,1):t++}function a(e,t){function n(e){function t(e){return e.charCodeAt(0).toString(16).toUpperCase()}return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(e){return"\\x0"+t(e)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(e){return"\\x"+t(e)}).replace(/[\u0180-\u0FFF]/g,function(e){return"\\u0"+t(e)}).replace(/[\u1080-\uFFFF]/g,function(e){return"\\u"+t(e)})}var i,r,o,s=new Array(e.length);for(o=0;o<e.length;o++)s[o]=e[o].description;return i=e.length>1?s.slice(0,-1).join(", ")+" or "+s[e.length-1]:s[0],r=t?'"'+n(t)+'"':"end of input","Expected "+i+" but "+r+" found."}var l=o(r),c=r<e.length?e.charAt(r):null;return null!==i&&s(i),new t(null!==n?n:a(i,c),i,c,r,l.line,l.column)}function l(){var e;return e=c()}function c(){var e,t,n;for(e=En,t=[],n=d();n!==z;)t.push(n),n=d();return t!==z&&(Cn=e,t=Q(t)),e=t}function d(){var e;return e=D(),e===z&&(e=F(),e===z&&(e=u(),e===z&&(e=b(),e===z&&(e=_(),e===z&&(e=v(),e===z&&(e=N())))))),e}function u(){var t,n,i,r,o,a,l,d;if(xn++,t=En,n=h(),n!==z){for(i=[],r=K();r!==z;)i.push(r),r=K();i!==z?(r=j(),r!==z?(o=c(),o!==z?(a=g(),a!==z?(l=p(),l===z&&(l=te),l!==z?(Cn=En,d=ne(n,o,a,l),d=d?ie:ee,d!==z?(Cn=t,n=re(n,o,a,l),t=n):(En=t,t=ee)):(En=t,t=ee)):(En=t,t=ee)):(En=t,t=ee)):(En=t,t=ee)):(En=t,t=ee)}else En=t,t=ee;if(t===z)if(t=En,n=h(),n!==z){for(i=[],r=K();r!==z;)i.push(r),r=K();i!==z?(47===e.charCodeAt(En)?(r=oe,En++):(r=z,0===xn&&s(se)),r!==z?(o=j(),o!==z?(Cn=t,n=ae(n),t=n):(En=t,t=ee)):(En=t,t=ee)):(En=t,t=ee)}else En=t,t=ee;return xn--,t===z&&(n=z,0===xn&&s(Z)),t}function h(){var t,n,i,r,o,a,l;if(t=En,n=B(),n!==z)if(le.test(e.charAt(En))?(i=e.charAt(En),En++):(i=z,0===xn&&s(ce)),i!==z){for(r=[],o=K();o!==z;)r.push(o),o=K();r!==z?(o=w(),o!==z?(a=f(),a!==z?(l=m(),l!==z?(Cn=t,n=de(i,o,a,l),t=n):(En=t,t=ee)):(En=t,t=ee)):(En=t,t=ee)):(En=t,t=ee)}else En=t,t=ee;else En=t,t=ee;return t}function p(){var t,n,i,r,o,a,l;if(xn++,t=En,n=B(),n!==z)if(47===e.charCodeAt(En)?(i=oe,
En++):(i=z,0===xn&&s(se)),i!==z){for(r=[],o=K();o!==z;)r.push(o),o=K();if(r!==z)if(o=w(),o!==z){for(a=[],l=K();l!==z;)a.push(l),l=K();a!==z?(l=j(),l!==z?(Cn=t,n=he(o),t=n):(En=t,t=ee)):(En=t,t=ee)}else En=t,t=ee;else En=t,t=ee}else En=t,t=ee;else En=t,t=ee;return xn--,t===z&&(n=z,0===xn&&s(ue)),t}function f(){var t,n,i,r;return t=En,n=En,58===e.charCodeAt(En)?(i=pe,En++):(i=z,0===xn&&s(fe)),i!==z?(r=w(),r!==z?(Cn=n,i=me(r),n=i):(En=n,n=ee)):(En=n,n=ee),n===z&&(n=te),n!==z&&(Cn=t,n=ge(n)),t=n}function m(){var t,n,i,r,o,a,l;if(xn++,t=En,n=[],i=En,r=[],o=K(),o!==z)for(;o!==z;)r.push(o),o=K();else r=ee;for(r!==z?(o=x(),o!==z?(61===e.charCodeAt(En)?(a=be,En++):(a=z,0===xn&&s(ye)),a!==z?(l=E(),l===z&&(l=w(),l===z&&(l=R())),l!==z?(Cn=i,r=_e(o,l),i=r):(En=i,i=ee)):(En=i,i=ee)):(En=i,i=ee)):(En=i,i=ee);i!==z;){if(n.push(i),i=En,r=[],o=K(),o!==z)for(;o!==z;)r.push(o),o=K();else r=ee;r!==z?(o=x(),o!==z?(61===e.charCodeAt(En)?(a=be,En++):(a=z,0===xn&&s(ye)),a!==z?(l=E(),l===z&&(l=w(),l===z&&(l=R())),l!==z?(Cn=i,r=_e(o,l),i=r):(En=i,i=ee)):(En=i,i=ee)):(En=i,i=ee)):(En=i,i=ee)}return n!==z&&(Cn=t,n=we(n)),t=n,xn--,t===z&&(n=z,0===xn&&s(ve)),t}function g(){var t,n,i,r,o,a,l,d;for(xn++,t=En,n=[],i=En,r=B(),r!==z?(58===e.charCodeAt(En)?(o=pe,En++):(o=z,0===xn&&s(fe)),o!==z?(a=x(),a!==z?(l=j(),l!==z?(d=c(),d!==z?(Cn=i,r=_e(a,d),i=r):(En=i,i=ee)):(En=i,i=ee)):(En=i,i=ee)):(En=i,i=ee)):(En=i,i=ee);i!==z;)n.push(i),i=En,r=B(),r!==z?(58===e.charCodeAt(En)?(o=pe,En++):(o=z,0===xn&&s(fe)),o!==z?(a=x(),a!==z?(l=j(),l!==z?(d=c(),d!==z?(Cn=i,r=_e(a,d),i=r):(En=i,i=ee)):(En=i,i=ee)):(En=i,i=ee)):(En=i,i=ee)):(En=i,i=ee);return n!==z&&(Cn=t,n=Ce(n)),t=n,xn--,t===z&&(n=z,0===xn&&s(Ee)),t}function v(){var e,t,n,i,r;return xn++,e=En,t=B(),t!==z?(n=w(),n!==z?(i=y(),i!==z?(r=j(),r!==z?(Cn=e,t=Se(n,i),e=t):(En=e,e=ee)):(En=e,e=ee)):(En=e,e=ee)):(En=e,e=ee),xn--,e===z&&(t=z,0===xn&&s(Te)),e}function b(){var t,n,i,r,o,a,l,c,d,u;if(xn++,t=En,n=B(),n!==z)if(62===e.charCodeAt(En)?(i=$e,En++):(i=z,0===xn&&s(xe)),i===z&&(43===e.charCodeAt(En)?(i=Ae,En++):(i=z,0===xn&&s(Pe))),i!==z){for(r=[],o=K();o!==z;)r.push(o),o=K();if(r!==z)if(o=En,a=x(),a!==z&&(Cn=o,a=Re(a)),o=a,o===z&&(o=R()),o!==z)if(a=f(),a!==z)if(l=m(),l!==z){for(c=[],d=K();d!==z;)c.push(d),d=K();c!==z?(47===e.charCodeAt(En)?(d=oe,En++):(d=z,0===xn&&s(se)),d!==z?(u=j(),u!==z?(Cn=t,n=Oe(i,o,a,l),t=n):(En=t,t=ee)):(En=t,t=ee)):(En=t,t=ee)}else En=t,t=ee;else En=t,t=ee;else En=t,t=ee;else En=t,t=ee}else En=t,t=ee;else En=t,t=ee;return xn--,t===z&&(n=z,0===xn&&s(ke)),t}function y(){var t,n,i,r,o;for(xn++,t=En,n=[],i=En,124===e.charCodeAt(En)?(r=Me,En++):(r=z,0===xn&&s(Ie)),r!==z?(o=x(),o!==z?(Cn=i,r=me(o),i=r):(En=i,i=ee)):(En=i,i=ee);i!==z;)n.push(i),i=En,124===e.charCodeAt(En)?(r=Me,En++):(r=z,0===xn&&s(Ie)),r!==z?(o=x(),o!==z?(Cn=i,r=me(o),i=r):(En=i,i=ee)):(En=i,i=ee);return n!==z&&(Cn=t,n=De(n)),t=n,xn--,t===z&&(n=z,0===xn&&s(Ne)),t}function _(){var t,n,i,r,o;return xn++,t=En,n=B(),n!==z?(126===e.charCodeAt(En)?(i=Le,En++):(i=z,0===xn&&s(Be)),i!==z?(r=x(),r!==z?(o=j(),o!==z?(Cn=t,n=je(r),t=n):(En=t,t=ee)):(En=t,t=ee)):(En=t,t=ee)):(En=t,t=ee),xn--,t===z&&(n=z,0===xn&&s(Fe)),t}function w(){var e,t;return xn++,e=En,t=$(),t!==z&&(Cn=e,t=Ve(t)),e=t,e===z&&(e=En,t=x(),t!==z&&(Cn=e,t=Ge(t)),e=t),xn--,e===z&&(t=z,0===xn&&s(Ue)),e}function E(){var e,t;return xn++,e=En,t=C(),t===z&&(t=k()),t!==z&&(Cn=e,t=He(t)),e=t,xn--,e===z&&(t=z,0===xn&&s(Ke)),e}function C(){var t,n,i,r;return xn++,t=En,n=k(),n!==z?(46===e.charCodeAt(En)?(i=qe,En++):(i=z,0===xn&&s(Ye)),i!==z?(r=T(),r!==z?(Cn=t,n=ze(n,r),t=n):(En=t,t=ee)):(En=t,t=ee)):(En=t,t=ee),xn--,t===z&&(n=z,0===xn&&s(We)),t}function T(){var t,n,i;if(xn++,t=En,n=[],Xe.test(e.charAt(En))?(i=e.charAt(En),En++):(i=z,0===xn&&s(Qe)),i!==z)for(;i!==z;)n.push(i),Xe.test(e.charAt(En))?(i=e.charAt(En),En++):(i=z,0===xn&&s(Qe));else n=ee;return n!==z&&(Cn=t,n=Ze(n)),t=n,xn--,t===z&&(n=z,0===xn&&s(Je)),t}function S(){var t,n,i;return xn++,t=En,45===e.charCodeAt(En)?(n=tt,En++):(n=z,0===xn&&s(nt)),n!==z?(i=T(),i!==z?(Cn=t,n=it(n,i),t=n):(En=t,t=ee)):(En=t,t=ee),xn--,t===z&&(n=z,0===xn&&s(et)),t}function k(){var e,t;return xn++,e=S(),e===z&&(e=T()),xn--,e===z&&(t=z,0===xn&&s(rt)),e}function $(){var t,n,i,r;if(xn++,t=En,n=x(),n===z&&(n=te),n!==z){if(i=[],r=P(),r===z&&(r=A()),r!==z)for(;r!==z;)i.push(r),r=P(),r===z&&(r=A());else i=ee;i!==z?(Cn=t,n=st(n,i),t=n):(En=t,t=ee)}else En=t,t=ee;if(t===z)if(t=En,46===e.charCodeAt(En)?(n=qe,En++):(n=z,0===xn&&s(Ye)),n!==z){for(i=[],r=P(),r===z&&(r=A());r!==z;)i.push(r),r=P(),r===z&&(r=A());i!==z?(Cn=t,n=at(i),t=n):(En=t,t=ee)}else En=t,t=ee;return xn--,t===z&&(n=z,0===xn&&s(ot)),t}function x(){var t,n,i,r;if(xn++,t=En,ct.test(e.charAt(En))?(n=e.charAt(En),En++):(n=z,0===xn&&s(dt)),n!==z){for(i=[],ut.test(e.charAt(En))?(r=e.charAt(En),En++):(r=z,0===xn&&s(ht));r!==z;)i.push(r),ut.test(e.charAt(En))?(r=e.charAt(En),En++):(r=z,0===xn&&s(ht));i!==z?(Cn=t,n=pt(n,i),t=n):(En=t,t=ee)}else En=t,t=ee;return xn--,t===z&&(n=z,0===xn&&s(lt)),t}function A(){var t,n,i,r,o,a;if(xn++,t=En,n=En,i=U(),i!==z){if(r=En,o=[],Xe.test(e.charAt(En))?(a=e.charAt(En),En++):(a=z,0===xn&&s(Qe)),a!==z)for(;a!==z;)o.push(a),Xe.test(e.charAt(En))?(a=e.charAt(En),En++):(a=z,0===xn&&s(Qe));else o=ee;o!==z&&(Cn=r,o=mt(o)),r=o,r===z&&(r=w()),r!==z?(o=V(),o!==z?(Cn=n,i=gt(r),n=i):(En=n,n=ee)):(En=n,n=ee)}else En=n,n=ee;return n!==z?(i=P(),i===z&&(i=te),i!==z?(Cn=t,n=vt(n,i),t=n):(En=t,t=ee)):(En=t,t=ee),xn--,t===z&&(n=z,0===xn&&s(ft)),t}function P(){var t,n,i,r,o;if(xn++,t=En,n=[],i=En,46===e.charCodeAt(En)?(r=qe,En++):(r=z,0===xn&&s(Ye)),r!==z?(o=x(),o!==z?(Cn=i,r=yt(o),i=r):(En=i,i=ee)):(En=i,i=ee),i!==z)for(;i!==z;)n.push(i),i=En,46===e.charCodeAt(En)?(r=qe,En++):(r=z,0===xn&&s(Ye)),r!==z?(o=x(),o!==z?(Cn=i,r=yt(o),i=r):(En=i,i=ee)):(En=i,i=ee);else n=ee;return n!==z?(i=A(),i===z&&(i=te),i!==z?(Cn=t,n=_t(n,i),t=n):(En=t,t=ee)):(En=t,t=ee),xn--,t===z&&(n=z,0===xn&&s(bt)),t}function R(){var t,n,i,r;if(xn++,t=En,34===e.charCodeAt(En)?(n=Et,En++):(n=z,0===xn&&s(Ct)),n!==z?(34===e.charCodeAt(En)?(i=Et,En++):(i=z,0===xn&&s(Ct)),i!==z?(Cn=t,n=Tt(),t=n):(En=t,t=ee)):(En=t,t=ee),t===z&&(t=En,34===e.charCodeAt(En)?(n=Et,En++):(n=z,0===xn&&s(Ct)),n!==z?(i=M(),i!==z?(34===e.charCodeAt(En)?(r=Et,En++):(r=z,0===xn&&s(Ct)),r!==z?(Cn=t,n=St(i),t=n):(En=t,t=ee)):(En=t,t=ee)):(En=t,t=ee),t===z))if(t=En,34===e.charCodeAt(En)?(n=Et,En++):(n=z,0===xn&&s(Ct)),n!==z){if(i=[],r=O(),r!==z)for(;r!==z;)i.push(r),r=O();else i=ee;i!==z?(34===e.charCodeAt(En)?(r=Et,En++):(r=z,0===xn&&s(Ct)),r!==z?(Cn=t,n=kt(i),t=n):(En=t,t=ee)):(En=t,t=ee)}else En=t,t=ee;return xn--,t===z&&(n=z,0===xn&&s(wt)),t}function O(){var e,t;return e=_(),e===z&&(e=v(),e===z&&(e=En,t=M(),t!==z&&(Cn=e,t=$t(t)),e=t)),e}function N(){var t,n,i,r,o,a,l,c;if(xn++,t=En,n=G(),n!==z){for(i=[],r=K();r!==z;)i.push(r),r=K();i!==z?(Cn=t,n=At(n,i),t=n):(En=t,t=ee)}else En=t,t=ee;if(t===z){if(t=En,n=[],i=En,r=En,xn++,o=L(),xn--,o===z?r=ie:(En=r,r=ee),r!==z?(o=En,xn++,a=D(),xn--,a===z?o=ie:(En=o,o=ee),o!==z?(a=En,xn++,l=F(),xn--,l===z?a=ie:(En=a,a=ee),a!==z?(l=En,xn++,c=G(),xn--,c===z?l=ie:(En=l,l=ee),l!==z?(e.length>En?(c=e.charAt(En),En++):(c=z,0===xn&&s(Pt)),c!==z?(Cn=i,r=Rt(c),i=r):(En=i,i=ee)):(En=i,i=ee)):(En=i,i=ee)):(En=i,i=ee)):(En=i,i=ee),i!==z)for(;i!==z;)n.push(i),i=En,r=En,xn++,o=L(),xn--,o===z?r=ie:(En=r,r=ee),r!==z?(o=En,xn++,a=D(),xn--,a===z?o=ie:(En=o,o=ee),o!==z?(a=En,xn++,l=F(),xn--,l===z?a=ie:(En=a,a=ee),a!==z?(l=En,xn++,c=G(),xn--,c===z?l=ie:(En=l,l=ee),l!==z?(e.length>En?(c=e.charAt(En),En++):(c=z,0===xn&&s(Pt)),c!==z?(Cn=i,r=Rt(c),i=r):(En=i,i=ee)):(En=i,i=ee)):(En=i,i=ee)):(En=i,i=ee)):(En=i,i=ee);else n=ee;n!==z&&(Cn=t,n=Ot(n)),t=n}return xn--,t===z&&(n=z,0===xn&&s(xt)),t}function M(){var t,n,i,r,o;if(xn++,t=En,n=[],i=En,r=En,xn++,o=L(),xn--,o===z?r=ie:(En=r,r=ee),r!==z?(o=I(),o===z&&(Mt.test(e.charAt(En))?(o=e.charAt(En),En++):(o=z,0===xn&&s(It))),o!==z?(Cn=i,r=Rt(o),i=r):(En=i,i=ee)):(En=i,i=ee),i!==z)for(;i!==z;)n.push(i),i=En,r=En,xn++,o=L(),xn--,o===z?r=ie:(En=r,r=ee),r!==z?(o=I(),o===z&&(Mt.test(e.charAt(En))?(o=e.charAt(En),En++):(o=z,0===xn&&s(It))),o!==z?(Cn=i,r=Rt(o),i=r):(En=i,i=ee)):(En=i,i=ee);else n=ee;return n!==z&&(Cn=t,n=Dt(n)),t=n,xn--,t===z&&(n=z,0===xn&&s(Nt)),t}function I(){var t,n;return t=En,e.substr(En,2)===Ft?(n=Ft,En+=2):(n=z,0===xn&&s(Lt)),n!==z&&(Cn=t,n=Bt()),t=n}function D(){var t,n,i,r,o,a;if(xn++,t=En,e.substr(En,2)===Ut?(n=Ut,En+=2):(n=z,0===xn&&s(Vt)),n!==z){for(i=[],r=En,o=En,xn++,e.substr(En,2)===Gt?(a=Gt,En+=2):(a=z,0===xn&&s(Kt)),xn--,a===z?o=ie:(En=o,o=ee),o!==z?(e.length>En?(a=e.charAt(En),En++):(a=z,0===xn&&s(Pt)),a!==z?(Cn=r,o=Ht(a),r=o):(En=r,r=ee)):(En=r,r=ee);r!==z;)i.push(r),r=En,o=En,xn++,e.substr(En,2)===Gt?(a=Gt,En+=2):(a=z,0===xn&&s(Kt)),xn--,a===z?o=ie:(En=o,o=ee),o!==z?(e.length>En?(a=e.charAt(En),En++):(a=z,0===xn&&s(Pt)),a!==z?(Cn=r,o=Ht(a),r=o):(En=r,r=ee)):(En=r,r=ee);i!==z?(e.substr(En,2)===Gt?(r=Gt,En+=2):(r=z,0===xn&&s(Kt)),r!==z?(Cn=t,n=Wt(i),t=n):(En=t,t=ee)):(En=t,t=ee)}else En=t,t=ee;return xn--,t===z&&(n=z,0===xn&&s(jt)),t}function F(){var t,n,i,r,o,a;if(xn++,t=En,e.substr(En,2)===Yt?(n=Yt,En+=2):(n=z,0===xn&&s(zt)),n!==z){for(i=[],r=En,o=En,xn++,e.substr(En,2)===Jt?(a=Jt,En+=2):(a=z,0===xn&&s(Xt)),xn--,a===z?o=ie:(En=o,o=ee),o!==z?(e.length>En?(a=e.charAt(En),En++):(a=z,0===xn&&s(Pt)),a!==z?(Cn=r,o=Rt(a),r=o):(En=r,r=ee)):(En=r,r=ee);r!==z;)i.push(r),r=En,o=En,xn++,e.substr(En,2)===Jt?(a=Jt,En+=2):(a=z,0===xn&&s(Xt)),xn--,a===z?o=ie:(En=o,o=ee),o!==z?(e.length>En?(a=e.charAt(En),En++):(a=z,0===xn&&s(Pt)),a!==z?(Cn=r,o=Rt(a),r=o):(En=r,r=ee)):(En=r,r=ee);i!==z?(e.substr(En,2)===Jt?(r=Jt,En+=2):(r=z,0===xn&&s(Xt)),r!==z?(Cn=t,n=Qt(i),t=n):(En=t,t=ee)):(En=t,t=ee)}else En=t,t=ee;return xn--,t===z&&(n=z,0===xn&&s(qt)),t}function L(){var t,n,i,r,o,a,l,c,d,u;if(t=En,n=B(),n!==z){for(i=[],r=K();r!==z;)i.push(r),r=K();if(i!==z)if(Zt.test(e.charAt(En))?(r=e.charAt(En),En++):(r=z,0===xn&&s(en)),r!==z){for(o=[],a=K();a!==z;)o.push(a),a=K();if(o!==z){if(a=[],l=En,c=En,xn++,d=j(),xn--,d===z?c=ie:(En=c,c=ee),c!==z?(d=En,xn++,u=G(),xn--,u===z?d=ie:(En=d,d=ee),d!==z?(e.length>En?(u=e.charAt(En),En++):(u=z,0===xn&&s(Pt)),u!==z?(c=[c,d,u],l=c):(En=l,l=ee)):(En=l,l=ee)):(En=l,l=ee),l!==z)for(;l!==z;)a.push(l),l=En,c=En,xn++,d=j(),xn--,d===z?c=ie:(En=c,c=ee),c!==z?(d=En,xn++,u=G(),xn--,u===z?d=ie:(En=d,d=ee),d!==z?(e.length>En?(u=e.charAt(En),En++):(u=z,0===xn&&s(Pt)),u!==z?(c=[c,d,u],l=c):(En=l,l=ee)):(En=l,l=ee)):(En=l,l=ee);else a=ee;if(a!==z){for(l=[],c=K();c!==z;)l.push(c),c=K();l!==z?(c=j(),c!==z?(n=[n,i,r,o,a,l,c],t=n):(En=t,t=ee)):(En=t,t=ee)}else En=t,t=ee}else En=t,t=ee}else En=t,t=ee;else En=t,t=ee}else En=t,t=ee;return t===z&&(t=v()),t}function B(){var t;return 123===e.charCodeAt(En)?(t=tn,En++):(t=z,0===xn&&s(nn)),t}function j(){var t;return 125===e.charCodeAt(En)?(t=rn,En++):(t=z,0===xn&&s(on)),t}function U(){var t;return 91===e.charCodeAt(En)?(t=sn,En++):(t=z,0===xn&&s(an)),t}function V(){var t;return 93===e.charCodeAt(En)?(t=ln,En++):(t=z,0===xn&&s(cn)),t}function G(){var t;return 10===e.charCodeAt(En)?(t=dn,En++):(t=z,0===xn&&s(un)),t===z&&(e.substr(En,2)===hn?(t=hn,En+=2):(t=z,0===xn&&s(pn)),t===z&&(13===e.charCodeAt(En)?(t=fn,En++):(t=z,0===xn&&s(mn)),t===z&&(8232===e.charCodeAt(En)?(t=gn,En++):(t=z,0===xn&&s(vn)),t===z&&(8233===e.charCodeAt(En)?(t=bn,En++):(t=z,0===xn&&s(yn)))))),t}function K(){var t;return _n.test(e.charAt(En))?(t=e.charAt(En),En++):(t=z,0===xn&&s(wn)),t===z&&(t=G()),t}function H(e){return parseInt(e.join(""),10)}function W(e){return e.concat([["line",n()],["col",i()]])}var q,Y=arguments.length>1?arguments[1]:{},z={},J={start:l},X=l,Q=function(e){var t=["body"].concat(e);return W(t)},Z={type:"other",description:"section"},ee=z,te=null,ne=function(e,t,n,i){return i&&e[1].text===i.text||r("Expected end tag for "+e[1].text+" but it was not found."),!0},ie=void 0,re=function(e,t,n){return n.push(["param",["literal","block"],t]),e.push(n,["filters"]),W(e)},oe="/",se={type:"literal",value:"/",description:'"/"'},ae=function(e){return e.push(["bodies"],["filters"]),W(e)},le=/^[#?\^<+@%]/,ce={type:"class",value:"[#?\\^<+@%]",description:"[#?\\^<+@%]"},de=function(e,t,n,i){return[e,t,n,i]},ue={type:"other",description:"end tag"},he=function(e){return e},pe=":",fe={type:"literal",value:":",description:'":"'},me=function(e){return e},ge=function(e){return e?["context",e]:["context"]},ve={type:"other",description:"params"},be="=",ye={type:"literal",value:"=",description:'"="'},_e=function(e,t){return["param",["literal",e],t]},we=function(e){return["params"].concat(e)},Ee={type:"other",description:"bodies"},Ce=function(e){return["bodies"].concat(e)},Te={type:"other",description:"reference"},Se=function(e,t){return W(["reference",e,t])},ke={type:"other",description:"partial"},$e=">",xe={type:"literal",value:">",description:'">"'},Ae="+",Pe={type:"literal",value:"+",description:'"+"'},Re=function(e){return["literal",e]},Oe=function(e,t,n,i){var r=">"===e?"partial":e;return W([r,t,n,i])},Ne={type:"other",description:"filters"},Me="|",Ie={type:"literal",value:"|",description:'"|"'},De=function(e){return["filters"].concat(e)},Fe={type:"other",description:"special"},Le="~",Be={type:"literal",value:"~",description:'"~"'},je=function(e){return W(["special",e])},Ue={type:"other",description:"identifier"},Ve=function(e){var t=["path"].concat(e);return t.text=e[1].join(".").replace(/,line,\d+,col,\d+/g,""),t},Ge=function(e){var t=["key",e];return t.text=e,t},Ke={type:"other",description:"number"},He=function(e){return["literal",e]},We={type:"other",description:"float"},qe=".",Ye={type:"literal",value:".",description:'"."'},ze=function(e,t){return parseFloat(e+"."+t)},Je={type:"other",description:"unsigned_integer"},Xe=/^[0-9]/,Qe={type:"class",value:"[0-9]",description:"[0-9]"},Ze=function(e){return H(e)},et={type:"other",description:"signed_integer"},tt="-",nt={type:"literal",value:"-",description:'"-"'},it=function(e,t){return-1*t},rt={type:"other",description:"integer"},ot={type:"other",description:"path"},st=function(e,t){return t=t[0],e&&t?(t.unshift(e),W([!1,t])):W([!0,t])},at=function(e){return W(e.length>0?[!0,e[0]]:[!0,[]])},lt={type:"other",description:"key"},ct=/^[a-zA-Z_$]/,dt={type:"class",value:"[a-zA-Z_$]",description:"[a-zA-Z_$]"},ut=/^[0-9a-zA-Z_$\-]/,ht={type:"class",value:"[0-9a-zA-Z_$\\-]",description:"[0-9a-zA-Z_$\\-]"},pt=function(e,t){return e+t.join("")},ft={type:"other",description:"array"},mt=function(e){return e.join("")},gt=function(e){return e},vt=function(e,t){return t?t.unshift(e):t=[e],t},bt={type:"other",description:"array_part"},yt=function(e){return e},_t=function(e,t){return t?e.concat(t):e},wt={type:"other",description:"inline"},Et='"',Ct={type:"literal",value:'"',description:'"\\""'},Tt=function(){return W(["literal",""])},St=function(e){return W(["literal",e])},kt=function(e){return W(["body"].concat(e))},$t=function(e){return["buffer",e]},xt={type:"other",description:"buffer"},At=function(e,t){return W(["format",e,t.join("")])},Pt={type:"any",description:"any character"},Rt=function(e){return e},Ot=function(e){return W(["buffer",e.join("")])},Nt={type:"other",description:"literal"},Mt=/^[^"]/,It={type:"class",value:'[^"]',description:'[^"]'},Dt=function(e){return e.join("")},Ft='\\"',Lt={type:"literal",value:'\\"',description:'"\\\\\\""'},Bt=function(){return'"'},jt={type:"other",description:"raw"},Ut="{`",Vt={type:"literal",value:"{`",description:'"{`"'},Gt="`}",Kt={type:"literal",value:"`}",description:'"`}"'},Ht=function(e){return e},Wt=function(e){return W(["raw",e.join("")])},qt={type:"other",description:"comment"},Yt="{!",zt={type:"literal",value:"{!",description:'"{!"'},Jt="!}",Xt={type:"literal",value:"!}",description:'"!}"'},Qt=function(e){return W(["comment",e.join("")])},Zt=/^[#?\^><+%:@\/~%]/,en={type:"class",value:"[#?\\^><+%:@\\/~%]",description:"[#?\\^><+%:@\\/~%]"},tn="{",nn={type:"literal",value:"{",description:'"{"'},rn="}",on={type:"literal",value:"}",description:'"}"'},sn="[",an={type:"literal",value:"[",description:'"["'},ln="]",cn={type:"literal",value:"]",description:'"]"'},dn="\n",un={type:"literal",value:"\n",description:'"\\n"'},hn="\r\n",pn={type:"literal",value:"\r\n",description:'"\\r\\n"'},fn="\r",mn={type:"literal",value:"\r",description:'"\\r"'},gn="\u2028",vn={type:"literal",value:"\u2028",description:'"\\u2028"'},bn="\u2029",yn={type:"literal",value:"\u2029",description:'"\\u2029"'},_n=/^[\t\x0B\f \xA0\uFEFF]/,wn={type:"class",value:"[\\t\\x0B\\f \\xA0\\uFEFF]",description:"[\\t\\x0B\\f \\xA0\\uFEFF]"},En=0,Cn=0,Tn=0,Sn={line:1,column:1,seenCR:!1},kn=0,$n=[],xn=0;if("startRule"in Y){if(!(Y.startRule in J))throw new Error("Can't start parsing from rule \""+Y.startRule+'".');X=J[Y.startRule]}if(q=X(),q!==z&&En===e.length)return q;throw q!==z&&En<e.length&&s({type:"end",description:"end of input"}),a(null,$n,kn)}return e(t,Error),{SyntaxError:t,parse:n}}();return e.parse=t.parse,t}),function(e,t){"function"==typeof define&&define.amd&&define.amd.dust===!0?define("dust.compile",["dust.core","dust.parse"],function(e,n){return t(n,e).compile}):"object"==typeof exports?module.exports=t(require("./parser").parse,require("./dust")):t(e.dust.parse,e.dust)}(this,function(e,t){function n(e){var t={};return b.filterNode(t,e)}function i(e,t){var n,i,r,o=[t[0]];for(n=1,i=t.length;i>n;n++)r=b.filterNode(e,t[n]),r&&o.push(r);return o}function r(e,t){var n,i,r,o,s=[t[0]];for(i=1,r=t.length;r>i;i++)o=b.filterNode(e,t[i]),o&&("buffer"===o[0]||"format"===o[0]?n?(n[0]="buffer"===o[0]?"buffer":n[0],n[1]+=o.slice(1,-2).join("")):(n=o,s.push(o)):(n=null,s.push(o)));return s}function o(e,t){return["buffer",_[t[1]],t[2],t[3]]}function s(e,t){return t}function a(){}function l(e,n){return t.config.whitespace?(n.splice(1,2,n.slice(1,-2).join("")),n):null}function c(e,n){var i,r={name:n,bodies:[],blocks:{},index:0,auto:"h"},o=t.escapeJs(n),s=n?'"'+o+'",':"",a="function(dust){",l=b.compileNode(r,e);return n&&(a+='dust.register("'+o+'",'+l+");"),a+=d(r)+u(r)+"return "+l+"}",i="("+a+"(dust));",t.config.amd?"define("+s+'["dust.core"],'+a+");":t.config.cjs?"module.exports=function(dust){var tmpl="+i+"var f="+v().toString()+";f.template=tmpl;return f}":i}function d(e){var t,n=[],i=e.blocks;for(t in i)n.push('"'+t+'":'+i[t]);return n.length?(e.blocks="ctx=ctx.shiftBlocks(blocks);","var blocks={"+n.join(",")+"};"):(e.blocks="",e.blocks)}function u(e){var t,n,i=[],r=e.bodies,o=e.blocks;for(t=0,n=r.length;n>t;t++)i[t]="function body_"+t+"(chk,ctx){"+o+"return chk"+r[t]+";}body_"+t+".__dustBody=!0;";return i.join("")}function h(e,t){var n,i,r="";for(n=1,i=t.length;i>n;n++)r+=b.compileNode(e,t[n]);return r}function p(e,n,i){return"."+(t._aliases[i]||i)+"("+b.compileNode(e,n[1])+","+b.compileNode(e,n[2])+","+b.compileNode(e,n[4])+","+b.compileNode(e,n[3])+")"}function f(e){return e.replace(w,"\\\\").replace(E,'\\"').replace(C,"\\f").replace(T,"\\n").replace(S,"\\r").replace(k,"\\t")}function m(e,n,i){var r=t.loadSource(t.compile(e));return v(r)(n,i)}function g(e,n){var i=t.loadSource(t.compile(e,n));return v(i)}function v(e){return function(n,i){var r=i?"render":"stream";return t[r](e,n,i)}}var b={},y=t.isArray;b.compile=function(t,i){try{var r=n(e(t));return c(r,i)}catch(o){if(!o.line||!o.column)throw o;throw new SyntaxError(o.message+" At line : "+o.line+", column : "+o.column)}},b.filterNode=function(e,t){return b.optimizers[t[0]](e,t)},b.optimizers={body:r,buffer:s,special:o,format:l,reference:i,"#":i,"?":i,"^":i,"<":i,"+":i,"@":i,"%":i,partial:i,context:i,params:i,bodies:i,param:i,filters:s,key:s,path:s,literal:s,raw:s,comment:a,line:a,col:a},b.pragmas={esc:function(e,t,n){var i,r=e.auto;return t||(t="h"),e.auto="s"===t?"":t,i=h(e,n.block),e.auto=r,i}};var _={s:" ",n:"\n",r:"\r",lb:"{",rb:"}"};b.compileNode=function(e,t){return b.nodes[t[0]](e,t)},b.nodes={body:function(e,t){var n=e.index++,i="body_"+n;return e.bodies[n]=h(e,t),i},buffer:function(e,t){return".w("+$(t[1])+")"},format:function(e,t){return".w("+$(t[1])+")"},reference:function(e,t){return".f("+b.compileNode(e,t[1])+",ctx,"+b.compileNode(e,t[2])+")"},"#":function(e,t){return p(e,t,"section")},"?":function(e,t){return p(e,t,"exists")},"^":function(e,t){return p(e,t,"notexists")},"<":function(e,t){for(var n=t[4],i=1,r=n.length;r>i;i++){var o=n[i],s=o[1][1];if("block"===s)return e.blocks[t[1].text]=b.compileNode(e,o[2]),""}return""},"+":function(e,t){return"undefined"==typeof t[1].text&&"undefined"==typeof t[4]?".b(ctx.getBlock("+b.compileNode(e,t[1])+",chk, ctx),"+b.compileNode(e,t[2])+", {},"+b.compileNode(e,t[3])+")":".b(ctx.getBlock("+$(t[1].text)+"),"+b.compileNode(e,t[2])+","+b.compileNode(e,t[4])+","+b.compileNode(e,t[3])+")"},"@":function(e,t){return".h("+$(t[1].text)+","+b.compileNode(e,t[2])+","+b.compileNode(e,t[4])+","+b.compileNode(e,t[3])+","+b.compileNode(e,t[5])+")"},"%":function(e,t){var n,i,r,o,s,a,l,c,d,u=t[1][1];if(!b.pragmas[u])return"";for(n=t[4],i={},c=1,d=n.length;d>c;c++)a=n[c],i[a[1][1]]=a[2];for(r=t[3],o={},c=1,d=r.length;d>c;c++)l=r[c],o[l[1][1]]=l[2][1];return s=t[2][1]?t[2][1].text:null,b.pragmas[u](e,s,i,o)},partial:function(e,t){return".p("+b.compileNode(e,t[1])+",ctx,"+b.compileNode(e,t[2])+","+b.compileNode(e,t[3])+")"},context:function(e,t){return t[1]?"ctx.rebase("+b.compileNode(e,t[1])+")":"ctx"},params:function(e,t){for(var n=[],i=1,r=t.length;r>i;i++)n.push(b.compileNode(e,t[i]));return n.length?"{"+n.join(",")+"}":"{}"},bodies:function(e,t){for(var n=[],i=1,r=t.length;r>i;i++)n.push(b.compileNode(e,t[i]));return"{"+n.join(",")+"}"},param:function(e,t){return b.compileNode(e,t[1])+":"+b.compileNode(e,t[2])},filters:function(e,t){for(var n=[],i=1,r=t.length;r>i;i++){var o=t[i];n.push('"'+o+'"')}return'"'+e.auto+'"'+(n.length?",["+n.join(",")+"]":"")},key:function(e,t){return'ctx.get(["'+t[1]+'"], false)'},path:function(e,t){for(var n=t[1],i=t[2],r=[],o=0,s=i.length;s>o;o++)r.push(y(i[o])?b.compileNode(e,i[o]):'"'+i[o]+'"');return"ctx.getPath("+n+", ["+r.join(",")+"])"},literal:function(e,t){return $(t[1])},raw:function(e,t){return".w("+$(t[1])+")"}};var w=/\\/g,E=/"/g,C=/\f/g,T=/\n/g,S=/\r/g,k=/\t/g,$="undefined"==typeof JSON?function(e){return'"'+f(e)+'"'}:JSON.stringify;return t.compiler=b,t.compile=t.compiler.compile,t.renderSource=m,t.compileFn=g,t.filterNode=b.filterNode,t.optimizers=b.optimizers,t.pragmas=b.pragmas,t.compileNode=b.compileNode,t.nodes=b.nodes,b}),"function"==typeof define&&define.amd&&define.amd.dust===!0&&define("dust",["require","dust.core","dust.compile"],function(e,t){return t.onLoad=function(t,n){e([t],function(){n()})},t}),!function(e,t){"function"==typeof define&&define.amd&&define.amd.dust===!0?define("dust-helpers",["dust.core"],t):"object"==typeof exports?module.exports=t(require("dustjs-linkedin")):t(e.dust)}(this,function(e){function t(t,n,i){i=i||"INFO",t=t?"{@"+t+"}: ":"",e.log(t+n,i)}function n(e){u[e]||(t(e,"Deprecation warning: "+e+" is deprecated and will be removed in a future version of dustjs-helpers","WARN"),t(null,"For help and a deprecation timeline, see https://github.com/linkedin/dustjs-helpers/wiki/Deprecated-Features#"+e.replace(/\W+/g,""),"WARN"),u[e]=!0)}function i(e){return e.stack.tail&&e.stack.tail.head&&"undefined"!=typeof e.stack.tail.head.__select__}function r(e){return i(e)&&e.get("__select__")}function o(e,t){var n,i=e.stack.head,r=e.rebase();e.stack&&e.stack.tail&&(r.stack=e.stack.tail);var o={isPending:!1,isResolved:!1,isDeferredComplete:!1,deferreds:[]};for(n in t)o[n]=t[n];return r.push({__select__:o}).push(i,e.stack.index,e.stack.of)}function s(e){var t,n;if(e.deferreds.length)for(e.isDeferredComplete=!0,t=0,n=e.deferreds.length;n>t;t++)e.deferreds[t]()}function a(e,t){return"function"==typeof t?t.toString().replace(/(^\s+|\s+$)/gm,"").replace(/\n/gm,"").replace(/,\s*/gm,", ").replace(/\)\{/gm,") {"):t}function l(e,t){return function(n,i,r,o){return c(n,i,r,o,e,t)}}function c(e,n,i,o,s,a){var l,c,u,h,p=i.block,f=i["else"],m=r(n)||{};if(m.isResolved)return e;if(o.hasOwnProperty("key"))c=o.key;else{if(!m.hasOwnProperty("key"))return t(s,"No key specified","WARN"),e;c=m.key}return h=o.type||m.type,c=d(n.resolve(c),h),u=d(n.resolve(o.value),h),a(c,u)?(m.isPending||(l=!0,m.isPending=!0),p&&(e=e.render(p,n)),l&&(m.isResolved=!0)):f&&(e=e.render(f,n)),e}function d(e,t){switch(t&&(t=t.toLowerCase()),t){case"number":return+e;case"string":return String(e);case"boolean":return e="false"===e?!1:e,Boolean(e);case"date":return new Date(e)}return e}var u={},h={tap:function(e,t,i){return n("tap"),i.resolve(e)},sep:function(e,t,n){var i=n.block;return t.stack.index===t.stack.of-1?e:i?i(e,t):e},first:function(e,t,n){return 0===t.stack.index?n.block(e,t):e},last:function(e,t,n){return t.stack.index===t.stack.of-1?n.block(e,t):e},contextDump:function(e,n,i,r){var o,s,l=n.resolve(r.to),c=n.resolve(r.key);switch(c){case"full":o=n.stack;break;default:o=n.stack.head}switch(s=JSON.stringify(o,a,2),l){case"console":t("contextDump",s);break;default:s=s.replace(/</g,"\\u003c"),e=e.write(s)}return e},math:function(e,n,i,a){var l,c=a.key,d=a.method,u=a.operand,h=a.round;if(!a.hasOwnProperty("key")||!a.method)return t("math","`key` or `method` was not provided","ERROR"),e;switch(c=parseFloat(n.resolve(c)),u=parseFloat(n.resolve(u)),d){case"mod":0===u&&t("math","Division by 0","ERROR"),l=c%u;break;case"add":l=c+u;break;case"subtract":l=c-u;break;case"multiply":l=c*u;break;case"divide":0===u&&t("math","Division by 0","ERROR"),l=c/u;break;case"ceil":case"floor":case"round":case"abs":l=Math[d](c);break;case"toint":l=parseInt(c,10);break;default:t("math","Method `"+d+"` is not supported","ERROR")}return"undefined"!=typeof l&&(h&&(l=Math.round(l)),i&&i.block?(n=o(n,{key:l}),e=e.render(i.block,n),s(r(n))):e=e.write(l)),e},select:function(e,n,i,a){var l=i.block,c={};return a.hasOwnProperty("key")&&(c.key=n.resolve(a.key)),a.hasOwnProperty("type")&&(c.type=a.type),l?(n=o(n,c),e=e.render(l,n),s(r(n))):t("select","Missing body block","WARN"),e},eq:l("eq",function(e,t){return e===t}),ne:l("ne",function(e,t){return e!==t}),lt:l("lt",function(e,t){return t>e}),lte:l("lte",function(e,t){return t>=e}),gt:l("gt",function(e,t){return e>t}),gte:l("gte",function(e,t){return e>=t}),any:function(e,n,i,o){var s=r(n);return s?s.isDeferredComplete?t("any","Must not be nested inside {@any} or {@none} block","ERROR"):e=e.map(function(e){s.deferreds.push(function(){s.isResolved&&(e=e.render(i.block,n)),e.end()})}):t("any","Must be used inside a {@select} block","ERROR"),e},none:function(e,n,i,o){var s=r(n);return s?s.isDeferredComplete?t("none","Must not be nested inside {@any} or {@none} block","ERROR"):e=e.map(function(e){s.deferreds.push(function(){s.isResolved||(e=e.render(i.block,n)),e.end()})}):t("none","Must be used inside a {@select} block","ERROR"),e},size:function(t,n,i,r){var o,s,a=r.key;if(a=n.resolve(r.key),a&&a!==!0)if(e.isArray(a))o=a.length;else if(!isNaN(parseFloat(a))&&isFinite(a))o=a;else if("object"==typeof a){o=0;for(s in a)a.hasOwnProperty(s)&&o++}else o=(a+"").length;else o=0;return t.write(o)}};for(var p in h)e.helpers[p]=h[p];return e}),!function(){function e(e,t){return e.write('<div class="tt-gallery-prev disabled gallery-prev"><i class="fa fa-chevron-left fa-3x"></i></div><div class="tt-gallery-item gallery-item"></div><div class="tt-gallery-next disabled gallery-next"><i class="fa fa-chevron-right fa-3x next"></i></div><div class="tt-gallery-carousel gallery-carousel"><div class="tt-gallery-left gallery-left"><i class="fa fa-chevron-left fa-2x"></i></div><div class="tt-gallery-thumbs gallery-thumbs"><div><ul></ul></div> </div><div class="tt-gallery-right gallery-right"><i class="fa fa-chevron-right fa-2x right"></i></div><div class="clear"></div></div><div class="tt-gallery-action gallery-action"><a title="Cut" data-action="4"><i class="fa fa-scissors fa-2x"></i></a><a title="Interpret" data-action="3"><i class="fa fa-video-camera fa-2x"></i></a><a data-action="2"><i class="fa fa-expand fa-2x"></i></a><a data-action="1"><i class="fa fa-times fa-2x"></i></a></div>')}return dust.register("gallery_common",e),e}(),!function(){function e(e,t){return e.write('<div id="').reference(t.get(["identifier"],!1),t,"h").write('" class="tt-gallery-inline gallery-inner">').partial("gallery_common",t,null).write("</div>")}return dust.register("gallery_inline",e),e}(),!function(){function e(e,t){return e.write('<div id="').reference(t.get(["identifier"],!1),t,"h").write('" class="tt-gallery-background gallery-inner"></div><div id="').reference(t.get(["identifier"],!1),t,"h").write('" class="tt-gallery-preview gallery-inner">').partial("gallery_common",t,null).write("</div>")}return dust.register("gallery_preview",e),e}(),!function(){function e(e,n){return e.section(n.get(["media"],!1),n,{block:t},null)}function t(e,t){return e.write('<li data-mid="').reference(t.getPath(!1,["data","id"]),t,"h").write('">').exists(t.get(["can_edit"],!1),t,{block:n},null).write("<div>").exists(t.getPath(!1,["data","thumbnail_path"]),t,{block:i},null).write("</div> </li>")}function n(e,t){return e.write('<span class="gallery-thumb-remove" title="Remove" data-mid="').reference(t.getPath(!1,["data","id"]),t,"h").write('"><i class="fa fa-times-circle"></i></span>')}function i(e,t){return e.write('<img src="').helper("generateUrl",t,{},{path:t.getPath(!1,["data","thumbnail_path"])}).write('" />')}return dust.register("gallery_thumbnail",e),e}(),!function(){function e(e,n){return e.helper("select",n,{block:t},{key:n.getPath(!1,["media","type"])})}function t(e,t){return e.helper("eq",t,{block:n},{value:1}).helper("eq",t,{block:d},{value:2}).helper("eq",t,{block:p},{value:0}).helper("eq",t,{block:f},{value:9})}function n(e,t){return e.exists(t.getPath(!1,["media","is_interpretation"]),t,{block:i},null).write('<video class="tt-media-video"').exists(t.get(["enable_controls"],!1),t,{block:a},null).exists(t.getPath(!1,["media","thumbnail_path"]),t,{block:l},null).write('preload="none">').section(t.getPath(!1,["media","resources"]),t,{block:c},null).write("</video>")}function i(e,t){return e.write('<video class="tt-media-pip-video"').exists(t.get(["enable_controls"],!1),t,{block:r},null).exists(t.getPath(!1,["media","source","thumbnail_path"]),t,{block:o},null).write('preload="none">').section(t.getPath(!1,["media","source","resources"]),t,{block:s},null).write("</video>")}function r(e,t){return e.write(" controls ")}function o(e,t){return e.write(' poster="').helper("generateUrl",t,{},{path:t.getPath(!1,["media","source","thumbnail_path"])}).write('" ')}function s(e,t){return e.write('<source src="').helper("generateUrl",t,{},{path:t.get(["web_path"],!1)}).write('" />')}function a(e,t){return e.write(" controls ")}function l(e,t){return e.write(' poster="').helper("generateUrl",t,{},{path:t.getPath(!1,["media","thumbnail_path"])}).write('" ')}function c(e,t){return e.write('<source src="').helper("generateUrl",t,{},{path:t.get(["web_path"],!1)}).write('" />')}function d(e,t){return e.write('<audio class="tt-media-audio"').exists(t.get(["enable_controls"],!1),t,{block:u},null).write(">").section(t.getPath(!1,["media","resources"]),t,{block:h},null).write("</audio>")}function u(e,t){return e.write(" controls")}function h(e,t){return e.write('<source src="').helper("generateUrl",t,{},{path:t.get(["web_path"],!1)}).write('" />')}function p(e,t){return e.write('<img class="img-responsive center-block tt-media-img" src="').helper("generateUrl",t,{},{path:t.getPath(!1,["media","source_resource","web_path"])}).write('" title="').reference(t.get(["title"],!1),t,"h").write('" alt="').reference(t.get(["title"],!1),t,"h").write('" />')}function f(e,t){return e.write('<div class="row"><div class="col-md-3 thumbnail text-center"><a href="').helper("generateUrl",t,{},{path:t.getPath(!1,["media","source_resource","web_path"])}).write('"><p><i class="fa fa-file fa-5x"></i></p><div>').reference(t.get(["title"],!1),t,"h").write("</div></a></div></div>")}return dust.register("media_element",e),e}(),!function(){function e(e,o){return e.write('<div class="col-md-3"><div class="thumbnail tt-grid-div-body"><div class="tt-grid-div-item"><input type="checkbox" class="table-component-item" data-mid="').reference(o.getPath(!1,["media","id"]),o,"h").write('" /></div><div class="tt-grid-div-thumbnail my-files-selector-file" data-mid="').reference(o.getPath(!1,["media","id"]),o,"h").write('" disabled><div><span class="fa-stack fa-lg"><i class="fa fa-file-o fa-stack-2x"></i><i class="fa fa-play-circle fa-stack-1x"></i></span></div></div><div class="tt-grid-div-primary"><span class="edit-title my-files-selector-file" title="').reference(o.get(["previewTitle"],!1),o,"h").write('" data-mid="').reference(o.getPath(!1,["media","id"]),o,"h").write('" data-type="text" data-title="').reference(o.get(["editTitle"],!1),o,"h").write('" disabled><i class="fa ').reference(o.getPath(!1,["mediaIcon","icon"]),o,"h").write(' fa-2x" title="').reference(o.getPath(!1,["mediaIcon","text"]),o,"h").write('"></i>').reference(o.getPath(!1,["media","title"]),o,"h").write('</span><span><button class="btn btn-default edit-title"><i class="fa fa-pencil"></i></button><div class="btn-group"><button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false"><i class="fa fa-download"></i> <span class="caret"></span></button><ul class="dropdown-menu" role="menu">').section(o.getPath(!1,["media","resources"]),o,{
block:t},null).helper("if",o,{block:n},{cond:i}).exists(o.getPath(!1,["media","source_resource"]),o,{block:r},null).write('</ul></div><a class="btn btn-default" target="_blank" href="').reference(o.get(["shareUrl"],!1),o,"h").write('" title="').reference(o.get(["shareTitle"],!1),o,"h").write('"><i class="fa fa-share-square-o"></i></a></span></div></div></div>')}function t(e,t){return e.write('<li><a href="').helper("generateUrl",t,{},{path:t.get(["web_path"],!1)}).write(' download="').reference(t.getPath(!1,["media","title"]),t,"h").write(".").reference(t.get(["path"],!1),t,"h").write('">').reference(t.get(["path"],!1),t,"h").write("</a></li>\n")}function n(e,t){return e.write('<li class="divider"></li>')}function i(e,t){return e.write("'").reference(t.getPath(!1,["media","resources"]),t,"h").write("'.length > 0 && '").reference(t.getPath(!1,["media","source_resource"]),t,"h").write("'.length")}function r(e,t){return e.write('<li><a href="').helper("generateUrl",t,{},{path:t.getPath(!1,["media","source_resource","web_path"])}).write('" download="').reference(t.getPath(!1,["media","title"]),t,"h").write(".").reference(t.getPath(!1,["media","source_resource","path"]),t,"h").write('">Original</a></li>')}return dust.register("myFilesGridElement",e),e}(),!function(){function e(e,a){return e.write('<tr><td class="tt-list-table-col-item"><input type="checkbox" class="table-component-item" data-mid="').reference(a.getPath(!1,["media","id"]),a,"h").write('" /></td><td class="tt-list-table-col-thumbnail my-files-selector-file" data-mid="').reference(a.getPath(!1,["media","id"]),a,"h").write('" disabled ><div><span class="fa-stack fa-lg"><i class="fa fa-file-o fa-stack-2x"></i><i class="fa fa-play-circle fa-stack-1x"></i></span></div></td><td class="tt-list-table-col-primary tt-myFiles-nameColumn"><span class="edit-title my-files-selector-file" title="').reference(a.get(["previewTitle"],!1),a,"h").write('" data-mid="').reference(a.getPath(!1,["media","id"]),a,"h").write('" data-type="text" data-title="').reference(a.get(["editTitle"],!1),a,"h").write('" disabled >').reference(a.getPath(!1,["media","title"]),a,"h").write('</span><span><button class="btn btn-default edit-title"><i class="fa fa-pencil"></i></button><div class="btn-group"><button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false"><i class="fa fa-download"></i> <span class="caret"></span></button><ul class="dropdown-menu" role="menu">').section(a.getPath(!1,["media","resources"]),a,{block:t},null).helper("if",a,{block:n},{cond:i}).exists(a.getPath(!1,["media","source_resource"]),a,{block:r},null).write('</ul></div><a class="btn btn-default" target="_blank" href="').reference(a.get(["shareUrl"],!1),a,"h").write('" title="').reference(a.get(["shareTitle"],!1),a,"h").write('"><i class="fa fa-share-square-o"></i></a></span></td><td>').reference(a.get(["timeUploaded"],!1),a,"h").write('</td><td><i class="fa ').reference(a.getPath(!1,["mediaIcon","icon"]),a,"h").write(' fa-2x" title="').reference(a.getPath(!1,["mediaIcon","text"]),a,"h").write('"></i></td><td>').exists(a.get(["spinner"],!1),a,{"else":o,block:s},null).write("</td></tr>")}function t(e,t){return e.write('<li><a href="').helper("generateUrl",t,{},{path:t.get(["web_path"],!1)}).write(' download="').reference(t.getPath(!1,["media","title"]),t,"h").write(".").reference(t.get(["path"],!1),t,"h").write('">').reference(t.get(["path"],!1),t,"h").write("</a></li>\n")}function n(e,t){return e.write('<li class="divider"></li>')}function i(e,t){return e.write("'").reference(t.getPath(!1,["media","resources"]),t,"h").write("'.length > 0 && '").reference(t.getPath(!1,["media","source_resource"]),t,"h").write("'.length")}function r(e,t){return e.write('<li><a href="').helper("generateUrl",t,{},{path:t.getPath(!1,["media","source_resource","web_path"])}).write('" download="').reference(t.getPath(!1,["media","title"]),t,"h").write(".").reference(t.getPath(!1,["media","source_resource","path"]),t,"h").write('">Original</a></li>')}function o(e,t){return e.reference(t.get(["formattedSize"],!1),t,"h")}function s(e,t){return e.write('<i class="fa fa-spinner fa-spin fa-large"> </i>')}return dust.register("myFilesListElement",e),e}(),!function(){function e(e,t){return e.write('<div class="modal fade my-files-selector-modal"><div class="modal-dialog" style="width: 80%;"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button><h4 class="modal-title">Select from My Files</h4></div><div class="modal-body"><div class="text-center"><i class="fa fa-spinner fa-4x fa-spin"></i></div></div><div class="modal-footer"><a class="btn btn-default" data-dismiss="modal"><i class="fa fa-times"></i> Cancel</a><a class="btn btn-primary my-files-selector-select-selected" disabled="disabled" data-loading-text="<i class=&quot;fa fa-spinner fa-spin&quot;></i> Downloading data..."><i class="fa fa-check"></i> Select</a></div></div></div></div>')}return dust.register("myFilesSelector",e),e}(),!function(){function e(e,t){return t=t.shiftBlocks(r),e.partial("post_view",t,null)}function t(e,t){return t=t.shiftBlocks(r),e.write('<div class="row"><div class="col-md-12">').reference(t.get(["form"],!1),t,"h",["s"]).write("</div></div>")}function n(e,t){return t=t.shiftBlocks(r),e}function i(e,t){return t=t.shiftBlocks(r),e}dust.register("post_edit",e);var r={post_content:t,post_tools:n,post_reply:i};return e}(),!function(){function e(e,s){return e.write('<div class="row post-container').exists(s.get(["is_post_reply"],!1),s,{block:t},null).write('" data-pid="').reference(s.get(["id"],!1),s,"h").write('"><div class="').exists(s.get(["is_post_reply"],!1),s,{"else":n,block:i},null).write('">').exists(s.get(["is_post_reply"],!1),s,{block:r},null).reference(s.get(["form"],!1),s,"h",["s"]).exists(s.get(["is_post_reply"],!1),s,{block:o},null).write("</div></div>")}function t(e,t){return e.write(' tt-post-container tt-post-reply-container" style="margin-bottom: 15px;')}function n(e,t){return e.write("col-md-12")}function i(e,t){return e.write("col-md-offset-1 col-md-11")}function r(e,t){return e.write('<div class="row tt-post-container-inner tt-post-reply-container-inner"><div class="col-md-12">')}function o(e,t){return e.write("</div></div>")}return dust.register("post_new",e),e}(),!function(){function e(e,a){return e.write('<div class="row post-container tt-post-container').exists(a.get(["is_post_reply"],!1),a,{block:t},null).write('" style="margin-bottom: 15px;" data-pid="').reference(a.get(["id"],!1),a,"h").write('"').exists(a.get(["is_post_reply"],!1),a,{block:n},null).write('><div class="').exists(a.get(["is_post_reply"],!1),a,{"else":i,block:r},null).write('"><div class="row tt-post-container-inner').exists(a.get(["is_post_reply"],!1),a,{block:o},null).write('"><div class="col-md-2 text-center"><div class="row"><div class="col-md-12">').partial("user_avatar",a,{user:a.get(["author"],!1)}).partial("user_username",a,{user:a.get(["author"],!1)}).write('</div></div><div class="row"><div class="col-md-12">').partial("user_connect_tools",a,{user:a.get(["author"],!1)}).write('</div></div></div><div class="col-md-9 tt-post-content-container">').block(a.getBlock("post_content"),a,{block:s},null).write('</div><div class="col-md-1 pull-right">').block(a.getBlock("post_tools"),a,{block:d},null).write("</div></div>").notexists(a.get(["is_post_reply"],!1),a,{block:h},null).write("</div></div>")}function t(e,t){return e.write(" tt-post-reply-container")}function n(e,t){return e.write(' data-ppid="').reference(t.get(["parent_post_id"],!1),t,"h").write('"')}function i(e,t){return e.write("col-md-12")}function r(e,t){return e.write("col-md-offset-1 col-md-11")}function o(e,t){return e.write(" tt-post-reply-container-inner")}function s(e,t){return e.write('<div class="row"><div class="col-md-12"><div class="text-right tt-date">').reference(t.get(["created"],!1),t,"h").exists(t.get(["edited_by"],!1),t,{block:a},null).write('</div></div><div class="col-md-12">').exists(t.get(["is_temporal"],!1),t,{block:l},null).helper("gt",t,{block:c},{key:t.getPath(!1,["ordered_media","length"]),value:0}).write("<div><p>").reference(t.get(["content"],!1),t,"h",["nl2br","s"]).write("</p></div></div></div>")}function a(e,t){return e.write("(edited ").reference(t.get(["edited_at"],!1),t,"h").write(" by ").reference(t.getPath(!1,["edited_by","username"]),t,"h").write(")")}function l(e,t){return e.write('<div class="tt-post-timeline-container"><div class="tt-post-timeline"><div class="tt-post-timeline-keypoint post-timeline-keypoint"></div></div></div>')}function c(e,t){return e.write('<div class="row"><div class="col-md-12"><div class="post-gallery" style="margin-bottom: 10px; height: 400px; width: 100%;"></div></div></div>')}function d(e,t){return e.write('<ul class="list-unstyled">').exists(t.get(["is_temporal"],!1),t,{block:u},null).write('<li><a class="post-edit" href="#" title="Edit this post"><i class="fa fa-pencil"></i></a></li><li><a href="#" title="Delete this post" data-toggle="modal" data-target=".post-delete-modal[data-pid=').reference(t.get(["id"],!1),t,"h").write(']"><i class="fa fa-trash-o"></i></a></li></ul><div class="modal fade post-delete-modal" data-pid="').reference(t.get(["id"],!1),t,"h").write('"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button><h4 class="modal-title">Delete this post</h4></div><div class="modal-body text-center"><p>This post will be permanently deleted.<br />This action cannot be undone.<br />Are you sure?</p></div><div class="modal-footer"><a class="btn btn-default" data-dismiss="modal"><i class="fa fa-times"></i> Cancel</a><a class="btn btn-danger post-delete" data-loading-text="<i class=&quot;fa fa-spinner fa-spin&quot;></i> Deleting..."><i class="fa fa-trash-o"></i> Delete</a></div></div></div></div>')}function u(e,t){return e.write('<li><a class="post-timeline-keypoint" href="#" title="Jump to selected timeline region"><i class="fa fa-clock-o"></i></a></li>')}function h(e,t){return e.block(t.getBlock("post_reply"),t,{block:p},null)}function p(e,t){return e.write('<div class="row"><div class="col-md-1 col-md-offset-11"><p><a class="post-new" href="#" title="Reply to this post"><i class="fa fa-reply fa-rotate-180 fa-lg"></i></a></p></div></div>')}return dust.register("post_view",e),e}(),!function(){function e(e,t){return e.write('<div class="modal fade recorder-modal"><div class="modal-dialog modal-lg"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button><h4 class="modal-title">Recorder</h4></div><div class="modal-body"><ul class="nav nav-tabs" role="tablist"><li class="active"><a href=".recorder-normal" role="tab" data-toggle="tab">Normal</a></li><li><a href=".recorder-interp" role="tab" data-toggle="tab">Interpretation</a></li></ul><div class="tab-content" style="padding-top: 15px;"><div class="tab-pane active recorder-normal recorder-container-record"><div class="tt-media-preview-title"><input class="recorder-normal-title" type="text" value="My Recording"/></div><video class="recorder-normal-video" width="100%" preload="auto" muted="muted"></video></div><div class="tab-pane recorder-interp recorder-container-record"><div style="border: 2px dashed #ccc; line-height: 200px; height: 200px; text-align: center; display: none;"><button class="btn btn-primary btn-lg recorder-interp-select">Select a video to interpret</button></div><div class="row recorder-interp-main" style="display: none;"><div class="col-md-offset-6 col-md-6"><div class="tt-media-preview-title"><input class="recorder-interp-title" type="text" value="My Recording"/></div></div><div class="col-md-6"><video class="recorder-interp-video-p" width="100%" preload="auto"muted="muted"></video></div><div class="col-md-6"><video class="recorder-interp-video-r" width="100%" preload="auto"muted="muted"></video></div></div></div><div class="recorder-controls recorder-container-record"></div><div class="recorder-container-upload" style="display: none;"><label>Uploading...</label><div class="progress"><div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0"aria-valuemax="100" style="width: 0%;">0%</div></div></div></div></div></div></div></div>')}return dust.register("recorder",e),e}(),!function(){function e(e,n){return e.section(n.get(["resources"],!1),n,{block:t},null)}function t(e,t){return e.write('<source src="').helper("generateUrl",t,{},{path:t.get(["web_path"],!1)}).write('" />')}return dust.register("recorder_source",e),e}(),!function(){function e(e,i){return e.write('<div class="row"><div class="col-md-12">').section(i.get(["posts"],!1),i,{"else":t,block:n},null).write('<div class="thread-reply-spacer"></div></div></div>')}function t(e,t){return e.write('<div class="lead text-center" style="padding-top: 30px;">No replies yet!</div>')}function n(e,t){return e.notexists(t.get(["is_post_reply"],!1),t,{block:i},null)}function i(e,t){return e.partial("post_view",t,{post:t.getPath(!0,[])}).section(t.get(["replies"],!1),t,{block:r},null)}function r(e,t){return e.partial("post_view",t,{post:t.getPath(!0,[])})}return dust.register("thread_view_posts",e),e}(),!function(){function e(e,n){return e.section(n.get(["user"],!1),n,{block:t},null)}function t(e,t){return e.write('<a href="').helper("generateRouteUrl",t,{},{name:"imdc_profile_user",str_params:"userName:username"}).write('"><img class="img-responsive center-block tt-avatar" src="').exists(t.getPath(!1,["profile","avatar"]),t,{"else":n,block:i},null).write('" /></a>')}function n(e,t){return e.helper("generateUrl",t,{},{path:"bundles/imdcterptube/img/no_avatar.jpg"})}function i(e,t){return e.helper("generateUrl",t,{},{path:t.getPath(!1,["profile","avatar","source_resource","web_path"])})}return dust.register("user_avatar",e),e}(),!function(){function e(e,n){return e.section(n.get(["user"],!1),n,{block:t},null)}function t(e,t){return e.write('<ul class="list-unstyled list-inline"><li>').helper("isLoggedInUser",t,{"else":n,block:i},{id:t.get(["id"],!1)}).write("</li>&nbsp; <!-- match spaces that are still present between tags when rendering from twig --><li>").helper("isLoggedInUser",t,{"else":r,block:a},{id:t.get(["id"],!1)}).write("</li>").helper("isNotLoggedInUser",t,{block:l},{id:t.get(["id"],!1)}).write("</ul>")}function n(e,t){return e.write('<a href="').helper("generateRouteUrl",t,{},{name:"imdc_message_new",str_params:"userid:username"}).write('" title="Send a message to ').reference(t.get(["username"],!1),t,"h").write('"><i class="fa fa-envelope-o"></i></a>')}function i(e,t){return e.write('<i class="fa fa-envelope-o" style="color: lightgray;"></i>')}function r(e,t){return e.helper("isInUserOnList",t,{"else":o,block:s},{list:"Friends",username:t.get(["username"],!1)})}function o(e,t){return e.write('<a href="').helper("generateRouteUrl",t,{},{name:"imdc_member_friend_add",str_params:"userid:id"}).write('" title="Click to add ').reference(t.get(["username"],!1),t,"h").write(' to your friends list"><i class="fa fa-plus"></i></a>')}function s(e,t){return e.write('<a href="').helper("generateRouteUrl",t,{},{name:"imdc_member_friend_remove",str_params:"userid:id"}).write('" title="Remove ').reference(t.get(["username"],!1),t,"h").write(' from your friends list"><i class="fa fa-minus"></i></a>')}function a(e,t){return e.write('<i class="fa fa-user" style="color: lightgray;" title="This is you"></i>')}function l(e,t){return e.write("&nbsp;<li>").helper("isInUserOnList",t,{"else":c,block:h},{list:"Mentor",username:t.get(["username"],!1)}).write("</li>&nbsp;<li>").helper("isInUserOnList",t,{"else":p,block:g},{list:"Mentee",username:t.get(["username"],!1)}).write("</li>")}function c(e,t){return e.helper("isInUserOnList",t,{"else":d,block:u},{list:"InvitedMentor",username:t.get(["username"],!1)})}function d(e,t){return e.write('<a href="').helper("generateRouteUrl",t,{},{name:"imdc_invitation_mentor",str_params:"id:id"}).write('" title="Invite user to be your mentor"><i class="fa fa-inbox"></i></a>')}function u(e,t){return e.write('<i class="fa fa-inbox" title="Invitation for mentorship already sent"></i>')}function h(e,t){return e.write('<i class="fa fa-star" title="This user is your mentor"></i>')}function p(e,t){return e.helper("isInUserOnList",t,{"else":f,block:m},{list:"InvitedMentee",username:t.get(["username"],!1)})}function f(e,t){return e.write('<a href="').helper("generateRouteUrl",t,{},{name:"imdc_invitation_mentee",str_params:"id:id"}).write('" title="Invite user to be your mentee"><i class="fa fa-star-o"></i></a>')}function m(e,t){return e.write('<i class="fa fa-star-o" title="Invitation for menteeship already sent"></i>')}function g(e,t){return e.write('<i class="fa fa-star" title="This user is your mentee"></i>')}return dust.register("user_connect_tools",e),e}(),!function(){function e(e,n){return e.section(n.get(["user"],!1),n,{block:t},null)}function t(e,t){return e.write('<a href="').helper("generateRouteUrl",t,{},{name:"imdc_profile_user",str_params:"userName:username"}).write('" title="').reference(t.get(["username"],!1),t,"h").write('">').reference(t.get(["username"],!1),t,"h").write("</a>")}return dust.register("user_username",e),e}(),define("templates",["dust-helpers"],function(){}),Function.prototype.extend=function(){return function(e){var t=this;Object.keys(e).forEach(function(n){var i=e[n];_.isObject(i)?t[n]=_.clone(i):t[n]=i}),this.prototype=Object.create(e.prototype),this.prototype.constructor=this}}(),define("extra",function(){}),define("bootstrap",["underscore"],function(){var e=function(e,t,n,i){_.isString(t)&&(t=require("controller/"+t+"Controller")),_.isString(n)&&(n=require("views/"+n+"View"));var r=new t(e,i),o=new n(r,i);_.isFunction(o.loadView)&&o.loadView(),r.onViewLoaded()};return e}),define("service",["require"],function(e){var t=function(){};return t.get=function(t){if(!$tt._services[t]){var n=e("service/"+t+"Service");$tt._services[t]=new n}return $tt._services[t]},t}),define("core/helper",[],function(){var e=function(){};return e.TAG="Helper",e.MEDIA_TYPE_IMAGE=0,e.MEDIA_TYPE_VIDEO=1,e.MEDIA_TYPE_AUDIO=2,e.MEDIA_TYPE_OTHER=9,e.isFullscreen=function(){return document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement?!0:!1},e.toggleFullScreen=function(t){console.log("%s: %s",e.TAG,"toggleFullScreen");var n=t[0];e.isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen():n.requestFullscreen?n.requestFullscreen():n.mozRequestFullScreen?n.mozRequestFullScreen():n.webkitRequestFullscreen?n.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT):n.msRequestFullscreen&&n.msRequestFullscreen()},e.updateProgressBar=function(e,t){var n=e.find(".progress-bar");n.attr("aria-valuenow",t),n.css("width",t+"%"),n.html(t+"%")},e.generateUrl=function(e,t){if(e.indexOf("://")>0||0==e.indexOf("blob:"))return e;t="undefined"!=typeof t?t:!1;var n=Routing.getBaseUrl()+"/";return t?n+e:n.replace(/\w+\.php\/$/gi,"")+e},e.formatSize=function(e){return-1==e?e:(Number(e)/1024/1024).toFixed(2)+" MB"},e.getTimeDateString=function(e){var t=new Date(e),n="am";t.getHours()>11&&(n="pm");var i=t.getHours()%12,r=t.getMinutes();0==i&&(i=12),10>i&&(i="0"+i),10>r&&(r="0"+r);var o=t.toDateString();return o=o.substring(o.indexOf(" ")+1),o+" "+i+":"+r+" "+n},e.getIconForMediaType=function(t){var n,i;switch(t){case e.MEDIA_TYPE_IMAGE:n="fa-file-photo-o",i="Image";break;case e.MEDIA_TYPE_VIDEO:n="fa-file-video-o",i="Video";break;case e.MEDIA_TYPE_AUDIO:n="fa-file-audio-o",i="Audio";break;case e.MEDIA_TYPE_OTHER:n="fa-file-o",i="Other"}return{icon:n,text:i}},e.autoSize=function(){$(".autosize").autosize({append:""})},e}),define("core/subscriber",["underscore"],function(){var e=function(){this.subscriptions={}};return e.prototype._dispatch=function(e,t){var n={type:e};!_.isObject(t)||_.isArray(t)||_.isFunction(t)||_.each(t,function(e,t,i){n[t]=e}),_.each(this.subscriptions[e],function(e,t,i){_.isFunction(e)&&e.call(this,n)},this)},e.prototype.subscribe=function(e,t){_.has(this.subscriptions,e)||(this.subscriptions[e]=[]),_.contains(this.subscriptions[e],t)||this.subscriptions[e].push(t)},e.prototype.unsubscribe=function(e){_.each(this.subscriptions,function(t,n,i){if(_.contains(t,e)){var r=_.indexOf(t,e);t.splice(r,1)}})},e}),define("factory/contactFactory",[],function(){var e={};return e["delete"]=function(e,t){var n=$.Deferred(),i={method:"DELETE",url:Routing.generate("imdc_delete_contact"),data:{userIds:e,contactList:t}};return $.ajax(i).then(function(e,t,i){n.resolve(e)},function(e,t,i){console.log(e.responseText),n.reject(e.responseJSON)}),n.promise()},e}),define("factory/forumFactory",[],function(){var e={};return e["delete"]=function(e){var t=$.Deferred(),n={method:"DELETE",url:Routing.generate("imdc_delete_forum",{forumId:e.get("id")})};return $.ajax(n).then(function(e,n,i){t.resolve(e)},function(e,n,i){console.log(e.responseText),t.reject(e.responseJSON)}),t.promise()},e}),define("factory/groupFactory",[],function(){var e={};return e["delete"]=function(e){var t=$.Deferred(),n={method:"DELETE",url:Routing.generate("imdc_delete_user_group",{groupId:e.get("id")})};return $.ajax(n).then(function(e,n,i){t.resolve(e)},function(e,n,i){console.log(e.responseText),t.reject(e.responseJSON)}),t.promise()},e}),define("model/model",["core/subscriber","extra","underscore"],function(e){var t=function(t){if(e.prototype.constructor.apply(this),t=t||{},!_.isObject(t)||_.isArray(t)||_.isFunction(t))throw new Error("data must be an object");this.data=t};return t.extend(e),t.Event={CHANGE:"eventChange"},t._stringToKeyPath=function(e){return e.split(".")},t.prototype._findKeyPath=function(e,n){for(var i=t._stringToKeyPath(n);0!==i.length;){var r=i.shift(),o=parseInt(r,10);if(r=_.isNumber(o)&&!_.isNaN(o)?o:r,!(_.isObject(e)&&_.has(e,r)&&e.hasOwnProperty(r)||_.isArray(e)&&_.contains(e,r)&&void 0!==e[r]))return void 0;e=e[r]}return e},t.prototype._setKeyPath=function(e,n,i){for(var r=t._stringToKeyPath(n);r.length>1;){var o=r.shift(),s=parseInt(o,10);if(o=_.isNumber(s)&&!_.isNaN(s)?s:o,_.isObject(e)&&!_.has(e,o)&&!e.hasOwnProperty(o)||_.isArray(e)&&!_.contains(e,o)&&void 0===e[o]||_.isNull(e[o])){console.log("defining key: "+o);var a=parseInt(r[0],10);e[o]=_.isNumber(a)&&!_.isNaN(a)?[]:{}}e=e[o]}e[r.shift()]=i},t.prototype._dispatch=function(t,n,i){i=_.extend(i||{},{keyPath:n||"",model:this}),e.prototype._dispatch.call(this,t,i)},t.prototype.get=function(e,t){var n=this._findKeyPath(this.data,e);return"undefined"!=typeof n?n:t},t.prototype.set=function(e,n,i){i="undefined"!=typeof i?i:!0;var r=this._findKeyPath(this.data,e);this._setKeyPath(this.data,e,n),i&&r!==n&&this._dispatch(t.Event.CHANGE,e)},t.prototype.update=function(e,t){_.each(e,function(e,n,i){var r=t?t+"."+n:n;_.isObject(e)||_.isArray(e)?(console.log("update: "+r),this.update(e,r)):(console.log("set: "+r+" to:"+e),this.set(r,e))},this)},t.prototype.forceChange=function(e,n){this._dispatch(t.Event.CHANGE,e,n)},t.prototype.find=function(e,t,n){return _.findIndex(n,function(n){return n.get(t)==e})},t}),define("model/mediaModel",["model/model","extra"],function(e){var t=function(t){e.prototype.constructor.apply(this,arguments)};return t.extend(e),t}),define("factory/mediaFactory",["model/mediaModel","underscore"],function(e){var t={};return t.list=function(t){var n=$.Deferred(),i={url:Routing.generate("imdc_cget_media"),data:{}};return t&&(i.data.id=t.join()),$.ajax(i).then(function(t,i,r){t.media.forEach(function(t,n,i){i[n]=new e(t)}),n.resolve(t)},function(e,t,i){console.log(e.responseText),n.reject(e.responseJSON)}),n.promise()},t.get=function(t){var n=$.Deferred(),i=_.isObject(t),r=i?t.get("id"):t,o={url:Routing.generate("imdc_get_media",{mediaId:r})};return $.ajax(o).then(function(r,o,s){i?(t.update(r.media),r.media=t):r.media=new e(r.media),n.resolve(r)},function(e,t,i){console.log(e.responseText),n.reject(e.responseJSON)}),n.promise()},t.edit=function(e){var t=$.Deferred(),n={method:"PUT",url:Routing.generate("imdc_edit_media",{mediaId:e.get("id")}),data:{media:JSON.stringify(e.data)}};return $.ajax(n).then(function(n,i,r){e.update(n.media),n.media=e,t.resolve(n)},function(e,n,i){console.log(e.responseText),t.reject(e.responseJSON)}),t.promise()},t["delete"]=function(e,t){var n=$.Deferred(),i={method:"DELETE",url:Routing.generate("imdc_delete_media",{mediaId:e.get("id")}),data:{confirm:t||!1}};return $.ajax(i).then(function(e,t,i){n.resolve(e)},function(e,t,i){console.log(e.responseText);var r=e.responseJSON,o=[];r.in_use.forEach(function(e,t,n){o.push(Translator.trans("filesGateway.deleteMediaInUseConfirmation."+e))}),r.confirmText=Translator.trans("filesGateway.deleteMediaInUseConfirmation.finalMessage",{mediaUsedLocations:o.join(", ")}),n.reject(r)}),n.promise()},t.trim=function(t,n,i){var r=$.Deferred(),o={method:"PATCH",url:Routing.generate("imdc_trim_media",{mediaId:t.get("id")}),data:{startTime:n,endTime:i}};return $.ajax(o).then(function(n,i,o){t=new e(n.media),r.resolve(n)},function(e,t,n){console.log(e.responseText),r.reject(e.responseJSON)}),r.promise()},t}),define("factory/messageFactory",[],function(){var e={};return e.edit=function(e){var t=$.Deferred(),n={method:"POST",url:Routing.generate("imdc_message_mark_as_read",{messageid:e.get("id")})};return $.ajax(n).then(function(e,n,i){e.wasEdited?t.resolve(e):t.reject(e)},function(e,n,i){console.log(e.responseText),t.reject(e.responseJSON)}),t.promise()},e}),define("factory/myFilesFactory",["model/mediaModel"],function(e){var t={};return t._prepForFormSubmit=function(e,t,n){t.type="POST",t.contentType=!1,e&&(t.data=new FormData(e)),t.processData=!1,t.xhr=function(){var e=$.ajaxSettings.xhr();return e.upload.addEventListener("progress",function(e){e.lengthComputable&&n.notify(Math.floor(e.loaded/e.total*100))},!1),e}},t.addRecording=function(n){var i=new FormData,r=!!navigator.mozGetUserMedia,o=$.Deferred(),s={url:Routing.generate("imdc_myfiles_add_recording")};return i.append("isFirefox",r),r||i.append("video-blob",n.video),i.append("audio-blob",n.audio),i.append("title",n.title),i.append("isInterpretation",n.isInterpretation),i.append("sourceStartTime",n.sourceStartTime),i.append("sourceId",n.sourceId),t._prepForFormSubmit(null,s,o),s.data=i,$.ajax(s).then(function(t,n,i){200==t.responseCode?(t.media=new e(t.media),o.resolve(t)):o.reject(t)},function(e,t,n){console.log(e.responseText),o.reject()}),o.promise()},t.add=function(n){var i=$.Deferred(),r={url:Routing.generate("imdc_myfiles_add")};return t._prepForFormSubmit(n,r,i),$.ajax(r).then(function(t,n,r){t.wasUploaded?(t.media=new e(t.media),i.resolve(t)):(console.error(t.error),i.reject(t))},function(e,t,n){console.log(e.responseText),i.reject()}),i.promise()},t}),define("model/postModel",["model/model","model/mediaModel","extra"],function(e,t){var n=function(n){e.prototype.constructor.apply(this,arguments),this.data.keyPoint=null,this.data.ordered_media&&this.data.ordered_media.forEach(function(e,n,i){i[n]=new t(e)})};return n.extend(e),n.prototype.isNew=function(){return"0"===String(this.data.id).substr(0,1)},n}),define("factory/postFactory",["model/postModel"],function(e){var t={};return t._prepForFormSubmit=function(e,t){t.contentType=!1,e&&(t.data=new FormData(e)),t.processData=!1},t._newPost=function(t,n,i){var r=$.Deferred();return $.ajax(n).then(function(t,n,i){t.post=new e(t.post),t.post.set("form",t.form),r.resolve(t)},function(e,n,o){console.log(e.responseText),i&&t.set("form",e.responseJSON.form),r.reject(e.responseJSON)}),r.promise()},t["new"]=function(e){var n={url:Routing.generate("imdc_new_post",{threadId:e.get("parent_thread_id"),parentPostId:e.get("parent_post_id")||e.get("id")})};return t._newPost(e,n,!1)},t.post=function(e,n){var i={method:"POST",url:Routing.generate("imdc_post_post",{threadId:e.get("parent_thread_id"),parentPostId:e.get("parent_post_id")||e.get("id")})};return t._prepForFormSubmit(n,i),t._newPost(e,i,!0)},t.get=function(e){var t=$.Deferred(),n={url:Routing.generate("imdc_get_post",{postId:e.get("id")})};return $.ajax(n).then(function(n,i,r){e.update(n.post),t.resolve(n)},function(e,n,i){console.log(e.responseText),t.reject(e.responseJSON)}),t.promise()},t._editPut=function(e,t,n){var i=$.Deferred();return $.ajax(t).then(function(t,n,r){e.update(t.post),e.set("form",t.form),e.set("keyPoint.startTime",e.get("start_time")),e.set("keyPoint.endTime",e.get("end_time")),i.resolve(t)},function(t,r,o){console.log(t.responseText),n&&e.set("form",t.responseJSON.form),i.reject(t.responseJSON)}),i.promise()},t.edit=function(e){var n={url:Routing.generate("imdc_edit_post",{postId:e.get("id")})};return t._editPut(e,n,!1)},t.put=function(e,n){var i={method:"POST",url:Routing.generate("imdc_put_post",{postId:e.get("id")})};return t._prepForFormSubmit(n,i),t._editPut(e,i,!0)},t["delete"]=function(e){var t=$.Deferred(),n={method:"DELETE",url:Routing.generate("imdc_delete_post",{postId:e.get("id")})};return $.ajax(n).then(function(e,n,i){t.resolve(e)},function(e,n,i){console.log(e.responseText),t.reject(e.responseJSON)}),t.promise()},t}),define("factory/threadFactory",[],function(){var e={};return e["delete"]=function(e){var t=$.Deferred(),n={method:"DELETE",url:Routing.generate("imdc_delete_thread",{threadId:e.get("id")})};return $.ajax(n).then(function(e,n,i){t.resolve(e)},function(e,n,i){console.log(e.responseText),t.reject(e.responseJSON)}),t.promise()},e}),define("service/keyPointService",["underscore"],function(){var e=function(){this.name="KeyPoint",this.keyPoints=[],this.subscriptions=[]};return e.Event={ADD:"eventAdd",DURATION:"eventDuration",SELECTION_TIMES:"eventSelectionTimes",HOVER:"eventHover",CLICK:"eventClick",EDIT:"eventEdit",REMOVE:"eventRemove"},e._kIndex=function(e){return _.isString(e)?e:"K"+e},e.prototype.register=function(t){var n=e._kIndex(t.id);_.isObject(t)&&(this.keyPoints[n]=t)},e.prototype.deregister=function(t){var n=e._kIndex(t);_.has(this.keyPoints,n)&&this.keyPoints.splice(n,1)},e.prototype.subscribe=function(t,n){var i=e._kIndex(t);_.has(this.subscriptions,i)||(this.subscriptions[i]=[]),_.contains(this.subscriptions[i],n)||this.subscriptions[i].push(n)},e.prototype.unsubscribe=function(t,n){var i=e._kIndex(t);if(_.has(this.subscriptions,i)){var r=this.subscriptions[i];if(_.contains(r,n)){var o=_.indexOf(r,n);r.splice(o,1)}}},e.prototype.dispatch=function(t,n,i){var r=e._kIndex(t);if(("all"===r||_.has(this.keyPoints,r))&&_.contains(e.Event,n)){var o="all"===r?_.values(this.subscriptions):[this.subscriptions[r]],s=function(e,t,o){var s={type:n};"all"===r?s.keyPoints=this.keyPoints:s.keyPoint=this.keyPoints[r],_.isObject(i)&&_.each(i,function(e,t,n){s[t]=e}),_.each(e,function(e,t,n){_.isFunction(e)&&e.call(this,s)},this)};_.each(o,s,this),"all"!==r&&_.each([this.subscriptions.all],s,this)}},e}),!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define("sockjs",[],e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.SockJS=e()}}(function(){var e;return function t(e,n,i){function r(s,a){if(!n[s]){if(!e[s]){var l="function"==typeof require&&require;if(!a&&l)return l(s,!0);if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var d=n[s]={exports:{}};e[s][0].call(d.exports,function(t){var n=e[s][1][t];return r(n?n:t)},d,d.exports,t,e,n,i)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<i.length;s++)r(i[s]);
return r}({1:[function(e,t){(function(n){var i=e("./transport-list");t.exports=e("./main")(i),"_sockjs_onload"in n&&setTimeout(n._sockjs_onload,1)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./main":14,"./transport-list":16}],2:[function(e,t){function n(){r.call(this),this.initEvent("close",!1,!1),this.wasClean=!1,this.code=0,this.reason=""}var i=e("inherits"),r=e("./event");i(n,r),t.exports=n},{"./event":4,inherits:54}],3:[function(e,t){function n(){r.call(this)}var i=e("inherits"),r=e("./eventtarget");i(n,r),n.prototype.removeAllListeners=function(e){e?delete this._listeners[e]:this._listeners={}},n.prototype.once=function(e,t){function n(){i.removeListener(e,n),r||(r=!0,t.apply(this,arguments))}var i=this,r=!1;this.on(e,n)},n.prototype.emit=function(e){var t=this._listeners[e];if(t)for(var n=Array.prototype.slice.call(arguments,1),i=0;i<t.length;i++)t[i].apply(this,n)},n.prototype.on=n.prototype.addListener=r.prototype.addEventListener,n.prototype.removeListener=r.prototype.removeEventListener,t.exports.EventEmitter=n},{"./eventtarget":5,inherits:54}],4:[function(e,t){function n(e){this.type=e}n.prototype.initEvent=function(e,t,n){return this.type=e,this.bubbles=t,this.cancelable=n,this.timeStamp=+new Date,this},n.prototype.stopPropagation=function(){},n.prototype.preventDefault=function(){},n.CAPTURING_PHASE=1,n.AT_TARGET=2,n.BUBBLING_PHASE=3,t.exports=n},{}],5:[function(e,t){function n(){this._listeners={}}n.prototype.addEventListener=function(e,t){e in this._listeners||(this._listeners[e]=[]);var n=this._listeners[e];-1===n.indexOf(t)&&(n=n.concat([t])),this._listeners[e]=n},n.prototype.removeEventListener=function(e,t){var n=this._listeners[e];if(n){var i=n.indexOf(t);return-1!==i?void(n.length>1?this._listeners[e]=n.slice(0,i).concat(n.slice(i+1)):delete this._listeners[e]):void 0}},n.prototype.dispatchEvent=function(e){var t=e.type,n=Array.prototype.slice.call(arguments,0);if(this["on"+t]&&this["on"+t].apply(this,n),t in this._listeners)for(var i=this._listeners[t],r=0;r<i.length;r++)i[r].apply(this,n)},t.exports=n},{}],6:[function(e,t){function n(e){r.call(this),this.initEvent("message",!1,!1),this.data=e}var i=e("inherits"),r=e("./event");i(n,r),t.exports=n},{"./event":4,inherits:54}],7:[function(e,t){function n(e){this._transport=e,e.on("message",this._transportMessage.bind(this)),e.on("close",this._transportClose.bind(this))}var i=e("json3"),r=e("./utils/iframe");n.prototype._transportClose=function(e,t){r.postMessage("c",i.stringify([e,t]))},n.prototype._transportMessage=function(e){r.postMessage("t",e)},n.prototype._send=function(e){this._transport.send(e)},n.prototype._close=function(){this._transport.close(),this._transport.removeAllListeners()},t.exports=n},{"./utils/iframe":47,json3:55}],8:[function(e,t){var n=e("./utils/url"),i=e("./utils/event"),r=e("json3"),o=e("./facade"),s=e("./info-iframe-receiver"),a=e("./utils/iframe"),l=e("./location");t.exports=function(e,t){var c={};t.forEach(function(e){e.facadeTransport&&(c[e.facadeTransport.transportName]=e.facadeTransport)}),c[s.transportName]=s;var d;e.bootstrap_iframe=function(){var t;a.currentWindowId=l.hash.slice(1);var s=function(i){if(i.source===parent&&("undefined"==typeof d&&(d=i.origin),i.origin===d)){var s;try{s=r.parse(i.data)}catch(u){return}if(s.windowId===a.currentWindowId)switch(s.type){case"s":var h;try{h=r.parse(s.data)}catch(u){break}var p=h[0],f=h[1],m=h[2],g=h[3];if(p!==e.version)throw new Error('Incompatibile SockJS! Main site uses: "'+p+'", the iframe: "'+e.version+'".');if(!n.isOriginEqual(m,l.href)||!n.isOriginEqual(g,l.href))throw new Error("Can't connect to different domain from within an iframe. ("+l.href+", "+m+", "+g+")");t=new o(new c[f](m,g));break;case"m":t._send(s.data);break;case"c":t&&t._close(),t=null}}};i.attachEvent("message",s),a.postMessage("s")}}},{"./facade":7,"./info-iframe-receiver":10,"./location":13,"./utils/event":46,"./utils/iframe":47,"./utils/url":52,debug:void 0,json3:55}],9:[function(e,t){function n(e,t){i.call(this);var n=this,r=+new Date;this.xo=new t("GET",e),this.xo.once("finish",function(e,t){var i,a;if(200===e){if(a=+new Date-r,t)try{i=o.parse(t)}catch(l){}s.isObject(i)||(i={})}n.emit("finish",i,a),n.removeAllListeners()})}var i=e("events").EventEmitter,r=e("inherits"),o=e("json3"),s=e("./utils/object");r(n,i),n.prototype.close=function(){this.removeAllListeners(),this.xo.close()},t.exports=n},{"./utils/object":49,debug:void 0,events:3,inherits:54,json3:55}],10:[function(e,t){function n(e,t){var n=this;r.call(this),this.ir=new a(t,s),this.ir.once("finish",function(e,t){n.ir=null,n.emit("message",o.stringify([e,t]))})}var i=e("inherits"),r=e("events").EventEmitter,o=e("json3"),s=e("./transport/sender/xhr-local"),a=e("./info-ajax");i(n,r),n.transportName="iframe-info-receiver",n.prototype.close=function(){this.ir&&(this.ir.close(),this.ir=null),this.removeAllListeners()},t.exports=n},{"./info-ajax":9,"./transport/sender/xhr-local":37,events:3,inherits:54,json3:55}],11:[function(e,t){(function(n){function i(e,t){var i=this;r.call(this);var o=function(){var n=i.ifr=new l(c.transportName,t,e);n.once("message",function(e){if(e){var t;try{t=s.parse(e)}catch(n){return i.emit("finish"),void i.close()}var r=t[0],o=t[1];i.emit("finish",r,o)}i.close()}),n.once("close",function(){i.emit("finish"),i.close()})};n.document.body?o():a.attachEvent("load",o)}var r=e("events").EventEmitter,o=e("inherits"),s=e("json3"),a=e("./utils/event"),l=e("./transport/iframe"),c=e("./info-iframe-receiver");o(i,r),i.enabled=function(){return l.enabled()},i.prototype.close=function(){this.ifr&&this.ifr.close(),this.removeAllListeners(),this.ifr=null},t.exports=i}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./info-iframe-receiver":10,"./transport/iframe":22,"./utils/event":46,debug:void 0,events:3,inherits:54,json3:55}],12:[function(e,t){function n(e,t){var n=this;i.call(this),setTimeout(function(){n.doXhr(e,t)},0)}var i=e("events").EventEmitter,r=e("inherits"),o=e("./utils/url"),s=e("./transport/sender/xdr"),a=e("./transport/sender/xhr-cors"),l=e("./transport/sender/xhr-local"),c=e("./transport/sender/xhr-fake"),d=e("./info-iframe"),u=e("./info-ajax");r(n,i),n._getReceiver=function(e,t,n){return n.sameOrigin?new u(t,l):a.enabled?new u(t,a):s.enabled&&n.sameScheme?new u(t,s):d.enabled()?new d(e,t):new u(t,c)},n.prototype.doXhr=function(e,t){var i=this,r=o.addPath(e,"/info");this.xo=n._getReceiver(e,r,t),this.timeoutRef=setTimeout(function(){i._cleanup(!1),i.emit("finish")},n.timeout),this.xo.once("finish",function(e,t){i._cleanup(!0),i.emit("finish",e,t)})},n.prototype._cleanup=function(e){clearTimeout(this.timeoutRef),this.timeoutRef=null,!e&&this.xo&&this.xo.close(),this.xo=null},n.prototype.close=function(){this.removeAllListeners(),this._cleanup(!1)},n.timeout=8e3,t.exports=n},{"./info-ajax":9,"./info-iframe":11,"./transport/sender/xdr":34,"./transport/sender/xhr-cors":35,"./transport/sender/xhr-fake":36,"./transport/sender/xhr-local":37,"./utils/url":52,debug:void 0,events:3,inherits:54}],13:[function(e,t){(function(e){t.exports=e.location||{origin:"http://localhost:80",protocol:"http",host:"localhost",port:80,href:"http://localhost/",hash:""}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],14:[function(e,t){(function(n){function i(e,t,n){if(!(this instanceof i))return new i(e,t,n);if(arguments.length<1)throw new TypeError("Failed to construct 'SockJS: 1 argument required, but only 0 present");b.call(this),this.readyState=i.CONNECTING,this.extensions="",this.protocol="",n=n||{},n.protocols_whitelist&&g.warn("'protocols_whitelist' is DEPRECATED. Use 'transports' instead."),this._transportsWhitelist=n.transports;var r=n.sessionId||8;if("function"==typeof r)this._generateSessionId=r;else{if("number"!=typeof r)throw new TypeError("If sessionId is used in the options, it needs to be a number or a function.");this._generateSessionId=function(){return c.string(r)}}this._server=n.server||c.numberString(1e3);var o=new s(e);if(!o.host||!o.protocol)throw new SyntaxError("The URL '"+e+"' is invalid");if(o.hash)throw new SyntaxError("The URL must not contain a fragment");if("http:"!==o.protocol&&"https:"!==o.protocol)throw new SyntaxError("The URL's scheme must be either 'http:' or 'https:'. '"+o.protocol+"' is not allowed.");var a="https:"===o.protocol;if("https"===y.protocol&&!a)throw new Error("SecurityError: An insecure SockJS connection may not be initiated from a page loaded over HTTPS");t?Array.isArray(t)||(t=[t]):t=[];var l=t.sort();l.forEach(function(e,t){if(!e)throw new SyntaxError("The protocols entry '"+e+"' is invalid.");if(t<l.length-1&&e===l[t+1])throw new SyntaxError("The protocols entry '"+e+"' is duplicated.")});var d=u.getOrigin(y.href);this._origin=d?d.toLowerCase():null,o.set("pathname",o.pathname.replace(/\/+$/,"")),this.url=o.href,this._urlInfo={nullOrigin:!m.hasDomain(),sameOrigin:u.isOriginEqual(this.url,y.href),sameScheme:u.isSchemeEqual(this.url,y.href)},this._ir=new E(this.url,this._urlInfo),this._ir.once("finish",this._receiveInfo.bind(this))}function r(e){return 1e3===e||e>=3e3&&4999>=e}e("./shims");var o,s=e("url-parse"),a=e("inherits"),l=e("json3"),c=e("./utils/random"),d=e("./utils/escape"),u=e("./utils/url"),h=e("./utils/event"),p=e("./utils/transport"),f=e("./utils/object"),m=e("./utils/browser"),g=e("./utils/log"),v=e("./event/event"),b=e("./event/eventtarget"),y=e("./location"),_=e("./event/close"),w=e("./event/trans-message"),E=e("./info-receiver");a(i,b),i.prototype.close=function(e,t){if(e&&!r(e))throw new Error("InvalidAccessError: Invalid code");if(t&&t.length>123)throw new SyntaxError("reason argument has an invalid length");if(this.readyState!==i.CLOSING&&this.readyState!==i.CLOSED){var n=!0;this._close(e||1e3,t||"Normal closure",n)}},i.prototype.send=function(e){if("string"!=typeof e&&(e=""+e),this.readyState===i.CONNECTING)throw new Error("InvalidStateError: The connection has not been established yet");this.readyState===i.OPEN&&this._transport.send(d.quote(e))},i.version=e("./version"),i.CONNECTING=0,i.OPEN=1,i.CLOSING=2,i.CLOSED=3,i.prototype._receiveInfo=function(e,t){if(this._ir=null,!e)return void this._close(1002,"Cannot connect to server");this._rto=this.countRTO(t),this._transUrl=e.base_url?e.base_url:this.url,e=f.extend(e,this._urlInfo);var n=o.filterToEnabled(this._transportsWhitelist,e);this._transports=n.main,this._connect()},i.prototype._connect=function(){for(var e=this._transports.shift();e;e=this._transports.shift()){if(e.needBody&&(!n.document.body||"undefined"!=typeof n.document.readyState&&"complete"!==n.document.readyState&&"interactive"!==n.document.readyState))return this._transports.unshift(e),void h.attachEvent("load",this._connect.bind(this));var t=this._rto*e.roundTrips||5e3;this._transportTimeoutId=setTimeout(this._transportTimeout.bind(this),t);var i=u.addPath(this._transUrl,"/"+this._server+"/"+this._generateSessionId()),r=new e(i,this._transUrl);return r.on("message",this._transportMessage.bind(this)),r.once("close",this._transportClose.bind(this)),r.transportName=e.transportName,void(this._transport=r)}this._close(2e3,"All transports failed",!1)},i.prototype._transportTimeout=function(){this.readyState===i.CONNECTING&&this._transportClose(2007,"Transport timed out")},i.prototype._transportMessage=function(e){var t,n=this,i=e.slice(0,1),r=e.slice(1);switch(i){case"o":return void this._open();case"h":return void this.dispatchEvent(new v("heartbeat"))}if(r)try{t=l.parse(r)}catch(o){}if("undefined"!=typeof t)switch(i){case"a":Array.isArray(t)&&t.forEach(function(e){n.dispatchEvent(new w(e))});break;case"m":this.dispatchEvent(new w(t));break;case"c":Array.isArray(t)&&2===t.length&&this._close(t[0],t[1],!0)}},i.prototype._transportClose=function(e,t){return this._transport&&(this._transport.removeAllListeners(),this._transport=null,this.transport=null),r(e)||2e3===e||this.readyState!==i.CONNECTING?void this._close(e,t):void this._connect()},i.prototype._open=function(){this.readyState===i.CONNECTING?(this._transportTimeoutId&&(clearTimeout(this._transportTimeoutId),this._transportTimeoutId=null),this.readyState=i.OPEN,this.transport=this._transport.transportName,this.dispatchEvent(new v("open"))):this._close(1006,"Server lost session")},i.prototype._close=function(e,t,n){var r=!1;if(this._ir&&(r=!0,this._ir.close(),this._ir=null),this._transport&&(this._transport.close(),this._transport=null,this.transport=null),this.readyState===i.CLOSED)throw new Error("InvalidStateError: SockJS has already been closed");this.readyState=i.CLOSING,setTimeout(function(){this.readyState=i.CLOSED,r&&this.dispatchEvent(new v("error"));var o=new _("close");o.wasClean=n||!1,o.code=e||1e3,o.reason=t,this.dispatchEvent(o),this.onmessage=this.onclose=this.onerror=null}.bind(this),0)},i.prototype.countRTO=function(e){return e>100?4*e:300+e},t.exports=function(t){return o=p(t),e("./iframe-bootstrap")(i,t),i}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./event/close":2,"./event/event":4,"./event/eventtarget":5,"./event/trans-message":6,"./iframe-bootstrap":8,"./info-receiver":12,"./location":13,"./shims":15,"./utils/browser":44,"./utils/escape":45,"./utils/event":46,"./utils/log":48,"./utils/object":49,"./utils/random":50,"./utils/transport":51,"./utils/url":52,"./version":53,debug:void 0,inherits:54,json3:55,"url-parse":56}],15:[function(){function e(e){var t=+e;return t!==t?t=0:0!==t&&t!==1/0&&t!==-(1/0)&&(t=(t>0||-1)*Math.floor(Math.abs(t))),t}function t(e){return e>>>0}function n(){}var i,r=Array.prototype,o=Object.prototype,s=Function.prototype,a=String.prototype,l=r.slice,c=o.toString,d=function(e){return"[object Function]"===o.toString.call(e)},u=function(e){return"[object Array]"===c.call(e)},h=function(e){return"[object String]"===c.call(e)},p=Object.defineProperty&&function(){try{return Object.defineProperty({},"x",{}),!0}catch(e){return!1}}();i=p?function(e,t,n,i){!i&&t in e||Object.defineProperty(e,t,{configurable:!0,enumerable:!1,writable:!0,value:n})}:function(e,t,n,i){!i&&t in e||(e[t]=n)};var f=function(e,t,n){for(var r in t)o.hasOwnProperty.call(t,r)&&i(e,r,t[r],n)},m=function(e){if(null==e)throw new TypeError("can't convert "+e+" to object");return Object(e)};f(s,{bind:function(e){var t=this;if(!d(t))throw new TypeError("Function.prototype.bind called on incompatible "+t);for(var i=l.call(arguments,1),r=function(){if(this instanceof c){var n=t.apply(this,i.concat(l.call(arguments)));return Object(n)===n?n:this}return t.apply(e,i.concat(l.call(arguments)))},o=Math.max(0,t.length-i.length),s=[],a=0;o>a;a++)s.push("$"+a);var c=Function("binder","return function ("+s.join(",")+"){ return binder.apply(this, arguments); }")(r);return t.prototype&&(n.prototype=t.prototype,c.prototype=new n,n.prototype=null),c}}),f(Array,{isArray:u});var g=Object("a"),v="a"!==g[0]||!(0 in g),b=function(e){var t=!0,n=!0;return e&&(e.call("foo",function(e,n,i){"object"!=typeof i&&(t=!1)}),e.call([1],function(){n="string"==typeof this},"x")),!!e&&t&&n};f(r,{forEach:function(e){var t=m(this),n=v&&h(this)?this.split(""):t,i=arguments[1],r=-1,o=n.length>>>0;if(!d(e))throw new TypeError;for(;++r<o;)r in n&&e.call(i,n[r],r,t)}},!b(r.forEach));var y=Array.prototype.indexOf&&-1!==[0,1].indexOf(1,2);f(r,{indexOf:function(t){var n=v&&h(this)?this.split(""):m(this),i=n.length>>>0;if(!i)return-1;var r=0;for(arguments.length>1&&(r=e(arguments[1])),r=r>=0?r:Math.max(0,i+r);i>r;r++)if(r in n&&n[r]===t)return r;return-1}},y);var _=a.split;2!=="ab".split(/(?:ab)*/).length||4!==".".split(/(.?)(.?)/).length||"t"==="tesst".split(/(s)*/)[1]||4!=="test".split(/(?:)/,-1).length||"".split(/.?/).length||".".split(/()()/).length>1?!function(){var e=void 0===/()??/.exec("")[1];a.split=function(n,i){var o=this;if(void 0===n&&0===i)return[];if("[object RegExp]"!==c.call(n))return _.call(this,n,i);var s,a,l,d,u=[],h=(n.ignoreCase?"i":"")+(n.multiline?"m":"")+(n.extended?"x":"")+(n.sticky?"y":""),p=0;for(n=new RegExp(n.source,h+"g"),o+="",e||(s=new RegExp("^"+n.source+"$(?!\\s)",h)),i=void 0===i?-1>>>0:t(i);(a=n.exec(o))&&(l=a.index+a[0].length,!(l>p&&(u.push(o.slice(p,a.index)),!e&&a.length>1&&a[0].replace(s,function(){for(var e=1;e<arguments.length-2;e++)void 0===arguments[e]&&(a[e]=void 0)}),a.length>1&&a.index<o.length&&r.push.apply(u,a.slice(1)),d=a[0].length,p=l,u.length>=i)));)n.lastIndex===a.index&&n.lastIndex++;return p===o.length?(d||!n.test(""))&&u.push(""):u.push(o.slice(p)),u.length>i?u.slice(0,i):u}}():"0".split(void 0,0).length&&(a.split=function(e,t){return void 0===e&&0===t?[]:_.call(this,e,t)});var w="	\n\f\r \u2028\u2029\ufeff",E="",C="["+w+"]",T=new RegExp("^"+C+C+"*"),S=new RegExp(C+C+"*$"),k=a.trim&&(w.trim()||!E.trim());f(a,{trim:function(){if(void 0===this||null===this)throw new TypeError("can't convert "+this+" to object");return String(this).replace(T,"").replace(S,"")}},k);var $=a.substr,x="".substr&&"b"!=="0b".substr(-1);f(a,{substr:function(e,t){return $.call(this,0>e&&(e=this.length+e)<0?0:e,t)}},x)},{}],16:[function(e,t){t.exports=[e("./transport/websocket"),e("./transport/xhr-streaming"),e("./transport/xdr-streaming"),e("./transport/eventsource"),e("./transport/lib/iframe-wrap")(e("./transport/eventsource")),e("./transport/htmlfile"),e("./transport/lib/iframe-wrap")(e("./transport/htmlfile")),e("./transport/xhr-polling"),e("./transport/xdr-polling"),e("./transport/lib/iframe-wrap")(e("./transport/xhr-polling")),e("./transport/jsonp-polling")]},{"./transport/eventsource":20,"./transport/htmlfile":21,"./transport/jsonp-polling":23,"./transport/lib/iframe-wrap":26,"./transport/websocket":38,"./transport/xdr-polling":39,"./transport/xdr-streaming":40,"./transport/xhr-polling":41,"./transport/xhr-streaming":42}],17:[function(e,t){(function(n){function i(e,t,n,i){var o=this;r.call(this),setTimeout(function(){o._start(e,t,n,i)},0)}var r=e("events").EventEmitter,o=e("inherits"),s=e("../../utils/event"),a=e("../../utils/url"),l=n.XMLHttpRequest;o(i,r),i.prototype._start=function(e,t,n,r){var o=this;try{this.xhr=new l}catch(c){}if(!this.xhr)return this.emit("finish",0,"no xhr support"),void this._cleanup();t=a.addQuery(t,"t="+ +new Date),this.unloadRef=s.unloadAdd(function(){o._cleanup(!0)});try{this.xhr.open(e,t,!0),this.timeout&&"timeout"in this.xhr&&(this.xhr.timeout=this.timeout,this.xhr.ontimeout=function(){o.emit("finish",0,""),o._cleanup(!1)})}catch(d){return this.emit("finish",0,""),void this._cleanup(!1)}if(r&&r.noCredentials||!i.supportsCORS||(this.xhr.withCredentials="true"),r&&r.headers)for(var u in r.headers)this.xhr.setRequestHeader(u,r.headers[u]);this.xhr.onreadystatechange=function(){if(o.xhr){var e,t,n=o.xhr;switch(n.readyState){case 3:try{t=n.status,e=n.responseText}catch(i){}1223===t&&(t=204),200===t&&e&&e.length>0&&o.emit("chunk",t,e);break;case 4:t=n.status,1223===t&&(t=204),(12005===t||12029===t)&&(t=0),o.emit("finish",t,n.responseText),o._cleanup(!1)}}};try{o.xhr.send(n)}catch(d){o.emit("finish",0,""),o._cleanup(!1)}},i.prototype._cleanup=function(e){if(this.xhr){if(this.removeAllListeners(),s.unloadDel(this.unloadRef),this.xhr.onreadystatechange=function(){},this.xhr.ontimeout&&(this.xhr.ontimeout=null),e)try{this.xhr.abort()}catch(t){}this.unloadRef=this.xhr=null}},i.prototype.close=function(){this._cleanup(!0)},i.enabled=!!l;var c=["Active"].concat("Object").join("X");!i.enabled&&c in n&&(l=function(){try{return new n[c]("Microsoft.XMLHTTP")}catch(e){return null}},i.enabled=!!new l);var d=!1;try{d="withCredentials"in new l}catch(u){}i.supportsCORS=d,t.exports=i}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../utils/event":46,"../../utils/url":52,debug:void 0,events:3,inherits:54}],18:[function(e,t){(function(e){t.exports=e.EventSource}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],19:[function(e,t){(function(e){t.exports=e.WebSocket||e.MozWebSocket}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],20:[function(e,t){function n(e){if(!n.enabled())throw new Error("Transport created when disabled");r.call(this,e,"/eventsource",o,s)}var i=e("inherits"),r=e("./lib/ajax-based"),o=e("./receiver/eventsource"),s=e("./sender/xhr-cors"),a=e("eventsource");i(n,r),n.enabled=function(){return!!a},n.transportName="eventsource",n.roundTrips=2,t.exports=n},{"./lib/ajax-based":24,"./receiver/eventsource":29,"./sender/xhr-cors":35,eventsource:18,inherits:54}],21:[function(e,t){function n(e){if(!r.enabled)throw new Error("Transport created when disabled");s.call(this,e,"/htmlfile",r,o)}var i=e("inherits"),r=e("./receiver/htmlfile"),o=e("./sender/xhr-local"),s=e("./lib/ajax-based");i(n,s),n.enabled=function(e){return r.enabled&&e.sameOrigin},n.transportName="htmlfile",n.roundTrips=2,t.exports=n},{"./lib/ajax-based":24,"./receiver/htmlfile":30,"./sender/xhr-local":37,inherits:54}],22:[function(e,t){function n(e,t,i){if(!n.enabled())throw new Error("Transport created when disabled");o.call(this);var r=this;this.origin=a.getOrigin(i),this.baseUrl=i,this.transUrl=t,this.transport=e,this.windowId=d.string(8);var s=a.addPath(i,"/iframe.html")+"#"+this.windowId;this.iframeObj=l.createIframe(s,function(e){r.emit("close",1006,"Unable to load an iframe ("+e+")"),r.close()}),this.onmessageCallback=this._message.bind(this),c.attachEvent("message",this.onmessageCallback)}var i=e("inherits"),r=e("json3"),o=e("events").EventEmitter,s=e("../version"),a=e("../utils/url"),l=e("../utils/iframe"),c=e("../utils/event"),d=e("../utils/random");i(n,o),n.prototype.close=function(){if(this.removeAllListeners(),this.iframeObj){c.detachEvent("message",this.onmessageCallback);try{this.postMessage("c")}catch(e){}this.iframeObj.cleanup(),this.iframeObj=null,this.onmessageCallback=this.iframeObj=null}},n.prototype._message=function(e){if(a.isOriginEqual(e.origin,this.origin)){var t;try{t=r.parse(e.data)}catch(n){return}if(t.windowId===this.windowId)switch(t.type){case"s":this.iframeObj.loaded(),this.postMessage("s",r.stringify([s,this.transport,this.transUrl,this.baseUrl]));break;case"t":this.emit("message",t.data);break;case"c":var i;try{i=r.parse(t.data)}catch(n){return}this.emit("close",i[0],i[1]),this.close()}}},n.prototype.postMessage=function(e,t){this.iframeObj.post(r.stringify({windowId:this.windowId,type:e,data:t||""}),this.origin)},n.prototype.send=function(e){this.postMessage("m",e)},n.enabled=function(){return l.iframeEnabled},n.transportName="iframe",n.roundTrips=2,t.exports=n},{"../utils/event":46,"../utils/iframe":47,"../utils/random":50,"../utils/url":52,"../version":53,debug:void 0,events:3,inherits:54,json3:55}],23:[function(e,t){(function(n){function i(e){if(!i.enabled())throw new Error("Transport created when disabled");o.call(this,e,"/jsonp",a,s)}var r=e("inherits"),o=e("./lib/sender-receiver"),s=e("./receiver/jsonp"),a=e("./sender/jsonp");r(i,o),i.enabled=function(){return!!n.document},i.transportName="jsonp-polling",i.roundTrips=1,i.needBody=!0,t.exports=i}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./lib/sender-receiver":28,"./receiver/jsonp":31,"./sender/jsonp":33,inherits:54}],24:[function(e,t){function n(e){return function(t,n,i){var r={};"string"==typeof n&&(r.headers={"Content-type":"text/plain"});var s=o.addPath(t,"/xhr_send"),a=new e("POST",s,n,r);return a.once("finish",function(e){return a=null,200!==e&&204!==e?i(new Error("http status "+e)):void i()}),function(){a.close(),a=null;var e=new Error("Aborted");e.code=1e3,i(e)}}}function i(e,t,i,r){s.call(this,e,t,n(r),i,r)}var r=e("inherits"),o=e("../../utils/url"),s=e("./sender-receiver");r(i,s),t.exports=i},{"../../utils/url":52,"./sender-receiver":28,debug:void 0,inherits:54}],25:[function(e,t){function n(e,t){r.call(this),this.sendBuffer=[],this.sender=t,this.url=e}var i=e("inherits"),r=e("events").EventEmitter;i(n,r),n.prototype.send=function(e){this.sendBuffer.push(e),this.sendStop||this.sendSchedule()},n.prototype.sendScheduleWait=function(){var e,t=this;this.sendStop=function(){t.sendStop=null,clearTimeout(e)},e=setTimeout(function(){t.sendStop=null,t.sendSchedule()},25)},n.prototype.sendSchedule=function(){var e=this;if(this.sendBuffer.length>0){var t="["+this.sendBuffer.join(",")+"]";this.sendStop=this.sender(this.url,t,function(t){e.sendStop=null,t?(e.emit("close",t.code||1006,"Sending error: "+t),e._cleanup()):e.sendScheduleWait()}),this.sendBuffer=[]}},n.prototype._cleanup=function(){this.removeAllListeners()},n.prototype.stop=function(){this._cleanup(),this.sendStop&&(this.sendStop(),this.sendStop=null)},t.exports=n},{debug:void 0,events:3,inherits:54}],26:[function(e,t){(function(n){var i=e("inherits"),r=e("../iframe"),o=e("../../utils/object");t.exports=function(e){function t(t,n){r.call(this,e.transportName,t,n)}return i(t,r),t.enabled=function(t,i){if(!n.document)return!1;var s=o.extend({},i);return s.sameOrigin=!0,e.enabled(s)&&r.enabled()},t.transportName="iframe-"+e.transportName,t.needBody=!0,t.roundTrips=r.roundTrips+e.roundTrips-1,t.facadeTransport=e,t}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../utils/object":49,"../iframe":22,inherits:54}],27:[function(e,t){function n(e,t,n){r.call(this),this.Receiver=e,this.receiveUrl=t,this.AjaxObject=n,this._scheduleReceiver()}var i=e("inherits"),r=e("events").EventEmitter;i(n,r),n.prototype._scheduleReceiver=function(){var e=this,t=this.poll=new this.Receiver(this.receiveUrl,this.AjaxObject);t.on("message",function(t){e.emit("message",t)}),t.once("close",function(n,i){e.poll=t=null,e.pollIsClosing||("network"===i?e._scheduleReceiver():(e.emit("close",n||1006,i),e.removeAllListeners()))})},n.prototype.abort=function(){this.removeAllListeners(),this.pollIsClosing=!0,this.poll&&this.poll.abort()},t.exports=n},{debug:void 0,events:3,inherits:54}],28:[function(e,t){function n(e,t,n,i,a){var l=r.addPath(e,t),c=this;o.call(this,e,n),this.poll=new s(i,l,a),this.poll.on("message",function(e){c.emit("message",e)}),this.poll.once("close",function(e,t){c.poll=null,c.emit("close",e,t),c.close()})}var i=e("inherits"),r=e("../../utils/url"),o=e("./buffered-sender"),s=e("./polling");i(n,o),n.prototype.close=function(){this.removeAllListeners(),this.poll&&(this.poll.abort(),this.poll=null),this.stop()},t.exports=n},{"../../utils/url":52,"./buffered-sender":25,"./polling":27,debug:void 0,inherits:54}],29:[function(e,t){function n(e){r.call(this);var t=this,n=this.es=new o(e);n.onmessage=function(e){t.emit("message",decodeURI(e.data))},n.onerror=function(e){var i=2!==n.readyState?"network":"permanent";t._cleanup(),t._close(i)}}var i=e("inherits"),r=e("events").EventEmitter,o=e("eventsource");i(n,r),n.prototype.abort=function(){this._cleanup(),this._close("user")},n.prototype._cleanup=function(){var e=this.es;e&&(e.onmessage=e.onerror=null,e.close(),this.es=null)},n.prototype._close=function(e){var t=this;setTimeout(function(){t.emit("close",null,e),t.removeAllListeners()},200)},t.exports=n},{debug:void 0,events:3,eventsource:18,inherits:54}],30:[function(e,t){(function(n){function i(e){a.call(this);var t=this;o.polluteGlobalNamespace(),this.id="a"+l.string(6),e=s.addQuery(e,"c="+decodeURIComponent(o.WPrefix+"."+this.id));var r=i.htmlfileEnabled?o.createHtmlfile:o.createIframe;n[o.WPrefix][this.id]={start:function(){t.iframeObj.loaded()},message:function(e){t.emit("message",e)},stop:function(){t._cleanup(),t._close("network")}},this.iframeObj=r(e,function(){t._cleanup(),t._close("permanent")})}var r=e("inherits"),o=e("../../utils/iframe"),s=e("../../utils/url"),a=e("events").EventEmitter,l=e("../../utils/random");r(i,a),i.prototype.abort=function(){this._cleanup(),this._close("user")},i.prototype._cleanup=function(){this.iframeObj&&(this.iframeObj.cleanup(),this.iframeObj=null),delete n[o.WPrefix][this.id]},i.prototype._close=function(e){this.emit("close",null,e),this.removeAllListeners()},i.htmlfileEnabled=!1;var c=["Active"].concat("Object").join("X");if(c in n)try{i.htmlfileEnabled=!!new n[c]("htmlfile")}catch(d){}i.enabled=i.htmlfileEnabled||o.iframeEnabled,t.exports=i}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../utils/iframe":47,"../../utils/random":50,"../../utils/url":52,debug:void 0,events:3,inherits:54}],31:[function(e,t){(function(n){function i(e){var t=this;c.call(this),r.polluteGlobalNamespace(),this.id="a"+o.string(6);var s=a.addQuery(e,"c="+encodeURIComponent(r.WPrefix+"."+this.id));n[r.WPrefix][this.id]=this._callback.bind(this),this._createScript(s),this.timeoutId=setTimeout(function(){t._abort(new Error("JSONP script loaded abnormally (timeout)"))},i.timeout)}var r=e("../../utils/iframe"),o=e("../../utils/random"),s=e("../../utils/browser"),a=e("../../utils/url"),l=e("inherits"),c=e("events").EventEmitter;l(i,c),i.prototype.abort=function(){if(n[r.WPrefix][this.id]){var e=new Error("JSONP user aborted read");e.code=1e3,this._abort(e)}},i.timeout=35e3,i.scriptErrorTimeout=1e3,i.prototype._callback=function(e){this._cleanup(),this.aborting||(e&&this.emit("message",e),this.emit("close",null,"network"),this.removeAllListeners())},i.prototype._abort=function(e){this._cleanup(),this.aborting=!0,this.emit("close",e.code,e.message),this.removeAllListeners()},i.prototype._cleanup=function(){if(clearTimeout(this.timeoutId),this.script2&&(this.script2.parentNode.removeChild(this.script2),this.script2=null),this.script){var e=this.script;e.parentNode.removeChild(e),e.onreadystatechange=e.onerror=e.onload=e.onclick=null,this.script=null}delete n[r.WPrefix][this.id]},i.prototype._scriptError=function(){var e=this;this.errorTimer||(this.errorTimer=setTimeout(function(){e.loadedOkay||e._abort(new Error("JSONP script loaded abnormally (onerror)"))},i.scriptErrorTimeout))},i.prototype._createScript=function(e){var t,i=this,r=this.script=n.document.createElement("script");if(r.id="a"+o.string(8),r.src=e,r.type="text/javascript",r.charset="UTF-8",r.onerror=this._scriptError.bind(this),r.onload=function(){i._abort(new Error("JSONP script loaded abnormally (onload)"))},r.onreadystatechange=function(){if(/loaded|closed/.test(r.readyState)){if(r&&r.htmlFor&&r.onclick){i.loadedOkay=!0;try{r.onclick()}catch(e){}}r&&i._abort(new Error("JSONP script loaded abnormally (onreadystatechange)"))}},"undefined"==typeof r.async&&n.document.attachEvent)if(s.isOpera())t=this.script2=n.document.createElement("script"),t.text="try{var a = document.getElementById('"+r.id+"'); if(a)a.onerror();}catch(x){};",r.async=t.async=!1;else{try{r.htmlFor=r.id,r.event="onclick"}catch(a){}r.async=!0}"undefined"!=typeof r.async&&(r.async=!0);var l=n.document.getElementsByTagName("head")[0];l.insertBefore(r,l.firstChild),t&&l.insertBefore(t,l.firstChild)},t.exports=i}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../utils/browser":44,"../../utils/iframe":47,"../../utils/random":50,"../../utils/url":52,debug:void 0,events:3,inherits:54}],32:[function(e,t){function n(e,t){r.call(this);var n=this;this.bufferPosition=0,this.xo=new t("POST",e,null),this.xo.on("chunk",this._chunkHandler.bind(this)),this.xo.once("finish",function(e,t){n._chunkHandler(e,t),n.xo=null;var i=200===e?"network":"permanent";n.emit("close",null,i),n._cleanup()})}var i=e("inherits"),r=e("events").EventEmitter;i(n,r),n.prototype._chunkHandler=function(e,t){if(200===e&&t)for(var n=-1;;this.bufferPosition+=n+1){var i=t.slice(this.bufferPosition);if(n=i.indexOf("\n"),-1===n)break;var r=i.slice(0,n);r&&this.emit("message",r)}},n.prototype._cleanup=function(){
this.removeAllListeners()},n.prototype.abort=function(){this.xo&&(this.xo.close(),this.emit("close",null,"user"),this.xo=null),this._cleanup()},t.exports=n},{debug:void 0,events:3,inherits:54}],33:[function(e,t){(function(n){function i(e){try{return n.document.createElement('<iframe name="'+e+'">')}catch(t){var i=n.document.createElement("iframe");return i.name=e,i}}function r(){o=n.document.createElement("form"),o.style.display="none",o.style.position="absolute",o.method="POST",o.enctype="application/x-www-form-urlencoded",o.acceptCharset="UTF-8",s=n.document.createElement("textarea"),s.name="d",o.appendChild(s),n.document.body.appendChild(o)}var o,s,a=e("../../utils/random"),l=e("../../utils/url");t.exports=function(e,t,n){o||r();var c="a"+a.string(8);o.target=c,o.action=l.addQuery(l.addPath(e,"/jsonp_send"),"i="+c);var d=i(c);d.id=c,d.style.display="none",o.appendChild(d);try{s.value=t}catch(u){}o.submit();var h=function(e){d.onerror&&(d.onreadystatechange=d.onerror=d.onload=null,setTimeout(function(){d.parentNode.removeChild(d),d=null},500),s.value="",n(e))};return d.onerror=function(){h()},d.onload=function(){h()},d.onreadystatechange=function(e){"complete"===d.readyState&&h()},function(){h(new Error("Aborted"))}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../utils/random":50,"../../utils/url":52,debug:void 0}],34:[function(e,t){(function(n){function i(e,t,n){var i=this;r.call(this),setTimeout(function(){i._start(e,t,n)},0)}var r=e("events").EventEmitter,o=e("inherits"),s=e("../../utils/event"),a=e("../../utils/browser"),l=e("../../utils/url");o(i,r),i.prototype._start=function(e,t,i){var r=this,o=new n.XDomainRequest;t=l.addQuery(t,"t="+ +new Date),o.onerror=function(){r._error()},o.ontimeout=function(){r._error()},o.onprogress=function(){r.emit("chunk",200,o.responseText)},o.onload=function(){r.emit("finish",200,o.responseText),r._cleanup(!1)},this.xdr=o,this.unloadRef=s.unloadAdd(function(){r._cleanup(!0)});try{this.xdr.open(e,t),this.timeout&&(this.xdr.timeout=this.timeout),this.xdr.send(i)}catch(a){this._error()}},i.prototype._error=function(){this.emit("finish",0,""),this._cleanup(!1)},i.prototype._cleanup=function(e){if(this.xdr){if(this.removeAllListeners(),s.unloadDel(this.unloadRef),this.xdr.ontimeout=this.xdr.onerror=this.xdr.onprogress=this.xdr.onload=null,e)try{this.xdr.abort()}catch(t){}this.unloadRef=this.xdr=null}},i.prototype.close=function(){this._cleanup(!0)},i.enabled=!(!n.XDomainRequest||!a.hasDomain()),t.exports=i}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../utils/browser":44,"../../utils/event":46,"../../utils/url":52,debug:void 0,events:3,inherits:54}],35:[function(e,t){function n(e,t,n,i){r.call(this,e,t,n,i)}var i=e("inherits"),r=e("../driver/xhr");i(n,r),n.enabled=r.enabled&&r.supportsCORS,t.exports=n},{"../driver/xhr":17,inherits:54}],36:[function(e,t){function n(){var e=this;i.call(this),this.to=setTimeout(function(){e.emit("finish",200,"{}")},n.timeout)}var i=e("events").EventEmitter,r=e("inherits");r(n,i),n.prototype.close=function(){clearTimeout(this.to)},n.timeout=2e3,t.exports=n},{events:3,inherits:54}],37:[function(e,t){function n(e,t,n){r.call(this,e,t,n,{noCredentials:!0})}var i=e("inherits"),r=e("../driver/xhr");i(n,r),n.enabled=r.enabled,t.exports=n},{"../driver/xhr":17,inherits:54}],38:[function(e,t){function n(e){if(!n.enabled())throw new Error("Transport created when disabled");s.call(this);var t=this,o=r.addPath(e,"/websocket");o="https"===o.slice(0,5)?"wss"+o.slice(5):"ws"+o.slice(4),this.url=o,this.ws=new a(this.url),this.ws.onmessage=function(e){t.emit("message",e.data)},this.unloadRef=i.unloadAdd(function(){t.ws.close()}),this.ws.onclose=function(e){t.emit("close",e.code,e.reason),t._cleanup()},this.ws.onerror=function(e){t.emit("close",1006,"WebSocket connection broken"),t._cleanup()}}var i=e("../utils/event"),r=e("../utils/url"),o=e("inherits"),s=e("events").EventEmitter,a=e("./driver/websocket");o(n,s),n.prototype.send=function(e){var t="["+e+"]";this.ws.send(t)},n.prototype.close=function(){this.ws&&this.ws.close(),this._cleanup()},n.prototype._cleanup=function(){var e=this.ws;e&&(e.onmessage=e.onclose=e.onerror=null),i.unloadDel(this.unloadRef),this.unloadRef=this.ws=null,this.removeAllListeners()},n.enabled=function(){return!!a},n.transportName="websocket",n.roundTrips=2,t.exports=n},{"../utils/event":46,"../utils/url":52,"./driver/websocket":19,debug:void 0,events:3,inherits:54}],39:[function(e,t){function n(e){if(!a.enabled)throw new Error("Transport created when disabled");r.call(this,e,"/xhr",s,a)}var i=e("inherits"),r=e("./lib/ajax-based"),o=e("./xdr-streaming"),s=e("./receiver/xhr"),a=e("./sender/xdr");i(n,r),n.enabled=o.enabled,n.transportName="xdr-polling",n.roundTrips=2,t.exports=n},{"./lib/ajax-based":24,"./receiver/xhr":32,"./sender/xdr":34,"./xdr-streaming":40,inherits:54}],40:[function(e,t){function n(e){if(!s.enabled)throw new Error("Transport created when disabled");r.call(this,e,"/xhr_streaming",o,s)}var i=e("inherits"),r=e("./lib/ajax-based"),o=e("./receiver/xhr"),s=e("./sender/xdr");i(n,r),n.enabled=function(e){return e.cookie_needed||e.nullOrigin?!1:s.enabled&&e.sameScheme},n.transportName="xdr-streaming",n.roundTrips=2,t.exports=n},{"./lib/ajax-based":24,"./receiver/xhr":32,"./sender/xdr":34,inherits:54}],41:[function(e,t){function n(e){if(!a.enabled&&!s.enabled)throw new Error("Transport created when disabled");r.call(this,e,"/xhr",o,s)}var i=e("inherits"),r=e("./lib/ajax-based"),o=e("./receiver/xhr"),s=e("./sender/xhr-cors"),a=e("./sender/xhr-local");i(n,r),n.enabled=function(e){return e.nullOrigin?!1:a.enabled&&e.sameOrigin?!0:s.enabled},n.transportName="xhr-polling",n.roundTrips=2,t.exports=n},{"./lib/ajax-based":24,"./receiver/xhr":32,"./sender/xhr-cors":35,"./sender/xhr-local":37,inherits:54}],42:[function(e,t){(function(n){function i(e){if(!l.enabled&&!a.enabled)throw new Error("Transport created when disabled");o.call(this,e,"/xhr_streaming",s,a)}var r=e("inherits"),o=e("./lib/ajax-based"),s=e("./receiver/xhr"),a=e("./sender/xhr-cors"),l=e("./sender/xhr-local"),c=e("../utils/browser");r(i,o),i.enabled=function(e){return e.nullOrigin?!1:c.isOpera()?!1:a.enabled},i.transportName="xhr-streaming",i.roundTrips=2,i.needBody=!!n.document,t.exports=i}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../utils/browser":44,"./lib/ajax-based":24,"./receiver/xhr":32,"./sender/xhr-cors":35,"./sender/xhr-local":37,inherits:54}],43:[function(e,t){(function(e){t.exports.randomBytes=e.crypto&&e.crypto.getRandomValues?function(t){var n=new Uint8Array(t);return e.crypto.getRandomValues(n),n}:function(e){for(var t=new Array(e),n=0;e>n;n++)t[n]=Math.floor(256*Math.random());return t}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],44:[function(e,t){(function(e){t.exports={isOpera:function(){return e.navigator&&/opera/i.test(e.navigator.userAgent)},isKonqueror:function(){return e.navigator&&/konqueror/i.test(e.navigator.userAgent)},hasDomain:function(){if(!e.document)return!0;try{return!!e.document.domain}catch(t){return!1}}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],45:[function(e,t){var n,i=e("json3"),r=/[\x00-\x1f\ud800-\udfff\ufffe\uffff\u0300-\u0333\u033d-\u0346\u034a-\u034c\u0350-\u0352\u0357-\u0358\u035c-\u0362\u0374\u037e\u0387\u0591-\u05af\u05c4\u0610-\u0617\u0653-\u0654\u0657-\u065b\u065d-\u065e\u06df-\u06e2\u06eb-\u06ec\u0730\u0732-\u0733\u0735-\u0736\u073a\u073d\u073f-\u0741\u0743\u0745\u0747\u07eb-\u07f1\u0951\u0958-\u095f\u09dc-\u09dd\u09df\u0a33\u0a36\u0a59-\u0a5b\u0a5e\u0b5c-\u0b5d\u0e38-\u0e39\u0f43\u0f4d\u0f52\u0f57\u0f5c\u0f69\u0f72-\u0f76\u0f78\u0f80-\u0f83\u0f93\u0f9d\u0fa2\u0fa7\u0fac\u0fb9\u1939-\u193a\u1a17\u1b6b\u1cda-\u1cdb\u1dc0-\u1dcf\u1dfc\u1dfe\u1f71\u1f73\u1f75\u1f77\u1f79\u1f7b\u1f7d\u1fbb\u1fbe\u1fc9\u1fcb\u1fd3\u1fdb\u1fe3\u1feb\u1fee-\u1fef\u1ff9\u1ffb\u1ffd\u2000-\u2001\u20d0-\u20d1\u20d4-\u20d7\u20e7-\u20e9\u2126\u212a-\u212b\u2329-\u232a\u2adc\u302b-\u302c\uaab2-\uaab3\uf900-\ufa0d\ufa10\ufa12\ufa15-\ufa1e\ufa20\ufa22\ufa25-\ufa26\ufa2a-\ufa2d\ufa30-\ufa6d\ufa70-\ufad9\ufb1d\ufb1f\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufb4e\ufff0-\uffff]/g,o=function(e){var t,n={},i=[];for(t=0;65536>t;t++)i.push(String.fromCharCode(t));return e.lastIndex=0,i.join("").replace(e,function(e){return n[e]="\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4),""}),e.lastIndex=0,n};t.exports={quote:function(e){var t=i.stringify(e);return r.lastIndex=0,r.test(t)?(n||(n=o(r)),t.replace(r,function(e){return n[e]})):t}}},{json3:55}],46:[function(e,t){(function(n){var i=e("./random"),r={},o=!1,s=n.chrome&&n.chrome.app&&n.chrome.app.runtime;t.exports={attachEvent:function(e,t){"undefined"!=typeof n.addEventListener?n.addEventListener(e,t,!1):n.document&&n.attachEvent&&(n.document.attachEvent("on"+e,t),n.attachEvent("on"+e,t))},detachEvent:function(e,t){"undefined"!=typeof n.addEventListener?n.removeEventListener(e,t,!1):n.document&&n.detachEvent&&(n.document.detachEvent("on"+e,t),n.detachEvent("on"+e,t))},unloadAdd:function(e){if(s)return null;var t=i.string(8);return r[t]=e,o&&setTimeout(this.triggerUnloadCallbacks,0),t},unloadDel:function(e){e in r&&delete r[e]},triggerUnloadCallbacks:function(){for(var e in r)r[e](),delete r[e]}};var a=function(){o||(o=!0,t.exports.triggerUnloadCallbacks())};s||t.exports.attachEvent("unload",a)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./random":50}],47:[function(e,t){(function(n){var i=e("./event"),r=e("json3"),o=e("./browser");t.exports={WPrefix:"_jp",currentWindowId:null,polluteGlobalNamespace:function(){t.exports.WPrefix in n||(n[t.exports.WPrefix]={})},postMessage:function(e,i){n.parent!==n&&n.parent.postMessage(r.stringify({windowId:t.exports.currentWindowId,type:e,data:i||""}),"*")},createIframe:function(e,t){var r,o,s=n.document.createElement("iframe"),a=function(){clearTimeout(r);try{s.onload=null}catch(e){}s.onerror=null},l=function(){s&&(a(),setTimeout(function(){s&&s.parentNode.removeChild(s),s=null},0),i.unloadDel(o))},c=function(e){s&&(l(),t(e))},d=function(e,t){try{s&&s.contentWindow&&setTimeout(function(){s.contentWindow.postMessage(e,t)},0)}catch(n){}};return s.src=e,s.style.display="none",s.style.position="absolute",s.onerror=function(){c("onerror")},s.onload=function(){clearTimeout(r),r=setTimeout(function(){c("onload timeout")},2e3)},n.document.body.appendChild(s),r=setTimeout(function(){c("timeout")},15e3),o=i.unloadAdd(l),{post:d,cleanup:l,loaded:a}},createHtmlfile:function(e,r){var o,s,a,l=["Active"].concat("Object").join("X"),c=new n[l]("htmlfile"),d=function(){clearTimeout(o),a.onerror=null},u=function(){c&&(d(),i.unloadDel(s),a.parentNode.removeChild(a),a=c=null,CollectGarbage())},h=function(e){c&&(u(),r(e))},p=function(e,t){try{a&&a.contentWindow&&setTimeout(function(){a.contentWindow.postMessage(e,t)},0)}catch(n){}};c.open(),c.write('<html><script>document.domain="'+n.document.domain+'";</script></html>'),c.close(),c.parentWindow[t.exports.WPrefix]=n[t.exports.WPrefix];var f=c.createElement("div");return c.body.appendChild(f),a=c.createElement("iframe"),f.appendChild(a),a.src=e,a.onerror=function(){h("onerror")},o=setTimeout(function(){h("timeout")},15e3),s=i.unloadAdd(u),{post:p,cleanup:u,loaded:d}}},t.exports.iframeEnabled=!1,n.document&&(t.exports.iframeEnabled=("function"==typeof n.postMessage||"object"==typeof n.postMessage)&&!o.isKonqueror())}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./browser":44,"./event":46,debug:void 0,json3:55}],48:[function(e,t){(function(e){var n={};["log","debug","warn"].forEach(function(t){var i=e.console&&e.console[t]&&e.console[t].apply;n[t]=i?function(){return e.console[t].apply(e.console,arguments)}:"log"===t?function(){}:n.log}),t.exports=n}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],49:[function(e,t){t.exports={isObject:function(e){var t=typeof e;return"function"===t||"object"===t&&!!e},extend:function(e){if(!this.isObject(e))return e;for(var t,n,i=1,r=arguments.length;r>i;i++){t=arguments[i];for(n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e}}},{}],50:[function(e,t){var n=e("crypto"),i="abcdefghijklmnopqrstuvwxyz012345";t.exports={string:function(e){for(var t=i.length,r=n.randomBytes(e),o=[],s=0;e>s;s++)o.push(i.substr(r[s]%t,1));return o.join("")},number:function(e){return Math.floor(Math.random()*e)},numberString:function(e){var t=(""+(e-1)).length,n=new Array(t+1).join("0");return(n+this.number(e)).slice(-t)}}},{crypto:43}],51:[function(e,t){t.exports=function(e){return{filterToEnabled:function(t,n){var i={main:[],facade:[]};return t?"string"==typeof t&&(t=[t]):t=[],e.forEach(function(e){e&&("websocket"!==e.transportName||n.websocket!==!1)&&(t.length&&-1===t.indexOf(e.transportName)||e.enabled(n)&&(i.main.push(e),e.facadeTransport&&i.facade.push(e.facadeTransport)))}),i}}}},{debug:void 0}],52:[function(e,t){var n=e("url-parse");t.exports={getOrigin:function(e){if(!e)return null;var t=new n(e);if("file:"===t.protocol)return null;var i=t.port;return i||(i="https:"===t.protocol?"443":"80"),t.protocol+"//"+t.hostname+":"+i},isOriginEqual:function(e,t){var n=this.getOrigin(e)===this.getOrigin(t);return n},isSchemeEqual:function(e,t){return e.split(":")[0]===t.split(":")[0]},addPath:function(e,t){var n=e.split("?");return n[0]+t+(n[1]?"?"+n[1]:"")},addQuery:function(e,t){return e+(-1===e.indexOf("?")?"?"+t:"&"+t)}}},{debug:void 0,"url-parse":56}],53:[function(e,t){t.exports="1.0.1"},{}],54:[function(e,t){t.exports="function"==typeof Object.create?function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},{}],55:[function(t,n,i){(function(t){(function(){function r(e,t){function n(e){if(n[e]!==g)return n[e];var r;if("bug-string-char-index"==e)r="a"!="a"[0];else if("json"==e)r=n("json-stringify")&&n("json-parse");else{var s,a='{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}';if("json-stringify"==e){var l=t.stringify,d="function"==typeof l&&y;if(d){(s=function(){return 1}).toJSON=s;try{d="0"===l(0)&&"0"===l(new i)&&'""'==l(new o)&&l(b)===g&&l(g)===g&&l()===g&&"1"===l(s)&&"[1]"==l([s])&&"[null]"==l([g])&&"null"==l(null)&&"[null,null,null]"==l([g,b,null])&&l({a:[s,!0,!1,null,"\x00\b\n\f\r	"]})==a&&"1"===l(null,s)&&"[\n 1,\n 2\n]"==l([1,2],null,1)&&'"-271821-04-20T00:00:00.000Z"'==l(new c(-864e13))&&'"+275760-09-13T00:00:00.000Z"'==l(new c(864e13))&&'"-000001-01-01T00:00:00.000Z"'==l(new c(-621987552e5))&&'"1969-12-31T23:59:59.999Z"'==l(new c(-1))}catch(u){d=!1}}r=d}if("json-parse"==e){var h=t.parse;if("function"==typeof h)try{if(0===h("0")&&!h(!1)){s=h(a);var p=5==s.a.length&&1===s.a[0];if(p){try{p=!h('"	"')}catch(u){}if(p)try{p=1!==h("01")}catch(u){}if(p)try{p=1!==h("1.")}catch(u){}}}}catch(u){p=!1}r=p}}return n[e]=!!r}e||(e=l.Object()),t||(t=l.Object());var i=e.Number||l.Number,o=e.String||l.String,a=e.Object||l.Object,c=e.Date||l.Date,d=e.SyntaxError||l.SyntaxError,u=e.TypeError||l.TypeError,h=e.Math||l.Math,p=e.JSON||l.JSON;"object"==typeof p&&p&&(t.stringify=p.stringify,t.parse=p.parse);var f,m,g,v=a.prototype,b=v.toString,y=new c(-0xc782b5b800cec);try{y=-109252==y.getUTCFullYear()&&0===y.getUTCMonth()&&1===y.getUTCDate()&&10==y.getUTCHours()&&37==y.getUTCMinutes()&&6==y.getUTCSeconds()&&708==y.getUTCMilliseconds()}catch(_){}if(!n("json")){var w="[object Function]",E="[object Date]",C="[object Number]",T="[object String]",S="[object Array]",k="[object Boolean]",$=n("bug-string-char-index");if(!y)var x=h.floor,A=[0,31,59,90,120,151,181,212,243,273,304,334],P=function(e,t){return A[t]+365*(e-1970)+x((e-1969+(t=+(t>1)))/4)-x((e-1901+t)/100)+x((e-1601+t)/400)};if((f=v.hasOwnProperty)||(f=function(e){var t,n={};return(n.__proto__=null,n.__proto__={toString:1},n).toString!=b?f=function(e){var t=this.__proto__,n=e in(this.__proto__=null,this);return this.__proto__=t,n}:(t=n.constructor,f=function(e){var n=(this.constructor||t).prototype;return e in this&&!(e in n&&this[e]===n[e])}),n=null,f.call(this,e)}),m=function(e,t){var n,i,r,o=0;(n=function(){this.valueOf=0}).prototype.valueOf=0,i=new n;for(r in i)f.call(i,r)&&o++;return n=i=null,o?m=2==o?function(e,t){var n,i={},r=b.call(e)==w;for(n in e)r&&"prototype"==n||f.call(i,n)||!(i[n]=1)||!f.call(e,n)||t(n)}:function(e,t){var n,i,r=b.call(e)==w;for(n in e)r&&"prototype"==n||!f.call(e,n)||(i="constructor"===n)||t(n);(i||f.call(e,n="constructor"))&&t(n)}:(i=["valueOf","toString","toLocaleString","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","constructor"],m=function(e,t){var n,r,o=b.call(e)==w,a=!o&&"function"!=typeof e.constructor&&s[typeof e.hasOwnProperty]&&e.hasOwnProperty||f;for(n in e)o&&"prototype"==n||!a.call(e,n)||t(n);for(r=i.length;n=i[--r];a.call(e,n)&&t(n));}),m(e,t)},!n("json-stringify")){var R={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"},O="000000",N=function(e,t){return(O+(t||0)).slice(-e)},M="\\u00",I=function(e){for(var t='"',n=0,i=e.length,r=!$||i>10,o=r&&($?e.split(""):e);i>n;n++){var s=e.charCodeAt(n);switch(s){case 8:case 9:case 10:case 12:case 13:case 34:case 92:t+=R[s];break;default:if(32>s){t+=M+N(2,s.toString(16));break}t+=r?o[n]:e.charAt(n)}}return t+'"'},D=function(e,t,n,i,r,o,s){var a,l,c,d,h,p,v,y,_,w,$,A,R,O,M,F;try{a=t[e]}catch(L){}if("object"==typeof a&&a)if(l=b.call(a),l!=E||f.call(a,"toJSON"))"function"==typeof a.toJSON&&(l!=C&&l!=T&&l!=S||f.call(a,"toJSON"))&&(a=a.toJSON(e));else if(a>-1/0&&1/0>a){if(P){for(h=x(a/864e5),c=x(h/365.2425)+1970-1;P(c+1,0)<=h;c++);for(d=x((h-P(c,0))/30.42);P(c,d+1)<=h;d++);h=1+h-P(c,d),p=(a%864e5+864e5)%864e5,v=x(p/36e5)%24,y=x(p/6e4)%60,_=x(p/1e3)%60,w=p%1e3}else c=a.getUTCFullYear(),d=a.getUTCMonth(),h=a.getUTCDate(),v=a.getUTCHours(),y=a.getUTCMinutes(),_=a.getUTCSeconds(),w=a.getUTCMilliseconds();a=(0>=c||c>=1e4?(0>c?"-":"+")+N(6,0>c?-c:c):N(4,c))+"-"+N(2,d+1)+"-"+N(2,h)+"T"+N(2,v)+":"+N(2,y)+":"+N(2,_)+"."+N(3,w)+"Z"}else a=null;if(n&&(a=n.call(t,e,a)),null===a)return"null";if(l=b.call(a),l==k)return""+a;if(l==C)return a>-1/0&&1/0>a?""+a:"null";if(l==T)return I(""+a);if("object"==typeof a){for(O=s.length;O--;)if(s[O]===a)throw u();if(s.push(a),$=[],M=o,o+=r,l==S){for(R=0,O=a.length;O>R;R++)A=D(R,a,n,i,r,o,s),$.push(A===g?"null":A);F=$.length?r?"[\n"+o+$.join(",\n"+o)+"\n"+M+"]":"["+$.join(",")+"]":"[]"}else m(i||a,function(e){var t=D(e,a,n,i,r,o,s);t!==g&&$.push(I(e)+":"+(r?" ":"")+t)}),F=$.length?r?"{\n"+o+$.join(",\n"+o)+"\n"+M+"}":"{"+$.join(",")+"}":"{}";return s.pop(),F}};t.stringify=function(e,t,n){var i,r,o,a;if(s[typeof t]&&t)if((a=b.call(t))==w)r=t;else if(a==S){o={};for(var l,c=0,d=t.length;d>c;l=t[c++],a=b.call(l),(a==T||a==C)&&(o[l]=1));}if(n)if((a=b.call(n))==C){if((n-=n%1)>0)for(i="",n>10&&(n=10);i.length<n;i+=" ");}else a==T&&(i=n.length<=10?n:n.slice(0,10));return D("",(l={},l[""]=e,l),r,o,i,"",[])}}if(!n("json-parse")){var F,L,B=o.fromCharCode,j={92:"\\",34:'"',47:"/",98:"\b",116:"	",110:"\n",102:"\f",114:"\r"},U=function(){throw F=L=null,d()},V=function(){for(var e,t,n,i,r,o=L,s=o.length;s>F;)switch(r=o.charCodeAt(F)){case 9:case 10:case 13:case 32:F++;break;case 123:case 125:case 91:case 93:case 58:case 44:return e=$?o.charAt(F):o[F],F++,e;case 34:for(e="@",F++;s>F;)if(r=o.charCodeAt(F),32>r)U();else if(92==r)switch(r=o.charCodeAt(++F)){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:e+=j[r],F++;break;case 117:for(t=++F,n=F+4;n>F;F++)r=o.charCodeAt(F),r>=48&&57>=r||r>=97&&102>=r||r>=65&&70>=r||U();e+=B("0x"+o.slice(t,F));break;default:U()}else{if(34==r)break;for(r=o.charCodeAt(F),t=F;r>=32&&92!=r&&34!=r;)r=o.charCodeAt(++F);e+=o.slice(t,F)}if(34==o.charCodeAt(F))return F++,e;U();default:if(t=F,45==r&&(i=!0,r=o.charCodeAt(++F)),r>=48&&57>=r){for(48==r&&(r=o.charCodeAt(F+1),r>=48&&57>=r)&&U(),i=!1;s>F&&(r=o.charCodeAt(F),r>=48&&57>=r);F++);if(46==o.charCodeAt(F)){for(n=++F;s>n&&(r=o.charCodeAt(n),r>=48&&57>=r);n++);n==F&&U(),F=n}if(r=o.charCodeAt(F),101==r||69==r){for(r=o.charCodeAt(++F),(43==r||45==r)&&F++,n=F;s>n&&(r=o.charCodeAt(n),r>=48&&57>=r);n++);n==F&&U(),F=n}return+o.slice(t,F)}if(i&&U(),"true"==o.slice(F,F+4))return F+=4,!0;if("false"==o.slice(F,F+5))return F+=5,!1;if("null"==o.slice(F,F+4))return F+=4,null;U()}return"$"},G=function(e){var t,n;if("$"==e&&U(),"string"==typeof e){if("@"==($?e.charAt(0):e[0]))return e.slice(1);if("["==e){for(t=[];e=V(),"]"!=e;n||(n=!0))n&&(","==e?(e=V(),"]"==e&&U()):U()),","==e&&U(),t.push(G(e));return t}if("{"==e){for(t={};e=V(),"}"!=e;n||(n=!0))n&&(","==e?(e=V(),"}"==e&&U()):U()),(","==e||"string"!=typeof e||"@"!=($?e.charAt(0):e[0])||":"!=V())&&U(),t[e.slice(1)]=G(V());return t}U()}return e},K=function(e,t,n){var i=H(e,t,n);i===g?delete e[t]:e[t]=i},H=function(e,t,n){var i,r=e[t];if("object"==typeof r&&r)if(b.call(r)==S)for(i=r.length;i--;)K(r,i,n);else m(r,function(e){K(r,e,n)});return n.call(e,t,r)};t.parse=function(e,t){var n,i;return F=0,L=""+e,n=G(V()),"$"!=V()&&U(),F=L=null,t&&b.call(t)==w?H((i={},i[""]=n,i),"",t):n}}}return t.runInContext=r,t}var o="function"==typeof e&&e.amd,s={"function":!0,object:!0},a=s[typeof i]&&i&&!i.nodeType&&i,l=s[typeof window]&&window||this,c=a&&s[typeof n]&&n&&!n.nodeType&&"object"==typeof t&&t;if(!c||c.global!==c&&c.window!==c&&c.self!==c||(l=c),a&&!o)r(l,a);else{var d=l.JSON,u=l.JSON3,h=!1,p=r(l,l.JSON3={noConflict:function(){return h||(h=!0,l.JSON=d,l.JSON3=u,d=u=null),p}});l.JSON={parse:p.parse,stringify:p.stringify}}o&&e(function(){return p})}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],56:[function(e,t){function n(e,t,l){if(!(this instanceof n))return new n(e,t,l);var c,d,u,h,p=s.test(e),f=typeof t,m=this,g=0;for("object"!==f&&"string"!==f&&(l=t,t=null),l&&"function"!=typeof l&&(l=o.parse),t=r(t);g<a.length;g++)d=a[g],c=d[0],h=d[1],c!==c?m[h]=e:"string"==typeof c?~(u=e.indexOf(c))&&("number"==typeof d[2]?(m[h]=e.slice(0,u),e=e.slice(u+d[2])):(m[h]=e.slice(u),e=e.slice(0,u))):(u=c.exec(e))&&(m[h]=u[1],e=e.slice(0,e.length-u[0].length)),m[h]=m[h]||(d[3]||"port"===h&&p?t[h]||"":""),d[4]&&(m[h]=m[h].toLowerCase());l&&(m.query=l(m.query)),i(m.port,m.protocol)||(m.host=m.hostname,m.port=""),m.username=m.password="",m.auth&&(d=m.auth.split(":"),m.username=d[0]||"",m.password=d[1]||""),m.href=m.toString()}var i=e("requires-port"),r=e("./lolcation"),o=e("querystringify"),s=/^\/(?!\/)/,a=[["#","hash"],["?","query"],["//","protocol",2,1,1],["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/\:(\d+)$/,"port"],[NaN,"hostname",void 0,1,1]];n.prototype.set=function(e,t,n){var r=this;return"query"===e?("string"==typeof t&&(t=(n||o.parse)(t)),r[e]=t):"port"===e?(r[e]=t,i(t,r.protocol)?t&&(r.host=r.hostname+":"+t):(r.host=r.hostname,r[e]="")):"hostname"===e?(r[e]=t,r.port&&(t+=":"+r.port),r.host=t):"host"===e?(r[e]=t,/\:\d+/.test(t)&&(t=t.split(":"),r.hostname=t[0],r.port=t[1])):r[e]=t,r.href=r.toString(),r},n.prototype.toString=function(e){e&&"function"==typeof e||(e=o.stringify);var t,n=this,i=n.protocol+"//";return n.username&&(i+=n.username,n.password&&(i+=":"+n.password),i+="@"),i+=n.hostname,n.port&&(i+=":"+n.port),i+=n.pathname,n.query&&(t="object"==typeof n.query?e(n.query):n.query,i+=("?"===t.charAt(0)?"":"?")+t),n.hash&&(i+=n.hash),i},n.qs=o,n.location=r,t.exports=n},{"./lolcation":57,querystringify:58,"requires-port":59}],57:[function(e,t){(function(n){var i,r={hash:1,query:1};t.exports=function(t){t=t||n.location||{},i=i||e("./");var o,s={},a=typeof t;if("blob:"===t.protocol)s=new i(unescape(t.pathname),{});else if("string"===a){s=new i(t,{});for(o in r)delete s[o]}else if("object"===a)for(o in t)o in r||(s[o]=t[o]);return s}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./":56}],58:[function(e,t,n){function i(e){for(var t,n=/([^=?&]+)=([^&]*)/g,i={};t=n.exec(e);i[decodeURIComponent(t[1])]=decodeURIComponent(t[2]));return i}function r(e,t){t=t||"";var n=[];"string"!=typeof t&&(t="?");for(var i in e)o.call(e,i)&&n.push(encodeURIComponent(i)+"="+encodeURIComponent(e[i]));return n.length?t+n.join("&"):""}var o=Object.prototype.hasOwnProperty;n.stringify=r,n.parse=i},{}],59:[function(e,t){t.exports=function(e,t){if(t=t.split(":")[0],e=+e,!e)return!1;switch(t){case"http":case"ws":return 80!==e;case"https":case"wss":return 443!==e;case"ftp":return 22!==e;case"gopher":return 70!==e;case"file":return!1}return 0!==e}},{}]},{},[1])(1)}),function(){var e,t,n,i,r={}.hasOwnProperty,o=[].slice;e={LF:"\n",NULL:"\x00"},n=function(){function t(e,t,n){this.command=e,this.headers=null!=t?t:{},this.body=null!=n?n:""}var n;return t.prototype.toString=function(){var n,i,o,s,a;n=[this.command],o=this.headers["content-length"]===!1?!0:!1,o&&delete this.headers["content-length"],a=this.headers;for(i in a)r.call(a,i)&&(s=a[i],n.push(""+i+":"+s));return this.body&&!o&&n.push("content-length:"+t.sizeOfUTF8(this.body)),n.push(e.LF+this.body),n.join(e.LF)},t.sizeOfUTF8=function(e){return e?encodeURI(e).match(/%..|./g).length:0},n=function(n){var i,r,o,s,a,l,c,d,u,h,p,f,m,g,v,b,y;for(s=n.search(RegExp(""+e.LF+e.LF)),a=n.substring(0,s).split(e.LF),o=a.shift(),l={},f=function(e){return e.replace(/^\s+|\s+$/g,"")},b=a.reverse(),m=0,v=b.length;v>m;m++)h=b[m],d=h.indexOf(":"),l[f(h.substring(0,d))]=f(h.substring(d+1));if(i="",p=s+2,l["content-length"])u=parseInt(l["content-length"]),i=(""+n).substring(p,p+u);else for(r=null,c=g=p,y=n.length;(y>=p?y>g:g>y)&&(r=n.charAt(c),r!==e.NULL);c=y>=p?++g:--g)i+=r;return new t(o,l,i)},t.unmarshall=function(t){var i,r,o,s;return r=t.split(RegExp(""+e.NULL+e.LF+"*")),s={frames:[],partial:""},s.frames=function(){var e,t,o,s;for(o=r.slice(0,-1),s=[],e=0,t=o.length;t>e;e++)i=o[e],s.push(n(i));return s}(),o=r.slice(-1)[0],o===e.LF||-1!==o.search(RegExp(""+e.NULL+e.LF+"*$"))?s.frames.push(n(o)):s.partial=o,s},t.marshall=function(n,i,r){var o;return o=new t(n,i,r),o.toString()+e.NULL},t}(),t=function(){function t(e){this.ws=e,this.ws.binaryType="arraybuffer",this.counter=0,this.connected=!1,this.heartbeat={outgoing:1e4,incoming:1e4},this.maxWebSocketFrameSize=16384,this.subscriptions={},this.partialData=""}var r;return t.prototype.debug=function(e){var t;return"undefined"!=typeof window&&null!==window&&null!=(t=window.console)?t.log(e):void 0},r=function(){return Date.now?Date.now():(new Date).valueOf},t.prototype._transmit=function(e,t,i){var r;for(r=n.marshall(e,t,i),"function"==typeof this.debug&&this.debug(">>> "+r);;){if(!(r.length>this.maxWebSocketFrameSize))return this.ws.send(r);this.ws.send(r.substring(0,this.maxWebSocketFrameSize)),r=r.substring(this.maxWebSocketFrameSize),"function"==typeof this.debug&&this.debug("remaining = "+r.length)}},t.prototype._setupHeartbeat=function(t){var n,o,s,a,l,c;if((l=t.version)===i.VERSIONS.V1_1||l===i.VERSIONS.V1_2)return c=function(){var e,n,i,r;for(i=t["heart-beat"].split(","),r=[],e=0,n=i.length;n>e;e++)a=i[e],r.push(parseInt(a));return r}(),o=c[0],n=c[1],0!==this.heartbeat.outgoing&&0!==n&&(s=Math.max(this.heartbeat.outgoing,n),"function"==typeof this.debug&&this.debug("send PING every "+s+"ms"),this.pinger=i.setInterval(s,function(t){return function(){return t.ws.send(e.LF),"function"==typeof t.debug?t.debug(">>> PING"):void 0}}(this))),0!==this.heartbeat.incoming&&0!==o?(s=Math.max(this.heartbeat.incoming,o),"function"==typeof this.debug&&this.debug("check PONG every "+s+"ms"),this.ponger=i.setInterval(s,function(e){return function(){var t;return t=r()-e.serverActivity,t>2*s?("function"==typeof e.debug&&e.debug("did not receive server activity for the last "+t+"ms"),e.ws.close()):void 0}}(this))):void 0},t.prototype._parseConnect=function(){var e,t,n,i;switch(e=1<=arguments.length?o.call(arguments,0):[],i={},e.length){case 2:i=e[0],t=e[1];break;case 3:e[1]instanceof Function?(i=e[0],t=e[1],n=e[2]):(i.login=e[0],i.passcode=e[1],t=e[2]);break;case 4:i.login=e[0],i.passcode=e[1],t=e[2],n=e[3];break;default:i.login=e[0],i.passcode=e[1],t=e[2],n=e[3],i.host=e[4]}return[i,t,n]},t.prototype.connect=function(){var t,s,a,l;return t=1<=arguments.length?o.call(arguments,0):[],l=this._parseConnect.apply(this,t),a=l[0],this.connectCallback=l[1],s=l[2],"function"==typeof this.debug&&this.debug("Opening Web Socket..."),this.ws.onmessage=function(t){return function(i){var o,a,l,c,d,u,h,p,f,m,g,v,b;if(c="undefined"!=typeof ArrayBuffer&&i.data instanceof ArrayBuffer?(o=new Uint8Array(i.data),"function"==typeof t.debug?t.debug("--- got data length: "+o.length):void 0,function(){var e,t,n;for(n=[],e=0,t=o.length;t>e;e++)a=o[e],n.push(String.fromCharCode(a));return n}().join("")):i.data,t.serverActivity=r(),c===e.LF)return void("function"==typeof t.debug&&t.debug("<<< PONG"));for("function"==typeof t.debug&&t.debug("<<< "+c),f=n.unmarshall(t.partialData+c),t.partialData=f.partial,v=f.frames,b=[],m=0,g=v.length;g>m;m++)switch(d=v[m],d.command){case"CONNECTED":"function"==typeof t.debug&&t.debug("connected to server "+d.headers.server),t.connected=!0,t._setupHeartbeat(d.headers),b.push("function"==typeof t.connectCallback?t.connectCallback(d):void 0);break;case"MESSAGE":p=d.headers.subscription,h=t.subscriptions[p]||t.onreceive,h?(l=t,u=d.headers["message-id"],d.ack=function(e){return null==e&&(e={}),l.ack(u,p,e)},d.nack=function(e){return null==e&&(e={}),l.nack(u,p,e)},b.push(h(d))):b.push("function"==typeof t.debug?t.debug("Unhandled received MESSAGE: "+d):void 0);break;case"RECEIPT":b.push("function"==typeof t.onreceipt?t.onreceipt(d):void 0);break;case"ERROR":b.push("function"==typeof s?s(d):void 0);break;default:b.push("function"==typeof t.debug?t.debug("Unhandled frame: "+d):void 0)}return b}}(this),this.ws.onclose=function(e){return function(){var t;return t="Whoops! Lost connection to "+e.ws.url,"function"==typeof e.debug&&e.debug(t),e._cleanUp(),"function"==typeof s?s(t):void 0}}(this),this.ws.onopen=function(e){return function(){return"function"==typeof e.debug&&e.debug("Web Socket Opened..."),a["accept-version"]=i.VERSIONS.supportedVersions(),a["heart-beat"]=[e.heartbeat.outgoing,e.heartbeat.incoming].join(","),e._transmit("CONNECT",a)}}(this)},t.prototype.disconnect=function(e,t){return null==t&&(t={}),this._transmit("DISCONNECT",t),this.ws.onclose=null,this.ws.close(),this._cleanUp(),"function"==typeof e?e():void 0},t.prototype._cleanUp=function(){return this.connected=!1,this.pinger&&i.clearInterval(this.pinger),this.ponger?i.clearInterval(this.ponger):void 0},t.prototype.send=function(e,t,n){return null==t&&(t={}),null==n&&(n=""),t.destination=e,this._transmit("SEND",t,n)},t.prototype.subscribe=function(e,t,n){var i;return null==n&&(n={}),n.id||(n.id="sub-"+this.counter++),n.destination=e,this.subscriptions[n.id]=t,this._transmit("SUBSCRIBE",n),i=this,{id:n.id,unsubscribe:function(){return i.unsubscribe(n.id)}}},t.prototype.unsubscribe=function(e){return delete this.subscriptions[e],this._transmit("UNSUBSCRIBE",{id:e})},t.prototype.begin=function(e){var t,n;return n=e||"tx-"+this.counter++,this._transmit("BEGIN",{transaction:n}),t=this,{id:n,commit:function(){return t.commit(n)},abort:function(){return t.abort(n)}}},t.prototype.commit=function(e){return this._transmit("COMMIT",{transaction:e})},t.prototype.abort=function(e){return this._transmit("ABORT",{transaction:e})},t.prototype.ack=function(e,t,n){return null==n&&(n={}),n["message-id"]=e,n.subscription=t,this._transmit("ACK",n)},t.prototype.nack=function(e,t,n){return null==n&&(n={}),n["message-id"]=e,
n.subscription=t,this._transmit("NACK",n)},t}(),i={VERSIONS:{V1_0:"1.0",V1_1:"1.1",V1_2:"1.2",supportedVersions:function(){return"1.1,1.0"}},client:function(e,n){var r,o;return null==n&&(n=["v10.stomp","v11.stomp"]),r=i.WebSocketClass||WebSocket,o=new r(e,n),new t(o)},over:function(e){return new t(e)},Frame:n},"undefined"!=typeof exports&&null!==exports&&(exports.Stomp=i),"undefined"!=typeof window&&null!==window?(i.setInterval=function(e,t){return window.setInterval(t,e)},i.clearInterval=function(e){return window.clearInterval(e)},window.Stomp=i):exports||(self.Stomp=i)}.call(this),define("stomp",function(e){return function(){var t;return t||e.Stomp}}(this)),define("service/rabbitmqWebStompService",["core/subscriber","sockjs","stomp"],function(e,t,n){var i=function(){e.prototype.constructor.apply(this),this.ws=null,this.client=null,this.bind__messageCallback=this._messageCallback.bind(this)};return i.extend(e),i.Event={CONNECTED:"eventConnected",DISCONNECTED:"eventDisconnected",MESSAGE:"eventMessage"},i.prototype.isConnected=function(){return this.ws&&this.client},i.prototype.connect=function(){if(!this.isConnected()){this.ws=new t(window.location.protocol+"//"+window.location.hostname+"/stomp"),this.client=n.over(this.ws),this.client.heartbeat.incoming=0,this.client.heartbeat.outgoing=0;var e=function(){this._dispatch(i.Event.CONNECTED)}.bind(this),r=function(e){console.error(e)};this.client.connect("test","test",e,r,"/")}},i.prototype.disconnect=function(){this.client.disconnect(function(){this._dispatch(i.Event.DISCONNECTED)}.bind(this)),this.client=null,this.ws=null},i.prototype._messageCallback=function(e){console.log(e),this._dispatch(i.Event.MESSAGE,{message:JSON.parse(e.body)})},i.prototype.subscribe=function(t,n,i){return e.prototype.subscribe.call(this,n,i),t?this.client.subscribe(t,this.bind__messageCallback):void 0},i.prototype.unsubscribe=function(t,n){e.prototype.unsubscribe.call(this,n),t&&this.client.unsubscribe(t.id)},i}),define("service/subscriberService",["core/subscriber"],function(e){var t=function(){e.prototype.constructor.apply(this)};return t.extend(e),t.prototype.dispatch=function(t,n,i){i=i||{},i.tag=t,e.prototype._dispatch.call(this,n,i)},t}),define("service/threadPostService",["core/subscriber","underscore"],function(e){var t=function(){e.prototype.constructor.apply(this),this.name="ThreadPost"};return t.extend(e),t.Event={ADD:"eventAdd",REPLACE:"eventUpdate",REMOVE:"eventRemove"},t.prototype.subscribe=function(n){_.each(t.Event,function(t,i,r){e.prototype.subscribe.call(this,t,n)}.bind(this))},t.prototype.dispatch=function(t,n){e.prototype._dispatch.call(this,t,n)},t}),define("model/forumModel",["model/model","model/mediaModel","extra"],function(e,t){var n=function(n){e.prototype.constructor.apply(this,arguments),this.data.ordered_media&&this.data.ordered_media.forEach(function(e,n,i){i[n]=new t(e)})};return n.extend(e),n}),define("model/groupModel",["model/model","model/mediaModel","extra"],function(e,t){var n=function(n){e.prototype.constructor.apply(this,arguments),this.data.ordered_media&&this.data.ordered_media.forEach(function(e,n,i){i[n]=new t(e)})};return n.extend(e),n}),define("model/messageModel",["model/model","model/mediaModel","extra"],function(e,t){var n=function(n){e.prototype.constructor.apply(this,arguments),this.data.ordered_media&&this.data.ordered_media.forEach(function(e,n,i){i[n]=new t(e)})};return n.extend(e),n}),define("model/myFilesModel",["model/model","model/mediaModel","extra","underscore"],function(e,t){var n=function(n){if(e.prototype.constructor.apply(this,arguments),this.data.media){var i=this.data.media;this.data.media=[],_.each(i,function(n,i,r){var o=new t(n);o.subscribe(e.Event.CHANGE,function(t){var n=_.findIndex(this.data.media,t.model);n>-1&&this._dispatch(e.Event.CHANGE,"media."+n)}.bind(this)),this.data.media.push(o)},this),i=null}};return n.extend(e),n.prototype.addMedia=function(n){var i=new t(n);i.subscribe(e.Event.CHANGE,function(t){var n=_.findIndex(this.data.media,t.model);n>-1&&this._dispatch(e.Event.CHANGE,"media."+n)}.bind(this)),this.data.media.push(i)},n.prototype.getMedia=function(e){return _.find(this.data.media,function(t){return t.get("id")==e})},n}),define("model/profileModel",["model/model","extra"],function(e){var t=function(t){e.prototype.constructor.apply(this,arguments)};return t.extend(e),t}),define("model/threadModel",["model/model","model/postModel","extra","underscore"],function(e,t){var n=function(n){e.prototype.constructor.apply(this,arguments),this.data.keyPoints=[],this.data.posts&&this.data.posts.forEach(function(e,n,i){i[n]=new t(e)})};return n.extend(e),n.prototype.addKeyPoint=function(t){this.removeKeyPoint(t.id),this.data.keyPoints.push(t),this._dispatch(e.Event.CHANGE,"keyPoints."+(this.data.keyPoints.length-1))},n.prototype._findKeyPoint=function(e){for(var t in this.data.keyPoints)if(this.data.keyPoints[t].id==e)return t},n.prototype.setKeyPointProperty=function(e,t,n,i){var r=this._findKeyPoint(e);r>-1&&this.set("keyPoints."+r+"."+t,n,i)},n.prototype.removeKeyPoint=function(t){var n=this._findKeyPoint(t);n>-1&&(this.data.keyPoints.splice(n,1),this._dispatch(e.Event.CHANGE,"keyPoints"))},n.prototype.forceChangeKeyPoint=function(e,t){var n=this._findKeyPoint(e);n>-1&&this.forceChange("keyPoints."+n+"."+t)},n.prototype.addPost=function(e,t){var n=this.get("posts",[]);this.set("posts."+n.length,e,!1),this.forceChange("posts."+(n.length-1),{isNew:!0,view:t})},n.prototype.removePost=function(e,t){var n=this.get("posts"),i=this.find(e.get("id"),"id",n);if(i>-1){n.splice(i,1);var r=[];_.each(n,function(t,n,i){t.get("parent_post_id")==e.get("id")&&r.push(t)}),this.set("posts",_.difference(n,r))}},n.prototype.forceChangePost=function(e,t){var n=this.find(e.get("id"),"id",this.get("posts"));n>-1&&this.forceChange("posts."+n,{view:t})},n}),define("model/userModel",["model/model","extra","underscore"],function(e){var t=function(t){e.prototype.constructor.apply(this,arguments)};return t.extend(e),t.prototype.isUserOnFriendsList=function(e){return _.contains(this.get("friends_list"),e)},t.prototype.isUserOnMentorList=function(e){return _.contains(this.get("mentor_list"),e)},t.prototype.isUserOnMenteeList=function(e){return _.contains(this.get("mentee_list"),e)},t.prototype.isUserOnInvitedMentorList=function(e){var t=_.find(this.get("created_invitations"),function(t){return!(t.recipient!=e||t.isMentor||t.isAccepted||t.isCancelled||t.isDeclined)});return"undefined"!==t},t.prototype.isUserOnInvitedMenteeList=function(e){var t=_.find(this.get("created_invitations"),function(t){return!(t.recipient!=e||t.isMentee||t.isAccepted||t.isCancelled||t.isDeclined)});return"undefined"!==t},t}),define("controller/contactController",["factory/contactFactory"],function(e){var t=function(e,n){console.log("%s: %s- model=%o, options=%o",t.TAG,"constructor",e,n),this.model=e,this.options=n,$tt._instances.push(this)};return t.TAG="Contact",t.prototype.onViewLoaded=function(){},t.prototype["delete"]=function(t,n){return e["delete"](t,n).done(function(e){window.location.reload(!0)})},t}),define("controller/forumController",["factory/forumFactory"],function(e){var t=function(e,n){console.log("%s: %s- model=%o, options=%o",t.TAG,"constructor",e,n),this.model=e,this.options=n,$tt._instances.push(this)};return t.TAG="Forum",t.prototype.onViewLoaded=function(){},t.prototype["delete"]=function(){return e["delete"](this.model).done(function(e){window.location.assign(e.redirect_url)})},t}),define("controller/groupController",["factory/groupFactory"],function(e){var t=function(e,n){console.log("%s: %s- model=%o, options=%o",t.TAG,"constructor",e,n),this.model=e,this.options=n,$tt._instances.push(this)};return t.TAG="Group",t.prototype.onViewLoaded=function(){},t.prototype["delete"]=function(){return e["delete"](this.model).done(function(e){window.location.assign(e.redirect_url)})},t}),define("controller/messageController",["factory/messageFactory"],function(e){var t=function(e,n){console.log("%s: %s- model=%o, options=%o",t.TAG,"constructor",e,n),this.model=e,this.options=n,$tt._instances.push(this)};return t.TAG="Message",t.prototype.onViewLoaded=function(){this.model.get("id")&&this.markAsRead()},t.prototype.markAsRead=function(){return e.edit(this.model)},t}),define("controller/myFilesController",["factory/mediaFactory"],function(e){var t=function(e,n){console.log("%s: %s- model=%o, options=%o",t.TAG,"constructor",e,n),this.model=e,this.options=n,$tt._instances.push(this)};return t.TAG="MyFiles",t.prototype.onViewLoaded=function(){},t.prototype.edit=function(t,n){var i=this.model.getMedia(t);if(!i)throw new Error("media not found");return Object.keys(n).forEach(function(e,t,r){i.set(e,n[e])}),e.edit(i)},t.prototype["delete"]=function(t,n){var i=this.model.getMedia(t);if(!i)throw new Error("media not found");return e["delete"](i,n)},t}),define("controller/postController",["factory/postFactory","service","service/keyPointService","service/threadPostService"],function(e,t,n,i){var r=function(e,n){console.log("%s: %s- model=%o, options=%o",r.TAG,"constructor",e,n),this.model=e,this.options=n,this.keyPointService=t.get("keyPoint"),this.threadPostService=t.get("threadPost"),this.model.set("keyPoint",new KeyPoint(this.model.get("id"),this.model.get("start_time"),this.model.get("end_time"),"",{drawOnTimeLine:this.model.get("is_temporal",!1)})),this.bind__onKeyPointEvent=this._onKeyPointEvent.bind(this),this.bind__onThreadPostEvent=this._onThreadPostEvent.bind(this),$tt._instances.push(this)};return r.TAG="Post",r.prototype._onKeyPointEvent=function(e){switch(e.type){case n.Event.DURATION:this.model.set("keyPoint.videoDuration",e.duration);break;case n.Event.SELECTION_TIMES:this.model.set("keyPoint.selection",e.selection);break;case n.Event.HOVER:case n.Event.CLICK:this.model.forceChange()}},r.prototype._onThreadPostEvent=function(e){switch(e.type){case i.Event.REMOVE:e.post.get("id")<0&&e.post.get("parent_post_id")==this.model.get("id")&&this.model.forceChange()}},r.prototype.onViewLoaded=function(){this.addKeyPoint(),this.threadPostService.subscribe(this.bind__onThreadPostEvent)},r.prototype.addKeyPoint=function(){var e=this.model.get("keyPoint");this.keyPointService.register(e),this.keyPointService.subscribe(e.id,this.bind__onKeyPointEvent),this.keyPointService.dispatch(e.id,n.Event.ADD)},r.prototype.hoverKeyPoint=function(e){this.model.set("keyPoint.isHovering",e.isMouseOver),this.keyPointService.dispatch(this.model.get("keyPoint.id"),n.Event.HOVER,e)},r.prototype.clickKeyPoint=function(e){var t="keyPoint."+(e.isDblClick?"isPlaying":"isSeeking");this.model.set(t,!0),setTimeout(function(){this.model.set(t,!1,!1)}.bind(this),100),this.keyPointService.dispatch(this.model.get("keyPoint.id"),n.Event.CLICK,e)},r.prototype.editKeyPoint=function(e){this.keyPointService.dispatch(this.model.get("keyPoint.id"),n.Event.EDIT,e)},r.prototype.removeKeyPoint=function(){var e=this.model.get("keyPoint");this.keyPointService.dispatch(e.id,n.Event.REMOVE),this.keyPointService.unsubscribe(e.id,this.bind__onKeyPointEvent),this.keyPointService.deregister(e.id)},r.prototype.addToThread=function(e){this.threadPostService.dispatch(i.Event.ADD,{post:e})},r.prototype.updateInThread=function(e){this.threadPostService.dispatch(i.Event.REPLACE,{post:this.model,view:e})},r.prototype.removeFromThread=function(){this.threadPostService.dispatch(i.Event.REMOVE,{post:this.model})},r.prototype["new"]=function(){return e["new"](this.model)},r.prototype.post=function(t){return e.post(this.model,t)},r.prototype.get=function(){return e.get(this.model)},r.prototype.edit=function(){return e.edit(this.model)},r.prototype.put=function(t){return e.put(this.model,t)},r.prototype["delete"]=function(){return e["delete"](this.model).done(function(e){this.removeKeyPoint()}.bind(this))},r}),define("controller/profileController",[],function(){var e=function(t,n){console.log("%s: %s- model=%o, options=%o",e.TAG,"constructor",t,n),this.model=t,this.options=n,$tt._instances.push(this)};return e.TAG="Profile",e.prototype.onViewLoaded=function(){},e}),define("controller/threadController",["factory/threadFactory","service","service/keyPointService","service/threadPostService"],function(e,t,n,i){var r=function(e,n){console.log("%s: %s- model=%o, options=%o",r.TAG,"constructor",e,n),this.model=e,this.options=n,this.keyPointService=t.get("keyPoint"),this.threadPostService=t.get("threadPost"),this.videoSpeed=0,this.bind__onKeyPointEvent=this._onKeyPointEvent.bind(this),this.bind__onThreadPostEvent=this._onThreadPostEvent.bind(this),this.keyPointService.subscribe("all",this.bind__onKeyPointEvent),this.threadPostService.subscribe(this.bind__onThreadPostEvent),$tt._instances.push(this)};return r.TAG="Thread",r.prototype._onKeyPointEvent=function(e){switch(e.type){case n.Event.ADD:this.model.addKeyPoint(e.keyPoint);break;case n.Event.HOVER:case n.Event.CLICK:this.model.forceChangeKeyPoint(e.keyPoint.id);break;case n.Event.EDIT:if(!e.cancel){this.model.setKeyPointProperty(e.keyPoint.id,"options.drawOnTimeLine",!1),this.model.setKeyPointProperty(e.keyPoint.id,"isEditing",!0);break}case n.Event.REMOVE:this.model.setKeyPointProperty(e.keyPoint.id,"isEditing",!1),this.model.setKeyPointProperty(e.keyPoint.id,"options.drawOnTimeLine",!0),e.type==n.Event.REMOVE&&this.model.removeKeyPoint(e.keyPoint.id)}},r.prototype._onThreadPostEvent=function(e){switch(e.type){case i.Event.ADD:this.model.addPost(e.post,e.post.get("id")<0?"new":"view");break;case i.Event.REPLACE:this.model.forceChangePost(e.post,e.view);break;case i.Event.REMOVE:this.model.removePost(e.post)}},r.prototype.onViewLoaded=function(){},r.prototype.updateKeyPointDuration=function(e){isNaN(e)||this.keyPointService.dispatch("all",n.Event.DURATION,{duration:e})},r.prototype.updateKeyPointSelectionTimes=function(e){this.keyPointService.dispatch("all",n.Event.SELECTION_TIMES,{selection:{startTime:parseFloat(e.minTime).toFixed(2),endTime:parseFloat(e.maxTime).toFixed(2)}})},r.prototype.hoverKeyPoint=function(e,t){this.model.setKeyPointProperty(e,"isPlayerHovering",t.isMouseOver),this.keyPointService.dispatch(e,n.Event.HOVER,t)},r.prototype.rightClickKeyPoint=function(e){this.model.setKeyPointProperty(e,"isPlayerPlaying",!0),setTimeout(function(){this.model.setKeyPointProperty(e,"isPlayerPlaying",!1,!1)}.bind(this),100),this.keyPointService.dispatch(e,n.Event.CLICK,{which:"right"})},r.prototype.adjustVideoSpeed=function(){switch(this.videoSpeed=(this.videoSpeed+1)%3,this.videoSpeed){case 0:return{value:1,image:this.options.player.speedImages.normal};case 1:return{value:2,image:this.options.player.speedImages.fast};case 2:return{value:.5,image:this.options.player.speedImages.slow};default:return{value:1,image:this.options.player.speedImages.normal}}},r.prototype["delete"]=function(){return e["delete"](this.model).done(function(e){window.location.assign(e.redirect_url)})},r}),define("component/accessTypeComponent",[],function(){var e=function(e){this.options=e,this.typeToFieldMap=[{filter:'[value="4"]',fields:["accessType_data_users"]},{filter:'[value="6"]',fields:["group"]}],this.bind__onChangeAccessType=this._onChangeAccessType.bind(this),this.$container=this.options.$container,this.$accessTypes=this.$container.find("input:radio"),this.$accessTypes.on("change",this.bind__onChangeAccessType),this.$accessTypes.filter(":checked").trigger("change")};return e.TAG="AccessTypeComponent",e.prototype._getFormField=function(e){return this.$container.find('[id$="_'+e+'"]')},e.prototype._onChangeAccessType=function(e){var t=$(e.target),n=function(e,n){var i=n.parent();t.attr("id")==e.attr("id")?(i.find("label").addClass("required"),n.attr("required",!0),i.children().show()):(i.find("label").removeClass("required"),n.attr("required",!1),i.children().hide())};$.each(this.typeToFieldMap,function(e,t){var i=this.$accessTypes.filter(t.filter);$.each(t.fields,function(e,t){n(i,this._getFormField(t))}.bind(this))}.bind(this))},e.render=function(t,n){var i={};n=n||i;for(var r in i)n[r]="undefined"!=typeof n[r]?n[r]:i[r];return n.$container=t,new e(n)},e}),define("component/tableComponent",["core/subscriber","extra"],function(e){var t=function(n){e.prototype.constructor.apply(this),this.options=n,this.bind__onClickToggleSelection=this._onClickToggleSelection.bind(this),this.bind__onClickBulkAction=this._onClickBulkAction.bind(this),this.bind__onChangeItems=this._onChangeItems.bind(this),this.$table=this.options.$table,this.$toggleSelection=this.$table.find(t.Binder.TOGGLE_SELECTION),this.$bulkActions=this.$table.find(t.Binder.BULK_ACTION),this.$items=this.$table.find(t.Binder.ITEM),this.setMultiSelect(this.options.multiSelect),this.$toggleSelection.on("click",this.bind__onClickToggleSelection),this.$bulkActions.on("click",this.bind__onClickBulkAction),this.$items.on("change",this.bind__onChangeItems)};return t.extend(e),t.TAG="TableComponent",t.Binder={TOGGLE_SELECTION:".table-component-toggle-selection",BULK_ACTION:".table-component-bulk-action",ITEM:"input.table-component-item:not([disabled])"},t.Event={SELECTION_CHANGE:"eventSelectionChange",CLICK_BULK_ACTION:"eventClickBulkAction"},t.prototype.updateElements=function(e){this.$items.off("change"),this.$table=e,this.$items=this.$table.find(t.Binder.ITEM),this.$items.on("change",this.bind__onChangeItems)},t.prototype._dispatchToggleEvent=function(e){var n=this.getSelection();this._dispatch(t.Event.SELECTION_CHANGE,{$selection:n,tableComponent:this,parentEvent:e})},t.prototype._onClickToggleSelection=function(e){this.$items.prop("checked",$(e.target).is('input[type="checkbox"]')?e.target.checked:0==this.getSelection().length),this._dispatchToggleEvent(e)},t.prototype._onClickBulkAction=function(e){var n=$(e.currentTarget);this._dispatch(t.Event.CLICK_BULK_ACTION,{$bulkAction:n,action:n.data("action"),$selection:this.getSelection(),tableComponent:this,parentEvent:e})},t.prototype._onChangeItems=function(e){var n=e.target.checked;this.options.multiSelect||this.$items.prop("checked",!1),e.target.checked=n;var i=this.getSelection();this._dispatch(t.Event.SELECTION_CHANGE,{$selection:i,tableComponent:this,parentEvent:e});var r=i.length==this.$items.length;this.$toggleSelection.prop("checked",r),r&&this._dispatchToggleEvent(e)},t.prototype.setMultiSelect=function(e){this.options.multiSelect=e,this.$toggleSelection.attr("disabled",!this.options.multiSelect)},t.prototype.getTable=function(){return this.$table},t.prototype.getBulkActions=function(){return this.$bulkActions},t.prototype.getSelection=function(){return this.$items.filter(":checked")},t.table=function(e,n){var i={multiSelect:!0};n=n||i;for(var r in i)n[r]="undefined"!=typeof n[r]?n[r]:i[r];return n.$table=e,new t(n)},t}),define("component/myFilesSelectorComponent",["core/subscriber","service","component/tableComponent","factory/mediaFactory","extra"],function(e,t,n,i){var r=function(n){e.prototype.constructor.apply(this),this.options=n,this.bind__onShownModal=this._onShownModal.bind(this),this.bind__onHiddenModal=this._onHiddenModal.bind(this),this.bind__onLoadPageSuccess=this._onLoadPageSuccess.bind(this),this.bind__onLoadPageError=this._onLoadPageError.bind(this),this.bind__onClickSelectSelected=this._onClickSelectSelected.bind(this),this.bind__onMyFilesListViewViewLoaded=this._onMyFilesListViewViewLoaded.bind(this),this.bind__onSelectionChange=this._onSelectionChange.bind(this),this.$container=this.options.$container,this.$modalDialog=this.$container.find(r.Binder.MODAL_DIALOG),this.$selectSelected=this.$container.find(r.Binder.SELECT_SELECTED),this.$modalDialog.modal({backdrop:"static",show:!1}),this.$modalDialog.on("shown.bs.modal",this.bind__onShownModal),this.$modalDialog.on("hidden.bs.modal",this.bind__onHiddenModal),this.$selectSelected.on("click",this.bind__onClickSelectSelected);var i=t.get("subscriber");i.subscribe("onViewLoaded",this.bind__onMyFilesListViewViewLoaded)};return r.extend(e),r.TAG="MyFilesSelectorComponent",r.Binder={MODAL_DIALOG:".my-files-selector-modal",SELECT_SELECTED:".my-files-selector-select-selected"},r.Event={DONE:"eventDone",HIDDEN:"eventHidden"},r.prototype._onSelectionChange=function(e){this.$selectSelected.attr("disabled",0==e.$selection.length)},r.prototype._onMyFilesListViewViewLoaded=function(e){var t=require("views/myFiles/listView");if(e.tag===t.TAG){this.tblCmp=e.view.getTableComponent(),this.tblCmp.setMultiSelect(this.options.multiSelect),this.tblCmp.subscribe(n.Event.SELECTION_CHANGE,this.bind__onSelectionChange);var i=function(e){e.preventDefault(),this._loadPage($(e.currentTarget).attr("href"))}.bind(this);this.$modalDialog.find(t.Binder.TOGGLE_STYLE).on("click",i),this.$modalDialog.find("ul.pagination li a").on("click",i)}},r.prototype._onLoadPageSuccess=function(e,t,n){this.$modalDialog.find(".modal-body").html(e.page)},r.prototype._onLoadPageError=function(e,t,n){console.log(e)},r.prototype._makeUrl=function(e){if("undefined"==typeof e)return Routing.generate("imdc_myfiles_list",this.options.filter);for(var t in this.filter)e+=(e.substr("?")?"&":"?")+t+"="+this.options.filter[t];return e},r.prototype._loadPage=function(e){$.ajax({url:this._makeUrl(e),success:this.bind__onLoadPageSuccess,error:this.bind__onLoadPageError})},r.prototype._onShownModal=function(e){this._loadPage()},r.prototype._onHiddenModal=function(e){this._dispatch(r.Event.HIDDEN,{myFilesSelectorComponent:this})},r.prototype._onClickSelectSelected=function(e){e.preventDefault(),this.$selectSelected.button("loading");var t=this.tblCmp.getSelection(),n=[];this.options.multiSelect?t.each(function(e,t){n.push($(t).data("mid"))}):n.push(t.first().data("mid")),i.list(n).done(function(e){this._dispatch(r.Event.DONE,{media:e.media,myFilesSelectorComponent:this})}.bind(this)).fail(function(e){this.$selectSelected.button("reset"),console.error("%s: media factory list",r.TAG)}.bind(this))},r.prototype.show=function(){this.$modalDialog.modal("show")},r.prototype.hide=function(){this.$modalDialog.modal("hide")},r.prototype.destroy=function(){this.$modalDialog.remove()},r.render=function(e,t){var n={$container:$("body"),multiSelect:!0,filter:{}};e=e||n;for(var i in n)e[i]="undefined"!=typeof e[i]?e[i]:n[i];dust.render("myFilesSelector",{},function(n,i){e.$container.append(i);var o=new r(e);t.call(o,{myFilesSelectorComponent:o})})},r}),define("component/recorderComponent",["core/subscriber","service","component/myFilesSelectorComponent","model/mediaModel","factory/mediaFactory","factory/myFilesFactory","service/rabbitmqWebStompService","core/helper","extra"],function(e,t,n,i,r,o,s,a){var l=function(n){e.prototype.constructor.apply(this),this.options=n,this.isOnNormalTab=this.options.tab==l.Tab.NORMAL,this.isOnInterpTab=this.options.tab==l.Tab.INTERPRETATION,this.isInRecordMode=this.options.mode==l.Mode.RECORD,this.isInEditMode=this.options.mode==l.Mode.PREVIEW,this.player=null,this.recorder=null,this.currentRecording=null,this.currentTrim=null,this.sourceMedia=null,this.recordedMedia=null,this.messages=[],this.rabbitmqWebStompService=t.get("rabbitmqWebStomp"),this.isDonePostponed=!1,this.doPost=!1,this.forwardButton='<button class="forwardButton"></button>',this.doneButton='<button class="doneButton"></button>',this.doneAndPostButton='<button class="doneAndPostButton"></button>',this.backButton='<button class="backButton"></button>',this.bind__onShownModal=this._onShownModal.bind(this),this.bind__onShowModal=this._onShowModal.bind(this),this.bind__onHiddenModal=this._onHiddenModal.bind(this),this.bind__onShowTab=this._onShowTab.bind(this),this.bind__onShownTab=this._onShownTab.bind(this),this.bind__onBlurPlayerTitle=this._onBlurPlayerTitle.bind(this),this.bind__onClickInterpSelect=this._onClickInterpSelect.bind(this),this.bind__onPageAnimate=this._onPageAnimate.bind(this),this.bind__onRecordingStarted=this._onRecordingStarted.bind(this),this.bind__onRecordingStopped=this._onRecordingStopped.bind(this),this.bind__preview=this._preview.bind(this),this.bind__cut=this._cut.bind(this),this.bind__back=this._back.bind(this),this.bind__done=this._done.bind(this),this.bind__doneAndPost=this._doneAndPost.bind(this),this.$container=this.options.$container,this.$modalDialog=this.$container.find(l.Binder.MODAL_DIALOG),this.$tabPanes=this.$container.find(l.Binder.TAB_PANES),this.$containerRecord=this.$container.find(l.Binder.CONTAINER_RECORD),this.$normalTitle=this.$container.find(l.Binder.NORMAL_TITLE),this.$normalVideo=this.$container.find(l.Binder.NORMAL_VIDEO),this.$interpSelect=this.$container.find(l.Binder.INTERP_SELECT),this.$interpMain=this.$container.find(l.Binder.INTERP_MAIN),this.$interpVideoP=this.$container.find(l.Binder.INTERP_VIDEO_P),this.$interpTitle=this.$container.find(l.Binder.INTERP_TITLE),this.$interpVideoR=this.$container.find(l.Binder.INTERP_VIDEO_R),this.$controls=this.$container.find(l.Binder.CONTROLS),this.$containerUpload=this.$container.find(l.Binder.CONTAINER_UPLOAD);var i=this.isOnNormalTab?l.Binder.NORMAL:l.Binder.INTERP;this.$modalDialog.find('a[href!="'+i+'"]').parent().removeClass("active"),this.$modalDialog.find('a[href="'+i+'"]').parent().addClass("active"),this.$modalDialog.find('.tab-pane:not("'+i+'")').removeClass("active"),this.$modalDialog.find(".tab-pane"+i).addClass("active"),this.$modalDialog.modal({backdrop:"static",show:!1}),this.$modalDialog.on("shown.bs.modal",this.bind__onShownModal),this.$modalDialog.on("show.bs.modal",this.bind__onShowModal),this.$modalDialog.on("hidden.bs.modal",this.bind__onHiddenModal),this.$tabPanes.on("show.bs.tab",this.bind__onShowTab),this.$tabPanes.on("shown.bs.tab",this.bind__onShownTab),this.$interpSelect.on("click",this.bind__onClickInterpSelect),this.isInEditMode&&(this.$normalTitle.blur(this.bind__onBlurPlayerTitle),this.$interpTitle.blur(this.bind__onBlurPlayerTitle)),this._clearCurrents(),this._setupRabbitmq(),this.isInEditMode&&this.$modalDialog.find('a[href="'+l.Binder.INTERP+'"]').hide()};return l.extend(e),l.TAG="RecorderComponent",l.MAX_RECORDING_TIME=720,l.Binder={MODAL_DIALOG:".recorder-modal",TAB_PANES:'a[data-toggle="tab"]',NORMAL:".recorder-normal",INTERP:".recorder-interp",CONTAINER_RECORD:".recorder-container-record",NORMAL_TITLE:".recorder-normal-title",NORMAL_VIDEO:".recorder-normal-video",INTERP_SELECT:".recorder-interp-select",INTERP_MAIN:".recorder-interp-main",INTERP_VIDEO_P:".recorder-interp-video-p",INTERP_TITLE:".recorder-interp-title",INTERP_VIDEO_R:".recorder-interp-video-r",CONTROLS:".recorder-controls",CONTAINER_UPLOAD:".recorder-container-upload"},l.Tab={NORMAL:0,INTERPRETATION:1},l.Mode={RECORD:0,PREVIEW:1},l.Event={DONE:"eventDone",HIDDEN:"eventHidden"},l.prototype._setupRabbitmq=function(){this.bind__onMessage=function(e){console.log(e.message),this.messages.push(e.message),this._checkMessages()}.bind(this),this.bind__onConnect=function(e){this.subscription=this.rabbitmqWebStompService.subscribe("/exchange/"+window.parameters.prefix+"entity-status",s.Event.MESSAGE,this.bind__onMessage)}.bind(this),this.rabbitmqWebStompService.isConnected()?this.bind__onConnect(null):(this.rabbitmqWebStompService.subscribe(null,s.Event.CONNECTED,this.bind__onConnect),this.rabbitmqWebStompService.connect())},l.prototype._cleanupRabbitmq=function(){this.rabbitmqWebStompService.unsubscribe(this.subscription,this.bind__onMessage),this.rabbitmqWebStompService.unsubscribe(null,this.bind__onConnect)},l.prototype._createPlayer=function(e,t){console.log("%s: %s",l.TAG,"_createPlayer"),e="undefined"!=typeof e?e:!1,t="undefined"!=typeof t?t:!1;var n=[],i=[];(this.isOnNormalTab||e)&&(n.push(this.doneButton),i.push(e?this.bind__cut:this.bind__done)),this.options.enableDoneAndPost&&e&&(n.push(this.doneAndPostButton),i.push(this.bind__doneAndPost));var r,o;e&&t&&(r=[this.backButton],o=[this.bind__back]);var s=this.isOnNormalTab?this.$normalVideo:e?this.$interpVideoR:this.$interpVideoP,a=new Player(s,{areaSelectionEnabled:e,audioBar:!1,updateTimeType:Player.DENSITY_BAR_UPDATE_TYPE_RELATIVE,controlBarElement:this.$controls,forwardButtons:n,forwardFunctions:i,backButtons:r,backFunctions:o,selectedRegionColor:"#0000ff"});a.createControls(),$(a.elementID).find(".videoControlsContainer.controlsBar.doneButton").eq(0).attr("title",Translator.trans("player.previewing.doneButton")),$(a.elementID).find(".videoControlsContainer.controlsBar.doneAndPostButton").eq(0).attr("title",Translator.trans("player.previewing.doneAndPostButton")),$(a.elementID).find(".videoControlsContainer.controlsBar.backButton").eq(0).attr("title",Translator.trans("player.previewing.backToRecordingButton")),e?this.recorder=a:this.player=a},l.prototype._cut=function(e){console.log("%s: %s",l.TAG,"_cut"),e.preventDefault();var t=this.recorder.getCurrentMinMaxTime(),n=this.recorder.getAreaSelectionTimes();this.recorder.setCurrentMinMaxTime(n.minTime,n.maxTime),console.log("Current Min/Max Times %s %s",n.minTime,n.maxTime),console.log("Cutting to Min/Max Times %s %s",n.minTime-t.minTime,n.maxTime-t.minTime),this.currentTrim={startTime:n.minTime-t.minTime,endTime:n.maxTime-t.minTime},this._done(e)},l.prototype._back=function(e){console.log("%s: %s",l.TAG,"_back"),e.preventDefault(),this._destroyPlayers(),this.setRecordedMedia(null),this.options.mode=l.Mode.RECORD,this.isOnInterpTab&&this._createPlayer(),this._createRecorder()},l.prototype._createRecorder=function(){console.log("%s: %s",l.TAG,"_createRecorder");var e=[this.forwardButton,this.doneButton],t=[this.bind__preview,this.bind__done];this.options.enableDoneAndPost&&(e.push(this.doneAndPostButton),t.push(this.bind__doneAndPost));var n=this.isOnNormalTab?this.$normalVideo:this.$interpVideoR;Player.prototype.postRecordings=function(){this.recording_recordingStopped(!0,{})},this.recorder=new Player(n,{areaSelectionEnabled:!1,audioBar:!1,updateTimeType:Player.DENSITY_BAR_UPDATE_TYPE_ABSOLUTE,controlBarElement:this.$controls,type:Player.DENSITY_BAR_TYPE_RECORDER,volumeControl:!1,maxRecordingTime:l.MAX_RECORDING_TIME,recordingSuccessFunction:function(){},recordingErrorFunction:function(){},forwardButtons:e,forwardFunctions:t}),$(this.recorder).on(Player.EVENT_RECORDING_STARTED,this.bind__onRecordingStarted),$(this.recorder).on(Player.EVENT_RECORDING_STOPPED,this.bind__onRecordingStopped),this.recorder.createControls(),$(this.recorder.elementID).find(".videoControlsContainer.controlsBar.videoControls.recordButton").eq(0).attr("title",Translator.trans("player.recording.recordingButton")),$(this.recorder.elementID).find(".videoControlsContainer.controlsBar.forwardButton").eq(0).attr("title",Translator.trans("player.recording.forwardButton")),$(this.recorder.elementID).find(".videoControlsContainer.controlsBar.doneButton").eq(0).attr("title",Translator.trans("player.recording.doneButton")),$(this.recorder.elementID).find(".videoControlsContainer.controlsBar.doneAndPostButton").eq(0).attr("title",Translator.trans("player.recording.doneAndPostButton"))},l.prototype._onRecordingStarted=function(){console.log("%s: %s",l.TAG,"_onRecordingStarted"),this._clearCurrents(),this.isOnInterpTab&&(this.currentRecording.sourceStartTime=this.player.getCurrentTime(),this.player.setControlsEnabled(!1),this.player.play())},l.prototype._onRecordingStopped=function(){this.currentRecording.video=this.recorder.recordVideo.getBlob(),this.currentRecording.audio=this.recorder.recordAudio.getBlob(),this.isOnInterpTab&&(this.player.pause(),this.player.setControlsEnabled(!0))},l.prototype._preview=function(e){console.log("%s: %s",l.TAG,"_preview"),e.preventDefault(),this._destroyPlayers(),this._injectCurrentRecording(this.isOnNormalTab?this.$normalVideo:this.$interpVideoR),this.isOnInterpTab&&this._createPlayer(),this.options.mode=l.Mode.PREVIEW,this._createPlayer(!0,!0)},l.prototype._checkMessages=function(){if(this.tempMedia)for(;this.messages.length>0;){var e=this.messages.pop();e.who.indexOf("MultiplexConsumer")>-1&&(e.what.indexOf("Media")>-1||e.what.indexOf("Interpretation"))&&e.identifier==this.tempMedia.get("id")&&("Done"!=e.status?this.$containerUpload.find("label").eq(0).html(e.status+"..."):(console.log("done"),
this.$containerUpload.find("label").eq(0).html("Cleaning up..."),r.get(this.tempMedia.get("id")).done(function(e){this.tempMedia=null,this.setRecordedMedia(e.media),this.isDonePostponed&&setTimeout(function(){this._dispatchDone()}.bind(this),2e3)}.bind(this)).fail(function(e){})))}},l.prototype._addRecording=function(){if(null==this.currentRecording.video&&null==this.currentRecording.audio)return null;var e={video:this.currentRecording.video,audio:this.currentRecording.audio,title:this._getCurrentTitleElement().val()};return this.isOnInterpTab&&(e.isInterpretation=!0,e.sourceStartTime=this.currentRecording.sourceStartTime,e.sourceId=this.sourceMedia.get("id")),this.$containerUpload.find("label").eq(0).html("Uploading recording..."),o.addRecording(e).progress(function(e){a.updateProgressBar(this.$containerUpload,e)}.bind(this)).done(function(e){console.log(e.media),2==e.media.get("state")?this.setRecordedMedia(e.media):(console.log("waiting for multiplex consumer"),this.$containerUpload.find(".progress-bar").eq(0).addClass("progress-bar-striped active").html(""),this.$containerUpload.find("label").eq(0).html("Processing..."),this.tempMedia=e.media,this._checkMessages())}.bind(this)).fail(function(){})},l.prototype._trim=function(e){return null==this.currentTrim.startTime||null==this.currentTrim.endTime?null:(this.$containerUpload.find("label").eq(0).html("Queuing trim..."),r.trim(e,this.currentTrim.startTime,this.currentTrim.endTime).fail(function(){}))},l.prototype._dispatchDone=function(){this._dispatch(l.Event.DONE,{media:this.recordedMedia,doPost:this.doPost,recorderComponent:this})},l.prototype._done=function(e){console.log("%s: %s",l.TAG,"_done"),e.preventDefault(),this.$containerRecord.hide(),this.$containerUpload.show(),this._destroyPlayers();var t=function(){this.$containerUpload.find("label").eq(0).html("Cleaning up..."),this.recordedMedia?setTimeout(function(){this._dispatchDone()}.bind(this),2e3):this.isDonePostponed=!0}.bind(this),n=function(e){var n=this._trim(e);return n?void n.done(function(e){t()}):void t()}.bind(this),i=this._addRecording();return i?void i.done(function(e){n(e.media)}):void(this.isInEditMode&&this.recordedMedia&&(a.updateProgressBar(this.$containerUpload,100),this.$containerUpload.find(".progress-bar").eq(0).addClass("progress-bar-striped active").html(""),n(this.recordedMedia)))},l.prototype._doneAndPost=function(e){this.doPost=!0,this._done(e)},l.prototype._clearCurrents=function(){this.currentRecording={video:null,audio:null,sourceStartTime:null},this.currentTrim={startTime:null,endTime:null}},l.prototype._destroyPlayers=function(){console.log("%s: %s",l.TAG,"_destroyPlayers");var e=function(e){var t=e.parent();e.removeAttr("src"),t.hide(),t.after(e.detach()),t.remove()}.bind(this);null!=this.player&&(this.player.destroyRecorder(),this.isOnNormalTab?e(this.$normalVideo):null!=this.sourceMedia&&e(this.$interpVideoP),this.player=null),null!=this.recorder&&(this.recorder.destroyRecorder(),this.isOnNormalTab?e(this.$normalVideo):null!=this.sourceMedia&&e(this.$interpVideoR),this.recorder=null),this.$controls.html("")},l.prototype._onPageAnimate=function(){try{if(this.isInEditMode&&null!=this.recordedMedia){if(this.isOnInterpTab&&null!=this.sourceMedia)return;this._createPlayer(!0)}else{if(this.isOnInterpTab){if(null==this.sourceMedia)return;this._createPlayer()}this._createRecorder()}}catch(e){console.error("%s: %s- err=%o",l.TAG,"_loadPage",e)}},l.prototype._loadPage=function(){this.isOnInterpTab&&(null!=this.sourceMedia?(this.$interpSelect.parent().hide(),this.$interpMain.show()):(this.$interpSelect.parent().show(),this.$interpMain.hide())),this.$modalDialog.find(".modal-dialog").animate({width:4*(.9*$(window).height()-256)/3},{complete:this.bind__onPageAnimate})},l.prototype._onShownModal=function(e){this._destroyPlayers(),this._loadPage()},l.prototype._onShowModal=function(e){this.$modalDialog.find(".modal-dialog").width(4*(.9*$(window).height()-256)/3)},l.prototype._onHiddenModal=function(e){this._destroyPlayers(),this.paused||this._dispatch(l.Event.HIDDEN,{recorderComponent:this})},l.prototype._onShowTab=function(e){this._destroyPlayers(),this.options.tab=$(e.target).attr("href")==l.Binder.NORMAL?l.Tab.NORMAL:l.Tab.INTERPRETATION,this.isOnNormalTab=this.options.tab==l.Tab.NORMAL,this.isOnInterpTab=this.options.tab==l.Tab.INTERPRETATION,this._loadPage()},l.prototype._onShownTab=function(e){this.$interpVideoP[0].load()},l.prototype._onBlurPlayerTitle=function(e){console.log("updated title"),this.recordedMedia.set("title",$(e.target).val()),r.edit(this.recordedMedia)},l.prototype._onClickInterpSelect=function(e){e.preventDefault(),n.render({multiSelect:!1,filter:{type:1}},function(e){this.mfsCmp=e.myFilesSelectorComponent,this.mfsCmp.subscribe(n.Event.DONE,function(e){this.mfsCmp.hide(),this.setSourceMedia(e.media[0])}.bind(this)),this.mfsCmp.subscribe(n.Event.HIDDEN,function(e){this.mfsCmp.destroy(),this.show(),this.paused=!1}.bind(this)),this.paused=!0,this.hide(),this.mfsCmp.show()}.bind(this))},l.prototype.show=function(){this.$modalDialog.modal("show")},l.prototype.hide=function(){this.$modalDialog.modal("hide")},l.prototype.destroy=function(){this._clearCurrents(),this._cleanupRabbitmq(),this.$modalDialog.remove()},l.prototype._injectCurrentRecording=function(e){var t={resources:[{web_path:URL.createObjectURL(this.currentRecording.video)},{web_path:URL.createObjectURL(this.currentRecording.audio)}]};dust.render("recorder_source",t,function(t,n){e.html(n)})},l.prototype._injectMedia=function(e,t){var n={resources:this.isInRecordMode?[t.get("source_resource")]:t.get("resources")};dust.render("recorder_source",n,function(t,n){e.html(n)})},l.prototype._getCurrentTitleElement=function(){return this.isOnNormalTab?this.$normalTitle:this.$interpTitle},l.prototype.setSourceMedia=function(e){this.sourceMedia=e,null!=this.sourceMedia&&(this._injectMedia(this.$interpVideoP,this.sourceMedia),this._getCurrentTitleElement().val(this.sourceMedia.get("title"))),this._destroyPlayers(),this._loadPage()},l.prototype.setRecordedMedia=function(e){this.recordedMedia=e,null!=this.recordedMedia&&(this._injectMedia(this.isOnNormalTab?this.$normalVideo:this.$interpVideoR,this.recordedMedia),this._getCurrentTitleElement().val(this.recordedMedia.get("title")))},l.render=function(e,t){var n={$container:$("body"),tab:l.Tab.NORMAL,mode:l.Mode.RECORD,enableDoneAndPost:!1};e=e||n;for(var i in n)e[i]="undefined"!=typeof e[i]?e[i]:n[i];dust.render("recorder",{},function(n,i){e.$container.append(i);var r=new l(e);t.call(r,{recorderComponent:r})})},l}),!function(e){"function"==typeof define&&define.amd?define("Sortable",e):"undefined"!=typeof module&&"undefined"!=typeof module.exports?module.exports=e():"undefined"!=typeof Package?Sortable=e():window.Sortable=e()}(function(){function e(e,t){this.el=e,this.options=t=t||{};var i={group:Math.random(),sort:!0,disabled:!1,store:null,handle:null,scroll:!0,scrollSensitivity:30,scrollSpeed:10,draggable:/[uo]l/i.test(e.nodeName)?"li":">*",ghostClass:"sortable-ghost",ignore:"a, img",filter:null,animation:0,setData:function(e,t){e.setData("Text",t.textContent)},dropBubble:!1,dragoverBubble:!1};for(var r in i)!(r in t)&&(t[r]=i[r]);var s=t.group;s&&"object"==typeof s||(s=t.group={name:s}),["pull","put"].forEach(function(e){e in s||(s[e]=!0)}),L.forEach(function(i){t[i]=n(this,t[i]||B),o(e,i.substr(2).toLowerCase(),t[i])},this),t.groups=" "+s.name+(s.put.join?" "+s.put.join(" "):"")+" ",e[R]=t;for(var a in this)"_"===a.charAt(0)&&(this[a]=n(this,this[a]));o(e,"mousedown",this._onTapStart),o(e,"touchstart",this._onTapStart),o(e,"dragover",this),o(e,"dragenter",this),V.push(this._onDragOver),t.store&&this.sort(t.store.get(this))}function t(e){b&&b.state!==e&&(l(b,"display",e?"none":""),!e&&b.state&&y.insertBefore(b,g),b.state=e)}function n(e,t){var n=U.call(arguments,2);return t.bind?t.bind.apply(t,[e].concat(n)):function(){return t.apply(e,n.concat(U.call(arguments)))}}function i(e,t,n){if(e){n=n||N,t=t.split(".");var i=t.shift().toUpperCase(),r=new RegExp("\\s("+t.join("|")+")\\s","g");do if(">*"===i&&e.parentNode===n||(""===i||e.nodeName.toUpperCase()==i)&&(!t.length||((" "+e.className+" ").match(r)||[]).length==t.length))return e;while(e!==n&&(e=e.parentNode))}return null}function r(e){e.dataTransfer.dropEffect="move",e.preventDefault()}function o(e,t,n){e.addEventListener(t,n,!1)}function s(e,t,n){e.removeEventListener(t,n,!1)}function a(e,t,n){if(e)if(e.classList)e.classList[n?"add":"remove"](t);else{var i=(" "+e.className+" ").replace(/\s+/g," ").replace(" "+t+" ","");e.className=i+(n?" "+t:"")}}function l(e,t,n){var i=e&&e.style;if(i){if(void 0===n)return N.defaultView&&N.defaultView.getComputedStyle?n=N.defaultView.getComputedStyle(e,""):e.currentStyle&&(n=e.currentStyle),void 0===t?n:n[t];t in i||(t="-webkit-"+t),i[t]=n+("string"==typeof n?"":"px")}}function c(e,t,n){if(e){var i=e.getElementsByTagName(t),r=0,o=i.length;if(n)for(;o>r;r++)n(i[r],r);return i}return[]}function d(e){e.draggable=!1}function u(){D=!1}function h(e,t){var n=e.lastElementChild,i=n.getBoundingClientRect();return t.clientY-(i.top+i.height)>5&&n}function p(e){for(var t=e.tagName+e.className+e.src+e.href+e.textContent,n=t.length,i=0;n--;)i+=t.charCodeAt(n);return i.toString(36)}function f(e){for(var t=0;e&&(e=e.previousElementSibling);)"TEMPLATE"!==e.nodeName.toUpperCase()&&t++;return t}function m(e,t){var n,i;return function(){void 0===n&&(n=arguments,i=this,setTimeout(function(){1===n.length?e.call(i,n[0]):e.apply(i,n),n=void 0},t))}}var g,v,b,y,_,w,E,C,T,S,k,$,x,A,P={},R="Sortable"+(new Date).getTime(),O=window,N=O.document,M=O.parseInt,I=!!("draggable"in N.createElement("div")),D=!1,F=function(e,t,n,i,r,o){var s=N.createEvent("Event");s.initEvent(t,!0,!0),s.item=n||e,s.from=i||e,s.clone=b,s.oldIndex=r,s.newIndex=o,e.dispatchEvent(s)},L="onAdd onUpdate onRemove onStart onEnd onFilter onSort".split(" "),B=function(){},j=Math.abs,U=[].slice,V=[],G=m(function(e,t,n){if(n&&t.scroll){var i,r,o,s,a=t.scrollSensitivity,l=t.scrollSpeed,c=e.clientX,d=e.clientY,u=window.innerWidth,h=window.innerHeight;if(E!==n&&(w=t.scroll,E=n,w===!0)){w=n;do if(w.offsetWidth<w.scrollWidth||w.offsetHeight<w.scrollHeight)break;while(w=w.parentNode)}w&&(i=w,r=w.getBoundingClientRect(),o=(j(r.right-c)<=a)-(j(r.left-c)<=a),s=(j(r.bottom-d)<=a)-(j(r.top-d)<=a)),o||s||(o=(a>=u-c)-(a>=c),s=(a>=h-d)-(a>=d),(o||s)&&(i=O)),(P.vx!==o||P.vy!==s||P.el!==i)&&(P.el=i,P.vx=o,P.vy=s,clearInterval(P.pid),i&&(P.pid=setInterval(function(){i===O?O.scrollTo(O.scrollX+o*l,O.scrollY+s*l):(s&&(i.scrollTop+=s*l),o&&(i.scrollLeft+=o*l))},24)))}},30);return e.prototype={constructor:e,_dragStarted:function(){y&&g&&(a(g,this.options.ghostClass,!0),e.active=this,F(y,"start",g,y,S))},_onTapStart:function(e){var t=e.type,n=e.touches&&e.touches[0],r=(n||e).target,s=r,a=this.options,l=this.el,u=a.filter;if(!("mousedown"===t&&0!==e.button||a.disabled)&&(r=i(r,a.draggable,l))){if(S=f(r),"function"==typeof u){if(u.call(this,e,r,this))return F(s,"filter",r,l,S),void e.preventDefault()}else if(u&&(u=u.split(",").some(function(e){return e=i(s,e.trim(),l),e?(F(e,"filter",r,l,S),!0):void 0})))return void e.preventDefault();if((!a.handle||i(s,a.handle,l))&&r&&!g&&r.parentNode===l){x=e,y=this.el,g=r,_=g.nextSibling,$=this.options.group,g.draggable=!0,a.ignore.split(",").forEach(function(e){c(r,e.trim(),d)}),n&&(x={target:r,clientX:n.clientX,clientY:n.clientY},this._onDragStart(x,"touch"),e.preventDefault()),o(N,"mouseup",this._onDrop),o(N,"touchend",this._onDrop),o(N,"touchcancel",this._onDrop),o(g,"dragend",this),o(y,"dragstart",this._onDragStart),I||this._onDragStart(x,!0);try{N.selection?N.selection.empty():window.getSelection().removeAllRanges()}catch(h){}}}},_emulateDragOver:function(){if(A){l(v,"display","none");var e=N.elementFromPoint(A.clientX,A.clientY),t=e,n=" "+this.options.group.name,i=V.length;if(t)do{if(t[R]&&t[R].groups.indexOf(n)>-1){for(;i--;)V[i]({clientX:A.clientX,clientY:A.clientY,target:e,rootEl:t});break}e=t}while(t=t.parentNode);l(v,"display","")}},_onTouchMove:function(e){if(x){var t=e.touches?e.touches[0]:e,n=t.clientX-x.clientX,i=t.clientY-x.clientY,r=e.touches?"translate3d("+n+"px,"+i+"px,0)":"translate("+n+"px,"+i+"px)";A=t,l(v,"webkitTransform",r),l(v,"mozTransform",r),l(v,"msTransform",r),l(v,"transform",r),e.preventDefault()}},_onDragStart:function(e,t){var n=e.dataTransfer,i=this.options;if(this._offUpEvents(),"clone"==$.pull&&(b=g.cloneNode(!0),l(b,"display","none"),y.insertBefore(b,g)),t){var r,s=g.getBoundingClientRect(),a=l(g);v=g.cloneNode(!0),l(v,"top",s.top-M(a.marginTop,10)),l(v,"left",s.left-M(a.marginLeft,10)),l(v,"width",s.width),l(v,"height",s.height),l(v,"opacity","0.8"),l(v,"position","fixed"),l(v,"zIndex","100000"),y.appendChild(v),r=v.getBoundingClientRect(),l(v,"width",2*s.width-r.width),l(v,"height",2*s.height-r.height),"touch"===t?(o(N,"touchmove",this._onTouchMove),o(N,"touchend",this._onDrop),o(N,"touchcancel",this._onDrop)):(o(N,"mousemove",this._onTouchMove),o(N,"mouseup",this._onDrop)),this._loopId=setInterval(this._emulateDragOver,150)}else n&&(n.effectAllowed="move",i.setData&&i.setData.call(this,n,g)),o(N,"drop",this);setTimeout(this._dragStarted,0)},_onDragOver:function(e){var n,r,o,s=this.el,a=this.options,c=a.group,d=c.put,p=$===c,f=a.sort;if(g&&(void 0!==e.preventDefault&&(e.preventDefault(),!a.dragoverBubble&&e.stopPropagation()),$&&!a.disabled&&(p?f||(o=!y.contains(g)):$.pull&&d&&($.name===c.name||d.indexOf&&~d.indexOf($.name)))&&(void 0===e.rootEl||e.rootEl===this.el))){if(G(e,a,this.el),D)return;if(n=i(e.target,a.draggable,s),r=g.getBoundingClientRect(),o)return t(!0),void(b||_?y.insertBefore(g,b||_):f||y.appendChild(g));if(0===s.children.length||s.children[0]===v||s===e.target&&(n=h(s,e))){if(n){if(n.animated)return;w=n.getBoundingClientRect()}t(p),s.appendChild(g),this._animate(r,g),n&&this._animate(w,n)}else if(n&&!n.animated&&n!==g&&void 0!==n.parentNode[R]){C!==n&&(C=n,T=l(n));var m,w=n.getBoundingClientRect(),E=w.right-w.left,S=w.bottom-w.top,k=/left|right|inline/.test(T.cssFloat+T.display),x=n.offsetWidth>g.offsetWidth,A=n.offsetHeight>g.offsetHeight,P=(k?(e.clientX-w.left)/E:(e.clientY-w.top)/S)>.5,O=n.nextElementSibling;D=!0,setTimeout(u,30),t(p),m=k?n.previousElementSibling===g&&!x||P&&x:O!==g&&!A||P&&A,m&&!O?s.appendChild(g):n.parentNode.insertBefore(g,m?O:n),this._animate(r,g),this._animate(w,n)}}},_animate:function(e,t){var n=this.options.animation;if(n){var i=t.getBoundingClientRect();l(t,"transition","none"),l(t,"transform","translate3d("+(e.left-i.left)+"px,"+(e.top-i.top)+"px,0)"),t.offsetWidth,l(t,"transition","all "+n+"ms"),l(t,"transform","translate3d(0,0,0)"),clearTimeout(t.animated),t.animated=setTimeout(function(){l(t,"transition",""),l(t,"transform",""),t.animated=!1},n)}},_offUpEvents:function(){s(N,"mouseup",this._onDrop),s(N,"touchmove",this._onTouchMove),s(N,"touchend",this._onDrop),s(N,"touchcancel",this._onDrop)},_onDrop:function(t){var n=this.el,i=this.options;clearInterval(this._loopId),clearInterval(P.pid),s(N,"drop",this),s(N,"mousemove",this._onTouchMove),s(n,"dragstart",this._onDragStart),this._offUpEvents(),t&&(t.preventDefault(),!i.dropBubble&&t.stopPropagation(),v&&v.parentNode.removeChild(v),g&&(s(g,"dragend",this),d(g),a(g,this.options.ghostClass,!1),y!==g.parentNode?(k=f(g),F(g.parentNode,"sort",g,y,S,k),F(y,"sort",g,y,S,k),F(g,"add",g,y,S,k),F(y,"remove",g,y,S,k)):(b&&b.parentNode.removeChild(b),g.nextSibling!==_&&(k=f(g),F(y,"update",g,y,S,k),F(y,"sort",g,y,S,k))),e.active&&F(y,"end",g,y,S,k)),y=g=v=_=b=w=E=x=A=C=T=$=e.active=null,this.save())},handleEvent:function(e){var t=e.type;"dragover"===t||"dragenter"===t?(this._onDragOver(e),r(e)):("drop"===t||"dragend"===t)&&this._onDrop(e)},toArray:function(){for(var e,t=[],n=this.el.children,r=0,o=n.length;o>r;r++)e=n[r],i(e,this.options.draggable,this.el)&&t.push(e.getAttribute("data-id")||p(e));return t},sort:function(e){var t={},n=this.el;this.toArray().forEach(function(e,r){var o=n.children[r];i(o,this.options.draggable,n)&&(t[e]=o)},this),e.forEach(function(e){t[e]&&(n.removeChild(t[e]),n.appendChild(t[e]))})},save:function(){var e=this.options.store;e&&e.set(this)},closest:function(e,t){return i(e,t||this.options.draggable,this.el)},option:function(e,t){var n=this.options;return void 0===t?n[e]:void(n[e]=t)},destroy:function(){var e=this.el,t=this.options;L.forEach(function(n){s(e,n.substr(2).toLowerCase(),t[n])}),s(e,"mousedown",this._onTapStart),s(e,"touchstart",this._onTapStart),s(e,"dragover",this),s(e,"dragenter",this),Array.prototype.forEach.call(e.querySelectorAll("[draggable]"),function(e){e.removeAttribute("draggable")}),V.splice(V.indexOf(this._onDragOver),1),this._onDrop(),this.el=null}},e.utils={on:o,off:s,css:l,find:c,bind:n,is:function(e,t){return!!i(e,t,e)},throttle:m,closest:i,toggleClass:a,dispatchEvent:F,index:f},e.version="1.1.1",e.create=function(t,n){return new e(t,n)},e}),define("component/galleryComponent",["core/subscriber","factory/mediaFactory","component/recorderComponent","core/helper","Sortable","extra"],function(e,t,n,i,r){var o=function(n){e.prototype.constructor.apply(this),this.options=n,this.activeMedia=this.options.activeMedia,this.thumbsBounds={width:0,shiftWidth:0,thumbsWidth:0},this.bind__onClickItemContainer=this._onClickItemContainer.bind(this),this.bind__onClickPrevNext=this._onClickPrevNext.bind(this),this.bind__onClickAction=this._onClickAction.bind(this),this.bind__onClickLeftRight=this._onClickLeftRight.bind(this),this.bind__onClickThumbnail=this._onClickThumbnail.bind(this),this.bind__onClickThumbRemove=this._onClickThumbRemove.bind(this),this.bind__onRenderMedia=this._onRenderMedia.bind(this),this.bind__onRenderThumbnails=this._onRenderThumbnails.bind(this),this.bind__onWindowResize=this._onWindowResize.bind(this),this.$container=this.options.$container,this.$inner=this.$container.find('[id="'+this.options.identifier+'"]'+o.Binder.INNER),this.$item=this.$inner.find(o.Binder.ITEM),this.$prev=this.$inner.find(o.Binder.PREV),this.$next=this.$inner.find(o.Binder.NEXT),this.$actions=this.$inner.find(o.Binder.ACTION),this.$carousel=this.$inner.find(o.Binder.CAROUSEL),this.$thumbs=this.$inner.find(o.Binder.THUMBS),this.$left=this.$inner.find(o.Binder.LEFT),this.$right=this.$inner.find(o.Binder.RIGHT),this.$item.on("click",this.bind__onClickItemContainer),this.$prev.find("i.fa").on("click",this.bind__onClickPrevNext),this.$next.find("i.fa").on("click",this.bind__onClickPrevNext),this.$actions.on("click",this.bind__onClickAction),this.$left.find("i.fa").on("click",this.bind__onClickLeftRight),this.$right.find("i.fa").on("click",this.bind__onClickLeftRight),$(window).on("resize",this.bind__onWindowResize),this.options.canEdit&&(this.sortable=r.create(this.$thumbs.find("ul")[0],{onSort:function(e){var t=this.options.media[e.oldIndex],n=this.options.media[e.newIndex];this.options.media[e.newIndex]=t,this.options.media[e.oldIndex]=n,this._updateButtonStates(),this._dispatch(o.Event.CHANGE,{galleryComponent:this})}.bind(this)})),"undefined"!=typeof this.options.mediaIds&&t.list(this.options.mediaIds).done(function(e){this.options.media=e.media,this._populate()}.bind(this)).fail(function(e){console.error("%s: media factory list",o.TAG)})};return o.extend(e),o.TAG="GalleryComponent",o.Mode={PREVIEW:0,INLINE:1},o.Event={CHANGE:"eventChange",REMOVED_MEDIA:"eventRemovedMedia",DONE:"eventDone",HIDDEN:"eventHidden"},o.Binder={INNER:".gallery-inner",ITEM:".gallery-item",PREV:".gallery-prev",NEXT:".gallery-next",ACTION:".gallery-action a",CAROUSEL:".gallery-carousel",THUMBS:".gallery-thumbs",THUMB_REMOVE:".gallery-thumb-remove",LEFT:".gallery-left",RIGHT:".gallery-right"},o.prototype._launchRecorder=function(e,t,i){n.render(e,function(e){this.recorderCmp=e.recorderComponent,this.recorderCmp.subscribe(n.Event.DONE,function(e){this.recorderCmp.hide(),e.doPost&&window.location.assign(Routing.generate("imdc_thread_new_from_media",{mediaId:e.media.get("id")}))}.bind(this)),this.recorderCmp.subscribe(n.Event.HIDDEN,function(e){this.recorderCmp.destroy(),this.options.mode==o.Mode.PREVIEW&&this.show(),this.paused=!1}.bind(this)),this.paused=!0,this.options.mode==o.Mode.PREVIEW&&this.hide(),t&&this.recorderCmp.setSourceMedia(this.activeMedia),i&&this.recorderCmp.setRecordedMedia(this.activeMedia),this.recorderCmp.show()}.bind(this))},o.prototype._onClickItemContainer=function(e){this.options.mode==o.Mode.PREVIEW&&e.target===this.$item[0]&&this.hide()},o.prototype._onClickPrevNext=function(e){e.preventDefault();var t=$(e.currentTarget).hasClass("next"),n=$.inArray(this.activeMedia,this.options.media);!t&&0>n-1||t&&n+1>=this.options.media.length||(this.activeMedia=this.options.media[n+(t?1:-1)],this._renderMedia())},o.prototype._onClickAction=function(e){var t=$(e.currentTarget).data("action");switch(t){case 1:this.hide();break;case 2:i.toggleFullScreen(this.$item);break;case 3:this._launchRecorder({tab:n.Tab.INTERPRETATION,enableDoneAndPost:!0},!0);break;case 4:this._launchRecorder({tab:n.Tab.NORMAL,mode:n.Mode.PREVIEW},!1,!0)}},o.prototype._calcCarouselPosition=function(e){var t,n,i,r,o=Math.abs(parseInt(this.$thumbs.find("ul").css("left"),10));return e?(t=o+this.thumbsBounds.width,n=o+(this.thumbsBounds.thumbsWidth-t),i=o+this.thumbsBounds.shiftWidth,r=-Math.min(i,t>=this.thumbsBounds.thumbsWidth?o:n)):(t=o-this.thumbsBounds.shiftWidth,r=Math.min(0,-t)),r},o.prototype._onClickLeftRight=function(e){e.preventDefault();var t=this._calcCarouselPosition($(e.currentTarget).hasClass("right"));this._updateButtonStates(t),this.$thumbs.find("ul").css({left:t})},o.prototype._onClickThumbnail=function(e){e.preventDefault();var t=$(e.currentTarget).data("mid");this.activeMedia=$.grep(this.options.media,function(e,n){return e.get("id")==t})[0],this._renderMedia()},o.prototype._onClickThumbRemove=function(e){e.preventDefault();var t=$(e.currentTarget).data("mid"),n=$.grep(this.options.media,function(e,n){return e.get("id")==t})[0];this.removeMedia(n),this._dispatch(o.Event.REMOVED_MEDIA,{media:n,galleryComponent:this})},o.prototype.clear=function(){for(var e in this.options.media){var t=this.options.media[e];this.removeMedia(t),this._dispatch(o.Event.REMOVED_MEDIA,{media:t,galleryComponent:this})}},o.prototype._updateButtonStates=function(e){var t=this.$thumbs.find('li[data-mid="'+this.activeMedia.get("id")+'"]');this.$thumbs.find("div").removeClass("selected");var n=this.$actions.filter('[data-action="1"]'),i=this.$actions.filter('[data-action="2"]'),r=this.$actions.filter('[data-action="3"]'),s=this.$actions.filter('[data-action="4"]'),a=this.options.mode==o.Mode.PREVIEW;n.toggle(a),i.show(),1==this.activeMedia.get("type")?(r.show(),s.toggle(a)):(r.hide(),s.hide()),this.$prev.toggleClass("disabled",t.is(":first-child")),this.$next.toggleClass("disabled",t.is(":last-child"));var e=Math.abs(void 0!==e?e:parseInt(this.$thumbs.find("ul").css("left"),10));this.$left.find("i.fa").toggleClass("disabled",0>=e),this.$right.find("i.fa").toggleClass("disabled",e+this.thumbsBounds.width>=this.thumbsBounds.thumbsWidth),t.find("div").addClass("selected")},o.prototype._focusSelectedThumbnail=function(){var e=this.$thumbs.find('li[data-mid="'+this.activeMedia.get("id")+'"]'),t=e.position();if(t){var n=e.outerWidth(!0);t.right=t.left+n,t.center=t.left+n/2;var i=Math.abs(parseInt(this.$thumbs.find("ul").css("left"),10)),r={left:i,right:i+this.thumbsBounds.width,center:i+this.thumbsBounds.width/2},o=t.center>r.center,s=Math.abs(t.center-r.center),a=i+(o?s:-s);a=o?-Math.min(a,r.right>=this.thumbsBounds.thumbsWidth?r.left:this.thumbsBounds.thumbsWidth-this.thumbsBounds.width):Math.min(0,-a),this.$thumbs.find("ul").css({left:a}),this._updateButtonStates(a)}},o.prototype._onWindowResize=function(e){var t="body"===this.$container.prop("tagName").toLowerCase()?$(window):this.$container,n=i.isFullscreen()?$(window).height():t.height()-this.$carousel.outerHeight(!0),r=t.width()-(this.$left.outerWidth(!0)+this.$right.outerWidth(!0))-.5,o=function(e,t){return n/2-$(this).height()/2};this.$item.css({height:n,"line-height":n+"px"}),this.$thumbs.width(r),this.$prev.css("top",o),this.$next.css("top",o),this.$item.find(".tt-media-video").css({height:n}),this.$item.find(".tt-media-img").css({"max-height":n});var s=this.$thumbs.width(),a=this.$thumbs.find("li"),l=parseInt(a.eq(0).css("margin-left"),10),c=a.eq(0).outerWidth(!0)-l,d=Math.floor(s/c);return this.thumbsBounds.width=s,this.thumbsBounds.shiftWidth=c*d,this.thumbsBounds.thumbsWidth=c*a.length+l,this.activeMedia?(this._focusSelectedThumbnail(),void this.$item.toggleClass("fullscreen",i.isFullscreen())):(this.$actions.hide(),this.$prev.addClass("disabled"),this.$next.addClass("disabled"),this.$left.find("i.fa").addClass("disabled"),void this.$right.find("i.fa").addClass("disabled"))},o.prototype._onRenderMedia=function(e,t){this.$item.html(t),$(window).trigger("resize")},o.prototype._onRenderThumbnails=function(e,t){this.$thumbs.find("ul").html(t),this.$thumbs.find("li").on("click",this.bind__onClickThumbnail),this.$thumbs.find("li").find("span").on("click",this.bind__onClickThumbRemove),$(window).trigger("resize")},o.prototype._renderMedia=function(){dust.render("media_element",{media:this.activeMedia?this.activeMedia.data:null,enable_controls:!0,preload_media:!1},this.bind__onRenderMedia)},o.prototype._renderMediaAndThumbnails=function(){return this.activeMedia?(this._renderMedia(),void dust.render("gallery_thumbnail",{media:this.options.media,can_edit:this.options.canEdit},this.bind__onRenderThumbnails)):(this.$item.html(""),this.$thumbs.find("ul").html(""),void $(window).trigger("resize"))},o.prototype._populate=function(){this.activeMedia=0==this.options.media.length?null:this.activeMedia?this.activeMedia:this.options.media[0],this._renderMediaAndThumbnails()},o.prototype.show=function(e){e=void 0!==e?e:this.options.mode==o.Mode.PREVIEW,this.options.mode==o.Mode.PREVIEW&&this.$container.addClass("tt-gallery-modal");var t=function(){this._populate()}.bind(this);e?this.$inner.fadeIn().promise().done(t):this.$inner.show().promise().done(t)},o.prototype.hide=function(e){e=void 0!==e?e:this.options.mode==o.Mode.PREVIEW,this.options.mode!=o.Mode.PREVIEW||this.paused||this.$container.removeClass("tt-gallery-modal");var t=function(){this.paused||this._dispatch(o.Event.HIDDEN,{galleryComponent:this})}.bind(this);e?this.$inner.fadeOut().promise().done(t):this.$inner.show().promise().done(t)},o.prototype.destroy=function(){this.$inner.remove()},o.prototype.setMedia=function(e){this.options.media=e,this._populate()},o.prototype.addMedia=function(e){this.options.media.push(e),this._populate()},o.prototype.removeMedia=function(e){var t=$.inArray(e,this.options.media);-1!=t&&(this.options.media.splice(t,1),0==this.options.media.length?this.activeMedia=null:(t>=this.options.media.length&&t--,this.activeMedia=this.options.media[t]),this._populate())},o.render=function(e,t){if("undefined"!==e.mode&&e.mode==o.Mode.INLINE&&"undefined"===e.$container)throw new Error("Inline mode requires the $container option to be set explicitly.");var n={$container:$("body"),identifier:Math.random(),mode:o.Mode.PREVIEW,canEdit:!1,media:[],activeMedia:null};e=e||n;for(var i in n)e[i]="undefined"!=typeof e[i]?e[i]:n[i];var r=e.mode==o.Mode.INLINE?"gallery_inline":"gallery_preview";dust.render(r,{identifier:e.identifier},function(n,i){e.$container.append(i);var r=new o(e);t.call(r,{galleryComponent:r})})},o}),define("component/mediaChooserComponent",["core/subscriber","factory/mediaFactory","factory/myFilesFactory","component/recorderComponent","component/myFilesSelectorComponent","component/galleryComponent","model/mediaModel","core/helper","extra"],function(e,t,n,i,r,o,s,a){var l=function(t){e.prototype.constructor.apply(this),this.options=t,this.media=[],this.bind__onClickRecordVideo=this._onClickRecordVideo.bind(this),this.bind__onClickUploadFile=this._onClickUploadFile.bind(this),this.bind__onClickSelect=this._onClickSelect.bind(this),this.bind__onChangeResourceFile=this._onChangeResourceFile.bind(this),this.$container=this.options.$container,this.$containerUpload=this.$container.find(l.Binder.CONTAINER_UPLOAD),this.$uploadForm=$(this.$containerUpload.data("form")),this.$resourceFile=this._getFormField("source_resource_file"),this.$recordVideo=this.$container.find(l.Binder.RECORD_VIDEO),this.$uploadFile=this.$container.find(l.Binder.UPLOAD_FILE),this.$select=this.$container.find(l.Binder.SELECT),this.$uploadTitle=this.$container.find(l.Binder.UPLOAD_TITLE),this.$working=this.$container.find(l.Binder.WORKING),this.$gallery=this.$container.find(l.Binder.GALLERY),this.$resourceFile.on("change",this.bind__onChangeResourceFile),this.$recordVideo.on("click",this.bind__onClickRecordVideo),this.$uploadFile.on("click",this.bind__onClickUploadFile),this.$select.on("click",this.bind__onClickSelect),this.$gallery.length>0&&o.render({$container:this.$gallery,mode:o.Mode.INLINE,canEdit:!0},function(e){this.galleryCmp=e.galleryComponent,this.galleryCmp.subscribe(o.Event.CHANGE,function(e){this.media=this.galleryCmp.options.media,this._invokeSuccess()}.bind(this)),this.galleryCmp.subscribe(o.Event.REMOVED_MEDIA,function(e){0==e.galleryComponent.options.media.length&&(this.galleryCmp.hide(!0),this.$gallery.slideUp()),this._removeSelectedMedia(e.media),this._invokeSuccess()}.bind(this))}.bind(this))};return l.extend(e),l.TAG="MediaChooserComponent",l.Binder={RECORD_VIDEO:".mediachooser-record-video",UPLOAD_FILE:".mediachooser-upload-file",SELECT:".mediachooser-select",CONTAINER_UPLOAD:".mediachooser-container-upload",UPLOAD_TITLE:".mediachooser-upload-title",WORKING:".mediachooser-working",GALLERY:".mediachooser-gallery"},l.Event={UPLOAD_START:"eventUploadStart",SUCCESS:"eventSuccess",SUCCESS_AND_POST:"eventSuccessAndPost",REMOVE:"eventRemove",ERROR:"eventError",RESET:"eventReset"},l.FORM_NAME="media",l.prototype._getFormField=function(e){return this.$uploadForm.find("#"+l.FORM_NAME+"_"+e)},l.prototype._addSelectedMedia=function(e){for(var t in this.media){var n=this.media[t];if(n.get("id")==e.get("id"))return}this.media.push(e),0!=this.$gallery.length&&(this.$gallery.slideDown(),this.galleryCmp.addMedia(e),this.galleryCmp.show(!0))},l.prototype._removeSelectedMedia=function(e){for(var t in this.media){var n=this.media[t];if(n.get("id")==e.get("id")){var e=this.media.splice(t,1);this.galleryCmp.removeMedia(t),this._dispatch(l.Event.REMOVE,{media:e,mediaChooserComponent:this})}}},l.prototype._resetUpload=function(){this.$containerUpload.hide(),this.$uploadTitle.html("")},l.prototype._invokeSuccess=function(e){this._resetUpload();var t="undefined"!=typeof e&&1==e?l.Event.SUCCESS_AND_POST:l.Event.SUCCESS,n={media:this.media,mediaChooserComponent:this};this._dispatch(t,n)},l.prototype._onClickRecordVideo=function(e){e.preventDefault(),i.render({enableDoneAndPost:this.options.enableDoneAndPost},function(e){this.recorderCmp=e.recorderComponent,this.recorderCmp.subscribe(i.Event.DONE,function(e){this.recorderCmp.hide(),this._addSelectedMedia(e.media),this._invokeSuccess(e.doPost)}.bind(this)),this.recorderCmp.subscribe(i.Event.HIDDEN,function(e){this.recorderCmp.destroy()}.bind(this)),this.recorderCmp.show()}.bind(this))},l.prototype._onClickUploadFile=function(e){e.preventDefault(),this.$resourceFile.click()},l.prototype._onClickSelect=function(e){e.preventDefault(),r.render({},function(e){this.mfsCmp=e.myFilesSelectorComponent,this.mfsCmp.subscribe(r.Event.DONE,function(e){this.mfsCmp.hide(),$.each(e.media,function(e,t){this._addSelectedMedia(t)}.bind(this)),this._invokeSuccess()}.bind(this)),this.mfsCmp.subscribe(r.Event.HIDDEN,function(e){this.mfsCmp.destroy()}.bind(this)),this.mfsCmp.show()}.bind(this))},l.prototype._onChangeResourceFile=function(e){e.preventDefault(),this._toggleForm(!0);var t=this.$resourceFile.data("maxsize"),i=this.$resourceFile[0].files[0].size;return i>t?(alert(Translator.trans("form.upload.maxFileSizeExceeded",{fileSize:(i/1048576).toFixed(1)+"MB",maxUploadSize:(t/1048576).toFixed(1)+"MB"
})),this.$resourceFile.val(""),void this._toggleForm(!1)):(n.add(this.$uploadForm[0]).progress(function(e){a.updateProgressBar(this.$containerUpload.show(),e)}.bind(this)).done(function(e){this._addSelectedMedia(e.media),this._invokeSuccess(),this._toggleForm(!1)}.bind(this)).fail(function(e){this._resetUpload(),this._dispatch(l.Event.ERROR,{mediaChooserComponent:this,error:e?e.error:"Unknown error"}),this._toggleForm(!1)}.bind(this)),this._dispatch(l.Event.UPLOAD_START,{mediaChooserComponent:this}),void this.$resourceFile.val(""))},l.prototype._toggleForm=function(e){this.$recordVideo.attr("disabled",e),this.$uploadFile.attr("disabled",e),this.$select.attr("disabled",e)},l.prototype.setMedia=function(e){console.log("%s: %s",l.TAG,"setMedia"),"undefined"!=typeof e&&(this._toggleForm(!0),this.$working.show(),t.list(e).done(function(e){this.$working.hide(),this._toggleForm(!1),$.each(e.media,function(e,t){this._addSelectedMedia(t)}.bind(this)),this._invokeSuccess()}.bind(this)).fail(function(e){this.$working.hide(),this._toggleForm(!1),console.error("%s: media factory list",l.TAG)}.bind(this)))},l.prototype.generateFormData=function(e){var t="";return $.each(this.media,function(n,i){var r=$(e.replace(/__name__/g,n));r.val(i.get("id")),t+=r[0].outerHTML}),t},l.prototype.reset=function(){console.log("%s: %s",l.TAG,"reset"),this._resetUpload(),this.galleryCmp.clear(),this._dispatch(l.Event.RESET,{mediaChooserComponent:this})},l.render=function(e,t){var n={enableDoneAndPost:!1};t=t||n;for(var i in n)t[i]="undefined"!=typeof t[i]?t[i]:n[i];return t.$container=e,new l(t)},l}),define("views/contact/listView",["component/tableComponent"],function(e){var t=function(n,i){this.controller=n,this.bind__onSelectionChange=this._onSelectionChange.bind(this),this.bind__onClickBulkAction=this._onClickBulkAction.bind(this),this.$container=i.container,this.$form=this.$container.find("form[name^="+t.FORM_NAME+"]"),this.$tabPanes=this.$container.find(t.Binder.TAB_PANES),this.tabPaneTblCmps=[],this.$tabPanes.each(function(t,n){this.tabPaneTblCmps[n.id]=e.table($(n)),this.tabPaneTblCmps[n.id].subscribe(e.Event.SELECTION_CHANGE,this.bind__onSelectionChange),this.tabPaneTblCmps[n.id].subscribe(e.Event.CLICK_BULK_ACTION,this.bind__onClickBulkAction)}.bind(this)),$tt._instances.push(this)};return t.TAG="ContactListView",t.Binder={TAB_PANES:".tab-pane[id^=tab]"},t.FORM_NAME="users_select",t.prototype._getFormField=function(e,t){return e.find("#"+e.attr("name")+"_"+t)},t.prototype._onSelectionChange=function(e){var t=e.tableComponent.getBulkActions();t.attr("disabled",0==e.$selection.length)},t.prototype._updateUsersSelectForm=function(e){var t=this._getFormField(this.$form,"users");t.html(""),e.each(function(e,n){var i=t.data("prototype");i=$(i.replace(/__name__/g,e)),i.val($(n).data("uid")),t.append(i)})},t.prototype._onClickBulkAction=function(e){switch(e.action){case 1:var t=e.tableComponent.getTable().attr("id").replace(/^tab/,"").toLowerCase();if("all"==t&&!confirm("This will delete the selected contacts from all lists. Continue?"))break;e.$bulkAction.attr("disabled",!0);var n=[];e.$selection.each(function(e,t){n.push($(t).data("uid"))}),this.controller["delete"](n,t).fail(function(t){t?alert(t.message):alert("Something went wrong."),e.$bulkAction.attr("disabled",!1)});break;case 2:e.$bulkAction.attr("disabled",!0),this._updateUsersSelectForm(e.$selection),this.$form.attr("action",Routing.generate("imdc_group_new")),this.$form.submit();break;case 3:e.$bulkAction.attr("disabled",!0),this._updateUsersSelectForm(e.$selection),this.$form.attr("action",Routing.generate("imdc_message_new")),this.$form.submit()}},t}),define("views/forum/newView",["component/mediaChooserComponent","component/accessTypeComponent"],function(e,t){var n=function(i,r){this.controller=i,this.bind__onSubmitForm=this._onSubmitForm.bind(this),this.bind__onUploadStart=this._onUploadStart.bind(this),this.bind__onSuccess=this._onSuccess.bind(this),this.bind__onRemove=this._onRemove.bind(this),this.bind__onReset=this._onReset.bind(this),this.bind__onError=this._onError.bind(this),this.$container=r.container,this.$form=this.$container.find("form[name^="+n.FORM_NAME+"]"),this.$submit=this.$container.find(n.Binder.SUBMIT),this.$form.on("submit",this.bind__onSubmitForm),this.atCmp=t.render(this.$form),this.mcCmp=e.render(this.$form),this.mcCmp.subscribe(e.Event.UPLOAD_START,this.bind__onUploadStart),this.mcCmp.subscribe(e.Event.SUCCESS,this.bind__onSuccess),this.mcCmp.subscribe(e.Event.REMOVE,this.bind__onRemove),this.mcCmp.subscribe(e.Event.RESET,this.bind__onReset),this.mcCmp.subscribe(e.Event.ERROR,this.bind__onError);var o=[];this._getFormField("titleMedia").children().each(function(e,t){o.push($(t).val())}),o.length>0&&(this.$submit.attr("disabled",!0),this.mcCmp.setMedia(o)),$tt._instances.push(this)};return n.TAG="ForumNewView",n.Binder={SUBMIT:".forum-submit"},n.FORM_NAME="forum",n.prototype._getFormField=function(e){return this.$form.find("#"+n.FORM_NAME+"_"+e)},n.prototype._onSubmitForm=function(e){this.$form[0].checkValidity()&&this.$submit.button("loading")},n.prototype._updateForm=function(){var e=this._getFormField("titleMedia");e.html(this.mcCmp.generateFormData(e.data("prototype"))),e=this._getFormField("titleText"),e.attr("required",0==this.mcCmp.media.length),e=e.parent().find("label"),0==this.mcCmp.media.length?e.addClass("required"):e.removeClass("required")},n.prototype._onUploadStart=function(e){this.$submit.attr("disabled",!0)},n.prototype._onSuccess=function(e){this._updateForm(),this.$submit.attr("disabled",!1)},n.prototype._onRemove=function(e){this._updateForm()},n.prototype._onReset=function(e){this._updateForm()},n.prototype._onError=function(e){alert("Error: "+e.error)},n}),define("views/forum/editView",["views/forum/newView"],function(e){var t=function(n,i){e.prototype.constructor.apply(this,arguments),this.bind__onClickDelete=this._onClickDelete.bind(this),this.$deleteModal=this.$container.find(t.Binder.DELETE_MODAL),this.$delete=this.$container.find(t.Binder.DELETE),this.$delete.on("click",this.bind__onClickDelete)};return t.extend(e),t.TAG="ForumEditView",t.Binder.DELETE_MODAL=".forum-delete-modal",t.Binder.DELETE=".forum-delete",t.prototype._onClickDelete=function(e){e.preventDefault(),this.$delete.button("loading"),this.controller["delete"]().done(function(e){this.$deleteModal.find(".modal-body").html("Forum deleted successfully.")}.bind(this)).fail(function(){this.$container.find(".modal-body").prepend("Something went wrong. Try again."),this.$delete.button("reset")}.bind(this))},t}),define("views/forum/viewView",["component/galleryComponent"],function(e){var t=function(n,i){this.controller=n,this.$container=i.container,this.$gallery=this.$container.find(t.Binder.GALLERY);var r=this.controller.model.get("ordered_media");r.length>0&&e.render({$container:this.$gallery,mode:e.Mode.INLINE,media:r},function(e){this.galleryCmp=e.galleryComponent,this.galleryCmp.show()}.bind(this)),$tt._instances.push(this)};return t.TAG="ForumViewView",t.Binder={GALLERY:".forum-gallery"},t}),define("views/group/newView",["component/mediaChooserComponent"],function(e){var t=function(n,i){this.controller=n,this.bind__onSubmitForm=this._onSubmitForm.bind(this),this.bind__onUploadStart=this._onUploadStart.bind(this),this.bind__onSuccess=this._onSuccess.bind(this),this.bind__onReset=this._onReset.bind(this),this.bind__onError=this._onError.bind(this),this.$container=i.container,this.$form=this.$container.find("form[name^="+t.FORM_NAME+"]"),this.$submit=this.$container.find(t.Binder.SUBMIT),this.$form.on("submit",this.bind__onSubmitForm),this.mcCmp=e.render(this.$form),this.mcCmp.subscribe(e.Event.UPLOAD_START,this.bind__onUploadStart),this.mcCmp.subscribe(e.Event.SUCCESS,this.bind__onSuccess),this.mcCmp.subscribe(e.Event.RESET,this.bind__onReset),this.mcCmp.subscribe(e.Event.ERROR,this.bind__onError);var r=[];this._getFormField("media").children().each(function(e,t){r.push($(t).val())}),r.length>0&&(this.$submit.attr("disabled",!0),this.mcCmp.setMedia(r)),$tt._instances.push(this)};return t.TAG="GroupNewView",t.Binder={SUBMIT:".group-submit"},t.FORM_NAME="user_group",t.prototype._getFormField=function(e){return this.$form.find("#"+t.FORM_NAME+"_"+e)},t.prototype._onSubmitForm=function(e){this.$form[0].checkValidity()&&this.$submit.button("loading")},t.prototype._updateForm=function(){var e=this._getFormField("media");e.html(this.mcCmp.generateFormData(e.data("prototype")))},t.prototype._onUploadStart=function(e){this.$submit.attr("disabled",!0)},t.prototype._onSuccess=function(e){this._updateForm(),this.$submit.attr("disabled",!1)},t.prototype._onReset=function(e){this._updateForm()},t.prototype._onError=function(e){alert("Error: "+e.error)},t}),define("views/group/editView",["views/group/newView"],function(e){var t=function(n,i){e.prototype.constructor.apply(this,arguments),this.bind__onClickDelete=this._onClickDelete.bind(this),this.$deleteModal=this.$container.find(t.Binder.DELETE_MODAL),this.$delete=this.$container.find(t.Binder.DELETE),this.$delete.on("click",this.bind__onClickDelete)};return t.extend(e),t.TAG="GroupEditView",t.Binder.DELETE_MODAL=".group-delete-modal",t.Binder.DELETE=".group-delete",t.prototype._onClickDelete=function(e){e.preventDefault(),this.$delete.button("loading"),this.controller["delete"]().done(function(e){this.$deleteModal.find(".modal-body").html("Group deleted successfully.")}.bind(this)).fail(function(){this.$container.find(".modal-body").prepend("Something went wrong. Try again."),this.$delete.button("reset")}.bind(this))},t}),define("views/group/viewView",["component/galleryComponent"],function(e){var t=function(n,i){this.controller=n,this.$container=i.container,this.$gallery=this.$container.find(t.Binder.GALLERY);var r=this.controller.model.get("ordered_media");r.length>0&&e.render({$container:this.$gallery,mode:e.Mode.INLINE,media:r},function(e){this.galleryCmp=e.galleryComponent,this.galleryCmp.show()}.bind(this)),$tt._instances.push(this)};return t.TAG="GroupViewView",t.Binder={GALLERY:".group-gallery"},t}),define("views/group/manageView",["component/tableComponent"],function(e){var t=function(n,i){this.controller=n,this.bind___onClickFormCheckboxLink=this._onClickFormCheckboxLink.bind(this),this.bind__onShownTab=this._onShownTab.bind(this),this.bind__onClickRemove=this._onClickRemove.bind(this),this.bind__onClickAdd=this._onClickAdd.bind(this),this.$container=i.container,this.$formSearch=this.$container.find("form[name^="+t.FORM_NAME_SEARCH+"]"),this.$formRemove=this.$container.find("form[name^="+t.FORM_NAME_REMOVE+"]"),this.$formAdd=this.$container.find("form[name^="+t.FORM_NAME_ADD+"]"),this.$formCheckboxLinks=this.$formSearch.find('label[class^="checkbox"] a'),this.$tabs=this.$container.find(t.Binder.TABS),this.$tabPanes=this.$container.find(t.Binder.TAB_PANES),this.$remove=this.$container.find(t.Binder.REMOVE),this.$add=this.$container.find(t.Binder.ADD),this.$formCheckboxLinks.on("click",this.bind___onClickFormCheckboxLink),this.$tabs.on("shown.bs.tab",this.bind__onShownTab),this.$remove.on("click",this.bind__onClickRemove),this.$add.on("click",this.bind__onClickAdd);var r=function(e){this.$remove.attr("disabled",0==e.$selection.length)}.bind(this),o=function(e){this.$add.attr("disabled",0==e.$selection.length)}.bind(this),s=function(e){return"remove"==e?r:o};this.tableCmps=[],this.$tabPanes.each(function(t,n){var i=$(n),r=s(i.data("type")),o=e.table(i);o.subscribe(e.Event.SELECTION_CHANGE,r),this.tableCmps.push(o)}.bind(this)),this.$tabs.filter('[href="'+(location.hash?"#tab"+location.hash.substr(1):"#tabMembers")+'"]').tab("show"),$tt._instances.push(this)};return t.TAG="GroupManageView",t.Binder={TABS:'a[data-toggle="tab"]',TAB_PANES:"[id^=tab]",REMOVE:".group-remove",ADD:".group-add"},t.FORM_NAME="ugm_",t.FORM_NAME_SEARCH=t.FORM_NAME+"search",t.FORM_NAME_REMOVE=t.FORM_NAME+"remove",t.FORM_NAME_ADD=t.FORM_NAME+"add",t.prototype._getFormField=function(e,t){return e.find("#"+e.attr("name")+"_"+t)},t.prototype._onClickFormCheckboxLink=function(e){e.preventDefault();var t=this.$formSearch.find('input[type="checkbox"]'),n=$(e.target).parent().find('input[type="checkbox"]'),i=n.prop("checked");t.prop("checked",!1),n.prop("checked",!i),this.$formSearch[0].submit()},t.prototype._onShownTab=function(e){var t="#"+$(e.target).attr("href").substr(4);history.pushState?history.pushState(null,null,t):location.hash=t,this.$tabPanes.find("ul.pagination li a").each(function(e,n){var i=$(n),r=i.attr("href"),e=r.lastIndexOf("#");e>0&&(r=r.substring(0,e)),i.attr("href",r+t)})},t.prototype._updateUsersSelectForm=function(e,t){var n=this._getFormField(e,"users");t.button("loading"),t.toggleClass("disabled"),n.html(""),$.each(this.tableCmps,function(e,t){t.getSelection().each(function(e,t){var i=n.data("prototype");i=$(i.replace(/__name__/g,e)),i.val($(t).data("uid")),n.append(i)})}.bind(this))},t.prototype._onClickRemove=function(e){e.preventDefault(),this._updateUsersSelectForm(this.$formRemove,this.$remove),this.$formRemove.submit()},t.prototype._onClickAdd=function(e){e.preventDefault(),this._updateUsersSelectForm(this.$formAdd,this.$add),this.$formAdd.submit()},t}),define("views/message/newView",["component/mediaChooserComponent"],function(e){var t=function(n,i){this.controller=n,this.bind__onSubmitForm=this._onSubmitForm.bind(this),this.bind__onUploadStart=this._onUploadStart.bind(this),this.bind__onSuccess=this._onSuccess.bind(this),this.bind__onReset=this._onReset.bind(this),this.bind__onError=this._onError.bind(this),this.$container=i.container,this.$form=this.$container.find("form[name^="+t.FORM_NAME+"]"),this.$submit=this.$container.find(t.Binder.SUBMIT),this.$form.on("submit",this.bind__onSubmitForm),this.mcCmp=e.render(this.$form),this.mcCmp.subscribe(e.Event.UPLOAD_START,this.bind__onUploadStart),this.mcCmp.subscribe(e.Event.SUCCESS,this.bind__onSuccess),this.mcCmp.subscribe(e.Event.RESET,this.bind__onReset),this.mcCmp.subscribe(e.Event.ERROR,this.bind__onError);var r=[];this._getFormField("attachedMedia").children().each(function(e,t){r.push($(t).val())}),r.length>0&&(this.$submit.attr("disabled",!0),this.mcCmp.setMedia(r)),this._getFormField("recipients").tagit(),$tt._instances.push(this)};return t.TAG="MessageNewView",t.Binder={SUBMIT:".message-submit"},t.FORM_NAME="PrivateMessageForm",t.prototype._getFormField=function(e){return this.$form.find("#"+t.FORM_NAME+"_"+e)},t.prototype._onSubmitForm=function(e){this.$form[0].checkValidity()&&this.$submit.button("loading")},t.prototype._updateForm=function(){var e=this._getFormField("attachedMedia");e.html(this.mcCmp.generateFormData(e.data("prototype")))},t.prototype._onUploadStart=function(e){this.$submit.attr("disabled",!0)},t.prototype._onSuccess=function(e){this.$submit.attr("disabled",!1),this._updateForm()},t.prototype._onReset=function(e){this._updateForm()},t.prototype._onError=function(e){alert("Error: "+e.error)},t}),define("views/message/replyView",["views/message/newView"],function(e){var t=function(t,n){e.prototype.constructor.apply(this,arguments)};return t.extend(e),t.TAG="MessageReplyView",t}),define("views/message/viewView",["component/galleryComponent"],function(e){var t=function(n,i){this.controller=n,this.$container=i.container,this.$gallery=this.$container.find(t.Binder.GALLERY);var r=this.controller.model.get("ordered_media");r.length>0&&e.render({$container:this.$gallery,mode:e.Mode.INLINE,media:r},function(e){this.galleryCmp=e.galleryComponent,this.galleryCmp.show()}.bind(this)),$tt._instances.push(this)};return t.TAG="MessageViewView",t.Binder={GALLERY:".message-gallery"},t}),define("views/myFiles/listView",["service","model/model","component/tableComponent","component/mediaChooserComponent","component/galleryComponent","core/helper"],function(e,t,n,i,r,o){var s=function(r,o){this.controller=r,this.bind__onClickBulkAction=this._onClickBulkAction.bind(this),this.bind__onClickFile=this._onClickFile.bind(this),this.bind__onSuccess=this._onSuccess.bind(this),this.bind__onError=this._onError.bind(this),this.bind__onAddGridElement=this._onAddGridElement.bind(this),this.bind__onAddListElement=this._onAddListElement.bind(this),this.$container=o.container,this.$filesList=this.$container.find(s.Binder.FILES_LIST),this.$fileButtons=this.$container.find(s.Binder.FILE_BUTTON),this.tblCmp=n.table(this.$filesList),this.tblCmp.subscribe(n.Event.CLICK_BULK_ACTION,this.bind__onClickBulkAction),this.$filesList.find("button.edit-title").on("click",function(e){e.stopPropagation(),$(this).parent().parent().parent().find("span.edit-title").editable("toggle")}),this.$fileButtons.not("[disabled]").on("click",this.bind__onClickFile),this.$filesList.children("div.table-responsive").length>0?this.style=s.Binder.STYLE_LIST:this.style=s.Binder.STYLE_GRID,this.mcCmp=i.render(this.$container),this.mcCmp.subscribe(i.Event.SUCCESS,this.bind__onSuccess),this.mcCmp.subscribe(i.Event.RESET,this.bind__onReset),this.mcCmp.subscribe(i.Event.ERROR,this.bind__onError),this.$filesList.find("span.edit-title").editable({toggle:"manual",unsavedclass:null,pk:function(){return $(this).data("mid")},url:function(e){return this.controller.edit(e.pk,{title:e.value})}.bind(this)});var a=e.get("subscriber");a.dispatch(s.TAG,"onViewLoaded",{view:this}),this.controller.model.subscribe(t.Event.CHANGE,function(e){var t=e.model.get(e.keyPath),n=this.$filesList.find('span.edit-title[data-mid="'+t.get("id")+'"]');n.html(t.get("title"))}.bind(this)),$tt._instances.push(this)};return s.TAG="MyFilesListView",s.Binder={TOGGLE_STYLE:".my-files-selector-toggle-style",FILES_LIST:".my-files-selector-files-list",FILE_BUTTON:".my-files-selector-file-button",STYLE_LIST:"list",STYLE_GRID:"grid"},s.MAX_PER_PAGE=24,s.MAX_PER_ROW=4,s.prototype._onClickBulkAction=function(e){switch(e.action){case 1:if(confirm(Translator.trans("filesGateway.deleteConfirmMessage"))){$.each(e.$selection,function(e,t){this.controller["delete"]($(t).data("mid"),!0);var n;n=this.style==s.Binder.STYLE_LIST?$(t).parents("tr"):$(t).parents("div.col-md-3"),n.fadeOut(1e3,function(){n.remove()}),$(t).prop("checked",!1)}.bind(this));var t=setInterval(function(){this.$filesList=this.$container.find(s.Binder.FILES_LIST),this.$fileButtons=this.$container.find(s.Binder.FILE_BUTTON);var e=$(this.$fileButtons).parent("div.thumbnail.tt-grid-div-body").parent();if(!$(e).is(":animated")&&(this.tblCmp.updateElements(this.$filesList),clearInterval(t),this.style==s.Binder.STYLE_GRID)){for(var n=$(e).parent(),i=$(this.$fileButtons).parent("div.thumbnail.tt-grid-div-body").length,r=1;i>r;r++)$(e[r]).parent().is($(e[r-1]).parent())||r%s.MAX_PER_ROW==0||$(e[r]).insertAfter($(e[r-1]));$.each($(n),function(e,t){0==$(t).children().length&&$(t).remove()})}}.bind(this),200)}}},s.prototype._onClickFile=function(e){e.stopPropagation();var t=this.controller.model.getMedia($(e.currentTarget).data("mid"));if(!t)throw new Error("media not found");r.render({media:this.controller.model.get("media"),activeMedia:t},function(e){this.galleryCmp=e.galleryComponent,this.galleryCmp.subscribe(r.Event.HIDDEN,function(e){this.galleryCmp.destroy()}.bind(this)),this.galleryCmp.show()}.bind(this))},s.prototype.getTableComponent=function(){return this.tblCmp},s.prototype._onAddGridElement=function(e,t){var n=$(t),i=$(this.$fileButtons).parent("div.thumbnail.tt-grid-div-body").length,r=$(this.$fileButtons).parent("div.thumbnail.tt-grid-div-body").parent();if(i>=s.MAX_PER_PAGE){n.insertBefore(r[0]);for(var o=s.MAX_PER_ROW-1;i>o;o+=s.MAX_PER_ROW)$(r[o]).insertBefore($(r[o+1]));$(r[i-1]).remove()}else if(i%s.MAX_PER_ROW==0){var a=$("<div class='row'></div>"),l=$(this.$filesList.children("div.tt-myFiles-grid-div")[0]);if(0==i)l.empty(),a.append(n),l.append(a);else{n.insertBefore(r[0]);for(var o=s.MAX_PER_ROW-1;i>o;o+=s.MAX_PER_ROW)$(r[o]).insertBefore($(r[o+1]));l.append(a),a.append($(r[i-1]).detach())}}else{n.insertBefore(r[0]);for(var o=s.MAX_PER_ROW-1;i>o;o+=s.MAX_PER_ROW)$(r[o]).insertBefore($(r[o+1]))}n.find("button.edit-title").on("click",function(e){e.stopPropagation(),$(this).parent().parent().parent().find("span.edit-title").editable("toggle")}),n.find("span.edit-title").editable({toggle:"manual",unsavedclass:null,pk:function(){return $(this).data("mid")},url:function(e){return this.controller.edit(e.pk,{title:e.value})}.bind(this)}),n.find(".my-files-selector-file-click").not("[disabled]").on("click",this.bind__onClickFile),this.$filesList=this.$container.find(s.Binder.FILES_LIST),this.$fileButtons=this.$container.find(s.Binder.FILE_BUTTON),this.tblCmp.updateElements(this.$filesList)},s.prototype._onAddListElement=function(e,t){var n=$(t),i=$(this.$fileButtons).parent("tr").length,r=$(this.$fileButtons).parent("tr");i>=s.MAX_PER_PAGE?(n.insertBefore(r[0]),r[i-1].remove()):0==i?($(this.$filesList).find("div.table-responsive > div").remove(),r=$(this.$filesList).find("tbody > tr"),n.insertBefore(r[0]),$(r[0]).remove()):n.insertBefore(r[0]),n.find("button.edit-title").on("click",function(e){e.stopPropagation(),$(this).parent().parent().parent().find("span.edit-title").editable("toggle")}),n.find("span.edit-title").editable({toggle:"manual",unsavedclass:null,pk:function(){return $(this).data("mid")},url:function(e){return this.controller.edit(e.pk,{title:e.value})}.bind(this)}),n.find(".my-files-selector-file-click").not("[disabled]").on("click",this.bind__onClickFile),this.$filesList=this.$container.find(s.Binder.FILES_LIST),this.$fileButtons=this.$container.find(s.Binder.FILE_BUTTON),this.tblCmp.updateElements(this.$filesList)},s.prototype._onSuccess=function(e){console.log(e);var t=e.media[e.media.length-1].data;if(this.controller.model.addMedia(t),this.style==s.Binder.STYLE_GRID)dust.render("myFilesGridElement",{media:t,previewTitle:Translator.trans("filesGateway.previewLink"),editTitle:Translator.trans("form.media.title"),shareTitle:Translator.trans("filesGateway.shareLink"),shareUrl:Routing.generate("imdc_thread_new_from_media",{mediaId:t.id}),mediaIcon:o.getIconForMediaType(t.type)},this.bind__onAddGridElement);else{var n=o.formatSize(t.source_resource.meta_data.size),i=!1;0>n&&(i=!0),dust.render("myFilesListElement",{media:t,previewTitle:Translator.trans("filesGateway.previewLink"),editTitle:Translator.trans("form.media.title"),shareTitle:Translator.trans("filesGateway.shareLink"),shareUrl:Routing.generate("imdc_thread_new_from_media",{mediaId:t.id}),mediaIcon:o.getIconForMediaType(t.type),timeUploaded:o.getTimeDateString(t.source_resource.meta_data.time_created),spinner:i,formattedSize:n},this.bind__onAddListElement)}},s.prototype._onError=function(e){alert("Error: "+e.error)},s}),define("views/post/newView",["model/model","component/mediaChooserComponent"],function(e,t){var n=function(i,r){this.controller=i,this.options=r,this.bind__onClickSubmit=this._onClickSubmit.bind(this),this.bind__onClickReset=this._onClickReset.bind(this),this.bind__onClickCancel=this._onClickCancel.bind(this),this.bind__onUploadStart=this._onUploadStart.bind(this),this.bind__onSuccess=this._onSuccess.bind(this),this.bind__onSuccessAndPost=this._onSuccessAndPost.bind(this),this.bind__onReset=this._onReset.bind(this),this.bind__onModelChange=this._onModelChange.bind(this),this.bind__onError=this._onError.bind(this),this.$container=$(n.Binder.CONTAINER+'[data-pid="'+this.controller.model.get("id")+'"]'),this.$form=this.$container.find("form[name^="+n.FORM_NAME+"]"),this.$submit=this.$container.find(n.Binder.SUBMIT),this.$reset=this.$container.find(n.Binder.RESET),this.$cancel=this.$container.find(n.Binder.CANCEL),this.$submit.on("click",this.bind__onClickSubmit),this.$reset.on("click",this.bind__onClickReset),this.$cancel.on("click",this.bind__onClickCancel),this.mcCmp=t.render(this.$form,{enableDoneAndPost:!0}),this.mcCmp.subscribe(t.Event.UPLOAD_START,this.bind__onUploadStart),this.mcCmp.subscribe(t.Event.SUCCESS,this.bind__onSuccess),this.mcCmp.subscribe(t.Event.SUCCESS_AND_POST,this.bind__onSuccessAndPost),this.mcCmp.subscribe(t.Event.RESET,this.bind__onReset),this.mcCmp.subscribe(t.Event.ERROR,this.bind__onError),this.controller.model.subscribe(e.Event.CHANGE,this.bind__onModelChange),$tt._instances.push(this)};return n.TAG="PostNewView",n.Binder={CONTAINER:".post-container",SUBMIT:".post-submit-new",RESET:".post-reset",CANCEL:".post-cancel-new"},n.FORM_NAME="post",n.prototype.loadView=function(){var e=[];this._getFormField("attachedFile").children().each(function(t,n){e.push($(n).val())}),e.length>0&&(this._toggleForm(!0),this.mcCmp.setMedia(e))},n.prototype._getFormField=function(e){return this.$form.find("#"+n.FORM_NAME+"_"+e)},n.prototype._toggleForm=function(e){this.$submit.button(e?"loading":"reset"),this.$reset.attr("disabled",e),this.$cancel.attr("disabled",e)},n.prototype._preSubmit=function(){return""==this._getFormField("content").val()&&0==this.mcCmp.media.length?(alert("Your post cannot be blank. You must either select a file or write a comment."),!1):(this._toggleForm(!0),!0)},n.prototype._reset=function(){this.mcCmp.reset(),this._getFormField("startTime").val(this.controller.model.get("keyPoint.startTime")),this._getFormField("endTime").val(this.controller.model.get("keyPoint.endTime")),this._getFormField("content").val(""),this.controller.editKeyPoint({cancel:!0})},n.prototype._destroy=function(){this.$container.remove(),this.controller.removeKeyPoint(),this.controller.removeFromThread()},n.prototype._onClickSubmit=function(e){e.preventDefault(),this._preSubmit()&&this.controller.post(this.$form[0]).done(function(e){this.controller.addToThread(e.post),this.options.is_permanent?(this._reset(),this._toggleForm(!1)):this._destroy()}.bind(this)).fail(function(e){this.controller.updateInThread("new")}.bind(this))},n.prototype._onClickReset=function(e){e.preventDefault(),this._reset()},n.prototype._onClickCancel=function(e){e.preventDefault(),this._destroy()},n.prototype._onSelectionTimes=function(e,t){this._getFormField("startTime").val(e),this._getFormField("endTime").val(t)},n.prototype._onModelChange=function(e){this._onSelectionTimes(e.model.get("keyPoint.selection.startTime",""),e.model.get("keyPoint.selection.endTime",""))},n.prototype._updateForm=function(){var e=this._getFormField("attachedFile");e.html(this.mcCmp.generateFormData(e.data("prototype")))},n.prototype._onUploadStart=function(e){this.$submit.attr("disabled",!0)},n.prototype._onSuccess=function(e){this._updateForm(),this.$submit.attr("disabled",!1),this._toggleForm(!1)},n.prototype._onSuccessAndPost=function(e){this._updateForm(),this.$submit.trigger("click")},n.prototype._onReset=function(e){this._updateForm()},n.prototype._onError=function(e){alert("Error: "+e.error)},n}),define("views/post/editView",["views/post/newView"],function(e){var t=function(n,i){e.prototype.constructor.apply(this,arguments),this.bind__onClickSubmit=this._onClickSubmit.bind(this),this.bind__onClickCancel=this._onClickCancel.bind(this),this.$submit=this.$container.find(t.Binder.SUBMIT),this.$cancel=this.$container.find(t.Binder.CANCEL),this.$submit.on("click",this.bind__onClickSubmit),this.$cancel.on("click",this.bind__onClickCancel)};return t.extend(e),t.TAG="PostEditView",t.Binder.SUBMIT=".post-submit-edit",t.Binder.CANCEL=".post-cancel-edit",t.prototype._toggleForm=function(e){this.$submit.button(e?"loading":"reset"),this.$cancel.attr("disabled",e)},t.prototype._onClickSubmit=function(e){e.preventDefault(),this._preSubmit()&&this.controller.put(this.$form[0]).done(function(e){this.controller.updateInThread("view"),this.controller.model.get("is_temporal",!1)&&this.controller.editKeyPoint({cancel:!0})}.bind(this)).fail(function(e){this.controller.updateInThread("edit")}.bind(this))},t.prototype._onClickCancel=function(e){e.preventDefault(),this.controller.get().done(function(e){this.controller.updateInThread("view"),this.controller.model.get("is_temporal",!1)&&this.controller.editKeyPoint({cancel:!0})}.bind(this)).fail(function(e){})},t}),define("views/post/viewView",["model/model","component/galleryComponent"],function(e,t){var n=function(i,r){this.controller=i,this.bind__onClickHoverKeyPoint=this._onClickHoverKeyPoint.bind(this),this.bind__onClickNew=this._onClickNew.bind(this),this.bind__onClickEdit=this._onClickEdit.bind(this),this.bind__onClickDelete=this._onClickDelete.bind(this),this.bind__onModelChange=this._onModelChange.bind(this),this.$container=$(n.Binder.CONTAINER+'[data-pid="'+this.controller.model.get("id")+'"]'),this.$timelineKeyPoint=this.$container.find(n.Binder.TIMELINE_KEYPOINT),this.$gallery=this.$container.find(n.Binder.GALLERY),this.$new=this.$container.find(n.Binder.NEW),this.$edit=this.$container.find(n.Binder.EDIT),this.$deleteModal=this.$container.find(n.Binder.DELETE_MODAL),this.$delete=this.$container.find(n.Binder.DELETE),this.$timelineKeyPoint.on("click",this.bind__onClickHoverKeyPoint),this.$timelineKeyPoint.on("dblclick",this.bind__onClickHoverKeyPoint),this.$timelineKeyPoint.hover(this.bind__onClickHoverKeyPoint,this.bind__onClickHoverKeyPoint),this.$new.on("click",this.bind__onClickNew),this.$edit.on("click",this.bind__onClickEdit),this.$delete.on("click",this.bind__onClickDelete),this.controller.model.subscribe(e.Event.CHANGE,this.bind__onModelChange);var o=this.controller.model.get("ordered_media");o&&o.length>0&&t.render({$container:this.$gallery,mode:t.Mode.INLINE,media:o},function(e){this.galleryCmp=e.galleryComponent,this.galleryCmp.show()}.bind(this)),$tt._instances.push(this)};return n.TAG="PostViewView",n.Binder={CONTAINER:".post-container",TIMELINE_KEYPOINT:".post-timeline-keypoint",GALLERY:".post-gallery",NEW:".post-new",EDIT:".post-edit",DELETE_MODAL:".post-delete-modal",DELETE:".post-delete"},n.prototype._onClickHoverKeyPoint=function(e){switch(e.type){case"mouseenter":case"mouseleave":this.controller.hoverKeyPoint({isMouseOver:"mouseenter"==e.type});break;case"click":case"dblclick":e.preventDefault(),this.controller.clickKeyPoint({isDblClick:"dblclick"==e.type})}},n.prototype._onClickNew=function(e){e.preventDefault(),this.$new.hide(),this.controller["new"](null).done(function(e){this.controller.addToThread(e.post)}.bind(this)).fail(function(e){this.$new.show()}.bind(this))},n.prototype._onClickEdit=function(e){e.preventDefault(),this.controller.edit().done(function(e){this.controller.updateInThread("edit"),this.controller.model.get("is_temporal",!1)&&this.controller.editKeyPoint({cancel:!1})}.bind(this)).fail(function(e){})},n.prototype._onClickDelete=function(e){e.preventDefault(),this.$delete.button("loading"),this.controller["delete"]().done(function(e){this.$deleteModal.find(".modal-body").html("Post deleted successfully."),this.$deleteModal.data("bs.modal").isShown?(this.$deleteModal.on("hidden.bs.modal",function(e){this.controller.removeFromThread()}.bind(this)),this.$deleteModal.modal("hide")):this.controller.removeFromThread()}.bind(this)).fail(function(e){this.$container.find(".modal-body").prepend("Something went wrong. Try again."),this.$delete.button("reset")}.bind(this))},n.prototype._renderKeyPoint=function(e,t,i){console.log("%s: %s",n.TAG,"_renderKeyPoint");var r=(100*e/i).toFixed(2),o=(100*t/i).toFixed(2),s=(o-r).toFixed(2);this.$timelineKeyPoint.css({left:r+"%",width:s+"%"})},n.prototype._hoverKeyPoint=function(e){e?this.$container.addClass("tt-post-container-highlight"):this.$container.removeClass("tt-post-container-highlight")},n.prototype._clickKeyPoint=function(e){var t=this.$container.find("video")[0];t&&e&&(t.currentTime=0,t.play())},n.prototype._onModelChange=function(e){this._renderKeyPoint(e.model.get("keyPoint.startTime",""),e.model.get("keyPoint.endTime",""),e.model.get("keyPoint.videoDuration","")),this._hoverKeyPoint(e.model.get("keyPoint.isPlayerHovering",!1)),this._clickKeyPoint(e.model.get("keyPoint.isPlayerPlaying",!1)),this.$new.show()},n}),define("views/profile/editView",[],function(){var e=function(t,n){this.controller=t,this.bind__onClickAddLanguage=this._onClickAddLanguage.bind(this),this.bind__onClickDeleteLanguage=this._onClickDeleteLanguage.bind(this),
this.$container=n.container,this.$addLang=this.$container.find(e.Binder.ADD_LANGUAGE),this.$delLang=this.$container.find(e.Binder.DELETE_LANGUAGE),this.$addLang.on("click",this.bind__onClickAddLanguage),this.$delLang.on("click",this.bind__onClickDeleteLanguage),$tt._instances.push(this)};return e.TAG="ProfileEditView",e.Binder={ADD_LANGUAGE:".profile-add-lang",DELETE_LANGUAGE:".profile-del-lang"},e.prototype._onClickAddLanguage=function(e){e.preventDefault();var t,n=$("#foss_user_profile_form_languages"),i=n.data("delete-language-text"),r=n.data("prototype"),o=$("#foss_user_profile_form_languages > li").length;$("#no-languages").remove(),t=$('<button class="btn btn-danger btn-sm profile-del-lang"></a>').html(i),t.on("click",this.bind__onClickDeleteLanguage),r=r.replace(/__name__/g,o),o++;var s=$("<li></li>").html(r);s.append(t),$("#foss_user_profile_form_languages").append(s)},e.prototype._onClickDeleteLanguage=function(e){e.preventDefault();var t=$("#foss_user_profile_form_languages"),n=t.data("no-languages-text"),i=$('<span id="no-languages"></span>').html(n);$(e.target).parent().remove(),0==$("#foss_user_profile_form_languages > li").length&&$("#foss_user_profile_form_languages").append(i)},e}),define("views/thread/newView",["component/mediaChooserComponent","component/accessTypeComponent"],function(e,t){var n=function(i,r){this.controller=i,this.bind__onSubmitForm=this._onSubmitForm.bind(this),this.bind__onUploadStart=this._onUploadStart.bind(this),this.bind__onSuccess=this._onSuccess.bind(this),this.bind__onRemove=this._onRemove.bind(this),this.bind__onReset=this._onReset.bind(this),this.bind__onError=this._onError.bind(this),this.$container=r.container,this.$form=this.$container.find("form[name^="+n.FORM_NAME+"]"),this.$submit=this.$container.find(n.Binder.SUBMIT),this.$form.on("submit",this.bind__onSubmitForm),this.atCmp=t.render(this.$form),this.mcCmp=e.render(this.$form),this.mcCmp.subscribe(e.Event.UPLOAD_START,this.bind__onUploadStart),this.mcCmp.subscribe(e.Event.SUCCESS,this.bind__onSuccess),this.mcCmp.subscribe(e.Event.REMOVE,this.bind__onRemove),this.mcCmp.subscribe(e.Event.RESET,this.bind__onReset),this.mcCmp.subscribe(e.Event.ERROR,this.bind__onError);var o=[];this._getFormField("mediaIncluded").children().each(function(e,t){o.push($(t).val())}),o.length>0&&(this.$submit.attr("disabled",!0),this.mcCmp.setMedia(o)),$tt._instances.push(this)};return n.TAG="ThreadNewView",n.Binder={SUBMIT:".thread-submit"},n.FORM_NAME="thread",n.prototype._getFormField=function(e){return this.$form.find("#"+n.FORM_NAME+"_"+e)},n.prototype._onSubmitForm=function(e){this.$form[0].checkValidity()&&this.$submit.button("loading")},n.prototype._updateForm=function(){var e=this._getFormField("mediaIncluded");e.html(this.mcCmp.generateFormData(e.data("prototype"))),e=this._getFormField("title"),e.attr("required",0==this.mcCmp.media.length),e=e.parent().find("label"),0==this.mcCmp.media.length?e.addClass("required"):e.removeClass("required")},n.prototype._onUploadStart=function(e){this.$submit.attr("disabled",!0)},n.prototype._onSuccess=function(e){this._updateForm(),this.$submit.attr("disabled",!1)},n.prototype._onRemove=function(e){this._updateForm()},n.prototype._onReset=function(e){this._updateForm()},n.prototype._onError=function(e){alert("Error: "+e.error)},n}),define("views/thread/editView",["views/thread/newView"],function(e){var t=function(n,i){e.prototype.constructor.apply(this,arguments),this.bind__onClickDelete=this._onClickDelete.bind(this),this.$deleteModal=this.$container.find(t.Binder.DELETE_MODAL),this.$delete=this.$container.find(t.Binder.DELETE),this.$delete.on("click",this.bind__onClickDelete)};return t.extend(e),t.TAG="ThreadEditView",t.Binder.DELETE_MODAL=".thread-delete-modal",t.Binder.DELETE=".thread-delete",t.prototype._onClickDelete=function(e){e.preventDefault(),this.$delete.button("loading"),this.controller["delete"]().done(function(e){this.$deleteModal.find(".modal-body").html("Topic deleted successfully.")}.bind(this)).fail(function(){this.$container.find(".modal-body").prepend("Something went wrong. Try again."),this.$delete.button("reset")}.bind(this))},t}),define("views/thread/viewView",["model/model","core/helper","bootstrap"],function(e,t,n){var i=function(t,n){this.controller=t,this.options=n,this.player=null,this.playingKeyPoint=null,this.bind__onClickVideoSpeed=this._onClickVideoSpeed.bind(this),this.bind__onClickClosedCaptions=this._onClickClosedCaptions.bind(this),this.bind__onAreaSelectionChanged=this._onAreaSelectionChanged.bind(this),this.bind__onMouseOverKeyPoint=this._onMouseOverKeyPoint.bind(this),this.bind__onMouseOutKeyPoint=this._onMouseOutKeyPoint.bind(this),this.bind__onRightClickKeyPoint=this._onRightClickKeyPoint.bind(this),this.bind__onEndKeyPoint=this._onEndKeyPoint.bind(this),this.bind__onPlaybackStarted=this._onPlaybackStarted.bind(this),this.bind__onPlaybackStopped=this._onPlaybackStopped.bind(this),this.bind__onSeek=this._onSeek.bind(this),this.bind__onModelChange=this._onModelChange.bind(this),this.$container=n.container,this.$opContainer=n.op_container,this.$postContainer=n.post_container;var r=this.$opContainer.find(i.Binder.MEDIA_ELEMENT+" video");if(this.$video=r.eq(2==r.length?1:0),this.$pipVideo=r.eq(2==r.length?0:1),$("#videoSpeed").on("click",this.bind__onClickVideoSpeed),$("#closedCaptions").on("click",this.bind__onClickClosedCaptions),1===this.controller.model.get("type")&&this.controller.model.get("ordered_media").length>0){this.$video.on("loadedmetadata",function(e){this.controller.updateKeyPointDuration(e.target.duration)}.bind(this)),this._createPlayer();var o=this.controller.model.get("ordered_media.0");o&&o.is_interpretation&&(this.$pipVideo[0].currentTime=o.source_start_time)}this.controller.model.subscribe(e.Event.CHANGE,this.bind__onModelChange),$tt._instances.push(this)};return i.TAG="ThreadViewView",i.DEFAULT_TEMPORAL_COMMENT_LENGTH=3,i.Binder={MEDIA_ELEMENT:".thread-media-element"},i.prototype.loadView=function(){var e=[];_.each(this.controller.model.get("posts"),function(t,n,i){e.push(t.data)}),e=_.filter(e,function(e){return e.id>0}),dust.render("thread_view_posts",{posts:e},function(e,t){this.$postContainer.html(t),_.each(this.controller.model.get("posts"),function(e,t,i){e.get("id")<0?n(e,"post","post/new",{is_permanent:!0}):n(e,"post","post/view",{})}),$(window).trigger("resize")}.bind(this))},i.prototype._createPlayer=function(){console.log("%s: %s",i.TAG,"_createPlayer"),this.player=new Player(this.$video,{areaSelectionEnabled:!1,updateTimeType:Player.DENSITY_BAR_UPDATE_TYPE_ABSOLUTE,audioBar:!1,overlayControls:!0,playHeadImage:this.options.player.playHeadImage,playHeadImageOnClick:function(){var e=this.player.getCurrentTime(),t=new KeyPoint(-1,e,e+i.DEFAULT_TEMPORAL_COMMENT_LENGTH,"",{drawOnTimeLine:!0});this._toggleTemporal(!1,t)}.bind(this)}),$(this.player).on(Player.EVENT_AREA_SELECTION_CHANGED,this.bind__onAreaSelectionChanged),$(this.player).on(Player.EVENT_KEYPOINT_MOUSE_OVER,this.bind__onMouseOverKeyPoint),$(this.player).on(Player.EVENT_KEYPOINT_MOUSE_OUT,this.bind__onMouseOutKeyPoint),$(this.player).on(Player.EVENT_KEYPOINT_RIGHT_CLICK,this.bind__onRightClickKeyPoint),$(this.player).on(Player.EVENT_KEYPOINT_END,this.bind__onEndKeyPoint),$(this.player).on(Player.EVENT_PLAYBACK_STARTED,this.bind__onPlaybackStarted),$(this.player).on(Player.EVENT_PLAYBACK_STOPPED,this.bind__onPlaybackStopped),$(this.player).on(Player.EVENT_SEEK,this.bind__onSeek),this.player.createControls()},i.prototype._onAreaSelectionChanged=function(e){console.log("%s: %s",i.TAG,Player.EVENT_AREA_SELECTION_CHANGED),this.controller.updateKeyPointSelectionTimes(this.player.getAreaSelectionTimes())},i.prototype._onMouseOverKeyPoint=function(e,t,n){console.log("%s: %s- keyPoint=%o, coords=%o",i.TAG,Player.EVENT_KEYPOINT_MOUSE_OVER,t,n),this.controller.hoverKeyPoint(t.id,{isMouseOver:!0}),this.$postContainer.is(":animated")||this.$postContainer.animate({scrollTop:$(".post-container[data-pid="+t.id+"]").position().top})},i.prototype._onMouseOutKeyPoint=function(e,t){console.log("%s: %s- keyPoint=%o",i.TAG,Player.EVENT_KEYPOINT_MOUSE_OUT,t),this.controller.hoverKeyPoint(t.id,{isMouseOver:!1})},i.prototype._onRightClickKeyPoint=function(e,t,n){console.log("%s: %s- keyPoint=%o, coords=%o",i.TAG,Player.EVENT_KEYPOINT_RIGHT_CLICK,t,n),this.controller.rightClickKeyPoint(t.id)},i.prototype._onEndKeyPoint=function(e,t){console.log("%s: %s- keyPoint=%o",i.TAG,Player.EVENT_KEYPOINT_END,t),this.playingKeyPoint&&this.playingKeyPoint.id==t.id&&this.player.pause()},i.prototype._onPlaybackStarted=function(e){console.log("%s: %s",i.TAG,Player.EVENT_PLAYBACK_STARTED),0!=this.$pipVideo.length&&this.$pipVideo[0].play()},i.prototype._onPlaybackStopped=function(e){console.log("%s: %s",i.TAG,Player.EVENT_PLAYBACK_STOPPED),0!=this.$pipVideo.length&&this.$pipVideo[0].pause()},i.prototype._onSeek=function(e,t){console.log("%s: %s- time=%s",i.TAG,Player.EVENT_SEEK,t),0!=this.$pipVideo.length&&(this.$pipVideo[0].currentTime=Math.min(this.player.getCurrentTime()+this.controller.model.get("ordered_media.0.source_start_time"),this.$pipVideo[0].duration))},i.prototype._toggleTemporal=function(e,t){this.player.pause(),this.playingKeyPoint=null,!e&&t?(this.player.setPlayHeadImage(""),this.player.seek(t.startTime),this.player.setAreaSelectionStartTime(t.startTime),this.player.setAreaSelectionEndTime(t.endTime),this.player.setAreaSelectionEnabled(!0)):(this.player.setPlayHeadImage(this.options.player.playHeadImage),this.player.setAreaSelectionEnabled(!1))},i.prototype._onModelChange=function(e){if(0==e.keyPath.indexOf("posts.")&&e.view){var i=e.model.get(e.keyPath);if("new"==e.view&&dust.render("post_new",i.data,function(e,r){var o=this.$container.find('.post-container[data-pid="'+i.get("id")+'"]');if(o.length>0)o.replaceWith(r),o=this.$container.find('.post-container[data-pid="'+i.get("id")+'"]');else{var o=this.$postContainer.find('.post-container[data-pid="'+i.get("parent_post_id")+'"]');o.after(r)}t.autoSize(),n(i,"post","post/new",{is_permanent:$.contains(this.$opContainer[0],o[0])}),$(window).trigger("resize")}.bind(this)),"edit"==e.view&&dust.render("post_edit",i.data,function(e,r){var o=this.$postContainer.find('.post-container[data-pid="'+i.get("id")+'"]');o.replaceWith(r),t.autoSize(),n(i,"post","post/edit",{}),$(window).trigger("resize")}.bind(this)),"view"==e.view){var r=this.$postContainer.find(".post-container[data-pid]"),o=0==r.length?"thread_view_posts":"post_view",s="thread_view_posts"==o?{posts:[i.data]}:i.data;dust.render(o,s,function(t,s){if("thread_view_posts"==o)this.$postContainer.html(s);else if(e.isNew)if(i.get("is_post_reply")){var a=i.get("parent_post_id");l=r.filter('[data-ppid="'+a+'"]'),0==l.length&&(l=r.filter('[data-pid="'+a+'"]')),l.last().after(s)}else r.last().after(s);else{var l=this.$postContainer.find('.post-container[data-pid="'+i.get("id")+'"]');l.replaceWith(s)}n(i,"post","post/view",{}),$(window).trigger("resize")}.bind(this))}}if("posts"==e.keyPath){var r=this.$postContainer.find(".post-container[data-pid]"),a=[],l=[];_.each(e.model.get("posts"),function(e,t,n){a.push(e.get("id"))}),l=_.filter(r,function(e){var t=parseInt($(e).data("pid"),10);return t>0&&!_.contains(a,t)}),_.each(l,function(e,t,n){var i=$(e);i.fadeOut("slow",function(e){i.remove(),r.length==l.length&&(t==r.length-1?dust.render("thread_view_posts",{},function(e,t){this.$postContainer.html(t),$(window).trigger("resize")}.bind(this)):$(window).trigger("resize"))}.bind(this))}.bind(this))}if(this.player&&(this.player.setKeyPoints(e.model.get("keyPoints",[])),this.controller.updateKeyPointDuration(this.$video[0].duration),0==e.keyPath.indexOf("keyPoints."))){var c=e.model.get(e.keyPath.substr(0,e.keyPath.lastIndexOf(".")));c instanceof KeyPoint&&(c.isEditing?this._toggleTemporal(!(c.startTime&&c.endTime),c):this._toggleTemporal(!0),c.isSeeking&&(c.paintHighlightedTimeout=!0,c.paintHighlighted=!0,this.player.seek(c.startTime),this.player.redrawKeyPoints=!0,setTimeout(function(){c.paintHighlightedTimeout=!1,c.paintHighlighted=!1,this.player.redrawKeyPoints=!0,this.player.repaint()}.bind(this),3e3)),c.isPlaying?(this.playingKeyPoint=c,this.player.seek(c.startTime),this.player.play()):c.isHovering?(c.paintHighlighted=!0,this.player.redrawKeyPoints=!0):c.paintHighlightedTimeout||(c.paintHighlighted=!1,this.player.redrawKeyPoints=!0),this.player.repaint())}},i.prototype._onClickVideoSpeed=function(e){e.preventDefault();var t=this.controller.adjustVideoSpeed();this.$video[0].playbackRate=t.value,0!=this.$pipVideo.length&&(this.$pipVideo[0].playbackRate=t.value),$(e.target).attr("src",t.image)},i.prototype._onClickClosedCaptions=function(e){e.preventDefault();var t=$("#closed-caption-button img").attr("src");t=t==this.options.player.captionImages.on?this.options.player.captionImages.off:this.options.player.captionImages.on,$("#closed-caption-button img").attr("src",t)},i}),define("main",["bootstrap","service","core/helper","core/subscriber","factory/contactFactory","factory/forumFactory","factory/groupFactory","factory/mediaFactory","factory/messageFactory","factory/myFilesFactory","factory/postFactory","factory/threadFactory","service/keyPointService","service/rabbitmqWebStompService","service/subscriberService","service/threadPostService","model/forumModel","model/groupModel","model/mediaModel","model/messageModel","model/myFilesModel","model/postModel","model/profileModel","model/threadModel","model/userModel","controller/contactController","controller/forumController","controller/groupController","controller/messageController","controller/myFilesController","controller/postController","controller/profileController","controller/threadController","component/accessTypeComponent","component/galleryComponent","component/mediaChooserComponent","component/myFilesSelectorComponent","component/recorderComponent","component/tableComponent","views/contact/listView","views/forum/newView","views/forum/editView","views/forum/viewView","views/group/newView","views/group/editView","views/group/viewView","views/group/manageView","views/message/newView","views/message/replyView","views/message/viewView","views/myFiles/listView","views/post/newView","views/post/editView","views/post/viewView","views/profile/editView","views/thread/newView","views/thread/editView","views/thread/viewView"],function(){var e={};e._services=[],e._instances=[],window.TerpTube=e,window.$tt=window.TerpTube;var t=require("core/helper");t.autoSize(),dust.helpers.generateUrl=function(e,n,i,r){return r&&r.hasOwnProperty("path")?e.write(t.generateUrl(r.path)):e},dust.helpers.generateRouteUrl=function(e,t,n,i){if(!i||!i.hasOwnProperty("name")||!i.hasOwnProperty("str_params"))return e;var r=i.str_params.split("|"),o={};return r.forEach(function(e,n,i){var r=e.split(":");o[r[0]]=t.get(r[1])}),e.write(Routing.generate(i.name,o,i.absolute))},dust.helpers.sizeOf=function(e,t,n,i){var r;return this.size({write:function(e){r=e}},t,n,i),n&&n.block?e.render(n.block,t.push({key:r})):e=e.write(r),e},dust.helpers.isLoggedInUser=function(e,t,n,i){if(!i||!i.hasOwnProperty("id")||!window.user)return e;var r=i.id==window.user.get("id");return i.inverse&&(r=!r),n?(r&&n.block&&e.render(n.block,t),!r&&n["else"]&&e.render(n["else"],t)):e=e.write(r?"Yes":"No"),e},dust.helpers.isNotLoggedInUser=function(e,t,n,i){return i.inverse=!0,this.isLoggedInUser(e,t,n,i)},dust.helpers.isInUserOnList=function(e,t,n,i){if(!(i&&i.hasOwnProperty("list")&&i.hasOwnProperty("username")&&window.user))return e;var r=window.user["isUserOn"+i.list+"List"](i.username);return n?(r&&n.block&&e.render(n.block,t),!r&&n["else"]&&e.render(n["else"],t)):e=e.write(r?"Yes":"No"),e},dust.filters.nl2br=function(e){return e.replace(/(?:\r\n|\r|\n)/g,"<br />")}}),require(["main"]);