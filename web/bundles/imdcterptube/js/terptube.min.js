!function(t,e){"function"==typeof define&&define.amd&&define.amd.dust===!0?define("dust.core",[],e):"object"==typeof exports?module.exports=e():t.dust=e()}(this,function(){function getTemplate(t,e){return t?"function"==typeof t&&t.template?t.template:dust.isTemplateFn(t)?t:e!==!1?dust.cache[t]:void 0:void 0}function load(t,e,i){if(!t)return e.setError(new Error("No template or template name provided to render"));var n=getTemplate(t,dust.config.cache);return n?n(e,Context.wrap(i,n.templateName)):dust.onLoad?e.map(function(e){function n(t,n){var r;if(t)return e.setError(t);if(r=getTemplate(n,!1)||getTemplate(o,dust.config.cache),!r){if(!dust.compile)return e.setError(new Error("Dust compiler not available"));r=dust.loadSource(dust.compile(n,o))}r(e,Context.wrap(i,r.templateName)).end()}var o=t;3===dust.onLoad.length?dust.onLoad(o,i.options,n):dust.onLoad(o,n)}):e.setError(new Error("Template Not Found: "+t))}function Context(t,e,i,n,o){void 0===t||t instanceof Stack||(t=new Stack(t)),this.stack=t,this.global=e,this.options=i,this.blocks=n,this.templateName=o}function getWithResolvedData(t,e,i){return function(n){return t.push(n)._get(e,i)}}function Stack(t,e,i,n){this.tail=e,this.isObject=t&&"object"==typeof t,this.head=t,this.index=i,this.of=n}function Stub(t){this.head=new Chunk(this),this.callback=t,this.out=""}function Stream(){this.head=new Chunk(this)}function Chunk(t,e,i){this.root=t,this.next=e,this.data=[],this.flushable=!1,this.taps=i}function Tap(t,e){this.head=t,this.tail=e}var dust={version:"2.7.2"},NONE="NONE",ERROR="ERROR",WARN="WARN",INFO="INFO",DEBUG="DEBUG",EMPTY_FUNC=function(){};dust.config={whitespace:!1,amd:!1,cjs:!1,cache:!0},dust._aliases={write:"w",end:"e",map:"m",render:"r",reference:"f",section:"s",exists:"x",notexists:"nx",block:"b",partial:"p",helper:"h"},function(){var t,e,i={DEBUG:0,INFO:1,WARN:2,ERROR:3,NONE:4};"undefined"!=typeof console&&console.log?(t=console.log,e="function"==typeof t?function(){t.apply(console,arguments)}:function(){t(Array.prototype.slice.apply(arguments).join(" "))}):e=EMPTY_FUNC,dust.log=function(t,n){n=n||INFO,i[n]>=i[dust.debugLevel]&&e("[DUST:"+n+"]",t)},dust.debugLevel=NONE,"undefined"!=typeof process&&process.env&&/\bdust\b/.test(process.env.DEBUG)&&(dust.debugLevel=DEBUG)}(),dust.helpers={},dust.cache={},dust.register=function(t,e){t&&(e.templateName=t,dust.config.cache!==!1&&(dust.cache[t]=e))},dust.render=function(t,e,i){var n=new Stub(i).head;try{load(t,n,e).end()}catch(o){n.setError(o)}},dust.stream=function(t,e){var i=new Stream,n=i.head;return dust.nextTick(function(){try{load(t,n,e).end()}catch(i){n.setError(i)}}),i},dust.loadSource=function(source){return eval(source)},dust.isArray=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},dust.nextTick=function(){return function(t){setTimeout(t,0)}}(),dust.isEmpty=function(t){return 0===t?!1:dust.isArray(t)&&!t.length?!0:!t},dust.isEmptyObject=function(t){var e;if(null===t)return!1;if(void 0===t)return!1;if(t.length>0)return!1;for(e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0},dust.isTemplateFn=function(t){return"function"==typeof t&&t.__dustBody},dust.isThenable=function(t){return t&&"object"==typeof t&&"function"==typeof t.then},dust.isStreamable=function(t){return t&&"function"==typeof t.on&&"function"==typeof t.pipe},dust.filter=function(t,e,i,n){var o,r,s,a;if(i)for(o=0,r=i.length;r>o;o++)s=i[o],s.length&&(a=dust.filters[s],"s"===s?e=null:"function"==typeof a?t=a(t,n):dust.log("Invalid filter `"+s+"`",WARN));return e&&(t=dust.filters[e](t,n)),t},dust.filters={h:function(t){return dust.escapeHtml(t)},j:function(t){return dust.escapeJs(t)},u:encodeURI,uc:encodeURIComponent,js:function(t){return dust.escapeJSON(t)},jp:function(t){return JSON?JSON.parse(t):(dust.log("JSON is undefined; could not parse `"+t+"`",WARN),t)}},dust.makeBase=dust.context=function(t,e){return new Context(void 0,t,e)},Context.wrap=function(t,e){return t instanceof Context?t:new Context(t,{},{},null,e)},Context.prototype.get=function(t,e){return"string"==typeof t&&("."===t[0]&&(e=!0,t=t.substr(1)),t=t.split(".")),this._get(e,t)},Context.prototype._get=function(t,e){var i,n,o,r,s,a=this.stack||{},l=1;if(n=e[0],o=e.length,t&&0===o)r=a,a=a.head;else{if(t)a&&(a=a.head?a.head[n]:void 0);else{for(;a&&(!a.isObject||(r=a.head,i=a.head[n],void 0===i));)a=a.tail;a=void 0!==i?i:this.global&&this.global[n]}for(;a&&o>l;){if(dust.isThenable(a))return a.then(getWithResolvedData(this,t,e.slice(l)));r=a,a=a[e[l]],l++}}return"function"==typeof a?(s=function(){try{return a.apply(r,arguments)}catch(t){throw dust.log(t,ERROR),t}},s.__dustBody=!!a.__dustBody,s):(void 0===a&&dust.log("Cannot find reference `{"+e.join(".")+"}` in template `"+this.getTemplateName()+"`",INFO),a)},Context.prototype.getPath=function(t,e){return this._get(t,e)},Context.prototype.push=function(t,e,i){return void 0===t?(dust.log("Not pushing an undefined variable onto the context",INFO),this):this.rebase(new Stack(t,this.stack,e,i))},Context.prototype.pop=function(){var t=this.current();return this.stack=this.stack&&this.stack.tail,t},Context.prototype.rebase=function(t){return new Context(t,this.global,this.options,this.blocks,this.getTemplateName())},Context.prototype.clone=function(){var t=this.rebase();return t.stack=this.stack,t},Context.prototype.current=function(){return this.stack&&this.stack.head},Context.prototype.getBlock=function(t){var e,i,n;if("function"==typeof t&&(t=t(new Chunk,this).data.join("")),e=this.blocks,!e)return dust.log("No blocks for context `"+t+"` in template `"+this.getTemplateName()+"`",DEBUG),!1;for(i=e.length;i--;)if(n=e[i][t])return n;return dust.log("Malformed template `"+this.getTemplateName()+"` was missing one or more blocks."),!1},Context.prototype.shiftBlocks=function(t){var e,i=this.blocks;return t?(e=i?i.concat([t]):[t],new Context(this.stack,this.global,this.options,e,this.getTemplateName())):this},Context.prototype.resolve=function(t){var e;return"function"!=typeof t?t:(e=(new Chunk).render(t,this),e instanceof Chunk?e.data.join(""):e)},Context.prototype.getTemplateName=function(){return this.templateName},Stub.prototype.flush=function(){for(var t=this.head;t;){if(!t.flushable)return t.error?(this.callback(t.error),dust.log("Rendering failed with error `"+t.error+"`",ERROR),void(this.flush=EMPTY_FUNC)):void 0;this.out+=t.data.join(""),t=t.next,this.head=t}this.callback(null,this.out)},Stream.prototype.flush=function(){for(var t=this.head;t;){if(!t.flushable)return t.error?(this.emit("error",t.error),this.emit("end"),dust.log("Streaming failed with error `"+t.error+"`",ERROR),void(this.flush=EMPTY_FUNC)):void 0;this.emit("data",t.data.join("")),t=t.next,this.head=t}this.emit("end")},Stream.prototype.emit=function(t,e){var i,n,o=this.events||{},r=o[t]||[];if(!r.length)return dust.log("Stream broadcasting, but no listeners for `"+t+"`",DEBUG),!1;for(r=r.slice(0),i=0,n=r.length;n>i;i++)r[i](e);return!0},Stream.prototype.on=function(t,e){var i=this.events=this.events||{},n=i[t]=i[t]||[];return"function"!=typeof e?dust.log("No callback function provided for `"+t+"` event listener",WARN):n.push(e),this},Stream.prototype.pipe=function(t){if("function"!=typeof t.write||"function"!=typeof t.end)return dust.log("Incompatible stream passed to `pipe`",WARN),this;var e=!1;return"function"==typeof t.emit&&t.emit("pipe",this),"function"==typeof t.on&&t.on("error",function(){e=!0}),this.on("data",function(i){if(!e)try{t.write(i,"utf8")}catch(n){dust.log(n,ERROR)}}).on("end",function(){if(!e)try{t.end(),e=!0}catch(i){dust.log(i,ERROR)}})},Chunk.prototype.write=function(t){var e=this.taps;return e&&(t=e.go(t)),this.data.push(t),this},Chunk.prototype.end=function(t){return t&&this.write(t),this.flushable=!0,this.root.flush(),this},Chunk.prototype.map=function(t){var e=new Chunk(this.root,this.next,this.taps),i=new Chunk(this.root,e,this.taps);this.next=i,this.flushable=!0;try{t(i)}catch(n){dust.log(n,ERROR),i.setError(n)}return e},Chunk.prototype.tap=function(t){var e=this.taps;return this.taps=e?e.push(t):new Tap(t),this},Chunk.prototype.untap=function(){return this.taps=this.taps.tail,this},Chunk.prototype.render=function(t,e){return t(this,e)},Chunk.prototype.reference=function(t,e,i,n){return"function"==typeof t?(t=t.apply(e.current(),[this,e,null,{auto:i,filters:n}]),t instanceof Chunk?t:this.reference(t,e,i,n)):dust.isThenable(t)?this.await(t,e,null,i,n):dust.isStreamable(t)?this.stream(t,e,null,i,n):dust.isEmpty(t)?this:this.write(dust.filter(t,i,n,e))},Chunk.prototype.section=function(t,e,i,n){var o,r,s,a=i.block,l=i["else"],d=this;if("function"==typeof t&&!dust.isTemplateFn(t)){try{t=t.apply(e.current(),[this,e,i,n])}catch(c){return dust.log(c,ERROR),this.setError(c)}if(t instanceof Chunk)return t}if(dust.isEmptyObject(i))return d;if(dust.isEmptyObject(n)||(e=e.push(n)),dust.isArray(t)){if(a){if(r=t.length,r>0){for(s=e.stack&&e.stack.head||{},s.$len=r,o=0;r>o;o++)s.$idx=o,d=a(d,e.push(t[o],o,r));return s.$idx=void 0,s.$len=void 0,d}if(l)return l(this,e)}}else{if(dust.isThenable(t))return this.await(t,e,i);if(dust.isStreamable(t))return this.stream(t,e,i);if(t===!0){if(a)return a(this,e)}else if(t||0===t){if(a)return a(this,e.push(t))}else if(l)return l(this,e)}return dust.log("Section without corresponding key in template `"+e.getTemplateName()+"`",DEBUG),this},Chunk.prototype.exists=function(t,e,i){var n=i.block,o=i["else"];if(dust.isEmpty(t)){if(o)return o(this,e)}else{if(n)return n(this,e);dust.log("No block for exists check in template `"+e.getTemplateName()+"`",DEBUG)}return this},Chunk.prototype.notexists=function(t,e,i){var n=i.block,o=i["else"];if(dust.isEmpty(t)){if(n)return n(this,e);dust.log("No block for not-exists check in template `"+e.getTemplateName()+"`",DEBUG)}else if(o)return o(this,e);return this},Chunk.prototype.block=function(t,e,i){var n=t||i.block;return n?n(this,e):this},Chunk.prototype.partial=function(t,e,i,n){var o;return void 0===n&&(n=i,i=e),dust.isEmptyObject(n)||(i=i.clone(),o=i.pop(),i=i.push(n).push(o)),dust.isTemplateFn(t)?this.capture(t,e,function(t,e){i.templateName=t,load(t,e,i).end()}):(i.templateName=t,load(t,this,i))},Chunk.prototype.helper=function(t,e,i,n,o){var r,s=this,a=n.filters;if(void 0===o&&(o="h"),!dust.helpers[t])return dust.log("Helper `"+t+"` does not exist",WARN),s;try{return r=dust.helpers[t](s,e,i,n),r instanceof Chunk?r:("string"==typeof a&&(a=a.split("|")),dust.isEmptyObject(i)?s.reference(r,e,o,a):s.section(r,e,i,n))}catch(l){return dust.log("Error in helper `"+t+"`: "+l.message,ERROR),s.setError(l)}},Chunk.prototype.await=function(t,e,i,n,o){return this.map(function(r){t.then(function(t){r=i?r.section(t,e,i):r.reference(t,e,n,o),r.end()},function(t){var n=i&&i.error;n?r.render(n,e.push(t)).end():(dust.log("Unhandled promise rejection in `"+e.getTemplateName()+"`",INFO),r.end())})})},Chunk.prototype.stream=function(t,e,i,n,o){var r=i&&i.block,s=i&&i.error;return this.map(function(a){var l=!1;t.on("data",function(t){l||(r?a=a.map(function(i){i.render(r,e.push(t)).end()}):i||(a=a.reference(t,e,n,o)))}).on("error",function(t){l||(s?a.render(s,e.push(t)):dust.log("Unhandled stream error in `"+e.getTemplateName()+"`",INFO),l||(l=!0,a.end()))}).on("end",function(){l||(l=!0,a.end())})})},Chunk.prototype.capture=function(t,e,i){return this.map(function(n){var o=new Stub(function(t,e){t?n.setError(t):i(e,n)});t(o.head,e).end()})},Chunk.prototype.setError=function(t){return this.error=t,this.root.flush(),this};for(var f in Chunk.prototype)dust._aliases[f]&&(Chunk.prototype[dust._aliases[f]]=Chunk.prototype[f]);Tap.prototype.push=function(t){return new Tap(t,this)},Tap.prototype.go=function(t){for(var e=this;e;)t=e.head(t),e=e.tail;return t};var HCHARS=/[&<>"']/,AMP=/&/g,LT=/</g,GT=/>/g,QUOT=/\"/g,SQUOT=/\'/g;dust.escapeHtml=function(t){return"string"==typeof t||t&&"function"==typeof t.toString?("string"!=typeof t&&(t=t.toString()),HCHARS.test(t)?t.replace(AMP,"&amp;").replace(LT,"&lt;").replace(GT,"&gt;").replace(QUOT,"&quot;").replace(SQUOT,"&#39;"):t):t};var BS=/\\/g,FS=/\//g,CR=/\r/g,LS=/\u2028/g,PS=/\u2029/g,NL=/\n/g,LF=/\f/g,SQ=/'/g,DQ=/"/g,TB=/\t/g;return dust.escapeJs=function(t){return"string"==typeof t?t.replace(BS,"\\\\").replace(FS,"\\/").replace(DQ,'\\"').replace(SQ,"\\'").replace(CR,"\\r").replace(LS,"\\u2028").replace(PS,"\\u2029").replace(NL,"\\n").replace(LF,"\\f").replace(TB,"\\t"):t},dust.escapeJSON=function(t){return JSON?JSON.stringify(t).replace(LS,"\\u2028").replace(PS,"\\u2029").replace(LT,"\\u003c"):(dust.log("JSON is undefined; could not escape `"+t+"`",WARN),t)},dust}),"function"==typeof define&&define.amd&&define.amd.dust===!0&&define("dust",["require","dust.core"],function(t,e){return e.onLoad=function(e,i){t([e],function(){i()})},e}),!function(t,e){"function"==typeof define&&define.amd&&define.amd.dust===!0?define("dust-helpers",["dust.core"],e):"object"==typeof exports?module.exports=e(require("dustjs-linkedin")):e(t.dust)}(this,function(t){function e(e,i,n){n=n||"INFO",e=e?"{@"+e+"}: ":"",t.log(e+i,n)}function i(t){u[t]||(e(t,"Deprecation warning: "+t+" is deprecated and will be removed in a future version of dustjs-helpers","WARN"),e(null,"For help and a deprecation timeline, see https://github.com/linkedin/dustjs-helpers/wiki/Deprecated-Features#"+t.replace(/\W+/g,""),"WARN"),u[t]=!0)}function n(t){return t.stack.tail&&t.stack.tail.head&&"undefined"!=typeof t.stack.tail.head.__select__}function o(t){return n(t)&&t.get("__select__")}function r(t,e){var i,n=t.stack.head,o=t.rebase();t.stack&&t.stack.tail&&(o.stack=t.stack.tail);var r={isPending:!1,isResolved:!1,isDeferredComplete:!1,deferreds:[]};for(i in e)r[i]=e[i];return o.push({__select__:r}).push(n,t.stack.index,t.stack.of)}function s(t){var e,i;if(t.deferreds.length)for(t.isDeferredComplete=!0,e=0,i=t.deferreds.length;i>e;e++)t.deferreds[e]()}function a(t,e){return"function"==typeof e?e.toString().replace(/(^\s+|\s+$)/gm,"").replace(/\n/gm,"").replace(/,\s*/gm,", ").replace(/\)\{/gm,") {"):e}function l(t,e){return function(i,n,o,r){return d(i,n,o,r,t,e)}}function d(t,i,n,r,s,a){var l,d,u,h,p=n.block,f=n["else"],m=o(i)||{};if(m.isResolved)return t;if(r.hasOwnProperty("key"))d=r.key;else{if(!m.hasOwnProperty("key"))return e(s,"No key specified","WARN"),t;d=m.key}return h=r.type||m.type,d=c(i.resolve(d),h),u=c(i.resolve(r.value),h),a(d,u)?(m.isPending||(l=!0,m.isPending=!0),p&&(t=t.render(p,i)),l&&(m.isResolved=!0)):f&&(t=t.render(f,i)),t}function c(t,e){switch(e&&(e=e.toLowerCase()),e){case"number":return+t;case"string":return String(t);case"boolean":return t="false"===t?!1:t,Boolean(t);case"date":return new Date(t)}return t}var u={},h={tap:function(t,e,n){return i("tap"),n.resolve(t)},sep:function(t,e,i){var n=i.block;return e.stack.index===e.stack.of-1?t:n?n(t,e):t},first:function(t,e,i){return 0===e.stack.index?i.block(t,e):t},last:function(t,e,i){return e.stack.index===e.stack.of-1?i.block(t,e):t},contextDump:function(t,i,n,o){var r,s,l=i.resolve(o.to),d=i.resolve(o.key);switch(d){case"full":r=i.stack;break;default:r=i.stack.head}switch(s=JSON.stringify(r,a,2),l){case"console":e("contextDump",s);break;default:s=s.replace(/</g,"\\u003c"),t=t.write(s)}return t},math:function(t,i,n,a){var l,d=a.key,c=a.method,u=a.operand,h=a.round;if(!a.hasOwnProperty("key")||!a.method)return e("math","`key` or `method` was not provided","ERROR"),t;switch(d=parseFloat(i.resolve(d)),u=parseFloat(i.resolve(u)),c){case"mod":0===u&&e("math","Division by 0","ERROR"),l=d%u;break;case"add":l=d+u;break;case"subtract":l=d-u;break;case"multiply":l=d*u;break;case"divide":0===u&&e("math","Division by 0","ERROR"),l=d/u;break;case"ceil":case"floor":case"round":case"abs":l=Math[c](d);break;case"toint":l=parseInt(d,10);break;default:e("math","Method `"+c+"` is not supported","ERROR")}return"undefined"!=typeof l&&(h&&(l=Math.round(l)),n&&n.block?(i=r(i,{key:l}),t=t.render(n.block,i),s(o(i))):t=t.write(l)),t},select:function(t,i,n,a){var l=n.block,d={};return a.hasOwnProperty("key")&&(d.key=i.resolve(a.key)),a.hasOwnProperty("type")&&(d.type=a.type),l?(i=r(i,d),t=t.render(l,i),s(o(i))):e("select","Missing body block","WARN"),t},eq:l("eq",function(t,e){return t===e}),ne:l("ne",function(t,e){return t!==e}),lt:l("lt",function(t,e){return e>t}),lte:l("lte",function(t,e){return e>=t}),gt:l("gt",function(t,e){return t>e}),gte:l("gte",function(t,e){return t>=e}),any:function(t,i,n,r){var s=o(i);return s?s.isDeferredComplete?e("any","Must not be nested inside {@any} or {@none} block","ERROR"):t=t.map(function(t){s.deferreds.push(function(){s.isResolved&&(t=t.render(n.block,i)),t.end()})}):e("any","Must be used inside a {@select} block","ERROR"),t},none:function(t,i,n,r){var s=o(i);return s?s.isDeferredComplete?e("none","Must not be nested inside {@any} or {@none} block","ERROR"):t=t.map(function(t){s.deferreds.push(function(){s.isResolved||(t=t.render(n.block,i)),t.end()})}):e("none","Must be used inside a {@select} block","ERROR"),t},size:function(e,i,n,o){var r,s,a=o.key;if(a=i.resolve(o.key),a&&a!==!0)if(t.isArray(a))r=a.length;else if(!isNaN(parseFloat(a))&&isFinite(a))r=a;else if("object"==typeof a){r=0;for(s in a)a.hasOwnProperty(s)&&r++}else r=(a+"").length;else r=0;return e.write(r)}};for(var p in h)t.helpers[p]=h[p];return t}),!function(t){function e(t,e){return t.w('<div class="modal fade my-files-selector-modal"><div class="modal-dialog" style="width: 80%;"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button><h4 class="modal-title">Select from My Files</h4></div><div class="modal-body"><div class="text-center"><i class="fa fa-spinner fa-4x fa-spin"></i></div></div><div class="modal-footer"><a class="btn btn-default" data-dismiss="modal"><i class="fa fa-times"></i> Cancel</a><a class="btn btn-primary my-files-selector-select-selected" disabled="disabled" data-loading-text="<i class=&quot;fa fa-spinner fa-spin&quot;></i> Downloading data..."><i class="fa fa-check"></i> Select</a></div></div></div></div>')}return t.register("myFilesSelector",e),e.__dustBody=!0,e}(dust),function(t){function e(t,e){return t.w('<div class="modal fade recorder-modal"><div class="modal-dialog modal-lg"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button><h4 class="modal-title">Recorder</h4></div><div class="modal-body"><ul class="nav nav-tabs" role="tablist"><li class="active"><a href=".recorder-normal" role="tab" data-toggle="tab">Normal</a></li><li><a href=".recorder-interp" role="tab" data-toggle="tab">Interpretation</a></li></ul><div class="tab-content" style="padding-top: 15px;"><div class="tab-pane active recorder-normal recorder-container-record"><div class="tt-media-preview-title"><input class="recorder-normal-title" type="text" value="My Recording"/></div><video class="recorder-normal-video" width="100%" preload="auto" muted="muted"></video></div><div class="tab-pane recorder-interp recorder-container-record"><div style="border: 2px dashed #ccc; line-height: 200px; height: 200px; text-align: center; display: none;"><button class="btn btn-primary btn-lg recorder-interp-select">Select a video to interpret</button></div><div class="row recorder-interp-main" style="display: none;"><div class="col-md-offset-6 col-md-6"><div class="tt-media-preview-title"><input class="recorder-interp-title" type="text" value="My Recording"/></div></div><div class="col-md-6"><video class="recorder-interp-video-p" width="100%" preload="auto"muted="muted"></video></div><div class="col-md-6"><video class="recorder-interp-video-r" width="100%" preload="auto"muted="muted"></video></div></div></div><div class="recorder-controls recorder-container-record"></div><div class="recorder-container-upload" style="display: none;"><label>Uploading...</label><div class="progress"><div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0"aria-valuemax="100" style="width: 0%;">0%</div></div></div></div></div></div></div></div>')}return t.register("recorder",e),e.__dustBody=!0,e}(dust),function(t){function e(t,e){return t.s(e.get(["resources"],!1),e,{block:i},{})}function i(t,e){return t.w('<source src="').h("generateUrl",e,{},{path:e.get(["web_path"],!1)},"h").w('" />')}return t.register("recorder_source",e),e.__dustBody=!0,i.__dustBody=!0,e}(dust),function(t){function e(t,e){return t.w('<div class="tt-gallery-prev disabled gallery-prev"><i class="fa fa-chevron-left fa-3x"></i></div><div class="tt-gallery-item gallery-item"></div><div class="tt-gallery-next disabled gallery-next"><i class="fa fa-chevron-right fa-3x next"></i></div><div class="tt-gallery-carousel gallery-carousel"><div class="tt-gallery-left gallery-left"><i class="fa fa-chevron-left fa-2x"></i></div><div class="tt-gallery-thumbs gallery-thumbs"><div><ul></ul></div> </div><div class="tt-gallery-right gallery-right"><i class="fa fa-chevron-right fa-2x right"></i></div><div class="clear"></div></div><div class="tt-gallery-action gallery-action"><a title="Cut" data-action="4"><i class="fa fa-scissors fa-2x"></i></a><a title="Interpret" data-action="3"><i class="fa fa-video-camera fa-2x"></i></a><a data-action="2"><i class="fa fa-expand fa-2x"></i></a><a data-action="1"><i class="fa fa-times fa-2x"></i></a></div>')}return t.register("gallery_common",e),e.__dustBody=!0,e}(dust),function(t){function e(t,e){return t.w('<div id="').f(e.get(["identifier"],!1),e,"h").w('" class="tt-gallery-inline gallery-inner">').p("gallery_common",e,e,{}).w("</div>")}return t.register("gallery_inline",e),e.__dustBody=!0,e}(dust),function(t){function e(t,e){return t.w('<div id="').f(e.get(["identifier"],!1),e,"h").w('" class="tt-gallery-background gallery-inner"></div><div id="').f(e.get(["identifier"],!1),e,"h").w('" class="tt-gallery-preview gallery-inner">').p("gallery_common",e,e,{}).w("</div>")}return t.register("gallery_preview",e),e.__dustBody=!0,e}(dust),function(t){function e(t,e){return t.s(e.get(["media"],!1),e,{block:i},{})}function i(t,e){return t.w('<li data-mid="').f(e.getPath(!1,["data","id"]),e,"h").w('">').x(e.get(["can_edit"],!1),e,{block:n},{}).w("<div>").x(e.getPath(!1,["data","thumbnail_path"]),e,{block:o},{}).w("</div> </li>")}function n(t,e){return t.w('<span class="gallery-thumb-remove" title="Remove" data-mid="').f(e.getPath(!1,["data","id"]),e,"h").w('"><i class="fa fa-times-circle"></i></span>')}function o(t,e){return t.w('<img src="').h("generateUrl",e,{},{path:e.getPath(!1,["data","thumbnail_path"])},"h").w('" />')}return t.register("gallery_thumbnail",e),e.__dustBody=!0,i.__dustBody=!0,n.__dustBody=!0,o.__dustBody=!0,e}(dust),function(t){function e(t,e){return t.h("select",e,{block:i},{key:e.getPath(!1,["media","type"])},"h")}function i(t,e){return t.h("eq",e,{block:n},{value:1},"h").h("eq",e,{block:u},{value:2},"h").h("eq",e,{block:f},{value:0},"h").h("eq",e,{block:m},{value:9},"h")}function n(t,e){return t.x(e.getPath(!1,["media","is_interpretation"]),e,{block:o},{}).w('<video class="tt-media-video"').x(e.get(["enable_controls"],!1),e,{block:l},{}).x(e.getPath(!1,["media","thumbnail_path"]),e,{block:d},{}).w('preload="none">').s(e.getPath(!1,["media","resources"]),e,{block:c},{}).w("</video>")}function o(t,e){return t.w('<video class="tt-media-pip-video"').x(e.get(["enable_controls"],!1),e,{block:r},{}).x(e.getPath(!1,["media","source","thumbnail_path"]),e,{block:s},{}).w('preload="none">').s(e.getPath(!1,["media","source","resources"]),e,{block:a},{}).w("</video>")}function r(t,e){return t.w(" controls ")}function s(t,e){return t.w(' poster="').h("generateUrl",e,{},{path:e.getPath(!1,["media","source","thumbnail_path"])},"h").w('" ')}function a(t,e){return t.w('<source src="').h("generateUrl",e,{},{path:e.get(["web_path"],!1)},"h").w('" />')}function l(t,e){return t.w(" controls ")}function d(t,e){return t.w(' poster="').h("generateUrl",e,{},{path:e.getPath(!1,["media","thumbnail_path"])},"h").w('" ')}function c(t,e){return t.w('<source src="').h("generateUrl",e,{},{path:e.get(["web_path"],!1)},"h").w('" />')}function u(t,e){return t.w('<audio class="tt-media-audio"').x(e.get(["enable_controls"],!1),e,{block:h},{}).w(">").s(e.getPath(!1,["media","resources"]),e,{block:p},{}).w("</audio>")}function h(t,e){return t.w(" controls")}function p(t,e){return t.w('<source src="').h("generateUrl",e,{},{path:e.get(["web_path"],!1)},"h").w('" />')}function f(t,e){return t.w('<img class="img-responsive center-block tt-media-img" src="').h("generateUrl",e,{},{path:e.getPath(!1,["media","source_resource","web_path"])},"h").w('" title="').f(e.get(["title"],!1),e,"h").w('" alt="').f(e.get(["title"],!1),e,"h").w('" />')}function m(t,e){return t.w('<div class="row"><div class="col-md-3 thumbnail text-center"><a href="').h("generateUrl",e,{},{path:e.getPath(!1,["media","source_resource","web_path"])},"h").w('"><p><i class="fa fa-file fa-5x"></i></p><div>').f(e.get(["title"],!1),e,"h").w("</div></a></div></div>")}return t.register("media_element",e),e.__dustBody=!0,i.__dustBody=!0,n.__dustBody=!0,o.__dustBody=!0,r.__dustBody=!0,s.__dustBody=!0,a.__dustBody=!0,l.__dustBody=!0,d.__dustBody=!0,c.__dustBody=!0,u.__dustBody=!0,h.__dustBody=!0,p.__dustBody=!0,f.__dustBody=!0,m.__dustBody=!0,e}(dust),function(t){function e(t,e){return t.w('<div class="col-md-3"><div class="thumbnail tt-grid-div-body"><div class="tt-grid-div-item"><input type="checkbox" class="table-component-item" data-mid="').f(e.getPath(!1,["media","id"]),e,"h").w('" /></div><div class="tt-grid-div-thumbnail my-files-selector-file" data-mid="').f(e.getPath(!1,["media","id"]),e,"h").w('" disabled><div><span class="fa-stack fa-lg"><i class="fa fa-file-o fa-stack-2x"></i><i class="fa fa-play-circle fa-stack-1x"></i></span></div></div><div class="tt-grid-div-primary"><span class="edit-title my-files-selector-file" title="').f(e.get(["previewTitle"],!1),e,"h").w('" data-mid="').f(e.getPath(!1,["media","id"]),e,"h").w('" data-type="text" data-title="').f(e.get(["editTitle"],!1),e,"h").w('" disabled><i class="fa ').f(e.getPath(!1,["mediaIcon","icon"]),e,"h").w(' fa-2x" title="').f(e.getPath(!1,["mediaIcon","text"]),e,"h").w('"></i>').f(e.getPath(!1,["media","title"]),e,"h").w('</span><span><button class="btn btn-default edit-title"><i class="fa fa-pencil"></i></button><div class="btn-group"><button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false"><i class="fa fa-download"></i> <span class="caret"></span></button><ul class="dropdown-menu" role="menu">').s(e.getPath(!1,["media","resources"]),e,{block:i},{}).h("if",e,{block:n},{cond:o},"h").x(e.getPath(!1,["media","source_resource"]),e,{block:r},{}).w('</ul></div><a class="btn btn-default" target="_blank" href="').f(e.get(["shareUrl"],!1),e,"h").w('" title="').f(e.get(["shareTitle"],!1),e,"h").w('"><i class="fa fa-share-square-o"></i></a></span></div></div></div>')}function i(t,e){return t.w('<li><a href="').h("generateUrl",e,{},{path:e.get(["web_path"],!1)},"h").w(' download="').f(e.getPath(!1,["media","title"]),e,"h").w(".").f(e.get(["path"],!1),e,"h").w('">').f(e.get(["path"],!1),e,"h").w("</a></li>\n")}function n(t,e){return t.w('<li class="divider"></li>')}function o(t,e){return t.w("'").f(e.getPath(!1,["media","resources"]),e,"h").w("'.length > 0 && '").f(e.getPath(!1,["media","source_resource"]),e,"h").w("'.length")}function r(t,e){return t.w('<li><a href="').h("generateUrl",e,{},{path:e.getPath(!1,["media","source_resource","web_path"])},"h").w('" download="').f(e.getPath(!1,["media","title"]),e,"h").w(".").f(e.getPath(!1,["media","source_resource","path"]),e,"h").w('">Original</a></li>')}return t.register("myFilesGridElement",e),e.__dustBody=!0,i.__dustBody=!0,n.__dustBody=!0,o.__dustBody=!0,r.__dustBody=!0,e}(dust),function(t){function e(t,e){return t.w('<tr><td class="tt-list-table-col-item"><input type="checkbox" class="table-component-item" data-mid="').f(e.getPath(!1,["media","id"]),e,"h").w('" /></td><td class="tt-list-table-col-thumbnail my-files-selector-file" data-mid="').f(e.getPath(!1,["media","id"]),e,"h").w('" disabled ><div><span class="fa-stack fa-lg"><i class="fa fa-file-o fa-stack-2x"></i><i class="fa fa-play-circle fa-stack-1x"></i></span></div></td><td class="tt-list-table-col-primary tt-myFiles-nameColumn"><span class="edit-title my-files-selector-file" title="').f(e.get(["previewTitle"],!1),e,"h").w('" data-mid="').f(e.getPath(!1,["media","id"]),e,"h").w('" data-type="text" data-title="').f(e.get(["editTitle"],!1),e,"h").w('" disabled >').f(e.getPath(!1,["media","title"]),e,"h").w('</span><span><button class="btn btn-default edit-title"><i class="fa fa-pencil"></i></button><div class="btn-group"><button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false"><i class="fa fa-download"></i> <span class="caret"></span></button><ul class="dropdown-menu" role="menu">').s(e.getPath(!1,["media","resources"]),e,{block:i},{}).h("if",e,{block:n},{cond:o},"h").x(e.getPath(!1,["media","source_resource"]),e,{block:r},{}).w('</ul></div><a class="btn btn-default" target="_blank" href="').f(e.get(["shareUrl"],!1),e,"h").w('" title="').f(e.get(["shareTitle"],!1),e,"h").w('"><i class="fa fa-share-square-o"></i></a></span></td><td>').f(e.get(["timeUploaded"],!1),e,"h").w('</td><td><i class="fa ').f(e.getPath(!1,["mediaIcon","icon"]),e,"h").w(' fa-2x" title="').f(e.getPath(!1,["mediaIcon","text"]),e,"h").w('"></i></td><td>').x(e.get(["spinner"],!1),e,{"else":s,block:a},{}).w("</td></tr>")}function i(t,e){return t.w('<li><a href="').h("generateUrl",e,{},{path:e.get(["web_path"],!1)},"h").w(' download="').f(e.getPath(!1,["media","title"]),e,"h").w(".").f(e.get(["path"],!1),e,"h").w('">').f(e.get(["path"],!1),e,"h").w("</a></li>\n")}function n(t,e){return t.w('<li class="divider"></li>')}function o(t,e){return t.w("'").f(e.getPath(!1,["media","resources"]),e,"h").w("'.length > 0 && '").f(e.getPath(!1,["media","source_resource"]),e,"h").w("'.length")}function r(t,e){return t.w('<li><a href="').h("generateUrl",e,{},{path:e.getPath(!1,["media","source_resource","web_path"])},"h").w('" download="').f(e.getPath(!1,["media","title"]),e,"h").w(".").f(e.getPath(!1,["media","source_resource","path"]),e,"h").w('">Original</a></li>')}function s(t,e){return t.f(e.get(["formattedSize"],!1),e,"h")}function a(t,e){return t.w('<i class="fa fa-spinner fa-spin fa-large"> </i>')}return t.register("myFilesListElement",e),e.__dustBody=!0,i.__dustBody=!0,n.__dustBody=!0,o.__dustBody=!0,r.__dustBody=!0,s.__dustBody=!0,a.__dustBody=!0,e}(dust),function(t){function e(t,e){return t.w('<div class="row"><div class="col-md-12">').s(e.get(["posts"],!1),e,{"else":i,block:n},{}).w('<div class="thread-reply-spacer"></div></div></div>')}function i(t,e){return t.w('<div class="lead text-center" style="padding-top: 30px;">No replies yet!</div>')}function n(t,e){return t.nx(e.get(["is_post_reply"],!1),e,{block:o},{})}function o(t,e){return t.p("post_view",e,e,{post:e.getPath(!0,[])}).s(e.get(["replies"],!1),e,{block:r},{})}function r(t,e){return t.p("post_view",e,e,{post:e.getPath(!0,[])})}return t.register("thread_view_posts",e),e.__dustBody=!0,i.__dustBody=!0,n.__dustBody=!0,o.__dustBody=!0,r.__dustBody=!0,e}(dust),function(t){function e(t,e){return e=e.shiftBlocks(r),t.p("post_view",e,e,{})}function i(t,e){return e=e.shiftBlocks(r),t.w('<div class="row"><div class="col-md-12">').f(e.get(["form"],!1),e,"h",["s"]).w("</div></div>")}function n(t,e){return e=e.shiftBlocks(r),t}function o(t,e){return e=e.shiftBlocks(r),t}t.register("post_edit",e);var r={post_content:i,post_tools:n,post_reply:o};return e.__dustBody=!0,i.__dustBody=!0,n.__dustBody=!0,o.__dustBody=!0,e}(dust),function(t){function e(t,e){return t.w('<div class="row post-container').x(e.get(["is_post_reply"],!1),e,{block:i
},{}).w('" data-pid="').f(e.get(["id"],!1),e,"h").w('"><div class="').x(e.get(["is_post_reply"],!1),e,{"else":n,block:o},{}).w('">').x(e.get(["is_post_reply"],!1),e,{block:r},{}).f(e.get(["form"],!1),e,"h",["s"]).x(e.get(["is_post_reply"],!1),e,{block:s},{}).w("</div></div>")}function i(t,e){return t.w(' tt-post-container tt-post-reply-container" style="margin-bottom: 15px;')}function n(t,e){return t.w("col-md-12")}function o(t,e){return t.w("col-md-offset-1 col-md-11")}function r(t,e){return t.w('<div class="row tt-post-container-inner tt-post-reply-container-inner"><div class="col-md-12">')}function s(t,e){return t.w("</div></div>")}return t.register("post_new",e),e.__dustBody=!0,i.__dustBody=!0,n.__dustBody=!0,o.__dustBody=!0,r.__dustBody=!0,s.__dustBody=!0,e}(dust),function(t){function e(t,e){return t.w('<div class="row post-container tt-post-container').x(e.get(["is_post_reply"],!1),e,{block:i},{}).w('" style="margin-bottom: 15px;" data-pid="').f(e.get(["id"],!1),e,"h").w('"').x(e.get(["is_post_reply"],!1),e,{block:n},{}).w('><div class="').x(e.get(["is_post_reply"],!1),e,{"else":o,block:r},{}).w('"><div class="row tt-post-container-inner').x(e.get(["is_post_reply"],!1),e,{block:s},{}).w('"><div class="col-md-2 text-center"><div class="row"><div class="col-md-12">').p("user_avatar",e,e,{user:e.get(["author"],!1)}).p("user_username",e,e,{user:e.get(["author"],!1)}).w('</div></div><div class="row"><div class="col-md-12">').p("user_connect_tools",e,e,{user:e.get(["author"],!1)}).w('</div></div></div><div class="col-md-9 tt-post-content-container">').b(e.getBlock("post_content"),e,{block:a},{}).w('</div><div class="col-md-1 pull-right">').b(e.getBlock("post_tools"),e,{block:u},{}).w("</div></div>").nx(e.get(["is_post_reply"],!1),e,{block:f},{}).w("</div></div>")}function i(t,e){return t.w(" tt-post-reply-container")}function n(t,e){return t.w(' data-ppid="').f(e.get(["parent_post_id"],!1),e,"h").w('"')}function o(t,e){return t.w("col-md-12")}function r(t,e){return t.w("col-md-offset-1 col-md-11")}function s(t,e){return t.w(" tt-post-reply-container-inner")}function a(t,e){return t.w('<div class="row"><div class="col-md-12"><div class="text-right tt-date">').f(e.get(["created"],!1),e,"h",["date"]).w("&nbsp;").x(e.get(["edited_by"],!1),e,{block:l},{}).w('</div></div><div class="col-md-12">').x(e.get(["is_temporal"],!1),e,{block:d},{}).h("gt",e,{block:c},{key:e.getPath(!1,["ordered_media","length"]),value:0},"h").w("<div><p>").f(e.get(["content"],!1),e,"h",["nl2br","s"]).w("</p></div></div></div>")}function l(t,e){return t.w("(edited ").f(e.get(["edited_at"],!1),e,"h",["date"]).w(" by ").f(e.getPath(!1,["edited_by","username"]),e,"h").w(")")}function d(t,e){return t.w('<div class="tt-post-timeline-container"><div class="tt-post-timeline"><div class="tt-post-timeline-keypoint post-timeline-keypoint"></div></div></div>')}function c(t,e){return t.w('<div class="row"><div class="col-md-12"><div class="post-gallery" style="margin-bottom: 10px; height: 400px; width: 100%;"></div></div></div>')}function u(t,e){return t.w('<ul class="list-unstyled">').x(e.get(["is_temporal"],!1),e,{block:h},{}).h("isCurrentUser",e,{block:p},{id:e.getPath(!1,["author","id"])},"h").w('</ul><div class="modal fade post-delete-modal" data-pid="').f(e.get(["id"],!1),e,"h").w('"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button><h4 class="modal-title">Delete this post</h4></div><div class="modal-body text-center"><p>This post will be permanently deleted.<br />This action cannot be undone.<br />Are you sure?</p></div><div class="modal-footer"><a class="btn btn-default" data-dismiss="modal"><i class="fa fa-times"></i> Cancel</a><a class="btn btn-danger post-delete" data-loading-text="<i class=&quot;fa fa-spinner fa-spin&quot;></i> Deleting..."><i class="fa fa-trash-o"></i> Delete</a></div></div></div></div>')}function h(t,e){return t.w('<li><a class="post-timeline-keypoint" href="#" title="Jump to selected timeline region"><i class="fa fa-clock-o"></i></a></li>')}function p(t,e){return t.w('<li><a class="post-edit" href="#" title="Edit this post"><i class="fa fa-pencil"></i></a></li><li><a href="#" title="Delete this post" data-toggle="modal" data-target=".post-delete-modal[data-pid=').f(e.get(["id"],!1),e,"h").w(']"><i class="fa fa-trash-o"></i></a></li>')}function f(t,e){return t.b(e.getBlock("post_reply"),e,{block:m},{})}function m(t,e){return t.w('<div class="row"><div class="col-md-1 col-md-offset-11"><p><a class="post-new" href="#" title="Reply to this post"><i class="fa fa-reply fa-rotate-180 fa-lg"></i></a></p></div></div>')}return t.register("post_view",e),e.__dustBody=!0,i.__dustBody=!0,n.__dustBody=!0,o.__dustBody=!0,r.__dustBody=!0,s.__dustBody=!0,a.__dustBody=!0,l.__dustBody=!0,d.__dustBody=!0,c.__dustBody=!0,u.__dustBody=!0,h.__dustBody=!0,p.__dustBody=!0,f.__dustBody=!0,m.__dustBody=!0,e}(dust),function(t){function e(t,e){return t.s(e.get(["user"],!1),e,{block:i},{})}function i(t,e){return t.w('<a href="').h("generateRouteUrl",e,{},{name:"imdc_profile_user",str_params:"userName:username"},"h").w('"><img class="img-responsive center-block tt-avatar" src="').x(e.getPath(!1,["profile","avatar"]),e,{"else":n,block:o},{}).w('" /></a>')}function n(t,e){return t.h("generateUrl",e,{},{path:"bundles/imdcterptube/img/no_avatar.jpg"},"h")}function o(t,e){return t.h("generateUrl",e,{},{path:e.getPath(!1,["profile","avatar","source_resource","web_path"])},"h")}return t.register("user_avatar",e),e.__dustBody=!0,i.__dustBody=!0,n.__dustBody=!0,o.__dustBody=!0,e}(dust),function(t){function e(t,e){return t.s(e.get(["user"],!1),e,{block:i},{})}function i(t,e){return t.w('<ul class="list-unstyled list-inline"><li>').h("isLoggedInUser",e,{"else":n,block:o},{id:e.get(["id"],!1)},"h").w("</li>&nbsp; <!-- match spaces that are still present between tags when rendering from twig --><li>").h("isLoggedInUser",e,{"else":r,block:l},{id:e.get(["id"],!1)},"h").w("</li>").h("isNotLoggedInUser",e,{block:d},{id:e.get(["id"],!1)},"h").w("</ul>")}function n(t,e){return t.w('<a href="').h("generateRouteUrl",e,{},{name:"imdc_message_new",str_params:"userid:username"},"h").w('" title="Send a message to ').f(e.get(["username"],!1),e,"h").w('"><i class="fa fa-envelope-o"></i></a>')}function o(t,e){return t.w('<i class="fa fa-envelope-o" style="color: lightgray;"></i>')}function r(t,e){return t.h("isUserOnList",e,{"else":s,block:a},{list:"Friends",username:e.get(["username"],!1)},"h")}function s(t,e){return t.w('<a href="').h("generateRouteUrl",e,{},{name:"imdc_member_friend_add",str_params:"userid:id"},"h").w('" title="Click to add ').f(e.get(["username"],!1),e,"h").w(' to your friends list"><i class="fa fa-plus"></i></a>')}function a(t,e){return t.w('<a href="').h("generateRouteUrl",e,{},{name:"imdc_member_friend_remove",str_params:"userid:id"},"h").w('" title="Remove ').f(e.get(["username"],!1),e,"h").w(' from your friends list"><i class="fa fa-minus"></i></a>')}function l(t,e){return t.w('<i class="fa fa-user" style="color: lightgray;" title="This is you"></i>')}function d(t,e){return t.w("&nbsp;<li>").h("isUserOnList",e,{"else":c,block:p},{list:"Mentor",username:e.get(["username"],!1)},"h").w("</li>&nbsp;<li>").h("isUserOnList",e,{"else":f,block:_},{list:"Mentee",username:e.get(["username"],!1)},"h").w("</li>")}function c(t,e){return t.h("isUserOnList",e,{"else":u,block:h},{list:"InvitedMentor",username:e.get(["username"],!1)},"h")}function u(t,e){return t.w('<a href="').h("generateRouteUrl",e,{},{name:"imdc_invitation_mentor",str_params:"id:id"},"h").w('" title="Invite user to be your mentor"><i class="fa fa-inbox"></i></a>')}function h(t,e){return t.w('<i class="fa fa-inbox" title="Invitation for mentorship already sent"></i>')}function p(t,e){return t.w('<i class="fa fa-star" title="This user is your mentor"></i>')}function f(t,e){return t.h("isUserOnList",e,{"else":m,block:b},{list:"InvitedMentee",username:e.get(["username"],!1)},"h")}function m(t,e){return t.w('<a href="').h("generateRouteUrl",e,{},{name:"imdc_invitation_mentee",str_params:"id:id"},"h").w('" title="Invite user to be your mentee"><i class="fa fa-star-o"></i></a>')}function b(t,e){return t.w('<i class="fa fa-star-o" title="Invitation for menteeship already sent"></i>')}function _(t,e){return t.w('<i class="fa fa-star" title="This user is your mentee"></i>')}return t.register("user_connect_tools",e),e.__dustBody=!0,i.__dustBody=!0,n.__dustBody=!0,o.__dustBody=!0,r.__dustBody=!0,s.__dustBody=!0,a.__dustBody=!0,l.__dustBody=!0,d.__dustBody=!0,c.__dustBody=!0,u.__dustBody=!0,h.__dustBody=!0,p.__dustBody=!0,f.__dustBody=!0,m.__dustBody=!0,b.__dustBody=!0,_.__dustBody=!0,e}(dust),function(t){function e(t,e){return t.s(e.get(["user"],!1),e,{block:i},{})}function i(t,e){return t.w('<a href="').h("generateRouteUrl",e,{},{name:"imdc_profile_user",str_params:"userName:username"},"h").w('" title="').f(e.get(["username"],!1),e,"h").w('"><span class="tt-username">').f(e.get(["username"],!1),e,"h").w("</span></a>")}return t.register("user_username",e),e.__dustBody=!0,i.__dustBody=!0,e}(dust),define("templates",["dust-helpers"],function(){}),Function.prototype.extend=function(){return function(t){var e=this;Object.keys(t).forEach(function(i){var n=t[i];_.isObject(n)?e[i]=_.clone(n):e[i]=n}),this.prototype=Object.create(t.prototype),this.prototype.constructor=this}}(),define("extra",function(){}),function(){function t(t){function e(e,i,n,o,r,s){for(;r>=0&&s>r;r+=t){var a=o?o[r]:r;n=i(n,e[a],a,e)}return n}return function(i,n,o,r){n=v(n,r,4);var s=!S(i)&&g.keys(i),a=(s||i).length,l=t>0?0:a-1;return arguments.length<3&&(o=i[s?s[l]:l],l+=t),e(i,n,o,s,l,a)}}function e(t){return function(e,i,n){i=y(i,n);for(var o=k(e),r=t>0?0:o-1;r>=0&&o>r;r+=t)if(i(e[r],r,e))return r;return-1}}function i(t,e,i){return function(n,o,r){var s=0,a=k(n);if("number"==typeof r)t>0?s=r>=0?r:Math.max(r+a,s):a=r>=0?Math.min(r+1,a):r+a+1;else if(i&&r&&a)return r=i(n,o),n[r]===o?r:-1;if(o!==o)return r=e(c.call(n,s,a),g.isNaN),r>=0?r+s:-1;for(r=t>0?s:a-1;r>=0&&a>r;r+=t)if(n[r]===o)return r;return-1}}function n(t,e){var i=A.length,n=t.constructor,o=g.isFunction(n)&&n.prototype||a,r="constructor";for(g.has(t,r)&&!g.contains(e,r)&&e.push(r);i--;)r=A[i],r in t&&t[r]!==o[r]&&!g.contains(e,r)&&e.push(r)}var o=this,r=o._,s=Array.prototype,a=Object.prototype,l=Function.prototype,d=s.push,c=s.slice,u=a.toString,h=a.hasOwnProperty,p=Array.isArray,f=Object.keys,m=l.bind,b=Object.create,_=function(){},g=function(t){return t instanceof g?t:this instanceof g?void(this._wrapped=t):new g(t)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=g),exports._=g):o._=g,g.VERSION="1.8.3";var v=function(t,e,i){if(void 0===e)return t;switch(null==i?3:i){case 1:return function(i){return t.call(e,i)};case 2:return function(i,n){return t.call(e,i,n)};case 3:return function(i,n,o){return t.call(e,i,n,o)};case 4:return function(i,n,o,r){return t.call(e,i,n,o,r)}}return function(){return t.apply(e,arguments)}},y=function(t,e,i){return null==t?g.identity:g.isFunction(t)?v(t,e,i):g.isObject(t)?g.matcher(t):g.property(t)};g.iteratee=function(t,e){return y(t,e,1/0)};var w=function(t,e){return function(i){var n=arguments.length;if(2>n||null==i)return i;for(var o=1;n>o;o++)for(var r=arguments[o],s=t(r),a=s.length,l=0;a>l;l++){var d=s[l];e&&void 0!==i[d]||(i[d]=r[d])}return i}},E=function(t){if(!g.isObject(t))return{};if(b)return b(t);_.prototype=t;var e=new _;return _.prototype=null,e},C=function(t){return function(e){return null==e?void 0:e[t]}},T=Math.pow(2,53)-1,k=C("length"),S=function(t){var e=k(t);return"number"==typeof e&&e>=0&&T>=e};g.each=g.forEach=function(t,e,i){e=v(e,i);var n,o;if(S(t))for(n=0,o=t.length;o>n;n++)e(t[n],n,t);else{var r=g.keys(t);for(n=0,o=r.length;o>n;n++)e(t[r[n]],r[n],t)}return t},g.map=g.collect=function(t,e,i){e=y(e,i);for(var n=!S(t)&&g.keys(t),o=(n||t).length,r=Array(o),s=0;o>s;s++){var a=n?n[s]:s;r[s]=e(t[a],a,t)}return r},g.reduce=g.foldl=g.inject=t(1),g.reduceRight=g.foldr=t(-1),g.find=g.detect=function(t,e,i){var n;return n=S(t)?g.findIndex(t,e,i):g.findKey(t,e,i),void 0!==n&&-1!==n?t[n]:void 0},g.filter=g.select=function(t,e,i){var n=[];return e=y(e,i),g.each(t,function(t,i,o){e(t,i,o)&&n.push(t)}),n},g.reject=function(t,e,i){return g.filter(t,g.negate(y(e)),i)},g.every=g.all=function(t,e,i){e=y(e,i);for(var n=!S(t)&&g.keys(t),o=(n||t).length,r=0;o>r;r++){var s=n?n[r]:r;if(!e(t[s],s,t))return!1}return!0},g.some=g.any=function(t,e,i){e=y(e,i);for(var n=!S(t)&&g.keys(t),o=(n||t).length,r=0;o>r;r++){var s=n?n[r]:r;if(e(t[s],s,t))return!0}return!1},g.contains=g.includes=g.include=function(t,e,i,n){return S(t)||(t=g.values(t)),("number"!=typeof i||n)&&(i=0),g.indexOf(t,e,i)>=0},g.invoke=function(t,e){var i=c.call(arguments,2),n=g.isFunction(e);return g.map(t,function(t){var o=n?e:t[e];return null==o?o:o.apply(t,i)})},g.pluck=function(t,e){return g.map(t,g.property(e))},g.where=function(t,e){return g.filter(t,g.matcher(e))},g.findWhere=function(t,e){return g.find(t,g.matcher(e))},g.max=function(t,e,i){var n,o,r=-1/0,s=-1/0;if(null==e&&null!=t){t=S(t)?t:g.values(t);for(var a=0,l=t.length;l>a;a++)n=t[a],n>r&&(r=n)}else e=y(e,i),g.each(t,function(t,i,n){o=e(t,i,n),(o>s||o===-1/0&&r===-1/0)&&(r=t,s=o)});return r},g.min=function(t,e,i){var n,o,r=1/0,s=1/0;if(null==e&&null!=t){t=S(t)?t:g.values(t);for(var a=0,l=t.length;l>a;a++)n=t[a],r>n&&(r=n)}else e=y(e,i),g.each(t,function(t,i,n){o=e(t,i,n),(s>o||1/0===o&&1/0===r)&&(r=t,s=o)});return r},g.shuffle=function(t){for(var e,i=S(t)?t:g.values(t),n=i.length,o=Array(n),r=0;n>r;r++)e=g.random(0,r),e!==r&&(o[r]=o[e]),o[e]=i[r];return o},g.sample=function(t,e,i){return null==e||i?(S(t)||(t=g.values(t)),t[g.random(t.length-1)]):g.shuffle(t).slice(0,Math.max(0,e))},g.sortBy=function(t,e,i){return e=y(e,i),g.pluck(g.map(t,function(t,i,n){return{value:t,index:i,criteria:e(t,i,n)}}).sort(function(t,e){var i=t.criteria,n=e.criteria;if(i!==n){if(i>n||void 0===i)return 1;if(n>i||void 0===n)return-1}return t.index-e.index}),"value")};var $=function(t){return function(e,i,n){var o={};return i=y(i,n),g.each(e,function(n,r){var s=i(n,r,e);t(o,n,s)}),o}};g.groupBy=$(function(t,e,i){g.has(t,i)?t[i].push(e):t[i]=[e]}),g.indexBy=$(function(t,e,i){t[i]=e}),g.countBy=$(function(t,e,i){g.has(t,i)?t[i]++:t[i]=1}),g.toArray=function(t){return t?g.isArray(t)?c.call(t):S(t)?g.map(t,g.identity):g.values(t):[]},g.size=function(t){return null==t?0:S(t)?t.length:g.keys(t).length},g.partition=function(t,e,i){e=y(e,i);var n=[],o=[];return g.each(t,function(t,i,r){(e(t,i,r)?n:o).push(t)}),[n,o]},g.first=g.head=g.take=function(t,e,i){return null==t?void 0:null==e||i?t[0]:g.initial(t,t.length-e)},g.initial=function(t,e,i){return c.call(t,0,Math.max(0,t.length-(null==e||i?1:e)))},g.last=function(t,e,i){return null==t?void 0:null==e||i?t[t.length-1]:g.rest(t,Math.max(0,t.length-e))},g.rest=g.tail=g.drop=function(t,e,i){return c.call(t,null==e||i?1:e)},g.compact=function(t){return g.filter(t,g.identity)};var P=function(t,e,i,n){for(var o=[],r=0,s=n||0,a=k(t);a>s;s++){var l=t[s];if(S(l)&&(g.isArray(l)||g.isArguments(l))){e||(l=P(l,e,i));var d=0,c=l.length;for(o.length+=c;c>d;)o[r++]=l[d++]}else i||(o[r++]=l)}return o};g.flatten=function(t,e){return P(t,e,!1)},g.without=function(t){return g.difference(t,c.call(arguments,1))},g.uniq=g.unique=function(t,e,i,n){g.isBoolean(e)||(n=i,i=e,e=!1),null!=i&&(i=y(i,n));for(var o=[],r=[],s=0,a=k(t);a>s;s++){var l=t[s],d=i?i(l,s,t):l;e?(s&&r===d||o.push(l),r=d):i?g.contains(r,d)||(r.push(d),o.push(l)):g.contains(o,l)||o.push(l)}return o},g.union=function(){return g.uniq(P(arguments,!0,!0))},g.intersection=function(t){for(var e=[],i=arguments.length,n=0,o=k(t);o>n;n++){var r=t[n];if(!g.contains(e,r)){for(var s=1;i>s&&g.contains(arguments[s],r);s++);s===i&&e.push(r)}}return e},g.difference=function(t){var e=P(arguments,!0,!0,1);return g.filter(t,function(t){return!g.contains(e,t)})},g.zip=function(){return g.unzip(arguments)},g.unzip=function(t){for(var e=t&&g.max(t,k).length||0,i=Array(e),n=0;e>n;n++)i[n]=g.pluck(t,n);return i},g.object=function(t,e){for(var i={},n=0,o=k(t);o>n;n++)e?i[t[n]]=e[n]:i[t[n][0]]=t[n][1];return i},g.findIndex=e(1),g.findLastIndex=e(-1),g.sortedIndex=function(t,e,i,n){i=y(i,n,1);for(var o=i(e),r=0,s=k(t);s>r;){var a=Math.floor((r+s)/2);i(t[a])<o?r=a+1:s=a}return r},g.indexOf=i(1,g.findIndex,g.sortedIndex),g.lastIndexOf=i(-1,g.findLastIndex),g.range=function(t,e,i){null==e&&(e=t||0,t=0),i=i||1;for(var n=Math.max(Math.ceil((e-t)/i),0),o=Array(n),r=0;n>r;r++,t+=i)o[r]=t;return o};var x=function(t,e,i,n,o){if(!(n instanceof e))return t.apply(i,o);var r=E(t.prototype),s=t.apply(r,o);return g.isObject(s)?s:r};g.bind=function(t,e){if(m&&t.bind===m)return m.apply(t,c.call(arguments,1));if(!g.isFunction(t))throw new TypeError("Bind must be called on a function");var i=c.call(arguments,2),n=function(){return x(t,n,e,this,i.concat(c.call(arguments)))};return n},g.partial=function(t){var e=c.call(arguments,1),i=function(){for(var n=0,o=e.length,r=Array(o),s=0;o>s;s++)r[s]=e[s]===g?arguments[n++]:e[s];for(;n<arguments.length;)r.push(arguments[n++]);return x(t,i,this,this,r)};return i},g.bindAll=function(t){var e,i,n=arguments.length;if(1>=n)throw new Error("bindAll must be passed function names");for(e=1;n>e;e++)i=arguments[e],t[i]=g.bind(t[i],t);return t},g.memoize=function(t,e){var i=function(n){var o=i.cache,r=""+(e?e.apply(this,arguments):n);return g.has(o,r)||(o[r]=t.apply(this,arguments)),o[r]};return i.cache={},i},g.delay=function(t,e){var i=c.call(arguments,2);return setTimeout(function(){return t.apply(null,i)},e)},g.defer=g.partial(g.delay,g,1),g.throttle=function(t,e,i){var n,o,r,s=null,a=0;i||(i={});var l=function(){a=i.leading===!1?0:g.now(),s=null,r=t.apply(n,o),s||(n=o=null)};return function(){var d=g.now();a||i.leading!==!1||(a=d);var c=e-(d-a);return n=this,o=arguments,0>=c||c>e?(s&&(clearTimeout(s),s=null),a=d,r=t.apply(n,o),s||(n=o=null)):s||i.trailing===!1||(s=setTimeout(l,c)),r}},g.debounce=function(t,e,i){var n,o,r,s,a,l=function(){var d=g.now()-s;e>d&&d>=0?n=setTimeout(l,e-d):(n=null,i||(a=t.apply(r,o),n||(r=o=null)))};return function(){r=this,o=arguments,s=g.now();var d=i&&!n;return n||(n=setTimeout(l,e)),d&&(a=t.apply(r,o),r=o=null),a}},g.wrap=function(t,e){return g.partial(e,t)},g.negate=function(t){return function(){return!t.apply(this,arguments)}},g.compose=function(){var t=arguments,e=t.length-1;return function(){for(var i=e,n=t[e].apply(this,arguments);i--;)n=t[i].call(this,n);return n}},g.after=function(t,e){return function(){return--t<1?e.apply(this,arguments):void 0}},g.before=function(t,e){var i;return function(){return--t>0&&(i=e.apply(this,arguments)),1>=t&&(e=null),i}},g.once=g.partial(g.before,2);var R=!{toString:null}.propertyIsEnumerable("toString"),A=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];g.keys=function(t){if(!g.isObject(t))return[];if(f)return f(t);var e=[];for(var i in t)g.has(t,i)&&e.push(i);return R&&n(t,e),e},g.allKeys=function(t){if(!g.isObject(t))return[];var e=[];for(var i in t)e.push(i);return R&&n(t,e),e},g.values=function(t){for(var e=g.keys(t),i=e.length,n=Array(i),o=0;i>o;o++)n[o]=t[e[o]];return n},g.mapObject=function(t,e,i){e=y(e,i);for(var n,o=g.keys(t),r=o.length,s={},a=0;r>a;a++)n=o[a],s[n]=e(t[n],n,t);return s},g.pairs=function(t){for(var e=g.keys(t),i=e.length,n=Array(i),o=0;i>o;o++)n[o]=[e[o],t[e[o]]];return n},g.invert=function(t){for(var e={},i=g.keys(t),n=0,o=i.length;o>n;n++)e[t[i[n]]]=i[n];return e},g.functions=g.methods=function(t){var e=[];for(var i in t)g.isFunction(t[i])&&e.push(i);return e.sort()},g.extend=w(g.allKeys),g.extendOwn=g.assign=w(g.keys),g.findKey=function(t,e,i){e=y(e,i);for(var n,o=g.keys(t),r=0,s=o.length;s>r;r++)if(n=o[r],e(t[n],n,t))return n},g.pick=function(t,e,i){var n,o,r={},s=t;if(null==s)return r;g.isFunction(e)?(o=g.allKeys(s),n=v(e,i)):(o=P(arguments,!1,!1,1),n=function(t,e,i){return e in i},s=Object(s));for(var a=0,l=o.length;l>a;a++){var d=o[a],c=s[d];n(c,d,s)&&(r[d]=c)}return r},g.omit=function(t,e,i){if(g.isFunction(e))e=g.negate(e);else{var n=g.map(P(arguments,!1,!1,1),String);e=function(t,e){return!g.contains(n,e)}}return g.pick(t,e,i)},g.defaults=w(g.allKeys,!0),g.create=function(t,e){var i=E(t);return e&&g.extendOwn(i,e),i},g.clone=function(t){return g.isObject(t)?g.isArray(t)?t.slice():g.extend({},t):t},g.tap=function(t,e){return e(t),t},g.isMatch=function(t,e){var i=g.keys(e),n=i.length;if(null==t)return!n;for(var o=Object(t),r=0;n>r;r++){var s=i[r];if(e[s]!==o[s]||!(s in o))return!1}return!0};var O=function(t,e,i,n){if(t===e)return 0!==t||1/t===1/e;if(null==t||null==e)return t===e;t instanceof g&&(t=t._wrapped),e instanceof g&&(e=e._wrapped);var o=u.call(t);if(o!==u.call(e))return!1;switch(o){case"[object RegExp]":case"[object String]":return""+t==""+e;case"[object Number]":return+t!==+t?+e!==+e:0===+t?1/+t===1/e:+t===+e;case"[object Date]":case"[object Boolean]":return+t===+e}var r="[object Array]"===o;if(!r){if("object"!=typeof t||"object"!=typeof e)return!1;var s=t.constructor,a=e.constructor;if(s!==a&&!(g.isFunction(s)&&s instanceof s&&g.isFunction(a)&&a instanceof a)&&"constructor"in t&&"constructor"in e)return!1}i=i||[],n=n||[];for(var l=i.length;l--;)if(i[l]===t)return n[l]===e;if(i.push(t),n.push(e),r){if(l=t.length,l!==e.length)return!1;for(;l--;)if(!O(t[l],e[l],i,n))return!1}else{var d,c=g.keys(t);if(l=c.length,g.keys(e).length!==l)return!1;for(;l--;)if(d=c[l],!g.has(e,d)||!O(t[d],e[d],i,n))return!1}return i.pop(),n.pop(),!0};g.isEqual=function(t,e){return O(t,e)},g.isEmpty=function(t){return null==t?!0:S(t)&&(g.isArray(t)||g.isString(t)||g.isArguments(t))?0===t.length:0===g.keys(t).length},g.isElement=function(t){return!(!t||1!==t.nodeType)},g.isArray=p||function(t){return"[object Array]"===u.call(t)},g.isObject=function(t){var e=typeof t;return"function"===e||"object"===e&&!!t},g.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(t){g["is"+t]=function(e){return u.call(e)==="[object "+t+"]"}}),g.isArguments(arguments)||(g.isArguments=function(t){return g.has(t,"callee")}),"function"!=typeof/./&&"object"!=typeof Int8Array&&(g.isFunction=function(t){return"function"==typeof t||!1}),g.isFinite=function(t){return isFinite(t)&&!isNaN(parseFloat(t))},g.isNaN=function(t){return g.isNumber(t)&&t!==+t},g.isBoolean=function(t){return t===!0||t===!1||"[object Boolean]"===u.call(t)},g.isNull=function(t){return null===t},g.isUndefined=function(t){return void 0===t},g.has=function(t,e){return null!=t&&h.call(t,e)},g.noConflict=function(){return o._=r,this},g.identity=function(t){return t},g.constant=function(t){return function(){return t}},g.noop=function(){},g.property=C,g.propertyOf=function(t){return null==t?function(){}:function(e){return t[e]}},g.matcher=g.matches=function(t){return t=g.extendOwn({},t),function(e){return g.isMatch(e,t)}},g.times=function(t,e,i){var n=Array(Math.max(0,t));e=v(e,i,1);for(var o=0;t>o;o++)n[o]=e(o);return n},g.random=function(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))},g.now=Date.now||function(){return(new Date).getTime()};var M={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},N=g.invert(M),I=function(t){var e=function(e){return t[e]},i="(?:"+g.keys(t).join("|")+")",n=RegExp(i),o=RegExp(i,"g");return function(t){return t=null==t?"":""+t,n.test(t)?t.replace(o,e):t}};g.escape=I(M),g.unescape=I(N),g.result=function(t,e,i){var n=null==t?void 0:t[e];return void 0===n&&(n=i),g.isFunction(n)?n.call(t):n};var D=0;g.uniqueId=function(t){var e=++D+"";return t?t+e:e},g.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var B=/(.)^/,L={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},F=/\\|'|\r|\n|\u2028|\u2029/g,U=function(t){return"\\"+L[t]};g.template=function(t,e,i){!e&&i&&(e=i),e=g.defaults({},e,g.templateSettings);var n=RegExp([(e.escape||B).source,(e.interpolate||B).source,(e.evaluate||B).source].join("|")+"|$","g"),o=0,r="__p+='";t.replace(n,function(e,i,n,s,a){return r+=t.slice(o,a).replace(F,U),o=a+e.length,i?r+="'+\n((__t=("+i+"))==null?'':_.escape(__t))+\n'":n?r+="'+\n((__t=("+n+"))==null?'':__t)+\n'":s&&(r+="';\n"+s+"\n__p+='"),e}),r+="';\n",e.variable||(r="with(obj||{}){\n"+r+"}\n"),r="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+r+"return __p;\n";try{var s=new Function(e.variable||"obj","_",r)}catch(a){throw a.source=r,a}var l=function(t){return s.call(this,t,g)},d=e.variable||"obj";return l.source="function("+d+"){\n"+r+"}",l},g.chain=function(t){var e=g(t);return e._chain=!0,e};var j=function(t,e){return t._chain?g(e).chain():e};g.mixin=function(t){g.each(g.functions(t),function(e){var i=g[e]=t[e];g.prototype[e]=function(){var t=[this._wrapped];return d.apply(t,arguments),j(this,i.apply(g,t))}})},g.mixin(g),g.each(["pop","push","reverse","shift","sort","splice","unshift"],function(t){var e=s[t];g.prototype[t]=function(){var i=this._wrapped;return e.apply(i,arguments),"shift"!==t&&"splice"!==t||0!==i.length||delete i[0],j(this,i)}}),g.each(["concat","join","slice"],function(t){var e=s[t];g.prototype[t]=function(){return j(this,e.apply(this._wrapped,arguments))}}),g.prototype.value=function(){return this._wrapped},g.prototype.valueOf=g.prototype.toJSON=g.prototype.value,g.prototype.toString=function(){return""+this._wrapped},"function"==typeof define&&define.amd&&define("underscore",[],function(){return g})}.call(this),define("bootstrap",["underscore"],function(){var t=function(t,e,i,n){_.isString(e)&&(e=require("controller/"+e+"Controller")),_.isString(i)&&(i=require("views/"+i+"View"));var o=new e(t,n),r=new i(o,n);_.isFunction(r.loadView)&&r.loadView(),o.onViewLoaded()};return t}),define("service",["require"],function(t){var e=function(){};return e.get=function(e){if(!$tt._services[e]){var i=t("service/"+e+"Service");$tt._services[e]=new i}return $tt._services[e]},e}),define("core/dust",["underscore"],function(){var t={generateUrl:function(t,e,i,n){return n&&n.hasOwnProperty("path")?n.path.indexOf("://")>0||0==n.path.indexOf("blob:")?t.write(n.path):t.write((Routing.getBaseUrl()+"/").replace(/\w+\.php\/$/gi,"")+n.path):t},generateRouteUrl:function(t,e,i,n){if(!n||!n.hasOwnProperty("name")||!n.hasOwnProperty("str_params"))return t;var o=n.str_params.split("|"),r={};return o.forEach(function(t,i,n){var o=t.split(":");r[o[0]]=e.get(o[1])}),t.write(Routing.generate(n.name,r,n.absolute))},sizeOf:function(t,e,i,n){var o;return this.size({write:function(t){o=t}},e,i,n),i&&i.block?t.render(i.block,e.push({key:o})):t=t.write(o),t},isLoggedInUser:function(t,e,i,n){if(!n||!n.hasOwnProperty("id")||!window.user)return t;var o=n.id==window.user.get("id");return n.inverse&&(o=!o),i?(o&&i.block&&t.render(i.block,e),!o&&i["else"]&&t.render(i["else"],e)):t=t.write(o?"Yes":"No"),t},isNotLoggedInUser:function(t,e,i,n){return n.inverse=!0,this.isLoggedInUser(t,e,i,n)},isUserOnList:function(t,e,i,n){if(!(n&&n.hasOwnProperty("list")&&n.hasOwnProperty("username")&&window.user))return t;var o=window.user["isUserOn"+n.list+"List"](n.username);return i?(o&&i.block&&t.render(i.block,e),!o&&i["else"]&&t.render(i["else"],e)):t=t.write(o?"Yes":"No"),t},isCurrentUser:function(t,e,i,n){if(!n||!n.hasOwnProperty("id")||!window.user)return t;var o=n.id==window.user.get("id");return n.inverse&&(o=!o),i?(o&&i.block&&t.render(i.block,e),!o&&i["else"]&&t.render(i["else"],e)):t=t.write(o?"Yes":"No"),t}},e={nl2br:function(t){return t.replace(/(?:\r\n|\r|\n)/g,"<br />")},date:function(t){var e=new Date(t);if(_.isNaN(e.getTime()))return"";var i=e.getHours()>11?"pm":"am",n=e.getHours()%12,o=e.getMinutes(),r=e.toDateString();return 0==n&&(n=12),10>n&&(n="0"+n),10>o&&(o="0"+o),r=r.substring(r.indexOf(" ")+1),r+" "+n+":"+o+" "+i}},i=function(){};return i.inject=function(){_.each(t,function(t,e,i){dust.helpers[e]=t}),_.each(e,function(t,e,i){dust.filters[e]=t})},i}),define("core/helper",[],function(){var t=function(){};return t.TAG="Helper",t.MEDIA_TYPE_IMAGE=0,t.MEDIA_TYPE_VIDEO=1,t.MEDIA_TYPE_AUDIO=2,t.MEDIA_TYPE_OTHER=9,t.isFullscreen=function(){return!!(document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement)},t.toggleFullScreen=function(e){console.log("%s: %s",t.TAG,"toggleFullScreen");var i=e[0];t.isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen():i.requestFullscreen?i.requestFullscreen():i.mozRequestFullScreen?i.mozRequestFullScreen():i.webkitRequestFullscreen?i.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT):i.msRequestFullscreen&&i.msRequestFullscreen()},t.updateProgressBar=function(t,e){var i=t.find(".progress-bar");i.attr("aria-valuenow",e),i.css("width",e+"%"),i.html(e+"%")},t.formatSize=function(t){return-1==t?t:(Number(t)/1024/1024).toFixed(2)+" MB"},t.getIconForMediaType=function(e){var i,n;switch(e){case t.MEDIA_TYPE_IMAGE:i="fa-file-photo-o",n="Image";break;case t.MEDIA_TYPE_VIDEO:i="fa-file-video-o",n="Video";break;case t.MEDIA_TYPE_AUDIO:i="fa-file-audio-o",n="Audio";break;case t.MEDIA_TYPE_OTHER:i="fa-file-o",n="Other"}return{icon:i,text:n}},t.autoSize=function(){$(".autosize").autosize({append:""})},t}),define("core/subscriber",["underscore"],function(){var t=function(){this.subscriptions={}};return t.prototype._dispatch=function(t,e){var i={type:t};!_.isObject(e)||_.isArray(e)||_.isFunction(e)||_.each(e,function(t,e,n){i[e]=t}),_.each(this.subscriptions[t],function(t,e,n){_.isFunction(t)&&t.call(this,i)},this)},t.prototype.subscribe=function(t,e){_.has(this.subscriptions,t)||(this.subscriptions[t]=[]),_.contains(this.subscriptions[t],e)||this.subscriptions[t].push(e)},t.prototype.unsubscribe=function(t){_.each(this.subscriptions,function(e,i,n){if(_.contains(e,t)){var o=_.indexOf(e,t);e.splice(o,1)}})},t}),define("factory/contactFactory",[],function(){var t={};return t["delete"]=function(t,e){var i=$.Deferred(),n={method:"DELETE",url:Routing.generate("imdc_delete_contact"),data:{userIds:t,contactList:e}};return $.ajax(n).then(function(t,e,n){i.resolve(t)},function(t,e,n){console.log(t.responseText),i.reject(t.responseJSON)}),i.promise()},t}),define("factory/forumFactory",[],function(){var t={};return t["delete"]=function(t){var e=$.Deferred(),i={method:"DELETE",url:Routing.generate("imdc_delete_forum",{forumId:t.get("id")})};return $.ajax(i).then(function(t,i,n){e.resolve(t)},function(t,i,n){console.log(t.responseText),e.reject(t.responseJSON)}),e.promise()},t}),define("factory/groupFactory",[],function(){var t={};return t["delete"]=function(t){var e=$.Deferred(),i={method:"DELETE",url:Routing.generate("imdc_delete_user_group",{groupId:t.get("id")})};return $.ajax(i).then(function(t,i,n){e.resolve(t)},function(t,i,n){console.log(t.responseText),e.reject(t.responseJSON)}),e.promise()},t}),define("model/model",["core/subscriber","extra","underscore"],function(t){var e=function(e){if(t.prototype.constructor.apply(this),e=e||{},!_.isObject(e)||_.isArray(e)||_.isFunction(e))throw new Error("data must be an object");this.data=e};return e.extend(t),e.Event={CHANGE:"eventChange"},e._stringToKeyPath=function(t){return t.split(".")},e.prototype._findKeyPath=function(t,i){for(var n=e._stringToKeyPath(i);0!==n.length;){var o=n.shift(),r=parseInt(o,10);if(o=_.isNumber(r)&&!_.isNaN(r)?r:o,!(_.isObject(t)&&_.has(t,o)&&t.hasOwnProperty(o)||_.isArray(t)&&_.contains(t,o)&&void 0!==t[o]))return;t=t[o]}return t},e.prototype._setKeyPath=function(t,i,n){for(var o=e._stringToKeyPath(i);o.length>1;){var r=o.shift(),s=parseInt(r,10);if(r=_.isNumber(s)&&!_.isNaN(s)?s:r,
_.isObject(t)&&!_.has(t,r)&&!t.hasOwnProperty(r)||_.isArray(t)&&!_.contains(t,r)&&void 0===t[r]||_.isNull(t[r])){console.log("defining key: "+r);var a=parseInt(o[0],10);t[r]=_.isNumber(a)&&!_.isNaN(a)?[]:{}}t=t[r]}t[o.shift()]=n},e.prototype._dispatch=function(e,i,n){n=_.extend(n||{},{keyPath:i||"",model:this}),t.prototype._dispatch.call(this,e,n)},e.prototype.get=function(t,e){var i=this._findKeyPath(this.data,t);return"undefined"!=typeof i?i:e},e.prototype.set=function(t,i,n){n="undefined"!=typeof n?n:!0;var o=this._findKeyPath(this.data,t);this._setKeyPath(this.data,t,i),n&&o!==i&&this._dispatch(e.Event.CHANGE,t)},e.prototype.update=function(t,e){_.each(t,function(t,i,n){var o=e?e+"."+i:i;_.isObject(t)||_.isArray(t)?(console.log("update: "+o),this.update(t,o)):(console.log("set: "+o+" to:"+t),this.set(o,t))},this)},e.prototype.forceChange=function(t,i){this._dispatch(e.Event.CHANGE,t,i)},e.prototype.find=function(t,e,i){return _.findIndex(i,function(i){return i.get(e)==t})},e}),define("model/mediaModel",["model/model","extra"],function(t){var e=function(e){t.prototype.constructor.apply(this,arguments)};return e.extend(t),e}),define("factory/mediaFactory",["model/mediaModel","underscore"],function(t){var e={};return e.list=function(e){var i=$.Deferred(),n={url:Routing.generate("imdc_cget_media"),data:{}};return e&&(n.data.id=e.join()),$.ajax(n).then(function(e,n,o){e.media.forEach(function(e,i,n){n[i]=new t(e)}),i.resolve(e)},function(t,e,n){console.log(t.responseText),i.reject(t.responseJSON)}),i.promise()},e.get=function(e){var i=$.Deferred(),n=_.isObject(e),o=n?e.get("id"):e,r={url:Routing.generate("imdc_get_media",{mediaId:o})};return $.ajax(r).then(function(o,r,s){n?(e.update(o.media),o.media=e):o.media=new t(o.media),i.resolve(o)},function(t,e,n){console.log(t.responseText),i.reject(t.responseJSON)}),i.promise()},e.edit=function(t){var e=$.Deferred(),i={method:"PUT",url:Routing.generate("imdc_edit_media",{mediaId:t.get("id")}),data:{media:JSON.stringify(t.data)}};return $.ajax(i).then(function(i,n,o){t.update(i.media),i.media=t,e.resolve(i)},function(t,i,n){console.log(t.responseText),e.reject(t.responseJSON)}),e.promise()},e["delete"]=function(t,e){var i=$.Deferred(),n={method:"DELETE",url:Routing.generate("imdc_delete_media",{mediaId:t.get("id")}),data:{confirm:e||!1}};return $.ajax(n).then(function(t,e,n){i.resolve(t)},function(t,e,n){console.log(t.responseText);var o=t.responseJSON,r=[];o.in_use.forEach(function(t,e,i){r.push(Translator.trans("filesGateway.deleteMediaInUseConfirmation."+t))}),o.confirmText=Translator.trans("filesGateway.deleteMediaInUseConfirmation.finalMessage",{mediaUsedLocations:r.join(", ")}),i.reject(o)}),i.promise()},e.trim=function(e,i,n){var o=$.Deferred(),r={method:"PATCH",url:Routing.generate("imdc_trim_media",{mediaId:e.get("id")}),data:{startTime:i,endTime:n}};return $.ajax(r).then(function(i,n,r){e=new t(i.media),o.resolve(i)},function(t,e,i){console.log(t.responseText),o.reject(t.responseJSON)}),o.promise()},e}),define("factory/messageFactory",[],function(){var t={};return t.edit=function(t){var e=$.Deferred(),i={method:"POST",url:Routing.generate("imdc_message_mark_as_read",{messageid:t.get("id")})};return $.ajax(i).then(function(t,i,n){t.wasEdited?e.resolve(t):e.reject(t)},function(t,i,n){console.log(t.responseText),e.reject(t.responseJSON)}),e.promise()},t}),define("factory/myFilesFactory",["model/mediaModel"],function(t){var e={};return e._prepForFormSubmit=function(t,e,i){e.type="POST",e.contentType=!1,t&&(e.data=new FormData(t)),e.processData=!1,e.xhr=function(){var t=$.ajaxSettings.xhr();return t.upload.addEventListener("progress",function(t){t.lengthComputable&&i.notify(Math.floor(t.loaded/t.total*100))},!1),t}},e.addRecording=function(i){var n=new FormData,o=!!navigator.mozGetUserMedia,r=$.Deferred(),s={url:Routing.generate("imdc_myfiles_add_recording")};return n.append("isFirefox",o),o||n.append("video-blob",i.video),n.append("audio-blob",i.audio),n.append("title",i.title),n.append("isInterpretation",i.isInterpretation),n.append("sourceStartTime",i.sourceStartTime),n.append("sourceId",i.sourceId),e._prepForFormSubmit(null,s,r),s.data=n,$.ajax(s).then(function(e,i,n){200==e.responseCode?(e.media=new t(e.media),r.resolve(e)):r.reject(e)},function(t,e,i){console.log(t.responseText),r.reject()}),r.promise()},e.add=function(i){var n=$.Deferred(),o={url:Routing.generate("imdc_myfiles_add")};return e._prepForFormSubmit(i,o,n),$.ajax(o).then(function(e,i,o){e.wasUploaded?(e.media=new t(e.media),n.resolve(e)):(console.error(e.error),n.reject(e))},function(t,e,i){console.log(t.responseText),n.reject()}),n.promise()},e}),define("model/postModel",["model/model","model/mediaModel","extra"],function(t,e){var i=function(i){t.prototype.constructor.apply(this,arguments),this.data.keyPoint=null,this.data.ordered_media&&this.data.ordered_media.forEach(function(t,i,n){n[i]=new e(t)})};return i.extend(t),i.prototype.isNew=function(){return"0"===String(this.data.id).substr(0,1)},i}),define("factory/postFactory",["model/postModel"],function(t){var e={};return e._prepForFormSubmit=function(t,e){e.contentType=!1,t&&(e.data=new FormData(t)),e.processData=!1},e._newPost=function(e,i,n){var o=$.Deferred();return $.ajax(i).then(function(e,i,n){e.post=new t(e.post),e.post.set("form",e.form),o.resolve(e)},function(t,i,r){console.log(t.responseText),n&&e.set("form",t.responseJSON.form),o.reject(t.responseJSON)}),o.promise()},e["new"]=function(t){var i={url:Routing.generate("imdc_new_post",{threadId:t.get("parent_thread_id"),parentPostId:t.get("parent_post_id")||t.get("id")})};return e._newPost(t,i,!1)},e.post=function(t,i){var n={method:"POST",url:Routing.generate("imdc_post_post",{threadId:t.get("parent_thread_id"),parentPostId:t.get("parent_post_id")||t.get("id")})};return e._prepForFormSubmit(i,n),e._newPost(t,n,!0)},e.get=function(t){var e=$.Deferred(),i={url:Routing.generate("imdc_get_post",{postId:t.get("id")})};return $.ajax(i).then(function(i,n,o){t.update(i.post),e.resolve(i)},function(t,i,n){console.log(t.responseText),e.reject(t.responseJSON)}),e.promise()},e._editPut=function(t,e,i){var n=$.Deferred();return $.ajax(e).then(function(e,i,o){t.update(e.post),t.set("form",e.form),t.set("keyPoint.startTime",t.get("start_time")),t.set("keyPoint.endTime",t.get("end_time")),n.resolve(e)},function(e,o,r){console.log(e.responseText),i&&t.set("form",e.responseJSON.form),n.reject(e.responseJSON)}),n.promise()},e.edit=function(t){var i={url:Routing.generate("imdc_edit_post",{postId:t.get("id")})};return e._editPut(t,i,!1)},e.put=function(t,i){var n={method:"POST",url:Routing.generate("imdc_put_post",{postId:t.get("id")})};return e._prepForFormSubmit(i,n),e._editPut(t,n,!0)},e["delete"]=function(t){var e=$.Deferred(),i={method:"DELETE",url:Routing.generate("imdc_delete_post",{postId:t.get("id")})};return $.ajax(i).then(function(t,i,n){e.resolve(t)},function(t,i,n){console.log(t.responseText),e.reject(t.responseJSON)}),e.promise()},e}),define("factory/threadFactory",[],function(){var t={};return t["delete"]=function(t){var e=$.Deferred(),i={method:"DELETE",url:Routing.generate("imdc_delete_thread",{threadId:t.get("id")})};return $.ajax(i).then(function(t,i,n){e.resolve(t)},function(t,i,n){console.log(t.responseText),e.reject(t.responseJSON)}),e.promise()},t}),define("service/keyPointService",["underscore"],function(){var t=function(){this.name="KeyPoint",this.keyPoints=[],this.subscriptions=[]};return t.Event={ADD:"eventAdd",DURATION:"eventDuration",SELECTION_TIMES:"eventSelectionTimes",HOVER:"eventHover",CLICK:"eventClick",EDIT:"eventEdit",REMOVE:"eventRemove"},t._kIndex=function(t){return _.isString(t)?t:"K"+t},t.prototype.register=function(e){var i=t._kIndex(e.id);_.isObject(e)&&(this.keyPoints[i]=e)},t.prototype.deregister=function(e){var i=t._kIndex(e);_.has(this.keyPoints,i)&&this.keyPoints.splice(i,1)},t.prototype.subscribe=function(e,i){var n=t._kIndex(e);_.has(this.subscriptions,n)||(this.subscriptions[n]=[]),_.contains(this.subscriptions[n],i)||this.subscriptions[n].push(i)},t.prototype.unsubscribe=function(e,i){var n=t._kIndex(e);if(_.has(this.subscriptions,n)){var o=this.subscriptions[n];if(_.contains(o,i)){var r=_.indexOf(o,i);o.splice(r,1)}}},t.prototype.dispatch=function(e,i,n){var o=t._kIndex(e);if(("all"===o||_.has(this.keyPoints,o))&&_.contains(t.Event,i)){var r="all"===o?_.values(this.subscriptions):[this.subscriptions[o]],s=function(t,e,r){var s={type:i};"all"===o?s.keyPoints=this.keyPoints:s.keyPoint=this.keyPoints[o],_.isObject(n)&&_.each(n,function(t,e,i){s[e]=t}),_.each(t,function(t,e,i){_.isFunction(t)&&t.call(this,s)},this)};_.each(r,s,this),"all"!==o&&_.each([this.subscriptions.all],s,this)}},t}),!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define("sockjs",[],t);else{var e;"undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self),e.SockJS=t()}}(function(){var t;return function e(t,i,n){function o(s,a){if(!i[s]){if(!t[s]){var l="function"==typeof require&&require;if(!a&&l)return l(s,!0);if(r)return r(s,!0);var d=new Error("Cannot find module '"+s+"'");throw d.code="MODULE_NOT_FOUND",d}var c=i[s]={exports:{}};t[s][0].call(c.exports,function(e){var i=t[s][1][e];return o(i?i:e)},c,c.exports,e,t,i,n)}return i[s].exports}for(var r="function"==typeof require&&require,s=0;s<n.length;s++)o(n[s]);return o}({1:[function(t,e){(function(i){var n=t("./transport-list");e.exports=t("./main")(n),"_sockjs_onload"in i&&setTimeout(i._sockjs_onload,1)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./main":14,"./transport-list":16}],2:[function(t,e){function i(){o.call(this),this.initEvent("close",!1,!1),this.wasClean=!1,this.code=0,this.reason=""}var n=t("inherits"),o=t("./event");n(i,o),e.exports=i},{"./event":4,inherits:54}],3:[function(t,e){function i(){o.call(this)}var n=t("inherits"),o=t("./eventtarget");n(i,o),i.prototype.removeAllListeners=function(t){t?delete this._listeners[t]:this._listeners={}},i.prototype.once=function(t,e){function i(){n.removeListener(t,i),o||(o=!0,e.apply(this,arguments))}var n=this,o=!1;this.on(t,i)},i.prototype.emit=function(t){var e=this._listeners[t];if(e)for(var i=Array.prototype.slice.call(arguments,1),n=0;n<e.length;n++)e[n].apply(this,i)},i.prototype.on=i.prototype.addListener=o.prototype.addEventListener,i.prototype.removeListener=o.prototype.removeEventListener,e.exports.EventEmitter=i},{"./eventtarget":5,inherits:54}],4:[function(t,e){function i(t){this.type=t}i.prototype.initEvent=function(t,e,i){return this.type=t,this.bubbles=e,this.cancelable=i,this.timeStamp=+new Date,this},i.prototype.stopPropagation=function(){},i.prototype.preventDefault=function(){},i.CAPTURING_PHASE=1,i.AT_TARGET=2,i.BUBBLING_PHASE=3,e.exports=i},{}],5:[function(t,e){function i(){this._listeners={}}i.prototype.addEventListener=function(t,e){t in this._listeners||(this._listeners[t]=[]);var i=this._listeners[t];-1===i.indexOf(e)&&(i=i.concat([e])),this._listeners[t]=i},i.prototype.removeEventListener=function(t,e){var i=this._listeners[t];if(i){var n=i.indexOf(e);return-1!==n?void(i.length>1?this._listeners[t]=i.slice(0,n).concat(i.slice(n+1)):delete this._listeners[t]):void 0}},i.prototype.dispatchEvent=function(t){var e=t.type,i=Array.prototype.slice.call(arguments,0);if(this["on"+e]&&this["on"+e].apply(this,i),e in this._listeners)for(var n=this._listeners[e],o=0;o<n.length;o++)n[o].apply(this,i)},e.exports=i},{}],6:[function(t,e){function i(t){o.call(this),this.initEvent("message",!1,!1),this.data=t}var n=t("inherits"),o=t("./event");n(i,o),e.exports=i},{"./event":4,inherits:54}],7:[function(t,e){function i(t){this._transport=t,t.on("message",this._transportMessage.bind(this)),t.on("close",this._transportClose.bind(this))}var n=t("json3"),o=t("./utils/iframe");i.prototype._transportClose=function(t,e){o.postMessage("c",n.stringify([t,e]))},i.prototype._transportMessage=function(t){o.postMessage("t",t)},i.prototype._send=function(t){this._transport.send(t)},i.prototype._close=function(){this._transport.close(),this._transport.removeAllListeners()},e.exports=i},{"./utils/iframe":47,json3:55}],8:[function(t,e){var i=t("./utils/url"),n=t("./utils/event"),o=t("json3"),r=t("./facade"),s=t("./info-iframe-receiver"),a=t("./utils/iframe"),l=t("./location");e.exports=function(t,e){var d={};e.forEach(function(t){t.facadeTransport&&(d[t.facadeTransport.transportName]=t.facadeTransport)}),d[s.transportName]=s;var c;t.bootstrap_iframe=function(){var e;a.currentWindowId=l.hash.slice(1);var s=function(n){if(n.source===parent&&("undefined"==typeof c&&(c=n.origin),n.origin===c)){var s;try{s=o.parse(n.data)}catch(u){return}if(s.windowId===a.currentWindowId)switch(s.type){case"s":var h;try{h=o.parse(s.data)}catch(u){break}var p=h[0],f=h[1],m=h[2],b=h[3];if(p!==t.version)throw new Error('Incompatibile SockJS! Main site uses: "'+p+'", the iframe: "'+t.version+'".');if(!i.isOriginEqual(m,l.href)||!i.isOriginEqual(b,l.href))throw new Error("Can't connect to different domain from within an iframe. ("+l.href+", "+m+", "+b+")");e=new r(new d[f](m,b));break;case"m":e._send(s.data);break;case"c":e&&e._close(),e=null}}};n.attachEvent("message",s),a.postMessage("s")}}},{"./facade":7,"./info-iframe-receiver":10,"./location":13,"./utils/event":46,"./utils/iframe":47,"./utils/url":52,debug:void 0,json3:55}],9:[function(t,e){function i(t,e){n.call(this);var i=this,o=+new Date;this.xo=new e("GET",t),this.xo.once("finish",function(t,e){var n,a;if(200===t){if(a=+new Date-o,e)try{n=r.parse(e)}catch(l){}s.isObject(n)||(n={})}i.emit("finish",n,a),i.removeAllListeners()})}var n=t("events").EventEmitter,o=t("inherits"),r=t("json3"),s=t("./utils/object");o(i,n),i.prototype.close=function(){this.removeAllListeners(),this.xo.close()},e.exports=i},{"./utils/object":49,debug:void 0,events:3,inherits:54,json3:55}],10:[function(t,e){function i(t,e){var i=this;o.call(this),this.ir=new a(e,s),this.ir.once("finish",function(t,e){i.ir=null,i.emit("message",r.stringify([t,e]))})}var n=t("inherits"),o=t("events").EventEmitter,r=t("json3"),s=t("./transport/sender/xhr-local"),a=t("./info-ajax");n(i,o),i.transportName="iframe-info-receiver",i.prototype.close=function(){this.ir&&(this.ir.close(),this.ir=null),this.removeAllListeners()},e.exports=i},{"./info-ajax":9,"./transport/sender/xhr-local":37,events:3,inherits:54,json3:55}],11:[function(t,e){(function(i){function n(t,e){var n=this;o.call(this);var r=function(){var i=n.ifr=new l(d.transportName,e,t);i.once("message",function(t){if(t){var e;try{e=s.parse(t)}catch(i){return n.emit("finish"),void n.close()}var o=e[0],r=e[1];n.emit("finish",o,r)}n.close()}),i.once("close",function(){n.emit("finish"),n.close()})};i.document.body?r():a.attachEvent("load",r)}var o=t("events").EventEmitter,r=t("inherits"),s=t("json3"),a=t("./utils/event"),l=t("./transport/iframe"),d=t("./info-iframe-receiver");r(n,o),n.enabled=function(){return l.enabled()},n.prototype.close=function(){this.ifr&&this.ifr.close(),this.removeAllListeners(),this.ifr=null},e.exports=n}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./info-iframe-receiver":10,"./transport/iframe":22,"./utils/event":46,debug:void 0,events:3,inherits:54,json3:55}],12:[function(t,e){function i(t,e){var i=this;n.call(this),setTimeout(function(){i.doXhr(t,e)},0)}var n=t("events").EventEmitter,o=t("inherits"),r=t("./utils/url"),s=t("./transport/sender/xdr"),a=t("./transport/sender/xhr-cors"),l=t("./transport/sender/xhr-local"),d=t("./transport/sender/xhr-fake"),c=t("./info-iframe"),u=t("./info-ajax");o(i,n),i._getReceiver=function(t,e,i){return i.sameOrigin?new u(e,l):a.enabled?new u(e,a):s.enabled&&i.sameScheme?new u(e,s):c.enabled()?new c(t,e):new u(e,d)},i.prototype.doXhr=function(t,e){var n=this,o=r.addPath(t,"/info");this.xo=i._getReceiver(t,o,e),this.timeoutRef=setTimeout(function(){n._cleanup(!1),n.emit("finish")},i.timeout),this.xo.once("finish",function(t,e){n._cleanup(!0),n.emit("finish",t,e)})},i.prototype._cleanup=function(t){clearTimeout(this.timeoutRef),this.timeoutRef=null,!t&&this.xo&&this.xo.close(),this.xo=null},i.prototype.close=function(){this.removeAllListeners(),this._cleanup(!1)},i.timeout=8e3,e.exports=i},{"./info-ajax":9,"./info-iframe":11,"./transport/sender/xdr":34,"./transport/sender/xhr-cors":35,"./transport/sender/xhr-fake":36,"./transport/sender/xhr-local":37,"./utils/url":52,debug:void 0,events:3,inherits:54}],13:[function(t,e){(function(t){e.exports=t.location||{origin:"http://localhost:80",protocol:"http",host:"localhost",port:80,href:"http://localhost/",hash:""}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],14:[function(t,e){(function(i){function n(t,e,i){if(!(this instanceof n))return new n(t,e,i);if(arguments.length<1)throw new TypeError("Failed to construct 'SockJS: 1 argument required, but only 0 present");g.call(this),this.readyState=n.CONNECTING,this.extensions="",this.protocol="",i=i||{},i.protocols_whitelist&&b.warn("'protocols_whitelist' is DEPRECATED. Use 'transports' instead."),this._transportsWhitelist=i.transports;var o=i.sessionId||8;if("function"==typeof o)this._generateSessionId=o;else{if("number"!=typeof o)throw new TypeError("If sessionId is used in the options, it needs to be a number or a function.");this._generateSessionId=function(){return d.string(o)}}this._server=i.server||d.numberString(1e3);var r=new s(t);if(!r.host||!r.protocol)throw new SyntaxError("The URL '"+t+"' is invalid");if(r.hash)throw new SyntaxError("The URL must not contain a fragment");if("http:"!==r.protocol&&"https:"!==r.protocol)throw new SyntaxError("The URL's scheme must be either 'http:' or 'https:'. '"+r.protocol+"' is not allowed.");var a="https:"===r.protocol;if("https"===v.protocol&&!a)throw new Error("SecurityError: An insecure SockJS connection may not be initiated from a page loaded over HTTPS");e?Array.isArray(e)||(e=[e]):e=[];var l=e.sort();l.forEach(function(t,e){if(!t)throw new SyntaxError("The protocols entry '"+t+"' is invalid.");if(e<l.length-1&&t===l[e+1])throw new SyntaxError("The protocols entry '"+t+"' is duplicated.")});var c=u.getOrigin(v.href);this._origin=c?c.toLowerCase():null,r.set("pathname",r.pathname.replace(/\/+$/,"")),this.url=r.href,this._urlInfo={nullOrigin:!m.hasDomain(),sameOrigin:u.isOriginEqual(this.url,v.href),sameScheme:u.isSchemeEqual(this.url,v.href)},this._ir=new E(this.url,this._urlInfo),this._ir.once("finish",this._receiveInfo.bind(this))}function o(t){return 1e3===t||t>=3e3&&4999>=t}t("./shims");var r,s=t("url-parse"),a=t("inherits"),l=t("json3"),d=t("./utils/random"),c=t("./utils/escape"),u=t("./utils/url"),h=t("./utils/event"),p=t("./utils/transport"),f=t("./utils/object"),m=t("./utils/browser"),b=t("./utils/log"),_=t("./event/event"),g=t("./event/eventtarget"),v=t("./location"),y=t("./event/close"),w=t("./event/trans-message"),E=t("./info-receiver");a(n,g),n.prototype.close=function(t,e){if(t&&!o(t))throw new Error("InvalidAccessError: Invalid code");if(e&&e.length>123)throw new SyntaxError("reason argument has an invalid length");if(this.readyState!==n.CLOSING&&this.readyState!==n.CLOSED){var i=!0;this._close(t||1e3,e||"Normal closure",i)}},n.prototype.send=function(t){if("string"!=typeof t&&(t=""+t),this.readyState===n.CONNECTING)throw new Error("InvalidStateError: The connection has not been established yet");this.readyState===n.OPEN&&this._transport.send(c.quote(t))},n.version=t("./version"),n.CONNECTING=0,n.OPEN=1,n.CLOSING=2,n.CLOSED=3,n.prototype._receiveInfo=function(t,e){if(this._ir=null,!t)return void this._close(1002,"Cannot connect to server");this._rto=this.countRTO(e),this._transUrl=t.base_url?t.base_url:this.url,t=f.extend(t,this._urlInfo);var i=r.filterToEnabled(this._transportsWhitelist,t);this._transports=i.main,this._connect()},n.prototype._connect=function(){for(var t=this._transports.shift();t;t=this._transports.shift()){if(t.needBody&&(!i.document.body||"undefined"!=typeof i.document.readyState&&"complete"!==i.document.readyState&&"interactive"!==i.document.readyState))return this._transports.unshift(t),void h.attachEvent("load",this._connect.bind(this));var e=this._rto*t.roundTrips||5e3;this._transportTimeoutId=setTimeout(this._transportTimeout.bind(this),e);var n=u.addPath(this._transUrl,"/"+this._server+"/"+this._generateSessionId()),o=new t(n,this._transUrl);return o.on("message",this._transportMessage.bind(this)),o.once("close",this._transportClose.bind(this)),o.transportName=t.transportName,void(this._transport=o)}this._close(2e3,"All transports failed",!1)},n.prototype._transportTimeout=function(){this.readyState===n.CONNECTING&&this._transportClose(2007,"Transport timed out")},n.prototype._transportMessage=function(t){var e,i=this,n=t.slice(0,1),o=t.slice(1);switch(n){case"o":return void this._open();case"h":return void this.dispatchEvent(new _("heartbeat"))}if(o)try{e=l.parse(o)}catch(r){}if("undefined"!=typeof e)switch(n){case"a":Array.isArray(e)&&e.forEach(function(t){i.dispatchEvent(new w(t))});break;case"m":this.dispatchEvent(new w(e));break;case"c":Array.isArray(e)&&2===e.length&&this._close(e[0],e[1],!0)}},n.prototype._transportClose=function(t,e){return this._transport&&(this._transport.removeAllListeners(),this._transport=null,this.transport=null),o(t)||2e3===t||this.readyState!==n.CONNECTING?void this._close(t,e):void this._connect()},n.prototype._open=function(){this.readyState===n.CONNECTING?(this._transportTimeoutId&&(clearTimeout(this._transportTimeoutId),this._transportTimeoutId=null),this.readyState=n.OPEN,this.transport=this._transport.transportName,this.dispatchEvent(new _("open"))):this._close(1006,"Server lost session")},n.prototype._close=function(t,e,i){var o=!1;if(this._ir&&(o=!0,this._ir.close(),this._ir=null),this._transport&&(this._transport.close(),this._transport=null,this.transport=null),this.readyState===n.CLOSED)throw new Error("InvalidStateError: SockJS has already been closed");this.readyState=n.CLOSING,setTimeout(function(){this.readyState=n.CLOSED,o&&this.dispatchEvent(new _("error"));var r=new y("close");r.wasClean=i||!1,r.code=t||1e3,r.reason=e,this.dispatchEvent(r),this.onmessage=this.onclose=this.onerror=null}.bind(this),0)},n.prototype.countRTO=function(t){return t>100?4*t:300+t},e.exports=function(e){return r=p(e),t("./iframe-bootstrap")(n,e),n}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./event/close":2,"./event/event":4,"./event/eventtarget":5,"./event/trans-message":6,"./iframe-bootstrap":8,"./info-receiver":12,"./location":13,"./shims":15,"./utils/browser":44,"./utils/escape":45,"./utils/event":46,"./utils/log":48,"./utils/object":49,"./utils/random":50,"./utils/transport":51,"./utils/url":52,"./version":53,debug:void 0,inherits:54,json3:55,"url-parse":56}],15:[function(){function t(t){var e=+t;return e!==e?e=0:0!==e&&e!==1/0&&e!==-(1/0)&&(e=(e>0||-1)*Math.floor(Math.abs(e))),e}function e(t){return t>>>0}function i(){}var n,o=Array.prototype,r=Object.prototype,s=Function.prototype,a=String.prototype,l=o.slice,d=r.toString,c=function(t){return"[object Function]"===r.toString.call(t)},u=function(t){return"[object Array]"===d.call(t)},h=function(t){return"[object String]"===d.call(t)},p=Object.defineProperty&&function(){try{return Object.defineProperty({},"x",{}),!0}catch(t){return!1}}();n=p?function(t,e,i,n){!n&&e in t||Object.defineProperty(t,e,{configurable:!0,enumerable:!1,writable:!0,value:i})}:function(t,e,i,n){!n&&e in t||(t[e]=i)};var f=function(t,e,i){for(var o in e)r.hasOwnProperty.call(e,o)&&n(t,o,e[o],i)},m=function(t){if(null==t)throw new TypeError("can't convert "+t+" to object");return Object(t)};f(s,{bind:function(t){var e=this;if(!c(e))throw new TypeError("Function.prototype.bind called on incompatible "+e);for(var n=l.call(arguments,1),o=function(){if(this instanceof d){var i=e.apply(this,n.concat(l.call(arguments)));return Object(i)===i?i:this}return e.apply(t,n.concat(l.call(arguments)))},r=Math.max(0,e.length-n.length),s=[],a=0;r>a;a++)s.push("$"+a);var d=Function("binder","return function ("+s.join(",")+"){ return binder.apply(this, arguments); }")(o);return e.prototype&&(i.prototype=e.prototype,d.prototype=new i,i.prototype=null),d}}),f(Array,{isArray:u});var b=Object("a"),_="a"!==b[0]||!(0 in b),g=function(t){var e=!0,i=!0;return t&&(t.call("foo",function(t,i,n){"object"!=typeof n&&(e=!1)}),t.call([1],function(){i="string"==typeof this},"x")),!!t&&e&&i};f(o,{forEach:function(t){var e=m(this),i=_&&h(this)?this.split(""):e,n=arguments[1],o=-1,r=i.length>>>0;if(!c(t))throw new TypeError;for(;++o<r;)o in i&&t.call(n,i[o],o,e)}},!g(o.forEach));var v=Array.prototype.indexOf&&-1!==[0,1].indexOf(1,2);f(o,{indexOf:function(e){var i=_&&h(this)?this.split(""):m(this),n=i.length>>>0;if(!n)return-1;var o=0;for(arguments.length>1&&(o=t(arguments[1])),o=o>=0?o:Math.max(0,n+o);n>o;o++)if(o in i&&i[o]===e)return o;return-1}},v);var y=a.split;2!=="ab".split(/(?:ab)*/).length||4!==".".split(/(.?)(.?)/).length||"t"==="tesst".split(/(s)*/)[1]||4!=="test".split(/(?:)/,-1).length||"".split(/.?/).length||".".split(/()()/).length>1?!function(){var t=void 0===/()??/.exec("")[1];a.split=function(i,n){var r=this;if(void 0===i&&0===n)return[];if("[object RegExp]"!==d.call(i))return y.call(this,i,n);var s,a,l,c,u=[],h=(i.ignoreCase?"i":"")+(i.multiline?"m":"")+(i.extended?"x":"")+(i.sticky?"y":""),p=0;for(i=new RegExp(i.source,h+"g"),r+="",t||(s=new RegExp("^"+i.source+"$(?!\\s)",h)),n=void 0===n?-1>>>0:e(n);(a=i.exec(r))&&(l=a.index+a[0].length,!(l>p&&(u.push(r.slice(p,a.index)),!t&&a.length>1&&a[0].replace(s,function(){for(var t=1;t<arguments.length-2;t++)void 0===arguments[t]&&(a[t]=void 0)}),a.length>1&&a.index<r.length&&o.push.apply(u,a.slice(1)),c=a[0].length,p=l,u.length>=n)));)i.lastIndex===a.index&&i.lastIndex++;return p===r.length?(c||!i.test(""))&&u.push(""):u.push(r.slice(p)),u.length>n?u.slice(0,n):u}}():"0".split(void 0,0).length&&(a.split=function(t,e){return void 0===t&&0===e?[]:y.call(this,t,e)});var w="	\n\x0B\f\r \u2028\u2029\ufeff",E="",C="["+w+"]",T=new RegExp("^"+C+C+"*"),k=new RegExp(C+C+"*$"),S=a.trim&&(w.trim()||!E.trim());f(a,{trim:function(){if(void 0===this||null===this)throw new TypeError("can't convert "+this+" to object");return String(this).replace(T,"").replace(k,"")}},S);var $=a.substr,P="".substr&&"b"!=="0b".substr(-1);f(a,{substr:function(t,e){return $.call(this,0>t&&(t=this.length+t)<0?0:t,e)}},P)},{}],16:[function(t,e){e.exports=[t("./transport/websocket"),t("./transport/xhr-streaming"),t("./transport/xdr-streaming"),t("./transport/eventsource"),t("./transport/lib/iframe-wrap")(t("./transport/eventsource")),t("./transport/htmlfile"),t("./transport/lib/iframe-wrap")(t("./transport/htmlfile")),t("./transport/xhr-polling"),t("./transport/xdr-polling"),t("./transport/lib/iframe-wrap")(t("./transport/xhr-polling")),t("./transport/jsonp-polling")]},{"./transport/eventsource":20,"./transport/htmlfile":21,"./transport/jsonp-polling":23,"./transport/lib/iframe-wrap":26,"./transport/websocket":38,"./transport/xdr-polling":39,"./transport/xdr-streaming":40,"./transport/xhr-polling":41,"./transport/xhr-streaming":42}],17:[function(t,e){(function(i){function n(t,e,i,n){var r=this;o.call(this),setTimeout(function(){r._start(t,e,i,n)},0)}var o=t("events").EventEmitter,r=t("inherits"),s=t("../../utils/event"),a=t("../../utils/url"),l=i.XMLHttpRequest;r(n,o),n.prototype._start=function(t,e,i,o){var r=this;try{this.xhr=new l}catch(d){}if(!this.xhr)return this.emit("finish",0,"no xhr support"),void this._cleanup();e=a.addQuery(e,"t="+ +new Date),this.unloadRef=s.unloadAdd(function(){r._cleanup(!0)});try{this.xhr.open(t,e,!0),this.timeout&&"timeout"in this.xhr&&(this.xhr.timeout=this.timeout,this.xhr.ontimeout=function(){r.emit("finish",0,""),r._cleanup(!1)})}catch(c){return this.emit("finish",0,""),void this._cleanup(!1)}if(o&&o.noCredentials||!n.supportsCORS||(this.xhr.withCredentials="true"),o&&o.headers)for(var u in o.headers)this.xhr.setRequestHeader(u,o.headers[u]);this.xhr.onreadystatechange=function(){if(r.xhr){var t,e,i=r.xhr;switch(i.readyState){case 3:try{e=i.status,t=i.responseText}catch(n){}1223===e&&(e=204),200===e&&t&&t.length>0&&r.emit("chunk",e,t);break;case 4:e=i.status,1223===e&&(e=204),(12005===e||12029===e)&&(e=0),r.emit("finish",e,i.responseText),r._cleanup(!1)}}};try{r.xhr.send(i)}catch(c){r.emit("finish",0,""),r._cleanup(!1)}},n.prototype._cleanup=function(t){if(this.xhr){if(this.removeAllListeners(),s.unloadDel(this.unloadRef),this.xhr.onreadystatechange=function(){},this.xhr.ontimeout&&(this.xhr.ontimeout=null),t)try{this.xhr.abort()}catch(e){}this.unloadRef=this.xhr=null}},n.prototype.close=function(){this._cleanup(!0)},n.enabled=!!l;var d=["Active"].concat("Object").join("X");!n.enabled&&d in i&&(l=function(){try{return new i[d]("Microsoft.XMLHTTP")}catch(t){return null}},n.enabled=!!new l);var c=!1;try{c="withCredentials"in new l}catch(u){}n.supportsCORS=c,e.exports=n}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../utils/event":46,"../../utils/url":52,debug:void 0,events:3,inherits:54}],18:[function(t,e){(function(t){e.exports=t.EventSource}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],19:[function(t,e){(function(t){e.exports=t.WebSocket||t.MozWebSocket}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],20:[function(t,e){function i(t){if(!i.enabled())throw new Error("Transport created when disabled");o.call(this,t,"/eventsource",r,s)}var n=t("inherits"),o=t("./lib/ajax-based"),r=t("./receiver/eventsource"),s=t("./sender/xhr-cors"),a=t("eventsource");n(i,o),i.enabled=function(){return!!a},i.transportName="eventsource",i.roundTrips=2,e.exports=i},{"./lib/ajax-based":24,"./receiver/eventsource":29,"./sender/xhr-cors":35,eventsource:18,inherits:54}],21:[function(t,e){function i(t){if(!o.enabled)throw new Error("Transport created when disabled");s.call(this,t,"/htmlfile",o,r)}var n=t("inherits"),o=t("./receiver/htmlfile"),r=t("./sender/xhr-local"),s=t("./lib/ajax-based");n(i,s),i.enabled=function(t){return o.enabled&&t.sameOrigin},i.transportName="htmlfile",i.roundTrips=2,e.exports=i},{"./lib/ajax-based":24,"./receiver/htmlfile":30,"./sender/xhr-local":37,inherits:54}],22:[function(t,e){function i(t,e,n){if(!i.enabled())throw new Error("Transport created when disabled");r.call(this);var o=this;this.origin=a.getOrigin(n),this.baseUrl=n,this.transUrl=e,this.transport=t,this.windowId=c.string(8);var s=a.addPath(n,"/iframe.html")+"#"+this.windowId;this.iframeObj=l.createIframe(s,function(t){o.emit("close",1006,"Unable to load an iframe ("+t+")"),o.close()}),this.onmessageCallback=this._message.bind(this),d.attachEvent("message",this.onmessageCallback)}var n=t("inherits"),o=t("json3"),r=t("events").EventEmitter,s=t("../version"),a=t("../utils/url"),l=t("../utils/iframe"),d=t("../utils/event"),c=t("../utils/random");n(i,r),i.prototype.close=function(){if(this.removeAllListeners(),this.iframeObj){d.detachEvent("message",this.onmessageCallback);try{this.postMessage("c")}catch(t){}this.iframeObj.cleanup(),this.iframeObj=null,this.onmessageCallback=this.iframeObj=null}},i.prototype._message=function(t){if(a.isOriginEqual(t.origin,this.origin)){var e;try{e=o.parse(t.data)}catch(i){return}if(e.windowId===this.windowId)switch(e.type){case"s":this.iframeObj.loaded(),this.postMessage("s",o.stringify([s,this.transport,this.transUrl,this.baseUrl]));break;case"t":this.emit("message",e.data);break;case"c":var n;try{n=o.parse(e.data)}catch(i){return}this.emit("close",n[0],n[1]),this.close()}}},i.prototype.postMessage=function(t,e){
this.iframeObj.post(o.stringify({windowId:this.windowId,type:t,data:e||""}),this.origin)},i.prototype.send=function(t){this.postMessage("m",t)},i.enabled=function(){return l.iframeEnabled},i.transportName="iframe",i.roundTrips=2,e.exports=i},{"../utils/event":46,"../utils/iframe":47,"../utils/random":50,"../utils/url":52,"../version":53,debug:void 0,events:3,inherits:54,json3:55}],23:[function(t,e){(function(i){function n(t){if(!n.enabled())throw new Error("Transport created when disabled");r.call(this,t,"/jsonp",a,s)}var o=t("inherits"),r=t("./lib/sender-receiver"),s=t("./receiver/jsonp"),a=t("./sender/jsonp");o(n,r),n.enabled=function(){return!!i.document},n.transportName="jsonp-polling",n.roundTrips=1,n.needBody=!0,e.exports=n}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./lib/sender-receiver":28,"./receiver/jsonp":31,"./sender/jsonp":33,inherits:54}],24:[function(t,e){function i(t){return function(e,i,n){var o={};"string"==typeof i&&(o.headers={"Content-type":"text/plain"});var s=r.addPath(e,"/xhr_send"),a=new t("POST",s,i,o);return a.once("finish",function(t){return a=null,200!==t&&204!==t?n(new Error("http status "+t)):void n()}),function(){a.close(),a=null;var t=new Error("Aborted");t.code=1e3,n(t)}}}function n(t,e,n,o){s.call(this,t,e,i(o),n,o)}var o=t("inherits"),r=t("../../utils/url"),s=t("./sender-receiver");o(n,s),e.exports=n},{"../../utils/url":52,"./sender-receiver":28,debug:void 0,inherits:54}],25:[function(t,e){function i(t,e){o.call(this),this.sendBuffer=[],this.sender=e,this.url=t}var n=t("inherits"),o=t("events").EventEmitter;n(i,o),i.prototype.send=function(t){this.sendBuffer.push(t),this.sendStop||this.sendSchedule()},i.prototype.sendScheduleWait=function(){var t,e=this;this.sendStop=function(){e.sendStop=null,clearTimeout(t)},t=setTimeout(function(){e.sendStop=null,e.sendSchedule()},25)},i.prototype.sendSchedule=function(){var t=this;if(this.sendBuffer.length>0){var e="["+this.sendBuffer.join(",")+"]";this.sendStop=this.sender(this.url,e,function(e){t.sendStop=null,e?(t.emit("close",e.code||1006,"Sending error: "+e),t._cleanup()):t.sendScheduleWait()}),this.sendBuffer=[]}},i.prototype._cleanup=function(){this.removeAllListeners()},i.prototype.stop=function(){this._cleanup(),this.sendStop&&(this.sendStop(),this.sendStop=null)},e.exports=i},{debug:void 0,events:3,inherits:54}],26:[function(t,e){(function(i){var n=t("inherits"),o=t("../iframe"),r=t("../../utils/object");e.exports=function(t){function e(e,i){o.call(this,t.transportName,e,i)}return n(e,o),e.enabled=function(e,n){if(!i.document)return!1;var s=r.extend({},n);return s.sameOrigin=!0,t.enabled(s)&&o.enabled()},e.transportName="iframe-"+t.transportName,e.needBody=!0,e.roundTrips=o.roundTrips+t.roundTrips-1,e.facadeTransport=t,e}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../utils/object":49,"../iframe":22,inherits:54}],27:[function(t,e){function i(t,e,i){o.call(this),this.Receiver=t,this.receiveUrl=e,this.AjaxObject=i,this._scheduleReceiver()}var n=t("inherits"),o=t("events").EventEmitter;n(i,o),i.prototype._scheduleReceiver=function(){var t=this,e=this.poll=new this.Receiver(this.receiveUrl,this.AjaxObject);e.on("message",function(e){t.emit("message",e)}),e.once("close",function(i,n){t.poll=e=null,t.pollIsClosing||("network"===n?t._scheduleReceiver():(t.emit("close",i||1006,n),t.removeAllListeners()))})},i.prototype.abort=function(){this.removeAllListeners(),this.pollIsClosing=!0,this.poll&&this.poll.abort()},e.exports=i},{debug:void 0,events:3,inherits:54}],28:[function(t,e){function i(t,e,i,n,a){var l=o.addPath(t,e),d=this;r.call(this,t,i),this.poll=new s(n,l,a),this.poll.on("message",function(t){d.emit("message",t)}),this.poll.once("close",function(t,e){d.poll=null,d.emit("close",t,e),d.close()})}var n=t("inherits"),o=t("../../utils/url"),r=t("./buffered-sender"),s=t("./polling");n(i,r),i.prototype.close=function(){this.removeAllListeners(),this.poll&&(this.poll.abort(),this.poll=null),this.stop()},e.exports=i},{"../../utils/url":52,"./buffered-sender":25,"./polling":27,debug:void 0,inherits:54}],29:[function(t,e){function i(t){o.call(this);var e=this,i=this.es=new r(t);i.onmessage=function(t){e.emit("message",decodeURI(t.data))},i.onerror=function(t){var n=2!==i.readyState?"network":"permanent";e._cleanup(),e._close(n)}}var n=t("inherits"),o=t("events").EventEmitter,r=t("eventsource");n(i,o),i.prototype.abort=function(){this._cleanup(),this._close("user")},i.prototype._cleanup=function(){var t=this.es;t&&(t.onmessage=t.onerror=null,t.close(),this.es=null)},i.prototype._close=function(t){var e=this;setTimeout(function(){e.emit("close",null,t),e.removeAllListeners()},200)},e.exports=i},{debug:void 0,events:3,eventsource:18,inherits:54}],30:[function(t,e){(function(i){function n(t){a.call(this);var e=this;r.polluteGlobalNamespace(),this.id="a"+l.string(6),t=s.addQuery(t,"c="+decodeURIComponent(r.WPrefix+"."+this.id));var o=n.htmlfileEnabled?r.createHtmlfile:r.createIframe;i[r.WPrefix][this.id]={start:function(){e.iframeObj.loaded()},message:function(t){e.emit("message",t)},stop:function(){e._cleanup(),e._close("network")}},this.iframeObj=o(t,function(){e._cleanup(),e._close("permanent")})}var o=t("inherits"),r=t("../../utils/iframe"),s=t("../../utils/url"),a=t("events").EventEmitter,l=t("../../utils/random");o(n,a),n.prototype.abort=function(){this._cleanup(),this._close("user")},n.prototype._cleanup=function(){this.iframeObj&&(this.iframeObj.cleanup(),this.iframeObj=null),delete i[r.WPrefix][this.id]},n.prototype._close=function(t){this.emit("close",null,t),this.removeAllListeners()},n.htmlfileEnabled=!1;var d=["Active"].concat("Object").join("X");if(d in i)try{n.htmlfileEnabled=!!new i[d]("htmlfile")}catch(c){}n.enabled=n.htmlfileEnabled||r.iframeEnabled,e.exports=n}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../utils/iframe":47,"../../utils/random":50,"../../utils/url":52,debug:void 0,events:3,inherits:54}],31:[function(t,e){(function(i){function n(t){var e=this;d.call(this),o.polluteGlobalNamespace(),this.id="a"+r.string(6);var s=a.addQuery(t,"c="+encodeURIComponent(o.WPrefix+"."+this.id));i[o.WPrefix][this.id]=this._callback.bind(this),this._createScript(s),this.timeoutId=setTimeout(function(){e._abort(new Error("JSONP script loaded abnormally (timeout)"))},n.timeout)}var o=t("../../utils/iframe"),r=t("../../utils/random"),s=t("../../utils/browser"),a=t("../../utils/url"),l=t("inherits"),d=t("events").EventEmitter;l(n,d),n.prototype.abort=function(){if(i[o.WPrefix][this.id]){var t=new Error("JSONP user aborted read");t.code=1e3,this._abort(t)}},n.timeout=35e3,n.scriptErrorTimeout=1e3,n.prototype._callback=function(t){this._cleanup(),this.aborting||(t&&this.emit("message",t),this.emit("close",null,"network"),this.removeAllListeners())},n.prototype._abort=function(t){this._cleanup(),this.aborting=!0,this.emit("close",t.code,t.message),this.removeAllListeners()},n.prototype._cleanup=function(){if(clearTimeout(this.timeoutId),this.script2&&(this.script2.parentNode.removeChild(this.script2),this.script2=null),this.script){var t=this.script;t.parentNode.removeChild(t),t.onreadystatechange=t.onerror=t.onload=t.onclick=null,this.script=null}delete i[o.WPrefix][this.id]},n.prototype._scriptError=function(){var t=this;this.errorTimer||(this.errorTimer=setTimeout(function(){t.loadedOkay||t._abort(new Error("JSONP script loaded abnormally (onerror)"))},n.scriptErrorTimeout))},n.prototype._createScript=function(t){var e,n=this,o=this.script=i.document.createElement("script");if(o.id="a"+r.string(8),o.src=t,o.type="text/javascript",o.charset="UTF-8",o.onerror=this._scriptError.bind(this),o.onload=function(){n._abort(new Error("JSONP script loaded abnormally (onload)"))},o.onreadystatechange=function(){if(/loaded|closed/.test(o.readyState)){if(o&&o.htmlFor&&o.onclick){n.loadedOkay=!0;try{o.onclick()}catch(t){}}o&&n._abort(new Error("JSONP script loaded abnormally (onreadystatechange)"))}},"undefined"==typeof o.async&&i.document.attachEvent)if(s.isOpera())e=this.script2=i.document.createElement("script"),e.text="try{var a = document.getElementById('"+o.id+"'); if(a)a.onerror();}catch(x){};",o.async=e.async=!1;else{try{o.htmlFor=o.id,o.event="onclick"}catch(a){}o.async=!0}"undefined"!=typeof o.async&&(o.async=!0);var l=i.document.getElementsByTagName("head")[0];l.insertBefore(o,l.firstChild),e&&l.insertBefore(e,l.firstChild)},e.exports=n}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../utils/browser":44,"../../utils/iframe":47,"../../utils/random":50,"../../utils/url":52,debug:void 0,events:3,inherits:54}],32:[function(t,e){function i(t,e){o.call(this);var i=this;this.bufferPosition=0,this.xo=new e("POST",t,null),this.xo.on("chunk",this._chunkHandler.bind(this)),this.xo.once("finish",function(t,e){i._chunkHandler(t,e),i.xo=null;var n=200===t?"network":"permanent";i.emit("close",null,n),i._cleanup()})}var n=t("inherits"),o=t("events").EventEmitter;n(i,o),i.prototype._chunkHandler=function(t,e){if(200===t&&e)for(var i=-1;;this.bufferPosition+=i+1){var n=e.slice(this.bufferPosition);if(i=n.indexOf("\n"),-1===i)break;var o=n.slice(0,i);o&&this.emit("message",o)}},i.prototype._cleanup=function(){this.removeAllListeners()},i.prototype.abort=function(){this.xo&&(this.xo.close(),this.emit("close",null,"user"),this.xo=null),this._cleanup()},e.exports=i},{debug:void 0,events:3,inherits:54}],33:[function(t,e){(function(i){function n(t){try{return i.document.createElement('<iframe name="'+t+'">')}catch(e){var n=i.document.createElement("iframe");return n.name=t,n}}function o(){r=i.document.createElement("form"),r.style.display="none",r.style.position="absolute",r.method="POST",r.enctype="application/x-www-form-urlencoded",r.acceptCharset="UTF-8",s=i.document.createElement("textarea"),s.name="d",r.appendChild(s),i.document.body.appendChild(r)}var r,s,a=t("../../utils/random"),l=t("../../utils/url");e.exports=function(t,e,i){r||o();var d="a"+a.string(8);r.target=d,r.action=l.addQuery(l.addPath(t,"/jsonp_send"),"i="+d);var c=n(d);c.id=d,c.style.display="none",r.appendChild(c);try{s.value=e}catch(u){}r.submit();var h=function(t){c.onerror&&(c.onreadystatechange=c.onerror=c.onload=null,setTimeout(function(){c.parentNode.removeChild(c),c=null},500),s.value="",i(t))};return c.onerror=function(){h()},c.onload=function(){h()},c.onreadystatechange=function(t){"complete"===c.readyState&&h()},function(){h(new Error("Aborted"))}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../utils/random":50,"../../utils/url":52,debug:void 0}],34:[function(t,e){(function(i){function n(t,e,i){var n=this;o.call(this),setTimeout(function(){n._start(t,e,i)},0)}var o=t("events").EventEmitter,r=t("inherits"),s=t("../../utils/event"),a=t("../../utils/browser"),l=t("../../utils/url");r(n,o),n.prototype._start=function(t,e,n){var o=this,r=new i.XDomainRequest;e=l.addQuery(e,"t="+ +new Date),r.onerror=function(){o._error()},r.ontimeout=function(){o._error()},r.onprogress=function(){o.emit("chunk",200,r.responseText)},r.onload=function(){o.emit("finish",200,r.responseText),o._cleanup(!1)},this.xdr=r,this.unloadRef=s.unloadAdd(function(){o._cleanup(!0)});try{this.xdr.open(t,e),this.timeout&&(this.xdr.timeout=this.timeout),this.xdr.send(n)}catch(a){this._error()}},n.prototype._error=function(){this.emit("finish",0,""),this._cleanup(!1)},n.prototype._cleanup=function(t){if(this.xdr){if(this.removeAllListeners(),s.unloadDel(this.unloadRef),this.xdr.ontimeout=this.xdr.onerror=this.xdr.onprogress=this.xdr.onload=null,t)try{this.xdr.abort()}catch(e){}this.unloadRef=this.xdr=null}},n.prototype.close=function(){this._cleanup(!0)},n.enabled=!(!i.XDomainRequest||!a.hasDomain()),e.exports=n}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../utils/browser":44,"../../utils/event":46,"../../utils/url":52,debug:void 0,events:3,inherits:54}],35:[function(t,e){function i(t,e,i,n){o.call(this,t,e,i,n)}var n=t("inherits"),o=t("../driver/xhr");n(i,o),i.enabled=o.enabled&&o.supportsCORS,e.exports=i},{"../driver/xhr":17,inherits:54}],36:[function(t,e){function i(){var t=this;n.call(this),this.to=setTimeout(function(){t.emit("finish",200,"{}")},i.timeout)}var n=t("events").EventEmitter,o=t("inherits");o(i,n),i.prototype.close=function(){clearTimeout(this.to)},i.timeout=2e3,e.exports=i},{events:3,inherits:54}],37:[function(t,e){function i(t,e,i){o.call(this,t,e,i,{noCredentials:!0})}var n=t("inherits"),o=t("../driver/xhr");n(i,o),i.enabled=o.enabled,e.exports=i},{"../driver/xhr":17,inherits:54}],38:[function(t,e){function i(t){if(!i.enabled())throw new Error("Transport created when disabled");s.call(this);var e=this,r=o.addPath(t,"/websocket");r="https"===r.slice(0,5)?"wss"+r.slice(5):"ws"+r.slice(4),this.url=r,this.ws=new a(this.url),this.ws.onmessage=function(t){e.emit("message",t.data)},this.unloadRef=n.unloadAdd(function(){e.ws.close()}),this.ws.onclose=function(t){e.emit("close",t.code,t.reason),e._cleanup()},this.ws.onerror=function(t){e.emit("close",1006,"WebSocket connection broken"),e._cleanup()}}var n=t("../utils/event"),o=t("../utils/url"),r=t("inherits"),s=t("events").EventEmitter,a=t("./driver/websocket");r(i,s),i.prototype.send=function(t){var e="["+t+"]";this.ws.send(e)},i.prototype.close=function(){this.ws&&this.ws.close(),this._cleanup()},i.prototype._cleanup=function(){var t=this.ws;t&&(t.onmessage=t.onclose=t.onerror=null),n.unloadDel(this.unloadRef),this.unloadRef=this.ws=null,this.removeAllListeners()},i.enabled=function(){return!!a},i.transportName="websocket",i.roundTrips=2,e.exports=i},{"../utils/event":46,"../utils/url":52,"./driver/websocket":19,debug:void 0,events:3,inherits:54}],39:[function(t,e){function i(t){if(!a.enabled)throw new Error("Transport created when disabled");o.call(this,t,"/xhr",s,a)}var n=t("inherits"),o=t("./lib/ajax-based"),r=t("./xdr-streaming"),s=t("./receiver/xhr"),a=t("./sender/xdr");n(i,o),i.enabled=r.enabled,i.transportName="xdr-polling",i.roundTrips=2,e.exports=i},{"./lib/ajax-based":24,"./receiver/xhr":32,"./sender/xdr":34,"./xdr-streaming":40,inherits:54}],40:[function(t,e){function i(t){if(!s.enabled)throw new Error("Transport created when disabled");o.call(this,t,"/xhr_streaming",r,s)}var n=t("inherits"),o=t("./lib/ajax-based"),r=t("./receiver/xhr"),s=t("./sender/xdr");n(i,o),i.enabled=function(t){return t.cookie_needed||t.nullOrigin?!1:s.enabled&&t.sameScheme},i.transportName="xdr-streaming",i.roundTrips=2,e.exports=i},{"./lib/ajax-based":24,"./receiver/xhr":32,"./sender/xdr":34,inherits:54}],41:[function(t,e){function i(t){if(!a.enabled&&!s.enabled)throw new Error("Transport created when disabled");o.call(this,t,"/xhr",r,s)}var n=t("inherits"),o=t("./lib/ajax-based"),r=t("./receiver/xhr"),s=t("./sender/xhr-cors"),a=t("./sender/xhr-local");n(i,o),i.enabled=function(t){return t.nullOrigin?!1:a.enabled&&t.sameOrigin?!0:s.enabled},i.transportName="xhr-polling",i.roundTrips=2,e.exports=i},{"./lib/ajax-based":24,"./receiver/xhr":32,"./sender/xhr-cors":35,"./sender/xhr-local":37,inherits:54}],42:[function(t,e){(function(i){function n(t){if(!l.enabled&&!a.enabled)throw new Error("Transport created when disabled");r.call(this,t,"/xhr_streaming",s,a)}var o=t("inherits"),r=t("./lib/ajax-based"),s=t("./receiver/xhr"),a=t("./sender/xhr-cors"),l=t("./sender/xhr-local"),d=t("../utils/browser");o(n,r),n.enabled=function(t){return t.nullOrigin?!1:d.isOpera()?!1:a.enabled},n.transportName="xhr-streaming",n.roundTrips=2,n.needBody=!!i.document,e.exports=n}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../utils/browser":44,"./lib/ajax-based":24,"./receiver/xhr":32,"./sender/xhr-cors":35,"./sender/xhr-local":37,inherits:54}],43:[function(t,e){(function(t){e.exports.randomBytes=t.crypto&&t.crypto.getRandomValues?function(e){var i=new Uint8Array(e);return t.crypto.getRandomValues(i),i}:function(t){for(var e=new Array(t),i=0;t>i;i++)e[i]=Math.floor(256*Math.random());return e}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],44:[function(t,e){(function(t){e.exports={isOpera:function(){return t.navigator&&/opera/i.test(t.navigator.userAgent)},isKonqueror:function(){return t.navigator&&/konqueror/i.test(t.navigator.userAgent)},hasDomain:function(){if(!t.document)return!0;try{return!!t.document.domain}catch(e){return!1}}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],45:[function(t,e){var i,n=t("json3"),o=/[\x00-\x1f\ud800-\udfff\ufffe\uffff\u0300-\u0333\u033d-\u0346\u034a-\u034c\u0350-\u0352\u0357-\u0358\u035c-\u0362\u0374\u037e\u0387\u0591-\u05af\u05c4\u0610-\u0617\u0653-\u0654\u0657-\u065b\u065d-\u065e\u06df-\u06e2\u06eb-\u06ec\u0730\u0732-\u0733\u0735-\u0736\u073a\u073d\u073f-\u0741\u0743\u0745\u0747\u07eb-\u07f1\u0951\u0958-\u095f\u09dc-\u09dd\u09df\u0a33\u0a36\u0a59-\u0a5b\u0a5e\u0b5c-\u0b5d\u0e38-\u0e39\u0f43\u0f4d\u0f52\u0f57\u0f5c\u0f69\u0f72-\u0f76\u0f78\u0f80-\u0f83\u0f93\u0f9d\u0fa2\u0fa7\u0fac\u0fb9\u1939-\u193a\u1a17\u1b6b\u1cda-\u1cdb\u1dc0-\u1dcf\u1dfc\u1dfe\u1f71\u1f73\u1f75\u1f77\u1f79\u1f7b\u1f7d\u1fbb\u1fbe\u1fc9\u1fcb\u1fd3\u1fdb\u1fe3\u1feb\u1fee-\u1fef\u1ff9\u1ffb\u1ffd\u2000-\u2001\u20d0-\u20d1\u20d4-\u20d7\u20e7-\u20e9\u2126\u212a-\u212b\u2329-\u232a\u2adc\u302b-\u302c\uaab2-\uaab3\uf900-\ufa0d\ufa10\ufa12\ufa15-\ufa1e\ufa20\ufa22\ufa25-\ufa26\ufa2a-\ufa2d\ufa30-\ufa6d\ufa70-\ufad9\ufb1d\ufb1f\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufb4e\ufff0-\uffff]/g,r=function(t){var e,i={},n=[];for(e=0;65536>e;e++)n.push(String.fromCharCode(e));return t.lastIndex=0,n.join("").replace(t,function(t){return i[t]="\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4),""}),t.lastIndex=0,i};e.exports={quote:function(t){var e=n.stringify(t);return o.lastIndex=0,o.test(e)?(i||(i=r(o)),e.replace(o,function(t){return i[t]})):e}}},{json3:55}],46:[function(t,e){(function(i){var n=t("./random"),o={},r=!1,s=i.chrome&&i.chrome.app&&i.chrome.app.runtime;e.exports={attachEvent:function(t,e){"undefined"!=typeof i.addEventListener?i.addEventListener(t,e,!1):i.document&&i.attachEvent&&(i.document.attachEvent("on"+t,e),i.attachEvent("on"+t,e))},detachEvent:function(t,e){"undefined"!=typeof i.addEventListener?i.removeEventListener(t,e,!1):i.document&&i.detachEvent&&(i.document.detachEvent("on"+t,e),i.detachEvent("on"+t,e))},unloadAdd:function(t){if(s)return null;var e=n.string(8);return o[e]=t,r&&setTimeout(this.triggerUnloadCallbacks,0),e},unloadDel:function(t){t in o&&delete o[t]},triggerUnloadCallbacks:function(){for(var t in o)o[t](),delete o[t]}};var a=function(){r||(r=!0,e.exports.triggerUnloadCallbacks())};s||e.exports.attachEvent("unload",a)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./random":50}],47:[function(t,e){(function(i){var n=t("./event"),o=t("json3"),r=t("./browser");e.exports={WPrefix:"_jp",currentWindowId:null,polluteGlobalNamespace:function(){e.exports.WPrefix in i||(i[e.exports.WPrefix]={})},postMessage:function(t,n){i.parent!==i&&i.parent.postMessage(o.stringify({windowId:e.exports.currentWindowId,type:t,data:n||""}),"*")},createIframe:function(t,e){var o,r,s=i.document.createElement("iframe"),a=function(){clearTimeout(o);try{s.onload=null}catch(t){}s.onerror=null},l=function(){s&&(a(),setTimeout(function(){s&&s.parentNode.removeChild(s),s=null},0),n.unloadDel(r))},d=function(t){s&&(l(),e(t))},c=function(t,e){try{s&&s.contentWindow&&setTimeout(function(){s.contentWindow.postMessage(t,e)},0)}catch(i){}};return s.src=t,s.style.display="none",s.style.position="absolute",s.onerror=function(){d("onerror")},s.onload=function(){clearTimeout(o),o=setTimeout(function(){d("onload timeout")},2e3)},i.document.body.appendChild(s),o=setTimeout(function(){d("timeout")},15e3),r=n.unloadAdd(l),{post:c,cleanup:l,loaded:a}},createHtmlfile:function(t,o){var r,s,a,l=["Active"].concat("Object").join("X"),d=new i[l]("htmlfile"),c=function(){clearTimeout(r),a.onerror=null},u=function(){d&&(c(),n.unloadDel(s),a.parentNode.removeChild(a),a=d=null,CollectGarbage())},h=function(t){d&&(u(),o(t))},p=function(t,e){try{a&&a.contentWindow&&setTimeout(function(){a.contentWindow.postMessage(t,e)},0)}catch(i){}};d.open(),d.write('<html><script>document.domain="'+i.document.domain+'";</script></html>'),d.close(),d.parentWindow[e.exports.WPrefix]=i[e.exports.WPrefix];var f=d.createElement("div");return d.body.appendChild(f),a=d.createElement("iframe"),f.appendChild(a),a.src=t,a.onerror=function(){h("onerror")},r=setTimeout(function(){h("timeout")},15e3),s=n.unloadAdd(u),{post:p,cleanup:u,loaded:c}}},e.exports.iframeEnabled=!1,i.document&&(e.exports.iframeEnabled=("function"==typeof i.postMessage||"object"==typeof i.postMessage)&&!r.isKonqueror())}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./browser":44,"./event":46,debug:void 0,json3:55}],48:[function(t,e){(function(t){var i={};["log","debug","warn"].forEach(function(e){var n=t.console&&t.console[e]&&t.console[e].apply;i[e]=n?function(){return t.console[e].apply(t.console,arguments)}:"log"===e?function(){}:i.log}),e.exports=i}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],49:[function(t,e){e.exports={isObject:function(t){var e=typeof t;return"function"===e||"object"===e&&!!t},extend:function(t){if(!this.isObject(t))return t;for(var e,i,n=1,o=arguments.length;o>n;n++){e=arguments[n];for(i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t}}},{}],50:[function(t,e){var i=t("crypto"),n="abcdefghijklmnopqrstuvwxyz012345";e.exports={string:function(t){for(var e=n.length,o=i.randomBytes(t),r=[],s=0;t>s;s++)r.push(n.substr(o[s]%e,1));return r.join("")},number:function(t){return Math.floor(Math.random()*t)},numberString:function(t){var e=(""+(t-1)).length,i=new Array(e+1).join("0");return(i+this.number(t)).slice(-e)}}},{crypto:43}],51:[function(t,e){e.exports=function(t){return{filterToEnabled:function(e,i){var n={main:[],facade:[]};return e?"string"==typeof e&&(e=[e]):e=[],t.forEach(function(t){t&&("websocket"!==t.transportName||i.websocket!==!1)&&(e.length&&-1===e.indexOf(t.transportName)||t.enabled(i)&&(n.main.push(t),t.facadeTransport&&n.facade.push(t.facadeTransport)))}),n}}}},{debug:void 0}],52:[function(t,e){var i=t("url-parse");e.exports={getOrigin:function(t){if(!t)return null;var e=new i(t);if("file:"===e.protocol)return null;var n=e.port;return n||(n="https:"===e.protocol?"443":"80"),e.protocol+"//"+e.hostname+":"+n},isOriginEqual:function(t,e){var i=this.getOrigin(t)===this.getOrigin(e);return i},isSchemeEqual:function(t,e){return t.split(":")[0]===e.split(":")[0]},addPath:function(t,e){var i=t.split("?");return i[0]+e+(i[1]?"?"+i[1]:"")},addQuery:function(t,e){return t+(-1===t.indexOf("?")?"?"+e:"&"+e)}}},{debug:void 0,"url-parse":56}],53:[function(t,e){e.exports="1.0.1"},{}],54:[function(t,e){e.exports="function"==typeof Object.create?function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:function(t,e){t.super_=e;var i=function(){};i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=t}},{}],55:[function(e,i,n){(function(e){(function(){function o(t,e){function i(t){if(i[t]!==b)return i[t];var o;if("bug-string-char-index"==t)o="a"!="a"[0];else if("json"==t)o=i("json-stringify")&&i("json-parse");else{var s,a='{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}';if("json-stringify"==t){var l=e.stringify,c="function"==typeof l&&v;if(c){(s=function(){return 1}).toJSON=s;try{c="0"===l(0)&&"0"===l(new n)&&'""'==l(new r)&&l(g)===b&&l(b)===b&&l()===b&&"1"===l(s)&&"[1]"==l([s])&&"[null]"==l([b])&&"null"==l(null)&&"[null,null,null]"==l([b,g,null])&&l({a:[s,!0,!1,null,"\x00\b\n\f\r	"]})==a&&"1"===l(null,s)&&"[\n 1,\n 2\n]"==l([1,2],null,1)&&'"-271821-04-20T00:00:00.000Z"'==l(new d(-864e13))&&'"+275760-09-13T00:00:00.000Z"'==l(new d(864e13))&&'"-000001-01-01T00:00:00.000Z"'==l(new d(-621987552e5))&&'"1969-12-31T23:59:59.999Z"'==l(new d(-1))}catch(u){c=!1}}o=c}if("json-parse"==t){var h=e.parse;if("function"==typeof h)try{if(0===h("0")&&!h(!1)){s=h(a);var p=5==s.a.length&&1===s.a[0];if(p){try{p=!h('"	"')}catch(u){}if(p)try{p=1!==h("01")}catch(u){}if(p)try{p=1!==h("1.")}catch(u){}}}}catch(u){p=!1}o=p}}return i[t]=!!o}t||(t=l.Object()),e||(e=l.Object());var n=t.Number||l.Number,r=t.String||l.String,a=t.Object||l.Object,d=t.Date||l.Date,c=t.SyntaxError||l.SyntaxError,u=t.TypeError||l.TypeError,h=t.Math||l.Math,p=t.JSON||l.JSON;"object"==typeof p&&p&&(e.stringify=p.stringify,e.parse=p.parse);var f,m,b,_=a.prototype,g=_.toString,v=new d(-0xc782b5b800cec);try{v=-109252==v.getUTCFullYear()&&0===v.getUTCMonth()&&1===v.getUTCDate()&&10==v.getUTCHours()&&37==v.getUTCMinutes()&&6==v.getUTCSeconds()&&708==v.getUTCMilliseconds()}catch(y){}if(!i("json")){var w="[object Function]",E="[object Date]",C="[object Number]",T="[object String]",k="[object Array]",S="[object Boolean]",$=i("bug-string-char-index");if(!v)var P=h.floor,x=[0,31,59,90,120,151,181,212,243,273,304,334],R=function(t,e){return x[e]+365*(t-1970)+P((t-1969+(e=+(e>1)))/4)-P((t-1901+e)/100)+P((t-1601+e)/400)};if((f=_.hasOwnProperty)||(f=function(t){var e,i={};return(i.__proto__=null,i.__proto__={toString:1},i).toString!=g?f=function(t){var e=this.__proto__,i=t in(this.__proto__=null,this);return this.__proto__=e,i}:(e=i.constructor,f=function(t){var i=(this.constructor||e).prototype;return t in this&&!(t in i&&this[t]===i[t])}),i=null,f.call(this,t)}),m=function(t,e){var i,n,o,r=0;(i=function(){this.valueOf=0}).prototype.valueOf=0,n=new i;for(o in n)f.call(n,o)&&r++;return i=n=null,r?m=2==r?function(t,e){var i,n={},o=g.call(t)==w;for(i in t)o&&"prototype"==i||f.call(n,i)||!(n[i]=1)||!f.call(t,i)||e(i)}:function(t,e){var i,n,o=g.call(t)==w;for(i in t)o&&"prototype"==i||!f.call(t,i)||(n="constructor"===i)||e(i);(n||f.call(t,i="constructor"))&&e(i)}:(n=["valueOf","toString","toLocaleString","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","constructor"],m=function(t,e){var i,o,r=g.call(t)==w,a=!r&&"function"!=typeof t.constructor&&s[typeof t.hasOwnProperty]&&t.hasOwnProperty||f;for(i in t)r&&"prototype"==i||!a.call(t,i)||e(i);for(o=n.length;i=n[--o];a.call(t,i)&&e(i));}),m(t,e)},!i("json-stringify")){var A={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"},O="000000",M=function(t,e){return(O+(e||0)).slice(-t)},N="\\u00",I=function(t){for(var e='"',i=0,n=t.length,o=!$||n>10,r=o&&($?t.split(""):t);n>i;i++){var s=t.charCodeAt(i);switch(s){case 8:case 9:case 10:case 12:case 13:case 34:case 92:e+=A[s];break;default:if(32>s){e+=N+M(2,s.toString(16));break}e+=o?r[i]:t.charAt(i)}}return e+'"'},D=function(t,e,i,n,o,r,s){var a,l,d,c,h,p,_,v,y,w,$,x,A,O,N,B;try{a=e[t]}catch(L){}if("object"==typeof a&&a)if(l=g.call(a),l!=E||f.call(a,"toJSON"))"function"==typeof a.toJSON&&(l!=C&&l!=T&&l!=k||f.call(a,"toJSON"))&&(a=a.toJSON(t));else if(a>-1/0&&1/0>a){if(R){for(h=P(a/864e5),d=P(h/365.2425)+1970-1;R(d+1,0)<=h;d++);for(c=P((h-R(d,0))/30.42);R(d,c+1)<=h;c++);h=1+h-R(d,c),p=(a%864e5+864e5)%864e5,_=P(p/36e5)%24,v=P(p/6e4)%60,y=P(p/1e3)%60,w=p%1e3}else d=a.getUTCFullYear(),c=a.getUTCMonth(),h=a.getUTCDate(),_=a.getUTCHours(),v=a.getUTCMinutes(),y=a.getUTCSeconds(),w=a.getUTCMilliseconds();a=(0>=d||d>=1e4?(0>d?"-":"+")+M(6,0>d?-d:d):M(4,d))+"-"+M(2,c+1)+"-"+M(2,h)+"T"+M(2,_)+":"+M(2,v)+":"+M(2,y)+"."+M(3,w)+"Z"}else a=null;if(i&&(a=i.call(e,t,a)),null===a)return"null";if(l=g.call(a),l==S)return""+a;if(l==C)return a>-1/0&&1/0>a?""+a:"null";if(l==T)return I(""+a);if("object"==typeof a){for(O=s.length;O--;)if(s[O]===a)throw u();if(s.push(a),$=[],N=r,r+=o,l==k){for(A=0,O=a.length;O>A;A++)x=D(A,a,i,n,o,r,s),$.push(x===b?"null":x);B=$.length?o?"[\n"+r+$.join(",\n"+r)+"\n"+N+"]":"["+$.join(",")+"]":"[]"}else m(n||a,function(t){var e=D(t,a,i,n,o,r,s);e!==b&&$.push(I(t)+":"+(o?" ":"")+e)}),B=$.length?o?"{\n"+r+$.join(",\n"+r)+"\n"+N+"}":"{"+$.join(",")+"}":"{}";return s.pop(),B}};e.stringify=function(t,e,i){var n,o,r,a;if(s[typeof e]&&e)if((a=g.call(e))==w)o=e;else if(a==k){r={};for(var l,d=0,c=e.length;c>d;l=e[d++],a=g.call(l),(a==T||a==C)&&(r[l]=1));}if(i)if((a=g.call(i))==C){if((i-=i%1)>0)for(n="",i>10&&(i=10);n.length<i;n+=" ");}else a==T&&(n=i.length<=10?i:i.slice(0,10));return D("",(l={},l[""]=t,l),o,r,n,"",[])}}if(!i("json-parse")){var B,L,F=r.fromCharCode,U={92:"\\",34:'"',47:"/",98:"\b",116:"	",110:"\n",102:"\f",114:"\r"},j=function(){throw B=L=null,c()},V=function(){for(var t,e,i,n,o,r=L,s=r.length;s>B;)switch(o=r.charCodeAt(B)){case 9:case 10:case 13:case 32:B++;break;case 123:case 125:case 91:case 93:case 58:case 44:return t=$?r.charAt(B):r[B],B++,t;case 34:for(t="@",B++;s>B;)if(o=r.charCodeAt(B),32>o)j();else if(92==o)switch(o=r.charCodeAt(++B)){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:t+=U[o],B++;break;case 117:for(e=++B,i=B+4;i>B;B++)o=r.charCodeAt(B),o>=48&&57>=o||o>=97&&102>=o||o>=65&&70>=o||j();t+=F("0x"+r.slice(e,B));break;default:j()}else{if(34==o)break;for(o=r.charCodeAt(B),e=B;o>=32&&92!=o&&34!=o;)o=r.charCodeAt(++B);t+=r.slice(e,B)}if(34==r.charCodeAt(B))return B++,t;j();default:if(e=B,45==o&&(n=!0,o=r.charCodeAt(++B)),o>=48&&57>=o){for(48==o&&(o=r.charCodeAt(B+1),o>=48&&57>=o)&&j(),n=!1;s>B&&(o=r.charCodeAt(B),o>=48&&57>=o);B++);if(46==r.charCodeAt(B)){for(i=++B;s>i&&(o=r.charCodeAt(i),o>=48&&57>=o);i++);i==B&&j(),B=i}if(o=r.charCodeAt(B),101==o||69==o){for(o=r.charCodeAt(++B),(43==o||45==o)&&B++,i=B;s>i&&(o=r.charCodeAt(i),o>=48&&57>=o);i++);i==B&&j(),B=i}return+r.slice(e,B)}if(n&&j(),"true"==r.slice(B,B+4))return B+=4,!0;if("false"==r.slice(B,B+5))return B+=5,!1;if("null"==r.slice(B,B+4))return B+=4,null;j()}return"$"},G=function(t){var e,i;if("$"==t&&j(),"string"==typeof t){if("@"==($?t.charAt(0):t[0]))return t.slice(1);if("["==t){for(e=[];t=V(),"]"!=t;i||(i=!0))i&&(","==t?(t=V(),"]"==t&&j()):j()),","==t&&j(),e.push(G(t));return e}if("{"==t){for(e={};t=V(),"}"!=t;i||(i=!0))i&&(","==t?(t=V(),"}"==t&&j()):j()),(","==t||"string"!=typeof t||"@"!=($?t.charAt(0):t[0])||":"!=V())&&j(),e[t.slice(1)]=G(V());return e}j()}return t},K=function(t,e,i){var n=H(t,e,i);n===b?delete t[e]:t[e]=n},H=function(t,e,i){var n,o=t[e];if("object"==typeof o&&o)if(g.call(o)==k)for(n=o.length;n--;)K(o,n,i);else m(o,function(t){K(o,t,i)});return i.call(t,e,o)};e.parse=function(t,e){var i,n;return B=0,L=""+t,i=G(V()),"$"!=V()&&j(),B=L=null,e&&g.call(e)==w?H((n={},n[""]=i,n),"",e):i}}}return e.runInContext=o,e}var r="function"==typeof t&&t.amd,s={"function":!0,object:!0},a=s[typeof n]&&n&&!n.nodeType&&n,l=s[typeof window]&&window||this,d=a&&s[typeof i]&&i&&!i.nodeType&&"object"==typeof e&&e;if(!d||d.global!==d&&d.window!==d&&d.self!==d||(l=d),a&&!r)o(l,a);else{var c=l.JSON,u=l.JSON3,h=!1,p=o(l,l.JSON3={noConflict:function(){return h||(h=!0,l.JSON=c,l.JSON3=u,c=u=null),p}});l.JSON={parse:p.parse,stringify:p.stringify}}r&&t(function(){return p})}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],56:[function(t,e){function i(t,e,l){if(!(this instanceof i))return new i(t,e,l);var d,c,u,h,p=s.test(t),f=typeof e,m=this,b=0;for("object"!==f&&"string"!==f&&(l=e,e=null),l&&"function"!=typeof l&&(l=r.parse),e=o(e);b<a.length;b++)c=a[b],d=c[0],h=c[1],d!==d?m[h]=t:"string"==typeof d?~(u=t.indexOf(d))&&("number"==typeof c[2]?(m[h]=t.slice(0,u),t=t.slice(u+c[2])):(m[h]=t.slice(u),t=t.slice(0,u))):(u=d.exec(t))&&(m[h]=u[1],t=t.slice(0,t.length-u[0].length)),
m[h]=m[h]||(c[3]||"port"===h&&p?e[h]||"":""),c[4]&&(m[h]=m[h].toLowerCase());l&&(m.query=l(m.query)),n(m.port,m.protocol)||(m.host=m.hostname,m.port=""),m.username=m.password="",m.auth&&(c=m.auth.split(":"),m.username=c[0]||"",m.password=c[1]||""),m.href=m.toString()}var n=t("requires-port"),o=t("./lolcation"),r=t("querystringify"),s=/^\/(?!\/)/,a=[["#","hash"],["?","query"],["//","protocol",2,1,1],["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/\:(\d+)$/,"port"],[NaN,"hostname",void 0,1,1]];i.prototype.set=function(t,e,i){var o=this;return"query"===t?("string"==typeof e&&(e=(i||r.parse)(e)),o[t]=e):"port"===t?(o[t]=e,n(e,o.protocol)?e&&(o.host=o.hostname+":"+e):(o.host=o.hostname,o[t]="")):"hostname"===t?(o[t]=e,o.port&&(e+=":"+o.port),o.host=e):"host"===t?(o[t]=e,/\:\d+/.test(e)&&(e=e.split(":"),o.hostname=e[0],o.port=e[1])):o[t]=e,o.href=o.toString(),o},i.prototype.toString=function(t){t&&"function"==typeof t||(t=r.stringify);var e,i=this,n=i.protocol+"//";return i.username&&(n+=i.username,i.password&&(n+=":"+i.password),n+="@"),n+=i.hostname,i.port&&(n+=":"+i.port),n+=i.pathname,i.query&&(e="object"==typeof i.query?t(i.query):i.query,n+=("?"===e.charAt(0)?"":"?")+e),i.hash&&(n+=i.hash),n},i.qs=r,i.location=o,e.exports=i},{"./lolcation":57,querystringify:58,"requires-port":59}],57:[function(t,e){(function(i){var n,o={hash:1,query:1};e.exports=function(e){e=e||i.location||{},n=n||t("./");var r,s={},a=typeof e;if("blob:"===e.protocol)s=new n(unescape(e.pathname),{});else if("string"===a){s=new n(e,{});for(r in o)delete s[r]}else if("object"===a)for(r in e)r in o||(s[r]=e[r]);return s}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./":56}],58:[function(t,e,i){function n(t){for(var e,i=/([^=?&]+)=([^&]*)/g,n={};e=i.exec(t);n[decodeURIComponent(e[1])]=decodeURIComponent(e[2]));return n}function o(t,e){e=e||"";var i=[];"string"!=typeof e&&(e="?");for(var n in t)r.call(t,n)&&i.push(encodeURIComponent(n)+"="+encodeURIComponent(t[n]));return i.length?e+i.join("&"):""}var r=Object.prototype.hasOwnProperty;i.stringify=o,i.parse=n},{}],59:[function(t,e){e.exports=function(t,e){if(e=e.split(":")[0],t=+t,!t)return!1;switch(e){case"http":case"ws":return 80!==t;case"https":case"wss":return 443!==t;case"ftp":return 22!==t;case"gopher":return 70!==t;case"file":return!1}return 0!==t}},{}]},{},[1])(1)}),function(){var t,e,i,n,o={}.hasOwnProperty,r=[].slice;t={LF:"\n",NULL:"\x00"},i=function(){function e(t,e,i){this.command=t,this.headers=null!=e?e:{},this.body=null!=i?i:""}var i;return e.prototype.toString=function(){var i,n,r,s,a;i=[this.command],r=this.headers["content-length"]===!1,r&&delete this.headers["content-length"],a=this.headers;for(n in a)o.call(a,n)&&(s=a[n],i.push(""+n+":"+s));return this.body&&!r&&i.push("content-length:"+e.sizeOfUTF8(this.body)),i.push(t.LF+this.body),i.join(t.LF)},e.sizeOfUTF8=function(t){return t?encodeURI(t).match(/%..|./g).length:0},i=function(i){var n,o,r,s,a,l,d,c,u,h,p,f,m,b,_,g,v;for(s=i.search(RegExp(""+t.LF+t.LF)),a=i.substring(0,s).split(t.LF),r=a.shift(),l={},f=function(t){return t.replace(/^\s+|\s+$/g,"")},g=a.reverse(),m=0,_=g.length;_>m;m++)h=g[m],c=h.indexOf(":"),l[f(h.substring(0,c))]=f(h.substring(c+1));if(n="",p=s+2,l["content-length"])u=parseInt(l["content-length"]),n=(""+i).substring(p,p+u);else for(o=null,d=b=p,v=i.length;(v>=p?v>b:b>v)&&(o=i.charAt(d),o!==t.NULL);d=v>=p?++b:--b)n+=o;return new e(r,l,n)},e.unmarshall=function(e){var n,o,r,s;return o=e.split(RegExp(""+t.NULL+t.LF+"*")),s={frames:[],partial:""},s.frames=function(){var t,e,r,s;for(r=o.slice(0,-1),s=[],t=0,e=r.length;e>t;t++)n=r[t],s.push(i(n));return s}(),r=o.slice(-1)[0],r===t.LF||-1!==r.search(RegExp(""+t.NULL+t.LF+"*$"))?s.frames.push(i(r)):s.partial=r,s},e.marshall=function(i,n,o){var r;return r=new e(i,n,o),r.toString()+t.NULL},e}(),e=function(){function e(t){this.ws=t,this.ws.binaryType="arraybuffer",this.counter=0,this.connected=!1,this.heartbeat={outgoing:1e4,incoming:1e4},this.maxWebSocketFrameSize=16384,this.subscriptions={},this.partialData=""}var o;return e.prototype.debug=function(t){var e;return"undefined"!=typeof window&&null!==window&&null!=(e=window.console)?e.log(t):void 0},o=function(){return Date.now?Date.now():(new Date).valueOf},e.prototype._transmit=function(t,e,n){var o;for(o=i.marshall(t,e,n),"function"==typeof this.debug&&this.debug(">>> "+o);;){if(!(o.length>this.maxWebSocketFrameSize))return this.ws.send(o);this.ws.send(o.substring(0,this.maxWebSocketFrameSize)),o=o.substring(this.maxWebSocketFrameSize),"function"==typeof this.debug&&this.debug("remaining = "+o.length)}},e.prototype._setupHeartbeat=function(e){var i,r,s,a,l,d;if((l=e.version)===n.VERSIONS.V1_1||l===n.VERSIONS.V1_2)return d=function(){var t,i,n,o;for(n=e["heart-beat"].split(","),o=[],t=0,i=n.length;i>t;t++)a=n[t],o.push(parseInt(a));return o}(),r=d[0],i=d[1],0!==this.heartbeat.outgoing&&0!==i&&(s=Math.max(this.heartbeat.outgoing,i),"function"==typeof this.debug&&this.debug("send PING every "+s+"ms"),this.pinger=n.setInterval(s,function(e){return function(){return e.ws.send(t.LF),"function"==typeof e.debug?e.debug(">>> PING"):void 0}}(this))),0!==this.heartbeat.incoming&&0!==r?(s=Math.max(this.heartbeat.incoming,r),"function"==typeof this.debug&&this.debug("check PONG every "+s+"ms"),this.ponger=n.setInterval(s,function(t){return function(){var e;return e=o()-t.serverActivity,e>2*s?("function"==typeof t.debug&&t.debug("did not receive server activity for the last "+e+"ms"),t.ws.close()):void 0}}(this))):void 0},e.prototype._parseConnect=function(){var t,e,i,n;switch(t=1<=arguments.length?r.call(arguments,0):[],n={},t.length){case 2:n=t[0],e=t[1];break;case 3:t[1]instanceof Function?(n=t[0],e=t[1],i=t[2]):(n.login=t[0],n.passcode=t[1],e=t[2]);break;case 4:n.login=t[0],n.passcode=t[1],e=t[2],i=t[3];break;default:n.login=t[0],n.passcode=t[1],e=t[2],i=t[3],n.host=t[4]}return[n,e,i]},e.prototype.connect=function(){var e,s,a,l;return e=1<=arguments.length?r.call(arguments,0):[],l=this._parseConnect.apply(this,e),a=l[0],this.connectCallback=l[1],s=l[2],"function"==typeof this.debug&&this.debug("Opening Web Socket..."),this.ws.onmessage=function(e){return function(n){var r,a,l,d,c,u,h,p,f,m,b,_,g;if(d="undefined"!=typeof ArrayBuffer&&n.data instanceof ArrayBuffer?(r=new Uint8Array(n.data),"function"==typeof e.debug?e.debug("--- got data length: "+r.length):void 0,function(){var t,e,i;for(i=[],t=0,e=r.length;e>t;t++)a=r[t],i.push(String.fromCharCode(a));return i}().join("")):n.data,e.serverActivity=o(),d===t.LF)return void("function"==typeof e.debug&&e.debug("<<< PONG"));for("function"==typeof e.debug&&e.debug("<<< "+d),f=i.unmarshall(e.partialData+d),e.partialData=f.partial,_=f.frames,g=[],m=0,b=_.length;b>m;m++)switch(c=_[m],c.command){case"CONNECTED":"function"==typeof e.debug&&e.debug("connected to server "+c.headers.server),e.connected=!0,e._setupHeartbeat(c.headers),g.push("function"==typeof e.connectCallback?e.connectCallback(c):void 0);break;case"MESSAGE":p=c.headers.subscription,h=e.subscriptions[p]||e.onreceive,h?(l=e,u=c.headers["message-id"],c.ack=function(t){return null==t&&(t={}),l.ack(u,p,t)},c.nack=function(t){return null==t&&(t={}),l.nack(u,p,t)},g.push(h(c))):g.push("function"==typeof e.debug?e.debug("Unhandled received MESSAGE: "+c):void 0);break;case"RECEIPT":g.push("function"==typeof e.onreceipt?e.onreceipt(c):void 0);break;case"ERROR":g.push("function"==typeof s?s(c):void 0);break;default:g.push("function"==typeof e.debug?e.debug("Unhandled frame: "+c):void 0)}return g}}(this),this.ws.onclose=function(t){return function(){var e;return e="Whoops! Lost connection to "+t.ws.url,"function"==typeof t.debug&&t.debug(e),t._cleanUp(),"function"==typeof s?s(e):void 0}}(this),this.ws.onopen=function(t){return function(){return"function"==typeof t.debug&&t.debug("Web Socket Opened..."),a["accept-version"]=n.VERSIONS.supportedVersions(),a["heart-beat"]=[t.heartbeat.outgoing,t.heartbeat.incoming].join(","),t._transmit("CONNECT",a)}}(this)},e.prototype.disconnect=function(t,e){return null==e&&(e={}),this._transmit("DISCONNECT",e),this.ws.onclose=null,this.ws.close(),this._cleanUp(),"function"==typeof t?t():void 0},e.prototype._cleanUp=function(){return this.connected=!1,this.pinger&&n.clearInterval(this.pinger),this.ponger?n.clearInterval(this.ponger):void 0},e.prototype.send=function(t,e,i){return null==e&&(e={}),null==i&&(i=""),e.destination=t,this._transmit("SEND",e,i)},e.prototype.subscribe=function(t,e,i){var n;return null==i&&(i={}),i.id||(i.id="sub-"+this.counter++),i.destination=t,this.subscriptions[i.id]=e,this._transmit("SUBSCRIBE",i),n=this,{id:i.id,unsubscribe:function(){return n.unsubscribe(i.id)}}},e.prototype.unsubscribe=function(t){return delete this.subscriptions[t],this._transmit("UNSUBSCRIBE",{id:t})},e.prototype.begin=function(t){var e,i;return i=t||"tx-"+this.counter++,this._transmit("BEGIN",{transaction:i}),e=this,{id:i,commit:function(){return e.commit(i)},abort:function(){return e.abort(i)}}},e.prototype.commit=function(t){return this._transmit("COMMIT",{transaction:t})},e.prototype.abort=function(t){return this._transmit("ABORT",{transaction:t})},e.prototype.ack=function(t,e,i){return null==i&&(i={}),i["message-id"]=t,i.subscription=e,this._transmit("ACK",i)},e.prototype.nack=function(t,e,i){return null==i&&(i={}),i["message-id"]=t,i.subscription=e,this._transmit("NACK",i)},e}(),n={VERSIONS:{V1_0:"1.0",V1_1:"1.1",V1_2:"1.2",supportedVersions:function(){return"1.1,1.0"}},client:function(t,i){var o,r;return null==i&&(i=["v10.stomp","v11.stomp"]),o=n.WebSocketClass||WebSocket,r=new o(t,i),new e(r)},over:function(t){return new e(t)},Frame:i},"undefined"!=typeof exports&&null!==exports&&(exports.Stomp=n),"undefined"!=typeof window&&null!==window?(n.setInterval=function(t,e){return window.setInterval(e,t)},n.clearInterval=function(t){return window.clearInterval(t)},window.Stomp=n):exports||(self.Stomp=n)}.call(this),define("stomp",function(t){return function(){var e;return e||t.Stomp}}(this)),define("service/rabbitmqWebStompService",["core/subscriber","sockjs","stomp"],function(t,e,i){var n=function(){t.prototype.constructor.apply(this),this.ws=null,this.client=null,this.bind__messageCallback=this._messageCallback.bind(this)};return n.extend(t),n.Event={CONNECTED:"eventConnected",DISCONNECTED:"eventDisconnected",MESSAGE:"eventMessage"},n.prototype.isConnected=function(){return this.ws&&this.client},n.prototype.connect=function(){if(!this.isConnected()){this.ws=new e(window.location.protocol+"//"+window.location.hostname+"/stomp"),this.client=i.over(this.ws),this.client.heartbeat.incoming=0,this.client.heartbeat.outgoing=0;var t=function(){this._dispatch(n.Event.CONNECTED)}.bind(this),o=function(t){console.error(t)};this.client.connect("test","test",t,o,"/")}},n.prototype.disconnect=function(){this.client.disconnect(function(){this._dispatch(n.Event.DISCONNECTED)}.bind(this)),this.client=null,this.ws=null},n.prototype._messageCallback=function(t){console.log(t),this._dispatch(n.Event.MESSAGE,{message:JSON.parse(t.body)})},n.prototype.subscribe=function(e,i,n){return t.prototype.subscribe.call(this,i,n),e?this.client.subscribe(e,this.bind__messageCallback):void 0},n.prototype.unsubscribe=function(e,i){t.prototype.unsubscribe.call(this,i),e&&this.client.unsubscribe(e.id)},n}),define("service/subscriberService",["core/subscriber"],function(t){var e=function(){t.prototype.constructor.apply(this)};return e.extend(t),e.prototype.dispatch=function(e,i,n){n=n||{},n.tag=e,t.prototype._dispatch.call(this,i,n)},e}),define("service/threadPostService",["core/subscriber","underscore"],function(t){var e=function(){t.prototype.constructor.apply(this),this.name="ThreadPost"};return e.extend(t),e.Event={ADD:"eventAdd",REPLACE:"eventUpdate",REMOVE:"eventRemove"},e.prototype.subscribe=function(i){_.each(e.Event,function(e,n,o){t.prototype.subscribe.call(this,e,i)}.bind(this))},e.prototype.dispatch=function(e,i){t.prototype._dispatch.call(this,e,i)},e}),define("model/forumModel",["model/model","model/mediaModel","extra"],function(t,e){var i=function(i){t.prototype.constructor.apply(this,arguments),this.data.ordered_media&&this.data.ordered_media.forEach(function(t,i,n){n[i]=new e(t)})};return i.extend(t),i}),define("model/groupModel",["model/model","model/mediaModel","extra"],function(t,e){var i=function(i){t.prototype.constructor.apply(this,arguments),this.data.ordered_media&&this.data.ordered_media.forEach(function(t,i,n){n[i]=new e(t)})};return i.extend(t),i}),define("model/messageModel",["model/model","model/mediaModel","extra"],function(t,e){var i=function(i){t.prototype.constructor.apply(this,arguments),this.data.ordered_media&&this.data.ordered_media.forEach(function(t,i,n){n[i]=new e(t)})};return i.extend(t),i}),define("model/myFilesModel",["model/model","model/mediaModel","extra","underscore"],function(t,e){var i=function(i){if(t.prototype.constructor.apply(this,arguments),this.data.media){var n=this.data.media;this.data.media=[],_.each(n,function(i,n,o){var r=new e(i);r.subscribe(t.Event.CHANGE,function(e){var i=_.findIndex(this.data.media,e.model);i>-1&&this._dispatch(t.Event.CHANGE,"media."+i)}.bind(this)),this.data.media.push(r)},this),n=null}};return i.extend(t),i.prototype.addMedia=function(i){var n=new e(i);n.subscribe(t.Event.CHANGE,function(e){var i=_.findIndex(this.data.media,e.model);i>-1&&this._dispatch(t.Event.CHANGE,"media."+i)}.bind(this)),this.data.media.push(n)},i.prototype.getMedia=function(t){return _.find(this.data.media,function(e){return e.get("id")==t})},i}),define("model/profileModel",["model/model","extra"],function(t){var e=function(e){t.prototype.constructor.apply(this,arguments)};return e.extend(t),e}),define("model/threadModel",["model/model","model/postModel","extra","underscore"],function(t,e){var i=function(i){t.prototype.constructor.apply(this,arguments),this.data.keyPoints=[],this.data.posts&&this.data.posts.forEach(function(t,i,n){n[i]=new e(t)})};return i.extend(t),i.prototype.addKeyPoint=function(e){this.removeKeyPoint(e.id),this.data.keyPoints.push(e),this._dispatch(t.Event.CHANGE,"keyPoints."+(this.data.keyPoints.length-1))},i.prototype._findKeyPoint=function(t){for(var e in this.data.keyPoints)if(this.data.keyPoints[e].id==t)return e},i.prototype.setKeyPointProperty=function(t,e,i,n){var o=this._findKeyPoint(t);o>-1&&this.set("keyPoints."+o+"."+e,i,n)},i.prototype.removeKeyPoint=function(e){var i=this._findKeyPoint(e);i>-1&&(this.data.keyPoints.splice(i,1),this._dispatch(t.Event.CHANGE,"keyPoints"))},i.prototype.forceChangeKeyPoint=function(t,e){var i=this._findKeyPoint(t);i>-1&&this.forceChange("keyPoints."+i+"."+e)},i.prototype.addPost=function(t,e){var i=this.get("posts",[]);this.set("posts."+i.length,t,!1),this.forceChange("posts."+(i.length-1),{isNew:!0,view:e})},i.prototype.removePost=function(t,e){var i=this.get("posts"),n=this.find(t.get("id"),"id",i);if(n>-1){i.splice(n,1);var o=[];_.each(i,function(e,i,n){e.get("parent_post_id")==t.get("id")&&o.push(e)}),this.set("posts",_.difference(i,o))}},i.prototype.forceChangePost=function(t,e){var i=this.find(t.get("id"),"id",this.get("posts"));i>-1&&this.forceChange("posts."+i,{view:e})},i}),define("model/userModel",["model/model","extra","underscore"],function(t){var e=function(e){t.prototype.constructor.apply(this,arguments)};return e.extend(t),e.prototype.isUserOnFriendsList=function(t){return _.contains(this.get("friends_list"),t)},e.prototype.isUserOnMentorList=function(t){return _.contains(this.get("mentor_list"),t)},e.prototype.isUserOnMenteeList=function(t){return _.contains(this.get("mentee_list"),t)},e.prototype.isUserOnInvitedMentorList=function(t){var e=_.find(this.get("created_invitations"),function(e){return!(e.recipient!=t||e.isMentor||e.isAccepted||e.isCancelled||e.isDeclined)});return"undefined"!==e},e.prototype.isUserOnInvitedMenteeList=function(t){var e=_.find(this.get("created_invitations"),function(e){return!(e.recipient!=t||e.isMentee||e.isAccepted||e.isCancelled||e.isDeclined)});return"undefined"!==e},e}),define("controller/contactController",["factory/contactFactory"],function(t){var e=function(t,i){console.log("%s: %s- model=%o, options=%o",e.TAG,"constructor",t,i),this.model=t,this.options=i,$tt._instances.push(this)};return e.TAG="Contact",e.prototype.onViewLoaded=function(){},e.prototype["delete"]=function(e,i){return t["delete"](e,i).done(function(t){window.location.reload(!0)})},e}),define("controller/forumController",["factory/forumFactory"],function(t){var e=function(t,i){console.log("%s: %s- model=%o, options=%o",e.TAG,"constructor",t,i),this.model=t,this.options=i,$tt._instances.push(this)};return e.TAG="Forum",e.prototype.onViewLoaded=function(){},e.prototype["delete"]=function(){return t["delete"](this.model).done(function(t){window.location.assign(t.redirect_url)})},e}),define("controller/groupController",["factory/groupFactory"],function(t){var e=function(t,i){console.log("%s: %s- model=%o, options=%o",e.TAG,"constructor",t,i),this.model=t,this.options=i,$tt._instances.push(this)};return e.TAG="Group",e.prototype.onViewLoaded=function(){},e.prototype["delete"]=function(){return t["delete"](this.model).done(function(t){window.location.assign(t.redirect_url)})},e}),define("controller/homeController",[],function(){var t=function(e,i){console.log("%s: %s- model=%o, options=%o",t.TAG,"constructor",e,i),this.model=e,this.options=i,$tt._instances.push(this)};return t.TAG="Home",t.prototype.onViewLoaded=function(){},t}),define("controller/messageController",["factory/messageFactory"],function(t){var e=function(t,i){console.log("%s: %s- model=%o, options=%o",e.TAG,"constructor",t,i),this.model=t,this.options=i,$tt._instances.push(this)};return e.TAG="Message",e.prototype.onViewLoaded=function(){this.model.get("id")&&this.markAsRead()},e.prototype.markAsRead=function(){return t.edit(this.model)},e}),define("controller/myFilesController",["factory/mediaFactory"],function(t){var e=function(t,i){console.log("%s: %s- model=%o, options=%o",e.TAG,"constructor",t,i),this.model=t,this.options=i,$tt._instances.push(this)};return e.TAG="MyFiles",e.prototype.onViewLoaded=function(){},e.prototype.edit=function(e,i){var n=this.model.getMedia(e);if(!n)throw new Error("media not found");return Object.keys(i).forEach(function(t,e,o){n.set(t,i[t])}),t.edit(n)},e.prototype["delete"]=function(e,i){var n=this.model.getMedia(e);if(!n)throw new Error("media not found");return t["delete"](n,i)},e}),define("controller/postController",["factory/postFactory","service","service/keyPointService","service/threadPostService"],function(t,e,i,n){var o=function(t,i){console.log("%s: %s- model=%o, options=%o",o.TAG,"constructor",t,i),this.model=t,this.options=i,this.keyPointService=e.get("keyPoint"),this.threadPostService=e.get("threadPost"),this.model.set("keyPoint",new KeyPoint(this.model.get("id"),this.model.get("start_time"),this.model.get("end_time"),"",{drawOnTimeLine:this.model.get("is_temporal",!1)})),this.bind__onKeyPointEvent=this._onKeyPointEvent.bind(this),this.bind__onThreadPostEvent=this._onThreadPostEvent.bind(this),$tt._instances.push(this)};return o.TAG="Post",o.prototype._onKeyPointEvent=function(t){switch(t.type){case i.Event.DURATION:this.model.set("keyPoint.videoDuration",t.duration);break;case i.Event.SELECTION_TIMES:this.model.set("keyPoint.selection",t.selection);break;case i.Event.HOVER:case i.Event.CLICK:this.model.forceChange()}},o.prototype._onThreadPostEvent=function(t){switch(t.type){case n.Event.REMOVE:t.post.get("id")<0&&t.post.get("parent_post_id")==this.model.get("id")&&this.model.forceChange()}},o.prototype.onViewLoaded=function(){this.addKeyPoint(),this.threadPostService.subscribe(this.bind__onThreadPostEvent)},o.prototype.addKeyPoint=function(){var t=this.model.get("keyPoint");this.keyPointService.register(t),this.keyPointService.subscribe(t.id,this.bind__onKeyPointEvent),this.keyPointService.dispatch(t.id,i.Event.ADD)},o.prototype.hoverKeyPoint=function(t){this.model.set("keyPoint.isHovering",t.isMouseOver),this.keyPointService.dispatch(this.model.get("keyPoint.id"),i.Event.HOVER,t)},o.prototype.clickKeyPoint=function(t){var e="keyPoint."+(t.isDblClick?"isPlaying":"isSeeking");this.model.set(e,!0),setTimeout(function(){this.model.set(e,!1,!1)}.bind(this),100),this.keyPointService.dispatch(this.model.get("keyPoint.id"),i.Event.CLICK,t)},o.prototype.editKeyPoint=function(t){this.keyPointService.dispatch(this.model.get("keyPoint.id"),i.Event.EDIT,t)},o.prototype.removeKeyPoint=function(){var t=this.model.get("keyPoint");this.keyPointService.dispatch(t.id,i.Event.REMOVE),this.keyPointService.unsubscribe(t.id,this.bind__onKeyPointEvent),this.keyPointService.deregister(t.id)},o.prototype.addToThread=function(t){this.threadPostService.dispatch(n.Event.ADD,{post:t})},o.prototype.updateInThread=function(t){this.threadPostService.dispatch(n.Event.REPLACE,{post:this.model,view:t})},o.prototype.removeFromThread=function(){this.threadPostService.dispatch(n.Event.REMOVE,{post:this.model})},o.prototype["new"]=function(){return t["new"](this.model)},o.prototype.post=function(e){return t.post(this.model,e)},o.prototype.get=function(){return t.get(this.model)},o.prototype.edit=function(){return t.edit(this.model)},o.prototype.put=function(e){return t.put(this.model,e)},o.prototype["delete"]=function(){return t["delete"](this.model).done(function(t){this.removeKeyPoint()}.bind(this))},o}),define("controller/profileController",[],function(){var t=function(e,i){console.log("%s: %s- model=%o, options=%o",t.TAG,"constructor",e,i),this.model=e,this.options=i,$tt._instances.push(this)};return t.TAG="Profile",t.prototype.onViewLoaded=function(){},t}),define("controller/threadController",["factory/threadFactory","service","service/keyPointService","service/threadPostService"],function(t,e,i,n){var o=function(t,i){console.log("%s: %s- model=%o, options=%o",o.TAG,"constructor",t,i),this.model=t,this.options=i,this.keyPointService=e.get("keyPoint"),this.threadPostService=e.get("threadPost"),this.videoSpeed=0,this.bind__onKeyPointEvent=this._onKeyPointEvent.bind(this),this.bind__onThreadPostEvent=this._onThreadPostEvent.bind(this),this.keyPointService.subscribe("all",this.bind__onKeyPointEvent),this.threadPostService.subscribe(this.bind__onThreadPostEvent),$tt._instances.push(this)};return o.TAG="Thread",o.prototype._onKeyPointEvent=function(t){switch(t.type){case i.Event.ADD:this.model.addKeyPoint(t.keyPoint);break;case i.Event.HOVER:case i.Event.CLICK:this.model.forceChangeKeyPoint(t.keyPoint.id);break;case i.Event.EDIT:if(!t.cancel){this.model.setKeyPointProperty(t.keyPoint.id,"options.drawOnTimeLine",!1),this.model.setKeyPointProperty(t.keyPoint.id,"isEditing",!0);break}case i.Event.REMOVE:this.model.setKeyPointProperty(t.keyPoint.id,"isEditing",!1),this.model.setKeyPointProperty(t.keyPoint.id,"options.drawOnTimeLine",!0),t.type==i.Event.REMOVE&&this.model.removeKeyPoint(t.keyPoint.id)}},o.prototype._onThreadPostEvent=function(t){switch(t.type){case n.Event.ADD:this.model.addPost(t.post,t.post.get("id")<0?"new":"view");break;case n.Event.REPLACE:this.model.forceChangePost(t.post,t.view);break;case n.Event.REMOVE:this.model.removePost(t.post)}},o.prototype.onViewLoaded=function(){},o.prototype.updateKeyPointDuration=function(t){isNaN(t)||this.keyPointService.dispatch("all",i.Event.DURATION,{duration:t})},o.prototype.updateKeyPointSelectionTimes=function(t){this.keyPointService.dispatch("all",i.Event.SELECTION_TIMES,{selection:{startTime:parseFloat(t.minTime).toFixed(2),endTime:parseFloat(t.maxTime).toFixed(2)}})},o.prototype.hoverKeyPoint=function(t,e){this.model.setKeyPointProperty(t,"isPlayerHovering",e.isMouseOver),this.keyPointService.dispatch(t,i.Event.HOVER,e)},o.prototype.rightClickKeyPoint=function(t){this.model.setKeyPointProperty(t,"isPlayerPlaying",!0),setTimeout(function(){this.model.setKeyPointProperty(t,"isPlayerPlaying",!1,!1)}.bind(this),100),this.keyPointService.dispatch(t,i.Event.CLICK,{which:"right"})},o.prototype.adjustVideoSpeed=function(){switch(this.videoSpeed=(this.videoSpeed+1)%3,this.videoSpeed){case 0:return{value:1,image:this.options.player.speedImages.normal};case 1:return{value:2,image:this.options.player.speedImages.fast};case 2:return{value:.5,image:this.options.player.speedImages.slow};default:return{value:1,image:this.options.player.speedImages.normal}}},o.prototype["delete"]=function(){return t["delete"](this.model).done(function(t){window.location.assign(t.redirect_url)})},o}),define("component/accessTypeComponent",[],function(){var t=function(t){this.options=t,this.typeToFieldMap=[{filter:'[value="4"]',fields:["accessType_data_users"]},{filter:'[value="6"]',fields:["group"]}],this.bind__onChangeAccessType=this._onChangeAccessType.bind(this),this.$container=this.options.$container,this.$accessTypes=this.$container.find("input:radio"),this.$accessTypes.on("change",this.bind__onChangeAccessType),this.$accessTypes.filter(":checked").trigger("change")};return t.TAG="AccessTypeComponent",t.prototype._getFormField=function(t){return this.$container.find('[id$="_'+t+'"]')},t.prototype._onChangeAccessType=function(t){var e=$(t.target),i=function(t,i){var n=i.parent();e.attr("id")==t.attr("id")?(n.find("label").addClass("required"),i.attr("required",!0),n.children().show()):(n.find("label").removeClass("required"),i.attr("required",!1),n.children().hide())};$.each(this.typeToFieldMap,function(t,e){var n=this.$accessTypes.filter(e.filter);$.each(e.fields,function(t,e){i(n,this._getFormField(e))}.bind(this))}.bind(this))},t.render=function(e,i){var n={};i=i||n;for(var o in n)i[o]="undefined"!=typeof i[o]?i[o]:n[o];return i.$container=e,new t(i)},t}),define("component/tableComponent",["core/subscriber","extra"],function(t){var e=function(i){t.prototype.constructor.apply(this),this.options=i,this.bind__onClickToggleSelection=this._onClickToggleSelection.bind(this),this.bind__onClickBulkAction=this._onClickBulkAction.bind(this),this.bind__onChangeItems=this._onChangeItems.bind(this),this.$table=this.options.$table,this.$toggleSelection=this.$table.find(e.Binder.TOGGLE_SELECTION),this.$bulkActions=this.$table.find(e.Binder.BULK_ACTION),this.$items=this.$table.find(e.Binder.ITEM),this.setMultiSelect(this.options.multiSelect),this.$toggleSelection.on("click",this.bind__onClickToggleSelection),this.$bulkActions.on("click",this.bind__onClickBulkAction),this.$items.on("change",this.bind__onChangeItems)};return e.extend(t),e.TAG="TableComponent",e.Binder={TOGGLE_SELECTION:".table-component-toggle-selection",BULK_ACTION:".table-component-bulk-action",ITEM:"input.table-component-item:not([disabled])"},e.Event={SELECTION_CHANGE:"eventSelectionChange",CLICK_BULK_ACTION:"eventClickBulkAction"},e.prototype.updateElements=function(t){this.$items.off("change"),this.$table=t,this.$items=this.$table.find(e.Binder.ITEM),this.$items.on("change",this.bind__onChangeItems)},e.prototype._dispatchToggleEvent=function(t){var i=this.getSelection();this._dispatch(e.Event.SELECTION_CHANGE,{$selection:i,tableComponent:this,parentEvent:t})},e.prototype._onClickToggleSelection=function(t){this.$items.prop("checked",$(t.target).is('input[type="checkbox"]')?t.target.checked:0==this.getSelection().length),this._dispatchToggleEvent(t)},e.prototype._onClickBulkAction=function(t){var i=$(t.currentTarget);this._dispatch(e.Event.CLICK_BULK_ACTION,{$bulkAction:i,action:i.data("action"),$selection:this.getSelection(),tableComponent:this,parentEvent:t})},e.prototype._onChangeItems=function(t){var i=t.target.checked;this.options.multiSelect||this.$items.prop("checked",!1),t.target.checked=i;var n=this.getSelection();this._dispatch(e.Event.SELECTION_CHANGE,{$selection:n,tableComponent:this,parentEvent:t});var o=n.length==this.$items.length;this.$toggleSelection.prop("checked",o),o&&this._dispatchToggleEvent(t)},e.prototype.setMultiSelect=function(t){this.options.multiSelect=t,this.$toggleSelection.attr("disabled",!this.options.multiSelect)},e.prototype.getTable=function(){return this.$table},e.prototype.getBulkActions=function(){return this.$bulkActions},e.prototype.getSelection=function(){return this.$items.filter(":checked")},e.table=function(t,i){var n={multiSelect:!0};i=i||n;for(var o in n)i[o]="undefined"!=typeof i[o]?i[o]:n[o];return i.$table=t,new e(i)},e}),define("component/myFilesSelectorComponent",["core/subscriber","service","component/tableComponent","factory/mediaFactory","extra"],function(t,e,i,n){var o=function(i){t.prototype.constructor.apply(this),this.options=i,this.bind__onShownModal=this._onShownModal.bind(this),this.bind__onHiddenModal=this._onHiddenModal.bind(this),this.bind__onLoadPageSuccess=this._onLoadPageSuccess.bind(this),this.bind__onLoadPageError=this._onLoadPageError.bind(this),this.bind__onClickSelectSelected=this._onClickSelectSelected.bind(this),this.bind__onMyFilesListViewViewLoaded=this._onMyFilesListViewViewLoaded.bind(this),this.bind__onSelectionChange=this._onSelectionChange.bind(this),this.$container=this.options.$container,this.$modalDialog=this.$container.find(o.Binder.MODAL_DIALOG),this.$selectSelected=this.$container.find(o.Binder.SELECT_SELECTED),this.$modalDialog.modal({backdrop:"static",show:!1}),this.$modalDialog.on("shown.bs.modal",this.bind__onShownModal),this.$modalDialog.on("hidden.bs.modal",this.bind__onHiddenModal),this.$selectSelected.on("click",this.bind__onClickSelectSelected);var n=e.get("subscriber");n.subscribe("onViewLoaded",this.bind__onMyFilesListViewViewLoaded)};return o.extend(t),o.TAG="MyFilesSelectorComponent",o.Binder={MODAL_DIALOG:".my-files-selector-modal",SELECT_SELECTED:".my-files-selector-select-selected"},o.Event={DONE:"eventDone",HIDDEN:"eventHidden"},o.prototype._onSelectionChange=function(t){this.$selectSelected.attr("disabled",0==t.$selection.length)},o.prototype._onMyFilesListViewViewLoaded=function(t){var e=require("views/myFiles/listView");if(t.tag===e.TAG){this.tblCmp=t.view.getTableComponent(),this.tblCmp.setMultiSelect(this.options.multiSelect),this.tblCmp.subscribe(i.Event.SELECTION_CHANGE,this.bind__onSelectionChange);var n=function(t){t.preventDefault(),this._loadPage($(t.currentTarget).attr("href"))}.bind(this);this.$modalDialog.find(e.Binder.TOGGLE_STYLE).on("click",n),this.$modalDialog.find("ul.pagination li a").on("click",n)}},o.prototype._onLoadPageSuccess=function(t,e,i){this.$modalDialog.find(".modal-body").html(t.page)},o.prototype._onLoadPageError=function(t,e,i){console.log(t)},o.prototype._makeUrl=function(t){if("undefined"==typeof t)return Routing.generate("imdc_myfiles_list",this.options.filter);for(var e in this.filter)t+=(t.substr("?")?"&":"?")+e+"="+this.options.filter[e];return t},o.prototype._loadPage=function(t){$.ajax({url:this._makeUrl(t),success:this.bind__onLoadPageSuccess,error:this.bind__onLoadPageError})},o.prototype._onShownModal=function(t){this._loadPage()},o.prototype._onHiddenModal=function(t){this._dispatch(o.Event.HIDDEN,{myFilesSelectorComponent:this})},o.prototype._onClickSelectSelected=function(t){t.preventDefault(),this.$selectSelected.button("loading");var e=this.tblCmp.getSelection(),i=[];this.options.multiSelect?e.each(function(t,e){i.push($(e).data("mid"))}):i.push(e.first().data("mid")),n.list(i).done(function(t){this._dispatch(o.Event.DONE,{media:t.media,myFilesSelectorComponent:this})}.bind(this)).fail(function(t){this.$selectSelected.button("reset"),console.error("%s: media factory list",o.TAG)}.bind(this))},o.prototype.show=function(){this.$modalDialog.modal("show")},o.prototype.hide=function(){this.$modalDialog.modal("hide")},o.prototype.destroy=function(){this.$modalDialog.remove()},o.render=function(t,e){var i={$container:$("body"),multiSelect:!0,filter:{}};t=t||i;for(var n in i)t[n]="undefined"!=typeof t[n]?t[n]:i[n];dust.render("myFilesSelector",{},function(i,n){t.$container.append(n);var r=new o(t);e.call(r,{myFilesSelectorComponent:r})})},o}),define("component/recorderComponent",["core/subscriber","service","component/myFilesSelectorComponent","model/mediaModel","factory/mediaFactory","factory/myFilesFactory","service/rabbitmqWebStompService","core/helper","extra"],function(t,e,i,n,o,r,s,a){
var l=function(i){t.prototype.constructor.apply(this),this.options=i,this.isOnNormalTab=this.options.tab==l.Tab.NORMAL,this.isOnInterpTab=this.options.tab==l.Tab.INTERPRETATION,this.isInRecordMode=this.options.mode==l.Mode.RECORD,this.isInEditMode=this.options.mode==l.Mode.PREVIEW,this.player=null,this.recorder=null,this.currentRecording=null,this.currentTrim=null,this.sourceMedia=null,this.recordedMedia=null,this.messages=[],this.rabbitmqWebStompService=e.get("rabbitmqWebStomp"),this.isDonePostponed=!1,this.doPost=!1,this.forwardButton='<button class="forwardButton"></button>',this.doneButton='<button class="doneButton"></button>',this.doneAndPostButton='<button class="doneAndPostButton"></button>',this.backButton='<button class="backButton"></button>',this.bind__onShownModal=this._onShownModal.bind(this),this.bind__onShowModal=this._onShowModal.bind(this),this.bind__onHiddenModal=this._onHiddenModal.bind(this),this.bind__onShowTab=this._onShowTab.bind(this),this.bind__onShownTab=this._onShownTab.bind(this),this.bind__onBlurPlayerTitle=this._onBlurPlayerTitle.bind(this),this.bind__onClickInterpSelect=this._onClickInterpSelect.bind(this),this.bind__onPageAnimate=this._onPageAnimate.bind(this),this.bind__onRecordingStarted=this._onRecordingStarted.bind(this),this.bind__onRecordingStopped=this._onRecordingStopped.bind(this),this.bind__onClickTrim=this._onClickTrim.bind(this),this.bind__onClickBack=this._onClickBack.bind(this),this.bind__onClickDone=this._onClickDone.bind(this),this.bind__onClickDoneAndPost=this._onClickDoneAndPost.bind(this),this.$container=this.options.$container,this.$modalDialog=this.$container.find(l.Binder.MODAL_DIALOG),this.$tabPanes=this.$container.find(l.Binder.TAB_PANES),this.$containerRecord=this.$container.find(l.Binder.CONTAINER_RECORD),this.$normalTitle=this.$container.find(l.Binder.NORMAL_TITLE),this.$normalVideo=this.$container.find(l.Binder.NORMAL_VIDEO),this.$interpSelect=this.$container.find(l.Binder.INTERP_SELECT),this.$interpMain=this.$container.find(l.Binder.INTERP_MAIN),this.$interpVideoP=this.$container.find(l.Binder.INTERP_VIDEO_P),this.$interpTitle=this.$container.find(l.Binder.INTERP_TITLE),this.$interpVideoR=this.$container.find(l.Binder.INTERP_VIDEO_R),this.$controls=this.$container.find(l.Binder.CONTROLS),this.$containerUpload=this.$container.find(l.Binder.CONTAINER_UPLOAD);var n=this.isOnNormalTab?l.Binder.NORMAL:l.Binder.INTERP;this.$modalDialog.find('a[href!="'+n+'"]').parent().removeClass("active"),this.$modalDialog.find('a[href="'+n+'"]').parent().addClass("active"),this.$modalDialog.find('.tab-pane:not("'+n+'")').removeClass("active"),this.$modalDialog.find(".tab-pane"+n).addClass("active"),this.$modalDialog.modal({backdrop:"static",show:!1}),this.$modalDialog.on("shown.bs.modal",this.bind__onShownModal),this.$modalDialog.on("show.bs.modal",this.bind__onShowModal),this.$modalDialog.on("hidden.bs.modal",this.bind__onHiddenModal),this.$tabPanes.on("show.bs.tab",this.bind__onShowTab),this.$tabPanes.on("shown.bs.tab",this.bind__onShownTab),this.$interpSelect.on("click",this.bind__onClickInterpSelect),this.isInEditMode&&(this.$normalTitle.blur(this.bind__onBlurPlayerTitle),this.$interpTitle.blur(this.bind__onBlurPlayerTitle)),this._clearCurrents(),this._setupRabbitmq(),this.isInEditMode&&this.$modalDialog.find('a[href="'+l.Binder.INTERP+'"]').hide()};return l.extend(t),l.TAG="RecorderComponent",l.MAX_RECORDING_TIME=720,l.Binder={MODAL_DIALOG:".recorder-modal",TAB_PANES:'a[data-toggle="tab"]',NORMAL:".recorder-normal",INTERP:".recorder-interp",CONTAINER_RECORD:".recorder-container-record",NORMAL_TITLE:".recorder-normal-title",NORMAL_VIDEO:".recorder-normal-video",INTERP_SELECT:".recorder-interp-select",INTERP_MAIN:".recorder-interp-main",INTERP_VIDEO_P:".recorder-interp-video-p",INTERP_TITLE:".recorder-interp-title",INTERP_VIDEO_R:".recorder-interp-video-r",CONTROLS:".recorder-controls",CONTAINER_UPLOAD:".recorder-container-upload"},l.Tab={NORMAL:0,INTERPRETATION:1},l.Mode={RECORD:0,PREVIEW:1},l.Event={DONE:"eventDone",HIDDEN:"eventHidden"},l.prototype._setupRabbitmq=function(){this.bind__onMessage=function(t){console.log(t.message),this.messages.push(t.message),this._checkMessages()}.bind(this),this.bind__onConnect=function(t){this.subscription=this.rabbitmqWebStompService.subscribe("/exchange/"+window.parameters.prefix+"entity-status",s.Event.MESSAGE,this.bind__onMessage)}.bind(this),this.rabbitmqWebStompService.isConnected()?this.bind__onConnect(null):(this.rabbitmqWebStompService.subscribe(null,s.Event.CONNECTED,this.bind__onConnect),this.rabbitmqWebStompService.connect())},l.prototype._cleanupRabbitmq=function(){this.rabbitmqWebStompService.unsubscribe(this.subscription,this.bind__onMessage),this.rabbitmqWebStompService.unsubscribe(null,this.bind__onConnect)},l.prototype._createPlayer=function(t,e){console.log("%s: %s",l.TAG,"_createPlayer"),t="undefined"!=typeof t?t:!1,e="undefined"!=typeof e?e:!1;var i=[],n=[];(this.isOnNormalTab||t)&&(i.push(this.doneButton),n.push(t?this.bind__onClickTrim:this.bind__onClickDone)),this.options.enableDoneAndPost&&t&&(i.push(this.doneAndPostButton),n.push(this.bind__onClickDoneAndPost));var o,r;t&&e&&(o=[this.backButton],r=[this.bind__onClickBack]);var s=this.isOnNormalTab?this.$normalVideo:t?this.$interpVideoR:this.$interpVideoP,a=new Player(s,{areaSelectionEnabled:t,audioBar:!1,updateTimeType:Player.DENSITY_BAR_UPDATE_TYPE_RELATIVE,controlBarElement:this.$controls,forwardButtons:i,forwardFunctions:n,backButtons:o,backFunctions:r,selectedRegionColor:"#0000ff"});a.createControls(),$(a.elementID).find(".videoControlsContainer.controlsBar.doneButton").eq(0).attr("title",Translator.trans("player.previewing.doneButton")),$(a.elementID).find(".videoControlsContainer.controlsBar.doneAndPostButton").eq(0).attr("title",Translator.trans("player.previewing.doneAndPostButton")),$(a.elementID).find(".videoControlsContainer.controlsBar.backButton").eq(0).attr("title",Translator.trans("player.previewing.backToRecordingButton")),t?this.recorder=a:this.player=a},l.prototype._onClickTrim=function(t){console.log("%s: %s",l.TAG,"_onClickTrim"),t.preventDefault();var e=this.recorder.getCurrentMinMaxTime(),i=this.recorder.getAreaSelectionTimes();this.recorder.setCurrentMinMaxTime(i.minTime,i.maxTime),console.log("Current Min/Max Times %s %s",i.minTime,i.maxTime),console.log("Cutting to Min/Max Times %s %s",i.minTime-e.minTime,i.maxTime-e.minTime),this.currentTrim={startTime:i.minTime-e.minTime,endTime:i.maxTime-e.minTime},this._onClickDone(t)},l.prototype._onClickBack=function(t){console.log("%s: %s",l.TAG,"_onClickBack"),t.preventDefault(),this._destroyPlayers(),this._clearCurrents(),this.setRecordedMedia(null),this.options.mode=l.Mode.RECORD,this.isOnInterpTab&&this._createPlayer(),this._createRecorder()},l.prototype._createRecorder=function(){console.log("%s: %s",l.TAG,"_createRecorder");var t=this.isOnNormalTab?this.$normalVideo:this.$interpVideoR;this.recorder=new Player(t,{areaSelectionEnabled:!1,audioBar:!1,updateTimeType:Player.DENSITY_BAR_UPDATE_TYPE_ABSOLUTE,controlBarElement:this.$controls,type:Player.DENSITY_BAR_TYPE_RECORDER,volumeControl:!1,maxRecordingTime:l.MAX_RECORDING_TIME}),$(this.recorder).on(Player.EVENT_RECORDING_STARTED,this.bind__onRecordingStarted),$(this.recorder).on(Player.EVENT_RECORDING_STOPPED,this.bind__onRecordingStopped),this.recorder.createControls(),$(this.recorder.elementID).find(".videoControlsContainer.controlsBar.videoControls.recordButton").eq(0).attr("title",Translator.trans("player.recording.recordingButton")),$(this.recorder.elementID).find(".videoControlsContainer.controlsBar.forwardButton").eq(0).attr("title",Translator.trans("player.recording.forwardButton")),$(this.recorder.elementID).find(".videoControlsContainer.controlsBar.doneButton").eq(0).attr("title",Translator.trans("player.recording.doneButton")),$(this.recorder.elementID).find(".videoControlsContainer.controlsBar.doneAndPostButton").eq(0).attr("title",Translator.trans("player.recording.doneAndPostButton"))},l.prototype._onRecordingStarted=function(){console.log("%s: %s",l.TAG,"_onRecordingStarted"),this._clearCurrents(),this.isOnInterpTab&&(this.currentRecording.sourceStartTime=this.player.getCurrentTime(),this.player.setControlsEnabled(!1),this.player.play())},l.prototype._onRecordingStopped=function(){this.currentRecording.video=this.recorder.recordVideo.getBlob(),this.currentRecording.audio=this.recorder.recordAudio.getBlob(),this.isOnInterpTab&&(this.player.pause(),this.player.setControlsEnabled(!0)),this._destroyPlayers(),this._injectCurrentRecording(this.isOnNormalTab?this.$normalVideo:this.$interpVideoR),this.isOnInterpTab&&this._createPlayer(),this.options.mode=l.Mode.PREVIEW,this._createPlayer(!0,!0)},l.prototype._checkMessages=function(){if(this.tempMedia)for(;this.messages.length>0;){var t=this.messages.pop();t.who.indexOf("MultiplexConsumer")>-1&&(t.what.indexOf("Media")>-1||t.what.indexOf("Interpretation"))&&t.identifier==this.tempMedia.get("id")&&("Done"!=t.status?this.$containerUpload.find("label").eq(0).html(t.status+"..."):(console.log("done"),this.$containerUpload.find("label").eq(0).html("Cleaning up..."),o.get(this.tempMedia.get("id")).done(function(t){this.tempMedia=null,this.setRecordedMedia(t.media),this.isDonePostponed&&setTimeout(function(){this._dispatchDone()}.bind(this),2e3)}.bind(this)).fail(function(t){})))}},l.prototype._addRecording=function(){if(null==this.currentRecording.video&&null==this.currentRecording.audio)return null;var t={video:this.currentRecording.video,audio:this.currentRecording.audio,title:this._getCurrentTitleElement().val()};return this.isOnInterpTab&&(t.isInterpretation=!0,t.sourceStartTime=this.currentRecording.sourceStartTime,t.sourceId=this.sourceMedia.get("id")),this.$containerUpload.find("label").eq(0).html("Uploading recording..."),r.addRecording(t).progress(function(t){a.updateProgressBar(this.$containerUpload,t)}.bind(this)).done(function(t){console.log(t.media),2==t.media.get("state")?this.setRecordedMedia(t.media):(console.log("waiting for multiplex consumer"),this.$containerUpload.find(".progress-bar").eq(0).addClass("progress-bar-striped active").html(""),this.$containerUpload.find("label").eq(0).html("Processing..."),this.tempMedia=t.media,this._checkMessages())}.bind(this)).fail(function(){})},l.prototype._trim=function(t){return null==this.currentTrim.startTime||null==this.currentTrim.endTime?null:(this.$containerUpload.find("label").eq(0).html("Queuing trim..."),o.trim(t,this.currentTrim.startTime,this.currentTrim.endTime).fail(function(){}))},l.prototype._dispatchDone=function(){this._dispatch(l.Event.DONE,{media:this.recordedMedia,doPost:this.doPost,recorderComponent:this})},l.prototype._onClickDone=function(t){console.log("%s: %s",l.TAG,"_onClickDone"),t.preventDefault(),this.$containerRecord.hide(),this.$containerUpload.show(),this._destroyPlayers();var e=function(){this.$containerUpload.find("label").eq(0).html("Cleaning up..."),this.recordedMedia?setTimeout(function(){this._dispatchDone()}.bind(this),2e3):this.isDonePostponed=!0}.bind(this),i=function(t){var i=this._trim(t);return i?void i.done(function(t){e()}):void e()}.bind(this),n=this._addRecording();return n?void n.done(function(t){i(t.media)}):void(this.isInEditMode&&this.recordedMedia&&(a.updateProgressBar(this.$containerUpload,100),this.$containerUpload.find(".progress-bar").eq(0).addClass("progress-bar-striped active").html(""),i(this.recordedMedia)))},l.prototype._onClickDoneAndPost=function(t){this.doPost=!0,this._onClickDone(t)},l.prototype._clearCurrents=function(){this.currentRecording={video:null,audio:null,sourceStartTime:null},this.currentTrim={startTime:null,endTime:null}},l.prototype._destroyPlayers=function(){console.log("%s: %s",l.TAG,"_destroyPlayers");var t=function(t){var e=t.parent();t.removeAttr("src"),e.hide(),e.after(t.detach()),e.remove()}.bind(this);null!=this.player&&(this.player.destroyRecorder(),this.isOnNormalTab?t(this.$normalVideo):null!=this.sourceMedia&&t(this.$interpVideoP),this.player=null),null!=this.recorder&&(this.recorder.destroyRecorder(),this.isOnNormalTab?t(this.$normalVideo):null!=this.sourceMedia&&t(this.$interpVideoR),this.recorder=null),this.$controls.html("")},l.prototype._onPageAnimate=function(){try{if(this.isInEditMode&&null!=this.recordedMedia){if(this.isOnInterpTab&&null!=this.sourceMedia)return;this._createPlayer(!0)}else{if(this.isOnInterpTab){if(null==this.sourceMedia)return;this._createPlayer()}this._createRecorder()}}catch(t){console.error("%s: %s- err=%o",l.TAG,"_loadPage",t)}},l.prototype._loadPage=function(){this.isOnInterpTab&&(null!=this.sourceMedia?(this.$interpSelect.parent().hide(),this.$interpMain.show()):(this.$interpSelect.parent().show(),this.$interpMain.hide())),this.$modalDialog.find(".modal-dialog").animate({width:4*(.9*$(window).height()-256)/3},{complete:this.bind__onPageAnimate})},l.prototype._onShownModal=function(t){this._destroyPlayers(),this._loadPage()},l.prototype._onShowModal=function(t){this.$modalDialog.find(".modal-dialog").width(4*(.9*$(window).height()-256)/3)},l.prototype._onHiddenModal=function(t){this._destroyPlayers(),this.paused||this._dispatch(l.Event.HIDDEN,{recorderComponent:this})},l.prototype._onShowTab=function(t){this._destroyPlayers(),this.options.tab=$(t.target).attr("href")==l.Binder.NORMAL?l.Tab.NORMAL:l.Tab.INTERPRETATION,this.isOnNormalTab=this.options.tab==l.Tab.NORMAL,this.isOnInterpTab=this.options.tab==l.Tab.INTERPRETATION,this._loadPage()},l.prototype._onShownTab=function(t){this.$interpVideoP[0].load()},l.prototype._onBlurPlayerTitle=function(t){console.log("updated title"),this.recordedMedia.set("title",$(t.target).val()),o.edit(this.recordedMedia)},l.prototype._onClickInterpSelect=function(t){t.preventDefault(),i.render({multiSelect:!1,filter:{type:1}},function(t){this.mfsCmp=t.myFilesSelectorComponent,this.mfsCmp.subscribe(i.Event.DONE,function(t){this.mfsCmp.hide(),this.setSourceMedia(t.media[0])}.bind(this)),this.mfsCmp.subscribe(i.Event.HIDDEN,function(t){this.mfsCmp.destroy(),this.show(),this.paused=!1}.bind(this)),this.paused=!0,this.hide(),this.mfsCmp.show()}.bind(this))},l.prototype.show=function(){this.$modalDialog.modal("show")},l.prototype.hide=function(){this.$modalDialog.modal("hide")},l.prototype.destroy=function(){this._clearCurrents(),this._cleanupRabbitmq(),this.$modalDialog.remove()},l.prototype._injectCurrentRecording=function(t){var e={resources:[{web_path:URL.createObjectURL(this.currentRecording.video)},{web_path:URL.createObjectURL(this.currentRecording.audio)}]};dust.render("recorder_source",e,function(e,i){t.html(i)})},l.prototype._injectMedia=function(t,e){var i={resources:this.isInRecordMode?[e.get("source_resource")]:e.get("resources")};dust.render("recorder_source",i,function(e,i){t.html(i)})},l.prototype._getCurrentTitleElement=function(){return this.isOnNormalTab?this.$normalTitle:this.$interpTitle},l.prototype.setSourceMedia=function(t){this.sourceMedia=t,null!=this.sourceMedia&&(this._injectMedia(this.$interpVideoP,this.sourceMedia),this._getCurrentTitleElement().val(this.sourceMedia.get("title"))),this._destroyPlayers(),this._loadPage()},l.prototype.setRecordedMedia=function(t){this.recordedMedia=t,null!=this.recordedMedia&&(this._injectMedia(this.isOnNormalTab?this.$normalVideo:this.$interpVideoR,this.recordedMedia),this._getCurrentTitleElement().val(this.recordedMedia.get("title")))},l.render=function(t,e){var i={$container:$("body"),tab:l.Tab.NORMAL,mode:l.Mode.RECORD,enableDoneAndPost:!1};t=t||i;for(var n in i)t[n]="undefined"!=typeof t[n]?t[n]:i[n];dust.render("recorder",{},function(i,n){t.$container.append(n);var o=new l(t);e.call(o,{recorderComponent:o})})},l}),!function(t){"function"==typeof define&&define.amd?define("Sortable",t):"undefined"!=typeof module&&"undefined"!=typeof module.exports?module.exports=t():"undefined"!=typeof Package?Sortable=t():window.Sortable=t()}(function(){function t(t,e){this.el=t,this.options=e=e||{};var n={group:Math.random(),sort:!0,disabled:!1,store:null,handle:null,scroll:!0,scrollSensitivity:30,scrollSpeed:10,draggable:/[uo]l/i.test(t.nodeName)?"li":">*",ghostClass:"sortable-ghost",ignore:"a, img",filter:null,animation:0,setData:function(t,e){t.setData("Text",e.textContent)},dropBubble:!1,dragoverBubble:!1};for(var o in n)!(o in e)&&(e[o]=n[o]);var s=e.group;s&&"object"==typeof s||(s=e.group={name:s}),["pull","put"].forEach(function(t){t in s||(s[t]=!0)}),L.forEach(function(n){e[n]=i(this,e[n]||F),r(t,n.substr(2).toLowerCase(),e[n])},this),e.groups=" "+s.name+(s.put.join?" "+s.put.join(" "):"")+" ",t[A]=e;for(var a in this)"_"===a.charAt(0)&&(this[a]=i(this,this[a]));r(t,"mousedown",this._onTapStart),r(t,"touchstart",this._onTapStart),r(t,"dragover",this),r(t,"dragenter",this),V.push(this._onDragOver),e.store&&this.sort(e.store.get(this))}function e(t){g&&g.state!==t&&(l(g,"display",t?"none":""),!t&&g.state&&v.insertBefore(g,b),g.state=t)}function i(t,e){var i=j.call(arguments,2);return e.bind?e.bind.apply(e,[t].concat(i)):function(){return e.apply(t,i.concat(j.call(arguments)))}}function n(t,e,i){if(t){i=i||M,e=e.split(".");var n=e.shift().toUpperCase(),o=new RegExp("\\s("+e.join("|")+")\\s","g");do if(">*"===n&&t.parentNode===i||(""===n||t.nodeName.toUpperCase()==n)&&(!e.length||((" "+t.className+" ").match(o)||[]).length==e.length))return t;while(t!==i&&(t=t.parentNode))}return null}function o(t){t.dataTransfer.dropEffect="move",t.preventDefault()}function r(t,e,i){t.addEventListener(e,i,!1)}function s(t,e,i){t.removeEventListener(e,i,!1)}function a(t,e,i){if(t)if(t.classList)t.classList[i?"add":"remove"](e);else{var n=(" "+t.className+" ").replace(/\s+/g," ").replace(" "+e+" ","");t.className=n+(i?" "+e:"")}}function l(t,e,i){var n=t&&t.style;if(n){if(void 0===i)return M.defaultView&&M.defaultView.getComputedStyle?i=M.defaultView.getComputedStyle(t,""):t.currentStyle&&(i=t.currentStyle),void 0===e?i:i[e];e in n||(e="-webkit-"+e),n[e]=i+("string"==typeof i?"":"px")}}function d(t,e,i){if(t){var n=t.getElementsByTagName(e),o=0,r=n.length;if(i)for(;r>o;o++)i(n[o],o);return n}return[]}function c(t){t.draggable=!1}function u(){D=!1}function h(t,e){var i=t.lastElementChild,n=i.getBoundingClientRect();return e.clientY-(n.top+n.height)>5&&i}function p(t){for(var e=t.tagName+t.className+t.src+t.href+t.textContent,i=e.length,n=0;i--;)n+=e.charCodeAt(i);return n.toString(36)}function f(t){for(var e=0;t&&(t=t.previousElementSibling);)"TEMPLATE"!==t.nodeName.toUpperCase()&&e++;return e}function m(t,e){var i,n;return function(){void 0===i&&(i=arguments,n=this,setTimeout(function(){1===i.length?t.call(n,i[0]):t.apply(n,i),i=void 0},e))}}var b,_,g,v,y,w,E,C,T,k,S,$,P,x,R={},A="Sortable"+(new Date).getTime(),O=window,M=O.document,N=O.parseInt,I=!!("draggable"in M.createElement("div")),D=!1,B=function(t,e,i,n,o,r){var s=M.createEvent("Event");s.initEvent(e,!0,!0),s.item=i||t,s.from=n||t,s.clone=g,s.oldIndex=o,s.newIndex=r,t.dispatchEvent(s)},L="onAdd onUpdate onRemove onStart onEnd onFilter onSort".split(" "),F=function(){},U=Math.abs,j=[].slice,V=[],G=m(function(t,e,i){if(i&&e.scroll){var n,o,r,s,a=e.scrollSensitivity,l=e.scrollSpeed,d=t.clientX,c=t.clientY,u=window.innerWidth,h=window.innerHeight;if(E!==i&&(w=e.scroll,E=i,w===!0)){w=i;do if(w.offsetWidth<w.scrollWidth||w.offsetHeight<w.scrollHeight)break;while(w=w.parentNode)}w&&(n=w,o=w.getBoundingClientRect(),r=(U(o.right-d)<=a)-(U(o.left-d)<=a),s=(U(o.bottom-c)<=a)-(U(o.top-c)<=a)),r||s||(r=(a>=u-d)-(a>=d),s=(a>=h-c)-(a>=c),(r||s)&&(n=O)),(R.vx!==r||R.vy!==s||R.el!==n)&&(R.el=n,R.vx=r,R.vy=s,clearInterval(R.pid),n&&(R.pid=setInterval(function(){n===O?O.scrollTo(O.scrollX+r*l,O.scrollY+s*l):(s&&(n.scrollTop+=s*l),r&&(n.scrollLeft+=r*l))},24)))}},30);return t.prototype={constructor:t,_dragStarted:function(){v&&b&&(a(b,this.options.ghostClass,!0),t.active=this,B(v,"start",b,v,k))},_onTapStart:function(t){var e=t.type,i=t.touches&&t.touches[0],o=(i||t).target,s=o,a=this.options,l=this.el,u=a.filter;if(!("mousedown"===e&&0!==t.button||a.disabled)&&(o=n(o,a.draggable,l))){if(k=f(o),"function"==typeof u){if(u.call(this,t,o,this))return B(s,"filter",o,l,k),void t.preventDefault()}else if(u&&(u=u.split(",").some(function(t){return t=n(s,t.trim(),l),t?(B(t,"filter",o,l,k),!0):void 0})))return void t.preventDefault();if((!a.handle||n(s,a.handle,l))&&o&&!b&&o.parentNode===l){P=t,v=this.el,b=o,y=b.nextSibling,$=this.options.group,b.draggable=!0,a.ignore.split(",").forEach(function(t){d(o,t.trim(),c)}),i&&(P={target:o,clientX:i.clientX,clientY:i.clientY},this._onDragStart(P,"touch"),t.preventDefault()),r(M,"mouseup",this._onDrop),r(M,"touchend",this._onDrop),r(M,"touchcancel",this._onDrop),r(b,"dragend",this),r(v,"dragstart",this._onDragStart),I||this._onDragStart(P,!0);try{M.selection?M.selection.empty():window.getSelection().removeAllRanges()}catch(h){}}}},_emulateDragOver:function(){if(x){l(_,"display","none");var t=M.elementFromPoint(x.clientX,x.clientY),e=t,i=" "+this.options.group.name,n=V.length;if(e)do{if(e[A]&&e[A].groups.indexOf(i)>-1){for(;n--;)V[n]({clientX:x.clientX,clientY:x.clientY,target:t,rootEl:e});break}t=e}while(e=e.parentNode);l(_,"display","")}},_onTouchMove:function(t){if(P){var e=t.touches?t.touches[0]:t,i=e.clientX-P.clientX,n=e.clientY-P.clientY,o=t.touches?"translate3d("+i+"px,"+n+"px,0)":"translate("+i+"px,"+n+"px)";x=e,l(_,"webkitTransform",o),l(_,"mozTransform",o),l(_,"msTransform",o),l(_,"transform",o),t.preventDefault()}},_onDragStart:function(t,e){var i=t.dataTransfer,n=this.options;if(this._offUpEvents(),"clone"==$.pull&&(g=b.cloneNode(!0),l(g,"display","none"),v.insertBefore(g,b)),e){var o,s=b.getBoundingClientRect(),a=l(b);_=b.cloneNode(!0),l(_,"top",s.top-N(a.marginTop,10)),l(_,"left",s.left-N(a.marginLeft,10)),l(_,"width",s.width),l(_,"height",s.height),l(_,"opacity","0.8"),l(_,"position","fixed"),l(_,"zIndex","100000"),v.appendChild(_),o=_.getBoundingClientRect(),l(_,"width",2*s.width-o.width),l(_,"height",2*s.height-o.height),"touch"===e?(r(M,"touchmove",this._onTouchMove),r(M,"touchend",this._onDrop),r(M,"touchcancel",this._onDrop)):(r(M,"mousemove",this._onTouchMove),r(M,"mouseup",this._onDrop)),this._loopId=setInterval(this._emulateDragOver,150)}else i&&(i.effectAllowed="move",n.setData&&n.setData.call(this,i,b)),r(M,"drop",this);setTimeout(this._dragStarted,0)},_onDragOver:function(t){var i,o,r,s=this.el,a=this.options,d=a.group,c=d.put,p=$===d,f=a.sort;if(b&&(void 0!==t.preventDefault&&(t.preventDefault(),!a.dragoverBubble&&t.stopPropagation()),$&&!a.disabled&&(p?f||(r=!v.contains(b)):$.pull&&c&&($.name===d.name||c.indexOf&&~c.indexOf($.name)))&&(void 0===t.rootEl||t.rootEl===this.el))){if(G(t,a,this.el),D)return;if(i=n(t.target,a.draggable,s),o=b.getBoundingClientRect(),r)return e(!0),void(g||y?v.insertBefore(b,g||y):f||v.appendChild(b));if(0===s.children.length||s.children[0]===_||s===t.target&&(i=h(s,t))){if(i){if(i.animated)return;w=i.getBoundingClientRect()}e(p),s.appendChild(b),this._animate(o,b),i&&this._animate(w,i)}else if(i&&!i.animated&&i!==b&&void 0!==i.parentNode[A]){C!==i&&(C=i,T=l(i));var m,w=i.getBoundingClientRect(),E=w.right-w.left,k=w.bottom-w.top,S=/left|right|inline/.test(T.cssFloat+T.display),P=i.offsetWidth>b.offsetWidth,x=i.offsetHeight>b.offsetHeight,R=(S?(t.clientX-w.left)/E:(t.clientY-w.top)/k)>.5,O=i.nextElementSibling;D=!0,setTimeout(u,30),e(p),m=S?i.previousElementSibling===b&&!P||R&&P:O!==b&&!x||R&&x,m&&!O?s.appendChild(b):i.parentNode.insertBefore(b,m?O:i),this._animate(o,b),this._animate(w,i)}}},_animate:function(t,e){var i=this.options.animation;if(i){var n=e.getBoundingClientRect();l(e,"transition","none"),l(e,"transform","translate3d("+(t.left-n.left)+"px,"+(t.top-n.top)+"px,0)"),e.offsetWidth,l(e,"transition","all "+i+"ms"),l(e,"transform","translate3d(0,0,0)"),clearTimeout(e.animated),e.animated=setTimeout(function(){l(e,"transition",""),l(e,"transform",""),e.animated=!1},i)}},_offUpEvents:function(){s(M,"mouseup",this._onDrop),s(M,"touchmove",this._onTouchMove),s(M,"touchend",this._onDrop),s(M,"touchcancel",this._onDrop)},_onDrop:function(e){var i=this.el,n=this.options;clearInterval(this._loopId),clearInterval(R.pid),s(M,"drop",this),s(M,"mousemove",this._onTouchMove),s(i,"dragstart",this._onDragStart),this._offUpEvents(),e&&(e.preventDefault(),!n.dropBubble&&e.stopPropagation(),_&&_.parentNode.removeChild(_),b&&(s(b,"dragend",this),c(b),a(b,this.options.ghostClass,!1),v!==b.parentNode?(S=f(b),B(b.parentNode,"sort",b,v,k,S),B(v,"sort",b,v,k,S),B(b,"add",b,v,k,S),B(v,"remove",b,v,k,S)):(g&&g.parentNode.removeChild(g),b.nextSibling!==y&&(S=f(b),B(v,"update",b,v,k,S),B(v,"sort",b,v,k,S))),t.active&&B(v,"end",b,v,k,S)),v=b=_=y=g=w=E=P=x=C=T=$=t.active=null,this.save())},handleEvent:function(t){var e=t.type;"dragover"===e||"dragenter"===e?(this._onDragOver(t),o(t)):("drop"===e||"dragend"===e)&&this._onDrop(t)},toArray:function(){for(var t,e=[],i=this.el.children,o=0,r=i.length;r>o;o++)t=i[o],n(t,this.options.draggable,this.el)&&e.push(t.getAttribute("data-id")||p(t));return e},sort:function(t){var e={},i=this.el;this.toArray().forEach(function(t,o){var r=i.children[o];n(r,this.options.draggable,i)&&(e[t]=r)},this),t.forEach(function(t){e[t]&&(i.removeChild(e[t]),i.appendChild(e[t]))})},save:function(){var t=this.options.store;t&&t.set(this)},closest:function(t,e){return n(t,e||this.options.draggable,this.el)},option:function(t,e){var i=this.options;return void 0===e?i[t]:void(i[t]=e)},destroy:function(){var t=this.el,e=this.options;L.forEach(function(i){s(t,i.substr(2).toLowerCase(),e[i])}),s(t,"mousedown",this._onTapStart),s(t,"touchstart",this._onTapStart),s(t,"dragover",this),s(t,"dragenter",this),Array.prototype.forEach.call(t.querySelectorAll("[draggable]"),function(t){t.removeAttribute("draggable")}),V.splice(V.indexOf(this._onDragOver),1),this._onDrop(),this.el=null}},t.utils={on:r,off:s,css:l,find:d,bind:i,is:function(t,e){return!!n(t,e,t)},throttle:m,closest:n,toggleClass:a,dispatchEvent:B,index:f},t.version="1.1.1",t.create=function(e,i){return new t(e,i)},t}),define("component/galleryComponent",["core/subscriber","factory/mediaFactory","component/recorderComponent","core/helper","Sortable","extra"],function(t,e,i,n,o){var r=function(i){t.prototype.constructor.apply(this),this.options=i,this.activeMedia=this.options.activeMedia,this.thumbsBounds={width:0,shiftWidth:0,thumbsWidth:0},this.bind__onClickItemContainer=this._onClickItemContainer.bind(this),this.bind__onClickPrevNext=this._onClickPrevNext.bind(this),this.bind__onClickAction=this._onClickAction.bind(this),this.bind__onClickLeftRight=this._onClickLeftRight.bind(this),this.bind__onClickThumbnail=this._onClickThumbnail.bind(this),this.bind__onClickThumbRemove=this._onClickThumbRemove.bind(this),this.bind__onRenderMedia=this._onRenderMedia.bind(this),this.bind__onRenderThumbnails=this._onRenderThumbnails.bind(this),this.bind__onWindowResize=this._onWindowResize.bind(this),this.$container=this.options.$container,this.$inner=this.$container.find('[id="'+this.options.identifier+'"]'+r.Binder.INNER),this.$item=this.$inner.find(r.Binder.ITEM),this.$prev=this.$inner.find(r.Binder.PREV),this.$next=this.$inner.find(r.Binder.NEXT),this.$actions=this.$inner.find(r.Binder.ACTION),this.$carousel=this.$inner.find(r.Binder.CAROUSEL),this.$thumbs=this.$inner.find(r.Binder.THUMBS),this.$left=this.$inner.find(r.Binder.LEFT),this.$right=this.$inner.find(r.Binder.RIGHT),this.$item.on("click",this.bind__onClickItemContainer),this.$prev.find("i.fa").on("click",this.bind__onClickPrevNext),this.$next.find("i.fa").on("click",this.bind__onClickPrevNext),this.$actions.on("click",this.bind__onClickAction),this.$left.find("i.fa").on("click",this.bind__onClickLeftRight),this.$right.find("i.fa").on("click",this.bind__onClickLeftRight),$(window).on("resize",this.bind__onWindowResize),this.options.canEdit&&(this.sortable=o.create(this.$thumbs.find("ul")[0],{onSort:function(t){var e=this.options.media[t.oldIndex],i=this.options.media[t.newIndex];this.options.media[t.newIndex]=e,this.options.media[t.oldIndex]=i,this._updateButtonStates(),this._dispatch(r.Event.CHANGE,{galleryComponent:this})}.bind(this)})),"undefined"!=typeof this.options.mediaIds&&e.list(this.options.mediaIds).done(function(t){this.options.media=t.media,this._populate()}.bind(this)).fail(function(t){console.error("%s: media factory list",r.TAG)})};return r.extend(t),r.TAG="GalleryComponent",r.Mode={PREVIEW:0,INLINE:1},r.Event={CHANGE:"eventChange",REMOVED_MEDIA:"eventRemovedMedia",DONE:"eventDone",HIDDEN:"eventHidden"},r.Binder={INNER:".gallery-inner",ITEM:".gallery-item",PREV:".gallery-prev",NEXT:".gallery-next",ACTION:".gallery-action a",CAROUSEL:".gallery-carousel",THUMBS:".gallery-thumbs",THUMB_REMOVE:".gallery-thumb-remove",LEFT:".gallery-left",RIGHT:".gallery-right"},r.prototype._launchRecorder=function(t,e,n){i.render(t,function(t){this.recorderCmp=t.recorderComponent,this.recorderCmp.subscribe(i.Event.DONE,function(t){this.recorderCmp.hide(),t.doPost&&window.location.assign(Routing.generate("imdc_thread_new_from_media",{mediaId:t.media.get("id")}))}.bind(this)),this.recorderCmp.subscribe(i.Event.HIDDEN,function(t){this.recorderCmp.destroy(),this.options.mode==r.Mode.PREVIEW&&this.show(),this.paused=!1}.bind(this)),this.paused=!0,this.options.mode==r.Mode.PREVIEW&&this.hide(),e&&this.recorderCmp.setSourceMedia(this.activeMedia),n&&this.recorderCmp.setRecordedMedia(this.activeMedia),this.recorderCmp.show()}.bind(this))},r.prototype._onClickItemContainer=function(t){this.options.mode==r.Mode.PREVIEW&&t.target===this.$item[0]&&this.hide()},r.prototype._onClickPrevNext=function(t){t.preventDefault();var e=$(t.currentTarget).hasClass("next"),i=$.inArray(this.activeMedia,this.options.media);!e&&0>i-1||e&&i+1>=this.options.media.length||(this.activeMedia=this.options.media[i+(e?1:-1)],this._renderMedia())},r.prototype._onClickAction=function(t){var e=$(t.currentTarget).data("action");switch(e){case 1:this.hide();break;case 2:n.toggleFullScreen(this.$item);break;case 3:this._launchRecorder({tab:i.Tab.INTERPRETATION,enableDoneAndPost:!0},!0);break;case 4:this._launchRecorder({tab:i.Tab.NORMAL,mode:i.Mode.PREVIEW},!1,!0)}},r.prototype._calcCarouselPosition=function(t){var e,i,n,o,r=Math.abs(parseInt(this.$thumbs.find("ul").css("left"),10));return t?(e=r+this.thumbsBounds.width,i=r+(this.thumbsBounds.thumbsWidth-e),n=r+this.thumbsBounds.shiftWidth,o=-Math.min(n,e>=this.thumbsBounds.thumbsWidth?r:i)):(e=r-this.thumbsBounds.shiftWidth,o=Math.min(0,-e)),o},r.prototype._onClickLeftRight=function(t){t.preventDefault();var e=this._calcCarouselPosition($(t.currentTarget).hasClass("right"));this._updateButtonStates(e),this.$thumbs.find("ul").css({left:e})},r.prototype._onClickThumbnail=function(t){t.preventDefault();var e=$(t.currentTarget).data("mid");this.activeMedia=$.grep(this.options.media,function(t,i){return t.get("id")==e})[0],this._renderMedia()},r.prototype._onClickThumbRemove=function(t){t.preventDefault();var e=$(t.currentTarget).data("mid"),i=$.grep(this.options.media,function(t,i){return t.get("id")==e})[0];this.removeMedia(i),this._dispatch(r.Event.REMOVED_MEDIA,{media:i,galleryComponent:this})},r.prototype.clear=function(){for(var t in this.options.media){var e=this.options.media[t];this.removeMedia(e),this._dispatch(r.Event.REMOVED_MEDIA,{media:e,galleryComponent:this})}},r.prototype._updateButtonStates=function(t){var e=this.$thumbs.find('li[data-mid="'+this.activeMedia.get("id")+'"]');this.$thumbs.find("div").removeClass("selected");var i=this.$actions.filter('[data-action="1"]'),n=this.$actions.filter('[data-action="2"]'),o=this.$actions.filter('[data-action="3"]'),s=this.$actions.filter('[data-action="4"]'),a=this.options.mode==r.Mode.PREVIEW;i.toggle(a),n.show(),1==this.activeMedia.get("type")?(o.show(),s.toggle(a)):(o.hide(),s.hide()),this.$prev.toggleClass("disabled",e.is(":first-child")),this.$next.toggleClass("disabled",e.is(":last-child"));var t=Math.abs(void 0!==t?t:parseInt(this.$thumbs.find("ul").css("left"),10));
this.$left.find("i.fa").toggleClass("disabled",0>=t),this.$right.find("i.fa").toggleClass("disabled",t+this.thumbsBounds.width>=this.thumbsBounds.thumbsWidth),e.find("div").addClass("selected")},r.prototype._focusSelectedThumbnail=function(){var t=this.$thumbs.find('li[data-mid="'+this.activeMedia.get("id")+'"]'),e=t.position();if(e){var i=t.outerWidth(!0);e.right=e.left+i,e.center=e.left+i/2;var n=Math.abs(parseInt(this.$thumbs.find("ul").css("left"),10)),o={left:n,right:n+this.thumbsBounds.width,center:n+this.thumbsBounds.width/2},r=e.center>o.center,s=Math.abs(e.center-o.center),a=n+(r?s:-s);a=r?-Math.min(a,o.right>=this.thumbsBounds.thumbsWidth?o.left:this.thumbsBounds.thumbsWidth-this.thumbsBounds.width):Math.min(0,-a),this.$thumbs.find("ul").css({left:a}),this._updateButtonStates(a)}},r.prototype._onWindowResize=function(t){this.options.media.length<=1&&!this.options.canEdit?this.$carousel.hide():this.$carousel.show();var e="body"===this.$container.prop("tagName").toLowerCase()?$(window):this.$container,i=this.$carousel.is(":hidden")?0:this.$carousel.outerHeight(!0),o=n.isFullscreen()?$(window).height():e.height()-i,r=e.width()-(this.$left.outerWidth(!0)+this.$right.outerWidth(!0))-.5,s=function(t,e){return o/2-$(this).height()/2};this.$item.css({height:o,"line-height":o+"px"}),this.$thumbs.width(r),this.$prev.css("top",s),this.$next.css("top",s),this.$item.find(".tt-media-video").css({height:o}),this.$item.find(".tt-media-img").css({"max-height":o});var a=this.$thumbs.width(),l=this.$thumbs.find("li"),d=parseInt(l.eq(0).css("margin-left"),10),c=l.eq(0).outerWidth(!0)-d,u=Math.floor(a/c);return this.thumbsBounds.width=a,this.thumbsBounds.shiftWidth=c*u,this.thumbsBounds.thumbsWidth=c*l.length+d,this.activeMedia?(this._focusSelectedThumbnail(),void this.$item.toggleClass("fullscreen",n.isFullscreen())):(this.$actions.hide(),this.$prev.addClass("disabled"),this.$next.addClass("disabled"),this.$left.find("i.fa").addClass("disabled"),void this.$right.find("i.fa").addClass("disabled"))},r.prototype._onRenderMedia=function(t,e){this.$item.html(e),$(window).trigger("resize")},r.prototype._onRenderThumbnails=function(t,e){this.$thumbs.find("ul").html(e),this.$thumbs.find("li").on("click",this.bind__onClickThumbnail),this.$thumbs.find("li").find("span").on("click",this.bind__onClickThumbRemove),$(window).trigger("resize")},r.prototype._renderMedia=function(){dust.render("media_element",{media:this.activeMedia?this.activeMedia.data:null,enable_controls:!0,preload_media:!1},this.bind__onRenderMedia)},r.prototype._renderMediaAndThumbnails=function(){return this.activeMedia?(this._renderMedia(),void dust.render("gallery_thumbnail",{media:this.options.media,can_edit:this.options.canEdit},this.bind__onRenderThumbnails)):(this.$item.html(""),this.$thumbs.find("ul").html(""),void $(window).trigger("resize"))},r.prototype._populate=function(){this.activeMedia=0==this.options.media.length?null:this.activeMedia?this.activeMedia:this.options.media[0],this._renderMediaAndThumbnails()},r.prototype.show=function(t){t=void 0!==t?t:this.options.mode==r.Mode.PREVIEW,this.options.mode==r.Mode.PREVIEW&&this.$container.addClass("tt-gallery-modal");var e=function(){this._populate()}.bind(this);t?this.$inner.fadeIn().promise().done(e):this.$inner.show().promise().done(e)},r.prototype.hide=function(t){t=void 0!==t?t:this.options.mode==r.Mode.PREVIEW,this.options.mode!=r.Mode.PREVIEW||this.paused||this.$container.removeClass("tt-gallery-modal");var e=function(){this.paused||this._dispatch(r.Event.HIDDEN,{galleryComponent:this})}.bind(this);t?this.$inner.fadeOut().promise().done(e):this.$inner.show().promise().done(e)},r.prototype.destroy=function(){this.$inner.remove()},r.prototype.setMedia=function(t){this.options.media=t,this._populate()},r.prototype.addMedia=function(t){this.options.media.push(t),this._populate()},r.prototype.removeMedia=function(t){var e=$.inArray(t,this.options.media);-1!=e&&(this.options.media.splice(e,1),0==this.options.media.length?this.activeMedia=null:(e>=this.options.media.length&&e--,this.activeMedia=this.options.media[e]),this._populate())},r.render=function(t,e){if("undefined"!==t.mode&&t.mode==r.Mode.INLINE&&"undefined"===t.$container)throw new Error("Inline mode requires the $container option to be set explicitly.");var i={$container:$("body"),identifier:Math.random(),mode:r.Mode.PREVIEW,canEdit:!1,media:[],activeMedia:null};t=t||i;for(var n in i)t[n]="undefined"!=typeof t[n]?t[n]:i[n];var o=t.mode==r.Mode.INLINE?"gallery_inline":"gallery_preview";dust.render(o,{identifier:t.identifier},function(i,n){t.$container.append(n);var o=new r(t);e.call(o,{galleryComponent:o})})},r}),define("component/mediaChooserComponent",["core/subscriber","factory/mediaFactory","factory/myFilesFactory","component/recorderComponent","component/myFilesSelectorComponent","component/galleryComponent","model/mediaModel","core/helper","extra"],function(t,e,i,n,o,r,s,a){var l=function(e){t.prototype.constructor.apply(this),this.options=e,this.media=[],this.bind__onClickRecordVideo=this._onClickRecordVideo.bind(this),this.bind__onClickUploadFile=this._onClickUploadFile.bind(this),this.bind__onClickSelect=this._onClickSelect.bind(this),this.bind__onChangeResourceFile=this._onChangeResourceFile.bind(this),this.$container=this.options.$container,this.$containerUpload=this.$container.find(l.Binder.CONTAINER_UPLOAD),this.$uploadForm=$(this.$containerUpload.data("form")),this.$resourceFile=this._getFormField("source_resource_file"),this.$recordVideo=this.$container.find(l.Binder.RECORD_VIDEO),this.$uploadFile=this.$container.find(l.Binder.UPLOAD_FILE),this.$select=this.$container.find(l.Binder.SELECT),this.$uploadTitle=this.$container.find(l.Binder.UPLOAD_TITLE),this.$working=this.$container.find(l.Binder.WORKING),this.$gallery=this.$container.find(l.Binder.GALLERY),this.$resourceFile.on("change",this.bind__onChangeResourceFile),this.$recordVideo.on("click",this.bind__onClickRecordVideo),this.$uploadFile.on("click",this.bind__onClickUploadFile),this.$select.on("click",this.bind__onClickSelect),this.$gallery.length>0&&r.render({$container:this.$gallery,mode:r.Mode.INLINE,canEdit:!0},function(t){this.galleryCmp=t.galleryComponent,this.galleryCmp.subscribe(r.Event.CHANGE,function(t){this.media=this.galleryCmp.options.media,this._invokeSuccess()}.bind(this)),this.galleryCmp.subscribe(r.Event.REMOVED_MEDIA,function(t){0==t.galleryComponent.options.media.length&&(this.galleryCmp.hide(!0),this.$gallery.slideUp()),this._removeSelectedMedia(t.media),this._invokeSuccess()}.bind(this))}.bind(this))};return l.extend(t),l.TAG="MediaChooserComponent",l.Binder={RECORD_VIDEO:".mediachooser-record-video",UPLOAD_FILE:".mediachooser-upload-file",SELECT:".mediachooser-select",CONTAINER_UPLOAD:".mediachooser-container-upload",UPLOAD_TITLE:".mediachooser-upload-title",WORKING:".mediachooser-working",GALLERY:".mediachooser-gallery"},l.Event={UPLOAD_START:"eventUploadStart",SUCCESS:"eventSuccess",SUCCESS_AND_POST:"eventSuccessAndPost",REMOVE:"eventRemove",ERROR:"eventError",RESET:"eventReset"},l.FORM_NAME="media",l.prototype._getFormField=function(t){return this.$uploadForm.find("#"+l.FORM_NAME+"_"+t)},l.prototype._addSelectedMedia=function(t){for(var e in this.media){var i=this.media[e];if(i.get("id")==t.get("id"))return}this.media.push(t),0!=this.$gallery.length&&(this.$gallery.slideDown(),this.galleryCmp.addMedia(t),this.galleryCmp.show(!0))},l.prototype._removeSelectedMedia=function(t){for(var e in this.media){var i=this.media[e];if(i.get("id")==t.get("id")){var t=this.media.splice(e,1);this.galleryCmp.removeMedia(e),this._dispatch(l.Event.REMOVE,{media:t,mediaChooserComponent:this})}}},l.prototype._resetUpload=function(){this.$containerUpload.hide(),this.$uploadTitle.html("")},l.prototype._invokeSuccess=function(t){this._resetUpload();var e="undefined"!=typeof t&&1==t?l.Event.SUCCESS_AND_POST:l.Event.SUCCESS,i={media:this.media,mediaChooserComponent:this};this._dispatch(e,i)},l.prototype._onClickRecordVideo=function(t){t.preventDefault(),n.render({enableDoneAndPost:this.options.enableDoneAndPost},function(t){this.recorderCmp=t.recorderComponent,this.recorderCmp.subscribe(n.Event.DONE,function(t){this.recorderCmp.hide(),this._addSelectedMedia(t.media),this._invokeSuccess(t.doPost)}.bind(this)),this.recorderCmp.subscribe(n.Event.HIDDEN,function(t){this.recorderCmp.destroy()}.bind(this)),this.recorderCmp.show()}.bind(this))},l.prototype._onClickUploadFile=function(t){t.preventDefault(),this.$resourceFile.click()},l.prototype._onClickSelect=function(t){t.preventDefault(),o.render({},function(t){this.mfsCmp=t.myFilesSelectorComponent,this.mfsCmp.subscribe(o.Event.DONE,function(t){this.mfsCmp.hide(),$.each(t.media,function(t,e){this._addSelectedMedia(e)}.bind(this)),this._invokeSuccess()}.bind(this)),this.mfsCmp.subscribe(o.Event.HIDDEN,function(t){this.mfsCmp.destroy()}.bind(this)),this.mfsCmp.show()}.bind(this))},l.prototype._onChangeResourceFile=function(t){t.preventDefault(),this._toggleForm(!0);var e=this.$resourceFile.data("maxsize"),n=this.$resourceFile[0].files[0].size;return n>e?(alert(Translator.trans("form.upload.maxFileSizeExceeded",{fileSize:(n/1048576).toFixed(1)+"MB",maxUploadSize:(e/1048576).toFixed(1)+"MB"})),this.$resourceFile.val(""),void this._toggleForm(!1)):(i.add(this.$uploadForm[0]).progress(function(t){a.updateProgressBar(this.$containerUpload.show(),t)}.bind(this)).done(function(t){this._addSelectedMedia(t.media),this._invokeSuccess(),this._toggleForm(!1)}.bind(this)).fail(function(t){this._resetUpload(),this._dispatch(l.Event.ERROR,{mediaChooserComponent:this,error:t?t.error:"Unknown error"}),this._toggleForm(!1)}.bind(this)),this._dispatch(l.Event.UPLOAD_START,{mediaChooserComponent:this}),void this.$resourceFile.val(""))},l.prototype._toggleForm=function(t){this.$recordVideo.attr("disabled",t),this.$uploadFile.attr("disabled",t),this.$select.attr("disabled",t)},l.prototype.setMedia=function(t){console.log("%s: %s",l.TAG,"setMedia"),"undefined"!=typeof t&&(this._toggleForm(!0),this.$working.show(),e.list(t).done(function(t){this.$working.hide(),this._toggleForm(!1),$.each(t.media,function(t,e){this._addSelectedMedia(e)}.bind(this)),this._invokeSuccess()}.bind(this)).fail(function(t){this.$working.hide(),this._toggleForm(!1),console.error("%s: media factory list",l.TAG)}.bind(this)))},l.prototype.generateFormData=function(t){var e="";return $.each(this.media,function(i,n){var o=$(t.replace(/__name__/g,i));o.val(n.get("id")),e+=o[0].outerHTML}),e},l.prototype.reset=function(){console.log("%s: %s",l.TAG,"reset"),this._resetUpload(),this.galleryCmp.clear(),this._dispatch(l.Event.RESET,{mediaChooserComponent:this})},l.render=function(t,e){var i={enableDoneAndPost:!1};e=e||i;for(var n in i)e[n]="undefined"!=typeof e[n]?e[n]:i[n];return e.$container=t,new l(e)},l}),define("views/contact/listView",["component/tableComponent"],function(t){var e=function(i,n){this.controller=i,this.bind__onSelectionChange=this._onSelectionChange.bind(this),this.bind__onClickBulkAction=this._onClickBulkAction.bind(this),this.$container=n.container,this.$form=this.$container.find("form[name^="+e.FORM_NAME+"]"),this.$tabPanes=this.$container.find(e.Binder.TAB_PANES),this.tabPaneTblCmps=[],this.$tabPanes.each(function(e,i){this.tabPaneTblCmps[i.id]=t.table($(i)),this.tabPaneTblCmps[i.id].subscribe(t.Event.SELECTION_CHANGE,this.bind__onSelectionChange),this.tabPaneTblCmps[i.id].subscribe(t.Event.CLICK_BULK_ACTION,this.bind__onClickBulkAction)}.bind(this)),$tt._instances.push(this)};return e.TAG="ContactListView",e.Binder={TAB_PANES:".tab-pane[id^=tab]"},e.FORM_NAME="users_select",e.prototype._getFormField=function(t,e){return t.find("#"+t.attr("name")+"_"+e)},e.prototype._onSelectionChange=function(t){var e=t.tableComponent.getBulkActions();e.attr("disabled",0==t.$selection.length)},e.prototype._updateUsersSelectForm=function(t){var e=this._getFormField(this.$form,"users");e.html(""),t.each(function(t,i){var n=e.data("prototype");n=$(n.replace(/__name__/g,t)),n.val($(i).data("uid")),e.append(n)})},e.prototype._onClickBulkAction=function(t){switch(t.action){case 1:var e=t.tableComponent.getTable().attr("id").replace(/^tab/,"").toLowerCase();if("all"==e&&!confirm("This will delete the selected contacts from all lists. Continue?"))break;t.$bulkAction.attr("disabled",!0);var i=[];t.$selection.each(function(t,e){i.push($(e).data("uid"))}),this.controller["delete"](i,e).fail(function(e){e?alert(e.message):alert("Something went wrong."),t.$bulkAction.attr("disabled",!1)});break;case 2:t.$bulkAction.attr("disabled",!0),this._updateUsersSelectForm(t.$selection),this.$form.attr("action",Routing.generate("imdc_group_new")),this.$form.submit();break;case 3:t.$bulkAction.attr("disabled",!0),this._updateUsersSelectForm(t.$selection),this.$form.attr("action",Routing.generate("imdc_message_new")),this.$form.submit()}},e}),define("views/forum/newView",["component/mediaChooserComponent","component/accessTypeComponent"],function(t,e){var i=function(n,o){this.controller=n,this.bind__onSubmitForm=this._onSubmitForm.bind(this),this.bind__onUploadStart=this._onUploadStart.bind(this),this.bind__onSuccess=this._onSuccess.bind(this),this.bind__onRemove=this._onRemove.bind(this),this.bind__onReset=this._onReset.bind(this),this.bind__onError=this._onError.bind(this),this.$container=o.container,this.$form=this.$container.find("form[name^="+i.FORM_NAME+"]"),this.$submit=this.$container.find(i.Binder.SUBMIT),this.$form.on("submit",this.bind__onSubmitForm),this.atCmp=e.render(this.$form),this.mcCmp=t.render(this.$form),this.mcCmp.subscribe(t.Event.UPLOAD_START,this.bind__onUploadStart),this.mcCmp.subscribe(t.Event.SUCCESS,this.bind__onSuccess),this.mcCmp.subscribe(t.Event.REMOVE,this.bind__onRemove),this.mcCmp.subscribe(t.Event.RESET,this.bind__onReset),this.mcCmp.subscribe(t.Event.ERROR,this.bind__onError);var r=[];this._getFormField("titleMedia").children().each(function(t,e){r.push($(e).val())}),r.length>0&&(this.$submit.attr("disabled",!0),this.mcCmp.setMedia(r)),$tt._instances.push(this)};return i.TAG="ForumNewView",i.Binder={SUBMIT:".forum-submit"},i.FORM_NAME="forum",i.prototype._getFormField=function(t){return this.$form.find("#"+i.FORM_NAME+"_"+t)},i.prototype._onSubmitForm=function(t){this.$form[0].checkValidity()&&this.$submit.button("loading")},i.prototype._updateForm=function(){var t=this._getFormField("titleMedia");t.html(this.mcCmp.generateFormData(t.data("prototype"))),t=this._getFormField("titleText"),t.attr("required",0==this.mcCmp.media.length),t=t.parent().find("label"),0==this.mcCmp.media.length?t.addClass("required"):t.removeClass("required")},i.prototype._onUploadStart=function(t){this.$submit.attr("disabled",!0)},i.prototype._onSuccess=function(t){this._updateForm(),this.$submit.attr("disabled",!1)},i.prototype._onRemove=function(t){this._updateForm()},i.prototype._onReset=function(t){this._updateForm()},i.prototype._onError=function(t){alert("Error: "+t.error)},i}),define("views/forum/editView",["views/forum/newView"],function(t){var e=function(i,n){t.prototype.constructor.apply(this,arguments),this.bind__onClickDelete=this._onClickDelete.bind(this),this.$deleteModal=this.$container.find(e.Binder.DELETE_MODAL),this.$delete=this.$container.find(e.Binder.DELETE),this.$delete.on("click",this.bind__onClickDelete)};return e.extend(t),e.TAG="ForumEditView",e.Binder.DELETE_MODAL=".forum-delete-modal",e.Binder.DELETE=".forum-delete",e.prototype._onClickDelete=function(t){t.preventDefault(),this.$delete.button("loading"),this.controller["delete"]().done(function(t){this.$deleteModal.find(".modal-body").html("Forum deleted successfully.")}.bind(this)).fail(function(){this.$container.find(".modal-body").prepend("Something went wrong. Try again."),this.$delete.button("reset")}.bind(this))},e}),define("views/forum/listView",["component/galleryComponent"],function(t){var e=function(t,i){this.controller=t,this.bind__onClickThumbnail=this._onClickThumbnail.bind(this),this.$container=i.container,this.$thumbnails=this.$container.find(e.Binder.THUMBNAILS),this.$thumbnails.on("click",this.bind__onClickThumbnail),$tt._instances.push(this)};return e.TAG="ForumListView",e.Binder={THUMBNAILS:".tt-grid-div-body .expand"},e.prototype._onClickThumbnail=function(e){e.preventDefault(),t.render({mediaIds:[$(e.currentTarget).data("mid")]},function(e){this.galleryCmp=e.galleryComponent,this.galleryCmp.subscribe(t.Event.HIDDEN,function(t){this.galleryCmp.destroy()}.bind(this)),this.galleryCmp.show()}.bind(this))},e}),define("views/forum/viewView",["component/galleryComponent"],function(t){var e=function(i,n){this.controller=i,this.bind__onClickThumbnail=this._onClickThumbnail.bind(this),this.$container=n.container,this.$gallery=this.$container.find(e.Binder.GALLERY),this.$thumbnails=this.$container.find(e.Binder.THUMBNAILS),this.$thumbnails.on("click",this.bind__onClickThumbnail);var o=this.controller.model.get("ordered_media");o.length>0&&t.render({$container:this.$gallery,mode:t.Mode.INLINE,media:o},function(t){this.galleryCmp=t.galleryComponent,this.galleryCmp.show()}.bind(this)),$tt._instances.push(this)};return e.TAG="ForumViewView",e.Binder={GALLERY:".forum-gallery",THUMBNAILS:".tt-grid-div-body .expand"},e.prototype._onClickThumbnail=function(e){e.preventDefault(),t.render({mediaIds:[$(e.currentTarget).data("mid")]},function(e){this.galleryCmp=e.galleryComponent,this.galleryCmp.subscribe(t.Event.HIDDEN,function(t){this.galleryCmp.destroy()}.bind(this)),this.galleryCmp.show()}.bind(this))},e}),define("views/group/newView",["component/mediaChooserComponent"],function(t){var e=function(i,n){this.controller=i,this.bind__onSubmitForm=this._onSubmitForm.bind(this),this.bind__onUploadStart=this._onUploadStart.bind(this),this.bind__onSuccess=this._onSuccess.bind(this),this.bind__onReset=this._onReset.bind(this),this.bind__onError=this._onError.bind(this),this.$container=n.container,this.$form=this.$container.find("form[name^="+e.FORM_NAME+"]"),this.$submit=this.$container.find(e.Binder.SUBMIT),this.$form.on("submit",this.bind__onSubmitForm),this.mcCmp=t.render(this.$form),this.mcCmp.subscribe(t.Event.UPLOAD_START,this.bind__onUploadStart),this.mcCmp.subscribe(t.Event.SUCCESS,this.bind__onSuccess),this.mcCmp.subscribe(t.Event.RESET,this.bind__onReset),this.mcCmp.subscribe(t.Event.ERROR,this.bind__onError);var o=[];this._getFormField("media").children().each(function(t,e){o.push($(e).val())}),o.length>0&&(this.$submit.attr("disabled",!0),this.mcCmp.setMedia(o)),$tt._instances.push(this)};return e.TAG="GroupNewView",e.Binder={SUBMIT:".group-submit"},e.FORM_NAME="user_group",e.prototype._getFormField=function(t){return this.$form.find("#"+e.FORM_NAME+"_"+t)},e.prototype._onSubmitForm=function(t){this.$form[0].checkValidity()&&this.$submit.button("loading")},e.prototype._updateForm=function(){var t=this._getFormField("media");t.html(this.mcCmp.generateFormData(t.data("prototype")))},e.prototype._onUploadStart=function(t){this.$submit.attr("disabled",!0)},e.prototype._onSuccess=function(t){this._updateForm(),this.$submit.attr("disabled",!1)},e.prototype._onReset=function(t){this._updateForm()},e.prototype._onError=function(t){alert("Error: "+t.error)},e}),define("views/group/editView",["views/group/newView"],function(t){var e=function(i,n){t.prototype.constructor.apply(this,arguments),this.bind__onClickDelete=this._onClickDelete.bind(this),this.$deleteModal=this.$container.find(e.Binder.DELETE_MODAL),this.$delete=this.$container.find(e.Binder.DELETE),this.$delete.on("click",this.bind__onClickDelete)};return e.extend(t),e.TAG="GroupEditView",e.Binder.DELETE_MODAL=".group-delete-modal",e.Binder.DELETE=".group-delete",e.prototype._onClickDelete=function(t){t.preventDefault(),this.$delete.button("loading"),this.controller["delete"]().done(function(t){this.$deleteModal.find(".modal-body").html("Group deleted successfully.")}.bind(this)).fail(function(){this.$container.find(".modal-body").prepend("Something went wrong. Try again."),this.$delete.button("reset")}.bind(this))},e}),define("views/group/listView",["component/galleryComponent"],function(t){var e=function(t,i){this.controller=t,this.bind__onClickThumbnail=this._onClickThumbnail.bind(this),this.$container=i.container,this.$thumbnails=this.$container.find(e.Binder.THUMBNAILS),this.$thumbnails.on("click",this.bind__onClickThumbnail),$tt._instances.push(this)};return e.TAG="GroupListView",e.Binder={THUMBNAILS:".tt-grid-div-body .expand"},e.prototype._onClickThumbnail=function(e){e.preventDefault(),t.render({mediaIds:[$(e.currentTarget).data("mid")]},function(e){this.galleryCmp=e.galleryComponent,this.galleryCmp.subscribe(t.Event.HIDDEN,function(t){this.galleryCmp.destroy()}.bind(this)),this.galleryCmp.show()}.bind(this))},e}),define("views/group/viewView",["component/galleryComponent"],function(t){var e=function(i,n){this.controller=i,this.bind__onClickThumbnail=this._onClickThumbnail.bind(this),this.$container=n.container,this.$gallery=this.$container.find(e.Binder.GALLERY),this.$thumbnails=this.$container.find(e.Binder.THUMBNAILS),this.$thumbnails.on("click",this.bind__onClickThumbnail);var o=this.controller.model.get("ordered_media");o.length>0&&t.render({$container:this.$gallery,mode:t.Mode.INLINE,media:o},function(t){this.galleryCmp=t.galleryComponent,this.galleryCmp.show()}.bind(this)),$tt._instances.push(this)};return e.TAG="GroupViewView",e.Binder={GALLERY:".group-gallery",THUMBNAILS:".tt-grid-div-body .expand"},e.prototype._onClickThumbnail=function(e){e.preventDefault(),t.render({mediaIds:[$(e.currentTarget).data("mid")]},function(e){this.galleryCmp=e.galleryComponent,this.galleryCmp.subscribe(t.Event.HIDDEN,function(t){this.galleryCmp.destroy()}.bind(this)),this.galleryCmp.show()}.bind(this))},e}),define("views/group/manageView",["component/tableComponent"],function(t){var e=function(i,n){this.controller=i,this.bind___onClickFormCheckboxLink=this._onClickFormCheckboxLink.bind(this),this.bind__onShownTab=this._onShownTab.bind(this),this.bind__onClickRemove=this._onClickRemove.bind(this),this.bind__onClickAdd=this._onClickAdd.bind(this),this.$container=n.container,this.$formSearch=this.$container.find("form[name^="+e.FORM_NAME_SEARCH+"]"),this.$formRemove=this.$container.find("form[name^="+e.FORM_NAME_REMOVE+"]"),this.$formAdd=this.$container.find("form[name^="+e.FORM_NAME_ADD+"]"),this.$formCheckboxLinks=this.$formSearch.find('label[class^="checkbox"] a'),this.$tabs=this.$container.find(e.Binder.TABS),this.$tabPanes=this.$container.find(e.Binder.TAB_PANES),this.$remove=this.$container.find(e.Binder.REMOVE),this.$add=this.$container.find(e.Binder.ADD),this.$formCheckboxLinks.on("click",this.bind___onClickFormCheckboxLink),this.$tabs.on("shown.bs.tab",this.bind__onShownTab),this.$remove.on("click",this.bind__onClickRemove),this.$add.on("click",this.bind__onClickAdd);var o=function(t){this.$remove.attr("disabled",0==t.$selection.length)}.bind(this),r=function(t){this.$add.attr("disabled",0==t.$selection.length)}.bind(this),s=function(t){return"remove"==t?o:r};this.tableCmps=[],this.$tabPanes.each(function(e,i){var n=$(i),o=s(n.data("type")),r=t.table(n);r.subscribe(t.Event.SELECTION_CHANGE,o),this.tableCmps.push(r)}.bind(this)),this.$tabs.filter('[href="'+(location.hash?"#tab"+location.hash.substr(1):"#tabMembers")+'"]').tab("show"),$tt._instances.push(this)};return e.TAG="GroupManageView",e.Binder={TABS:'a[data-toggle="tab"]',TAB_PANES:"[id^=tab]",REMOVE:".group-remove",ADD:".group-add"},e.FORM_NAME="ugm_",e.FORM_NAME_SEARCH=e.FORM_NAME+"search",e.FORM_NAME_REMOVE=e.FORM_NAME+"remove",e.FORM_NAME_ADD=e.FORM_NAME+"add",e.prototype._getFormField=function(t,e){return t.find("#"+t.attr("name")+"_"+e)},e.prototype._onClickFormCheckboxLink=function(t){t.preventDefault();var e=this.$formSearch.find('input[type="checkbox"]'),i=$(t.target).parent().find('input[type="checkbox"]'),n=i.prop("checked");e.prop("checked",!1),i.prop("checked",!n),this.$formSearch[0].submit()},e.prototype._onShownTab=function(t){var e="#"+$(t.target).attr("href").substr(4);history.pushState?history.pushState(null,null,e):location.hash=e,this.$tabPanes.find("ul.pagination li a").each(function(t,i){var n=$(i),o=n.attr("href"),t=o.lastIndexOf("#");t>0&&(o=o.substring(0,t)),n.attr("href",o+e)})},e.prototype._updateUsersSelectForm=function(t,e){var i=this._getFormField(t,"users");e.button("loading"),e.toggleClass("disabled"),i.html(""),$.each(this.tableCmps,function(t,e){e.getSelection().each(function(t,e){var n=i.data("prototype");n=$(n.replace(/__name__/g,t)),n.val($(e).data("uid")),i.append(n)})}.bind(this))},e.prototype._onClickRemove=function(t){t.preventDefault(),this._updateUsersSelectForm(this.$formRemove,this.$remove),this.$formRemove.submit()},e.prototype._onClickAdd=function(t){t.preventDefault(),this._updateUsersSelectForm(this.$formAdd,this.$add),this.$formAdd.submit()},e}),define("views/home/indexView",["component/galleryComponent"],function(t){var e=function(t,i){this.controller=t,this.bind__onClickThumbnail=this._onClickThumbnail.bind(this),this.$container=i.container,this.$thumbnails=this.$container.find(e.Binder.THUMBNAILS),this.$thumbnails.on("click",this.bind__onClickThumbnail),$tt._instances.push(this)};return e.TAG="HomeIndexView",e.Binder={THUMBNAILS:".tt-grid-div-body .expand"},e.prototype._onClickThumbnail=function(e){e.preventDefault(),t.render({mediaIds:[$(e.currentTarget).data("mid")]},function(e){this.galleryCmp=e.galleryComponent,this.galleryCmp.subscribe(t.Event.HIDDEN,function(t){this.galleryCmp.destroy()}.bind(this)),this.galleryCmp.show()}.bind(this))},e}),define("views/message/newView",["component/mediaChooserComponent"],function(t){var e=function(i,n){this.controller=i,this.bind__onSubmitForm=this._onSubmitForm.bind(this),this.bind__onUploadStart=this._onUploadStart.bind(this),this.bind__onSuccess=this._onSuccess.bind(this),this.bind__onReset=this._onReset.bind(this),this.bind__onError=this._onError.bind(this),this.$container=n.container,this.$form=this.$container.find("form[name^="+e.FORM_NAME+"]"),this.$submit=this.$container.find(e.Binder.SUBMIT),this.$form.on("submit",this.bind__onSubmitForm),this.mcCmp=t.render(this.$form),this.mcCmp.subscribe(t.Event.UPLOAD_START,this.bind__onUploadStart),this.mcCmp.subscribe(t.Event.SUCCESS,this.bind__onSuccess),this.mcCmp.subscribe(t.Event.RESET,this.bind__onReset),this.mcCmp.subscribe(t.Event.ERROR,this.bind__onError);var o=[];this._getFormField("attachedMedia").children().each(function(t,e){o.push($(e).val())}),o.length>0&&(this.$submit.attr("disabled",!0),this.mcCmp.setMedia(o)),this._getFormField("recipients").tagit(),$tt._instances.push(this)};return e.TAG="MessageNewView",e.Binder={SUBMIT:".message-submit"},e.FORM_NAME="PrivateMessageForm",e.prototype._getFormField=function(t){return this.$form.find("#"+e.FORM_NAME+"_"+t)},e.prototype._onSubmitForm=function(t){this.$form[0].checkValidity()&&this.$submit.button("loading")},e.prototype._updateForm=function(){var t=this._getFormField("attachedMedia");t.html(this.mcCmp.generateFormData(t.data("prototype")))},e.prototype._onUploadStart=function(t){this.$submit.attr("disabled",!0)},e.prototype._onSuccess=function(t){this.$submit.attr("disabled",!1),this._updateForm()},e.prototype._onReset=function(t){this._updateForm()},e.prototype._onError=function(t){alert("Error: "+t.error)},e}),define("views/message/replyView",["views/message/newView"],function(t){var e=function(e,i){t.prototype.constructor.apply(this,arguments)};return e.extend(t),e.TAG="MessageReplyView",e}),define("views/message/viewView",["component/galleryComponent"],function(t){var e=function(i,n){this.controller=i,this.$container=n.container,this.$gallery=this.$container.find(e.Binder.GALLERY);var o=this.controller.model.get("ordered_media");o.length>0&&t.render({$container:this.$gallery,mode:t.Mode.INLINE,media:o},function(t){this.galleryCmp=t.galleryComponent,this.galleryCmp.show()}.bind(this)),$tt._instances.push(this)};return e.TAG="MessageViewView",e.Binder={GALLERY:".message-gallery"},e}),define("views/myFiles/listView",["service","model/model","component/tableComponent","component/mediaChooserComponent","component/galleryComponent","core/helper"],function(t,e,i,n,o,r){var s=function(o,r){this.controller=o,this.bind__onClickBulkAction=this._onClickBulkAction.bind(this),this.bind__onClickFile=this._onClickFile.bind(this),this.bind__onSuccess=this._onSuccess.bind(this),this.bind__onError=this._onError.bind(this),this.bind__onAddGridElement=this._onAddGridElement.bind(this),this.bind__onAddListElement=this._onAddListElement.bind(this),this.$container=r.container,this.$filesList=this.$container.find(s.Binder.FILES_LIST),this.$fileButtons=this.$container.find(s.Binder.FILE_BUTTON),this.tblCmp=i.table(this.$filesList),this.tblCmp.subscribe(i.Event.CLICK_BULK_ACTION,this.bind__onClickBulkAction),this.$filesList.find("button.edit-title").on("click",function(t){t.stopPropagation(),$(this).parent().parent().parent().find("span.edit-title").editable("toggle")}),this.$fileButtons.not("[disabled]").on("click",this.bind__onClickFile),this.$filesList.children("div.table-responsive").length>0?this.style=s.Binder.STYLE_LIST:this.style=s.Binder.STYLE_GRID,this.mcCmp=n.render(this.$container),this.mcCmp.subscribe(n.Event.SUCCESS,this.bind__onSuccess),this.mcCmp.subscribe(n.Event.RESET,this.bind__onReset),this.mcCmp.subscribe(n.Event.ERROR,this.bind__onError),this.$filesList.find("span.edit-title").editable({toggle:"manual",unsavedclass:null,pk:function(){return $(this).data("mid")},url:function(t){return this.controller.edit(t.pk,{title:t.value})}.bind(this)});var a=t.get("subscriber");a.dispatch(s.TAG,"onViewLoaded",{view:this}),this.controller.model.subscribe(e.Event.CHANGE,function(t){var e=t.model.get(t.keyPath),i=this.$filesList.find('span.edit-title[data-mid="'+e.get("id")+'"]');i.html(e.get("title"))}.bind(this)),$tt._instances.push(this)};return s.TAG="MyFilesListView",s.Binder={TOGGLE_STYLE:".my-files-selector-toggle-style",FILES_LIST:".my-files-selector-files-list",FILE_BUTTON:".my-files-selector-file-button",STYLE_LIST:"list",STYLE_GRID:"grid"},s.MAX_PER_PAGE=24,s.MAX_PER_ROW=4,s.prototype._onClickBulkAction=function(t){switch(t.action){case 1:if(confirm(Translator.trans("filesGateway.deleteConfirmMessage"))){$.each(t.$selection,function(t,e){this.controller["delete"]($(e).data("mid"),!0);var i;i=this.style==s.Binder.STYLE_LIST?$(e).parents("tr"):$(e).parents("div.col-md-3"),i.fadeOut(1e3,function(){i.remove()}),$(e).prop("checked",!1)}.bind(this));var e=setInterval(function(){this.$filesList=this.$container.find(s.Binder.FILES_LIST),this.$fileButtons=this.$container.find(s.Binder.FILE_BUTTON);var t=$(this.$fileButtons).parent("div.thumbnail.tt-grid-div-body").parent();if(!$(t).is(":animated")&&(this.tblCmp.updateElements(this.$filesList),clearInterval(e),this.style==s.Binder.STYLE_GRID)){for(var i=$(t).parent(),n=$(this.$fileButtons).parent("div.thumbnail.tt-grid-div-body").length,o=1;n>o;o++)$(t[o]).parent().is($(t[o-1]).parent())||o%s.MAX_PER_ROW==0||$(t[o]).insertAfter($(t[o-1]));$.each($(i),function(t,e){0==$(e).children().length&&$(e).remove()})}}.bind(this),200)}}},s.prototype._onClickFile=function(t){t.stopPropagation();var e=this.controller.model.getMedia($(t.currentTarget).data("mid"));if(!e)throw new Error("media not found");o.render({media:this.controller.model.get("media"),activeMedia:e},function(t){this.galleryCmp=t.galleryComponent,this.galleryCmp.subscribe(o.Event.HIDDEN,function(t){this.galleryCmp.destroy()}.bind(this)),this.galleryCmp.show()}.bind(this))},s.prototype.getTableComponent=function(){return this.tblCmp},s.prototype._onAddGridElement=function(t,e){var i=$(e),n=$(this.$fileButtons).parent("div.thumbnail.tt-grid-div-body").length,o=$(this.$fileButtons).parent("div.thumbnail.tt-grid-div-body").parent();if(n>=s.MAX_PER_PAGE){i.insertBefore(o[0]);for(var r=s.MAX_PER_ROW-1;n>r;r+=s.MAX_PER_ROW)$(o[r]).insertBefore($(o[r+1]));$(o[n-1]).remove()}else if(n%s.MAX_PER_ROW==0){
var a=$("<div class='row'></div>"),l=$(this.$filesList.children("div.tt-myFiles-grid-div")[0]);if(0==n)l.empty(),a.append(i),l.append(a);else{i.insertBefore(o[0]);for(var r=s.MAX_PER_ROW-1;n>r;r+=s.MAX_PER_ROW)$(o[r]).insertBefore($(o[r+1]));l.append(a),a.append($(o[n-1]).detach())}}else{i.insertBefore(o[0]);for(var r=s.MAX_PER_ROW-1;n>r;r+=s.MAX_PER_ROW)$(o[r]).insertBefore($(o[r+1]))}i.find("button.edit-title").on("click",function(t){t.stopPropagation(),$(this).parent().parent().parent().find("span.edit-title").editable("toggle")}),i.find("span.edit-title").editable({toggle:"manual",unsavedclass:null,pk:function(){return $(this).data("mid")},url:function(t){return this.controller.edit(t.pk,{title:t.value})}.bind(this)}),i.find(".my-files-selector-file-click").not("[disabled]").on("click",this.bind__onClickFile),this.$filesList=this.$container.find(s.Binder.FILES_LIST),this.$fileButtons=this.$container.find(s.Binder.FILE_BUTTON),this.tblCmp.updateElements(this.$filesList)},s.prototype._onAddListElement=function(t,e){var i=$(e),n=$(this.$fileButtons).parent("tr").length,o=$(this.$fileButtons).parent("tr");n>=s.MAX_PER_PAGE?(i.insertBefore(o[0]),o[n-1].remove()):0==n?($(this.$filesList).find("div.table-responsive > div").remove(),o=$(this.$filesList).find("tbody > tr"),i.insertBefore(o[0]),$(o[0]).remove()):i.insertBefore(o[0]),i.find("button.edit-title").on("click",function(t){t.stopPropagation(),$(this).parent().parent().parent().find("span.edit-title").editable("toggle")}),i.find("span.edit-title").editable({toggle:"manual",unsavedclass:null,pk:function(){return $(this).data("mid")},url:function(t){return this.controller.edit(t.pk,{title:t.value})}.bind(this)}),i.find(".my-files-selector-file-click").not("[disabled]").on("click",this.bind__onClickFile),this.$filesList=this.$container.find(s.Binder.FILES_LIST),this.$fileButtons=this.$container.find(s.Binder.FILE_BUTTON),this.tblCmp.updateElements(this.$filesList)},s.prototype._onSuccess=function(t){console.log(t);var e=t.media[t.media.length-1].data;if(this.controller.model.addMedia(e),this.style==s.Binder.STYLE_GRID)dust.render("myFilesGridElement",{media:e,previewTitle:Translator.trans("filesGateway.previewLink"),editTitle:Translator.trans("form.media.title"),shareTitle:Translator.trans("filesGateway.shareLink"),shareUrl:Routing.generate("imdc_thread_new_from_media",{mediaId:e.id}),mediaIcon:r.getIconForMediaType(e.type)},this.bind__onAddGridElement);else{var i=r.formatSize(e.source_resource.meta_data.size),n=!1;0>i&&(n=!0),dust.render("myFilesListElement",{media:e,previewTitle:Translator.trans("filesGateway.previewLink"),editTitle:Translator.trans("form.media.title"),shareTitle:Translator.trans("filesGateway.shareLink"),shareUrl:Routing.generate("imdc_thread_new_from_media",{mediaId:e.id}),mediaIcon:r.getIconForMediaType(e.type),timeUploaded:dust.filters.date(e.source_resource.meta_data.time_created),spinner:n,formattedSize:i},this.bind__onAddListElement)}},s.prototype._onError=function(t){alert("Error: "+t.error)},s}),define("views/post/newView",["model/model","component/mediaChooserComponent"],function(t,e){var i=function(n,o){this.controller=n,this.options=o,this.bind__onClickSubmit=this._onClickSubmit.bind(this),this.bind__onClickReset=this._onClickReset.bind(this),this.bind__onClickCancel=this._onClickCancel.bind(this),this.bind__onUploadStart=this._onUploadStart.bind(this),this.bind__onSuccess=this._onSuccess.bind(this),this.bind__onSuccessAndPost=this._onSuccessAndPost.bind(this),this.bind__onReset=this._onReset.bind(this),this.bind__onModelChange=this._onModelChange.bind(this),this.bind__onError=this._onError.bind(this),this.$container=$(i.Binder.CONTAINER+'[data-pid="'+this.controller.model.get("id")+'"]'),this.$form=this.$container.find("form[name^="+i.FORM_NAME+"]"),this.$submit=this.$container.find(i.Binder.SUBMIT),this.$reset=this.$container.find(i.Binder.RESET),this.$cancel=this.$container.find(i.Binder.CANCEL),this.$submit.on("click",this.bind__onClickSubmit),this.$reset.on("click",this.bind__onClickReset),this.$cancel.on("click",this.bind__onClickCancel),this.mcCmp=e.render(this.$form,{enableDoneAndPost:!0}),this.mcCmp.subscribe(e.Event.UPLOAD_START,this.bind__onUploadStart),this.mcCmp.subscribe(e.Event.SUCCESS,this.bind__onSuccess),this.mcCmp.subscribe(e.Event.SUCCESS_AND_POST,this.bind__onSuccessAndPost),this.mcCmp.subscribe(e.Event.RESET,this.bind__onReset),this.mcCmp.subscribe(e.Event.ERROR,this.bind__onError),this.controller.model.subscribe(t.Event.CHANGE,this.bind__onModelChange),$tt._instances.push(this)};return i.TAG="PostNewView",i.Binder={CONTAINER:".post-container",SUBMIT:".post-submit-new",RESET:".post-reset",CANCEL:".post-cancel-new"},i.FORM_NAME="post",i.prototype.loadView=function(){var t=[];this._getFormField("attachedFile").children().each(function(e,i){t.push($(i).val())}),t.length>0&&(this._toggleForm(!0),this.mcCmp.setMedia(t))},i.prototype._getFormField=function(t){return this.$form.find("#"+i.FORM_NAME+"_"+t)},i.prototype._toggleForm=function(t){this.$submit.button(t?"loading":"reset"),this.$reset.attr("disabled",t),this.$cancel.attr("disabled",t)},i.prototype._preSubmit=function(){return""==this._getFormField("content").val()&&0==this.mcCmp.media.length?(alert("Your post cannot be blank. You must either select a file or write a comment."),!1):(this._toggleForm(!0),!0)},i.prototype._reset=function(){this.mcCmp.reset(),this._getFormField("startTime").val(this.controller.model.get("keyPoint.startTime")),this._getFormField("endTime").val(this.controller.model.get("keyPoint.endTime")),this._getFormField("content").val(""),this.controller.editKeyPoint({cancel:!0})},i.prototype._destroy=function(){this.$container.remove(),this.controller.removeKeyPoint(),this.controller.removeFromThread()},i.prototype._onClickSubmit=function(t){t.preventDefault(),this._preSubmit()&&this.controller.post(this.$form[0]).done(function(t){this.controller.addToThread(t.post),this.options.is_permanent?(this._reset(),this._toggleForm(!1)):this._destroy()}.bind(this)).fail(function(t){this.controller.updateInThread("new")}.bind(this))},i.prototype._onClickReset=function(t){t.preventDefault(),this._reset()},i.prototype._onClickCancel=function(t){t.preventDefault(),this._destroy()},i.prototype._onSelectionTimes=function(t,e){this._getFormField("startTime").val(t),this._getFormField("endTime").val(e)},i.prototype._onModelChange=function(t){this._onSelectionTimes(t.model.get("keyPoint.selection.startTime",""),t.model.get("keyPoint.selection.endTime",""))},i.prototype._updateForm=function(){var t=this._getFormField("attachedFile");t.html(this.mcCmp.generateFormData(t.data("prototype")))},i.prototype._onUploadStart=function(t){this.$submit.attr("disabled",!0)},i.prototype._onSuccess=function(t){this._updateForm(),this.$submit.attr("disabled",!1),this._toggleForm(!1)},i.prototype._onSuccessAndPost=function(t){this._updateForm(),this.$submit.trigger("click")},i.prototype._onReset=function(t){this._updateForm()},i.prototype._onError=function(t){alert("Error: "+t.error)},i}),define("views/post/editView",["views/post/newView"],function(t){var e=function(i,n){t.prototype.constructor.apply(this,arguments),this.bind__onClickSubmit=this._onClickSubmit.bind(this),this.bind__onClickCancel=this._onClickCancel.bind(this),this.$submit=this.$container.find(e.Binder.SUBMIT),this.$cancel=this.$container.find(e.Binder.CANCEL),this.$submit.on("click",this.bind__onClickSubmit),this.$cancel.on("click",this.bind__onClickCancel)};return e.extend(t),e.TAG="PostEditView",e.Binder.SUBMIT=".post-submit-edit",e.Binder.CANCEL=".post-cancel-edit",e.prototype._toggleForm=function(t){this.$submit.button(t?"loading":"reset"),this.$cancel.attr("disabled",t)},e.prototype._onClickSubmit=function(t){t.preventDefault(),this._preSubmit()&&this.controller.put(this.$form[0]).done(function(t){this.controller.updateInThread("view"),this.controller.model.get("is_temporal",!1)&&this.controller.editKeyPoint({cancel:!0})}.bind(this)).fail(function(t){this.controller.updateInThread("edit")}.bind(this))},e.prototype._onClickCancel=function(t){t.preventDefault(),this.controller.get().done(function(t){this.controller.updateInThread("view"),this.controller.model.get("is_temporal",!1)&&this.controller.editKeyPoint({cancel:!0})}.bind(this)).fail(function(t){})},e}),define("views/post/viewView",["model/model","component/galleryComponent"],function(t,e){var i=function(n,o){this.controller=n,this.bind__onClickHoverKeyPoint=this._onClickHoverKeyPoint.bind(this),this.bind__onClickNew=this._onClickNew.bind(this),this.bind__onClickEdit=this._onClickEdit.bind(this),this.bind__onClickDelete=this._onClickDelete.bind(this),this.bind__onModelChange=this._onModelChange.bind(this),this.$container=$(i.Binder.CONTAINER+'[data-pid="'+this.controller.model.get("id")+'"]'),this.$timelineKeyPoint=this.$container.find(i.Binder.TIMELINE_KEYPOINT),this.$gallery=this.$container.find(i.Binder.GALLERY),this.$new=this.$container.find(i.Binder.NEW),this.$edit=this.$container.find(i.Binder.EDIT),this.$deleteModal=this.$container.find(i.Binder.DELETE_MODAL),this.$delete=this.$container.find(i.Binder.DELETE),this.$timelineKeyPoint.on("click",this.bind__onClickHoverKeyPoint),this.$timelineKeyPoint.on("dblclick",this.bind__onClickHoverKeyPoint),this.$timelineKeyPoint.hover(this.bind__onClickHoverKeyPoint,this.bind__onClickHoverKeyPoint),this.$new.on("click",this.bind__onClickNew),this.$edit.on("click",this.bind__onClickEdit),this.$delete.on("click",this.bind__onClickDelete),this.controller.model.subscribe(t.Event.CHANGE,this.bind__onModelChange);var r=this.controller.model.get("ordered_media");r&&r.length>0&&e.render({$container:this.$gallery,mode:e.Mode.INLINE,media:r},function(t){this.galleryCmp=t.galleryComponent,this.galleryCmp.show()}.bind(this)),$tt._instances.push(this)};return i.TAG="PostViewView",i.Binder={CONTAINER:".post-container",TIMELINE_KEYPOINT:".post-timeline-keypoint",GALLERY:".post-gallery",NEW:".post-new",EDIT:".post-edit",DELETE_MODAL:".post-delete-modal",DELETE:".post-delete"},i.prototype._onClickHoverKeyPoint=function(t){switch(t.type){case"mouseenter":case"mouseleave":this.controller.hoverKeyPoint({isMouseOver:"mouseenter"==t.type});break;case"click":case"dblclick":t.preventDefault(),this.controller.clickKeyPoint({isDblClick:"dblclick"==t.type})}},i.prototype._onClickNew=function(t){t.preventDefault(),this.$new.hide(),this.controller["new"](null).done(function(t){this.controller.addToThread(t.post)}.bind(this)).fail(function(t){this.$new.show()}.bind(this))},i.prototype._onClickEdit=function(t){t.preventDefault(),this.controller.edit().done(function(t){this.controller.updateInThread("edit"),this.controller.model.get("is_temporal",!1)&&this.controller.editKeyPoint({cancel:!1})}.bind(this)).fail(function(t){})},i.prototype._onClickDelete=function(t){t.preventDefault(),this.$delete.button("loading"),this.controller["delete"]().done(function(t){this.$deleteModal.find(".modal-body").html("Post deleted successfully."),this.$deleteModal.data("bs.modal").isShown?(this.$deleteModal.on("hidden.bs.modal",function(t){this.controller.removeFromThread()}.bind(this)),this.$deleteModal.modal("hide")):this.controller.removeFromThread()}.bind(this)).fail(function(t){this.$container.find(".modal-body").prepend("Something went wrong. Try again."),this.$delete.button("reset")}.bind(this))},i.prototype._renderKeyPoint=function(t,e,n){console.log("%s: %s",i.TAG,"_renderKeyPoint");var o=(100*t/n).toFixed(2),r=(100*e/n).toFixed(2),s=(r-o).toFixed(2);this.$timelineKeyPoint.css({left:o+"%",width:s+"%"})},i.prototype._hoverKeyPoint=function(t){t?this.$container.addClass("tt-post-container-highlight"):this.$container.removeClass("tt-post-container-highlight")},i.prototype._clickKeyPoint=function(t){var e=this.$container.find("video")[0];e&&t&&(e.currentTime=0,e.play())},i.prototype._onModelChange=function(t){this._renderKeyPoint(t.model.get("keyPoint.startTime",""),t.model.get("keyPoint.endTime",""),t.model.get("keyPoint.videoDuration","")),this._hoverKeyPoint(t.model.get("keyPoint.isPlayerHovering",!1)),this._clickKeyPoint(t.model.get("keyPoint.isPlayerPlaying",!1)),this.$new.show()},i}),define("views/profile/editView",[],function(){var t=function(e,i){this.controller=e,this.bind__onClickAddLanguage=this._onClickAddLanguage.bind(this),this.bind__onClickDeleteLanguage=this._onClickDeleteLanguage.bind(this),this.$container=i.container,this.$addLang=this.$container.find(t.Binder.ADD_LANGUAGE),this.$delLang=this.$container.find(t.Binder.DELETE_LANGUAGE),this.$addLang.on("click",this.bind__onClickAddLanguage),this.$delLang.on("click",this.bind__onClickDeleteLanguage),$tt._instances.push(this)};return t.TAG="ProfileEditView",t.Binder={ADD_LANGUAGE:".profile-add-lang",DELETE_LANGUAGE:".profile-del-lang"},t.prototype._onClickAddLanguage=function(t){t.preventDefault();var e,i=$("#foss_user_profile_form_languages"),n=i.data("delete-language-text"),o=i.data("prototype"),r=$("#foss_user_profile_form_languages > li").length;$("#no-languages").remove(),e=$('<button class="btn btn-danger btn-sm profile-del-lang"></a>').html(n),e.on("click",this.bind__onClickDeleteLanguage),o=o.replace(/__name__/g,r),r++;var s=$("<li></li>").html(o);s.append(e),$("#foss_user_profile_form_languages").append(s)},t.prototype._onClickDeleteLanguage=function(t){t.preventDefault();var e=$("#foss_user_profile_form_languages"),i=e.data("no-languages-text"),n=$('<span id="no-languages"></span>').html(i);$(t.target).parent().remove(),0==$("#foss_user_profile_form_languages > li").length&&$("#foss_user_profile_form_languages").append(n)},t}),define("views/thread/newView",["component/mediaChooserComponent","component/accessTypeComponent"],function(t,e){var i=function(n,o){this.controller=n,this.bind__onSubmitForm=this._onSubmitForm.bind(this),this.bind__onUploadStart=this._onUploadStart.bind(this),this.bind__onSuccess=this._onSuccess.bind(this),this.bind__onRemove=this._onRemove.bind(this),this.bind__onReset=this._onReset.bind(this),this.bind__onError=this._onError.bind(this),this.$container=o.container,this.$form=this.$container.find("form[name^="+i.FORM_NAME+"]"),this.$submit=this.$container.find(i.Binder.SUBMIT),this.$form.on("submit",this.bind__onSubmitForm),this.atCmp=e.render(this.$form),this.mcCmp=t.render(this.$form),this.mcCmp.subscribe(t.Event.UPLOAD_START,this.bind__onUploadStart),this.mcCmp.subscribe(t.Event.SUCCESS,this.bind__onSuccess),this.mcCmp.subscribe(t.Event.REMOVE,this.bind__onRemove),this.mcCmp.subscribe(t.Event.RESET,this.bind__onReset),this.mcCmp.subscribe(t.Event.ERROR,this.bind__onError);var r=[];this._getFormField("mediaIncluded").children().each(function(t,e){r.push($(e).val())}),r.length>0&&(this.$submit.attr("disabled",!0),this.mcCmp.setMedia(r)),$tt._instances.push(this)};return i.TAG="ThreadNewView",i.Binder={SUBMIT:".thread-submit"},i.FORM_NAME="thread",i.prototype._getFormField=function(t){return this.$form.find("#"+i.FORM_NAME+"_"+t)},i.prototype._onSubmitForm=function(t){this.$form[0].checkValidity()&&this.$submit.button("loading")},i.prototype._updateForm=function(){var t=this._getFormField("mediaIncluded");t.html(this.mcCmp.generateFormData(t.data("prototype"))),t=this._getFormField("title"),t.attr("required",0==this.mcCmp.media.length),t=t.parent().find("label"),0==this.mcCmp.media.length?t.addClass("required"):t.removeClass("required")},i.prototype._onUploadStart=function(t){this.$submit.attr("disabled",!0)},i.prototype._onSuccess=function(t){this._updateForm(),this.$submit.attr("disabled",!1)},i.prototype._onRemove=function(t){this._updateForm()},i.prototype._onReset=function(t){this._updateForm()},i.prototype._onError=function(t){alert("Error: "+t.error)},i}),define("views/thread/editView",["views/thread/newView"],function(t){var e=function(i,n){t.prototype.constructor.apply(this,arguments),this.bind__onClickDelete=this._onClickDelete.bind(this),this.$deleteModal=this.$container.find(e.Binder.DELETE_MODAL),this.$delete=this.$container.find(e.Binder.DELETE),this.$delete.on("click",this.bind__onClickDelete)};return e.extend(t),e.TAG="ThreadEditView",e.Binder.DELETE_MODAL=".thread-delete-modal",e.Binder.DELETE=".thread-delete",e.prototype._onClickDelete=function(t){t.preventDefault(),this.$delete.button("loading"),this.controller["delete"]().done(function(t){this.$deleteModal.find(".modal-body").html("Topic deleted successfully.")}.bind(this)).fail(function(){this.$container.find(".modal-body").prepend("Something went wrong. Try again."),this.$delete.button("reset")}.bind(this))},e}),define("views/thread/viewView",["model/model","core/helper","bootstrap"],function(t,e,i){var n=function(e,i){this.controller=e,this.options=i,this.player=null,this.playingKeyPoint=null,this.bind__onClickVideoSpeed=this._onClickVideoSpeed.bind(this),this.bind__onClickClosedCaptions=this._onClickClosedCaptions.bind(this),this.bind__onAreaSelectionChanged=this._onAreaSelectionChanged.bind(this),this.bind__onMouseOverKeyPoint=this._onMouseOverKeyPoint.bind(this),this.bind__onMouseOutKeyPoint=this._onMouseOutKeyPoint.bind(this),this.bind__onRightClickKeyPoint=this._onRightClickKeyPoint.bind(this),this.bind__onEndKeyPoint=this._onEndKeyPoint.bind(this),this.bind__onPlaybackStarted=this._onPlaybackStarted.bind(this),this.bind__onPlaybackStopped=this._onPlaybackStopped.bind(this),this.bind__onSeek=this._onSeek.bind(this),this.bind__onModelChange=this._onModelChange.bind(this),this.$container=i.container,this.$opContainer=i.op_container,this.$postContainer=i.post_container;var o=this.$opContainer.find(n.Binder.MEDIA_ELEMENT+" video");if(this.$video=o.eq(2==o.length?1:0),this.$pipVideo=o.eq(2==o.length?0:1),$("#videoSpeed").on("click",this.bind__onClickVideoSpeed),$("#closedCaptions").on("click",this.bind__onClickClosedCaptions),1===this.controller.model.get("type")&&this.controller.model.get("ordered_media").length>0){this.$video.on("loadedmetadata",function(t){this.controller.updateKeyPointDuration(t.target.duration)}.bind(this)),this._createPlayer();var r=this.controller.model.get("ordered_media.0");r&&r.is_interpretation&&(this.$pipVideo[0].currentTime=r.source_start_time)}this.controller.model.subscribe(t.Event.CHANGE,this.bind__onModelChange),$tt._instances.push(this)};return n.TAG="ThreadViewView",n.DEFAULT_TEMPORAL_COMMENT_LENGTH=3,n.Binder={MEDIA_ELEMENT:".thread-media-element"},n.prototype.loadView=function(){var t=[];_.each(this.controller.model.get("posts"),function(e,i,n){t.push(e.data)}),t=_.filter(t,function(t){return t.id>0}),dust.render("thread_view_posts",{posts:t},function(t,e){this.$postContainer.html(e),_.each(this.controller.model.get("posts"),function(t,e,n){t.get("id")<0?i(t,"post","post/new",{is_permanent:!0}):i(t,"post","post/view",{})}),$(window).trigger("resize")}.bind(this))},n.prototype._createPlayer=function(){console.log("%s: %s",n.TAG,"_createPlayer"),this.player=new Player(this.$video,{areaSelectionEnabled:!1,updateTimeType:Player.DENSITY_BAR_UPDATE_TYPE_ABSOLUTE,audioBar:!1,overlayControls:!0,playHeadImage:this.options.player.playHeadImage,playHeadImageOnClick:function(){var t=this.player.getCurrentTime(),e=new KeyPoint(-1,t,t+n.DEFAULT_TEMPORAL_COMMENT_LENGTH,"",{drawOnTimeLine:!0});this._toggleTemporal(!1,e)}.bind(this)}),$(this.player).on(Player.EVENT_AREA_SELECTION_CHANGED,this.bind__onAreaSelectionChanged),$(this.player).on(Player.EVENT_KEYPOINT_MOUSE_OVER,this.bind__onMouseOverKeyPoint),$(this.player).on(Player.EVENT_KEYPOINT_MOUSE_OUT,this.bind__onMouseOutKeyPoint),$(this.player).on(Player.EVENT_KEYPOINT_RIGHT_CLICK,this.bind__onRightClickKeyPoint),$(this.player).on(Player.EVENT_KEYPOINT_END,this.bind__onEndKeyPoint),$(this.player).on(Player.EVENT_PLAYBACK_STARTED,this.bind__onPlaybackStarted),$(this.player).on(Player.EVENT_PLAYBACK_STOPPED,this.bind__onPlaybackStopped),$(this.player).on(Player.EVENT_SEEK,this.bind__onSeek),this.player.createControls()},n.prototype._onAreaSelectionChanged=function(t){console.log("%s: %s",n.TAG,Player.EVENT_AREA_SELECTION_CHANGED),this.controller.updateKeyPointSelectionTimes(this.player.getAreaSelectionTimes())},n.prototype._onMouseOverKeyPoint=function(t,e,i){console.log("%s: %s- keyPoint=%o, coords=%o",n.TAG,Player.EVENT_KEYPOINT_MOUSE_OVER,e,i),this.controller.hoverKeyPoint(e.id,{isMouseOver:!0}),this.$postContainer.is(":animated")||this.$postContainer.animate({scrollTop:$(".post-container[data-pid="+e.id+"]").position().top})},n.prototype._onMouseOutKeyPoint=function(t,e){console.log("%s: %s- keyPoint=%o",n.TAG,Player.EVENT_KEYPOINT_MOUSE_OUT,e),this.controller.hoverKeyPoint(e.id,{isMouseOver:!1})},n.prototype._onRightClickKeyPoint=function(t,e,i){console.log("%s: %s- keyPoint=%o, coords=%o",n.TAG,Player.EVENT_KEYPOINT_RIGHT_CLICK,e,i),this.controller.rightClickKeyPoint(e.id)},n.prototype._onEndKeyPoint=function(t,e){console.log("%s: %s- keyPoint=%o",n.TAG,Player.EVENT_KEYPOINT_END,e),this.playingKeyPoint&&this.playingKeyPoint.id==e.id&&this.player.pause()},n.prototype._onPlaybackStarted=function(t){console.log("%s: %s",n.TAG,Player.EVENT_PLAYBACK_STARTED),0!=this.$pipVideo.length&&this.$pipVideo[0].play()},n.prototype._onPlaybackStopped=function(t){console.log("%s: %s",n.TAG,Player.EVENT_PLAYBACK_STOPPED),0!=this.$pipVideo.length&&this.$pipVideo[0].pause()},n.prototype._onSeek=function(t,e){console.log("%s: %s- time=%s",n.TAG,Player.EVENT_SEEK,e),0!=this.$pipVideo.length&&(this.$pipVideo[0].currentTime=Math.min(this.player.getCurrentTime()+this.controller.model.get("ordered_media.0.source_start_time"),this.$pipVideo[0].duration))},n.prototype._toggleTemporal=function(t,e){this.player.pause(),this.playingKeyPoint=null,!t&&e?(this.player.setPlayHeadImage(""),this.player.seek(e.startTime),this.player.setAreaSelectionStartTime(e.startTime),this.player.setAreaSelectionEndTime(e.endTime),this.player.setAreaSelectionEnabled(!0)):(this.player.setPlayHeadImage(this.options.player.playHeadImage),this.player.setAreaSelectionEnabled(!1))},n.prototype._onModelChange=function(t){if(0==t.keyPath.indexOf("posts.")&&t.view){var n=t.model.get(t.keyPath);if("new"==t.view&&dust.render("post_new",n.data,function(t,o){var r=this.$container.find('.post-container[data-pid="'+n.get("id")+'"]');if(r.length>0)r.replaceWith(o),r=this.$container.find('.post-container[data-pid="'+n.get("id")+'"]');else{var r=this.$postContainer.find('.post-container[data-pid="'+n.get("parent_post_id")+'"]');r.after(o)}e.autoSize(),i(n,"post","post/new",{is_permanent:$.contains(this.$opContainer[0],r[0])}),$(window).trigger("resize")}.bind(this)),"edit"==t.view&&dust.render("post_edit",n.data,function(t,o){var r=this.$postContainer.find('.post-container[data-pid="'+n.get("id")+'"]');r.replaceWith(o),e.autoSize(),i(n,"post","post/edit",{}),$(window).trigger("resize")}.bind(this)),"view"==t.view){var o=this.$postContainer.find(".post-container[data-pid]"),r=0==o.length?"thread_view_posts":"post_view",s="thread_view_posts"==r?{posts:[n.data]}:n.data;dust.render(r,s,function(e,s){if("thread_view_posts"==r)this.$postContainer.html(s);else if(t.isNew)if(n.get("is_post_reply")){var a=n.get("parent_post_id");l=o.filter('[data-ppid="'+a+'"]'),0==l.length&&(l=o.filter('[data-pid="'+a+'"]')),l.last().after(s)}else o.last().after(s);else{var l=this.$postContainer.find('.post-container[data-pid="'+n.get("id")+'"]');l.replaceWith(s)}i(n,"post","post/view",{}),$(window).trigger("resize")}.bind(this))}}if("posts"==t.keyPath){var o=this.$postContainer.find(".post-container[data-pid]"),a=[],l=[];_.each(t.model.get("posts"),function(t,e,i){a.push(t.get("id"))}),l=_.filter(o,function(t){var e=parseInt($(t).data("pid"),10);return e>0&&!_.contains(a,e)}),_.each(l,function(t,e,i){var n=$(t);n.fadeOut("slow",function(t){n.remove(),o.length==l.length&&(e==o.length-1?dust.render("thread_view_posts",{},function(t,e){this.$postContainer.html(e),$(window).trigger("resize")}.bind(this)):$(window).trigger("resize"))}.bind(this))}.bind(this))}if(this.player&&(this.player.setKeyPoints(t.model.get("keyPoints",[])),this.controller.updateKeyPointDuration(this.$video[0].duration),0==t.keyPath.indexOf("keyPoints."))){var d=t.model.get(t.keyPath.substr(0,t.keyPath.lastIndexOf(".")));d instanceof KeyPoint&&(d.isEditing?this._toggleTemporal(!(d.startTime&&d.endTime),d):this._toggleTemporal(!0),d.isSeeking&&(d.paintHighlightedTimeout=!0,d.paintHighlighted=!0,this.player.seek(d.startTime),this.player.redrawKeyPoints=!0,setTimeout(function(){d.paintHighlightedTimeout=!1,d.paintHighlighted=!1,this.player.redrawKeyPoints=!0,this.player.repaint()}.bind(this),3e3)),d.isPlaying?(this.playingKeyPoint=d,this.player.seek(d.startTime),this.player.play()):d.isHovering?(d.paintHighlighted=!0,this.player.redrawKeyPoints=!0):d.paintHighlightedTimeout||(d.paintHighlighted=!1,this.player.redrawKeyPoints=!0),this.player.repaint())}},n.prototype._onClickVideoSpeed=function(t){t.preventDefault();var e=this.controller.adjustVideoSpeed();this.$video[0].playbackRate=e.value,0!=this.$pipVideo.length&&(this.$pipVideo[0].playbackRate=e.value),$(t.target).attr("src",e.image)},n.prototype._onClickClosedCaptions=function(t){t.preventDefault();var e=$("#closed-caption-button img").attr("src");e=e==this.options.player.captionImages.on?this.options.player.captionImages.off:this.options.player.captionImages.on,$("#closed-caption-button img").attr("src",e)},n}),define("main",["bootstrap","service","core/dust","core/helper","core/subscriber","factory/contactFactory","factory/forumFactory","factory/groupFactory","factory/mediaFactory","factory/messageFactory","factory/myFilesFactory","factory/postFactory","factory/threadFactory","service/keyPointService","service/rabbitmqWebStompService","service/subscriberService","service/threadPostService","model/forumModel","model/groupModel","model/mediaModel","model/messageModel","model/myFilesModel","model/postModel","model/profileModel","model/threadModel","model/userModel","controller/contactController","controller/forumController","controller/groupController","controller/homeController","controller/messageController","controller/myFilesController","controller/postController","controller/profileController","controller/threadController","component/accessTypeComponent","component/galleryComponent","component/mediaChooserComponent","component/myFilesSelectorComponent","component/recorderComponent","component/tableComponent","views/contact/listView","views/forum/newView","views/forum/editView","views/forum/listView","views/forum/viewView","views/group/newView","views/group/editView","views/group/listView","views/group/viewView","views/group/manageView","views/home/indexView","views/message/newView","views/message/replyView","views/message/viewView","views/myFiles/listView","views/post/newView","views/post/editView","views/post/viewView","views/profile/editView","views/thread/newView","views/thread/editView","views/thread/viewView"],function(){var t={};t._services=[],t._instances=[],window.TerpTube=t,window.$tt=window.TerpTube;var e=require("core/dust"),i=require("core/helper");e.inject(),i.autoSize()}),require(["main"]);