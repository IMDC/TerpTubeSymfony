!function(t,e){"function"==typeof define&&define.amd&&define.amd.dust===!0?define("dust.core",[],e):"object"==typeof exports?module.exports=e():t.dust=e()}(this,function(){function getTemplate(t,e){return t?"function"==typeof t&&t.template?t.template:dust.isTemplateFn(t)?t:e!==!1?dust.cache[t]:void 0:void 0}function load(t,e,n){if(!t)return e.setError(new Error("No template or template name provided to render"));var i=getTemplate(t,dust.config.cache);return i?i(e,Context.wrap(n,i.templateName)):dust.onLoad?e.map(function(e){function i(t,i){var r;if(t)return e.setError(t);if(r=getTemplate(i,!1)||getTemplate(o,dust.config.cache),!r){if(!dust.compile)return e.setError(new Error("Dust compiler not available"));r=dust.loadSource(dust.compile(i,o))}r(e,Context.wrap(n,r.templateName)).end()}var o=t;3===dust.onLoad.length?dust.onLoad(o,n.options,i):dust.onLoad(o,i)}):e.setError(new Error("Template Not Found: "+t))}function Context(t,e,n,i,o){void 0===t||t instanceof Stack||(t=new Stack(t)),this.stack=t,this.global=e,this.options=n,this.blocks=i,this.templateName=o}function getWithResolvedData(t,e,n){return function(i){return t.push(i)._get(e,n)}}function Stack(t,e,n,i){this.tail=e,this.isObject=t&&"object"==typeof t,this.head=t,this.index=n,this.of=i}function Stub(t){this.head=new Chunk(this),this.callback=t,this.out=""}function Stream(){this.head=new Chunk(this)}function Chunk(t,e,n){this.root=t,this.next=e,this.data=[],this.flushable=!1,this.taps=n}function Tap(t,e){this.head=t,this.tail=e}var dust={version:"2.7.2"},NONE="NONE",ERROR="ERROR",WARN="WARN",INFO="INFO",DEBUG="DEBUG",EMPTY_FUNC=function(){};dust.config={whitespace:!1,amd:!1,cjs:!1,cache:!0},dust._aliases={write:"w",end:"e",map:"m",render:"r",reference:"f",section:"s",exists:"x",notexists:"nx",block:"b",partial:"p",helper:"h"},function(){var t,e,n={DEBUG:0,INFO:1,WARN:2,ERROR:3,NONE:4};"undefined"!=typeof console&&console.log?(t=console.log,e="function"==typeof t?function(){t.apply(console,arguments)}:function(){t(Array.prototype.slice.apply(arguments).join(" "))}):e=EMPTY_FUNC,dust.log=function(t,i){i=i||INFO,n[i]>=n[dust.debugLevel]&&e("[DUST:"+i+"]",t)},dust.debugLevel=NONE,"undefined"!=typeof process&&process.env&&/\bdust\b/.test(process.env.DEBUG)&&(dust.debugLevel=DEBUG)}(),dust.helpers={},dust.cache={},dust.register=function(t,e){t&&(e.templateName=t,dust.config.cache!==!1&&(dust.cache[t]=e))},dust.render=function(t,e,n){var i=new Stub(n).head;try{load(t,i,e).end()}catch(o){i.setError(o)}},dust.stream=function(t,e){var n=new Stream,i=n.head;return dust.nextTick(function(){try{load(t,i,e).end()}catch(n){i.setError(n)}}),n},dust.loadSource=function(source){return eval(source)},dust.isArray=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},dust.nextTick=function(){return function(t){setTimeout(t,0)}}(),dust.isEmpty=function(t){return 0===t?!1:dust.isArray(t)&&!t.length?!0:!t},dust.isEmptyObject=function(t){var e;if(null===t)return!1;if(void 0===t)return!1;if(t.length>0)return!1;for(e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0},dust.isTemplateFn=function(t){return"function"==typeof t&&t.__dustBody},dust.isThenable=function(t){return t&&"object"==typeof t&&"function"==typeof t.then},dust.isStreamable=function(t){return t&&"function"==typeof t.on&&"function"==typeof t.pipe},dust.filter=function(t,e,n,i){var o,r,s,a;if(n)for(o=0,r=n.length;r>o;o++)s=n[o],s.length&&(a=dust.filters[s],"s"===s?e=null:"function"==typeof a?t=a(t,i):dust.log("Invalid filter `"+s+"`",WARN));return e&&(t=dust.filters[e](t,i)),t},dust.filters={h:function(t){return dust.escapeHtml(t)},j:function(t){return dust.escapeJs(t)},u:encodeURI,uc:encodeURIComponent,js:function(t){return dust.escapeJSON(t)},jp:function(t){return JSON?JSON.parse(t):(dust.log("JSON is undefined; could not parse `"+t+"`",WARN),t)}},dust.makeBase=dust.context=function(t,e){return new Context(void 0,t,e)},Context.wrap=function(t,e){return t instanceof Context?t:new Context(t,{},{},null,e)},Context.prototype.get=function(t,e){return"string"==typeof t&&("."===t[0]&&(e=!0,t=t.substr(1)),t=t.split(".")),this._get(e,t)},Context.prototype._get=function(t,e){var n,i,o,r,s,a=this.stack||{},l=1;if(i=e[0],o=e.length,t&&0===o)r=a,a=a.head;else{if(t)a&&(a=a.head?a.head[i]:void 0);else{for(;a&&(!a.isObject||(r=a.head,n=a.head[i],void 0===n));)a=a.tail;a=void 0!==n?n:this.global&&this.global[i]}for(;a&&o>l;){if(dust.isThenable(a))return a.then(getWithResolvedData(this,t,e.slice(l)));r=a,a=a[e[l]],l++}}return"function"==typeof a?(s=function(){try{return a.apply(r,arguments)}catch(t){throw dust.log(t,ERROR),t}},s.__dustBody=!!a.__dustBody,s):(void 0===a&&dust.log("Cannot find reference `{"+e.join(".")+"}` in template `"+this.getTemplateName()+"`",INFO),a)},Context.prototype.getPath=function(t,e){return this._get(t,e)},Context.prototype.push=function(t,e,n){return void 0===t?(dust.log("Not pushing an undefined variable onto the context",INFO),this):this.rebase(new Stack(t,this.stack,e,n))},Context.prototype.pop=function(){var t=this.current();return this.stack=this.stack&&this.stack.tail,t},Context.prototype.rebase=function(t){return new Context(t,this.global,this.options,this.blocks,this.getTemplateName())},Context.prototype.clone=function(){var t=this.rebase();return t.stack=this.stack,t},Context.prototype.current=function(){return this.stack&&this.stack.head},Context.prototype.getBlock=function(t){var e,n,i;if("function"==typeof t&&(t=t(new Chunk,this).data.join("")),e=this.blocks,!e)return dust.log("No blocks for context `"+t+"` in template `"+this.getTemplateName()+"`",DEBUG),!1;for(n=e.length;n--;)if(i=e[n][t])return i;return dust.log("Malformed template `"+this.getTemplateName()+"` was missing one or more blocks."),!1},Context.prototype.shiftBlocks=function(t){var e,n=this.blocks;return t?(e=n?n.concat([t]):[t],new Context(this.stack,this.global,this.options,e,this.getTemplateName())):this},Context.prototype.resolve=function(t){var e;return"function"!=typeof t?t:(e=(new Chunk).render(t,this),e instanceof Chunk?e.data.join(""):e)},Context.prototype.getTemplateName=function(){return this.templateName},Stub.prototype.flush=function(){for(var t=this.head;t;){if(!t.flushable)return t.error?(this.callback(t.error),dust.log("Rendering failed with error `"+t.error+"`",ERROR),void(this.flush=EMPTY_FUNC)):void 0;this.out+=t.data.join(""),t=t.next,this.head=t}this.callback(null,this.out)},Stream.prototype.flush=function(){for(var t=this.head;t;){if(!t.flushable)return t.error?(this.emit("error",t.error),this.emit("end"),dust.log("Streaming failed with error `"+t.error+"`",ERROR),void(this.flush=EMPTY_FUNC)):void 0;this.emit("data",t.data.join("")),t=t.next,this.head=t}this.emit("end")},Stream.prototype.emit=function(t,e){var n,i,o=this.events||{},r=o[t]||[];if(!r.length)return dust.log("Stream broadcasting, but no listeners for `"+t+"`",DEBUG),!1;for(r=r.slice(0),n=0,i=r.length;i>n;n++)r[n](e);return!0},Stream.prototype.on=function(t,e){var n=this.events=this.events||{},i=n[t]=n[t]||[];return"function"!=typeof e?dust.log("No callback function provided for `"+t+"` event listener",WARN):i.push(e),this},Stream.prototype.pipe=function(t){if("function"!=typeof t.write||"function"!=typeof t.end)return dust.log("Incompatible stream passed to `pipe`",WARN),this;var e=!1;return"function"==typeof t.emit&&t.emit("pipe",this),"function"==typeof t.on&&t.on("error",function(){e=!0}),this.on("data",function(n){if(!e)try{t.write(n,"utf8")}catch(i){dust.log(i,ERROR)}}).on("end",function(){if(!e)try{t.end(),e=!0}catch(n){dust.log(n,ERROR)}})},Chunk.prototype.write=function(t){var e=this.taps;return e&&(t=e.go(t)),this.data.push(t),this},Chunk.prototype.end=function(t){return t&&this.write(t),this.flushable=!0,this.root.flush(),this},Chunk.prototype.map=function(t){var e=new Chunk(this.root,this.next,this.taps),n=new Chunk(this.root,e,this.taps);this.next=n,this.flushable=!0;try{t(n)}catch(i){dust.log(i,ERROR),n.setError(i)}return e},Chunk.prototype.tap=function(t){var e=this.taps;return this.taps=e?e.push(t):new Tap(t),this},Chunk.prototype.untap=function(){return this.taps=this.taps.tail,this},Chunk.prototype.render=function(t,e){return t(this,e)},Chunk.prototype.reference=function(t,e,n,i){return"function"==typeof t?(t=t.apply(e.current(),[this,e,null,{auto:n,filters:i}]),t instanceof Chunk?t:this.reference(t,e,n,i)):dust.isThenable(t)?this.await(t,e,null,n,i):dust.isStreamable(t)?this.stream(t,e,null,n,i):dust.isEmpty(t)?this:this.write(dust.filter(t,n,i,e))},Chunk.prototype.section=function(t,e,n,i){var o,r,s,a=n.block,l=n["else"],d=this;if("function"==typeof t&&!dust.isTemplateFn(t)){try{t=t.apply(e.current(),[this,e,n,i])}catch(c){return dust.log(c,ERROR),this.setError(c)}if(t instanceof Chunk)return t}if(dust.isEmptyObject(n))return d;if(dust.isEmptyObject(i)||(e=e.push(i)),dust.isArray(t)){if(a){if(r=t.length,r>0){for(s=e.stack&&e.stack.head||{},s.$len=r,o=0;r>o;o++)s.$idx=o,d=a(d,e.push(t[o],o,r));return s.$idx=void 0,s.$len=void 0,d}if(l)return l(this,e)}}else{if(dust.isThenable(t))return this.await(t,e,n);if(dust.isStreamable(t))return this.stream(t,e,n);if(t===!0){if(a)return a(this,e)}else if(t||0===t){if(a)return a(this,e.push(t))}else if(l)return l(this,e)}return dust.log("Section without corresponding key in template `"+e.getTemplateName()+"`",DEBUG),this},Chunk.prototype.exists=function(t,e,n){var i=n.block,o=n["else"];if(dust.isEmpty(t)){if(o)return o(this,e)}else{if(i)return i(this,e);dust.log("No block for exists check in template `"+e.getTemplateName()+"`",DEBUG)}return this},Chunk.prototype.notexists=function(t,e,n){var i=n.block,o=n["else"];if(dust.isEmpty(t)){if(i)return i(this,e);dust.log("No block for not-exists check in template `"+e.getTemplateName()+"`",DEBUG)}else if(o)return o(this,e);return this},Chunk.prototype.block=function(t,e,n){var i=t||n.block;return i?i(this,e):this},Chunk.prototype.partial=function(t,e,n,i){var o;return void 0===i&&(i=n,n=e),dust.isEmptyObject(i)||(n=n.clone(),o=n.pop(),n=n.push(i).push(o)),dust.isTemplateFn(t)?this.capture(t,e,function(t,e){n.templateName=t,load(t,e,n).end()}):(n.templateName=t,load(t,this,n))},Chunk.prototype.helper=function(t,e,n,i,o){var r,s=this,a=i.filters;if(void 0===o&&(o="h"),!dust.helpers[t])return dust.log("Helper `"+t+"` does not exist",WARN),s;try{return r=dust.helpers[t](s,e,n,i),r instanceof Chunk?r:("string"==typeof a&&(a=a.split("|")),dust.isEmptyObject(n)?s.reference(r,e,o,a):s.section(r,e,n,i))}catch(l){return dust.log("Error in helper `"+t+"`: "+l.message,ERROR),s.setError(l)}},Chunk.prototype.await=function(t,e,n,i,o){return this.map(function(r){t.then(function(t){r=n?r.section(t,e,n):r.reference(t,e,i,o),r.end()},function(t){var i=n&&n.error;i?r.render(i,e.push(t)).end():(dust.log("Unhandled promise rejection in `"+e.getTemplateName()+"`",INFO),r.end())})})},Chunk.prototype.stream=function(t,e,n,i,o){var r=n&&n.block,s=n&&n.error;return this.map(function(a){var l=!1;t.on("data",function(t){l||(r?a=a.map(function(n){n.render(r,e.push(t)).end()}):n||(a=a.reference(t,e,i,o)))}).on("error",function(t){l||(s?a.render(s,e.push(t)):dust.log("Unhandled stream error in `"+e.getTemplateName()+"`",INFO),l||(l=!0,a.end()))}).on("end",function(){l||(l=!0,a.end())})})},Chunk.prototype.capture=function(t,e,n){return this.map(function(i){var o=new Stub(function(t,e){t?i.setError(t):n(e,i)});t(o.head,e).end()})},Chunk.prototype.setError=function(t){return this.error=t,this.root.flush(),this};for(var f in Chunk.prototype)dust._aliases[f]&&(Chunk.prototype[dust._aliases[f]]=Chunk.prototype[f]);Tap.prototype.push=function(t){return new Tap(t,this)},Tap.prototype.go=function(t){for(var e=this;e;)t=e.head(t),e=e.tail;return t};var HCHARS=/[&<>"']/,AMP=/&/g,LT=/</g,GT=/>/g,QUOT=/\"/g,SQUOT=/\'/g;dust.escapeHtml=function(t){return"string"==typeof t||t&&"function"==typeof t.toString?("string"!=typeof t&&(t=t.toString()),HCHARS.test(t)?t.replace(AMP,"&amp;").replace(LT,"&lt;").replace(GT,"&gt;").replace(QUOT,"&quot;").replace(SQUOT,"&#39;"):t):t};var BS=/\\/g,FS=/\//g,CR=/\r/g,LS=/\u2028/g,PS=/\u2029/g,NL=/\n/g,LF=/\f/g,SQ=/'/g,DQ=/"/g,TB=/\t/g;return dust.escapeJs=function(t){return"string"==typeof t?t.replace(BS,"\\\\").replace(FS,"\\/").replace(DQ,'\\"').replace(SQ,"\\'").replace(CR,"\\r").replace(LS,"\\u2028").replace(PS,"\\u2029").replace(NL,"\\n").replace(LF,"\\f").replace(TB,"\\t"):t},dust.escapeJSON=function(t){return JSON?JSON.stringify(t).replace(LS,"\\u2028").replace(PS,"\\u2029").replace(LT,"\\u003c"):(dust.log("JSON is undefined; could not escape `"+t+"`",WARN),t)},dust}),"function"==typeof define&&define.amd&&define.amd.dust===!0&&define("dust",["require","dust.core"],function(t,e){return e.onLoad=function(e,n){t([e],function(){n()})},e}),!function(t,e){"function"==typeof define&&define.amd&&define.amd.dust===!0?define("dust-helpers",["dust.core"],e):"object"==typeof exports?module.exports=e(require("dustjs-linkedin")):e(t.dust)}(this,function(t){function e(e,n,i){i=i||"INFO",e=e?"{@"+e+"}: ":"",t.log(e+n,i)}function n(t){u[t]||(e(t,"Deprecation warning: "+t+" is deprecated and will be removed in a future version of dustjs-helpers","WARN"),e(null,"For help and a deprecation timeline, see https://github.com/linkedin/dustjs-helpers/wiki/Deprecated-Features#"+t.replace(/\W+/g,""),"WARN"),u[t]=!0)}function i(t){return t.stack.tail&&t.stack.tail.head&&"undefined"!=typeof t.stack.tail.head.__select__}function o(t){return i(t)&&t.get("__select__")}function r(t,e){var n,i=t.stack.head,o=t.rebase();t.stack&&t.stack.tail&&(o.stack=t.stack.tail);var r={isPending:!1,isResolved:!1,isDeferredComplete:!1,deferreds:[]};for(n in e)r[n]=e[n];return o.push({__select__:r}).push(i,t.stack.index,t.stack.of)}function s(t){var e,n;if(t.deferreds.length)for(t.isDeferredComplete=!0,e=0,n=t.deferreds.length;n>e;e++)t.deferreds[e]()}function a(t,e){return"function"==typeof e?e.toString().replace(/(^\s+|\s+$)/gm,"").replace(/\n/gm,"").replace(/,\s*/gm,", ").replace(/\)\{/gm,") {"):e}function l(t,e){return function(n,i,o,r){return d(n,i,o,r,t,e)}}function d(t,n,i,r,s,a){var l,d,u,h,p=i.block,f=i["else"],m=o(n)||{};if(m.isResolved)return t;if(r.hasOwnProperty("key"))d=r.key;else{if(!m.hasOwnProperty("key"))return e(s,"No key specified","WARN"),t;d=m.key}return h=r.type||m.type,d=c(n.resolve(d),h),u=c(n.resolve(r.value),h),a(d,u)?(m.isPending||(l=!0,m.isPending=!0),p&&(t=t.render(p,n)),l&&(m.isResolved=!0)):f&&(t=t.render(f,n)),t}function c(t,e){switch(e&&(e=e.toLowerCase()),e){case"number":return+t;case"string":return String(t);case"boolean":return t="false"===t?!1:t,Boolean(t);case"date":return new Date(t)}return t}var u={},h={tap:function(t,e,i){return n("tap"),i.resolve(t)},sep:function(t,e,n){var i=n.block;return e.stack.index===e.stack.of-1?t:i?i(t,e):t},first:function(t,e,n){return 0===e.stack.index?n.block(t,e):t},last:function(t,e,n){return e.stack.index===e.stack.of-1?n.block(t,e):t},contextDump:function(t,n,i,o){var r,s,l=n.resolve(o.to),d=n.resolve(o.key);switch(d){case"full":r=n.stack;break;default:r=n.stack.head}switch(s=JSON.stringify(r,a,2),l){case"console":e("contextDump",s);break;default:s=s.replace(/</g,"\\u003c"),t=t.write(s)}return t},math:function(t,n,i,a){var l,d=a.key,c=a.method,u=a.operand,h=a.round;if(!a.hasOwnProperty("key")||!a.method)return e("math","`key` or `method` was not provided","ERROR"),t;switch(d=parseFloat(n.resolve(d)),u=parseFloat(n.resolve(u)),c){case"mod":0===u&&e("math","Division by 0","ERROR"),l=d%u;break;case"add":l=d+u;break;case"subtract":l=d-u;break;case"multiply":l=d*u;break;case"divide":0===u&&e("math","Division by 0","ERROR"),l=d/u;break;case"ceil":case"floor":case"round":case"abs":l=Math[c](d);break;case"toint":l=parseInt(d,10);break;default:e("math","Method `"+c+"` is not supported","ERROR")}return"undefined"!=typeof l&&(h&&(l=Math.round(l)),i&&i.block?(n=r(n,{key:l}),t=t.render(i.block,n),s(o(n))):t=t.write(l)),t},select:function(t,n,i,a){var l=i.block,d={};return a.hasOwnProperty("key")&&(d.key=n.resolve(a.key)),a.hasOwnProperty("type")&&(d.type=a.type),l?(n=r(n,d),t=t.render(l,n),s(o(n))):e("select","Missing body block","WARN"),t},eq:l("eq",function(t,e){return t===e}),ne:l("ne",function(t,e){return t!==e}),lt:l("lt",function(t,e){return e>t}),lte:l("lte",function(t,e){return e>=t}),gt:l("gt",function(t,e){return t>e}),gte:l("gte",function(t,e){return t>=e}),any:function(t,n,i,r){var s=o(n);return s?s.isDeferredComplete?e("any","Must not be nested inside {@any} or {@none} block","ERROR"):t=t.map(function(t){s.deferreds.push(function(){s.isResolved&&(t=t.render(i.block,n)),t.end()})}):e("any","Must be used inside a {@select} block","ERROR"),t},none:function(t,n,i,r){var s=o(n);return s?s.isDeferredComplete?e("none","Must not be nested inside {@any} or {@none} block","ERROR"):t=t.map(function(t){s.deferreds.push(function(){s.isResolved||(t=t.render(i.block,n)),t.end()})}):e("none","Must be used inside a {@select} block","ERROR"),t},size:function(e,n,i,o){var r,s,a=o.key;if(a=n.resolve(o.key),a&&a!==!0)if(t.isArray(a))r=a.length;else if(!isNaN(parseFloat(a))&&isFinite(a))r=a;else if("object"==typeof a){r=0;for(s in a)a.hasOwnProperty(s)&&r++}else r=(a+"").length;else r=0;return e.write(r)}};for(var p in h)t.helpers[p]=h[p];return t}),!function(t){function e(t,e){return t.w('<div class="modal fade my-files-selector-modal"><div class="modal-dialog" style="width: 80%;"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button><h4 class="modal-title">Select from My Files</h4></div><div class="modal-body"><div class="text-center"><i class="fa fa-spinner fa-4x fa-spin"></i></div></div><div class="modal-footer"><a class="btn btn-default" data-dismiss="modal"><i class="fa fa-times"></i> Cancel</a><a class="btn btn-primary my-files-selector-select-selected" disabled="disabled" data-loading-text="<i class=&quot;fa fa-spinner fa-spin&quot;></i> Downloading data..."><i class="fa fa-check"></i> Select</a></div></div></div></div>')}return t.register("myFilesSelector",e),e.__dustBody=!0,e}(dust),function(t){function e(t,e){return t.w('<div class="modal fade recorder-modal"><div class="modal-dialog modal-lg"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button><h4 class="modal-title">Recorder</h4></div><div class="modal-body"><ul class="nav nav-tabs" role="tablist"><li class="active"><a href=".recorder-normal" role="tab" data-toggle="tab">Normal</a></li><li><a href=".recorder-interp" role="tab" data-toggle="tab">Interpretation</a></li></ul><div class="tab-content" style="padding-top: 15px;"><div class="tab-pane active recorder-normal recorder-container-record"><div class="tt-media-preview-title"><input class="recorder-normal-title" type="text" value="My Recording"/></div><video class="recorder-normal-video" width="100%" preload="auto" muted="muted"></video></div><div class="tab-pane recorder-interp recorder-container-record"><div style="border: 2px dashed #ccc; line-height: 200px; height: 200px; text-align: center; display: none;"><button class="btn btn-primary btn-lg recorder-interp-select">Select a video to interpret</button></div><div class="row recorder-interp-main" style="display: none;"><div class="col-md-offset-6 col-md-6"><div class="tt-media-preview-title"><input class="recorder-interp-title" type="text" value="My Recording"/></div></div><div class="col-md-6"><video class="recorder-interp-video-p" width="100%" preload="auto"muted="muted"></video></div><div class="col-md-6"><video class="recorder-interp-video-r" width="100%" preload="auto"muted="muted"></video></div></div></div><div class="recorder-controls recorder-container-record"></div><div class="recorder-container-upload" style="display: none;"><label>Uploading...</label><div class="progress"><div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0"aria-valuemax="100" style="width: 0%;">0%</div></div></div></div></div></div></div></div>')}return t.register("recorder",e),e.__dustBody=!0,e}(dust),function(t){function e(t,e){return t.s(e.get(["resources"],!1),e,{block:n},{})}function n(t,e){return t.w('<source src="').h("generateUrl",e,{},{path:e.get(["web_path"],!1)},"h").w('" />')}return t.register("recorder_source",e),e.__dustBody=!0,n.__dustBody=!0,e}(dust),function(t){function e(t,e){return t.w('<div class="tt-gallery-prev disabled gallery-prev"><i class="fa fa-chevron-left fa-3x"></i></div><div class="tt-gallery-item gallery-item"></div><div class="tt-gallery-next disabled gallery-next"><i class="fa fa-chevron-right fa-3x next"></i></div><div class="tt-gallery-carousel gallery-carousel"><div class="tt-gallery-left gallery-left"><i class="fa fa-chevron-left fa-2x"></i></div><div class="tt-gallery-thumbs gallery-thumbs"><div><ul></ul></div> </div><div class="tt-gallery-right gallery-right"><i class="fa fa-chevron-right fa-2x right"></i></div><div class="clear"></div></div><div class="tt-gallery-action gallery-action"><a title="Cut" data-action="4"><i class="fa fa-scissors fa-2x"></i></a><a title="Interpret" data-action="3"><i class="fa fa-video-camera fa-2x"></i></a><a data-action="2"><i class="fa fa-expand fa-2x"></i></a><a data-action="1"><i class="fa fa-times fa-2x"></i></a></div>')}return t.register("gallery_common",e),e.__dustBody=!0,e}(dust),function(t){function e(t,e){return t.w('<div id="').f(e.get(["identifier"],!1),e,"h").w('" class="tt-gallery-inline gallery-inner">').p("gallery_common",e,e,{}).w("</div>")}return t.register("gallery_inline",e),e.__dustBody=!0,e}(dust),function(t){function e(t,e){return t.w('<div id="').f(e.get(["identifier"],!1),e,"h").w('" class="tt-gallery-background gallery-inner"></div><div id="').f(e.get(["identifier"],!1),e,"h").w('" class="tt-gallery-preview gallery-inner">').p("gallery_common",e,e,{}).w("</div>")}return t.register("gallery_preview",e),e.__dustBody=!0,e}(dust),function(t){function e(t,e){return t.s(e.get(["media"],!1),e,{block:n},{})}function n(t,e){return t.w('<li data-mid="').f(e.getPath(!1,["data","id"]),e,"h").w('">').x(e.get(["can_edit"],!1),e,{block:i},{}).w("<div>").x(e.getPath(!1,["data","thumbnail_path"]),e,{block:o},{}).w("</div> </li>")}function i(t,e){return t.w('<span class="gallery-thumb-remove" title="Remove" data-mid="').f(e.getPath(!1,["data","id"]),e,"h").w('"><i class="fa fa-times-circle"></i></span>')}function o(t,e){return t.w('<img src="').h("generateUrl",e,{},{path:e.getPath(!1,["data","thumbnail_path"])},"h").w('" />')}return t.register("gallery_thumbnail",e),e.__dustBody=!0,n.__dustBody=!0,i.__dustBody=!0,o.__dustBody=!0,e}(dust),function(t){function e(t,e){return t.h("select",e,{block:n},{key:e.getPath(!1,["media","type"])},"h")}function n(t,e){return t.h("eq",e,{block:i},{value:1},"h").h("eq",e,{block:u},{value:2},"h").h("eq",e,{block:f},{value:0},"h").h("eq",e,{block:m},{value:9},"h")}function i(t,e){return t.x(e.getPath(!1,["media","is_interpretation"]),e,{block:o},{}).w('<video class="tt-media-video"').x(e.get(["enable_controls"],!1),e,{block:l},{}).x(e.getPath(!1,["media","thumbnail_path"]),e,{block:d},{}).w('preload="none">').s(e.getPath(!1,["media","resources"]),e,{block:c},{}).w("</video>")}function o(t,e){return t.w('<video class="tt-media-pip-video"').x(e.get(["enable_controls"],!1),e,{block:r},{}).x(e.getPath(!1,["media","source","thumbnail_path"]),e,{block:s},{}).w('preload="none">').s(e.getPath(!1,["media","source","resources"]),e,{block:a},{}).w("</video>")}function r(t,e){return t.w(" controls ")}function s(t,e){return t.w(' poster="').h("generateUrl",e,{},{path:e.getPath(!1,["media","source","thumbnail_path"])},"h").w('" ')}function a(t,e){return t.w('<source src="').h("generateUrl",e,{},{path:e.get(["web_path"],!1)},"h").w('" />')}function l(t,e){return t.w(" controls ")}function d(t,e){return t.w(' poster="').h("generateUrl",e,{},{path:e.getPath(!1,["media","thumbnail_path"])},"h").w('" ')}function c(t,e){return t.w('<source src="').h("generateUrl",e,{},{path:e.get(["web_path"],!1)},"h").w('" />')}function u(t,e){return t.w('<audio class="tt-media-audio"').x(e.get(["enable_controls"],!1),e,{block:h},{}).w(">").s(e.getPath(!1,["media","resources"]),e,{block:p},{}).w("</audio>")}function h(t,e){return t.w(" controls")}function p(t,e){return t.w('<source src="').h("generateUrl",e,{},{path:e.get(["web_path"],!1)},"h").w('" />')}function f(t,e){return t.w('<img class="img-responsive center-block tt-media-img" src="').h("generateUrl",e,{},{path:e.getPath(!1,["media","source_resource","web_path"])},"h").w('" title="').f(e.get(["title"],!1),e,"h").w('" alt="').f(e.get(["title"],!1),e,"h").w('" />')}function m(t,e){return t.w('<div class="row"><div class="col-md-3 thumbnail text-center"><a href="').h("generateUrl",e,{},{path:e.getPath(!1,["media","source_resource","web_path"])},"h").w('"><p><i class="fa fa-file fa-5x"></i></p><div>').f(e.get(["title"],!1),e,"h").w("</div></a></div></div>")}return t.register("media_element",e),e.__dustBody=!0,n.__dustBody=!0,i.__dustBody=!0,o.__dustBody=!0,r.__dustBody=!0,s.__dustBody=!0,a.__dustBody=!0,l.__dustBody=!0,d.__dustBody=!0,c.__dustBody=!0,u.__dustBody=!0,h.__dustBody=!0,p.__dustBody=!0,f.__dustBody=!0,m.__dustBody=!0,e}(dust),function(t){function e(t,e){return t.w('<div class="col-md-3"><div class="thumbnail tt-grid-div-body"><div class="tt-grid-div-item"><input type="checkbox" class="table-component-item" data-mid="').f(e.getPath(!1,["media","id"]),e,"h").w('" /></div><div class="tt-grid-div-thumbnail my-files-selector-file" data-mid="').f(e.getPath(!1,["media","id"]),e,"h").w('" disabled><div><span class="fa-stack fa-lg"><i class="fa fa-file-o fa-stack-2x"></i><i class="fa fa-play-circle fa-stack-1x"></i></span></div></div><div class="tt-grid-div-primary"><span class="edit-title my-files-selector-file" title="').f(e.get(["previewTitle"],!1),e,"h").w('" data-mid="').f(e.getPath(!1,["media","id"]),e,"h").w('" data-type="text" data-title="').f(e.get(["editTitle"],!1),e,"h").w('" disabled><i class="fa ').f(e.getPath(!1,["mediaIcon","icon"]),e,"h").w(' fa-2x" title="').f(e.getPath(!1,["mediaIcon","text"]),e,"h").w('"></i>').f(e.getPath(!1,["media","title"]),e,"h").w('</span><span><button class="btn btn-default edit-title"><i class="fa fa-pencil"></i></button><div class="btn-group"><button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false"><i class="fa fa-download"></i> <span class="caret"></span></button><ul class="dropdown-menu" role="menu">').s(e.getPath(!1,["media","resources"]),e,{block:n},{}).h("if",e,{block:i},{cond:o},"h").x(e.getPath(!1,["media","source_resource"]),e,{block:r},{}).w('</ul></div><a class="btn btn-default" target="_blank" href="').f(e.get(["shareUrl"],!1),e,"h").w('" title="').f(e.get(["shareTitle"],!1),e,"h").w('"><i class="fa fa-share-square-o"></i></a></span></div></div></div>')}function n(t,e){return t.w('<li><a href="').h("generateUrl",e,{},{path:e.get(["web_path"],!1)},"h").w(' download="').f(e.getPath(!1,["media","title"]),e,"h").w(".").f(e.get(["path"],!1),e,"h").w('">').f(e.get(["path"],!1),e,"h").w("</a></li>\n")}function i(t,e){return t.w('<li class="divider"></li>')}function o(t,e){return t.w("'").f(e.getPath(!1,["media","resources"]),e,"h").w("'.length > 0 && '").f(e.getPath(!1,["media","source_resource"]),e,"h").w("'.length")}function r(t,e){return t.w('<li><a href="').h("generateUrl",e,{},{path:e.getPath(!1,["media","source_resource","web_path"])},"h").w('" download="').f(e.getPath(!1,["media","title"]),e,"h").w(".").f(e.getPath(!1,["media","source_resource","path"]),e,"h").w('">Original</a></li>')}return t.register("myFilesGridElement",e),e.__dustBody=!0,n.__dustBody=!0,i.__dustBody=!0,o.__dustBody=!0,r.__dustBody=!0,e}(dust),function(t){function e(t,e){return t.w('<tr><td class="tt-list-table-col-item"><input type="checkbox" class="table-component-item" data-mid="').f(e.getPath(!1,["media","id"]),e,"h").w('" /></td><td class="tt-list-table-col-thumbnail my-files-selector-file" data-mid="').f(e.getPath(!1,["media","id"]),e,"h").w('" disabled ><div><span class="fa-stack fa-lg"><i class="fa fa-file-o fa-stack-2x"></i><i class="fa fa-play-circle fa-stack-1x"></i></span></div></td><td class="tt-list-table-col-primary tt-myFiles-nameColumn"><span class="edit-title my-files-selector-file" title="').f(e.get(["previewTitle"],!1),e,"h").w('" data-mid="').f(e.getPath(!1,["media","id"]),e,"h").w('" data-type="text" data-title="').f(e.get(["editTitle"],!1),e,"h").w('" disabled >').f(e.getPath(!1,["media","title"]),e,"h").w('</span><span><button class="btn btn-default edit-title"><i class="fa fa-pencil"></i></button><div class="btn-group"><button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false"><i class="fa fa-download"></i> <span class="caret"></span></button><ul class="dropdown-menu" role="menu">').s(e.getPath(!1,["media","resources"]),e,{block:n},{}).h("if",e,{block:i},{cond:o},"h").x(e.getPath(!1,["media","source_resource"]),e,{block:r},{}).w('</ul></div><a class="btn btn-default" target="_blank" href="').f(e.get(["shareUrl"],!1),e,"h").w('" title="').f(e.get(["shareTitle"],!1),e,"h").w('"><i class="fa fa-share-square-o"></i></a></span></td><td>').f(e.get(["timeUploaded"],!1),e,"h").w('</td><td><i class="fa ').f(e.getPath(!1,["mediaIcon","icon"]),e,"h").w(' fa-2x" title="').f(e.getPath(!1,["mediaIcon","text"]),e,"h").w('"></i></td><td>').x(e.get(["spinner"],!1),e,{"else":s,block:a},{}).w("</td></tr>")}function n(t,e){return t.w('<li><a href="').h("generateUrl",e,{},{path:e.get(["web_path"],!1)},"h").w(' download="').f(e.getPath(!1,["media","title"]),e,"h").w(".").f(e.get(["path"],!1),e,"h").w('">').f(e.get(["path"],!1),e,"h").w("</a></li>\n")}function i(t,e){return t.w('<li class="divider"></li>')}function o(t,e){return t.w("'").f(e.getPath(!1,["media","resources"]),e,"h").w("'.length > 0 && '").f(e.getPath(!1,["media","source_resource"]),e,"h").w("'.length")}function r(t,e){return t.w('<li><a href="').h("generateUrl",e,{},{path:e.getPath(!1,["media","source_resource","web_path"])},"h").w('" download="').f(e.getPath(!1,["media","title"]),e,"h").w(".").f(e.getPath(!1,["media","source_resource","path"]),e,"h").w('">Original</a></li>')}function s(t,e){return t.f(e.get(["formattedSize"],!1),e,"h")}function a(t,e){return t.w('<i class="fa fa-spinner fa-spin fa-large"> </i>')}return t.register("myFilesListElement",e),e.__dustBody=!0,n.__dustBody=!0,i.__dustBody=!0,o.__dustBody=!0,r.__dustBody=!0,s.__dustBody=!0,a.__dustBody=!0,e}(dust),function(t){function e(t,e){return e=e.shiftBlocks(r),t.p("post_view",e,e,{})}function n(t,e){return e=e.shiftBlocks(r),t.w('<div class="row"><div class="col-md-12">').f(e.get(["form"],!1),e,"h",["s"]).w("</div></div>")}function i(t,e){return e=e.shiftBlocks(r),t}function o(t,e){return e=e.shiftBlocks(r),t}t.register("post_edit",e);var r={post_content:n,post_tools:i,post_reply:o};return e.__dustBody=!0,n.__dustBody=!0,i.__dustBody=!0,o.__dustBody=!0,e}(dust),function(t){function e(t,e){return t.w('<div class="row post-container').x(e.get(["is_post_reply"],!1),e,{block:n},{}).w('" data-pid="').f(e.get(["id"],!1),e,"h").w('"><div class="').x(e.get(["is_post_reply"],!1),e,{"else":i,block:o},{}).w('">').x(e.get(["is_post_reply"],!1),e,{block:r},{}).f(e.get(["form"],!1),e,"h",["s"]).x(e.get(["is_post_reply"],!1),e,{block:s},{}).w("</div></div>")}function n(t,e){return t.w(' tt-post-container tt-post-reply-container" style="margin-bottom: 15px;')}function i(t,e){return t.w("col-md-12")}function o(t,e){return t.w("col-md-offset-1 col-md-11")}function r(t,e){return t.w('<div class="row tt-post-container-inner tt-post-reply-container-inner"><div class="col-md-12">')}function s(t,e){return t.w("</div></div>")}return t.register("post_new",e),
e.__dustBody=!0,n.__dustBody=!0,i.__dustBody=!0,o.__dustBody=!0,r.__dustBody=!0,s.__dustBody=!0,e}(dust),function(t){function e(t,e){return t.w('<div class="row post-container tt-post-container').x(e.get(["is_post_reply"],!1),e,{block:n},{}).w('" style="margin-bottom: 15px;" data-pid="').f(e.get(["id"],!1),e,"h").w('"').x(e.get(["is_post_reply"],!1),e,{block:i},{}).w('><div class="').x(e.get(["is_post_reply"],!1),e,{"else":o,block:r},{}).w('"><div class="row tt-post-container-inner').x(e.get(["is_post_reply"],!1),e,{block:s},{}).w('"><div class="col-md-2 text-center"><div class="row"><div class="col-md-12">').p("user_avatar",e,e,{user:e.get(["author"],!1)}).p("user_username",e,e,{user:e.get(["author"],!1)}).w('</div></div><div class="row"><div class="col-md-12">').p("user_connect_tools",e,e,{user:e.get(["author"],!1)}).w('</div></div></div><div class="col-md-9 tt-post-content-container">').b(e.getBlock("post_content"),e,{block:a},{}).w('</div><div class="col-md-1 pull-right">').b(e.getBlock("post_tools"),e,{block:u},{}).w("</div></div>").nx(e.get(["is_post_reply"],!1),e,{block:f},{}).w("</div></div>")}function n(t,e){return t.w(" tt-post-reply-container")}function i(t,e){return t.w(' data-ppid="').f(e.get(["parent_post_id"],!1),e,"h").w('"')}function o(t,e){return t.w("col-md-12")}function r(t,e){return t.w("col-md-offset-1 col-md-11")}function s(t,e){return t.w(" tt-post-reply-container-inner")}function a(t,e){return t.w('<div class="row"><div class="col-md-12"><div class="text-right tt-date">').f(e.get(["created"],!1),e,"h",["date"]).w("&nbsp;").x(e.get(["edited_by"],!1),e,{block:l},{}).w('</div></div><div class="col-md-12">').x(e.get(["is_temporal"],!1),e,{block:d},{}).h("gt",e,{block:c},{key:e.getPath(!1,["ordered_media","length"]),value:0},"h").w("<div><p>").f(e.get(["content"],!1),e,"h",["nl2br","s"]).w("</p></div></div></div>")}function l(t,e){return t.w("(edited ").f(e.get(["edited_at"],!1),e,"h",["date"]).w(" by ").f(e.getPath(!1,["edited_by","username"]),e,"h").w(")")}function d(t,e){return t.w('<div class="tt-post-timeline-container"><div class="tt-post-timeline"><div class="tt-post-timeline-keypoint post-timeline-keypoint"></div></div></div>')}function c(t,e){return t.w('<div class="row"><div class="col-md-12"><div class="post-gallery" style="margin-bottom: 10px; height: 400px; width: 100%;"></div></div></div>')}function u(t,e){return t.w('<ul class="list-unstyled">').x(e.get(["is_temporal"],!1),e,{block:h},{}).h("isCurrentUser",e,{block:p},{id:e.getPath(!1,["author","id"])},"h").w('</ul><div class="modal fade post-delete-modal" data-pid="').f(e.get(["id"],!1),e,"h").w('"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button><h4 class="modal-title">Delete this post</h4></div><div class="modal-body text-center"><p>This post will be permanently deleted.<br />This action cannot be undone.<br />Are you sure?</p></div><div class="modal-footer"><a class="btn btn-default" data-dismiss="modal"><i class="fa fa-times"></i> Cancel</a><a class="btn btn-danger post-delete" data-loading-text="<i class=&quot;fa fa-spinner fa-spin&quot;></i> Deleting..."><i class="fa fa-trash-o"></i> Delete</a></div></div></div></div>')}function h(t,e){return t.w('<li><a class="post-timeline-keypoint" href="#" title="Jump to selected timeline region"><i class="fa fa-clock-o"></i></a></li>')}function p(t,e){return t.w('<li><a class="post-edit" href="#" title="Edit this post"><i class="fa fa-pencil"></i></a></li><li><a href="#" title="Delete this post" data-toggle="modal" data-target=".post-delete-modal[data-pid=').f(e.get(["id"],!1),e,"h").w(']"><i class="fa fa-trash-o"></i></a></li>')}function f(t,e){return t.b(e.getBlock("post_reply"),e,{block:m},{})}function m(t,e){return t.w('<div class="row"><div class="col-md-1 col-md-offset-11"><p><a class="post-new" href="#" title="Reply to this post"><i class="fa fa-reply fa-rotate-180 fa-lg"></i></a></p></div></div>')}return t.register("post_view",e),e.__dustBody=!0,n.__dustBody=!0,i.__dustBody=!0,o.__dustBody=!0,r.__dustBody=!0,s.__dustBody=!0,a.__dustBody=!0,l.__dustBody=!0,d.__dustBody=!0,c.__dustBody=!0,u.__dustBody=!0,h.__dustBody=!0,p.__dustBody=!0,f.__dustBody=!0,m.__dustBody=!0,e}(dust),function(t){function e(t,e){return t.w('<div class="row"><div class="col-md-12">').s(e.get(["posts"],!1),e,{"else":n,block:i},{}).w('<div class="thread-reply-spacer"></div></div></div>')}function n(t,e){return t.w('<div class="lead text-center" style="padding-top: 30px;">No replies yet!</div>')}function i(t,e){return t.nx(e.get(["is_post_reply"],!1),e,{block:o},{})}function o(t,e){return t.p("post_view",e,e,{post:e.getPath(!0,[])}).s(e.get(["replies"],!1),e,{block:r},{})}function r(t,e){return t.p("post_view",e,e,{post:e.getPath(!0,[])})}return t.register("thread_view_posts",e),e.__dustBody=!0,n.__dustBody=!0,i.__dustBody=!0,o.__dustBody=!0,r.__dustBody=!0,e}(dust),function(t){function e(t,e){return t.s(e.get(["user"],!1),e,{block:n},{})}function n(t,e){return t.w('<a href="').h("generateRouteUrl",e,{},{name:"imdc_profile_user",str_params:"userName:username"},"h").w('"><img class="img-responsive center-block tt-avatar" src="').x(e.getPath(!1,["profile","avatar"]),e,{"else":i,block:o},{}).w('" /></a>')}function i(t,e){return t.h("generateUrl",e,{},{path:"bundles/imdcterptube/img/no_avatar.jpg"},"h")}function o(t,e){return t.h("generateUrl",e,{},{path:e.getPath(!1,["profile","avatar","source_resource","web_path"])},"h")}return t.register("user_avatar",e),e.__dustBody=!0,n.__dustBody=!0,i.__dustBody=!0,o.__dustBody=!0,e}(dust),function(t){function e(t,e){return t.s(e.get(["user"],!1),e,{block:n},{})}function n(t,e){return t.w('<ul class="list-unstyled list-inline"><li>').h("isLoggedInUser",e,{"else":i,block:o},{id:e.get(["id"],!1)},"h").w("</li>&nbsp; <!-- match spaces that are still present between tags when rendering from twig --><li>").h("isLoggedInUser",e,{"else":r,block:l},{id:e.get(["id"],!1)},"h").w("</li>").h("isNotLoggedInUser",e,{block:d},{id:e.get(["id"],!1)},"h").w("</ul>")}function i(t,e){return t.w('<a href="').h("generateRouteUrl",e,{},{name:"imdc_message_new",str_params:"userid:username"},"h").w('" title="Send a message to ').f(e.get(["username"],!1),e,"h").w('"><i class="fa fa-envelope-o"></i></a>')}function o(t,e){return t.w('<i class="fa fa-envelope-o" style="color: lightgray;"></i>')}function r(t,e){return t.h("isUserOnList",e,{"else":s,block:a},{list:"Friends",username:e.get(["username"],!1)},"h")}function s(t,e){return t.w('<a href="').h("generateRouteUrl",e,{},{name:"imdc_member_friend_add",str_params:"userid:id"},"h").w('" title="Click to add ').f(e.get(["username"],!1),e,"h").w(' to your friends list"><i class="fa fa-plus"></i></a>')}function a(t,e){return t.w('<a href="').h("generateRouteUrl",e,{},{name:"imdc_member_friend_remove",str_params:"userid:id"},"h").w('" title="Remove ').f(e.get(["username"],!1),e,"h").w(' from your friends list"><i class="fa fa-minus"></i></a>')}function l(t,e){return t.w('<i class="fa fa-user" style="color: lightgray;" title="This is you"></i>')}function d(t,e){return t.w("&nbsp;<li>").h("isUserOnList",e,{"else":c,block:p},{list:"Mentor",username:e.get(["username"],!1)},"h").w("</li>&nbsp;<li>").h("isUserOnList",e,{"else":f,block:b},{list:"Mentee",username:e.get(["username"],!1)},"h").w("</li>")}function c(t,e){return t.h("isUserOnList",e,{"else":u,block:h},{list:"InvitedMentor",username:e.get(["username"],!1)},"h")}function u(t,e){return t.w('<a href="').h("generateRouteUrl",e,{},{name:"imdc_invitation_mentor",str_params:"id:id"},"h").w('" title="Invite user to be your mentor"><i class="fa fa-inbox"></i></a>')}function h(t,e){return t.w('<i class="fa fa-inbox" title="Invitation for mentorship already sent"></i>')}function p(t,e){return t.w('<i class="fa fa-star" title="This user is your mentor"></i>')}function f(t,e){return t.h("isUserOnList",e,{"else":m,block:g},{list:"InvitedMentee",username:e.get(["username"],!1)},"h")}function m(t,e){return t.w('<a href="').h("generateRouteUrl",e,{},{name:"imdc_invitation_mentee",str_params:"id:id"},"h").w('" title="Invite user to be your mentee"><i class="fa fa-star-o"></i></a>')}function g(t,e){return t.w('<i class="fa fa-star-o" title="Invitation for menteeship already sent"></i>')}function b(t,e){return t.w('<i class="fa fa-star" title="This user is your mentee"></i>')}return t.register("user_connect_tools",e),e.__dustBody=!0,n.__dustBody=!0,i.__dustBody=!0,o.__dustBody=!0,r.__dustBody=!0,s.__dustBody=!0,a.__dustBody=!0,l.__dustBody=!0,d.__dustBody=!0,c.__dustBody=!0,u.__dustBody=!0,h.__dustBody=!0,p.__dustBody=!0,f.__dustBody=!0,m.__dustBody=!0,g.__dustBody=!0,b.__dustBody=!0,e}(dust),function(t){function e(t,e){return t.s(e.get(["user"],!1),e,{block:n},{})}function n(t,e){return t.w('<a href="').h("generateRouteUrl",e,{},{name:"imdc_profile_user",str_params:"userName:username"},"h").w('" title="').f(e.get(["username"],!1),e,"h").w('"><span class="tt-username">').f(e.get(["username"],!1),e,"h").w("</span></a>")}return t.register("user_username",e),e.__dustBody=!0,n.__dustBody=!0,e}(dust),define("templates",["dust-helpers"],function(){}),Function.prototype.extend=function(){return function(t){var e=this;Object.keys(t).forEach(function(n){var i=t[n];e[n]=_.isObject(i)?_.clone(i):i}),this.prototype=Object.create(t.prototype),this.prototype.constructor=this}}(),define("extra",function(){}),function(){function t(t){function e(e,n,i,o,r,s){for(;r>=0&&s>r;r+=t){var a=o?o[r]:r;i=n(i,e[a],a,e)}return i}return function(n,i,o,r){i=v(i,r,4);var s=!S(n)&&_.keys(n),a=(s||n).length,l=t>0?0:a-1;return arguments.length<3&&(o=n[s?s[l]:l],l+=t),e(n,i,o,s,l,a)}}function e(t){return function(e,n,i){n=y(n,i);for(var o=k(e),r=t>0?0:o-1;r>=0&&o>r;r+=t)if(n(e[r],r,e))return r;return-1}}function n(t,e,n){return function(i,o,r){var s=0,a=k(i);if("number"==typeof r)t>0?s=r>=0?r:Math.max(r+a,s):a=r>=0?Math.min(r+1,a):r+a+1;else if(n&&r&&a)return r=n(i,o),i[r]===o?r:-1;if(o!==o)return r=e(c.call(i,s,a),_.isNaN),r>=0?r+s:-1;for(r=t>0?s:a-1;r>=0&&a>r;r+=t)if(i[r]===o)return r;return-1}}function i(t,e){var n=A.length,i=t.constructor,o=_.isFunction(i)&&i.prototype||a,r="constructor";for(_.has(t,r)&&!_.contains(e,r)&&e.push(r);n--;)r=A[n],r in t&&t[r]!==o[r]&&!_.contains(e,r)&&e.push(r)}var o=this,r=o._,s=Array.prototype,a=Object.prototype,l=Function.prototype,d=s.push,c=s.slice,u=a.toString,h=a.hasOwnProperty,p=Array.isArray,f=Object.keys,m=l.bind,g=Object.create,b=function(){},_=function(t){return t instanceof _?t:this instanceof _?void(this._wrapped=t):new _(t)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=_),exports._=_):o._=_,_.VERSION="1.8.3";var v=function(t,e,n){if(void 0===e)return t;switch(null==n?3:n){case 1:return function(n){return t.call(e,n)};case 2:return function(n,i){return t.call(e,n,i)};case 3:return function(n,i,o){return t.call(e,n,i,o)};case 4:return function(n,i,o,r){return t.call(e,n,i,o,r)}}return function(){return t.apply(e,arguments)}},y=function(t,e,n){return null==t?_.identity:_.isFunction(t)?v(t,e,n):_.isObject(t)?_.matcher(t):_.property(t)};_.iteratee=function(t,e){return y(t,e,1/0)};var w=function(t,e){return function(n){var i=arguments.length;if(2>i||null==n)return n;for(var o=1;i>o;o++)for(var r=arguments[o],s=t(r),a=s.length,l=0;a>l;l++){var d=s[l];e&&void 0!==n[d]||(n[d]=r[d])}return n}},E=function(t){if(!_.isObject(t))return{};if(g)return g(t);b.prototype=t;var e=new b;return b.prototype=null,e},C=function(t){return function(e){return null==e?void 0:e[t]}},T=Math.pow(2,53)-1,k=C("length"),S=function(t){var e=k(t);return"number"==typeof e&&e>=0&&T>=e};_.each=_.forEach=function(t,e,n){e=v(e,n);var i,o;if(S(t))for(i=0,o=t.length;o>i;i++)e(t[i],i,t);else{var r=_.keys(t);for(i=0,o=r.length;o>i;i++)e(t[r[i]],r[i],t)}return t},_.map=_.collect=function(t,e,n){e=y(e,n);for(var i=!S(t)&&_.keys(t),o=(i||t).length,r=Array(o),s=0;o>s;s++){var a=i?i[s]:s;r[s]=e(t[a],a,t)}return r},_.reduce=_.foldl=_.inject=t(1),_.reduceRight=_.foldr=t(-1),_.find=_.detect=function(t,e,n){var i;return i=S(t)?_.findIndex(t,e,n):_.findKey(t,e,n),void 0!==i&&-1!==i?t[i]:void 0},_.filter=_.select=function(t,e,n){var i=[];return e=y(e,n),_.each(t,function(t,n,o){e(t,n,o)&&i.push(t)}),i},_.reject=function(t,e,n){return _.filter(t,_.negate(y(e)),n)},_.every=_.all=function(t,e,n){e=y(e,n);for(var i=!S(t)&&_.keys(t),o=(i||t).length,r=0;o>r;r++){var s=i?i[r]:r;if(!e(t[s],s,t))return!1}return!0},_.some=_.any=function(t,e,n){e=y(e,n);for(var i=!S(t)&&_.keys(t),o=(i||t).length,r=0;o>r;r++){var s=i?i[r]:r;if(e(t[s],s,t))return!0}return!1},_.contains=_.includes=_.include=function(t,e,n,i){return S(t)||(t=_.values(t)),("number"!=typeof n||i)&&(n=0),_.indexOf(t,e,n)>=0},_.invoke=function(t,e){var n=c.call(arguments,2),i=_.isFunction(e);return _.map(t,function(t){var o=i?e:t[e];return null==o?o:o.apply(t,n)})},_.pluck=function(t,e){return _.map(t,_.property(e))},_.where=function(t,e){return _.filter(t,_.matcher(e))},_.findWhere=function(t,e){return _.find(t,_.matcher(e))},_.max=function(t,e,n){var i,o,r=-1/0,s=-1/0;if(null==e&&null!=t){t=S(t)?t:_.values(t);for(var a=0,l=t.length;l>a;a++)i=t[a],i>r&&(r=i)}else e=y(e,n),_.each(t,function(t,n,i){o=e(t,n,i),(o>s||o===-1/0&&r===-1/0)&&(r=t,s=o)});return r},_.min=function(t,e,n){var i,o,r=1/0,s=1/0;if(null==e&&null!=t){t=S(t)?t:_.values(t);for(var a=0,l=t.length;l>a;a++)i=t[a],r>i&&(r=i)}else e=y(e,n),_.each(t,function(t,n,i){o=e(t,n,i),(s>o||1/0===o&&1/0===r)&&(r=t,s=o)});return r},_.shuffle=function(t){for(var e,n=S(t)?t:_.values(t),i=n.length,o=Array(i),r=0;i>r;r++)e=_.random(0,r),e!==r&&(o[r]=o[e]),o[e]=n[r];return o},_.sample=function(t,e,n){return null==e||n?(S(t)||(t=_.values(t)),t[_.random(t.length-1)]):_.shuffle(t).slice(0,Math.max(0,e))},_.sortBy=function(t,e,n){return e=y(e,n),_.pluck(_.map(t,function(t,n,i){return{value:t,index:n,criteria:e(t,n,i)}}).sort(function(t,e){var n=t.criteria,i=e.criteria;if(n!==i){if(n>i||void 0===n)return 1;if(i>n||void 0===i)return-1}return t.index-e.index}),"value")};var $=function(t){return function(e,n,i){var o={};return n=y(n,i),_.each(e,function(i,r){var s=n(i,r,e);t(o,i,s)}),o}};_.groupBy=$(function(t,e,n){_.has(t,n)?t[n].push(e):t[n]=[e]}),_.indexBy=$(function(t,e,n){t[n]=e}),_.countBy=$(function(t,e,n){_.has(t,n)?t[n]++:t[n]=1}),_.toArray=function(t){return t?_.isArray(t)?c.call(t):S(t)?_.map(t,_.identity):_.values(t):[]},_.size=function(t){return null==t?0:S(t)?t.length:_.keys(t).length},_.partition=function(t,e,n){e=y(e,n);var i=[],o=[];return _.each(t,function(t,n,r){(e(t,n,r)?i:o).push(t)}),[i,o]},_.first=_.head=_.take=function(t,e,n){return null==t?void 0:null==e||n?t[0]:_.initial(t,t.length-e)},_.initial=function(t,e,n){return c.call(t,0,Math.max(0,t.length-(null==e||n?1:e)))},_.last=function(t,e,n){return null==t?void 0:null==e||n?t[t.length-1]:_.rest(t,Math.max(0,t.length-e))},_.rest=_.tail=_.drop=function(t,e,n){return c.call(t,null==e||n?1:e)},_.compact=function(t){return _.filter(t,_.identity)};var P=function(t,e,n,i){for(var o=[],r=0,s=i||0,a=k(t);a>s;s++){var l=t[s];if(S(l)&&(_.isArray(l)||_.isArguments(l))){e||(l=P(l,e,n));var d=0,c=l.length;for(o.length+=c;c>d;)o[r++]=l[d++]}else n||(o[r++]=l)}return o};_.flatten=function(t,e){return P(t,e,!1)},_.without=function(t){return _.difference(t,c.call(arguments,1))},_.uniq=_.unique=function(t,e,n,i){_.isBoolean(e)||(i=n,n=e,e=!1),null!=n&&(n=y(n,i));for(var o=[],r=[],s=0,a=k(t);a>s;s++){var l=t[s],d=n?n(l,s,t):l;e?(s&&r===d||o.push(l),r=d):n?_.contains(r,d)||(r.push(d),o.push(l)):_.contains(o,l)||o.push(l)}return o},_.union=function(){return _.uniq(P(arguments,!0,!0))},_.intersection=function(t){for(var e=[],n=arguments.length,i=0,o=k(t);o>i;i++){var r=t[i];if(!_.contains(e,r)){for(var s=1;n>s&&_.contains(arguments[s],r);s++);s===n&&e.push(r)}}return e},_.difference=function(t){var e=P(arguments,!0,!0,1);return _.filter(t,function(t){return!_.contains(e,t)})},_.zip=function(){return _.unzip(arguments)},_.unzip=function(t){for(var e=t&&_.max(t,k).length||0,n=Array(e),i=0;e>i;i++)n[i]=_.pluck(t,i);return n},_.object=function(t,e){for(var n={},i=0,o=k(t);o>i;i++)e?n[t[i]]=e[i]:n[t[i][0]]=t[i][1];return n},_.findIndex=e(1),_.findLastIndex=e(-1),_.sortedIndex=function(t,e,n,i){n=y(n,i,1);for(var o=n(e),r=0,s=k(t);s>r;){var a=Math.floor((r+s)/2);n(t[a])<o?r=a+1:s=a}return r},_.indexOf=n(1,_.findIndex,_.sortedIndex),_.lastIndexOf=n(-1,_.findLastIndex),_.range=function(t,e,n){null==e&&(e=t||0,t=0),n=n||1;for(var i=Math.max(Math.ceil((e-t)/n),0),o=Array(i),r=0;i>r;r++,t+=n)o[r]=t;return o};var x=function(t,e,n,i,o){if(!(i instanceof e))return t.apply(n,o);var r=E(t.prototype),s=t.apply(r,o);return _.isObject(s)?s:r};_.bind=function(t,e){if(m&&t.bind===m)return m.apply(t,c.call(arguments,1));if(!_.isFunction(t))throw new TypeError("Bind must be called on a function");var n=c.call(arguments,2),i=function(){return x(t,i,e,this,n.concat(c.call(arguments)))};return i},_.partial=function(t){var e=c.call(arguments,1),n=function(){for(var i=0,o=e.length,r=Array(o),s=0;o>s;s++)r[s]=e[s]===_?arguments[i++]:e[s];for(;i<arguments.length;)r.push(arguments[i++]);return x(t,n,this,this,r)};return n},_.bindAll=function(t){var e,n,i=arguments.length;if(1>=i)throw new Error("bindAll must be passed function names");for(e=1;i>e;e++)n=arguments[e],t[n]=_.bind(t[n],t);return t},_.memoize=function(t,e){var n=function(i){var o=n.cache,r=""+(e?e.apply(this,arguments):i);return _.has(o,r)||(o[r]=t.apply(this,arguments)),o[r]};return n.cache={},n},_.delay=function(t,e){var n=c.call(arguments,2);return setTimeout(function(){return t.apply(null,n)},e)},_.defer=_.partial(_.delay,_,1),_.throttle=function(t,e,n){var i,o,r,s=null,a=0;n||(n={});var l=function(){a=n.leading===!1?0:_.now(),s=null,r=t.apply(i,o),s||(i=o=null)};return function(){var d=_.now();a||n.leading!==!1||(a=d);var c=e-(d-a);return i=this,o=arguments,0>=c||c>e?(s&&(clearTimeout(s),s=null),a=d,r=t.apply(i,o),s||(i=o=null)):s||n.trailing===!1||(s=setTimeout(l,c)),r}},_.debounce=function(t,e,n){var i,o,r,s,a,l=function(){var d=_.now()-s;e>d&&d>=0?i=setTimeout(l,e-d):(i=null,n||(a=t.apply(r,o),i||(r=o=null)))};return function(){r=this,o=arguments,s=_.now();var d=n&&!i;return i||(i=setTimeout(l,e)),d&&(a=t.apply(r,o),r=o=null),a}},_.wrap=function(t,e){return _.partial(e,t)},_.negate=function(t){return function(){return!t.apply(this,arguments)}},_.compose=function(){var t=arguments,e=t.length-1;return function(){for(var n=e,i=t[e].apply(this,arguments);n--;)i=t[n].call(this,i);return i}},_.after=function(t,e){return function(){return--t<1?e.apply(this,arguments):void 0}},_.before=function(t,e){var n;return function(){return--t>0&&(n=e.apply(this,arguments)),1>=t&&(e=null),n}},_.once=_.partial(_.before,2);var R=!{toString:null}.propertyIsEnumerable("toString"),A=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];_.keys=function(t){if(!_.isObject(t))return[];if(f)return f(t);var e=[];for(var n in t)_.has(t,n)&&e.push(n);return R&&i(t,e),e},_.allKeys=function(t){if(!_.isObject(t))return[];var e=[];for(var n in t)e.push(n);return R&&i(t,e),e},_.values=function(t){for(var e=_.keys(t),n=e.length,i=Array(n),o=0;n>o;o++)i[o]=t[e[o]];return i},_.mapObject=function(t,e,n){e=y(e,n);for(var i,o=_.keys(t),r=o.length,s={},a=0;r>a;a++)i=o[a],s[i]=e(t[i],i,t);return s},_.pairs=function(t){for(var e=_.keys(t),n=e.length,i=Array(n),o=0;n>o;o++)i[o]=[e[o],t[e[o]]];return i},_.invert=function(t){for(var e={},n=_.keys(t),i=0,o=n.length;o>i;i++)e[t[n[i]]]=n[i];return e},_.functions=_.methods=function(t){var e=[];for(var n in t)_.isFunction(t[n])&&e.push(n);return e.sort()},_.extend=w(_.allKeys),_.extendOwn=_.assign=w(_.keys),_.findKey=function(t,e,n){e=y(e,n);for(var i,o=_.keys(t),r=0,s=o.length;s>r;r++)if(i=o[r],e(t[i],i,t))return i},_.pick=function(t,e,n){var i,o,r={},s=t;if(null==s)return r;_.isFunction(e)?(o=_.allKeys(s),i=v(e,n)):(o=P(arguments,!1,!1,1),i=function(t,e,n){return e in n},s=Object(s));for(var a=0,l=o.length;l>a;a++){var d=o[a],c=s[d];i(c,d,s)&&(r[d]=c)}return r},_.omit=function(t,e,n){if(_.isFunction(e))e=_.negate(e);else{var i=_.map(P(arguments,!1,!1,1),String);e=function(t,e){return!_.contains(i,e)}}return _.pick(t,e,n)},_.defaults=w(_.allKeys,!0),_.create=function(t,e){var n=E(t);return e&&_.extendOwn(n,e),n},_.clone=function(t){return _.isObject(t)?_.isArray(t)?t.slice():_.extend({},t):t},_.tap=function(t,e){return e(t),t},_.isMatch=function(t,e){var n=_.keys(e),i=n.length;if(null==t)return!i;for(var o=Object(t),r=0;i>r;r++){var s=n[r];if(e[s]!==o[s]||!(s in o))return!1}return!0};var O=function(t,e,n,i){if(t===e)return 0!==t||1/t===1/e;if(null==t||null==e)return t===e;t instanceof _&&(t=t._wrapped),e instanceof _&&(e=e._wrapped);var o=u.call(t);if(o!==u.call(e))return!1;switch(o){case"[object RegExp]":case"[object String]":return""+t==""+e;case"[object Number]":return+t!==+t?+e!==+e:0===+t?1/+t===1/e:+t===+e;case"[object Date]":case"[object Boolean]":return+t===+e}var r="[object Array]"===o;if(!r){if("object"!=typeof t||"object"!=typeof e)return!1;var s=t.constructor,a=e.constructor;if(s!==a&&!(_.isFunction(s)&&s instanceof s&&_.isFunction(a)&&a instanceof a)&&"constructor"in t&&"constructor"in e)return!1}n=n||[],i=i||[];for(var l=n.length;l--;)if(n[l]===t)return i[l]===e;if(n.push(t),i.push(e),r){if(l=t.length,l!==e.length)return!1;for(;l--;)if(!O(t[l],e[l],n,i))return!1}else{var d,c=_.keys(t);if(l=c.length,_.keys(e).length!==l)return!1;for(;l--;)if(d=c[l],!_.has(e,d)||!O(t[d],e[d],n,i))return!1}return n.pop(),i.pop(),!0};_.isEqual=function(t,e){return O(t,e)},_.isEmpty=function(t){return null==t?!0:S(t)&&(_.isArray(t)||_.isString(t)||_.isArguments(t))?0===t.length:0===_.keys(t).length},_.isElement=function(t){return!(!t||1!==t.nodeType)},_.isArray=p||function(t){return"[object Array]"===u.call(t)},_.isObject=function(t){var e=typeof t;return"function"===e||"object"===e&&!!t},_.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(t){_["is"+t]=function(e){return u.call(e)==="[object "+t+"]"}}),_.isArguments(arguments)||(_.isArguments=function(t){return _.has(t,"callee")}),"function"!=typeof/./&&"object"!=typeof Int8Array&&(_.isFunction=function(t){return"function"==typeof t||!1}),_.isFinite=function(t){return isFinite(t)&&!isNaN(parseFloat(t))},_.isNaN=function(t){return _.isNumber(t)&&t!==+t},_.isBoolean=function(t){return t===!0||t===!1||"[object Boolean]"===u.call(t)},_.isNull=function(t){return null===t},_.isUndefined=function(t){return void 0===t},_.has=function(t,e){return null!=t&&h.call(t,e)},_.noConflict=function(){return o._=r,this},_.identity=function(t){return t},_.constant=function(t){return function(){return t}},_.noop=function(){},_.property=C,_.propertyOf=function(t){return null==t?function(){}:function(e){return t[e]}},_.matcher=_.matches=function(t){return t=_.extendOwn({},t),function(e){return _.isMatch(e,t)}},_.times=function(t,e,n){var i=Array(Math.max(0,t));e=v(e,n,1);for(var o=0;t>o;o++)i[o]=e(o);return i},_.random=function(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))},_.now=Date.now||function(){return(new Date).getTime()};var M={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},N=_.invert(M),I=function(t){var e=function(e){return t[e]},n="(?:"+_.keys(t).join("|")+")",i=RegExp(n),o=RegExp(n,"g");return function(t){return t=null==t?"":""+t,i.test(t)?t.replace(o,e):t}};_.escape=I(M),_.unescape=I(N),_.result=function(t,e,n){var i=null==t?void 0:t[e];return void 0===i&&(i=n),_.isFunction(i)?i.call(t):i};var D=0;_.uniqueId=function(t){var e=++D+"";return t?t+e:e},_.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var B=/(.)^/,L={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},F=/\\|'|\r|\n|\u2028|\u2029/g,U=function(t){return"\\"+L[t]};_.template=function(t,e,n){!e&&n&&(e=n),e=_.defaults({},e,_.templateSettings);var i=RegExp([(e.escape||B).source,(e.interpolate||B).source,(e.evaluate||B).source].join("|")+"|$","g"),o=0,r="__p+='";t.replace(i,function(e,n,i,s,a){return r+=t.slice(o,a).replace(F,U),o=a+e.length,n?r+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":i?r+="'+\n((__t=("+i+"))==null?'':__t)+\n'":s&&(r+="';\n"+s+"\n__p+='"),e}),r+="';\n",e.variable||(r="with(obj||{}){\n"+r+"}\n"),r="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+r+"return __p;\n";try{var s=new Function(e.variable||"obj","_",r)}catch(a){throw a.source=r,a}var l=function(t){return s.call(this,t,_)},d=e.variable||"obj";return l.source="function("+d+"){\n"+r+"}",l},_.chain=function(t){var e=_(t);return e._chain=!0,e};var j=function(t,e){return t._chain?_(e).chain():e};_.mixin=function(t){_.each(_.functions(t),function(e){var n=_[e]=t[e];_.prototype[e]=function(){var t=[this._wrapped];return d.apply(t,arguments),j(this,n.apply(_,t))}})},_.mixin(_),_.each(["pop","push","reverse","shift","sort","splice","unshift"],function(t){var e=s[t];_.prototype[t]=function(){var n=this._wrapped;return e.apply(n,arguments),"shift"!==t&&"splice"!==t||0!==n.length||delete n[0],j(this,n)}}),_.each(["concat","join","slice"],function(t){var e=s[t];_.prototype[t]=function(){return j(this,e.apply(this._wrapped,arguments))}}),_.prototype.value=function(){return this._wrapped},_.prototype.valueOf=_.prototype.toJSON=_.prototype.value,_.prototype.toString=function(){return""+this._wrapped},"function"==typeof define&&define.amd&&define("underscore",[],function(){return _})}.call(this),define("bootstrap",["underscore"],function(){var t=function(t,e,n,i){_.isString(e)&&(e=require("controller/"+e+"Controller")),_.isString(n)&&(n=require("views/"+n+"View"));var o=new e(t,i),r=new n(o,i);_.isFunction(r.loadView)&&r.loadView(),o.onViewLoaded()};return t}),define("service",["require"],function(t){var e=function(){};return e.get=function(e){if(!$tt._services[e]){var n=t("service/"+e+"Service");$tt._services[e]=new n}return $tt._services[e]},e}),define("core/dust",["underscore"],function(){var t={generateUrl:function(t,e,n,i){return i&&i.hasOwnProperty("path")?t.write(i.path.indexOf("://")>0||0==i.path.indexOf("blob:")?i.path:(Routing.getBaseUrl()+"/").replace(/\w+\.php\/$/gi,"")+i.path):t},generateRouteUrl:function(t,e,n,i){if(!i||!i.hasOwnProperty("name")||!i.hasOwnProperty("str_params"))return t;var o=i.str_params.split("|"),r={};return o.forEach(function(t,n,i){var o=t.split(":");r[o[0]]=e.get(o[1])}),t.write(Routing.generate(i.name,r,i.absolute))},sizeOf:function(t,e,n,i){var o;return this.size({write:function(t){o=t}},e,n,i),n&&n.block?t.render(n.block,e.push({key:o})):t=t.write(o),t},isLoggedInUser:function(t,e,n,i){if(!i||!i.hasOwnProperty("id")||!window.user)return t;var o=i.id==window.user.get("id");return i.inverse&&(o=!o),n?(o&&n.block&&t.render(n.block,e),!o&&n["else"]&&t.render(n["else"],e)):t=t.write(o?"Yes":"No"),t},isNotLoggedInUser:function(t,e,n,i){return i.inverse=!0,this.isLoggedInUser(t,e,n,i)},isUserOnList:function(t,e,n,i){if(!(i&&i.hasOwnProperty("list")&&i.hasOwnProperty("username")&&window.user))return t;var o=window.user["isUserOn"+i.list+"List"](i.username);return n?(o&&n.block&&t.render(n.block,e),!o&&n["else"]&&t.render(n["else"],e)):t=t.write(o?"Yes":"No"),t},isCurrentUser:function(t,e,n,i){if(!i||!i.hasOwnProperty("id")||!window.user)return t;var o=i.id==window.user.get("id");return i.inverse&&(o=!o),n?(o&&n.block&&t.render(n.block,e),!o&&n["else"]&&t.render(n["else"],e)):t=t.write(o?"Yes":"No"),t}},e={nl2br:function(t){return t.replace(/(?:\r\n|\r|\n)/g,"<br />")},date:function(t){var e=new Date(t);if(_.isNaN(e.getTime()))return"";var n=e.getHours()>11?"pm":"am",i=e.getHours()%12,o=e.getMinutes(),r=e.toDateString();return 0==i&&(i=12),10>i&&(i="0"+i),10>o&&(o="0"+o),r=r.substring(r.indexOf(" ")+1),r+" "+i+":"+o+" "+n}},n=function(){};return n.inject=function(){_.each(t,function(t,e,n){dust.helpers[e]=t}),_.each(e,function(t,e,n){dust.filters[e]=t})},n}),define("core/helper",[],function(){var t=function(){};return t.TAG="Helper",t.MEDIA_TYPE_IMAGE=0,t.MEDIA_TYPE_VIDEO=1,t.MEDIA_TYPE_AUDIO=2,t.MEDIA_TYPE_OTHER=9,t.isFullscreen=function(){return document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement?!0:!1},t.toggleFullScreen=function(e){console.log("%s: %s",t.TAG,"toggleFullScreen");var n=e[0];t.isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen():n.requestFullscreen?n.requestFullscreen():n.mozRequestFullScreen?n.mozRequestFullScreen():n.webkitRequestFullscreen?n.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT):n.msRequestFullscreen&&n.msRequestFullscreen()},t.updateProgressBar=function(t,e){var n=t.find(".progress-bar");n.attr("aria-valuenow",e),n.css("width",e+"%"),n.html(e+"%")},t.formatSize=function(t){return-1==t?t:(Number(t)/1024/1024).toFixed(2)+" MB"},t.getIconForMediaType=function(e){var n,i;switch(e){case t.MEDIA_TYPE_IMAGE:n="fa-file-photo-o",i="Image";break;case t.MEDIA_TYPE_VIDEO:n="fa-file-video-o",i="Video";break;case t.MEDIA_TYPE_AUDIO:n="fa-file-audio-o",i="Audio";break;case t.MEDIA_TYPE_OTHER:n="fa-file-o",i="Other"}return{icon:n,text:i}},t.autoSize=function(){$(".autosize").autosize({append:""})},t}),define("core/subscriber",["underscore"],function(){var t=function(){this.subscriptions={}};return t.prototype._dispatch=function(t,e){var n={type:t};!_.isObject(e)||_.isArray(e)||_.isFunction(e)||_.each(e,function(t,e,i){n[e]=t}),_.each(this.subscriptions[t],function(t,e,i){_.isFunction(t)&&t.call(this,n)},this)},t.prototype.subscribe=function(t,e){_.has(this.subscriptions,t)||(this.subscriptions[t]=[]),_.contains(this.subscriptions[t],e)||this.subscriptions[t].push(e)},t.prototype.unsubscribe=function(t){_.each(this.subscriptions,function(e,n,i){if(_.contains(e,t)){var o=_.indexOf(e,t);e.splice(o,1)}})},t}),define("factory/contactFactory",[],function(){var t={};return t["delete"]=function(t,e){var n=$.Deferred(),i={method:"DELETE",url:Routing.generate("imdc_delete_contact"),data:{userIds:t,contactList:e}};return $.ajax(i).then(function(t,e,i){n.resolve(t)},function(t,e,i){console.log(t.responseText),n.reject(t.responseJSON)}),n.promise()},t}),define("factory/forumFactory",[],function(){var t={};return t["delete"]=function(t){var e=$.Deferred(),n={method:"DELETE",url:Routing.generate("imdc_delete_forum",{forumId:t.get("id")})};return $.ajax(n).then(function(t,n,i){e.resolve(t)},function(t,n,i){console.log(t.responseText),e.reject(t.responseJSON)}),e.promise()},t}),define("factory/groupFactory",[],function(){var t={};return t["delete"]=function(t){var e=$.Deferred(),n={method:"DELETE",url:Routing.generate("imdc_delete_user_group",{groupId:t.get("id")})};return $.ajax(n).then(function(t,n,i){e.resolve(t)},function(t,n,i){console.log(t.responseText),e.reject(t.responseJSON)}),e.promise()},t}),define("model/model",["core/subscriber","extra","underscore"],function(t){var e=function(e){if(t.prototype.constructor.apply(this),e=e||{},!_.isObject(e)||_.isArray(e)||_.isFunction(e))throw new Error("data must be an object");this.data=e};return e.extend(t),e.Event={CHANGE:"eventChange"},e._stringToKeyPath=function(t){return t.split(".")},e.prototype._findKeyPath=function(t,n){for(var i=e._stringToKeyPath(n);0!==i.length;){var o=i.shift(),r=parseInt(o,10);if(o=_.isNumber(r)&&!_.isNaN(r)?r:o,!(_.isObject(t)&&_.has(t,o)&&t.hasOwnProperty(o)||_.isArray(t)&&_.contains(t,o)&&void 0!==t[o]))return void 0;t=t[o]}return t},e.prototype._setKeyPath=function(t,n,i){for(var o=e._stringToKeyPath(n);o.length>1;){var r=o.shift(),s=parseInt(r,10);if(r=_.isNumber(s)&&!_.isNaN(s)?s:r,
_.isObject(t)&&!_.has(t,r)&&!t.hasOwnProperty(r)||_.isArray(t)&&!_.contains(t,r)&&void 0===t[r]||_.isNull(t[r])){console.log("defining key: "+r);var a=parseInt(o[0],10);t[r]=_.isNumber(a)&&!_.isNaN(a)?[]:{}}t=t[r]}t[o.shift()]=i},e.prototype._dispatch=function(e,n,i){i=_.extend(i||{},{keyPath:n||"",model:this}),t.prototype._dispatch.call(this,e,i)},e.prototype.get=function(t,e){var n=this._findKeyPath(this.data,t);return"undefined"!=typeof n?n:e},e.prototype.set=function(t,n,i){i="undefined"!=typeof i?i:!0;var o=this._findKeyPath(this.data,t);this._setKeyPath(this.data,t,n),i&&o!==n&&this._dispatch(e.Event.CHANGE,t)},e.prototype.update=function(t,e){_.each(t,function(t,n,i){var o=e?e+"."+n:n;_.isObject(t)||_.isArray(t)?(console.log("update: "+o),this.update(t,o)):(console.log("set: "+o+" to:"+t),this.set(o,t))},this)},e.prototype.forceChange=function(t,n){this._dispatch(e.Event.CHANGE,t,n)},e.prototype.find=function(t,e,n){return _.findIndex(n,function(n){return n.get(e)==t})},e}),define("model/mediaModel",["model/model","extra"],function(t){var e=function(e){t.prototype.constructor.apply(this,arguments)};return e.extend(t),e}),define("factory/mediaFactory",["model/mediaModel","underscore"],function(t){var e={};return e.list=function(e){var n=$.Deferred(),i={url:Routing.generate("imdc_cget_media"),data:{}};return e&&(i.data.id=e.join()),$.ajax(i).then(function(e,i,o){e.media.forEach(function(e,n,i){i[n]=new t(e)}),n.resolve(e)},function(t,e,i){console.log(t.responseText),n.reject(t.responseJSON)}),n.promise()},e.get=function(e){var n=$.Deferred(),i=_.isObject(e),o=i?e.get("id"):e,r={url:Routing.generate("imdc_get_media",{mediaId:o})};return $.ajax(r).then(function(o,r,s){i?(e.update(o.media),o.media=e):o.media=new t(o.media),n.resolve(o)},function(t,e,i){console.log(t.responseText),n.reject(t.responseJSON)}),n.promise()},e.edit=function(t){var e=$.Deferred(),n={method:"PUT",url:Routing.generate("imdc_edit_media",{mediaId:t.get("id")}),data:{media:JSON.stringify(t.data)}};return $.ajax(n).then(function(n,i,o){t.update(n.media),n.media=t,e.resolve(n)},function(t,n,i){console.log(t.responseText),e.reject(t.responseJSON)}),e.promise()},e["delete"]=function(t,e){var n=$.Deferred(),i={method:"DELETE",url:Routing.generate("imdc_delete_media",{mediaId:t.get("id")}),data:{confirm:e||!1}};return $.ajax(i).then(function(t,e,i){n.resolve(t)},function(t,e,i){console.log(t.responseText);var o=t.responseJSON,r=[];o.in_use.forEach(function(t,e,n){r.push(Translator.trans("filesGateway.deleteMediaInUseConfirmation."+t))}),o.confirmText=Translator.trans("filesGateway.deleteMediaInUseConfirmation.finalMessage",{mediaUsedLocations:r.join(", ")}),n.reject(o)}),n.promise()},e.trim=function(e,n,i){var o=$.Deferred(),r={method:"PATCH",url:Routing.generate("imdc_trim_media",{mediaId:e.get("id")}),data:{startTime:n,endTime:i}};return $.ajax(r).then(function(n,i,r){e=new t(n.media),o.resolve(n)},function(t,e,n){console.log(t.responseText),o.reject(t.responseJSON)}),o.promise()},e}),define("factory/messageFactory",[],function(){var t={};return t.edit=function(t){var e=$.Deferred(),n={method:"POST",url:Routing.generate("imdc_message_mark_as_read",{messageid:t.get("id")})};return $.ajax(n).then(function(t,n,i){t.wasEdited?e.resolve(t):e.reject(t)},function(t,n,i){console.log(t.responseText),e.reject(t.responseJSON)}),e.promise()},t}),define("factory/myFilesFactory",["model/mediaModel"],function(t){var e={};return e._prepForFormSubmit=function(t,e,n){e.type="POST",e.contentType=!1,t&&(e.data=new FormData(t)),e.processData=!1,e.xhr=function(){var t=$.ajaxSettings.xhr();return t.upload.addEventListener("progress",function(t){t.lengthComputable&&n.notify(Math.floor(t.loaded/t.total*100))},!1),t}},e.addRecording=function(n){var i=new FormData,o=!!navigator.mozGetUserMedia,r=$.Deferred(),s={url:Routing.generate("imdc_myfiles_add_recording")};return i.append("isFirefox",o),o||i.append("video-blob",n.video),i.append("audio-blob",n.audio),i.append("title",n.title),i.append("isInterpretation",n.isInterpretation),i.append("sourceStartTime",n.sourceStartTime),i.append("sourceId",n.sourceId),e._prepForFormSubmit(null,s,r),s.data=i,$.ajax(s).then(function(e,n,i){200==e.responseCode?(e.media=new t(e.media),r.resolve(e)):r.reject(e)},function(t,e,n){console.log(t.responseText),r.reject()}),r.promise()},e.add=function(n){var i=$.Deferred(),o={url:Routing.generate("imdc_myfiles_add")};return e._prepForFormSubmit(n,o,i),$.ajax(o).then(function(e,n,o){e.wasUploaded?(e.media=new t(e.media),i.resolve(e)):(console.error(e.error),i.reject(e))},function(t,e,n){console.log(t.responseText),i.reject()}),i.promise()},e}),define("model/postModel",["model/model","model/mediaModel","extra"],function(t,e){var n=function(n){t.prototype.constructor.apply(this,arguments),this.data.keyPoint=null,this.data.ordered_media&&this.data.ordered_media.forEach(function(t,n,i){i[n]=new e(t)})};return n.extend(t),n.prototype.isNew=function(){return"0"===String(this.data.id).substr(0,1)},n}),define("factory/postFactory",["model/postModel"],function(t){var e={};return e._prepForFormSubmit=function(t,e){e.contentType=!1,t&&(e.data=new FormData(t)),e.processData=!1},e._newPost=function(e,n,i){var o=$.Deferred();return $.ajax(n).then(function(e,n,i){e.post=new t(e.post),e.post.set("form",e.form),o.resolve(e)},function(t,n,r){console.log(t.responseText),i&&e.set("form",t.responseJSON.form),o.reject(t.responseJSON)}),o.promise()},e["new"]=function(t){var n={url:Routing.generate("imdc_new_post",{threadId:t.get("parent_thread_id"),parentPostId:t.get("parent_post_id")||t.get("id")})};return e._newPost(t,n,!1)},e.post=function(t,n){var i={method:"POST",url:Routing.generate("imdc_post_post",{threadId:t.get("parent_thread_id"),parentPostId:t.get("parent_post_id")||t.get("id")})};return e._prepForFormSubmit(n,i),e._newPost(t,i,!0)},e.get=function(t){var e=$.Deferred(),n={url:Routing.generate("imdc_get_post",{postId:t.get("id")})};return $.ajax(n).then(function(n,i,o){t.update(n.post),e.resolve(n)},function(t,n,i){console.log(t.responseText),e.reject(t.responseJSON)}),e.promise()},e._editPut=function(t,e,n){var i=$.Deferred();return $.ajax(e).then(function(e,n,o){t.update(e.post),t.set("form",e.form),t.set("keyPoint.startTime",t.get("start_time")),t.set("keyPoint.endTime",t.get("end_time")),i.resolve(e)},function(e,o,r){console.log(e.responseText),n&&t.set("form",e.responseJSON.form),i.reject(e.responseJSON)}),i.promise()},e.edit=function(t){var n={url:Routing.generate("imdc_edit_post",{postId:t.get("id")})};return e._editPut(t,n,!1)},e.put=function(t,n){var i={method:"POST",url:Routing.generate("imdc_put_post",{postId:t.get("id")})};return e._prepForFormSubmit(n,i),e._editPut(t,i,!0)},e["delete"]=function(t){var e=$.Deferred(),n={method:"DELETE",url:Routing.generate("imdc_delete_post",{postId:t.get("id")})};return $.ajax(n).then(function(t,n,i){e.resolve(t)},function(t,n,i){console.log(t.responseText),e.reject(t.responseJSON)}),e.promise()},e}),define("factory/threadFactory",[],function(){var t={};return t["delete"]=function(t){var e=$.Deferred(),n={method:"DELETE",url:Routing.generate("imdc_delete_thread",{threadId:t.get("id")})};return $.ajax(n).then(function(t,n,i){e.resolve(t)},function(t,n,i){console.log(t.responseText),e.reject(t.responseJSON)}),e.promise()},t}),define("service/keyPointService",["underscore"],function(){var t=function(){this.name="KeyPoint",this.keyPoints=[],this.subscriptions=[]};return t.Event={ADD:"eventAdd",DURATION:"eventDuration",SELECTION_TIMES:"eventSelectionTimes",HOVER:"eventHover",CLICK:"eventClick",EDIT:"eventEdit",REMOVE:"eventRemove"},t._kIndex=function(t){return _.isString(t)?t:"K"+t},t.prototype.register=function(e){var n=t._kIndex(e.id);_.isObject(e)&&(this.keyPoints[n]=e)},t.prototype.deregister=function(e){var n=t._kIndex(e);_.has(this.keyPoints,n)&&this.keyPoints.splice(n,1)},t.prototype.subscribe=function(e,n){var i=t._kIndex(e);_.has(this.subscriptions,i)||(this.subscriptions[i]=[]),_.contains(this.subscriptions[i],n)||this.subscriptions[i].push(n)},t.prototype.unsubscribe=function(e,n){var i=t._kIndex(e);if(_.has(this.subscriptions,i)){var o=this.subscriptions[i];if(_.contains(o,n)){var r=_.indexOf(o,n);o.splice(r,1)}}},t.prototype.dispatch=function(e,n,i){var o=t._kIndex(e);if(("all"===o||_.has(this.keyPoints,o))&&_.contains(t.Event,n)){var r="all"===o?_.values(this.subscriptions):[this.subscriptions[o]],s=function(t,e,r){var s={type:n};"all"===o?s.keyPoints=this.keyPoints:s.keyPoint=this.keyPoints[o],_.isObject(i)&&_.each(i,function(t,e,n){s[e]=t}),_.each(t,function(t,e,n){_.isFunction(t)&&t.call(this,s)},this)};_.each(r,s,this),"all"!==o&&_.each([this.subscriptions.all],s,this)}},t}),!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define("sockjs",[],t);else{var e;"undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self),e.SockJS=t()}}(function(){var t;return function e(t,n,i){function o(s,a){if(!n[s]){if(!t[s]){var l="function"==typeof require&&require;if(!a&&l)return l(s,!0);if(r)return r(s,!0);var d=new Error("Cannot find module '"+s+"'");throw d.code="MODULE_NOT_FOUND",d}var c=n[s]={exports:{}};t[s][0].call(c.exports,function(e){var n=t[s][1][e];return o(n?n:e)},c,c.exports,e,t,n,i)}return n[s].exports}for(var r="function"==typeof require&&require,s=0;s<i.length;s++)o(i[s]);return o}({1:[function(t,e){(function(n){var i=t("./transport-list");e.exports=t("./main")(i),"_sockjs_onload"in n&&setTimeout(n._sockjs_onload,1)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./main":14,"./transport-list":16}],2:[function(t,e){function n(){o.call(this),this.initEvent("close",!1,!1),this.wasClean=!1,this.code=0,this.reason=""}var i=t("inherits"),o=t("./event");i(n,o),e.exports=n},{"./event":4,inherits:54}],3:[function(t,e){function n(){o.call(this)}var i=t("inherits"),o=t("./eventtarget");i(n,o),n.prototype.removeAllListeners=function(t){t?delete this._listeners[t]:this._listeners={}},n.prototype.once=function(t,e){function n(){i.removeListener(t,n),o||(o=!0,e.apply(this,arguments))}var i=this,o=!1;this.on(t,n)},n.prototype.emit=function(t){var e=this._listeners[t];if(e)for(var n=Array.prototype.slice.call(arguments,1),i=0;i<e.length;i++)e[i].apply(this,n)},n.prototype.on=n.prototype.addListener=o.prototype.addEventListener,n.prototype.removeListener=o.prototype.removeEventListener,e.exports.EventEmitter=n},{"./eventtarget":5,inherits:54}],4:[function(t,e){function n(t){this.type=t}n.prototype.initEvent=function(t,e,n){return this.type=t,this.bubbles=e,this.cancelable=n,this.timeStamp=+new Date,this},n.prototype.stopPropagation=function(){},n.prototype.preventDefault=function(){},n.CAPTURING_PHASE=1,n.AT_TARGET=2,n.BUBBLING_PHASE=3,e.exports=n},{}],5:[function(t,e){function n(){this._listeners={}}n.prototype.addEventListener=function(t,e){t in this._listeners||(this._listeners[t]=[]);var n=this._listeners[t];-1===n.indexOf(e)&&(n=n.concat([e])),this._listeners[t]=n},n.prototype.removeEventListener=function(t,e){var n=this._listeners[t];if(n){var i=n.indexOf(e);return-1!==i?void(n.length>1?this._listeners[t]=n.slice(0,i).concat(n.slice(i+1)):delete this._listeners[t]):void 0}},n.prototype.dispatchEvent=function(t){var e=t.type,n=Array.prototype.slice.call(arguments,0);if(this["on"+e]&&this["on"+e].apply(this,n),e in this._listeners)for(var i=this._listeners[e],o=0;o<i.length;o++)i[o].apply(this,n)},e.exports=n},{}],6:[function(t,e){function n(t){o.call(this),this.initEvent("message",!1,!1),this.data=t}var i=t("inherits"),o=t("./event");i(n,o),e.exports=n},{"./event":4,inherits:54}],7:[function(t,e){function n(t){this._transport=t,t.on("message",this._transportMessage.bind(this)),t.on("close",this._transportClose.bind(this))}var i=t("json3"),o=t("./utils/iframe");n.prototype._transportClose=function(t,e){o.postMessage("c",i.stringify([t,e]))},n.prototype._transportMessage=function(t){o.postMessage("t",t)},n.prototype._send=function(t){this._transport.send(t)},n.prototype._close=function(){this._transport.close(),this._transport.removeAllListeners()},e.exports=n},{"./utils/iframe":47,json3:55}],8:[function(t,e){var n=t("./utils/url"),i=t("./utils/event"),o=t("json3"),r=t("./facade"),s=t("./info-iframe-receiver"),a=t("./utils/iframe"),l=t("./location");e.exports=function(t,e){var d={};e.forEach(function(t){t.facadeTransport&&(d[t.facadeTransport.transportName]=t.facadeTransport)}),d[s.transportName]=s;var c;t.bootstrap_iframe=function(){var e;a.currentWindowId=l.hash.slice(1);var s=function(i){if(i.source===parent&&("undefined"==typeof c&&(c=i.origin),i.origin===c)){var s;try{s=o.parse(i.data)}catch(u){return}if(s.windowId===a.currentWindowId)switch(s.type){case"s":var h;try{h=o.parse(s.data)}catch(u){break}var p=h[0],f=h[1],m=h[2],g=h[3];if(p!==t.version)throw new Error('Incompatibile SockJS! Main site uses: "'+p+'", the iframe: "'+t.version+'".');if(!n.isOriginEqual(m,l.href)||!n.isOriginEqual(g,l.href))throw new Error("Can't connect to different domain from within an iframe. ("+l.href+", "+m+", "+g+")");e=new r(new d[f](m,g));break;case"m":e._send(s.data);break;case"c":e&&e._close(),e=null}}};i.attachEvent("message",s),a.postMessage("s")}}},{"./facade":7,"./info-iframe-receiver":10,"./location":13,"./utils/event":46,"./utils/iframe":47,"./utils/url":52,debug:void 0,json3:55}],9:[function(t,e){function n(t,e){i.call(this);var n=this,o=+new Date;this.xo=new e("GET",t),this.xo.once("finish",function(t,e){var i,a;if(200===t){if(a=+new Date-o,e)try{i=r.parse(e)}catch(l){}s.isObject(i)||(i={})}n.emit("finish",i,a),n.removeAllListeners()})}var i=t("events").EventEmitter,o=t("inherits"),r=t("json3"),s=t("./utils/object");o(n,i),n.prototype.close=function(){this.removeAllListeners(),this.xo.close()},e.exports=n},{"./utils/object":49,debug:void 0,events:3,inherits:54,json3:55}],10:[function(t,e){function n(t,e){var n=this;o.call(this),this.ir=new a(e,s),this.ir.once("finish",function(t,e){n.ir=null,n.emit("message",r.stringify([t,e]))})}var i=t("inherits"),o=t("events").EventEmitter,r=t("json3"),s=t("./transport/sender/xhr-local"),a=t("./info-ajax");i(n,o),n.transportName="iframe-info-receiver",n.prototype.close=function(){this.ir&&(this.ir.close(),this.ir=null),this.removeAllListeners()},e.exports=n},{"./info-ajax":9,"./transport/sender/xhr-local":37,events:3,inherits:54,json3:55}],11:[function(t,e){(function(n){function i(t,e){var i=this;o.call(this);var r=function(){var n=i.ifr=new l(d.transportName,e,t);n.once("message",function(t){if(t){var e;try{e=s.parse(t)}catch(n){return i.emit("finish"),void i.close()}var o=e[0],r=e[1];i.emit("finish",o,r)}i.close()}),n.once("close",function(){i.emit("finish"),i.close()})};n.document.body?r():a.attachEvent("load",r)}var o=t("events").EventEmitter,r=t("inherits"),s=t("json3"),a=t("./utils/event"),l=t("./transport/iframe"),d=t("./info-iframe-receiver");r(i,o),i.enabled=function(){return l.enabled()},i.prototype.close=function(){this.ifr&&this.ifr.close(),this.removeAllListeners(),this.ifr=null},e.exports=i}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./info-iframe-receiver":10,"./transport/iframe":22,"./utils/event":46,debug:void 0,events:3,inherits:54,json3:55}],12:[function(t,e){function n(t,e){var n=this;i.call(this),setTimeout(function(){n.doXhr(t,e)},0)}var i=t("events").EventEmitter,o=t("inherits"),r=t("./utils/url"),s=t("./transport/sender/xdr"),a=t("./transport/sender/xhr-cors"),l=t("./transport/sender/xhr-local"),d=t("./transport/sender/xhr-fake"),c=t("./info-iframe"),u=t("./info-ajax");o(n,i),n._getReceiver=function(t,e,n){return n.sameOrigin?new u(e,l):a.enabled?new u(e,a):s.enabled&&n.sameScheme?new u(e,s):c.enabled()?new c(t,e):new u(e,d)},n.prototype.doXhr=function(t,e){var i=this,o=r.addPath(t,"/info");this.xo=n._getReceiver(t,o,e),this.timeoutRef=setTimeout(function(){i._cleanup(!1),i.emit("finish")},n.timeout),this.xo.once("finish",function(t,e){i._cleanup(!0),i.emit("finish",t,e)})},n.prototype._cleanup=function(t){clearTimeout(this.timeoutRef),this.timeoutRef=null,!t&&this.xo&&this.xo.close(),this.xo=null},n.prototype.close=function(){this.removeAllListeners(),this._cleanup(!1)},n.timeout=8e3,e.exports=n},{"./info-ajax":9,"./info-iframe":11,"./transport/sender/xdr":34,"./transport/sender/xhr-cors":35,"./transport/sender/xhr-fake":36,"./transport/sender/xhr-local":37,"./utils/url":52,debug:void 0,events:3,inherits:54}],13:[function(t,e){(function(t){e.exports=t.location||{origin:"http://localhost:80",protocol:"http",host:"localhost",port:80,href:"http://localhost/",hash:""}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],14:[function(t,e){(function(n){function i(t,e,n){if(!(this instanceof i))return new i(t,e,n);if(arguments.length<1)throw new TypeError("Failed to construct 'SockJS: 1 argument required, but only 0 present");_.call(this),this.readyState=i.CONNECTING,this.extensions="",this.protocol="",n=n||{},n.protocols_whitelist&&g.warn("'protocols_whitelist' is DEPRECATED. Use 'transports' instead."),this._transportsWhitelist=n.transports;var o=n.sessionId||8;if("function"==typeof o)this._generateSessionId=o;else{if("number"!=typeof o)throw new TypeError("If sessionId is used in the options, it needs to be a number or a function.");this._generateSessionId=function(){return d.string(o)}}this._server=n.server||d.numberString(1e3);var r=new s(t);if(!r.host||!r.protocol)throw new SyntaxError("The URL '"+t+"' is invalid");if(r.hash)throw new SyntaxError("The URL must not contain a fragment");if("http:"!==r.protocol&&"https:"!==r.protocol)throw new SyntaxError("The URL's scheme must be either 'http:' or 'https:'. '"+r.protocol+"' is not allowed.");var a="https:"===r.protocol;if("https"===v.protocol&&!a)throw new Error("SecurityError: An insecure SockJS connection may not be initiated from a page loaded over HTTPS");e?Array.isArray(e)||(e=[e]):e=[];var l=e.sort();l.forEach(function(t,e){if(!t)throw new SyntaxError("The protocols entry '"+t+"' is invalid.");if(e<l.length-1&&t===l[e+1])throw new SyntaxError("The protocols entry '"+t+"' is duplicated.")});var c=u.getOrigin(v.href);this._origin=c?c.toLowerCase():null,r.set("pathname",r.pathname.replace(/\/+$/,"")),this.url=r.href,this._urlInfo={nullOrigin:!m.hasDomain(),sameOrigin:u.isOriginEqual(this.url,v.href),sameScheme:u.isSchemeEqual(this.url,v.href)},this._ir=new E(this.url,this._urlInfo),this._ir.once("finish",this._receiveInfo.bind(this))}function o(t){return 1e3===t||t>=3e3&&4999>=t}t("./shims");var r,s=t("url-parse"),a=t("inherits"),l=t("json3"),d=t("./utils/random"),c=t("./utils/escape"),u=t("./utils/url"),h=t("./utils/event"),p=t("./utils/transport"),f=t("./utils/object"),m=t("./utils/browser"),g=t("./utils/log"),b=t("./event/event"),_=t("./event/eventtarget"),v=t("./location"),y=t("./event/close"),w=t("./event/trans-message"),E=t("./info-receiver");a(i,_),i.prototype.close=function(t,e){if(t&&!o(t))throw new Error("InvalidAccessError: Invalid code");if(e&&e.length>123)throw new SyntaxError("reason argument has an invalid length");if(this.readyState!==i.CLOSING&&this.readyState!==i.CLOSED){var n=!0;this._close(t||1e3,e||"Normal closure",n)}},i.prototype.send=function(t){if("string"!=typeof t&&(t=""+t),this.readyState===i.CONNECTING)throw new Error("InvalidStateError: The connection has not been established yet");this.readyState===i.OPEN&&this._transport.send(c.quote(t))},i.version=t("./version"),i.CONNECTING=0,i.OPEN=1,i.CLOSING=2,i.CLOSED=3,i.prototype._receiveInfo=function(t,e){if(this._ir=null,!t)return void this._close(1002,"Cannot connect to server");this._rto=this.countRTO(e),this._transUrl=t.base_url?t.base_url:this.url,t=f.extend(t,this._urlInfo);var n=r.filterToEnabled(this._transportsWhitelist,t);this._transports=n.main,this._connect()},i.prototype._connect=function(){for(var t=this._transports.shift();t;t=this._transports.shift()){if(t.needBody&&(!n.document.body||"undefined"!=typeof n.document.readyState&&"complete"!==n.document.readyState&&"interactive"!==n.document.readyState))return this._transports.unshift(t),void h.attachEvent("load",this._connect.bind(this));var e=this._rto*t.roundTrips||5e3;this._transportTimeoutId=setTimeout(this._transportTimeout.bind(this),e);var i=u.addPath(this._transUrl,"/"+this._server+"/"+this._generateSessionId()),o=new t(i,this._transUrl);return o.on("message",this._transportMessage.bind(this)),o.once("close",this._transportClose.bind(this)),o.transportName=t.transportName,void(this._transport=o)}this._close(2e3,"All transports failed",!1)},i.prototype._transportTimeout=function(){this.readyState===i.CONNECTING&&this._transportClose(2007,"Transport timed out")},i.prototype._transportMessage=function(t){var e,n=this,i=t.slice(0,1),o=t.slice(1);switch(i){case"o":return void this._open();case"h":return void this.dispatchEvent(new b("heartbeat"))}if(o)try{e=l.parse(o)}catch(r){}if("undefined"!=typeof e)switch(i){case"a":Array.isArray(e)&&e.forEach(function(t){n.dispatchEvent(new w(t))});break;case"m":this.dispatchEvent(new w(e));break;case"c":Array.isArray(e)&&2===e.length&&this._close(e[0],e[1],!0)}},i.prototype._transportClose=function(t,e){return this._transport&&(this._transport.removeAllListeners(),this._transport=null,this.transport=null),o(t)||2e3===t||this.readyState!==i.CONNECTING?void this._close(t,e):void this._connect()},i.prototype._open=function(){this.readyState===i.CONNECTING?(this._transportTimeoutId&&(clearTimeout(this._transportTimeoutId),this._transportTimeoutId=null),this.readyState=i.OPEN,this.transport=this._transport.transportName,this.dispatchEvent(new b("open"))):this._close(1006,"Server lost session")},i.prototype._close=function(t,e,n){var o=!1;if(this._ir&&(o=!0,this._ir.close(),this._ir=null),this._transport&&(this._transport.close(),this._transport=null,this.transport=null),this.readyState===i.CLOSED)throw new Error("InvalidStateError: SockJS has already been closed");this.readyState=i.CLOSING,setTimeout(function(){this.readyState=i.CLOSED,o&&this.dispatchEvent(new b("error"));var r=new y("close");r.wasClean=n||!1,r.code=t||1e3,r.reason=e,this.dispatchEvent(r),this.onmessage=this.onclose=this.onerror=null}.bind(this),0)},i.prototype.countRTO=function(t){return t>100?4*t:300+t},e.exports=function(e){return r=p(e),t("./iframe-bootstrap")(i,e),i}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./event/close":2,"./event/event":4,"./event/eventtarget":5,"./event/trans-message":6,"./iframe-bootstrap":8,"./info-receiver":12,"./location":13,"./shims":15,"./utils/browser":44,"./utils/escape":45,"./utils/event":46,"./utils/log":48,"./utils/object":49,"./utils/random":50,"./utils/transport":51,"./utils/url":52,"./version":53,debug:void 0,inherits:54,json3:55,"url-parse":56}],15:[function(){function t(t){var e=+t;return e!==e?e=0:0!==e&&e!==1/0&&e!==-(1/0)&&(e=(e>0||-1)*Math.floor(Math.abs(e))),e}function e(t){return t>>>0}function n(){}var i,o=Array.prototype,r=Object.prototype,s=Function.prototype,a=String.prototype,l=o.slice,d=r.toString,c=function(t){return"[object Function]"===r.toString.call(t)},u=function(t){return"[object Array]"===d.call(t)},h=function(t){return"[object String]"===d.call(t)},p=Object.defineProperty&&function(){try{return Object.defineProperty({},"x",{}),!0}catch(t){return!1}}();i=p?function(t,e,n,i){!i&&e in t||Object.defineProperty(t,e,{configurable:!0,enumerable:!1,writable:!0,value:n})}:function(t,e,n,i){!i&&e in t||(t[e]=n)};var f=function(t,e,n){for(var o in e)r.hasOwnProperty.call(e,o)&&i(t,o,e[o],n)},m=function(t){if(null==t)throw new TypeError("can't convert "+t+" to object");return Object(t)};f(s,{bind:function(t){var e=this;if(!c(e))throw new TypeError("Function.prototype.bind called on incompatible "+e);for(var i=l.call(arguments,1),o=function(){if(this instanceof d){var n=e.apply(this,i.concat(l.call(arguments)));return Object(n)===n?n:this}return e.apply(t,i.concat(l.call(arguments)))},r=Math.max(0,e.length-i.length),s=[],a=0;r>a;a++)s.push("$"+a);var d=Function("binder","return function ("+s.join(",")+"){ return binder.apply(this, arguments); }")(o);return e.prototype&&(n.prototype=e.prototype,d.prototype=new n,n.prototype=null),d}}),f(Array,{isArray:u});var g=Object("a"),b="a"!==g[0]||!(0 in g),_=function(t){var e=!0,n=!0;return t&&(t.call("foo",function(t,n,i){"object"!=typeof i&&(e=!1)}),t.call([1],function(){n="string"==typeof this},"x")),!!t&&e&&n};f(o,{forEach:function(t){var e=m(this),n=b&&h(this)?this.split(""):e,i=arguments[1],o=-1,r=n.length>>>0;if(!c(t))throw new TypeError;for(;++o<r;)o in n&&t.call(i,n[o],o,e)}},!_(o.forEach));var v=Array.prototype.indexOf&&-1!==[0,1].indexOf(1,2);f(o,{indexOf:function(e){var n=b&&h(this)?this.split(""):m(this),i=n.length>>>0;if(!i)return-1;var o=0;for(arguments.length>1&&(o=t(arguments[1])),o=o>=0?o:Math.max(0,i+o);i>o;o++)if(o in n&&n[o]===e)return o;return-1}},v);var y=a.split;2!=="ab".split(/(?:ab)*/).length||4!==".".split(/(.?)(.?)/).length||"t"==="tesst".split(/(s)*/)[1]||4!=="test".split(/(?:)/,-1).length||"".split(/.?/).length||".".split(/()()/).length>1?!function(){var t=void 0===/()??/.exec("")[1];a.split=function(n,i){var r=this;if(void 0===n&&0===i)return[];if("[object RegExp]"!==d.call(n))return y.call(this,n,i);var s,a,l,c,u=[],h=(n.ignoreCase?"i":"")+(n.multiline?"m":"")+(n.extended?"x":"")+(n.sticky?"y":""),p=0;for(n=new RegExp(n.source,h+"g"),r+="",t||(s=new RegExp("^"+n.source+"$(?!\\s)",h)),i=void 0===i?-1>>>0:e(i);(a=n.exec(r))&&(l=a.index+a[0].length,!(l>p&&(u.push(r.slice(p,a.index)),!t&&a.length>1&&a[0].replace(s,function(){for(var t=1;t<arguments.length-2;t++)void 0===arguments[t]&&(a[t]=void 0)}),a.length>1&&a.index<r.length&&o.push.apply(u,a.slice(1)),c=a[0].length,p=l,u.length>=i)));)n.lastIndex===a.index&&n.lastIndex++;return p===r.length?(c||!n.test(""))&&u.push(""):u.push(r.slice(p)),u.length>i?u.slice(0,i):u}}():"0".split(void 0,0).length&&(a.split=function(t,e){return void 0===t&&0===e?[]:y.call(this,t,e)});var w="	\n\f\r \u2028\u2029",E="",C="["+w+"]",T=new RegExp("^"+C+C+"*"),k=new RegExp(C+C+"*$"),S=a.trim&&(w.trim()||!E.trim());f(a,{trim:function(){if(void 0===this||null===this)throw new TypeError("can't convert "+this+" to object");return String(this).replace(T,"").replace(k,"")}},S);var $=a.substr,P="".substr&&"b"!=="0b".substr(-1);f(a,{substr:function(t,e){return $.call(this,0>t&&(t=this.length+t)<0?0:t,e)}},P)},{}],16:[function(t,e){e.exports=[t("./transport/websocket"),t("./transport/xhr-streaming"),t("./transport/xdr-streaming"),t("./transport/eventsource"),t("./transport/lib/iframe-wrap")(t("./transport/eventsource")),t("./transport/htmlfile"),t("./transport/lib/iframe-wrap")(t("./transport/htmlfile")),t("./transport/xhr-polling"),t("./transport/xdr-polling"),t("./transport/lib/iframe-wrap")(t("./transport/xhr-polling")),t("./transport/jsonp-polling")]},{"./transport/eventsource":20,"./transport/htmlfile":21,"./transport/jsonp-polling":23,"./transport/lib/iframe-wrap":26,"./transport/websocket":38,"./transport/xdr-polling":39,"./transport/xdr-streaming":40,"./transport/xhr-polling":41,"./transport/xhr-streaming":42}],17:[function(t,e){(function(n){function i(t,e,n,i){var r=this;o.call(this),setTimeout(function(){r._start(t,e,n,i)},0)}var o=t("events").EventEmitter,r=t("inherits"),s=t("../../utils/event"),a=t("../../utils/url"),l=n.XMLHttpRequest;r(i,o),i.prototype._start=function(t,e,n,o){var r=this;try{this.xhr=new l}catch(d){}if(!this.xhr)return this.emit("finish",0,"no xhr support"),void this._cleanup();e=a.addQuery(e,"t="+ +new Date),this.unloadRef=s.unloadAdd(function(){r._cleanup(!0)});try{this.xhr.open(t,e,!0),this.timeout&&"timeout"in this.xhr&&(this.xhr.timeout=this.timeout,this.xhr.ontimeout=function(){r.emit("finish",0,""),r._cleanup(!1)})}catch(c){return this.emit("finish",0,""),void this._cleanup(!1)}if(o&&o.noCredentials||!i.supportsCORS||(this.xhr.withCredentials="true"),o&&o.headers)for(var u in o.headers)this.xhr.setRequestHeader(u,o.headers[u]);this.xhr.onreadystatechange=function(){if(r.xhr){var t,e,n=r.xhr;switch(n.readyState){case 3:try{e=n.status,t=n.responseText}catch(i){}1223===e&&(e=204),200===e&&t&&t.length>0&&r.emit("chunk",e,t);break;case 4:e=n.status,1223===e&&(e=204),(12005===e||12029===e)&&(e=0),r.emit("finish",e,n.responseText),r._cleanup(!1)}}};try{r.xhr.send(n)}catch(c){r.emit("finish",0,""),r._cleanup(!1)}},i.prototype._cleanup=function(t){if(this.xhr){if(this.removeAllListeners(),s.unloadDel(this.unloadRef),this.xhr.onreadystatechange=function(){},this.xhr.ontimeout&&(this.xhr.ontimeout=null),t)try{this.xhr.abort()}catch(e){}this.unloadRef=this.xhr=null}},i.prototype.close=function(){this._cleanup(!0)},i.enabled=!!l;var d=["Active"].concat("Object").join("X");!i.enabled&&d in n&&(l=function(){try{return new n[d]("Microsoft.XMLHTTP")}catch(t){return null}},i.enabled=!!new l);var c=!1;try{c="withCredentials"in new l}catch(u){}i.supportsCORS=c,e.exports=i}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../utils/event":46,"../../utils/url":52,debug:void 0,events:3,inherits:54}],18:[function(t,e){(function(t){e.exports=t.EventSource}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],19:[function(t,e){(function(t){e.exports=t.WebSocket||t.MozWebSocket}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],20:[function(t,e){function n(t){if(!n.enabled())throw new Error("Transport created when disabled");o.call(this,t,"/eventsource",r,s)}var i=t("inherits"),o=t("./lib/ajax-based"),r=t("./receiver/eventsource"),s=t("./sender/xhr-cors"),a=t("eventsource");i(n,o),n.enabled=function(){return!!a},n.transportName="eventsource",n.roundTrips=2,e.exports=n},{"./lib/ajax-based":24,"./receiver/eventsource":29,"./sender/xhr-cors":35,eventsource:18,inherits:54}],21:[function(t,e){function n(t){if(!o.enabled)throw new Error("Transport created when disabled");s.call(this,t,"/htmlfile",o,r)}var i=t("inherits"),o=t("./receiver/htmlfile"),r=t("./sender/xhr-local"),s=t("./lib/ajax-based");i(n,s),n.enabled=function(t){return o.enabled&&t.sameOrigin},n.transportName="htmlfile",n.roundTrips=2,e.exports=n},{"./lib/ajax-based":24,"./receiver/htmlfile":30,"./sender/xhr-local":37,inherits:54}],22:[function(t,e){function n(t,e,i){if(!n.enabled())throw new Error("Transport created when disabled");r.call(this);var o=this;this.origin=a.getOrigin(i),this.baseUrl=i,this.transUrl=e,this.transport=t,this.windowId=c.string(8);var s=a.addPath(i,"/iframe.html")+"#"+this.windowId;this.iframeObj=l.createIframe(s,function(t){o.emit("close",1006,"Unable to load an iframe ("+t+")"),o.close()}),this.onmessageCallback=this._message.bind(this),d.attachEvent("message",this.onmessageCallback)}var i=t("inherits"),o=t("json3"),r=t("events").EventEmitter,s=t("../version"),a=t("../utils/url"),l=t("../utils/iframe"),d=t("../utils/event"),c=t("../utils/random");i(n,r),n.prototype.close=function(){if(this.removeAllListeners(),this.iframeObj){d.detachEvent("message",this.onmessageCallback);try{this.postMessage("c")}catch(t){}this.iframeObj.cleanup(),this.iframeObj=null,this.onmessageCallback=this.iframeObj=null}},n.prototype._message=function(t){if(a.isOriginEqual(t.origin,this.origin)){var e;try{e=o.parse(t.data)}catch(n){return}if(e.windowId===this.windowId)switch(e.type){case"s":this.iframeObj.loaded(),this.postMessage("s",o.stringify([s,this.transport,this.transUrl,this.baseUrl]));break;case"t":this.emit("message",e.data);break;case"c":var i;try{i=o.parse(e.data)}catch(n){return}this.emit("close",i[0],i[1]),this.close()}}},n.prototype.postMessage=function(t,e){
this.iframeObj.post(o.stringify({windowId:this.windowId,type:t,data:e||""}),this.origin)},n.prototype.send=function(t){this.postMessage("m",t)},n.enabled=function(){return l.iframeEnabled},n.transportName="iframe",n.roundTrips=2,e.exports=n},{"../utils/event":46,"../utils/iframe":47,"../utils/random":50,"../utils/url":52,"../version":53,debug:void 0,events:3,inherits:54,json3:55}],23:[function(t,e){(function(n){function i(t){if(!i.enabled())throw new Error("Transport created when disabled");r.call(this,t,"/jsonp",a,s)}var o=t("inherits"),r=t("./lib/sender-receiver"),s=t("./receiver/jsonp"),a=t("./sender/jsonp");o(i,r),i.enabled=function(){return!!n.document},i.transportName="jsonp-polling",i.roundTrips=1,i.needBody=!0,e.exports=i}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./lib/sender-receiver":28,"./receiver/jsonp":31,"./sender/jsonp":33,inherits:54}],24:[function(t,e){function n(t){return function(e,n,i){var o={};"string"==typeof n&&(o.headers={"Content-type":"text/plain"});var s=r.addPath(e,"/xhr_send"),a=new t("POST",s,n,o);return a.once("finish",function(t){return a=null,200!==t&&204!==t?i(new Error("http status "+t)):void i()}),function(){a.close(),a=null;var t=new Error("Aborted");t.code=1e3,i(t)}}}function i(t,e,i,o){s.call(this,t,e,n(o),i,o)}var o=t("inherits"),r=t("../../utils/url"),s=t("./sender-receiver");o(i,s),e.exports=i},{"../../utils/url":52,"./sender-receiver":28,debug:void 0,inherits:54}],25:[function(t,e){function n(t,e){o.call(this),this.sendBuffer=[],this.sender=e,this.url=t}var i=t("inherits"),o=t("events").EventEmitter;i(n,o),n.prototype.send=function(t){this.sendBuffer.push(t),this.sendStop||this.sendSchedule()},n.prototype.sendScheduleWait=function(){var t,e=this;this.sendStop=function(){e.sendStop=null,clearTimeout(t)},t=setTimeout(function(){e.sendStop=null,e.sendSchedule()},25)},n.prototype.sendSchedule=function(){var t=this;if(this.sendBuffer.length>0){var e="["+this.sendBuffer.join(",")+"]";this.sendStop=this.sender(this.url,e,function(e){t.sendStop=null,e?(t.emit("close",e.code||1006,"Sending error: "+e),t._cleanup()):t.sendScheduleWait()}),this.sendBuffer=[]}},n.prototype._cleanup=function(){this.removeAllListeners()},n.prototype.stop=function(){this._cleanup(),this.sendStop&&(this.sendStop(),this.sendStop=null)},e.exports=n},{debug:void 0,events:3,inherits:54}],26:[function(t,e){(function(n){var i=t("inherits"),o=t("../iframe"),r=t("../../utils/object");e.exports=function(t){function e(e,n){o.call(this,t.transportName,e,n)}return i(e,o),e.enabled=function(e,i){if(!n.document)return!1;var s=r.extend({},i);return s.sameOrigin=!0,t.enabled(s)&&o.enabled()},e.transportName="iframe-"+t.transportName,e.needBody=!0,e.roundTrips=o.roundTrips+t.roundTrips-1,e.facadeTransport=t,e}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../utils/object":49,"../iframe":22,inherits:54}],27:[function(t,e){function n(t,e,n){o.call(this),this.Receiver=t,this.receiveUrl=e,this.AjaxObject=n,this._scheduleReceiver()}var i=t("inherits"),o=t("events").EventEmitter;i(n,o),n.prototype._scheduleReceiver=function(){var t=this,e=this.poll=new this.Receiver(this.receiveUrl,this.AjaxObject);e.on("message",function(e){t.emit("message",e)}),e.once("close",function(n,i){t.poll=e=null,t.pollIsClosing||("network"===i?t._scheduleReceiver():(t.emit("close",n||1006,i),t.removeAllListeners()))})},n.prototype.abort=function(){this.removeAllListeners(),this.pollIsClosing=!0,this.poll&&this.poll.abort()},e.exports=n},{debug:void 0,events:3,inherits:54}],28:[function(t,e){function n(t,e,n,i,a){var l=o.addPath(t,e),d=this;r.call(this,t,n),this.poll=new s(i,l,a),this.poll.on("message",function(t){d.emit("message",t)}),this.poll.once("close",function(t,e){d.poll=null,d.emit("close",t,e),d.close()})}var i=t("inherits"),o=t("../../utils/url"),r=t("./buffered-sender"),s=t("./polling");i(n,r),n.prototype.close=function(){this.removeAllListeners(),this.poll&&(this.poll.abort(),this.poll=null),this.stop()},e.exports=n},{"../../utils/url":52,"./buffered-sender":25,"./polling":27,debug:void 0,inherits:54}],29:[function(t,e){function n(t){o.call(this);var e=this,n=this.es=new r(t);n.onmessage=function(t){e.emit("message",decodeURI(t.data))},n.onerror=function(t){var i=2!==n.readyState?"network":"permanent";e._cleanup(),e._close(i)}}var i=t("inherits"),o=t("events").EventEmitter,r=t("eventsource");i(n,o),n.prototype.abort=function(){this._cleanup(),this._close("user")},n.prototype._cleanup=function(){var t=this.es;t&&(t.onmessage=t.onerror=null,t.close(),this.es=null)},n.prototype._close=function(t){var e=this;setTimeout(function(){e.emit("close",null,t),e.removeAllListeners()},200)},e.exports=n},{debug:void 0,events:3,eventsource:18,inherits:54}],30:[function(t,e){(function(n){function i(t){a.call(this);var e=this;r.polluteGlobalNamespace(),this.id="a"+l.string(6),t=s.addQuery(t,"c="+decodeURIComponent(r.WPrefix+"."+this.id));var o=i.htmlfileEnabled?r.createHtmlfile:r.createIframe;n[r.WPrefix][this.id]={start:function(){e.iframeObj.loaded()},message:function(t){e.emit("message",t)},stop:function(){e._cleanup(),e._close("network")}},this.iframeObj=o(t,function(){e._cleanup(),e._close("permanent")})}var o=t("inherits"),r=t("../../utils/iframe"),s=t("../../utils/url"),a=t("events").EventEmitter,l=t("../../utils/random");o(i,a),i.prototype.abort=function(){this._cleanup(),this._close("user")},i.prototype._cleanup=function(){this.iframeObj&&(this.iframeObj.cleanup(),this.iframeObj=null),delete n[r.WPrefix][this.id]},i.prototype._close=function(t){this.emit("close",null,t),this.removeAllListeners()},i.htmlfileEnabled=!1;var d=["Active"].concat("Object").join("X");if(d in n)try{i.htmlfileEnabled=!!new n[d]("htmlfile")}catch(c){}i.enabled=i.htmlfileEnabled||r.iframeEnabled,e.exports=i}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../utils/iframe":47,"../../utils/random":50,"../../utils/url":52,debug:void 0,events:3,inherits:54}],31:[function(t,e){(function(n){function i(t){var e=this;d.call(this),o.polluteGlobalNamespace(),this.id="a"+r.string(6);var s=a.addQuery(t,"c="+encodeURIComponent(o.WPrefix+"."+this.id));n[o.WPrefix][this.id]=this._callback.bind(this),this._createScript(s),this.timeoutId=setTimeout(function(){e._abort(new Error("JSONP script loaded abnormally (timeout)"))},i.timeout)}var o=t("../../utils/iframe"),r=t("../../utils/random"),s=t("../../utils/browser"),a=t("../../utils/url"),l=t("inherits"),d=t("events").EventEmitter;l(i,d),i.prototype.abort=function(){if(n[o.WPrefix][this.id]){var t=new Error("JSONP user aborted read");t.code=1e3,this._abort(t)}},i.timeout=35e3,i.scriptErrorTimeout=1e3,i.prototype._callback=function(t){this._cleanup(),this.aborting||(t&&this.emit("message",t),this.emit("close",null,"network"),this.removeAllListeners())},i.prototype._abort=function(t){this._cleanup(),this.aborting=!0,this.emit("close",t.code,t.message),this.removeAllListeners()},i.prototype._cleanup=function(){if(clearTimeout(this.timeoutId),this.script2&&(this.script2.parentNode.removeChild(this.script2),this.script2=null),this.script){var t=this.script;t.parentNode.removeChild(t),t.onreadystatechange=t.onerror=t.onload=t.onclick=null,this.script=null}delete n[o.WPrefix][this.id]},i.prototype._scriptError=function(){var t=this;this.errorTimer||(this.errorTimer=setTimeout(function(){t.loadedOkay||t._abort(new Error("JSONP script loaded abnormally (onerror)"))},i.scriptErrorTimeout))},i.prototype._createScript=function(t){var e,i=this,o=this.script=n.document.createElement("script");if(o.id="a"+r.string(8),o.src=t,o.type="text/javascript",o.charset="UTF-8",o.onerror=this._scriptError.bind(this),o.onload=function(){i._abort(new Error("JSONP script loaded abnormally (onload)"))},o.onreadystatechange=function(){if(/loaded|closed/.test(o.readyState)){if(o&&o.htmlFor&&o.onclick){i.loadedOkay=!0;try{o.onclick()}catch(t){}}o&&i._abort(new Error("JSONP script loaded abnormally (onreadystatechange)"))}},"undefined"==typeof o.async&&n.document.attachEvent)if(s.isOpera())e=this.script2=n.document.createElement("script"),e.text="try{var a = document.getElementById('"+o.id+"'); if(a)a.onerror();}catch(x){};",o.async=e.async=!1;else{try{o.htmlFor=o.id,o.event="onclick"}catch(a){}o.async=!0}"undefined"!=typeof o.async&&(o.async=!0);var l=n.document.getElementsByTagName("head")[0];l.insertBefore(o,l.firstChild),e&&l.insertBefore(e,l.firstChild)},e.exports=i}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../utils/browser":44,"../../utils/iframe":47,"../../utils/random":50,"../../utils/url":52,debug:void 0,events:3,inherits:54}],32:[function(t,e){function n(t,e){o.call(this);var n=this;this.bufferPosition=0,this.xo=new e("POST",t,null),this.xo.on("chunk",this._chunkHandler.bind(this)),this.xo.once("finish",function(t,e){n._chunkHandler(t,e),n.xo=null;var i=200===t?"network":"permanent";n.emit("close",null,i),n._cleanup()})}var i=t("inherits"),o=t("events").EventEmitter;i(n,o),n.prototype._chunkHandler=function(t,e){if(200===t&&e)for(var n=-1;;this.bufferPosition+=n+1){var i=e.slice(this.bufferPosition);if(n=i.indexOf("\n"),-1===n)break;var o=i.slice(0,n);o&&this.emit("message",o)}},n.prototype._cleanup=function(){this.removeAllListeners()},n.prototype.abort=function(){this.xo&&(this.xo.close(),this.emit("close",null,"user"),this.xo=null),this._cleanup()},e.exports=n},{debug:void 0,events:3,inherits:54}],33:[function(t,e){(function(n){function i(t){try{return n.document.createElement('<iframe name="'+t+'">')}catch(e){var i=n.document.createElement("iframe");return i.name=t,i}}function o(){r=n.document.createElement("form"),r.style.display="none",r.style.position="absolute",r.method="POST",r.enctype="application/x-www-form-urlencoded",r.acceptCharset="UTF-8",s=n.document.createElement("textarea"),s.name="d",r.appendChild(s),n.document.body.appendChild(r)}var r,s,a=t("../../utils/random"),l=t("../../utils/url");e.exports=function(t,e,n){r||o();var d="a"+a.string(8);r.target=d,r.action=l.addQuery(l.addPath(t,"/jsonp_send"),"i="+d);var c=i(d);c.id=d,c.style.display="none",r.appendChild(c);try{s.value=e}catch(u){}r.submit();var h=function(t){c.onerror&&(c.onreadystatechange=c.onerror=c.onload=null,setTimeout(function(){c.parentNode.removeChild(c),c=null},500),s.value="",n(t))};return c.onerror=function(){h()},c.onload=function(){h()},c.onreadystatechange=function(t){"complete"===c.readyState&&h()},function(){h(new Error("Aborted"))}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../utils/random":50,"../../utils/url":52,debug:void 0}],34:[function(t,e){(function(n){function i(t,e,n){var i=this;o.call(this),setTimeout(function(){i._start(t,e,n)},0)}var o=t("events").EventEmitter,r=t("inherits"),s=t("../../utils/event"),a=t("../../utils/browser"),l=t("../../utils/url");r(i,o),i.prototype._start=function(t,e,i){var o=this,r=new n.XDomainRequest;e=l.addQuery(e,"t="+ +new Date),r.onerror=function(){o._error()},r.ontimeout=function(){o._error()},r.onprogress=function(){o.emit("chunk",200,r.responseText)},r.onload=function(){o.emit("finish",200,r.responseText),o._cleanup(!1)},this.xdr=r,this.unloadRef=s.unloadAdd(function(){o._cleanup(!0)});try{this.xdr.open(t,e),this.timeout&&(this.xdr.timeout=this.timeout),this.xdr.send(i)}catch(a){this._error()}},i.prototype._error=function(){this.emit("finish",0,""),this._cleanup(!1)},i.prototype._cleanup=function(t){if(this.xdr){if(this.removeAllListeners(),s.unloadDel(this.unloadRef),this.xdr.ontimeout=this.xdr.onerror=this.xdr.onprogress=this.xdr.onload=null,t)try{this.xdr.abort()}catch(e){}this.unloadRef=this.xdr=null}},i.prototype.close=function(){this._cleanup(!0)},i.enabled=!(!n.XDomainRequest||!a.hasDomain()),e.exports=i}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../utils/browser":44,"../../utils/event":46,"../../utils/url":52,debug:void 0,events:3,inherits:54}],35:[function(t,e){function n(t,e,n,i){o.call(this,t,e,n,i)}var i=t("inherits"),o=t("../driver/xhr");i(n,o),n.enabled=o.enabled&&o.supportsCORS,e.exports=n},{"../driver/xhr":17,inherits:54}],36:[function(t,e){function n(){var t=this;i.call(this),this.to=setTimeout(function(){t.emit("finish",200,"{}")},n.timeout)}var i=t("events").EventEmitter,o=t("inherits");o(n,i),n.prototype.close=function(){clearTimeout(this.to)},n.timeout=2e3,e.exports=n},{events:3,inherits:54}],37:[function(t,e){function n(t,e,n){o.call(this,t,e,n,{noCredentials:!0})}var i=t("inherits"),o=t("../driver/xhr");i(n,o),n.enabled=o.enabled,e.exports=n},{"../driver/xhr":17,inherits:54}],38:[function(t,e){function n(t){if(!n.enabled())throw new Error("Transport created when disabled");s.call(this);var e=this,r=o.addPath(t,"/websocket");r="https"===r.slice(0,5)?"wss"+r.slice(5):"ws"+r.slice(4),this.url=r,this.ws=new a(this.url),this.ws.onmessage=function(t){e.emit("message",t.data)},this.unloadRef=i.unloadAdd(function(){e.ws.close()}),this.ws.onclose=function(t){e.emit("close",t.code,t.reason),e._cleanup()},this.ws.onerror=function(t){e.emit("close",1006,"WebSocket connection broken"),e._cleanup()}}var i=t("../utils/event"),o=t("../utils/url"),r=t("inherits"),s=t("events").EventEmitter,a=t("./driver/websocket");r(n,s),n.prototype.send=function(t){var e="["+t+"]";this.ws.send(e)},n.prototype.close=function(){this.ws&&this.ws.close(),this._cleanup()},n.prototype._cleanup=function(){var t=this.ws;t&&(t.onmessage=t.onclose=t.onerror=null),i.unloadDel(this.unloadRef),this.unloadRef=this.ws=null,this.removeAllListeners()},n.enabled=function(){return!!a},n.transportName="websocket",n.roundTrips=2,e.exports=n},{"../utils/event":46,"../utils/url":52,"./driver/websocket":19,debug:void 0,events:3,inherits:54}],39:[function(t,e){function n(t){if(!a.enabled)throw new Error("Transport created when disabled");o.call(this,t,"/xhr",s,a)}var i=t("inherits"),o=t("./lib/ajax-based"),r=t("./xdr-streaming"),s=t("./receiver/xhr"),a=t("./sender/xdr");i(n,o),n.enabled=r.enabled,n.transportName="xdr-polling",n.roundTrips=2,e.exports=n},{"./lib/ajax-based":24,"./receiver/xhr":32,"./sender/xdr":34,"./xdr-streaming":40,inherits:54}],40:[function(t,e){function n(t){if(!s.enabled)throw new Error("Transport created when disabled");o.call(this,t,"/xhr_streaming",r,s)}var i=t("inherits"),o=t("./lib/ajax-based"),r=t("./receiver/xhr"),s=t("./sender/xdr");i(n,o),n.enabled=function(t){return t.cookie_needed||t.nullOrigin?!1:s.enabled&&t.sameScheme},n.transportName="xdr-streaming",n.roundTrips=2,e.exports=n},{"./lib/ajax-based":24,"./receiver/xhr":32,"./sender/xdr":34,inherits:54}],41:[function(t,e){function n(t){if(!a.enabled&&!s.enabled)throw new Error("Transport created when disabled");o.call(this,t,"/xhr",r,s)}var i=t("inherits"),o=t("./lib/ajax-based"),r=t("./receiver/xhr"),s=t("./sender/xhr-cors"),a=t("./sender/xhr-local");i(n,o),n.enabled=function(t){return t.nullOrigin?!1:a.enabled&&t.sameOrigin?!0:s.enabled},n.transportName="xhr-polling",n.roundTrips=2,e.exports=n},{"./lib/ajax-based":24,"./receiver/xhr":32,"./sender/xhr-cors":35,"./sender/xhr-local":37,inherits:54}],42:[function(t,e){(function(n){function i(t){if(!l.enabled&&!a.enabled)throw new Error("Transport created when disabled");r.call(this,t,"/xhr_streaming",s,a)}var o=t("inherits"),r=t("./lib/ajax-based"),s=t("./receiver/xhr"),a=t("./sender/xhr-cors"),l=t("./sender/xhr-local"),d=t("../utils/browser");o(i,r),i.enabled=function(t){return t.nullOrigin?!1:d.isOpera()?!1:a.enabled},i.transportName="xhr-streaming",i.roundTrips=2,i.needBody=!!n.document,e.exports=i}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../utils/browser":44,"./lib/ajax-based":24,"./receiver/xhr":32,"./sender/xhr-cors":35,"./sender/xhr-local":37,inherits:54}],43:[function(t,e){(function(t){e.exports.randomBytes=t.crypto&&t.crypto.getRandomValues?function(e){var n=new Uint8Array(e);return t.crypto.getRandomValues(n),n}:function(t){for(var e=new Array(t),n=0;t>n;n++)e[n]=Math.floor(256*Math.random());return e}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],44:[function(t,e){(function(t){e.exports={isOpera:function(){return t.navigator&&/opera/i.test(t.navigator.userAgent)},isKonqueror:function(){return t.navigator&&/konqueror/i.test(t.navigator.userAgent)},hasDomain:function(){if(!t.document)return!0;try{return!!t.document.domain}catch(e){return!1}}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],45:[function(t,e){var n,i=t("json3"),o=/[\x00-\x1f\ud800-\udfff\ufffe\uffff\u0300-\u0333\u033d-\u0346\u034a-\u034c\u0350-\u0352\u0357-\u0358\u035c-\u0362\u0374\u037e\u0387\u0591-\u05af\u05c4\u0610-\u0617\u0653-\u0654\u0657-\u065b\u065d-\u065e\u06df-\u06e2\u06eb-\u06ec\u0730\u0732-\u0733\u0735-\u0736\u073a\u073d\u073f-\u0741\u0743\u0745\u0747\u07eb-\u07f1\u0951\u0958-\u095f\u09dc-\u09dd\u09df\u0a33\u0a36\u0a59-\u0a5b\u0a5e\u0b5c-\u0b5d\u0e38-\u0e39\u0f43\u0f4d\u0f52\u0f57\u0f5c\u0f69\u0f72-\u0f76\u0f78\u0f80-\u0f83\u0f93\u0f9d\u0fa2\u0fa7\u0fac\u0fb9\u1939-\u193a\u1a17\u1b6b\u1cda-\u1cdb\u1dc0-\u1dcf\u1dfc\u1dfe\u1f71\u1f73\u1f75\u1f77\u1f79\u1f7b\u1f7d\u1fbb\u1fbe\u1fc9\u1fcb\u1fd3\u1fdb\u1fe3\u1feb\u1fee-\u1fef\u1ff9\u1ffb\u1ffd\u2000-\u2001\u20d0-\u20d1\u20d4-\u20d7\u20e7-\u20e9\u2126\u212a-\u212b\u2329-\u232a\u2adc\u302b-\u302c\uaab2-\uaab3\uf900-\ufa0d\ufa10\ufa12\ufa15-\ufa1e\ufa20\ufa22\ufa25-\ufa26\ufa2a-\ufa2d\ufa30-\ufa6d\ufa70-\ufad9\ufb1d\ufb1f\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufb4e\ufff0-\uffff]/g,r=function(t){var e,n={},i=[];for(e=0;65536>e;e++)i.push(String.fromCharCode(e));return t.lastIndex=0,i.join("").replace(t,function(t){return n[t]="\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4),""}),t.lastIndex=0,n};e.exports={quote:function(t){var e=i.stringify(t);return o.lastIndex=0,o.test(e)?(n||(n=r(o)),e.replace(o,function(t){return n[t]})):e}}},{json3:55}],46:[function(t,e){(function(n){var i=t("./random"),o={},r=!1,s=n.chrome&&n.chrome.app&&n.chrome.app.runtime;e.exports={attachEvent:function(t,e){"undefined"!=typeof n.addEventListener?n.addEventListener(t,e,!1):n.document&&n.attachEvent&&(n.document.attachEvent("on"+t,e),n.attachEvent("on"+t,e))},detachEvent:function(t,e){"undefined"!=typeof n.addEventListener?n.removeEventListener(t,e,!1):n.document&&n.detachEvent&&(n.document.detachEvent("on"+t,e),n.detachEvent("on"+t,e))},unloadAdd:function(t){if(s)return null;var e=i.string(8);return o[e]=t,r&&setTimeout(this.triggerUnloadCallbacks,0),e},unloadDel:function(t){t in o&&delete o[t]},triggerUnloadCallbacks:function(){for(var t in o)o[t](),delete o[t]}};var a=function(){r||(r=!0,e.exports.triggerUnloadCallbacks())};s||e.exports.attachEvent("unload",a)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./random":50}],47:[function(t,e){(function(n){var i=t("./event"),o=t("json3"),r=t("./browser");e.exports={WPrefix:"_jp",currentWindowId:null,polluteGlobalNamespace:function(){e.exports.WPrefix in n||(n[e.exports.WPrefix]={})},postMessage:function(t,i){n.parent!==n&&n.parent.postMessage(o.stringify({windowId:e.exports.currentWindowId,type:t,data:i||""}),"*")},createIframe:function(t,e){var o,r,s=n.document.createElement("iframe"),a=function(){clearTimeout(o);try{s.onload=null}catch(t){}s.onerror=null},l=function(){s&&(a(),setTimeout(function(){s&&s.parentNode.removeChild(s),s=null},0),i.unloadDel(r))},d=function(t){s&&(l(),e(t))},c=function(t,e){try{s&&s.contentWindow&&setTimeout(function(){s.contentWindow.postMessage(t,e)},0)}catch(n){}};return s.src=t,s.style.display="none",s.style.position="absolute",s.onerror=function(){d("onerror")},s.onload=function(){clearTimeout(o),o=setTimeout(function(){d("onload timeout")},2e3)},n.document.body.appendChild(s),o=setTimeout(function(){d("timeout")},15e3),r=i.unloadAdd(l),{post:c,cleanup:l,loaded:a}},createHtmlfile:function(t,o){var r,s,a,l=["Active"].concat("Object").join("X"),d=new n[l]("htmlfile"),c=function(){clearTimeout(r),a.onerror=null},u=function(){d&&(c(),i.unloadDel(s),a.parentNode.removeChild(a),a=d=null,CollectGarbage())},h=function(t){d&&(u(),o(t))},p=function(t,e){try{a&&a.contentWindow&&setTimeout(function(){a.contentWindow.postMessage(t,e)},0)}catch(n){}};d.open(),d.write('<html><script>document.domain="'+n.document.domain+'";</script></html>'),d.close(),d.parentWindow[e.exports.WPrefix]=n[e.exports.WPrefix];var f=d.createElement("div");return d.body.appendChild(f),a=d.createElement("iframe"),f.appendChild(a),a.src=t,a.onerror=function(){h("onerror")},r=setTimeout(function(){h("timeout")},15e3),s=i.unloadAdd(u),{post:p,cleanup:u,loaded:c}}},e.exports.iframeEnabled=!1,n.document&&(e.exports.iframeEnabled=("function"==typeof n.postMessage||"object"==typeof n.postMessage)&&!r.isKonqueror())}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./browser":44,"./event":46,debug:void 0,json3:55}],48:[function(t,e){(function(t){var n={};["log","debug","warn"].forEach(function(e){var i=t.console&&t.console[e]&&t.console[e].apply;n[e]=i?function(){return t.console[e].apply(t.console,arguments)}:"log"===e?function(){}:n.log}),e.exports=n}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],49:[function(t,e){e.exports={isObject:function(t){var e=typeof t;return"function"===e||"object"===e&&!!t},extend:function(t){if(!this.isObject(t))return t;for(var e,n,i=1,o=arguments.length;o>i;i++){e=arguments[i];for(n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}return t}}},{}],50:[function(t,e){var n=t("crypto"),i="abcdefghijklmnopqrstuvwxyz012345";e.exports={string:function(t){for(var e=i.length,o=n.randomBytes(t),r=[],s=0;t>s;s++)r.push(i.substr(o[s]%e,1));return r.join("")},number:function(t){return Math.floor(Math.random()*t)},numberString:function(t){var e=(""+(t-1)).length,n=new Array(e+1).join("0");return(n+this.number(t)).slice(-e)}}},{crypto:43}],51:[function(t,e){e.exports=function(t){return{filterToEnabled:function(e,n){var i={main:[],facade:[]};return e?"string"==typeof e&&(e=[e]):e=[],t.forEach(function(t){t&&("websocket"!==t.transportName||n.websocket!==!1)&&(e.length&&-1===e.indexOf(t.transportName)||t.enabled(n)&&(i.main.push(t),t.facadeTransport&&i.facade.push(t.facadeTransport)))}),i}}}},{debug:void 0}],52:[function(t,e){var n=t("url-parse");e.exports={getOrigin:function(t){if(!t)return null;var e=new n(t);if("file:"===e.protocol)return null;var i=e.port;return i||(i="https:"===e.protocol?"443":"80"),e.protocol+"//"+e.hostname+":"+i},isOriginEqual:function(t,e){var n=this.getOrigin(t)===this.getOrigin(e);return n},isSchemeEqual:function(t,e){return t.split(":")[0]===e.split(":")[0]},addPath:function(t,e){var n=t.split("?");return n[0]+e+(n[1]?"?"+n[1]:"")},addQuery:function(t,e){return t+(-1===t.indexOf("?")?"?"+e:"&"+e)}}},{debug:void 0,"url-parse":56}],53:[function(t,e){e.exports="1.0.1"},{}],54:[function(t,e){e.exports="function"==typeof Object.create?function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:function(t,e){t.super_=e;var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}},{}],55:[function(e,n,i){(function(e){(function(){function o(t,e){function n(t){if(n[t]!==g)return n[t];var o;if("bug-string-char-index"==t)o="a"!="a"[0];else if("json"==t)o=n("json-stringify")&&n("json-parse");else{var s,a='{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}';if("json-stringify"==t){var l=e.stringify,c="function"==typeof l&&v;if(c){(s=function(){return 1}).toJSON=s;try{c="0"===l(0)&&"0"===l(new i)&&'""'==l(new r)&&l(_)===g&&l(g)===g&&l()===g&&"1"===l(s)&&"[1]"==l([s])&&"[null]"==l([g])&&"null"==l(null)&&"[null,null,null]"==l([g,_,null])&&l({a:[s,!0,!1,null,"\x00\b\n\f\r	"]})==a&&"1"===l(null,s)&&"[\n 1,\n 2\n]"==l([1,2],null,1)&&'"-271821-04-20T00:00:00.000Z"'==l(new d(-864e13))&&'"+275760-09-13T00:00:00.000Z"'==l(new d(864e13))&&'"-000001-01-01T00:00:00.000Z"'==l(new d(-621987552e5))&&'"1969-12-31T23:59:59.999Z"'==l(new d(-1))}catch(u){c=!1}}o=c}if("json-parse"==t){var h=e.parse;if("function"==typeof h)try{if(0===h("0")&&!h(!1)){s=h(a);var p=5==s.a.length&&1===s.a[0];if(p){try{p=!h('"	"')}catch(u){}if(p)try{p=1!==h("01")}catch(u){}if(p)try{p=1!==h("1.")}catch(u){}}}}catch(u){p=!1}o=p}}return n[t]=!!o}t||(t=l.Object()),e||(e=l.Object());var i=t.Number||l.Number,r=t.String||l.String,a=t.Object||l.Object,d=t.Date||l.Date,c=t.SyntaxError||l.SyntaxError,u=t.TypeError||l.TypeError,h=t.Math||l.Math,p=t.JSON||l.JSON;"object"==typeof p&&p&&(e.stringify=p.stringify,e.parse=p.parse);var f,m,g,b=a.prototype,_=b.toString,v=new d(-0xc782b5b800cec);try{v=-109252==v.getUTCFullYear()&&0===v.getUTCMonth()&&1===v.getUTCDate()&&10==v.getUTCHours()&&37==v.getUTCMinutes()&&6==v.getUTCSeconds()&&708==v.getUTCMilliseconds()}catch(y){}if(!n("json")){var w="[object Function]",E="[object Date]",C="[object Number]",T="[object String]",k="[object Array]",S="[object Boolean]",$=n("bug-string-char-index");if(!v)var P=h.floor,x=[0,31,59,90,120,151,181,212,243,273,304,334],R=function(t,e){return x[e]+365*(t-1970)+P((t-1969+(e=+(e>1)))/4)-P((t-1901+e)/100)+P((t-1601+e)/400)};if((f=b.hasOwnProperty)||(f=function(t){var e,n={};return(n.__proto__=null,n.__proto__={toString:1},n).toString!=_?f=function(t){var e=this.__proto__,n=t in(this.__proto__=null,this);return this.__proto__=e,n}:(e=n.constructor,f=function(t){var n=(this.constructor||e).prototype;return t in this&&!(t in n&&this[t]===n[t])}),n=null,f.call(this,t)}),m=function(t,e){var n,i,o,r=0;(n=function(){this.valueOf=0}).prototype.valueOf=0,i=new n;for(o in i)f.call(i,o)&&r++;return n=i=null,r?m=2==r?function(t,e){var n,i={},o=_.call(t)==w;for(n in t)o&&"prototype"==n||f.call(i,n)||!(i[n]=1)||!f.call(t,n)||e(n)}:function(t,e){var n,i,o=_.call(t)==w;for(n in t)o&&"prototype"==n||!f.call(t,n)||(i="constructor"===n)||e(n);(i||f.call(t,n="constructor"))&&e(n)}:(i=["valueOf","toString","toLocaleString","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","constructor"],m=function(t,e){var n,o,r=_.call(t)==w,a=!r&&"function"!=typeof t.constructor&&s[typeof t.hasOwnProperty]&&t.hasOwnProperty||f;for(n in t)r&&"prototype"==n||!a.call(t,n)||e(n);for(o=i.length;n=i[--o];a.call(t,n)&&e(n));}),m(t,e)},!n("json-stringify")){var A={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"},O="000000",M=function(t,e){return(O+(e||0)).slice(-t)},N="\\u00",I=function(t){for(var e='"',n=0,i=t.length,o=!$||i>10,r=o&&($?t.split(""):t);i>n;n++){var s=t.charCodeAt(n);switch(s){case 8:case 9:case 10:case 12:case 13:case 34:case 92:e+=A[s];break;default:if(32>s){e+=N+M(2,s.toString(16));break}e+=o?r[n]:t.charAt(n)}}return e+'"'},D=function(t,e,n,i,o,r,s){var a,l,d,c,h,p,b,v,y,w,$,x,A,O,N,B;try{a=e[t]}catch(L){}if("object"==typeof a&&a)if(l=_.call(a),l!=E||f.call(a,"toJSON"))"function"==typeof a.toJSON&&(l!=C&&l!=T&&l!=k||f.call(a,"toJSON"))&&(a=a.toJSON(t));else if(a>-1/0&&1/0>a){if(R){for(h=P(a/864e5),d=P(h/365.2425)+1970-1;R(d+1,0)<=h;d++);for(c=P((h-R(d,0))/30.42);R(d,c+1)<=h;c++);h=1+h-R(d,c),p=(a%864e5+864e5)%864e5,b=P(p/36e5)%24,v=P(p/6e4)%60,y=P(p/1e3)%60,w=p%1e3}else d=a.getUTCFullYear(),c=a.getUTCMonth(),h=a.getUTCDate(),b=a.getUTCHours(),v=a.getUTCMinutes(),y=a.getUTCSeconds(),w=a.getUTCMilliseconds();a=(0>=d||d>=1e4?(0>d?"-":"+")+M(6,0>d?-d:d):M(4,d))+"-"+M(2,c+1)+"-"+M(2,h)+"T"+M(2,b)+":"+M(2,v)+":"+M(2,y)+"."+M(3,w)+"Z"}else a=null;if(n&&(a=n.call(e,t,a)),null===a)return"null";if(l=_.call(a),l==S)return""+a;if(l==C)return a>-1/0&&1/0>a?""+a:"null";if(l==T)return I(""+a);if("object"==typeof a){for(O=s.length;O--;)if(s[O]===a)throw u();if(s.push(a),$=[],N=r,r+=o,l==k){for(A=0,O=a.length;O>A;A++)x=D(A,a,n,i,o,r,s),$.push(x===g?"null":x);B=$.length?o?"[\n"+r+$.join(",\n"+r)+"\n"+N+"]":"["+$.join(",")+"]":"[]"}else m(i||a,function(t){var e=D(t,a,n,i,o,r,s);e!==g&&$.push(I(t)+":"+(o?" ":"")+e)}),B=$.length?o?"{\n"+r+$.join(",\n"+r)+"\n"+N+"}":"{"+$.join(",")+"}":"{}";return s.pop(),B}};e.stringify=function(t,e,n){var i,o,r,a;if(s[typeof e]&&e)if((a=_.call(e))==w)o=e;else if(a==k){r={};for(var l,d=0,c=e.length;c>d;l=e[d++],a=_.call(l),(a==T||a==C)&&(r[l]=1));}if(n)if((a=_.call(n))==C){if((n-=n%1)>0)for(i="",n>10&&(n=10);i.length<n;i+=" ");}else a==T&&(i=n.length<=10?n:n.slice(0,10));return D("",(l={},l[""]=t,l),o,r,i,"",[])}}if(!n("json-parse")){var B,L,F=r.fromCharCode,U={92:"\\",34:'"',47:"/",98:"\b",116:"	",110:"\n",102:"\f",114:"\r"},j=function(){throw B=L=null,c()},V=function(){for(var t,e,n,i,o,r=L,s=r.length;s>B;)switch(o=r.charCodeAt(B)){case 9:case 10:case 13:case 32:B++;break;case 123:case 125:case 91:case 93:case 58:case 44:return t=$?r.charAt(B):r[B],B++,t;case 34:for(t="@",B++;s>B;)if(o=r.charCodeAt(B),32>o)j();else if(92==o)switch(o=r.charCodeAt(++B)){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:t+=U[o],B++;break;case 117:for(e=++B,n=B+4;n>B;B++)o=r.charCodeAt(B),o>=48&&57>=o||o>=97&&102>=o||o>=65&&70>=o||j();t+=F("0x"+r.slice(e,B));break;default:j()}else{if(34==o)break;for(o=r.charCodeAt(B),e=B;o>=32&&92!=o&&34!=o;)o=r.charCodeAt(++B);t+=r.slice(e,B)}if(34==r.charCodeAt(B))return B++,t;j();default:if(e=B,45==o&&(i=!0,o=r.charCodeAt(++B)),o>=48&&57>=o){for(48==o&&(o=r.charCodeAt(B+1),o>=48&&57>=o)&&j(),i=!1;s>B&&(o=r.charCodeAt(B),o>=48&&57>=o);B++);if(46==r.charCodeAt(B)){for(n=++B;s>n&&(o=r.charCodeAt(n),o>=48&&57>=o);n++);n==B&&j(),B=n}if(o=r.charCodeAt(B),101==o||69==o){for(o=r.charCodeAt(++B),(43==o||45==o)&&B++,n=B;s>n&&(o=r.charCodeAt(n),o>=48&&57>=o);n++);n==B&&j(),B=n}return+r.slice(e,B)}if(i&&j(),"true"==r.slice(B,B+4))return B+=4,!0;if("false"==r.slice(B,B+5))return B+=5,!1;if("null"==r.slice(B,B+4))return B+=4,null;j()}return"$"},G=function(t){var e,n;if("$"==t&&j(),"string"==typeof t){if("@"==($?t.charAt(0):t[0]))return t.slice(1);if("["==t){for(e=[];t=V(),"]"!=t;n||(n=!0))n&&(","==t?(t=V(),"]"==t&&j()):j()),","==t&&j(),e.push(G(t));return e}if("{"==t){for(e={};t=V(),"}"!=t;n||(n=!0))n&&(","==t?(t=V(),"}"==t&&j()):j()),(","==t||"string"!=typeof t||"@"!=($?t.charAt(0):t[0])||":"!=V())&&j(),e[t.slice(1)]=G(V());return e}j()}return t},K=function(t,e,n){var i=H(t,e,n);i===g?delete t[e]:t[e]=i},H=function(t,e,n){var i,o=t[e];if("object"==typeof o&&o)if(_.call(o)==k)for(i=o.length;i--;)K(o,i,n);else m(o,function(t){K(o,t,n)});return n.call(t,e,o)};e.parse=function(t,e){var n,i;return B=0,L=""+t,n=G(V()),"$"!=V()&&j(),B=L=null,e&&_.call(e)==w?H((i={},i[""]=n,i),"",e):n}}}return e.runInContext=o,e}var r="function"==typeof t&&t.amd,s={"function":!0,object:!0},a=s[typeof i]&&i&&!i.nodeType&&i,l=s[typeof window]&&window||this,d=a&&s[typeof n]&&n&&!n.nodeType&&"object"==typeof e&&e;if(!d||d.global!==d&&d.window!==d&&d.self!==d||(l=d),a&&!r)o(l,a);else{var c=l.JSON,u=l.JSON3,h=!1,p=o(l,l.JSON3={noConflict:function(){return h||(h=!0,l.JSON=c,l.JSON3=u,c=u=null),p}});l.JSON={parse:p.parse,stringify:p.stringify}}r&&t(function(){return p})}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],56:[function(t,e){function n(t,e,l){if(!(this instanceof n))return new n(t,e,l);var d,c,u,h,p=s.test(t),f=typeof e,m=this,g=0;for("object"!==f&&"string"!==f&&(l=e,e=null),l&&"function"!=typeof l&&(l=r.parse),e=o(e);g<a.length;g++)c=a[g],d=c[0],h=c[1],d!==d?m[h]=t:"string"==typeof d?~(u=t.indexOf(d))&&("number"==typeof c[2]?(m[h]=t.slice(0,u),t=t.slice(u+c[2])):(m[h]=t.slice(u),t=t.slice(0,u))):(u=d.exec(t))&&(m[h]=u[1],t=t.slice(0,t.length-u[0].length)),
m[h]=m[h]||(c[3]||"port"===h&&p?e[h]||"":""),c[4]&&(m[h]=m[h].toLowerCase());l&&(m.query=l(m.query)),i(m.port,m.protocol)||(m.host=m.hostname,m.port=""),m.username=m.password="",m.auth&&(c=m.auth.split(":"),m.username=c[0]||"",m.password=c[1]||""),m.href=m.toString()}var i=t("requires-port"),o=t("./lolcation"),r=t("querystringify"),s=/^\/(?!\/)/,a=[["#","hash"],["?","query"],["//","protocol",2,1,1],["/","pathname"],["@","auth",1],[0/0,"host",void 0,1,1],[/\:(\d+)$/,"port"],[0/0,"hostname",void 0,1,1]];n.prototype.set=function(t,e,n){var o=this;return"query"===t?("string"==typeof e&&(e=(n||r.parse)(e)),o[t]=e):"port"===t?(o[t]=e,i(e,o.protocol)?e&&(o.host=o.hostname+":"+e):(o.host=o.hostname,o[t]="")):"hostname"===t?(o[t]=e,o.port&&(e+=":"+o.port),o.host=e):"host"===t?(o[t]=e,/\:\d+/.test(e)&&(e=e.split(":"),o.hostname=e[0],o.port=e[1])):o[t]=e,o.href=o.toString(),o},n.prototype.toString=function(t){t&&"function"==typeof t||(t=r.stringify);var e,n=this,i=n.protocol+"//";return n.username&&(i+=n.username,n.password&&(i+=":"+n.password),i+="@"),i+=n.hostname,n.port&&(i+=":"+n.port),i+=n.pathname,n.query&&(e="object"==typeof n.query?t(n.query):n.query,i+=("?"===e.charAt(0)?"":"?")+e),n.hash&&(i+=n.hash),i},n.qs=r,n.location=o,e.exports=n},{"./lolcation":57,querystringify:58,"requires-port":59}],57:[function(t,e){(function(n){var i,o={hash:1,query:1};e.exports=function(e){e=e||n.location||{},i=i||t("./");var r,s={},a=typeof e;if("blob:"===e.protocol)s=new i(unescape(e.pathname),{});else if("string"===a){s=new i(e,{});for(r in o)delete s[r]}else if("object"===a)for(r in e)r in o||(s[r]=e[r]);return s}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./":56}],58:[function(t,e,n){function i(t){for(var e,n=/([^=?&]+)=([^&]*)/g,i={};e=n.exec(t);i[decodeURIComponent(e[1])]=decodeURIComponent(e[2]));return i}function o(t,e){e=e||"";var n=[];"string"!=typeof e&&(e="?");for(var i in t)r.call(t,i)&&n.push(encodeURIComponent(i)+"="+encodeURIComponent(t[i]));return n.length?e+n.join("&"):""}var r=Object.prototype.hasOwnProperty;n.stringify=o,n.parse=i},{}],59:[function(t,e){e.exports=function(t,e){if(e=e.split(":")[0],t=+t,!t)return!1;switch(e){case"http":case"ws":return 80!==t;case"https":case"wss":return 443!==t;case"ftp":return 22!==t;case"gopher":return 70!==t;case"file":return!1}return 0!==t}},{}]},{},[1])(1)}),function(){var t,e,n,i,o={}.hasOwnProperty,r=[].slice;t={LF:"\n",NULL:"\x00"},n=function(){function e(t,e,n){this.command=t,this.headers=null!=e?e:{},this.body=null!=n?n:""}var n;return e.prototype.toString=function(){var n,i,r,s,a;n=[this.command],r=this.headers["content-length"]===!1?!0:!1,r&&delete this.headers["content-length"],a=this.headers;for(i in a)o.call(a,i)&&(s=a[i],n.push(""+i+":"+s));return this.body&&!r&&n.push("content-length:"+e.sizeOfUTF8(this.body)),n.push(t.LF+this.body),n.join(t.LF)},e.sizeOfUTF8=function(t){return t?encodeURI(t).match(/%..|./g).length:0},n=function(n){var i,o,r,s,a,l,d,c,u,h,p,f,m,g,b,_,v;for(s=n.search(RegExp(""+t.LF+t.LF)),a=n.substring(0,s).split(t.LF),r=a.shift(),l={},f=function(t){return t.replace(/^\s+|\s+$/g,"")},_=a.reverse(),m=0,b=_.length;b>m;m++)h=_[m],c=h.indexOf(":"),l[f(h.substring(0,c))]=f(h.substring(c+1));if(i="",p=s+2,l["content-length"])u=parseInt(l["content-length"]),i=(""+n).substring(p,p+u);else for(o=null,d=g=p,v=n.length;(v>=p?v>g:g>v)&&(o=n.charAt(d),o!==t.NULL);d=v>=p?++g:--g)i+=o;return new e(r,l,i)},e.unmarshall=function(e){var i,o,r,s;return o=e.split(RegExp(""+t.NULL+t.LF+"*")),s={frames:[],partial:""},s.frames=function(){var t,e,r,s;for(r=o.slice(0,-1),s=[],t=0,e=r.length;e>t;t++)i=r[t],s.push(n(i));return s}(),r=o.slice(-1)[0],r===t.LF||-1!==r.search(RegExp(""+t.NULL+t.LF+"*$"))?s.frames.push(n(r)):s.partial=r,s},e.marshall=function(n,i,o){var r;return r=new e(n,i,o),r.toString()+t.NULL},e}(),e=function(){function e(t){this.ws=t,this.ws.binaryType="arraybuffer",this.counter=0,this.connected=!1,this.heartbeat={outgoing:1e4,incoming:1e4},this.maxWebSocketFrameSize=16384,this.subscriptions={},this.partialData=""}var o;return e.prototype.debug=function(t){var e;return"undefined"!=typeof window&&null!==window&&null!=(e=window.console)?e.log(t):void 0},o=function(){return Date.now?Date.now():(new Date).valueOf},e.prototype._transmit=function(t,e,i){var o;for(o=n.marshall(t,e,i),"function"==typeof this.debug&&this.debug(">>> "+o);;){if(!(o.length>this.maxWebSocketFrameSize))return this.ws.send(o);this.ws.send(o.substring(0,this.maxWebSocketFrameSize)),o=o.substring(this.maxWebSocketFrameSize),"function"==typeof this.debug&&this.debug("remaining = "+o.length)}},e.prototype._setupHeartbeat=function(e){var n,r,s,a,l,d;if((l=e.version)===i.VERSIONS.V1_1||l===i.VERSIONS.V1_2)return d=function(){var t,n,i,o;for(i=e["heart-beat"].split(","),o=[],t=0,n=i.length;n>t;t++)a=i[t],o.push(parseInt(a));return o}(),r=d[0],n=d[1],0!==this.heartbeat.outgoing&&0!==n&&(s=Math.max(this.heartbeat.outgoing,n),"function"==typeof this.debug&&this.debug("send PING every "+s+"ms"),this.pinger=i.setInterval(s,function(e){return function(){return e.ws.send(t.LF),"function"==typeof e.debug?e.debug(">>> PING"):void 0}}(this))),0!==this.heartbeat.incoming&&0!==r?(s=Math.max(this.heartbeat.incoming,r),"function"==typeof this.debug&&this.debug("check PONG every "+s+"ms"),this.ponger=i.setInterval(s,function(t){return function(){var e;return e=o()-t.serverActivity,e>2*s?("function"==typeof t.debug&&t.debug("did not receive server activity for the last "+e+"ms"),t.ws.close()):void 0}}(this))):void 0},e.prototype._parseConnect=function(){var t,e,n,i;switch(t=1<=arguments.length?r.call(arguments,0):[],i={},t.length){case 2:i=t[0],e=t[1];break;case 3:t[1]instanceof Function?(i=t[0],e=t[1],n=t[2]):(i.login=t[0],i.passcode=t[1],e=t[2]);break;case 4:i.login=t[0],i.passcode=t[1],e=t[2],n=t[3];break;default:i.login=t[0],i.passcode=t[1],e=t[2],n=t[3],i.host=t[4]}return[i,e,n]},e.prototype.connect=function(){var e,s,a,l;return e=1<=arguments.length?r.call(arguments,0):[],l=this._parseConnect.apply(this,e),a=l[0],this.connectCallback=l[1],s=l[2],"function"==typeof this.debug&&this.debug("Opening Web Socket..."),this.ws.onmessage=function(e){return function(i){var r,a,l,d,c,u,h,p,f,m,g,b,_;if(d="undefined"!=typeof ArrayBuffer&&i.data instanceof ArrayBuffer?(r=new Uint8Array(i.data),"function"==typeof e.debug?e.debug("--- got data length: "+r.length):void 0,function(){var t,e,n;for(n=[],t=0,e=r.length;e>t;t++)a=r[t],n.push(String.fromCharCode(a));return n}().join("")):i.data,e.serverActivity=o(),d===t.LF)return void("function"==typeof e.debug&&e.debug("<<< PONG"));for("function"==typeof e.debug&&e.debug("<<< "+d),f=n.unmarshall(e.partialData+d),e.partialData=f.partial,b=f.frames,_=[],m=0,g=b.length;g>m;m++)switch(c=b[m],c.command){case"CONNECTED":"function"==typeof e.debug&&e.debug("connected to server "+c.headers.server),e.connected=!0,e._setupHeartbeat(c.headers),_.push("function"==typeof e.connectCallback?e.connectCallback(c):void 0);break;case"MESSAGE":p=c.headers.subscription,h=e.subscriptions[p]||e.onreceive,h?(l=e,u=c.headers["message-id"],c.ack=function(t){return null==t&&(t={}),l.ack(u,p,t)},c.nack=function(t){return null==t&&(t={}),l.nack(u,p,t)},_.push(h(c))):_.push("function"==typeof e.debug?e.debug("Unhandled received MESSAGE: "+c):void 0);break;case"RECEIPT":_.push("function"==typeof e.onreceipt?e.onreceipt(c):void 0);break;case"ERROR":_.push("function"==typeof s?s(c):void 0);break;default:_.push("function"==typeof e.debug?e.debug("Unhandled frame: "+c):void 0)}return _}}(this),this.ws.onclose=function(t){return function(){var e;return e="Whoops! Lost connection to "+t.ws.url,"function"==typeof t.debug&&t.debug(e),t._cleanUp(),"function"==typeof s?s(e):void 0}}(this),this.ws.onopen=function(t){return function(){return"function"==typeof t.debug&&t.debug("Web Socket Opened..."),a["accept-version"]=i.VERSIONS.supportedVersions(),a["heart-beat"]=[t.heartbeat.outgoing,t.heartbeat.incoming].join(","),t._transmit("CONNECT",a)}}(this)},e.prototype.disconnect=function(t,e){return null==e&&(e={}),this._transmit("DISCONNECT",e),this.ws.onclose=null,this.ws.close(),this._cleanUp(),"function"==typeof t?t():void 0},e.prototype._cleanUp=function(){return this.connected=!1,this.pinger&&i.clearInterval(this.pinger),this.ponger?i.clearInterval(this.ponger):void 0},e.prototype.send=function(t,e,n){return null==e&&(e={}),null==n&&(n=""),e.destination=t,this._transmit("SEND",e,n)},e.prototype.subscribe=function(t,e,n){var i;return null==n&&(n={}),n.id||(n.id="sub-"+this.counter++),n.destination=t,this.subscriptions[n.id]=e,this._transmit("SUBSCRIBE",n),i=this,{id:n.id,unsubscribe:function(){return i.unsubscribe(n.id)}}},e.prototype.unsubscribe=function(t){return delete this.subscriptions[t],this._transmit("UNSUBSCRIBE",{id:t})},e.prototype.begin=function(t){var e,n;return n=t||"tx-"+this.counter++,this._transmit("BEGIN",{transaction:n}),e=this,{id:n,commit:function(){return e.commit(n)},abort:function(){return e.abort(n)}}},e.prototype.commit=function(t){return this._transmit("COMMIT",{transaction:t})},e.prototype.abort=function(t){return this._transmit("ABORT",{transaction:t})},e.prototype.ack=function(t,e,n){return null==n&&(n={}),n["message-id"]=t,n.subscription=e,this._transmit("ACK",n)},e.prototype.nack=function(t,e,n){return null==n&&(n={}),n["message-id"]=t,n.subscription=e,this._transmit("NACK",n)},e}(),i={VERSIONS:{V1_0:"1.0",V1_1:"1.1",V1_2:"1.2",supportedVersions:function(){return"1.1,1.0"}},client:function(t,n){var o,r;return null==n&&(n=["v10.stomp","v11.stomp"]),o=i.WebSocketClass||WebSocket,r=new o(t,n),new e(r)},over:function(t){return new e(t)},Frame:n},"undefined"!=typeof exports&&null!==exports&&(exports.Stomp=i),"undefined"!=typeof window&&null!==window?(i.setInterval=function(t,e){return window.setInterval(e,t)},i.clearInterval=function(t){return window.clearInterval(t)},window.Stomp=i):exports||(self.Stomp=i)}.call(this),define("stomp",function(t){return function(){var e;return e||t.Stomp}}(this)),define("service/rabbitmqWebStompService",["core/subscriber","sockjs","stomp"],function(t,e,n){var i=function(){t.prototype.constructor.apply(this),this.ws=null,this.client=null,this.bind__messageCallback=this._messageCallback.bind(this)};return i.extend(t),i.Event={CONNECTED:"eventConnected",DISCONNECTED:"eventDisconnected",MESSAGE:"eventMessage"},i.prototype.isConnected=function(){return this.ws&&this.client},i.prototype.connect=function(){if(!this.isConnected()){this.ws=new e(window.location.protocol+"//"+window.location.hostname+"/stomp"),this.client=n.over(this.ws),this.client.heartbeat.incoming=0,this.client.heartbeat.outgoing=0;var t=function(){this._dispatch(i.Event.CONNECTED)}.bind(this),o=function(t){console.error(t)};this.client.connect("test","test",t,o,"/")}},i.prototype.disconnect=function(){this.client.disconnect(function(){this._dispatch(i.Event.DISCONNECTED)}.bind(this)),this.client=null,this.ws=null},i.prototype._messageCallback=function(t){console.log(t),this._dispatch(i.Event.MESSAGE,{message:JSON.parse(t.body)})},i.prototype.subscribe=function(e,n,i){return t.prototype.subscribe.call(this,n,i),e?this.client.subscribe(e,this.bind__messageCallback):void 0},i.prototype.unsubscribe=function(e,n){t.prototype.unsubscribe.call(this,n),e&&this.client.unsubscribe(e.id)},i}),define("service/subscriberService",["core/subscriber"],function(t){var e=function(){t.prototype.constructor.apply(this)};return e.extend(t),e.prototype.dispatch=function(e,n,i){i=i||{},i.tag=e,t.prototype._dispatch.call(this,n,i)},e}),define("service/threadPostService",["core/subscriber","underscore"],function(t){var e=function(){t.prototype.constructor.apply(this),this.name="ThreadPost"};return e.extend(t),e.Event={ADD:"eventAdd",REPLACE:"eventUpdate",REMOVE:"eventRemove"},e.prototype.subscribe=function(n){_.each(e.Event,function(e,i,o){t.prototype.subscribe.call(this,e,n)}.bind(this))},e.prototype.dispatch=function(e,n){t.prototype._dispatch.call(this,e,n)},e}),define("model/forumModel",["model/model","model/mediaModel","extra"],function(t,e){var n=function(n){t.prototype.constructor.apply(this,arguments),this.data.ordered_media&&this.data.ordered_media.forEach(function(t,n,i){i[n]=new e(t)})};return n.extend(t),n}),define("model/groupModel",["model/model","model/mediaModel","extra"],function(t,e){var n=function(n){t.prototype.constructor.apply(this,arguments),this.data.ordered_media&&this.data.ordered_media.forEach(function(t,n,i){i[n]=new e(t)})};return n.extend(t),n}),define("model/messageModel",["model/model","model/mediaModel","extra"],function(t,e){var n=function(n){t.prototype.constructor.apply(this,arguments),this.data.ordered_media&&this.data.ordered_media.forEach(function(t,n,i){i[n]=new e(t)})};return n.extend(t),n}),define("model/myFilesModel",["model/model","model/mediaModel","extra","underscore"],function(t,e){var n=function(n){if(t.prototype.constructor.apply(this,arguments),this.data.media){var i=this.data.media;this.data.media=[],_.each(i,function(n,i,o){var r=new e(n);r.subscribe(t.Event.CHANGE,function(e){var n=_.findIndex(this.data.media,e.model);n>-1&&this._dispatch(t.Event.CHANGE,"media."+n)}.bind(this)),this.data.media.push(r)},this),i=null}};return n.extend(t),n.prototype.addMedia=function(n){var i=new e(n);i.subscribe(t.Event.CHANGE,function(e){var n=_.findIndex(this.data.media,e.model);n>-1&&this._dispatch(t.Event.CHANGE,"media."+n)}.bind(this)),this.data.media.push(i)},n.prototype.getMedia=function(t){return _.find(this.data.media,function(e){return e.get("id")==t})},n}),define("model/profileModel",["model/model","extra"],function(t){var e=function(e){t.prototype.constructor.apply(this,arguments)};return e.extend(t),e}),define("model/threadModel",["model/model","model/postModel","extra","underscore"],function(t,e){var n=function(n){t.prototype.constructor.apply(this,arguments),this.data.keyPoints=[],this.data.posts&&this.data.posts.forEach(function(t,n,i){i[n]=new e(t)})};return n.extend(t),n.prototype.addKeyPoint=function(e){this.removeKeyPoint(e.id),this.data.keyPoints.push(e),this._dispatch(t.Event.CHANGE,"keyPoints."+(this.data.keyPoints.length-1))},n.prototype._findKeyPoint=function(t){for(var e in this.data.keyPoints)if(this.data.keyPoints[e].id==t)return e},n.prototype.setKeyPointProperty=function(t,e,n,i){var o=this._findKeyPoint(t);o>-1&&this.set("keyPoints."+o+"."+e,n,i)},n.prototype.removeKeyPoint=function(e){var n=this._findKeyPoint(e);n>-1&&(this.data.keyPoints.splice(n,1),this._dispatch(t.Event.CHANGE,"keyPoints"))},n.prototype.forceChangeKeyPoint=function(t,e){var n=this._findKeyPoint(t);n>-1&&this.forceChange("keyPoints."+n+"."+e)},n.prototype.addPost=function(t,e){var n=this.get("posts",[]);this.set("posts."+n.length,t,!1),this.forceChange("posts."+(n.length-1),{isNew:!0,view:e})},n.prototype.removePost=function(t,e){var n=this.get("posts"),i=this.find(t.get("id"),"id",n);if(i>-1){n.splice(i,1);var o=[];_.each(n,function(e,n,i){e.get("parent_post_id")==t.get("id")&&o.push(e)}),this.set("posts",_.difference(n,o))}},n.prototype.forceChangePost=function(t,e){var n=this.find(t.get("id"),"id",this.get("posts"));n>-1&&this.forceChange("posts."+n,{view:e})},n}),define("model/userModel",["model/model","extra","underscore"],function(t){var e=function(e){t.prototype.constructor.apply(this,arguments)};return e.extend(t),e.prototype.isUserOnFriendsList=function(t){return _.contains(this.get("friends_list"),t)},e.prototype.isUserOnMentorList=function(t){return _.contains(this.get("mentor_list"),t)},e.prototype.isUserOnMenteeList=function(t){return _.contains(this.get("mentee_list"),t)},e.prototype.isUserOnInvitedMentorList=function(t){var e=_.find(this.get("created_invitations"),function(e){return!(e.recipient!=t||e.isMentor||e.isAccepted||e.isCancelled||e.isDeclined)});return"undefined"!==e},e.prototype.isUserOnInvitedMenteeList=function(t){var e=_.find(this.get("created_invitations"),function(e){return!(e.recipient!=t||e.isMentee||e.isAccepted||e.isCancelled||e.isDeclined)});return"undefined"!==e},e}),define("controller/contactController",["factory/contactFactory"],function(t){var e=function(t,n){console.log("%s: %s- model=%o, options=%o",e.TAG,"constructor",t,n),this.model=t,this.options=n,$tt._instances.push(this)};return e.TAG="Contact",e.prototype.onViewLoaded=function(){},e.prototype["delete"]=function(e,n){return t["delete"](e,n).done(function(t){window.location.reload(!0)})},e}),define("controller/forumController",["factory/forumFactory"],function(t){var e=function(t,n){console.log("%s: %s- model=%o, options=%o",e.TAG,"constructor",t,n),this.model=t,this.options=n,$tt._instances.push(this)};return e.TAG="Forum",e.prototype.onViewLoaded=function(){},e.prototype["delete"]=function(){return t["delete"](this.model).done(function(t){window.location.assign(t.redirect_url)})},e}),define("controller/groupController",["factory/groupFactory"],function(t){var e=function(t,n){console.log("%s: %s- model=%o, options=%o",e.TAG,"constructor",t,n),this.model=t,this.options=n,$tt._instances.push(this)};return e.TAG="Group",e.prototype.onViewLoaded=function(){},e.prototype["delete"]=function(){return t["delete"](this.model).done(function(t){window.location.assign(t.redirect_url)})},e}),define("controller/homeController",[],function(){var t=function(e,n){console.log("%s: %s- model=%o, options=%o",t.TAG,"constructor",e,n),this.model=e,this.options=n,$tt._instances.push(this)};return t.TAG="Home",t.prototype.onViewLoaded=function(){},t}),define("controller/messageController",["factory/messageFactory"],function(t){var e=function(t,n){console.log("%s: %s- model=%o, options=%o",e.TAG,"constructor",t,n),this.model=t,this.options=n,$tt._instances.push(this)};return e.TAG="Message",e.prototype.onViewLoaded=function(){this.model.get("id")&&this.markAsRead()},e.prototype.markAsRead=function(){return t.edit(this.model)},e}),define("controller/myFilesController",["factory/mediaFactory"],function(t){var e=function(t,n){console.log("%s: %s- model=%o, options=%o",e.TAG,"constructor",t,n),this.model=t,this.options=n,$tt._instances.push(this)};return e.TAG="MyFiles",e.prototype.onViewLoaded=function(){},e.prototype.edit=function(e,n){var i=this.model.getMedia(e);if(!i)throw new Error("media not found");return Object.keys(n).forEach(function(t,e,o){i.set(t,n[t])}),t.edit(i)},e.prototype["delete"]=function(e,n){var i=this.model.getMedia(e);if(!i)throw new Error("media not found");return t["delete"](i,n)},e}),define("controller/postController",["factory/postFactory","service","service/keyPointService","service/threadPostService"],function(t,e,n,i){var o=function(t,n){console.log("%s: %s- model=%o, options=%o",o.TAG,"constructor",t,n),this.model=t,this.options=n,this.keyPointService=e.get("keyPoint"),this.threadPostService=e.get("threadPost"),this.model.set("keyPoint",new KeyPoint(this.model.get("id"),this.model.get("start_time"),this.model.get("end_time"),"",{drawOnTimeLine:this.model.get("is_temporal",!1)})),this.bind__onKeyPointEvent=this._onKeyPointEvent.bind(this),this.bind__onThreadPostEvent=this._onThreadPostEvent.bind(this),$tt._instances.push(this)};return o.TAG="Post",o.prototype._onKeyPointEvent=function(t){switch(t.type){case n.Event.DURATION:this.model.set("keyPoint.videoDuration",t.duration);break;case n.Event.SELECTION_TIMES:this.model.set("keyPoint.selection",t.selection);break;case n.Event.HOVER:case n.Event.CLICK:this.model.forceChange()}},o.prototype._onThreadPostEvent=function(t){switch(t.type){case i.Event.REMOVE:t.post.get("id")<0&&t.post.get("parent_post_id")==this.model.get("id")&&this.model.forceChange()}},o.prototype.onViewLoaded=function(){this.addKeyPoint(),this.threadPostService.subscribe(this.bind__onThreadPostEvent)},o.prototype.addKeyPoint=function(){var t=this.model.get("keyPoint");this.keyPointService.register(t),this.keyPointService.subscribe(t.id,this.bind__onKeyPointEvent),this.keyPointService.dispatch(t.id,n.Event.ADD)},o.prototype.hoverKeyPoint=function(t){this.model.set("keyPoint.isHovering",t.isMouseOver),this.keyPointService.dispatch(this.model.get("keyPoint.id"),n.Event.HOVER,t)},o.prototype.clickKeyPoint=function(t){var e="keyPoint."+(t.isDblClick?"isPlaying":"isSeeking");this.model.set(e,!0),setTimeout(function(){this.model.set(e,!1,!1)}.bind(this),100),this.keyPointService.dispatch(this.model.get("keyPoint.id"),n.Event.CLICK,t)},o.prototype.editKeyPoint=function(t){this.keyPointService.dispatch(this.model.get("keyPoint.id"),n.Event.EDIT,t)},o.prototype.removeKeyPoint=function(){var t=this.model.get("keyPoint");this.keyPointService.dispatch(t.id,n.Event.REMOVE),this.keyPointService.unsubscribe(t.id,this.bind__onKeyPointEvent),this.keyPointService.deregister(t.id)},o.prototype.addToThread=function(t){this.threadPostService.dispatch(i.Event.ADD,{post:t})},o.prototype.updateInThread=function(t){this.threadPostService.dispatch(i.Event.REPLACE,{post:this.model,view:t})},o.prototype.removeFromThread=function(){this.threadPostService.dispatch(i.Event.REMOVE,{post:this.model})},o.prototype["new"]=function(){return t["new"](this.model)},o.prototype.post=function(e){return t.post(this.model,e)},o.prototype.get=function(){return t.get(this.model)},o.prototype.edit=function(){return t.edit(this.model)},o.prototype.put=function(e){return t.put(this.model,e)},o.prototype["delete"]=function(){return t["delete"](this.model).done(function(t){this.removeKeyPoint()}.bind(this))},o}),define("controller/profileController",[],function(){var t=function(e,n){console.log("%s: %s- model=%o, options=%o",t.TAG,"constructor",e,n),this.model=e,this.options=n,$tt._instances.push(this)};return t.TAG="Profile",t.prototype.onViewLoaded=function(){},t}),define("controller/threadController",["factory/threadFactory","service","service/keyPointService","service/threadPostService"],function(t,e,n,i){var o=function(t,n){console.log("%s: %s- model=%o, options=%o",o.TAG,"constructor",t,n),this.model=t,this.options=n,this.keyPointService=e.get("keyPoint"),this.threadPostService=e.get("threadPost"),this.videoSpeed=0,this.bind__onKeyPointEvent=this._onKeyPointEvent.bind(this),this.bind__onThreadPostEvent=this._onThreadPostEvent.bind(this),this.keyPointService.subscribe("all",this.bind__onKeyPointEvent),this.threadPostService.subscribe(this.bind__onThreadPostEvent),$tt._instances.push(this)};return o.TAG="Thread",o.prototype._onKeyPointEvent=function(t){switch(t.type){case n.Event.ADD:this.model.addKeyPoint(t.keyPoint);break;case n.Event.HOVER:case n.Event.CLICK:this.model.forceChangeKeyPoint(t.keyPoint.id);break;case n.Event.EDIT:if(!t.cancel){this.model.setKeyPointProperty(t.keyPoint.id,"options.drawOnTimeLine",!1),this.model.setKeyPointProperty(t.keyPoint.id,"isEditing",!0);break}case n.Event.REMOVE:this.model.setKeyPointProperty(t.keyPoint.id,"isEditing",!1),this.model.setKeyPointProperty(t.keyPoint.id,"options.drawOnTimeLine",!0),t.type==n.Event.REMOVE&&this.model.removeKeyPoint(t.keyPoint.id)}},o.prototype._onThreadPostEvent=function(t){switch(t.type){case i.Event.ADD:this.model.addPost(t.post,t.post.get("id")<0?"new":"view");break;case i.Event.REPLACE:this.model.forceChangePost(t.post,t.view);break;case i.Event.REMOVE:this.model.removePost(t.post)}},o.prototype.onViewLoaded=function(){},o.prototype.updateKeyPointDuration=function(t){isNaN(t)||this.keyPointService.dispatch("all",n.Event.DURATION,{duration:t})},o.prototype.updateKeyPointSelectionTimes=function(t){this.keyPointService.dispatch("all",n.Event.SELECTION_TIMES,{selection:{startTime:parseFloat(t.minTime).toFixed(2),endTime:parseFloat(t.maxTime).toFixed(2)}})},o.prototype.hoverKeyPoint=function(t,e){this.model.setKeyPointProperty(t,"isPlayerHovering",e.isMouseOver),this.keyPointService.dispatch(t,n.Event.HOVER,e)},o.prototype.rightClickKeyPoint=function(t){this.model.setKeyPointProperty(t,"isPlayerPlaying",!0),setTimeout(function(){this.model.setKeyPointProperty(t,"isPlayerPlaying",!1,!1)}.bind(this),100),this.keyPointService.dispatch(t,n.Event.CLICK,{which:"right"})},o.prototype.adjustVideoSpeed=function(){switch(this.videoSpeed=(this.videoSpeed+1)%3,this.videoSpeed){case 0:return{value:1,image:this.options.player.speedImages.normal};case 1:return{value:2,image:this.options.player.speedImages.fast};case 2:return{value:.5,image:this.options.player.speedImages.slow};default:return{value:1,image:this.options.player.speedImages.normal}}},o.prototype["delete"]=function(){return t["delete"](this.model).done(function(t){window.location.assign(t.redirect_url)})},o}),define("component/accessTypeComponent",[],function(){var t=function(t){this.options=t,this.typeToFieldMap=[{filter:'[value="4"]',fields:["accessType_data_users"]},{filter:'[value="6"]',fields:["group"]}],this.bind__onChangeAccessType=this._onChangeAccessType.bind(this),this.$container=this.options.$container,this.$accessTypes=this.$container.find("input:radio"),this.$accessTypes.on("change",this.bind__onChangeAccessType),this.$accessTypes.filter(":checked").trigger("change")};return t.TAG="AccessTypeComponent",t.prototype._getFormField=function(t){return this.$container.find('[id$="_'+t+'"]')},t.prototype._onChangeAccessType=function(t){var e=$(t.target),n=function(t,n){var i=n.parent();e.attr("id")==t.attr("id")?(i.find("label").addClass("required"),n.attr("required",!0),i.children().show()):(i.find("label").removeClass("required"),n.attr("required",!1),i.children().hide())};$.each(this.typeToFieldMap,function(t,e){var i=this.$accessTypes.filter(e.filter);$.each(e.fields,function(t,e){n(i,this._getFormField(e))}.bind(this))}.bind(this))},t.render=function(e,n){var i={};n=n||i;for(var o in i)n[o]="undefined"!=typeof n[o]?n[o]:i[o];return n.$container=e,new t(n)},t}),define("component/tableComponent",["core/subscriber","extra"],function(t){var e=function(n){t.prototype.constructor.apply(this),this.options=n,this.bind__onClickToggleSelection=this._onClickToggleSelection.bind(this),this.bind__onClickBulkAction=this._onClickBulkAction.bind(this),this.bind__onChangeItems=this._onChangeItems.bind(this),this.$table=this.options.$table,this.$toggleSelection=this.$table.find(e.Binder.TOGGLE_SELECTION),this.$bulkActions=this.$table.find(e.Binder.BULK_ACTION),this.$items=this.$table.find(e.Binder.ITEM),this.setMultiSelect(this.options.multiSelect),this.$toggleSelection.on("click",this.bind__onClickToggleSelection),this.$bulkActions.on("click",this.bind__onClickBulkAction),this.$items.on("change",this.bind__onChangeItems)};return e.extend(t),e.TAG="TableComponent",e.Binder={TOGGLE_SELECTION:".table-component-toggle-selection",BULK_ACTION:".table-component-bulk-action",ITEM:"input.table-component-item:not([disabled])"},e.Event={SELECTION_CHANGE:"eventSelectionChange",CLICK_BULK_ACTION:"eventClickBulkAction"},e.prototype.updateElements=function(t){this.$items.off("change"),this.$table=t,this.$items=this.$table.find(e.Binder.ITEM),this.$items.on("change",this.bind__onChangeItems)},e.prototype._dispatchToggleEvent=function(t){var n=this.getSelection();this._dispatch(e.Event.SELECTION_CHANGE,{$selection:n,tableComponent:this,parentEvent:t})},e.prototype._onClickToggleSelection=function(t){this.$items.prop("checked",$(t.target).is('input[type="checkbox"]')?t.target.checked:0==this.getSelection().length),this._dispatchToggleEvent(t)},e.prototype._onClickBulkAction=function(t){var n=$(t.currentTarget);this._dispatch(e.Event.CLICK_BULK_ACTION,{$bulkAction:n,action:n.data("action"),$selection:this.getSelection(),tableComponent:this,parentEvent:t})},e.prototype._onChangeItems=function(t){var n=t.target.checked;this.options.multiSelect||this.$items.prop("checked",!1),t.target.checked=n;var i=this.getSelection();this._dispatch(e.Event.SELECTION_CHANGE,{$selection:i,tableComponent:this,parentEvent:t});var o=i.length==this.$items.length;this.$toggleSelection.prop("checked",o),o&&this._dispatchToggleEvent(t)},e.prototype.setMultiSelect=function(t){this.options.multiSelect=t,this.$toggleSelection.attr("disabled",!this.options.multiSelect)},e.prototype.getTable=function(){return this.$table},e.prototype.getBulkActions=function(){return this.$bulkActions},e.prototype.getSelection=function(){return this.$items.filter(":checked")},e.table=function(t,n){var i={multiSelect:!0};n=n||i;for(var o in i)n[o]="undefined"!=typeof n[o]?n[o]:i[o];return n.$table=t,new e(n)},e}),define("component/myFilesSelectorComponent",["core/subscriber","service","component/tableComponent","factory/mediaFactory","extra"],function(t,e,n,i){var o=function(n){t.prototype.constructor.apply(this),this.options=n,this.bind__onShownModal=this._onShownModal.bind(this),this.bind__onHiddenModal=this._onHiddenModal.bind(this),this.bind__onLoadPageSuccess=this._onLoadPageSuccess.bind(this),this.bind__onLoadPageError=this._onLoadPageError.bind(this),this.bind__onClickSelectSelected=this._onClickSelectSelected.bind(this),this.bind__onMyFilesListViewViewLoaded=this._onMyFilesListViewViewLoaded.bind(this),this.bind__onSelectionChange=this._onSelectionChange.bind(this),this.$container=this.options.$container,this.$modalDialog=this.$container.find(o.Binder.MODAL_DIALOG),this.$selectSelected=this.$container.find(o.Binder.SELECT_SELECTED),this.$modalDialog.modal({backdrop:"static",show:!1}),this.$modalDialog.on("shown.bs.modal",this.bind__onShownModal),this.$modalDialog.on("hidden.bs.modal",this.bind__onHiddenModal),this.$selectSelected.on("click",this.bind__onClickSelectSelected);var i=e.get("subscriber");i.subscribe("onViewLoaded",this.bind__onMyFilesListViewViewLoaded)};return o.extend(t),o.TAG="MyFilesSelectorComponent",o.Binder={MODAL_DIALOG:".my-files-selector-modal",SELECT_SELECTED:".my-files-selector-select-selected"},o.Event={DONE:"eventDone",HIDDEN:"eventHidden"},o.prototype._onSelectionChange=function(t){this.$selectSelected.attr("disabled",0==t.$selection.length)},o.prototype._onMyFilesListViewViewLoaded=function(t){var e=require("views/myFiles/listView");if(t.tag===e.TAG){this.tblCmp=t.view.getTableComponent(),this.tblCmp.setMultiSelect(this.options.multiSelect),this.tblCmp.subscribe(n.Event.SELECTION_CHANGE,this.bind__onSelectionChange);var i=function(t){t.preventDefault(),this._loadPage($(t.currentTarget).attr("href"))}.bind(this);this.$modalDialog.find(e.Binder.TOGGLE_STYLE).on("click",i),this.$modalDialog.find("ul.pagination li a").on("click",i)}},o.prototype._onLoadPageSuccess=function(t,e,n){this.$modalDialog.find(".modal-body").html(t.page)},o.prototype._onLoadPageError=function(t,e,n){console.log(t)},o.prototype._makeUrl=function(t){if("undefined"==typeof t)return Routing.generate("imdc_myfiles_list",this.options.filter);for(var e in this.filter)t+=(t.substr("?")?"&":"?")+e+"="+this.options.filter[e];return t},o.prototype._loadPage=function(t){$.ajax({url:this._makeUrl(t),success:this.bind__onLoadPageSuccess,error:this.bind__onLoadPageError})},o.prototype._onShownModal=function(t){this._loadPage()},o.prototype._onHiddenModal=function(t){this._dispatch(o.Event.HIDDEN,{myFilesSelectorComponent:this})},o.prototype._onClickSelectSelected=function(t){t.preventDefault(),this.$selectSelected.button("loading");var e=this.tblCmp.getSelection(),n=[];this.options.multiSelect?e.each(function(t,e){n.push($(e).data("mid"))}):n.push(e.first().data("mid")),i.list(n).done(function(t){this._dispatch(o.Event.DONE,{media:t.media,myFilesSelectorComponent:this})}.bind(this)).fail(function(t){this.$selectSelected.button("reset"),console.error("%s: media factory list",o.TAG)}.bind(this))},o.prototype.show=function(){this.$modalDialog.modal("show")},o.prototype.hide=function(){this.$modalDialog.modal("hide")},o.prototype.destroy=function(){this.$modalDialog.remove()},o.render=function(t,e){var n={$container:$("body"),multiSelect:!0,filter:{}};t=t||n;for(var i in n)t[i]="undefined"!=typeof t[i]?t[i]:n[i];dust.render("myFilesSelector",{},function(n,i){t.$container.append(i);var r=new o(t);e.call(r,{myFilesSelectorComponent:r})})},o}),define("component/recorderComponent",["core/subscriber","service","component/myFilesSelectorComponent","model/mediaModel","factory/mediaFactory","factory/myFilesFactory","service/rabbitmqWebStompService","core/helper","extra"],function(t,e,n,i,o,r,s,a){
var l=function(n){t.prototype.constructor.apply(this),this.options=n,this.isOnNormalTab=this.options.tab==l.Tab.NORMAL,this.isOnInterpTab=this.options.tab==l.Tab.INTERPRETATION,this.isInRecordMode=this.options.mode==l.Mode.RECORD,this.isInEditMode=this.options.mode==l.Mode.PREVIEW,this.player=null,this.recorder=null,this.currentRecording=null,this.currentTrim=null,this.sourceMedia=null,this.recordedMedia=null,this.messages=[],this.rabbitmqWebStompService=e.get("rabbitmqWebStomp"),this.isDonePostponed=!1,this.doPost=!1,this.forwardButton='<button class="forwardButton"></button>',this.doneButton='<button class="doneButton"></button>',this.doneAndPostButton='<button class="doneAndPostButton"></button>',this.backButton='<button class="backButton"></button>',this.bind__onShownModal=this._onShownModal.bind(this),this.bind__onShowModal=this._onShowModal.bind(this),this.bind__onHiddenModal=this._onHiddenModal.bind(this),this.bind__onShowTab=this._onShowTab.bind(this),this.bind__onShownTab=this._onShownTab.bind(this),this.bind__onBlurPlayerTitle=this._onBlurPlayerTitle.bind(this),this.bind__onClickInterpSelect=this._onClickInterpSelect.bind(this),this.bind__onPageAnimate=this._onPageAnimate.bind(this),this.bind__onRecordingStarted=this._onRecordingStarted.bind(this),this.bind__onRecordingStopped=this._onRecordingStopped.bind(this),this.bind__onClickTrim=this._onClickTrim.bind(this),this.bind__onClickBack=this._onClickBack.bind(this),this.bind__onClickDone=this._onClickDone.bind(this),this.bind__onClickDoneAndPost=this._onClickDoneAndPost.bind(this),this.$container=this.options.$container,this.$modalDialog=this.$container.find(l.Binder.MODAL_DIALOG),this.$tabPanes=this.$container.find(l.Binder.TAB_PANES),this.$containerRecord=this.$container.find(l.Binder.CONTAINER_RECORD),this.$normalTitle=this.$container.find(l.Binder.NORMAL_TITLE),this.$normalVideo=this.$container.find(l.Binder.NORMAL_VIDEO),this.$interpSelect=this.$container.find(l.Binder.INTERP_SELECT),this.$interpMain=this.$container.find(l.Binder.INTERP_MAIN),this.$interpVideoP=this.$container.find(l.Binder.INTERP_VIDEO_P),this.$interpTitle=this.$container.find(l.Binder.INTERP_TITLE),this.$interpVideoR=this.$container.find(l.Binder.INTERP_VIDEO_R),this.$controls=this.$container.find(l.Binder.CONTROLS),this.$containerUpload=this.$container.find(l.Binder.CONTAINER_UPLOAD);var i=this.isOnNormalTab?l.Binder.NORMAL:l.Binder.INTERP;this.$modalDialog.find('a[href!="'+i+'"]').parent().removeClass("active"),this.$modalDialog.find('a[href="'+i+'"]').parent().addClass("active"),this.$modalDialog.find('.tab-pane:not("'+i+'")').removeClass("active"),this.$modalDialog.find(".tab-pane"+i).addClass("active"),this.$modalDialog.modal({backdrop:"static",show:!1}),this.$modalDialog.on("shown.bs.modal",this.bind__onShownModal),this.$modalDialog.on("show.bs.modal",this.bind__onShowModal),this.$modalDialog.on("hidden.bs.modal",this.bind__onHiddenModal),this.$tabPanes.on("show.bs.tab",this.bind__onShowTab),this.$tabPanes.on("shown.bs.tab",this.bind__onShownTab),this.$interpSelect.on("click",this.bind__onClickInterpSelect),this.isInEditMode&&(this.$normalTitle.blur(this.bind__onBlurPlayerTitle),this.$interpTitle.blur(this.bind__onBlurPlayerTitle)),this._clearCurrents(),this._setupRabbitmq(),this.isInEditMode&&this.$modalDialog.find('a[href="'+l.Binder.INTERP+'"]').hide()};return l.extend(t),l.TAG="RecorderComponent",l.MAX_RECORDING_TIME=720,l.Binder={MODAL_DIALOG:".recorder-modal",TAB_PANES:'a[data-toggle="tab"]',NORMAL:".recorder-normal",INTERP:".recorder-interp",CONTAINER_RECORD:".recorder-container-record",NORMAL_TITLE:".recorder-normal-title",NORMAL_VIDEO:".recorder-normal-video",INTERP_SELECT:".recorder-interp-select",INTERP_MAIN:".recorder-interp-main",INTERP_VIDEO_P:".recorder-interp-video-p",INTERP_TITLE:".recorder-interp-title",INTERP_VIDEO_R:".recorder-interp-video-r",CONTROLS:".recorder-controls",CONTAINER_UPLOAD:".recorder-container-upload"},l.Tab={NORMAL:0,INTERPRETATION:1},l.Mode={RECORD:0,PREVIEW:1},l.Event={DONE:"eventDone",HIDDEN:"eventHidden"},l.prototype._setupRabbitmq=function(){this.bind__onMessage=function(t){console.log(t.message),this.messages.push(t.message),this._checkMessages()}.bind(this),this.bind__onConnect=function(t){this.subscription=this.rabbitmqWebStompService.subscribe("/exchange/"+window.parameters.prefix+"entity-status",s.Event.MESSAGE,this.bind__onMessage)}.bind(this),this.rabbitmqWebStompService.isConnected()?this.bind__onConnect(null):(this.rabbitmqWebStompService.subscribe(null,s.Event.CONNECTED,this.bind__onConnect),this.rabbitmqWebStompService.connect())},l.prototype._cleanupRabbitmq=function(){this.rabbitmqWebStompService.unsubscribe(this.subscription,this.bind__onMessage),this.rabbitmqWebStompService.unsubscribe(null,this.bind__onConnect)},l.prototype._createPlayer=function(t,e){console.log("%s: %s",l.TAG,"_createPlayer"),t="undefined"!=typeof t?t:!1,e="undefined"!=typeof e?e:!1;var n=[],i=[];(this.isOnNormalTab||t)&&(n.push(this.doneButton),i.push(t?this.bind__onClickTrim:this.bind__onClickDone)),this.options.enableDoneAndPost&&t&&(n.push(this.doneAndPostButton),i.push(this.bind__onClickDoneAndPost));var o,r;t&&e&&(o=[this.backButton],r=[this.bind__onClickBack]);var s=this.isOnNormalTab?this.$normalVideo:t?this.$interpVideoR:this.$interpVideoP,a=new Player(s,{areaSelectionEnabled:t,audioBar:!1,updateTimeType:Player.DENSITY_BAR_UPDATE_TYPE_RELATIVE,controlBarElement:this.$controls,forwardButtons:n,forwardFunctions:i,backButtons:o,backFunctions:r,selectedRegionColor:"#0000ff"});a.createControls(),$(a.elementID).find(".videoControlsContainer.controlsBar.doneButton").eq(0).attr("title",Translator.trans("player.previewing.doneButton")),$(a.elementID).find(".videoControlsContainer.controlsBar.doneAndPostButton").eq(0).attr("title",Translator.trans("player.previewing.doneAndPostButton")),$(a.elementID).find(".videoControlsContainer.controlsBar.backButton").eq(0).attr("title",Translator.trans("player.previewing.backToRecordingButton")),t?this.recorder=a:this.player=a},l.prototype._onClickTrim=function(t){console.log("%s: %s",l.TAG,"_onClickTrim"),t.preventDefault();var e=this.recorder.getCurrentMinMaxTime(),n=this.recorder.getAreaSelectionTimes();this.recorder.setCurrentMinMaxTime(n.minTime,n.maxTime),console.log("Current Min/Max Times %s %s",n.minTime,n.maxTime),console.log("Cutting to Min/Max Times %s %s",n.minTime-e.minTime,n.maxTime-e.minTime),this.currentTrim={startTime:n.minTime-e.minTime,endTime:n.maxTime-e.minTime},this._onClickDone(t)},l.prototype._onClickBack=function(t){console.log("%s: %s",l.TAG,"_onClickBack"),t.preventDefault(),this._destroyPlayers(),this._clearCurrents(),this.setRecordedMedia(null),this.options.mode=l.Mode.RECORD,this.isOnInterpTab&&this._createPlayer(),this._createRecorder()},l.prototype._createRecorder=function(){console.log("%s: %s",l.TAG,"_createRecorder");var t=this.isOnNormalTab?this.$normalVideo:this.$interpVideoR;this.recorder=new Player(t,{areaSelectionEnabled:!1,audioBar:!1,updateTimeType:Player.DENSITY_BAR_UPDATE_TYPE_ABSOLUTE,controlBarElement:this.$controls,type:Player.DENSITY_BAR_TYPE_RECORDER,volumeControl:!1,maxRecordingTime:l.MAX_RECORDING_TIME}),$(this.recorder).on(Player.EVENT_RECORDING_STARTED,this.bind__onRecordingStarted),$(this.recorder).on(Player.EVENT_RECORDING_STOPPED,this.bind__onRecordingStopped),this.recorder.createControls(),$(this.recorder.elementID).find(".videoControlsContainer.controlsBar.videoControls.recordButton").eq(0).attr("title",Translator.trans("player.recording.recordingButton")),$(this.recorder.elementID).find(".videoControlsContainer.controlsBar.forwardButton").eq(0).attr("title",Translator.trans("player.recording.forwardButton")),$(this.recorder.elementID).find(".videoControlsContainer.controlsBar.doneButton").eq(0).attr("title",Translator.trans("player.recording.doneButton")),$(this.recorder.elementID).find(".videoControlsContainer.controlsBar.doneAndPostButton").eq(0).attr("title",Translator.trans("player.recording.doneAndPostButton"))},l.prototype._onRecordingStarted=function(){console.log("%s: %s",l.TAG,"_onRecordingStarted"),this._clearCurrents(),this.isOnInterpTab&&(this.currentRecording.sourceStartTime=this.player.getCurrentTime(),this.player.setControlsEnabled(!1),this.player.play())},l.prototype._onRecordingStopped=function(){this.currentRecording.video=this.recorder.recordVideo.getBlob(),this.currentRecording.audio=this.recorder.recordAudio.getBlob(),this.isOnInterpTab&&(this.player.pause(),this.player.setControlsEnabled(!0)),this._destroyPlayers(),this._injectCurrentRecording(this.isOnNormalTab?this.$normalVideo:this.$interpVideoR),this.isOnInterpTab&&this._createPlayer(),this.options.mode=l.Mode.PREVIEW,this._createPlayer(!0,!0)},l.prototype._checkMessages=function(){if(this.tempMedia)for(;this.messages.length>0;){var t=this.messages.pop();t.who.indexOf("MultiplexConsumer")>-1&&(t.what.indexOf("Media")>-1||t.what.indexOf("Interpretation"))&&t.identifier==this.tempMedia.get("id")&&("Done"!=t.status?this.$containerUpload.find("label").eq(0).html(t.status+"..."):(console.log("done"),this.$containerUpload.find("label").eq(0).html("Cleaning up..."),o.get(this.tempMedia.get("id")).done(function(t){this.tempMedia=null,this.setRecordedMedia(t.media),this.isDonePostponed&&setTimeout(function(){this._dispatchDone()}.bind(this),2e3)}.bind(this)).fail(function(t){})))}},l.prototype._addRecording=function(){if(null==this.currentRecording.video&&null==this.currentRecording.audio)return null;var t={video:this.currentRecording.video,audio:this.currentRecording.audio,title:this._getCurrentTitleElement().val()};return this.isOnInterpTab&&(t.isInterpretation=!0,t.sourceStartTime=this.currentRecording.sourceStartTime,t.sourceId=this.sourceMedia.get("id")),this.$containerUpload.find("label").eq(0).html("Uploading recording..."),r.addRecording(t).progress(function(t){a.updateProgressBar(this.$containerUpload,t)}.bind(this)).done(function(t){console.log(t.media),2==t.media.get("state")?this.setRecordedMedia(t.media):(console.log("waiting for multiplex consumer"),this.$containerUpload.find(".progress-bar").eq(0).addClass("progress-bar-striped active").html(""),this.$containerUpload.find("label").eq(0).html("Processing..."),this.tempMedia=t.media,this._checkMessages())}.bind(this)).fail(function(){})},l.prototype._trim=function(t){return null==this.currentTrim.startTime||null==this.currentTrim.endTime?null:(this.$containerUpload.find("label").eq(0).html("Queuing trim..."),o.trim(t,this.currentTrim.startTime,this.currentTrim.endTime).fail(function(){}))},l.prototype._dispatchDone=function(){this._dispatch(l.Event.DONE,{media:this.recordedMedia,doPost:this.doPost,recorderComponent:this})},l.prototype._onClickDone=function(t){console.log("%s: %s",l.TAG,"_onClickDone"),t.preventDefault(),this.$containerRecord.hide(),this.$containerUpload.show(),this._destroyPlayers();var e=function(){this.$containerUpload.find("label").eq(0).html("Cleaning up..."),this.recordedMedia?setTimeout(function(){this._dispatchDone()}.bind(this),2e3):this.isDonePostponed=!0}.bind(this),n=function(t){var n=this._trim(t);return n?void n.done(function(t){e()}):void e()}.bind(this),i=this._addRecording();return i?void i.done(function(t){n(t.media)}):void(this.isInEditMode&&this.recordedMedia&&(a.updateProgressBar(this.$containerUpload,100),this.$containerUpload.find(".progress-bar").eq(0).addClass("progress-bar-striped active").html(""),n(this.recordedMedia)))},l.prototype._onClickDoneAndPost=function(t){this.doPost=!0,this._onClickDone(t)},l.prototype._clearCurrents=function(){this.currentRecording={video:null,audio:null,sourceStartTime:null},this.currentTrim={startTime:null,endTime:null}},l.prototype._destroyPlayers=function(){console.log("%s: %s",l.TAG,"_destroyPlayers");var t=function(t){var e=t.parent();t.removeAttr("src"),e.hide(),e.after(t.detach()),e.remove()}.bind(this);null!=this.player&&(this.player.destroyRecorder(),this.isOnNormalTab?t(this.$normalVideo):null!=this.sourceMedia&&t(this.$interpVideoP),this.player=null),null!=this.recorder&&(this.recorder.destroyRecorder(),this.isOnNormalTab?t(this.$normalVideo):null!=this.sourceMedia&&t(this.$interpVideoR),this.recorder=null),this.$controls.html("")},l.prototype._onPageAnimate=function(){try{if(this.isInEditMode&&null!=this.recordedMedia){if(this.isOnInterpTab&&null!=this.sourceMedia)return;this._createPlayer(!0)}else{if(this.isOnInterpTab){if(null==this.sourceMedia)return;this._createPlayer()}this._createRecorder()}}catch(t){console.error("%s: %s- err=%o",l.TAG,"_loadPage",t)}},l.prototype._loadPage=function(){this.isOnInterpTab&&(null!=this.sourceMedia?(this.$interpSelect.parent().hide(),this.$interpMain.show()):(this.$interpSelect.parent().show(),this.$interpMain.hide())),this.$modalDialog.find(".modal-dialog").animate({width:4*(.9*$(window).height()-256)/3},{complete:this.bind__onPageAnimate})},l.prototype._onShownModal=function(t){this._destroyPlayers(),this._loadPage()},l.prototype._onShowModal=function(t){this.$modalDialog.find(".modal-dialog").width(4*(.9*$(window).height()-256)/3)},l.prototype._onHiddenModal=function(t){this._destroyPlayers(),this.paused||this._dispatch(l.Event.HIDDEN,{recorderComponent:this})},l.prototype._onShowTab=function(t){this._destroyPlayers(),this.options.tab=$(t.target).attr("href")==l.Binder.NORMAL?l.Tab.NORMAL:l.Tab.INTERPRETATION,this.isOnNormalTab=this.options.tab==l.Tab.NORMAL,this.isOnInterpTab=this.options.tab==l.Tab.INTERPRETATION,this._loadPage()},l.prototype._onShownTab=function(t){this.$interpVideoP[0].load()},l.prototype._onBlurPlayerTitle=function(t){console.log("updated title"),this.recordedMedia.set("title",$(t.target).val()),o.edit(this.recordedMedia)},l.prototype._onClickInterpSelect=function(t){t.preventDefault(),n.render({multiSelect:!1,filter:{type:1}},function(t){this.mfsCmp=t.myFilesSelectorComponent,this.mfsCmp.subscribe(n.Event.DONE,function(t){this.mfsCmp.hide(),this.setSourceMedia(t.media[0])}.bind(this)),this.mfsCmp.subscribe(n.Event.HIDDEN,function(t){this.mfsCmp.destroy(),this.show(),this.paused=!1}.bind(this)),this.paused=!0,this.hide(),this.mfsCmp.show()}.bind(this))},l.prototype.show=function(){this.$modalDialog.modal("show")},l.prototype.hide=function(){this.$modalDialog.modal("hide")},l.prototype.destroy=function(){this._clearCurrents(),this._cleanupRabbitmq(),this.$modalDialog.remove()},l.prototype._injectCurrentRecording=function(t){var e={resources:[{web_path:URL.createObjectURL(this.currentRecording.video)},{web_path:URL.createObjectURL(this.currentRecording.audio)}]};dust.render("recorder_source",e,function(e,n){t.html(n)})},l.prototype._injectMedia=function(t,e){var n={resources:this.isInRecordMode?[e.get("source_resource")]:e.get("resources")};dust.render("recorder_source",n,function(e,n){t.html(n)})},l.prototype._getCurrentTitleElement=function(){return this.isOnNormalTab?this.$normalTitle:this.$interpTitle},l.prototype.setSourceMedia=function(t){this.sourceMedia=t,null!=this.sourceMedia&&(this._injectMedia(this.$interpVideoP,this.sourceMedia),this._getCurrentTitleElement().val(this.sourceMedia.get("title"))),this._destroyPlayers(),this._loadPage()},l.prototype.setRecordedMedia=function(t){this.recordedMedia=t,null!=this.recordedMedia&&(this._injectMedia(this.isOnNormalTab?this.$normalVideo:this.$interpVideoR,this.recordedMedia),this._getCurrentTitleElement().val(this.recordedMedia.get("title")))},l.render=function(t,e){var n={$container:$("body"),tab:l.Tab.NORMAL,mode:l.Mode.RECORD,enableDoneAndPost:!1};t=t||n;for(var i in n)t[i]="undefined"!=typeof t[i]?t[i]:n[i];dust.render("recorder",{},function(n,i){t.$container.append(i);var o=new l(t);e.call(o,{recorderComponent:o})})},l}),!function(t){"function"==typeof define&&define.amd?define("Sortable",t):"undefined"!=typeof module&&"undefined"!=typeof module.exports?module.exports=t():"undefined"!=typeof Package?Sortable=t():window.Sortable=t()}(function(){function t(t,e){this.el=t,this.options=e=e||{};var i={group:Math.random(),sort:!0,disabled:!1,store:null,handle:null,scroll:!0,scrollSensitivity:30,scrollSpeed:10,draggable:/[uo]l/i.test(t.nodeName)?"li":">*",ghostClass:"sortable-ghost",ignore:"a, img",filter:null,animation:0,setData:function(t,e){t.setData("Text",e.textContent)},dropBubble:!1,dragoverBubble:!1};for(var o in i)!(o in e)&&(e[o]=i[o]);var s=e.group;s&&"object"==typeof s||(s=e.group={name:s}),["pull","put"].forEach(function(t){t in s||(s[t]=!0)}),L.forEach(function(i){e[i]=n(this,e[i]||F),r(t,i.substr(2).toLowerCase(),e[i])},this),e.groups=" "+s.name+(s.put.join?" "+s.put.join(" "):"")+" ",t[A]=e;for(var a in this)"_"===a.charAt(0)&&(this[a]=n(this,this[a]));r(t,"mousedown",this._onTapStart),r(t,"touchstart",this._onTapStart),r(t,"dragover",this),r(t,"dragenter",this),V.push(this._onDragOver),e.store&&this.sort(e.store.get(this))}function e(t){_&&_.state!==t&&(l(_,"display",t?"none":""),!t&&_.state&&v.insertBefore(_,g),_.state=t)}function n(t,e){var n=j.call(arguments,2);return e.bind?e.bind.apply(e,[t].concat(n)):function(){return e.apply(t,n.concat(j.call(arguments)))}}function i(t,e,n){if(t){n=n||M,e=e.split(".");var i=e.shift().toUpperCase(),o=new RegExp("\\s("+e.join("|")+")\\s","g");do if(">*"===i&&t.parentNode===n||(""===i||t.nodeName.toUpperCase()==i)&&(!e.length||((" "+t.className+" ").match(o)||[]).length==e.length))return t;while(t!==n&&(t=t.parentNode))}return null}function o(t){t.dataTransfer.dropEffect="move",t.preventDefault()}function r(t,e,n){t.addEventListener(e,n,!1)}function s(t,e,n){t.removeEventListener(e,n,!1)}function a(t,e,n){if(t)if(t.classList)t.classList[n?"add":"remove"](e);else{var i=(" "+t.className+" ").replace(/\s+/g," ").replace(" "+e+" ","");t.className=i+(n?" "+e:"")}}function l(t,e,n){var i=t&&t.style;if(i){if(void 0===n)return M.defaultView&&M.defaultView.getComputedStyle?n=M.defaultView.getComputedStyle(t,""):t.currentStyle&&(n=t.currentStyle),void 0===e?n:n[e];e in i||(e="-webkit-"+e),i[e]=n+("string"==typeof n?"":"px")}}function d(t,e,n){if(t){var i=t.getElementsByTagName(e),o=0,r=i.length;if(n)for(;r>o;o++)n(i[o],o);return i}return[]}function c(t){t.draggable=!1}function u(){D=!1}function h(t,e){var n=t.lastElementChild,i=n.getBoundingClientRect();return e.clientY-(i.top+i.height)>5&&n}function p(t){for(var e=t.tagName+t.className+t.src+t.href+t.textContent,n=e.length,i=0;n--;)i+=e.charCodeAt(n);return i.toString(36)}function f(t){for(var e=0;t&&(t=t.previousElementSibling);)"TEMPLATE"!==t.nodeName.toUpperCase()&&e++;return e}function m(t,e){var n,i;return function(){void 0===n&&(n=arguments,i=this,setTimeout(function(){1===n.length?t.call(i,n[0]):t.apply(i,n),n=void 0},e))}}var g,b,_,v,y,w,E,C,T,k,S,$,P,x,R={},A="Sortable"+(new Date).getTime(),O=window,M=O.document,N=O.parseInt,I=!!("draggable"in M.createElement("div")),D=!1,B=function(t,e,n,i,o,r){var s=M.createEvent("Event");s.initEvent(e,!0,!0),s.item=n||t,s.from=i||t,s.clone=_,s.oldIndex=o,s.newIndex=r,t.dispatchEvent(s)},L="onAdd onUpdate onRemove onStart onEnd onFilter onSort".split(" "),F=function(){},U=Math.abs,j=[].slice,V=[],G=m(function(t,e,n){if(n&&e.scroll){var i,o,r,s,a=e.scrollSensitivity,l=e.scrollSpeed,d=t.clientX,c=t.clientY,u=window.innerWidth,h=window.innerHeight;if(E!==n&&(w=e.scroll,E=n,w===!0)){w=n;do if(w.offsetWidth<w.scrollWidth||w.offsetHeight<w.scrollHeight)break;while(w=w.parentNode)}w&&(i=w,o=w.getBoundingClientRect(),r=(U(o.right-d)<=a)-(U(o.left-d)<=a),s=(U(o.bottom-c)<=a)-(U(o.top-c)<=a)),r||s||(r=(a>=u-d)-(a>=d),s=(a>=h-c)-(a>=c),(r||s)&&(i=O)),(R.vx!==r||R.vy!==s||R.el!==i)&&(R.el=i,R.vx=r,R.vy=s,clearInterval(R.pid),i&&(R.pid=setInterval(function(){i===O?O.scrollTo(O.scrollX+r*l,O.scrollY+s*l):(s&&(i.scrollTop+=s*l),r&&(i.scrollLeft+=r*l))},24)))}},30);return t.prototype={constructor:t,_dragStarted:function(){v&&g&&(a(g,this.options.ghostClass,!0),t.active=this,B(v,"start",g,v,k))},_onTapStart:function(t){var e=t.type,n=t.touches&&t.touches[0],o=(n||t).target,s=o,a=this.options,l=this.el,u=a.filter;if(!("mousedown"===e&&0!==t.button||a.disabled)&&(o=i(o,a.draggable,l))){if(k=f(o),"function"==typeof u){if(u.call(this,t,o,this))return B(s,"filter",o,l,k),void t.preventDefault()}else if(u&&(u=u.split(",").some(function(t){return t=i(s,t.trim(),l),t?(B(t,"filter",o,l,k),!0):void 0})))return void t.preventDefault();if((!a.handle||i(s,a.handle,l))&&o&&!g&&o.parentNode===l){P=t,v=this.el,g=o,y=g.nextSibling,$=this.options.group,g.draggable=!0,a.ignore.split(",").forEach(function(t){d(o,t.trim(),c)}),n&&(P={target:o,clientX:n.clientX,clientY:n.clientY},this._onDragStart(P,"touch"),t.preventDefault()),r(M,"mouseup",this._onDrop),r(M,"touchend",this._onDrop),r(M,"touchcancel",this._onDrop),r(g,"dragend",this),r(v,"dragstart",this._onDragStart),I||this._onDragStart(P,!0);try{M.selection?M.selection.empty():window.getSelection().removeAllRanges()}catch(h){}}}},_emulateDragOver:function(){if(x){l(b,"display","none");var t=M.elementFromPoint(x.clientX,x.clientY),e=t,n=" "+this.options.group.name,i=V.length;if(e)do{if(e[A]&&e[A].groups.indexOf(n)>-1){for(;i--;)V[i]({clientX:x.clientX,clientY:x.clientY,target:t,rootEl:e});break}t=e}while(e=e.parentNode);l(b,"display","")}},_onTouchMove:function(t){if(P){var e=t.touches?t.touches[0]:t,n=e.clientX-P.clientX,i=e.clientY-P.clientY,o=t.touches?"translate3d("+n+"px,"+i+"px,0)":"translate("+n+"px,"+i+"px)";x=e,l(b,"webkitTransform",o),l(b,"mozTransform",o),l(b,"msTransform",o),l(b,"transform",o),t.preventDefault()}},_onDragStart:function(t,e){var n=t.dataTransfer,i=this.options;if(this._offUpEvents(),"clone"==$.pull&&(_=g.cloneNode(!0),l(_,"display","none"),v.insertBefore(_,g)),e){var o,s=g.getBoundingClientRect(),a=l(g);b=g.cloneNode(!0),l(b,"top",s.top-N(a.marginTop,10)),l(b,"left",s.left-N(a.marginLeft,10)),l(b,"width",s.width),l(b,"height",s.height),l(b,"opacity","0.8"),l(b,"position","fixed"),l(b,"zIndex","100000"),v.appendChild(b),o=b.getBoundingClientRect(),l(b,"width",2*s.width-o.width),l(b,"height",2*s.height-o.height),"touch"===e?(r(M,"touchmove",this._onTouchMove),r(M,"touchend",this._onDrop),r(M,"touchcancel",this._onDrop)):(r(M,"mousemove",this._onTouchMove),r(M,"mouseup",this._onDrop)),this._loopId=setInterval(this._emulateDragOver,150)}else n&&(n.effectAllowed="move",i.setData&&i.setData.call(this,n,g)),r(M,"drop",this);setTimeout(this._dragStarted,0)},_onDragOver:function(t){var n,o,r,s=this.el,a=this.options,d=a.group,c=d.put,p=$===d,f=a.sort;if(g&&(void 0!==t.preventDefault&&(t.preventDefault(),!a.dragoverBubble&&t.stopPropagation()),$&&!a.disabled&&(p?f||(r=!v.contains(g)):$.pull&&c&&($.name===d.name||c.indexOf&&~c.indexOf($.name)))&&(void 0===t.rootEl||t.rootEl===this.el))){if(G(t,a,this.el),D)return;if(n=i(t.target,a.draggable,s),o=g.getBoundingClientRect(),r)return e(!0),void(_||y?v.insertBefore(g,_||y):f||v.appendChild(g));if(0===s.children.length||s.children[0]===b||s===t.target&&(n=h(s,t))){if(n){if(n.animated)return;w=n.getBoundingClientRect()}e(p),s.appendChild(g),this._animate(o,g),n&&this._animate(w,n)}else if(n&&!n.animated&&n!==g&&void 0!==n.parentNode[A]){C!==n&&(C=n,T=l(n));var m,w=n.getBoundingClientRect(),E=w.right-w.left,k=w.bottom-w.top,S=/left|right|inline/.test(T.cssFloat+T.display),P=n.offsetWidth>g.offsetWidth,x=n.offsetHeight>g.offsetHeight,R=(S?(t.clientX-w.left)/E:(t.clientY-w.top)/k)>.5,O=n.nextElementSibling;D=!0,setTimeout(u,30),e(p),m=S?n.previousElementSibling===g&&!P||R&&P:O!==g&&!x||R&&x,m&&!O?s.appendChild(g):n.parentNode.insertBefore(g,m?O:n),this._animate(o,g),this._animate(w,n)}}},_animate:function(t,e){var n=this.options.animation;if(n){var i=e.getBoundingClientRect();l(e,"transition","none"),l(e,"transform","translate3d("+(t.left-i.left)+"px,"+(t.top-i.top)+"px,0)"),e.offsetWidth,l(e,"transition","all "+n+"ms"),l(e,"transform","translate3d(0,0,0)"),clearTimeout(e.animated),e.animated=setTimeout(function(){l(e,"transition",""),l(e,"transform",""),e.animated=!1},n)}},_offUpEvents:function(){s(M,"mouseup",this._onDrop),s(M,"touchmove",this._onTouchMove),s(M,"touchend",this._onDrop),s(M,"touchcancel",this._onDrop)},_onDrop:function(e){var n=this.el,i=this.options;clearInterval(this._loopId),clearInterval(R.pid),s(M,"drop",this),s(M,"mousemove",this._onTouchMove),s(n,"dragstart",this._onDragStart),this._offUpEvents(),e&&(e.preventDefault(),!i.dropBubble&&e.stopPropagation(),b&&b.parentNode.removeChild(b),g&&(s(g,"dragend",this),c(g),a(g,this.options.ghostClass,!1),v!==g.parentNode?(S=f(g),B(g.parentNode,"sort",g,v,k,S),B(v,"sort",g,v,k,S),B(g,"add",g,v,k,S),B(v,"remove",g,v,k,S)):(_&&_.parentNode.removeChild(_),g.nextSibling!==y&&(S=f(g),B(v,"update",g,v,k,S),B(v,"sort",g,v,k,S))),t.active&&B(v,"end",g,v,k,S)),v=g=b=y=_=w=E=P=x=C=T=$=t.active=null,this.save())},handleEvent:function(t){var e=t.type;"dragover"===e||"dragenter"===e?(this._onDragOver(t),o(t)):("drop"===e||"dragend"===e)&&this._onDrop(t)},toArray:function(){for(var t,e=[],n=this.el.children,o=0,r=n.length;r>o;o++)t=n[o],i(t,this.options.draggable,this.el)&&e.push(t.getAttribute("data-id")||p(t));return e},sort:function(t){var e={},n=this.el;this.toArray().forEach(function(t,o){var r=n.children[o];i(r,this.options.draggable,n)&&(e[t]=r)},this),t.forEach(function(t){e[t]&&(n.removeChild(e[t]),n.appendChild(e[t]))})},save:function(){var t=this.options.store;t&&t.set(this)},closest:function(t,e){return i(t,e||this.options.draggable,this.el)},option:function(t,e){var n=this.options;return void 0===e?n[t]:void(n[t]=e)},destroy:function(){var t=this.el,e=this.options;L.forEach(function(n){s(t,n.substr(2).toLowerCase(),e[n])}),s(t,"mousedown",this._onTapStart),s(t,"touchstart",this._onTapStart),s(t,"dragover",this),s(t,"dragenter",this),Array.prototype.forEach.call(t.querySelectorAll("[draggable]"),function(t){t.removeAttribute("draggable")}),V.splice(V.indexOf(this._onDragOver),1),this._onDrop(),this.el=null}},t.utils={on:r,off:s,css:l,find:d,bind:n,is:function(t,e){return!!i(t,e,t)},throttle:m,closest:i,toggleClass:a,dispatchEvent:B,index:f},t.version="1.1.1",t.create=function(e,n){return new t(e,n)},t}),define("component/galleryComponent",["core/subscriber","factory/mediaFactory","component/recorderComponent","core/helper","Sortable","extra"],function(t,e,n,i,o){var r=function(n){t.prototype.constructor.apply(this),this.options=n,this.activeMedia=this.options.activeMedia,this.thumbsBounds={width:0,shiftWidth:0,thumbsWidth:0},this.bind__onClickItemContainer=this._onClickItemContainer.bind(this),this.bind__onClickPrevNext=this._onClickPrevNext.bind(this),this.bind__onClickAction=this._onClickAction.bind(this),this.bind__onClickLeftRight=this._onClickLeftRight.bind(this),this.bind__onClickThumbnail=this._onClickThumbnail.bind(this),this.bind__onClickThumbRemove=this._onClickThumbRemove.bind(this),this.bind__onRenderMedia=this._onRenderMedia.bind(this),this.bind__onRenderThumbnails=this._onRenderThumbnails.bind(this),this.bind__onWindowResize=this._onWindowResize.bind(this),this.$container=this.options.$container,this.$inner=this.$container.find('[id="'+this.options.identifier+'"]'+r.Binder.INNER),this.$item=this.$inner.find(r.Binder.ITEM),this.$prev=this.$inner.find(r.Binder.PREV),this.$next=this.$inner.find(r.Binder.NEXT),this.$actions=this.$inner.find(r.Binder.ACTION),this.$carousel=this.$inner.find(r.Binder.CAROUSEL),this.$thumbs=this.$inner.find(r.Binder.THUMBS),this.$left=this.$inner.find(r.Binder.LEFT),this.$right=this.$inner.find(r.Binder.RIGHT),this.$item.on("click",this.bind__onClickItemContainer),this.$prev.find("i.fa").on("click",this.bind__onClickPrevNext),this.$next.find("i.fa").on("click",this.bind__onClickPrevNext),this.$actions.on("click",this.bind__onClickAction),this.$left.find("i.fa").on("click",this.bind__onClickLeftRight),this.$right.find("i.fa").on("click",this.bind__onClickLeftRight),$(window).on("resize",this.bind__onWindowResize),this.options.canEdit&&(this.sortable=o.create(this.$thumbs.find("ul")[0],{onSort:function(t){var e=this.options.media[t.oldIndex],n=this.options.media[t.newIndex];this.options.media[t.newIndex]=e,this.options.media[t.oldIndex]=n,this._updateButtonStates(),this._dispatch(r.Event.CHANGE,{galleryComponent:this})}.bind(this)})),"undefined"!=typeof this.options.mediaIds&&e.list(this.options.mediaIds).done(function(t){this.options.media=t.media,this._populate()}.bind(this)).fail(function(t){console.error("%s: media factory list",r.TAG)})};return r.extend(t),r.TAG="GalleryComponent",r.Mode={PREVIEW:0,INLINE:1},r.Event={CHANGE:"eventChange",REMOVED_MEDIA:"eventRemovedMedia",DONE:"eventDone",HIDDEN:"eventHidden"},r.Binder={INNER:".gallery-inner",ITEM:".gallery-item",PREV:".gallery-prev",NEXT:".gallery-next",ACTION:".gallery-action a",CAROUSEL:".gallery-carousel",THUMBS:".gallery-thumbs",THUMB_REMOVE:".gallery-thumb-remove",LEFT:".gallery-left",RIGHT:".gallery-right"},r.prototype._launchRecorder=function(t,e,i){n.render(t,function(t){this.recorderCmp=t.recorderComponent,this.recorderCmp.subscribe(n.Event.DONE,function(t){this.recorderCmp.hide(),t.doPost&&window.location.assign(Routing.generate("imdc_thread_new_from_media",{mediaId:t.media.get("id")}))}.bind(this)),this.recorderCmp.subscribe(n.Event.HIDDEN,function(t){this.recorderCmp.destroy(),this.options.mode==r.Mode.PREVIEW&&this.show(),this.paused=!1}.bind(this)),this.paused=!0,this.options.mode==r.Mode.PREVIEW&&this.hide(),e&&this.recorderCmp.setSourceMedia(this.activeMedia),i&&this.recorderCmp.setRecordedMedia(this.activeMedia),this.recorderCmp.show()}.bind(this))},r.prototype._onClickItemContainer=function(t){this.options.mode==r.Mode.PREVIEW&&t.target===this.$item[0]&&this.hide()},r.prototype._onClickPrevNext=function(t){t.preventDefault();var e=$(t.currentTarget).hasClass("next"),n=$.inArray(this.activeMedia,this.options.media);!e&&0>n-1||e&&n+1>=this.options.media.length||(this.activeMedia=this.options.media[n+(e?1:-1)],this._renderMedia())},r.prototype._onClickAction=function(t){var e=$(t.currentTarget).data("action");switch(e){case 1:this.hide();break;case 2:i.toggleFullScreen(this.$item);break;case 3:this._launchRecorder({tab:n.Tab.INTERPRETATION,enableDoneAndPost:!0},!0);break;case 4:this._launchRecorder({tab:n.Tab.NORMAL,mode:n.Mode.PREVIEW},!1,!0)}},r.prototype._calcCarouselPosition=function(t){var e,n,i,o,r=Math.abs(parseInt(this.$thumbs.find("ul").css("left"),10));return t?(e=r+this.thumbsBounds.width,n=r+(this.thumbsBounds.thumbsWidth-e),i=r+this.thumbsBounds.shiftWidth,o=-Math.min(i,e>=this.thumbsBounds.thumbsWidth?r:n)):(e=r-this.thumbsBounds.shiftWidth,o=Math.min(0,-e)),o},r.prototype._onClickLeftRight=function(t){t.preventDefault();var e=this._calcCarouselPosition($(t.currentTarget).hasClass("right"));this._updateButtonStates(e),this.$thumbs.find("ul").css({left:e})},r.prototype._onClickThumbnail=function(t){t.preventDefault();var e=$(t.currentTarget).data("mid");this.activeMedia=$.grep(this.options.media,function(t,n){return t.get("id")==e})[0],this._renderMedia()},r.prototype._onClickThumbRemove=function(t){t.preventDefault();var e=$(t.currentTarget).data("mid"),n=$.grep(this.options.media,function(t,n){return t.get("id")==e})[0];this.removeMedia(n),this._dispatch(r.Event.REMOVED_MEDIA,{media:n,galleryComponent:this})},r.prototype.clear=function(){for(var t in this.options.media){var e=this.options.media[t];this.removeMedia(e),this._dispatch(r.Event.REMOVED_MEDIA,{media:e,galleryComponent:this})}},r.prototype._updateButtonStates=function(t){var e=this.$thumbs.find('li[data-mid="'+this.activeMedia.get("id")+'"]');this.$thumbs.find("div").removeClass("selected");var n=this.$actions.filter('[data-action="1"]'),i=this.$actions.filter('[data-action="2"]'),o=this.$actions.filter('[data-action="3"]'),s=this.$actions.filter('[data-action="4"]'),a=this.options.mode==r.Mode.PREVIEW;n.toggle(a),i.show(),1==this.activeMedia.get("type")?(o.show(),s.toggle(a)):(o.hide(),s.hide()),this.$prev.toggleClass("disabled",e.is(":first-child")),this.$next.toggleClass("disabled",e.is(":last-child"));var t=Math.abs(void 0!==t?t:parseInt(this.$thumbs.find("ul").css("left"),10));

this.$left.find("i.fa").toggleClass("disabled",0>=t),this.$right.find("i.fa").toggleClass("disabled",t+this.thumbsBounds.width>=this.thumbsBounds.thumbsWidth),e.find("div").addClass("selected")},r.prototype._focusSelectedThumbnail=function(){var t=this.$thumbs.find('li[data-mid="'+this.activeMedia.get("id")+'"]'),e=t.position();if(e){var n=t.outerWidth(!0);e.right=e.left+n,e.center=e.left+n/2;var i=Math.abs(parseInt(this.$thumbs.find("ul").css("left"),10)),o={left:i,right:i+this.thumbsBounds.width,center:i+this.thumbsBounds.width/2},r=e.center>o.center,s=Math.abs(e.center-o.center),a=i+(r?s:-s);a=r?-Math.min(a,o.right>=this.thumbsBounds.thumbsWidth?o.left:this.thumbsBounds.thumbsWidth-this.thumbsBounds.width):Math.min(0,-a),this.$thumbs.find("ul").css({left:a}),this._updateButtonStates(a)}},r.prototype._onWindowResize=function(t){this.options.media.length<=1&&!this.options.canEdit?this.$carousel.hide():this.$carousel.show();var e="body"===this.$container.prop("tagName").toLowerCase()?$(window):this.$container,n=this.$carousel.is(":hidden")?0:this.$carousel.outerHeight(!0),o=i.isFullscreen()?$(window).height():e.height()-n,r=e.width()-(this.$left.outerWidth(!0)+this.$right.outerWidth(!0))-.5,s=function(t,e){return o/2-$(this).height()/2};this.$item.css({height:o,"line-height":o+"px"}),this.$thumbs.width(r),this.$prev.css("top",s),this.$next.css("top",s),this.$item.find(".tt-media-video").css({height:o}),this.$item.find(".tt-media-img").css({"max-height":o});var a=this.$thumbs.width(),l=this.$thumbs.find("li"),d=parseInt(l.eq(0).css("margin-left"),10),c=l.eq(0).outerWidth(!0)-d,u=Math.floor(a/c);return this.thumbsBounds.width=a,this.thumbsBounds.shiftWidth=c*u,this.thumbsBounds.thumbsWidth=c*l.length+d,this.activeMedia?(this._focusSelectedThumbnail(),void this.$item.toggleClass("fullscreen",i.isFullscreen())):(this.$actions.hide(),this.$prev.addClass("disabled"),this.$next.addClass("disabled"),this.$left.find("i.fa").addClass("disabled"),void this.$right.find("i.fa").addClass("disabled"))},r.prototype._onRenderMedia=function(t,e){this.$item.html(e),$(window).trigger("resize")},r.prototype._onRenderThumbnails=function(t,e){this.$thumbs.find("ul").html(e),this.$thumbs.find("li").on("click",this.bind__onClickThumbnail),this.$thumbs.find("li").find("span").on("click",this.bind__onClickThumbRemove),$(window).trigger("resize")},r.prototype._renderMedia=function(){dust.render("media_element",{media:this.activeMedia?this.activeMedia.data:null,enable_controls:!0,preload_media:!1},this.bind__onRenderMedia)},r.prototype._renderMediaAndThumbnails=function(){return this.activeMedia?(this._renderMedia(),void dust.render("gallery_thumbnail",{media:this.options.media,can_edit:this.options.canEdit},this.bind__onRenderThumbnails)):(this.$item.html(""),this.$thumbs.find("ul").html(""),void $(window).trigger("resize"))},r.prototype._populate=function(){this.activeMedia=0==this.options.media.length?null:this.activeMedia?this.activeMedia:this.options.media[0],this._renderMediaAndThumbnails()},r.prototype.show=function(t){t=void 0!==t?t:this.options.mode==r.Mode.PREVIEW,this.options.mode==r.Mode.PREVIEW&&this.$container.addClass("tt-gallery-modal");var e=function(){this._populate()}.bind(this);t?this.$inner.fadeIn().promise().done(e):this.$inner.show().promise().done(e)},r.prototype.hide=function(t){t=void 0!==t?t:this.options.mode==r.Mode.PREVIEW,this.options.mode!=r.Mode.PREVIEW||this.paused||this.$container.removeClass("tt-gallery-modal");var e=function(){this.paused||this._dispatch(r.Event.HIDDEN,{galleryComponent:this})}.bind(this);t?this.$inner.fadeOut().promise().done(e):this.$inner.show().promise().done(e)},r.prototype.destroy=function(){this.$inner.remove()},r.prototype.setMedia=function(t){this.options.media=t,this._populate()},r.prototype.addMedia=function(t){this.options.media.push(t),this._populate()},r.prototype.removeMedia=function(t){var e=$.inArray(t,this.options.media);-1!=e&&(this.options.media.splice(e,1),0==this.options.media.length?this.activeMedia=null:(e>=this.options.media.length&&e--,this.activeMedia=this.options.media[e]),this._populate())},r.render=function(t,e){if("undefined"!==t.mode&&t.mode==r.Mode.INLINE&&"undefined"===t.$container)throw new Error("Inline mode requires the $container option to be set explicitly.");var n={$container:$("body"),identifier:Math.random(),mode:r.Mode.PREVIEW,canEdit:!1,media:[],activeMedia:null};t=t||n;for(var i in n)t[i]="undefined"!=typeof t[i]?t[i]:n[i];var o=t.mode==r.Mode.INLINE?"gallery_inline":"gallery_preview";dust.render(o,{identifier:t.identifier},function(n,i){t.$container.append(i);var o=new r(t);e.call(o,{galleryComponent:o})})},r}),define("component/mediaChooserComponent",["core/subscriber","factory/mediaFactory","factory/myFilesFactory","component/recorderComponent","component/myFilesSelectorComponent","component/galleryComponent","model/mediaModel","core/helper","extra"],function(t,e,n,i,o,r,s,a){var l=function(e){t.prototype.constructor.apply(this),this.options=e,this.media=[],this.bind__onClickRecordVideo=this._onClickRecordVideo.bind(this),this.bind__onClickUploadFile=this._onClickUploadFile.bind(this),this.bind__onClickSelect=this._onClickSelect.bind(this),this.bind__onChangeResourceFile=this._onChangeResourceFile.bind(this),this.$container=this.options.$container,this.$containerUpload=this.$container.find(l.Binder.CONTAINER_UPLOAD),this.$uploadForm=$(this.$containerUpload.data("form")),this.$resourceFile=this._getFormField("source_resource_file"),this.$recordVideo=this.$container.find(l.Binder.RECORD_VIDEO),this.$uploadFile=this.$container.find(l.Binder.UPLOAD_FILE),this.$select=this.$container.find(l.Binder.SELECT),this.$uploadTitle=this.$container.find(l.Binder.UPLOAD_TITLE),this.$working=this.$container.find(l.Binder.WORKING),this.$gallery=this.$container.find(l.Binder.GALLERY),this.$resourceFile.on("change",this.bind__onChangeResourceFile),this.$recordVideo.on("click",this.bind__onClickRecordVideo),this.$uploadFile.on("click",this.bind__onClickUploadFile),this.$select.on("click",this.bind__onClickSelect),this.$gallery.length>0&&r.render({$container:this.$gallery,mode:r.Mode.INLINE,canEdit:!0},function(t){this.galleryCmp=t.galleryComponent,this.galleryCmp.subscribe(r.Event.CHANGE,function(t){this.media=this.galleryCmp.options.media,this._invokeSuccess()}.bind(this)),this.galleryCmp.subscribe(r.Event.REMOVED_MEDIA,function(t){0==t.galleryComponent.options.media.length&&(this.galleryCmp.hide(!0),this.$gallery.slideUp()),this._removeSelectedMedia(t.media),this._invokeSuccess()}.bind(this))}.bind(this))};return l.extend(t),l.TAG="MediaChooserComponent",l.Binder={RECORD_VIDEO:".mediachooser-record-video",UPLOAD_FILE:".mediachooser-upload-file",SELECT:".mediachooser-select",CONTAINER_UPLOAD:".mediachooser-container-upload",UPLOAD_TITLE:".mediachooser-upload-title",WORKING:".mediachooser-working",GALLERY:".mediachooser-gallery"},l.Event={UPLOAD_START:"eventUploadStart",SUCCESS:"eventSuccess",SUCCESS_AND_POST:"eventSuccessAndPost",REMOVE:"eventRemove",ERROR:"eventError",RESET:"eventReset"},l.FORM_NAME="media",l.prototype._getFormField=function(t){return this.$uploadForm.find("#"+l.FORM_NAME+"_"+t)},l.prototype._addSelectedMedia=function(t){for(var e in this.media){var n=this.media[e];if(n.get("id")==t.get("id"))return}this.media.push(t),0!=this.$gallery.length&&(this.$gallery.slideDown(),this.galleryCmp.addMedia(t),this.galleryCmp.show(!0))},l.prototype._removeSelectedMedia=function(t){for(var e in this.media){var n=this.media[e];if(n.get("id")==t.get("id")){var t=this.media.splice(e,1);this.galleryCmp.removeMedia(e),this._dispatch(l.Event.REMOVE,{media:t,mediaChooserComponent:this})}}},l.prototype._resetUpload=function(){this.$containerUpload.hide(),this.$uploadTitle.html("")},l.prototype._invokeSuccess=function(t){this._resetUpload();var e="undefined"!=typeof t&&1==t?l.Event.SUCCESS_AND_POST:l.Event.SUCCESS,n={media:this.media,mediaChooserComponent:this};this._dispatch(e,n)},l.prototype._onClickRecordVideo=function(t){t.preventDefault(),i.render({enableDoneAndPost:this.options.enableDoneAndPost},function(t){this.recorderCmp=t.recorderComponent,this.recorderCmp.subscribe(i.Event.DONE,function(t){this.recorderCmp.hide(),this._addSelectedMedia(t.media),this._invokeSuccess(t.doPost)}.bind(this)),this.recorderCmp.subscribe(i.Event.HIDDEN,function(t){this.recorderCmp.destroy()}.bind(this)),this.recorderCmp.show()}.bind(this))},l.prototype._onClickUploadFile=function(t){t.preventDefault(),this.$resourceFile.click()},l.prototype._onClickSelect=function(t){t.preventDefault(),o.render({},function(t){this.mfsCmp=t.myFilesSelectorComponent,this.mfsCmp.subscribe(o.Event.DONE,function(t){this.mfsCmp.hide(),$.each(t.media,function(t,e){this._addSelectedMedia(e)}.bind(this)),this._invokeSuccess()}.bind(this)),this.mfsCmp.subscribe(o.Event.HIDDEN,function(t){this.mfsCmp.destroy()}.bind(this)),this.mfsCmp.show()}.bind(this))},l.prototype._onChangeResourceFile=function(t){t.preventDefault(),this._toggleForm(!0);var e=this.$resourceFile.data("maxsize"),i=this.$resourceFile[0].files[0].size;return i>e?(alert(Translator.trans("form.upload.maxFileSizeExceeded",{fileSize:(i/1048576).toFixed(1)+"MB",maxUploadSize:(e/1048576).toFixed(1)+"MB"})),this.$resourceFile.val(""),void this._toggleForm(!1)):(n.add(this.$uploadForm[0]).progress(function(t){a.updateProgressBar(this.$containerUpload.show(),t)}.bind(this)).done(function(t){this._addSelectedMedia(t.media),this._invokeSuccess(),this._toggleForm(!1)}.bind(this)).fail(function(t){this._resetUpload(),this._dispatch(l.Event.ERROR,{mediaChooserComponent:this,error:t?t.error:"Unknown error"}),this._toggleForm(!1)}.bind(this)),this._dispatch(l.Event.UPLOAD_START,{mediaChooserComponent:this}),void this.$resourceFile.val(""))},l.prototype._toggleForm=function(t){this.$recordVideo.attr("disabled",t),this.$uploadFile.attr("disabled",t),this.$select.attr("disabled",t)},l.prototype.setMedia=function(t){console.log("%s: %s",l.TAG,"setMedia"),"undefined"!=typeof t&&(this._toggleForm(!0),this.$working.show(),e.list(t).done(function(t){this.$working.hide(),this._toggleForm(!1),$.each(t.media,function(t,e){this._addSelectedMedia(e)}.bind(this)),this._invokeSuccess()}.bind(this)).fail(function(t){this.$working.hide(),this._toggleForm(!1),console.error("%s: media factory list",l.TAG)}.bind(this)))},l.prototype.generateFormData=function(t){var e="";return $.each(this.media,function(n,i){var o=$(t.replace(/__name__/g,n));o.val(i.get("id")),e+=o[0].outerHTML}),e},l.prototype.reset=function(){console.log("%s: %s",l.TAG,"reset"),this._resetUpload(),this.galleryCmp.clear(),this._dispatch(l.Event.RESET,{mediaChooserComponent:this})},l.render=function(t,e){var n={enableDoneAndPost:!1};e=e||n;for(var i in n)e[i]="undefined"!=typeof e[i]?e[i]:n[i];return e.$container=t,new l(e)},l}),define("views/contact/listView",["component/tableComponent"],function(t){var e=function(n,i){this.controller=n,this.bind__onSelectionChange=this._onSelectionChange.bind(this),this.bind__onClickBulkAction=this._onClickBulkAction.bind(this),this.$container=i.container,this.$form=this.$container.find("form[name^="+e.FORM_NAME+"]"),this.$tabPanes=this.$container.find(e.Binder.TAB_PANES),this.tabPaneTblCmps=[],this.$tabPanes.each(function(e,n){this.tabPaneTblCmps[n.id]=t.table($(n)),this.tabPaneTblCmps[n.id].subscribe(t.Event.SELECTION_CHANGE,this.bind__onSelectionChange),this.tabPaneTblCmps[n.id].subscribe(t.Event.CLICK_BULK_ACTION,this.bind__onClickBulkAction)}.bind(this)),$tt._instances.push(this)};return e.TAG="ContactListView",e.Binder={TAB_PANES:".tab-pane[id^=tab]"},e.FORM_NAME="users_select",e.prototype._getFormField=function(t,e){return t.find("#"+t.attr("name")+"_"+e)},e.prototype._onSelectionChange=function(t){var e=t.tableComponent.getBulkActions();e.attr("disabled",0==t.$selection.length)},e.prototype._updateUsersSelectForm=function(t){var e=this._getFormField(this.$form,"users");e.html(""),t.each(function(t,n){var i=e.data("prototype");i=$(i.replace(/__name__/g,t)),i.val($(n).data("uid")),e.append(i)})},e.prototype._onClickBulkAction=function(t){switch(t.action){case 1:var e=t.tableComponent.getTable().attr("id").replace(/^tab/,"").toLowerCase();if("all"==e&&!confirm("This will delete the selected contacts from all lists. Continue?"))break;t.$bulkAction.attr("disabled",!0);var n=[];t.$selection.each(function(t,e){n.push($(e).data("uid"))}),this.controller["delete"](n,e).fail(function(e){alert(e?e.message:"Something went wrong."),t.$bulkAction.attr("disabled",!1)});break;case 2:t.$bulkAction.attr("disabled",!0),this._updateUsersSelectForm(t.$selection),this.$form.attr("action",Routing.generate("imdc_group_new")),this.$form.submit();break;case 3:t.$bulkAction.attr("disabled",!0),this._updateUsersSelectForm(t.$selection),this.$form.attr("action",Routing.generate("imdc_message_new")),this.$form.submit()}},e}),define("views/forum/newView",["component/mediaChooserComponent","component/accessTypeComponent"],function(t,e){var n=function(i,o){this.controller=i,this.bind__onSubmitForm=this._onSubmitForm.bind(this),this.bind__onUploadStart=this._onUploadStart.bind(this),this.bind__onSuccess=this._onSuccess.bind(this),this.bind__onRemove=this._onRemove.bind(this),this.bind__onReset=this._onReset.bind(this),this.bind__onError=this._onError.bind(this),this.$container=o.container,this.$form=this.$container.find("form[name^="+n.FORM_NAME+"]"),this.$submit=this.$container.find(n.Binder.SUBMIT),this.$form.on("submit",this.bind__onSubmitForm),this.atCmp=e.render(this.$form),this.mcCmp=t.render(this.$form),this.mcCmp.subscribe(t.Event.UPLOAD_START,this.bind__onUploadStart),this.mcCmp.subscribe(t.Event.SUCCESS,this.bind__onSuccess),this.mcCmp.subscribe(t.Event.REMOVE,this.bind__onRemove),this.mcCmp.subscribe(t.Event.RESET,this.bind__onReset),this.mcCmp.subscribe(t.Event.ERROR,this.bind__onError);var r=[];this._getFormField("titleMedia").children().each(function(t,e){r.push($(e).val())}),r.length>0&&(this.$submit.attr("disabled",!0),this.mcCmp.setMedia(r)),$tt._instances.push(this)};return n.TAG="ForumNewView",n.Binder={SUBMIT:".forum-submit"},n.FORM_NAME="forum",n.prototype._getFormField=function(t){return this.$form.find("#"+n.FORM_NAME+"_"+t)},n.prototype._onSubmitForm=function(t){this.$form[0].checkValidity()&&this.$submit.button("loading")},n.prototype._updateForm=function(){var t=this._getFormField("titleMedia");t.html(this.mcCmp.generateFormData(t.data("prototype"))),t=this._getFormField("titleText"),t.attr("required",0==this.mcCmp.media.length),t=t.parent().find("label"),0==this.mcCmp.media.length?t.addClass("required"):t.removeClass("required")},n.prototype._onUploadStart=function(t){this.$submit.attr("disabled",!0)},n.prototype._onSuccess=function(t){this._updateForm(),this.$submit.attr("disabled",!1)},n.prototype._onRemove=function(t){this._updateForm()},n.prototype._onReset=function(t){this._updateForm()},n.prototype._onError=function(t){alert("Error: "+t.error)},n}),define("views/forum/editView",["views/forum/newView"],function(t){var e=function(n,i){t.prototype.constructor.apply(this,arguments),this.bind__onClickDelete=this._onClickDelete.bind(this),this.$deleteModal=this.$container.find(e.Binder.DELETE_MODAL),this.$delete=this.$container.find(e.Binder.DELETE),this.$delete.on("click",this.bind__onClickDelete)};return e.extend(t),e.TAG="ForumEditView",e.Binder.DELETE_MODAL=".forum-delete-modal",e.Binder.DELETE=".forum-delete",e.prototype._onClickDelete=function(t){t.preventDefault(),this.$delete.button("loading"),this.controller["delete"]().done(function(t){this.$deleteModal.find(".modal-body").html("Forum deleted successfully.")}.bind(this)).fail(function(){this.$container.find(".modal-body").prepend("Something went wrong. Try again."),this.$delete.button("reset")}.bind(this))},e}),define("views/forum/listView",["component/galleryComponent"],function(t){var e=function(t,n){this.controller=t,this.bind__onClickThumbnail=this._onClickThumbnail.bind(this),this.$container=n.container,this.$thumbnails=this.$container.find(e.Binder.THUMBNAILS),this.$thumbnails.on("click",this.bind__onClickThumbnail),$tt._instances.push(this)};return e.TAG="ForumListView",e.Binder={THUMBNAILS:".tt-grid-div-body .expand"},e.prototype._onClickThumbnail=function(e){e.preventDefault(),t.render({mediaIds:[$(e.currentTarget).data("mid")]},function(e){this.galleryCmp=e.galleryComponent,this.galleryCmp.subscribe(t.Event.HIDDEN,function(t){this.galleryCmp.destroy()}.bind(this)),this.galleryCmp.show()}.bind(this))},e}),define("views/forum/viewView",["component/galleryComponent"],function(t){var e=function(n,i){this.controller=n,this.bind__onClickThumbnail=this._onClickThumbnail.bind(this),this.$container=i.container,this.$gallery=this.$container.find(e.Binder.GALLERY),this.$thumbnails=this.$container.find(e.Binder.THUMBNAILS),this.$thumbnails.on("click",this.bind__onClickThumbnail);var o=this.controller.model.get("ordered_media");o.length>0&&t.render({$container:this.$gallery,mode:t.Mode.INLINE,media:o},function(t){this.galleryCmp=t.galleryComponent,this.galleryCmp.show()}.bind(this)),$tt._instances.push(this)};return e.TAG="ForumViewView",e.Binder={GALLERY:".forum-gallery",THUMBNAILS:".tt-grid-div-body .expand"},e.prototype._onClickThumbnail=function(e){e.preventDefault(),t.render({mediaIds:[$(e.currentTarget).data("mid")]},function(e){this.galleryCmp=e.galleryComponent,this.galleryCmp.subscribe(t.Event.HIDDEN,function(t){this.galleryCmp.destroy()}.bind(this)),this.galleryCmp.show()}.bind(this))},e}),define("views/group/newView",["component/mediaChooserComponent"],function(t){var e=function(n,i){this.controller=n,this.bind__onSubmitForm=this._onSubmitForm.bind(this),this.bind__onUploadStart=this._onUploadStart.bind(this),this.bind__onSuccess=this._onSuccess.bind(this),this.bind__onReset=this._onReset.bind(this),this.bind__onError=this._onError.bind(this),this.$container=i.container,this.$form=this.$container.find("form[name^="+e.FORM_NAME+"]"),this.$submit=this.$container.find(e.Binder.SUBMIT),this.$form.on("submit",this.bind__onSubmitForm),this.mcCmp=t.render(this.$form),this.mcCmp.subscribe(t.Event.UPLOAD_START,this.bind__onUploadStart),this.mcCmp.subscribe(t.Event.SUCCESS,this.bind__onSuccess),this.mcCmp.subscribe(t.Event.RESET,this.bind__onReset),this.mcCmp.subscribe(t.Event.ERROR,this.bind__onError);var o=[];this._getFormField("media").children().each(function(t,e){o.push($(e).val())}),o.length>0&&(this.$submit.attr("disabled",!0),this.mcCmp.setMedia(o)),$tt._instances.push(this)};return e.TAG="GroupNewView",e.Binder={SUBMIT:".group-submit"},e.FORM_NAME="user_group",e.prototype._getFormField=function(t){return this.$form.find("#"+e.FORM_NAME+"_"+t)},e.prototype._onSubmitForm=function(t){this.$form[0].checkValidity()&&this.$submit.button("loading")},e.prototype._updateForm=function(){var t=this._getFormField("media");t.html(this.mcCmp.generateFormData(t.data("prototype")))},e.prototype._onUploadStart=function(t){this.$submit.attr("disabled",!0)},e.prototype._onSuccess=function(t){this._updateForm(),this.$submit.attr("disabled",!1)},e.prototype._onReset=function(t){this._updateForm()},e.prototype._onError=function(t){alert("Error: "+t.error)},e}),define("views/group/editView",["views/group/newView"],function(t){var e=function(n,i){t.prototype.constructor.apply(this,arguments),this.bind__onClickDelete=this._onClickDelete.bind(this),this.$deleteModal=this.$container.find(e.Binder.DELETE_MODAL),this.$delete=this.$container.find(e.Binder.DELETE),this.$delete.on("click",this.bind__onClickDelete)};return e.extend(t),e.TAG="GroupEditView",e.Binder.DELETE_MODAL=".group-delete-modal",e.Binder.DELETE=".group-delete",e.prototype._onClickDelete=function(t){t.preventDefault(),this.$delete.button("loading"),this.controller["delete"]().done(function(t){this.$deleteModal.find(".modal-body").html("Group deleted successfully.")}.bind(this)).fail(function(){this.$container.find(".modal-body").prepend("Something went wrong. Try again."),this.$delete.button("reset")}.bind(this))},e}),define("views/group/listView",["component/galleryComponent"],function(t){var e=function(t,n){this.controller=t,this.bind__onClickThumbnail=this._onClickThumbnail.bind(this),this.$container=n.container,this.$thumbnails=this.$container.find(e.Binder.THUMBNAILS),this.$thumbnails.on("click",this.bind__onClickThumbnail),$tt._instances.push(this)};return e.TAG="GroupListView",e.Binder={THUMBNAILS:".tt-grid-div-body .expand"},e.prototype._onClickThumbnail=function(e){e.preventDefault(),t.render({mediaIds:[$(e.currentTarget).data("mid")]},function(e){this.galleryCmp=e.galleryComponent,this.galleryCmp.subscribe(t.Event.HIDDEN,function(t){this.galleryCmp.destroy()}.bind(this)),this.galleryCmp.show()}.bind(this))},e}),define("views/group/viewView",["component/galleryComponent"],function(t){var e=function(n,i){this.controller=n,this.bind__onClickThumbnail=this._onClickThumbnail.bind(this),this.$container=i.container,this.$gallery=this.$container.find(e.Binder.GALLERY),this.$thumbnails=this.$container.find(e.Binder.THUMBNAILS),this.$thumbnails.on("click",this.bind__onClickThumbnail);var o=this.controller.model.get("ordered_media");o.length>0&&t.render({$container:this.$gallery,mode:t.Mode.INLINE,media:o},function(t){this.galleryCmp=t.galleryComponent,this.galleryCmp.show()}.bind(this)),$tt._instances.push(this)};return e.TAG="GroupViewView",e.Binder={GALLERY:".group-gallery",THUMBNAILS:".tt-grid-div-body .expand"},e.prototype._onClickThumbnail=function(e){e.preventDefault(),t.render({mediaIds:[$(e.currentTarget).data("mid")]},function(e){this.galleryCmp=e.galleryComponent,this.galleryCmp.subscribe(t.Event.HIDDEN,function(t){this.galleryCmp.destroy()}.bind(this)),this.galleryCmp.show()}.bind(this))},e}),define("views/group/manageView",["component/tableComponent"],function(t){var e=function(n,i){this.controller=n,this.bind___onClickFormCheckboxLink=this._onClickFormCheckboxLink.bind(this),this.bind__onShownTab=this._onShownTab.bind(this),this.bind__onClickRemove=this._onClickRemove.bind(this),this.bind__onClickAdd=this._onClickAdd.bind(this),this.$container=i.container,this.$formSearch=this.$container.find("form[name^="+e.FORM_NAME_SEARCH+"]"),this.$formRemove=this.$container.find("form[name^="+e.FORM_NAME_REMOVE+"]"),this.$formAdd=this.$container.find("form[name^="+e.FORM_NAME_ADD+"]"),this.$formCheckboxLinks=this.$formSearch.find('label[class^="checkbox"] a'),this.$tabs=this.$container.find(e.Binder.TABS),this.$tabPanes=this.$container.find(e.Binder.TAB_PANES),this.$remove=this.$container.find(e.Binder.REMOVE),this.$add=this.$container.find(e.Binder.ADD),this.$formCheckboxLinks.on("click",this.bind___onClickFormCheckboxLink),this.$tabs.on("shown.bs.tab",this.bind__onShownTab),this.$remove.on("click",this.bind__onClickRemove),this.$add.on("click",this.bind__onClickAdd);var o=function(t){this.$remove.attr("disabled",0==t.$selection.length)}.bind(this),r=function(t){this.$add.attr("disabled",0==t.$selection.length)}.bind(this),s=function(t){return"remove"==t?o:r};this.tableCmps=[],this.$tabPanes.each(function(e,n){var i=$(n),o=s(i.data("type")),r=t.table(i);r.subscribe(t.Event.SELECTION_CHANGE,o),this.tableCmps.push(r)}.bind(this)),this.$tabs.filter('[href="'+(location.hash?"#tab"+location.hash.substr(1):"#tabMembers")+'"]').tab("show"),$tt._instances.push(this)};return e.TAG="GroupManageView",e.Binder={TABS:'a[data-toggle="tab"]',TAB_PANES:"[id^=tab]",REMOVE:".group-remove",ADD:".group-add"},e.FORM_NAME="ugm_",e.FORM_NAME_SEARCH=e.FORM_NAME+"search",e.FORM_NAME_REMOVE=e.FORM_NAME+"remove",e.FORM_NAME_ADD=e.FORM_NAME+"add",e.prototype._getFormField=function(t,e){return t.find("#"+t.attr("name")+"_"+e)},e.prototype._onClickFormCheckboxLink=function(t){t.preventDefault();var e=this.$formSearch.find('input[type="checkbox"]'),n=$(t.target).parent().find('input[type="checkbox"]'),i=n.prop("checked");e.prop("checked",!1),n.prop("checked",!i),this.$formSearch[0].submit()},e.prototype._onShownTab=function(t){var e="#"+$(t.target).attr("href").substr(4);history.pushState?history.pushState(null,null,e):location.hash=e,this.$tabPanes.find("ul.pagination li a").each(function(t,n){var i=$(n),o=i.attr("href"),t=o.lastIndexOf("#");t>0&&(o=o.substring(0,t)),i.attr("href",o+e)})},e.prototype._updateUsersSelectForm=function(t,e){var n=this._getFormField(t,"users");e.button("loading"),e.toggleClass("disabled"),n.html(""),$.each(this.tableCmps,function(t,e){e.getSelection().each(function(t,e){var i=n.data("prototype");i=$(i.replace(/__name__/g,t)),i.val($(e).data("uid")),n.append(i)})}.bind(this))},e.prototype._onClickRemove=function(t){t.preventDefault(),this._updateUsersSelectForm(this.$formRemove,this.$remove),this.$formRemove.submit()},e.prototype._onClickAdd=function(t){t.preventDefault(),this._updateUsersSelectForm(this.$formAdd,this.$add),this.$formAdd.submit()},e}),define("views/home/indexView",["component/galleryComponent"],function(t){var e=function(t,n){this.controller=t,this.bind__onClickThumbnail=this._onClickThumbnail.bind(this),this.$container=n.container,this.$thumbnails=this.$container.find(e.Binder.THUMBNAILS),this.$thumbnails.on("click",this.bind__onClickThumbnail),$tt._instances.push(this)};return e.TAG="HomeIndexView",e.Binder={THUMBNAILS:".tt-grid-div-body .expand"},e.prototype._onClickThumbnail=function(e){e.preventDefault(),t.render({mediaIds:[$(e.currentTarget).data("mid")]},function(e){this.galleryCmp=e.galleryComponent,this.galleryCmp.subscribe(t.Event.HIDDEN,function(t){this.galleryCmp.destroy()}.bind(this)),this.galleryCmp.show()}.bind(this))},e}),define("views/message/newView",["component/mediaChooserComponent"],function(t){var e=function(n,i){this.controller=n,this.bind__onSubmitForm=this._onSubmitForm.bind(this),this.bind__onUploadStart=this._onUploadStart.bind(this),this.bind__onSuccess=this._onSuccess.bind(this),this.bind__onReset=this._onReset.bind(this),this.bind__onError=this._onError.bind(this),this.$container=i.container,this.$form=this.$container.find("form[name^="+e.FORM_NAME+"]"),this.$submit=this.$container.find(e.Binder.SUBMIT),this.$form.on("submit",this.bind__onSubmitForm),this.mcCmp=t.render(this.$form),this.mcCmp.subscribe(t.Event.UPLOAD_START,this.bind__onUploadStart),this.mcCmp.subscribe(t.Event.SUCCESS,this.bind__onSuccess),this.mcCmp.subscribe(t.Event.RESET,this.bind__onReset),this.mcCmp.subscribe(t.Event.ERROR,this.bind__onError);var o=[];this._getFormField("attachedMedia").children().each(function(t,e){o.push($(e).val())}),o.length>0&&(this.$submit.attr("disabled",!0),this.mcCmp.setMedia(o)),this._getFormField("recipients").tagit(),$tt._instances.push(this)};return e.TAG="MessageNewView",e.Binder={SUBMIT:".message-submit"},e.FORM_NAME="PrivateMessageForm",e.prototype._getFormField=function(t){return this.$form.find("#"+e.FORM_NAME+"_"+t)},e.prototype._onSubmitForm=function(t){this.$form[0].checkValidity()&&this.$submit.button("loading")},e.prototype._updateForm=function(){var t=this._getFormField("attachedMedia");t.html(this.mcCmp.generateFormData(t.data("prototype")))},e.prototype._onUploadStart=function(t){this.$submit.attr("disabled",!0)},e.prototype._onSuccess=function(t){this.$submit.attr("disabled",!1),this._updateForm()},e.prototype._onReset=function(t){this._updateForm()},e.prototype._onError=function(t){alert("Error: "+t.error)},e}),define("views/message/replyView",["views/message/newView"],function(t){var e=function(e,n){t.prototype.constructor.apply(this,arguments)};return e.extend(t),e.TAG="MessageReplyView",e}),define("views/message/viewView",["component/galleryComponent"],function(t){var e=function(n,i){this.controller=n,this.$container=i.container,this.$gallery=this.$container.find(e.Binder.GALLERY);var o=this.controller.model.get("ordered_media");o.length>0&&t.render({$container:this.$gallery,mode:t.Mode.INLINE,media:o},function(t){this.galleryCmp=t.galleryComponent,this.galleryCmp.show()}.bind(this)),$tt._instances.push(this)};return e.TAG="MessageViewView",e.Binder={GALLERY:".message-gallery"},e}),define("views/myFiles/listView",["service","model/model","component/tableComponent","component/mediaChooserComponent","component/galleryComponent","core/helper"],function(t,e,n,i,o,r){var s=function(o,r){this.controller=o,this.bind__onClickBulkAction=this._onClickBulkAction.bind(this),this.bind__onClickFile=this._onClickFile.bind(this),this.bind__onSuccess=this._onSuccess.bind(this),this.bind__onError=this._onError.bind(this),this.bind__onAddGridElement=this._onAddGridElement.bind(this),this.bind__onAddListElement=this._onAddListElement.bind(this),this.$container=r.container,this.$filesList=this.$container.find(s.Binder.FILES_LIST),this.$fileButtons=this.$container.find(s.Binder.FILE_BUTTON),this.tblCmp=n.table(this.$filesList),this.tblCmp.subscribe(n.Event.CLICK_BULK_ACTION,this.bind__onClickBulkAction),this.$filesList.find("button.edit-title").on("click",function(t){t.stopPropagation(),$(this).parent().parent().parent().find("span.edit-title").editable("toggle")}),this.$fileButtons.not("[disabled]").on("click",this.bind__onClickFile),this.style=this.$filesList.children("div.table-responsive").length>0?s.Binder.STYLE_LIST:s.Binder.STYLE_GRID,this.mcCmp=i.render(this.$container),this.mcCmp.subscribe(i.Event.SUCCESS,this.bind__onSuccess),this.mcCmp.subscribe(i.Event.RESET,this.bind__onReset),this.mcCmp.subscribe(i.Event.ERROR,this.bind__onError),this.$filesList.find("span.edit-title").editable({toggle:"manual",unsavedclass:null,pk:function(){return $(this).data("mid")},url:function(t){return this.controller.edit(t.pk,{title:t.value})}.bind(this)});var a=t.get("subscriber");a.dispatch(s.TAG,"onViewLoaded",{view:this}),this.controller.model.subscribe(e.Event.CHANGE,function(t){var e=t.model.get(t.keyPath),n=this.$filesList.find('span.edit-title[data-mid="'+e.get("id")+'"]');n.html(e.get("title"))}.bind(this)),$tt._instances.push(this)};return s.TAG="MyFilesListView",s.Binder={TOGGLE_STYLE:".my-files-selector-toggle-style",FILES_LIST:".my-files-selector-files-list",FILE_BUTTON:".my-files-selector-file-button",STYLE_LIST:"list",STYLE_GRID:"grid"},s.MAX_PER_PAGE=24,s.MAX_PER_ROW=4,s.prototype._onClickBulkAction=function(t){switch(t.action){case 1:if(confirm(Translator.trans("filesGateway.deleteConfirmMessage"))){$.each(t.$selection,function(t,e){this.controller["delete"]($(e).data("mid"),!0);var n;n=$(e).parents(this.style==s.Binder.STYLE_LIST?"tr":"div.col-md-3"),n.fadeOut(1e3,function(){n.remove()}),$(e).prop("checked",!1)}.bind(this));var e=setInterval(function(){this.$filesList=this.$container.find(s.Binder.FILES_LIST),this.$fileButtons=this.$container.find(s.Binder.FILE_BUTTON);var t=$(this.$fileButtons).parent("div.thumbnail.tt-grid-div-body").parent();if(!$(t).is(":animated")&&(this.tblCmp.updateElements(this.$filesList),clearInterval(e),this.style==s.Binder.STYLE_GRID)){for(var n=$(t).parent(),i=$(this.$fileButtons).parent("div.thumbnail.tt-grid-div-body").length,o=1;i>o;o++)$(t[o]).parent().is($(t[o-1]).parent())||o%s.MAX_PER_ROW==0||$(t[o]).insertAfter($(t[o-1]));$.each($(n),function(t,e){0==$(e).children().length&&$(e).remove()})}}.bind(this),200)}}},s.prototype._onClickFile=function(t){t.stopPropagation();var e=this.controller.model.getMedia($(t.currentTarget).data("mid"));if(!e)throw new Error("media not found");o.render({media:this.controller.model.get("media"),activeMedia:e},function(t){this.galleryCmp=t.galleryComponent,this.galleryCmp.subscribe(o.Event.HIDDEN,function(t){this.galleryCmp.destroy()}.bind(this)),this.galleryCmp.show()}.bind(this))},s.prototype.getTableComponent=function(){return this.tblCmp},s.prototype._onAddGridElement=function(t,e){var n=$(e),i=$(this.$fileButtons).parent("div.thumbnail.tt-grid-div-body").length,o=$(this.$fileButtons).parent("div.thumbnail.tt-grid-div-body").parent();if(i>=s.MAX_PER_PAGE){n.insertBefore(o[0]);for(var r=s.MAX_PER_ROW-1;i>r;r+=s.MAX_PER_ROW)$(o[r]).insertBefore($(o[r+1]));$(o[i-1]).remove()}else if(i%s.MAX_PER_ROW==0){var a=$("<div class='row'></div>"),l=$(this.$filesList.children("div.tt-myFiles-grid-div")[0]);

if(0==i)l.empty(),a.append(n),l.append(a);else{n.insertBefore(o[0]);for(var r=s.MAX_PER_ROW-1;i>r;r+=s.MAX_PER_ROW)$(o[r]).insertBefore($(o[r+1]));l.append(a),a.append($(o[i-1]).detach())}}else{n.insertBefore(o[0]);for(var r=s.MAX_PER_ROW-1;i>r;r+=s.MAX_PER_ROW)$(o[r]).insertBefore($(o[r+1]))}n.find("button.edit-title").on("click",function(t){t.stopPropagation(),$(this).parent().parent().parent().find("span.edit-title").editable("toggle")}),n.find("span.edit-title").editable({toggle:"manual",unsavedclass:null,pk:function(){return $(this).data("mid")},url:function(t){return this.controller.edit(t.pk,{title:t.value})}.bind(this)}),n.find(".my-files-selector-file-click").not("[disabled]").on("click",this.bind__onClickFile),this.$filesList=this.$container.find(s.Binder.FILES_LIST),this.$fileButtons=this.$container.find(s.Binder.FILE_BUTTON),this.tblCmp.updateElements(this.$filesList)},s.prototype._onAddListElement=function(t,e){var n=$(e),i=$(this.$fileButtons).parent("tr").length,o=$(this.$fileButtons).parent("tr");i>=s.MAX_PER_PAGE?(n.insertBefore(o[0]),o[i-1].remove()):0==i?($(this.$filesList).find("div.table-responsive > div").remove(),o=$(this.$filesList).find("tbody > tr"),n.insertBefore(o[0]),$(o[0]).remove()):n.insertBefore(o[0]),n.find("button.edit-title").on("click",function(t){t.stopPropagation(),$(this).parent().parent().parent().find("span.edit-title").editable("toggle")}),n.find("span.edit-title").editable({toggle:"manual",unsavedclass:null,pk:function(){return $(this).data("mid")},url:function(t){return this.controller.edit(t.pk,{title:t.value})}.bind(this)}),n.find(".my-files-selector-file-click").not("[disabled]").on("click",this.bind__onClickFile),this.$filesList=this.$container.find(s.Binder.FILES_LIST),this.$fileButtons=this.$container.find(s.Binder.FILE_BUTTON),this.tblCmp.updateElements(this.$filesList)},s.prototype._onSuccess=function(t){console.log(t);var e=t.media[t.media.length-1].data;if(this.controller.model.addMedia(e),this.style==s.Binder.STYLE_GRID)dust.render("myFilesGridElement",{media:e,previewTitle:Translator.trans("filesGateway.previewLink"),editTitle:Translator.trans("form.media.title"),shareTitle:Translator.trans("filesGateway.shareLink"),shareUrl:Routing.generate("imdc_thread_new_from_media",{mediaId:e.id}),mediaIcon:r.getIconForMediaType(e.type)},this.bind__onAddGridElement);else{var n=r.formatSize(e.source_resource.meta_data.size),i=!1;0>n&&(i=!0),dust.render("myFilesListElement",{media:e,previewTitle:Translator.trans("filesGateway.previewLink"),editTitle:Translator.trans("form.media.title"),shareTitle:Translator.trans("filesGateway.shareLink"),shareUrl:Routing.generate("imdc_thread_new_from_media",{mediaId:e.id}),mediaIcon:r.getIconForMediaType(e.type),timeUploaded:dust.filters.date(e.source_resource.meta_data.time_created),spinner:i,formattedSize:n},this.bind__onAddListElement)}},s.prototype._onError=function(t){alert("Error: "+t.error)},s}),define("views/post/newView",["model/model","component/mediaChooserComponent"],function(t,e){var n=function(i,o){this.controller=i,this.options=o,this.bind__onClickSubmit=this._onClickSubmit.bind(this),this.bind__onClickReset=this._onClickReset.bind(this),this.bind__onClickCancel=this._onClickCancel.bind(this),this.bind__onUploadStart=this._onUploadStart.bind(this),this.bind__onSuccess=this._onSuccess.bind(this),this.bind__onSuccessAndPost=this._onSuccessAndPost.bind(this),this.bind__onReset=this._onReset.bind(this),this.bind__onModelChange=this._onModelChange.bind(this),this.bind__onError=this._onError.bind(this),this.$container=$(n.Binder.CONTAINER+'[data-pid="'+this.controller.model.get("id")+'"]'),this.$form=this.$container.find("form[name^="+n.FORM_NAME+"]"),this.$submit=this.$container.find(n.Binder.SUBMIT),this.$reset=this.$container.find(n.Binder.RESET),this.$cancel=this.$container.find(n.Binder.CANCEL),this.$submit.on("click",this.bind__onClickSubmit),this.$reset.on("click",this.bind__onClickReset),this.$cancel.on("click",this.bind__onClickCancel),this.mcCmp=e.render(this.$form,{enableDoneAndPost:!0}),this.mcCmp.subscribe(e.Event.UPLOAD_START,this.bind__onUploadStart),this.mcCmp.subscribe(e.Event.SUCCESS,this.bind__onSuccess),this.mcCmp.subscribe(e.Event.SUCCESS_AND_POST,this.bind__onSuccessAndPost),this.mcCmp.subscribe(e.Event.RESET,this.bind__onReset),this.mcCmp.subscribe(e.Event.ERROR,this.bind__onError),this.controller.model.subscribe(t.Event.CHANGE,this.bind__onModelChange),$tt._instances.push(this)};return n.TAG="PostNewView",n.Binder={CONTAINER:".post-container",SUBMIT:".post-submit-new",RESET:".post-reset",CANCEL:".post-cancel-new"},n.FORM_NAME="post",n.prototype.loadView=function(){var t=[];this._getFormField("attachedFile").children().each(function(e,n){t.push($(n).val())}),t.length>0&&(this._toggleForm(!0),this.mcCmp.setMedia(t))},n.prototype._getFormField=function(t){return this.$form.find("#"+n.FORM_NAME+"_"+t)},n.prototype._toggleForm=function(t){this.$submit.button(t?"loading":"reset"),this.$reset.attr("disabled",t),this.$cancel.attr("disabled",t)},n.prototype._preSubmit=function(){return""==this._getFormField("content").val()&&0==this.mcCmp.media.length?(alert("Your post cannot be blank. You must either select a file or write a comment."),!1):(this._toggleForm(!0),!0)},n.prototype._reset=function(){this.mcCmp.reset(),this._getFormField("startTime").val(this.controller.model.get("keyPoint.startTime")),this._getFormField("endTime").val(this.controller.model.get("keyPoint.endTime")),this._getFormField("content").val(""),this.controller.editKeyPoint({cancel:!0})},n.prototype._destroy=function(){this.$container.remove(),this.controller.removeKeyPoint(),this.controller.removeFromThread()},n.prototype._onClickSubmit=function(t){t.preventDefault(),this._preSubmit()&&this.controller.post(this.$form[0]).done(function(t){this.controller.addToThread(t.post),this.options.is_permanent?(this._reset(),this._toggleForm(!1)):this._destroy()}.bind(this)).fail(function(t){this.controller.updateInThread("new")}.bind(this))},n.prototype._onClickReset=function(t){t.preventDefault(),this._reset()},n.prototype._onClickCancel=function(t){t.preventDefault(),this._destroy()},n.prototype._onSelectionTimes=function(t,e){this._getFormField("startTime").val(t),this._getFormField("endTime").val(e)},n.prototype._onModelChange=function(t){this._onSelectionTimes(t.model.get("keyPoint.selection.startTime",""),t.model.get("keyPoint.selection.endTime",""))},n.prototype._updateForm=function(){var t=this._getFormField("attachedFile");t.html(this.mcCmp.generateFormData(t.data("prototype")))},n.prototype._onUploadStart=function(t){this.$submit.attr("disabled",!0)},n.prototype._onSuccess=function(t){this._updateForm(),this.$submit.attr("disabled",!1),this._toggleForm(!1)},n.prototype._onSuccessAndPost=function(t){this._updateForm(),this.$submit.trigger("click")},n.prototype._onReset=function(t){this._updateForm()},n.prototype._onError=function(t){alert("Error: "+t.error)},n}),define("views/post/editView",["views/post/newView"],function(t){var e=function(n,i){t.prototype.constructor.apply(this,arguments),this.bind__onClickSubmit=this._onClickSubmit.bind(this),this.bind__onClickCancel=this._onClickCancel.bind(this),this.$submit=this.$container.find(e.Binder.SUBMIT),this.$cancel=this.$container.find(e.Binder.CANCEL),this.$submit.on("click",this.bind__onClickSubmit),this.$cancel.on("click",this.bind__onClickCancel)};return e.extend(t),e.TAG="PostEditView",e.Binder.SUBMIT=".post-submit-edit",e.Binder.CANCEL=".post-cancel-edit",e.prototype._toggleForm=function(t){this.$submit.button(t?"loading":"reset"),this.$cancel.attr("disabled",t)},e.prototype._onClickSubmit=function(t){t.preventDefault(),this._preSubmit()&&this.controller.put(this.$form[0]).done(function(t){this.controller.updateInThread("view"),this.controller.model.get("is_temporal",!1)&&this.controller.editKeyPoint({cancel:!0})}.bind(this)).fail(function(t){this.controller.updateInThread("edit")}.bind(this))},e.prototype._onClickCancel=function(t){t.preventDefault(),this.controller.get().done(function(t){this.controller.updateInThread("view"),this.controller.model.get("is_temporal",!1)&&this.controller.editKeyPoint({cancel:!0})}.bind(this)).fail(function(t){})},e}),define("views/post/viewView",["model/model","component/galleryComponent"],function(t,e){var n=function(i,o){this.controller=i,this.bind__onClickHoverKeyPoint=this._onClickHoverKeyPoint.bind(this),this.bind__onClickNew=this._onClickNew.bind(this),this.bind__onClickEdit=this._onClickEdit.bind(this),this.bind__onClickDelete=this._onClickDelete.bind(this),this.bind__onModelChange=this._onModelChange.bind(this),this.$container=$(n.Binder.CONTAINER+'[data-pid="'+this.controller.model.get("id")+'"]'),this.$timelineKeyPoint=this.$container.find(n.Binder.TIMELINE_KEYPOINT),this.$gallery=this.$container.find(n.Binder.GALLERY),this.$new=this.$container.find(n.Binder.NEW),this.$edit=this.$container.find(n.Binder.EDIT),this.$deleteModal=this.$container.find(n.Binder.DELETE_MODAL),this.$delete=this.$container.find(n.Binder.DELETE),this.$timelineKeyPoint.on("click",this.bind__onClickHoverKeyPoint),this.$timelineKeyPoint.on("dblclick",this.bind__onClickHoverKeyPoint),this.$timelineKeyPoint.hover(this.bind__onClickHoverKeyPoint,this.bind__onClickHoverKeyPoint),this.$new.on("click",this.bind__onClickNew),this.$edit.on("click",this.bind__onClickEdit),this.$delete.on("click",this.bind__onClickDelete),this.controller.model.subscribe(t.Event.CHANGE,this.bind__onModelChange);var r=this.controller.model.get("ordered_media");r&&r.length>0&&e.render({$container:this.$gallery,mode:e.Mode.INLINE,media:r},function(t){this.galleryCmp=t.galleryComponent,this.galleryCmp.show()}.bind(this)),$tt._instances.push(this)};return n.TAG="PostViewView",n.Binder={CONTAINER:".post-container",TIMELINE_KEYPOINT:".post-timeline-keypoint",GALLERY:".post-gallery",NEW:".post-new",EDIT:".post-edit",DELETE_MODAL:".post-delete-modal",DELETE:".post-delete"},n.prototype._onClickHoverKeyPoint=function(t){switch(t.type){case"mouseenter":case"mouseleave":this.controller.hoverKeyPoint({isMouseOver:"mouseenter"==t.type});break;case"click":case"dblclick":t.preventDefault(),this.controller.clickKeyPoint({isDblClick:"dblclick"==t.type})}},n.prototype._onClickNew=function(t){t.preventDefault(),this.$new.hide(),this.controller["new"](null).done(function(t){this.controller.addToThread(t.post)}.bind(this)).fail(function(t){this.$new.show()}.bind(this))},n.prototype._onClickEdit=function(t){t.preventDefault(),this.controller.edit().done(function(t){this.controller.updateInThread("edit"),this.controller.model.get("is_temporal",!1)&&this.controller.editKeyPoint({cancel:!1})}.bind(this)).fail(function(t){})},n.prototype._onClickDelete=function(t){t.preventDefault(),this.$delete.button("loading"),this.controller["delete"]().done(function(t){this.$deleteModal.find(".modal-body").html("Post deleted successfully."),this.$deleteModal.data("bs.modal").isShown?(this.$deleteModal.on("hidden.bs.modal",function(t){this.controller.removeFromThread()}.bind(this)),this.$deleteModal.modal("hide")):this.controller.removeFromThread()}.bind(this)).fail(function(t){this.$container.find(".modal-body").prepend("Something went wrong. Try again."),this.$delete.button("reset")}.bind(this))},n.prototype._renderKeyPoint=function(t,e,i){console.log("%s: %s",n.TAG,"_renderKeyPoint");var o=(100*t/i).toFixed(2),r=(100*e/i).toFixed(2),s=(r-o).toFixed(2);this.$timelineKeyPoint.css({left:o+"%",width:s+"%"})},n.prototype._hoverKeyPoint=function(t){t?this.$container.addClass("tt-post-container-highlight"):this.$container.removeClass("tt-post-container-highlight")},n.prototype._clickKeyPoint=function(t){var e=this.$container.find("video")[0];e&&t&&(e.currentTime=0,e.play())},n.prototype._onModelChange=function(t){this._renderKeyPoint(t.model.get("keyPoint.startTime",""),t.model.get("keyPoint.endTime",""),t.model.get("keyPoint.videoDuration","")),this._hoverKeyPoint(t.model.get("keyPoint.isPlayerHovering",!1)),this._clickKeyPoint(t.model.get("keyPoint.isPlayerPlaying",!1)),this.$new.show()},n}),define("views/profile/editView",[],function(){var t=function(e,n){this.controller=e,this.bind__onClickAddLanguage=this._onClickAddLanguage.bind(this),this.bind__onClickDeleteLanguage=this._onClickDeleteLanguage.bind(this),this.$container=n.container,this.$addLang=this.$container.find(t.Binder.ADD_LANGUAGE),this.$delLang=this.$container.find(t.Binder.DELETE_LANGUAGE),this.$addLang.on("click",this.bind__onClickAddLanguage),this.$delLang.on("click",this.bind__onClickDeleteLanguage),$tt._instances.push(this)};return t.TAG="ProfileEditView",t.Binder={ADD_LANGUAGE:".profile-add-lang",DELETE_LANGUAGE:".profile-del-lang"},t.prototype._onClickAddLanguage=function(t){t.preventDefault();var e,n=$("#foss_user_profile_form_languages"),i=n.data("delete-language-text"),o=n.data("prototype"),r=$("#foss_user_profile_form_languages > li").length;$("#no-languages").remove(),e=$('<button class="btn btn-danger btn-sm profile-del-lang"></a>').html(i),e.on("click",this.bind__onClickDeleteLanguage),o=o.replace(/__name__/g,r),r++;var s=$("<li></li>").html(o);s.append(e),$("#foss_user_profile_form_languages").append(s)},t.prototype._onClickDeleteLanguage=function(t){t.preventDefault();var e=$("#foss_user_profile_form_languages"),n=e.data("no-languages-text"),i=$('<span id="no-languages"></span>').html(n);$(t.target).parent().remove(),0==$("#foss_user_profile_form_languages > li").length&&$("#foss_user_profile_form_languages").append(i)},t}),define("views/thread/newView",["component/mediaChooserComponent","component/accessTypeComponent"],function(t,e){var n=function(i,o){this.controller=i,this.bind__onSubmitForm=this._onSubmitForm.bind(this),this.bind__onUploadStart=this._onUploadStart.bind(this),this.bind__onSuccess=this._onSuccess.bind(this),this.bind__onRemove=this._onRemove.bind(this),this.bind__onReset=this._onReset.bind(this),this.bind__onError=this._onError.bind(this),this.$container=o.container,this.$form=this.$container.find("form[name^="+n.FORM_NAME+"]"),this.$submit=this.$container.find(n.Binder.SUBMIT),this.$form.on("submit",this.bind__onSubmitForm),this.atCmp=e.render(this.$form),this.mcCmp=t.render(this.$form),this.mcCmp.subscribe(t.Event.UPLOAD_START,this.bind__onUploadStart),this.mcCmp.subscribe(t.Event.SUCCESS,this.bind__onSuccess),this.mcCmp.subscribe(t.Event.REMOVE,this.bind__onRemove),this.mcCmp.subscribe(t.Event.RESET,this.bind__onReset),this.mcCmp.subscribe(t.Event.ERROR,this.bind__onError);var r=[];this._getFormField("mediaIncluded").children().each(function(t,e){r.push($(e).val())}),r.length>0&&(this.$submit.attr("disabled",!0),this.mcCmp.setMedia(r)),$tt._instances.push(this)};return n.TAG="ThreadNewView",n.Binder={SUBMIT:".thread-submit"},n.FORM_NAME="thread",n.prototype._getFormField=function(t){return this.$form.find("#"+n.FORM_NAME+"_"+t)},n.prototype._onSubmitForm=function(t){this.$form[0].checkValidity()&&this.$submit.button("loading")},n.prototype._updateForm=function(){var t=this._getFormField("mediaIncluded");t.html(this.mcCmp.generateFormData(t.data("prototype"))),t=this._getFormField("title"),t.attr("required",0==this.mcCmp.media.length),t=t.parent().find("label"),0==this.mcCmp.media.length?t.addClass("required"):t.removeClass("required")},n.prototype._onUploadStart=function(t){this.$submit.attr("disabled",!0)},n.prototype._onSuccess=function(t){this._updateForm(),this.$submit.attr("disabled",!1)},n.prototype._onRemove=function(t){this._updateForm()},n.prototype._onReset=function(t){this._updateForm()},n.prototype._onError=function(t){alert("Error: "+t.error)},n}),define("views/thread/editView",["views/thread/newView"],function(t){var e=function(n,i){t.prototype.constructor.apply(this,arguments),this.bind__onClickDelete=this._onClickDelete.bind(this),this.$deleteModal=this.$container.find(e.Binder.DELETE_MODAL),this.$delete=this.$container.find(e.Binder.DELETE),this.$delete.on("click",this.bind__onClickDelete)};return e.extend(t),e.TAG="ThreadEditView",e.Binder.DELETE_MODAL=".thread-delete-modal",e.Binder.DELETE=".thread-delete",e.prototype._onClickDelete=function(t){t.preventDefault(),this.$delete.button("loading"),this.controller["delete"]().done(function(t){this.$deleteModal.find(".modal-body").html("Topic deleted successfully.")}.bind(this)).fail(function(){this.$container.find(".modal-body").prepend("Something went wrong. Try again."),this.$delete.button("reset")}.bind(this))},e}),define("views/thread/viewView",["model/model","core/helper","bootstrap"],function(t,e,n){var i=function(e,n){this.controller=e,this.options=n,this.player=null,this.playingKeyPoint=null,this.bind__onClickVideoSpeed=this._onClickVideoSpeed.bind(this),this.bind__onClickClosedCaptions=this._onClickClosedCaptions.bind(this),this.bind__onAreaSelectionChanged=this._onAreaSelectionChanged.bind(this),this.bind__onMouseOverKeyPoint=this._onMouseOverKeyPoint.bind(this),this.bind__onMouseOutKeyPoint=this._onMouseOutKeyPoint.bind(this),this.bind__onRightClickKeyPoint=this._onRightClickKeyPoint.bind(this),this.bind__onEndKeyPoint=this._onEndKeyPoint.bind(this),this.bind__onPlaybackStarted=this._onPlaybackStarted.bind(this),this.bind__onPlaybackStopped=this._onPlaybackStopped.bind(this),this.bind__onSeek=this._onSeek.bind(this),this.bind__onModelChange=this._onModelChange.bind(this),this.$container=n.container,this.$opContainer=n.op_container,this.$postContainer=n.post_container;var o=this.$opContainer.find(i.Binder.MEDIA_ELEMENT+" video");if(this.$video=o.eq(2==o.length?1:0),this.$pipVideo=o.eq(2==o.length?0:1),$("#videoSpeed").on("click",this.bind__onClickVideoSpeed),$("#closedCaptions").on("click",this.bind__onClickClosedCaptions),1===this.controller.model.get("type")&&this.controller.model.get("ordered_media").length>0){this.$video.on("loadedmetadata",function(t){this.controller.updateKeyPointDuration(t.target.duration)}.bind(this)),this._createPlayer();var r=this.controller.model.get("ordered_media.0");r&&r.is_interpretation&&(this.$pipVideo[0].currentTime=r.source_start_time)}this.controller.model.subscribe(t.Event.CHANGE,this.bind__onModelChange),$tt._instances.push(this)};return i.TAG="ThreadViewView",i.DEFAULT_TEMPORAL_COMMENT_LENGTH=3,i.Binder={MEDIA_ELEMENT:".thread-media-element"},i.prototype.loadView=function(){var t=[];_.each(this.controller.model.get("posts"),function(e,n,i){t.push(e.data)}),t=_.filter(t,function(t){return t.id>0}),dust.render("thread_view_posts",{posts:t},function(t,e){this.$postContainer.html(e),_.each(this.controller.model.get("posts"),function(t,e,i){t.get("id")<0?n(t,"post","post/new",{is_permanent:!0}):n(t,"post","post/view",{})}),$(window).trigger("resize")}.bind(this))},i.prototype._createPlayer=function(){console.log("%s: %s",i.TAG,"_createPlayer"),this.player=new Player(this.$video,{areaSelectionEnabled:!1,updateTimeType:Player.DENSITY_BAR_UPDATE_TYPE_ABSOLUTE,audioBar:!1,overlayControls:!0,playHeadImage:this.options.player.playHeadImage,playHeadImageOnClick:function(){var t=this.player.getCurrentTime(),e=new KeyPoint(-1,t,t+i.DEFAULT_TEMPORAL_COMMENT_LENGTH,"",{drawOnTimeLine:!0});this._toggleTemporal(!1,e)}.bind(this)}),$(this.player).on(Player.EVENT_AREA_SELECTION_CHANGED,this.bind__onAreaSelectionChanged),$(this.player).on(Player.EVENT_KEYPOINT_MOUSE_OVER,this.bind__onMouseOverKeyPoint),$(this.player).on(Player.EVENT_KEYPOINT_MOUSE_OUT,this.bind__onMouseOutKeyPoint),$(this.player).on(Player.EVENT_KEYPOINT_RIGHT_CLICK,this.bind__onRightClickKeyPoint),$(this.player).on(Player.EVENT_KEYPOINT_END,this.bind__onEndKeyPoint),$(this.player).on(Player.EVENT_PLAYBACK_STARTED,this.bind__onPlaybackStarted),$(this.player).on(Player.EVENT_PLAYBACK_STOPPED,this.bind__onPlaybackStopped),$(this.player).on(Player.EVENT_SEEK,this.bind__onSeek),this.player.createControls()},i.prototype._onAreaSelectionChanged=function(t){console.log("%s: %s",i.TAG,Player.EVENT_AREA_SELECTION_CHANGED),this.controller.updateKeyPointSelectionTimes(this.player.getAreaSelectionTimes())},i.prototype._onMouseOverKeyPoint=function(t,e,n){console.log("%s: %s- keyPoint=%o, coords=%o",i.TAG,Player.EVENT_KEYPOINT_MOUSE_OVER,e,n),this.controller.hoverKeyPoint(e.id,{isMouseOver:!0}),this.$postContainer.is(":animated")||this.$postContainer.animate({scrollTop:$(".post-container[data-pid="+e.id+"]").position().top})},i.prototype._onMouseOutKeyPoint=function(t,e){console.log("%s: %s- keyPoint=%o",i.TAG,Player.EVENT_KEYPOINT_MOUSE_OUT,e),this.controller.hoverKeyPoint(e.id,{isMouseOver:!1})},i.prototype._onRightClickKeyPoint=function(t,e,n){console.log("%s: %s- keyPoint=%o, coords=%o",i.TAG,Player.EVENT_KEYPOINT_RIGHT_CLICK,e,n),this.controller.rightClickKeyPoint(e.id)},i.prototype._onEndKeyPoint=function(t,e){console.log("%s: %s- keyPoint=%o",i.TAG,Player.EVENT_KEYPOINT_END,e),this.playingKeyPoint&&this.playingKeyPoint.id==e.id&&this.player.pause()},i.prototype._onPlaybackStarted=function(t){console.log("%s: %s",i.TAG,Player.EVENT_PLAYBACK_STARTED),0!=this.$pipVideo.length&&this.$pipVideo[0].play()},i.prototype._onPlaybackStopped=function(t){console.log("%s: %s",i.TAG,Player.EVENT_PLAYBACK_STOPPED),0!=this.$pipVideo.length&&this.$pipVideo[0].pause()},i.prototype._onSeek=function(t,e){console.log("%s: %s- time=%s",i.TAG,Player.EVENT_SEEK,e),0!=this.$pipVideo.length&&(this.$pipVideo[0].currentTime=Math.min(this.player.getCurrentTime()+this.controller.model.get("ordered_media.0.source_start_time"),this.$pipVideo[0].duration))},i.prototype._toggleTemporal=function(t,e){this.player.pause(),this.playingKeyPoint=null,!t&&e?(this.player.setPlayHeadImage(""),this.player.seek(e.startTime),this.player.setAreaSelectionStartTime(e.startTime),this.player.setAreaSelectionEndTime(e.endTime),this.player.setAreaSelectionEnabled(!0)):(this.player.setPlayHeadImage(this.options.player.playHeadImage),this.player.setAreaSelectionEnabled(!1))},i.prototype._onModelChange=function(t){if(0==t.keyPath.indexOf("posts.")&&t.view){var i=t.model.get(t.keyPath);if("new"==t.view&&dust.render("post_new",i.data,function(t,o){var r=this.$container.find('.post-container[data-pid="'+i.get("id")+'"]');if(r.length>0)r.replaceWith(o),r=this.$container.find('.post-container[data-pid="'+i.get("id")+'"]');else{var r=this.$postContainer.find('.post-container[data-pid="'+i.get("parent_post_id")+'"]');r.after(o)}e.autoSize(),n(i,"post","post/new",{is_permanent:$.contains(this.$opContainer[0],r[0])}),$(window).trigger("resize")}.bind(this)),"edit"==t.view&&dust.render("post_edit",i.data,function(t,o){var r=this.$postContainer.find('.post-container[data-pid="'+i.get("id")+'"]');r.replaceWith(o),e.autoSize(),n(i,"post","post/edit",{}),$(window).trigger("resize")}.bind(this)),"view"==t.view){var o=this.$postContainer.find(".post-container[data-pid]"),r=0==o.length?"thread_view_posts":"post_view",s="thread_view_posts"==r?{posts:[i.data]}:i.data;dust.render(r,s,function(e,s){if("thread_view_posts"==r)this.$postContainer.html(s);else if(t.isNew)if(i.get("is_post_reply")){var a=i.get("parent_post_id");l=o.filter('[data-ppid="'+a+'"]'),0==l.length&&(l=o.filter('[data-pid="'+a+'"]')),l.last().after(s)}else o.last().after(s);else{var l=this.$postContainer.find('.post-container[data-pid="'+i.get("id")+'"]');l.replaceWith(s)}n(i,"post","post/view",{}),$(window).trigger("resize")}.bind(this))}}if("posts"==t.keyPath){var o=this.$postContainer.find(".post-container[data-pid]"),a=[],l=[];_.each(t.model.get("posts"),function(t,e,n){a.push(t.get("id"))}),l=_.filter(o,function(t){var e=parseInt($(t).data("pid"),10);return e>0&&!_.contains(a,e)}),_.each(l,function(t,e,n){var i=$(t);i.fadeOut("slow",function(t){i.remove(),o.length==l.length&&(e==o.length-1?dust.render("thread_view_posts",{},function(t,e){this.$postContainer.html(e),$(window).trigger("resize")}.bind(this)):$(window).trigger("resize"))}.bind(this))}.bind(this))}if(this.player&&(this.player.setKeyPoints(t.model.get("keyPoints",[])),this.controller.updateKeyPointDuration(this.$video[0].duration),0==t.keyPath.indexOf("keyPoints."))){var d=t.model.get(t.keyPath.substr(0,t.keyPath.lastIndexOf(".")));d instanceof KeyPoint&&(d.isEditing?this._toggleTemporal(!(d.startTime&&d.endTime),d):this._toggleTemporal(!0),d.isSeeking&&(d.paintHighlightedTimeout=!0,d.paintHighlighted=!0,this.player.seek(d.startTime),this.player.redrawKeyPoints=!0,setTimeout(function(){d.paintHighlightedTimeout=!1,d.paintHighlighted=!1,this.player.redrawKeyPoints=!0,this.player.repaint()}.bind(this),3e3)),d.isPlaying?(this.playingKeyPoint=d,this.player.seek(d.startTime),this.player.play()):d.isHovering?(d.paintHighlighted=!0,this.player.redrawKeyPoints=!0):d.paintHighlightedTimeout||(d.paintHighlighted=!1,this.player.redrawKeyPoints=!0),this.player.repaint())}},i.prototype._onClickVideoSpeed=function(t){t.preventDefault();var e=this.controller.adjustVideoSpeed();this.$video[0].playbackRate=e.value,0!=this.$pipVideo.length&&(this.$pipVideo[0].playbackRate=e.value),$(t.target).attr("src",e.image)},i.prototype._onClickClosedCaptions=function(t){t.preventDefault();var e=$("#closed-caption-button img").attr("src");e=e==this.options.player.captionImages.on?this.options.player.captionImages.off:this.options.player.captionImages.on,$("#closed-caption-button img").attr("src",e)},i}),define("main",["bootstrap","service","core/dust","core/helper","core/subscriber","factory/contactFactory","factory/forumFactory","factory/groupFactory","factory/mediaFactory","factory/messageFactory","factory/myFilesFactory","factory/postFactory","factory/threadFactory","service/keyPointService","service/rabbitmqWebStompService","service/subscriberService","service/threadPostService","model/forumModel","model/groupModel","model/mediaModel","model/messageModel","model/myFilesModel","model/postModel","model/profileModel","model/threadModel","model/userModel","controller/contactController","controller/forumController","controller/groupController","controller/homeController","controller/messageController","controller/myFilesController","controller/postController","controller/profileController","controller/threadController","component/accessTypeComponent","component/galleryComponent","component/mediaChooserComponent","component/myFilesSelectorComponent","component/recorderComponent","component/tableComponent","views/contact/listView","views/forum/newView","views/forum/editView","views/forum/listView","views/forum/viewView","views/group/newView","views/group/editView","views/group/listView","views/group/viewView","views/group/manageView","views/home/indexView","views/message/newView","views/message/replyView","views/message/viewView","views/myFiles/listView","views/post/newView","views/post/editView","views/post/viewView","views/profile/editView","views/thread/newView","views/thread/editView","views/thread/viewView"],function(){var t={};t._services=[],t._instances=[],window.TerpTube=t,window.$tt=window.TerpTube;var e=require("core/dust"),n=require("core/helper");e.inject(),n.autoSize()}),require(["main"]);