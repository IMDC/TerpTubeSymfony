{% extends "IMDCTerpTubeBundle:MyFilesGateway:previewMotionMedia.html.twig" %}
{% trans_default_domain 'IMDCTerpTubeBundle' %}

{% block motionMedia %}
<video	class="preview"  width="100%" id="record" preload="auto" autoplay muted>
</video>
<script type='text/javascript'>
 $(document).ready(function() {
	 var videoElement = $("#record");
	 var recorderConfiguration = {{ recorderConfiguration |json_encode()|raw}};
	 console.log(recorderConfiguration);
	 var player = new Player(videoElement,recorderConfiguration);
	 
	 player.options.areaSelectionEnabled = false;
	 player.options.updateTimeType = Player.DENSITY_BAR_UPDATE_TYPE_ABSOLUTE;
	 player.options.type = Player.DENSITY_BAR_TYPE_RECORDER;
	 player.options.backButton = false;
	 //player.options.forwardButton = false;
	 player.options.audioBar = false;
	 player.options.volumeControl = false;
	 player.options.recordingErrorFunction = function(e)
	 {
		 console.log('Reeeejected!', e);
	 }
	 player.options.recordingSuccessFunction = function(data)
	 {
		 console.log(recorderConfiguration);
		 var fn = window[recorderConfiguration.recordingSuccessFunction];
		 fn(data);
		 console.log('Success!', data);
	 }
	 player.options.forwardFunction = function(data)
	 {
		 player.destroyRecorder();
		 console.log(recorderConfiguration);
		 var fn = window[recorderConfiguration.forwardFunction]||null;
		 fn(data);
		 console.log('Success!', data);
	 }
	 player.options.recordingPostURL = "{{ path('imdc_files_gateway_record') }}";
	 //player.options.backFunction= function(){if (confirm("This will delete your current recording. Are you sure?")) {goBack('<?php echo $postType ?>');}};
	 //player.options.forwardFunction = function (){transcodeAjax('<?php echo basename($video) ?>', '<?php echo basename(
		//	$outputVideoFile)
			//																						 ?>', <?php echo $keepVideoFile ?>, controls);};
	 
	 // player.options.playHeadImage = "images/feedback_icons/round_plus.png";
	 // player.options.playHeadImageOnClick = function(){ alert("plus");};

	 player.createControls();
	 videoElement.parents(".ui-dialog").on("dialogbeforeclose", function(event, ui) 
		 {
		 if (player !=null)
		 	player.destroyRecorder();
		 });
 });

  </script>

{% endblock motionMedia %}

 