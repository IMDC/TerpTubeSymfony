{% extends "IMDCTerpTubeBundle:Default:basetemplate.html.twig" %}
{% block stylesheets %}
    {{  parent() }}
    <link href="{{ asset('bundles/imdcterptube/css/thread.css') }}" rel="stylesheet" />
{% endblock stylesheets %}

{% block sidebarlinks_pages %}<li class="active">{% endblock %}

{% block title %}{{ thread.title|truncate(50) }}{% endblock title %}

{% block herounit_wrap %}<h1>{{thread.title|truncate(30) }}</h1>{% endblock herounit_wrap %}

{% block underherounitrow1 %}

<div class="row-fluid">
    <div class="span6" id="leftsidecontent">
    <!-- left side content -->
    <div class="row-fluid text-center" id="mediaFileWrap">
{% if thread.mediaIncluded|length != 0 %}
    {% set mediaFile = thread.mediaIncluded[0] %}
{% endif %}
    
{# mediatype 0 = image 1 = video 2 = audio 9 = other #}
{% if mediaFile is not defined %}
    </div> <!-- /mediaFileWrap -->
{% elseif mediaFile.type == 0 %}
{# -----------   if type of media is an IMAGE   -------- #}
    <img src="{{ asset(mediaFile.getResource.getWebPath) }}" />
    </div> <!-- /mediaFileWrap div -->
{# -----------   if type of media is a VIDEO   -------- #}
{% elseif mediaFile.type == 1 %}
        <video class="preview" width="100%" id="{{ mediaFile.getID }}" preload="auto">
        	<source src="{{ asset(mediaFile.getResource.getWebPathWebm) }}"/>
        	<source src="{{ asset(mediaFile.getResource.getWebPath) }}"/>
        </video>
    </div> <!-- /mediaFileWrap div -->
    <script type='text/javascript'> 
     var player = new Player($("#{{ mediaFile.getID }}"));
     player.options.areaSelectionEnabled = false;
     player.options.updateTimeType = Player.DENSITY_BAR_UPDATE_TYPE_RELATIVE;
     player.options.backButton = false;
     player.options.forwardButton = false;
     player.options.audioBar = false;
     // player.options.backFunction= function(){if (confirm("This will delete your current recording. Are you sure?")) {goBack('<?php echo $postType?>');}};
     // player.options.forwardFunction = function (){transcodeAjax('<?php echo basename($video) ?>', '<?php echo basename($outputVideoFile) ?>', <?php echo $keepVideoFile ?>, controls);};
     
     //player.options.playHeadImage = "images/feedback_icons/round_plus.png";
     player.options.playHeadImage = "{{ asset('bundles/imdcterptube/img/player/add.png') }}";
     // player.options.playHeadImageOnClick = function(){ alert("plus");};
    
     player.createControls();
     </script>
{% elseif mediaFile.type == 2 %}
{# -----------   if type of media is AUDIO   -------- #}
        <audio controls style="width: 100%">
            <source src="{{ asset(mediaFile.getResource.getWebPath) }}" />
            Your browser does not support the audio element, please upgrade to Google Chrome
        </audio>
    </div> <!-- /mediaFileWrap div -->
{% endif %}
       <div class="row-fluid">
           <div class="span12" id="maincontent">
               {{ thread.content }}
               Media ID: 
               {%  for m in thread.mediaIncluded %}
                   Media id: {{ m.getId }}
               {% endfor %}
           </div>
        </div>
        <div class="row-fluid" id="thread-creator-details">
            <div class="span12">
               <div class="row-fluid">
                   <div class="span2" id="avatar-wrap">
                       <a href="{{ path('imdc_terp_tube_user_profile_specific', {'userName':thread.creator.getUserName()} ) }}"><img class="avatar" alt="avatar" title="" src="{{ thread.creator.getProfile().avatar ? asset(thread.creator.getProfile().avatar.getResource.getWebPath):asset('bundles/imdcterptube/img/no_avatar.jpg')}}" /></a>
                   </div>
                   <div class="span10" id="thread-creator-info-wrap">
                       <a href="{{ path('imdc_terp_tube_user_profile_specific', {'userName':thread.creator.getUserName()} ) }}">{{ thread.creator.getUserName() }}</a>
                       <p>
                            <ul class="unstyled inline thread-creator-tools-wrap">
                                <li><a href="{{ path('imdc_message_user_specific', {'userName':thread.creator.getUserName()}) }}"><i class="icon-envelope"></i></a></li>
                                <li><a href="#"><i class="icon-heart"></i></a></li>
                           </ul>
                       </p>    
                       <p>Joined: {{ thread.creator.getJoinDate()|date('M j Y') }}</p>
                       <p>Posts: {{ thread.creator.getPostCount() }}</p>
                   </div>
               </div>
           </div>
       </div> <!-- end of user-deets -->
   </div> <!-- end of leftsidecontent -->
    <div class="span6" id="rightsidecontent">
    <!-- right side content -->
    {# --------- post reply form --------------- #}
      <div class="row-fluid" id="reply-container">
           <div class="span12">
               <p>
                   <a class="btn btn-info" href="{{ path('imdc_thread_create_reply_post', {'threadid':thread.id}) }}"><i class="icon-plus"></i> Reply</a>
               </p>
           </div>
       </div> <!-- end of reply-container -->
       
    {# --------- end of post reply form -------- #}
       
        {% if threadposts|length > 0 %}
            {% for post in threadposts %}
            <p>
            <div class="row-fluid post-reply-wrap">
                <div class="span1 post-reply-user-info-wrap">
                    <div class="row-fluid post-reply-user-avatar-wrap">
                        <img class="avatar" alt="avatar" title="" src="{{ post.author.getProfile.avatar ? asset(post.author.getProfile.avatar.getResource.getWebPath):asset('bundles/imdcterptube/img/no_avatar.jpg')}}" />
                    </div>
                    <div class="row-fluid text-center post-reply-user-info">
                        {{ post.author }}
                    </div>
                </div> <!-- /post-reply-user-info-wrap div -->
                <div class="span10 post-reply-avatar-content-wrap" id="post-{{ post.id }}" data-pid="{{ post.id }}">
                    <div class="row-fluid post-reply-date">
                        {{ post.created|date('o-m-N H:i') }}
                    </div>
                    <div class="row-fluid post-reply-content">
                        {{ post.content }}
                    </div>
                </div> <!-- /post-reply-avatar-content-wrap div -->
                <div class="span1">
                    
                </div>       
            </div>
            </p>
            {% endfor %}
        {% else %}
            <div class="span12">
                No posts yet!
            </div>
        {% endif %}

   </div>
</div>

{% endblock underherounitrow1 %}
{% block underherounitrow2 %}
{% endblock underherounitrow2 %}


{% block javascripts %}
    {{ parent() }}
    
{% endblock javascripts %}