{% extends "IMDCTerpTubeBundle:Default:basetemplate.html.twig" %}
{% block stylesheets %}
    {{  parent() }}
    <link href="{{ asset('bundles/imdcterptube/css/thread.css') }}" rel="stylesheet" />
{% endblock stylesheets %}

{% block sidebarlinks_pages %}<li class="active">{% endblock %}

{% block title %}{{ thread.title|truncate(50) }}{% endblock title %}

{% block herounit_wrap %}<h1>{{thread.title|truncate(30) }}</h1>{% endblock herounit_wrap %}

{% block underherounitrow1 %}

<div class="row-fluid" id="thread-container">
    <div class="span6" id="leftsidecontent">
    <!-- left side content -->
    <div class="row-fluid text-center" id="mediaFileWrap">
{% if thread.mediaIncluded|length != 0 %}
    {% set mediaFile = thread.mediaIncluded[0] %}
{% endif %}
    
{# mediatype 0 = image 1 = video 2 = audio 9 = other #}
{% if mediaFile is not defined %}
    </div> <!-- /mediaFileWrap -->
{% elseif mediaFile.type == 0 %}
{# -----------   if type of media is an IMAGE   -------- #}
    <img class="thread-content-image" src="{{ asset(mediaFile.getResource.getWebPath) }}" />
    </div> <!-- /mediaFileWrap div -->
{# -----------   if type of media is a VIDEO   -------- #}
{% elseif mediaFile.type == 1 %}
        <video class="preview" width="100%" id="{{ mediaFile.getID }}" preload="auto">
        	<source src="{{ asset(mediaFile.getResource.getWebPathWebm) }}"/>
        	<source src="{{ asset(mediaFile.getResource.getWebPath) }}"/>
        </video>
        <script type="text/javascript">
	        var player = new Player($("#{{ mediaFile.getID }}"));
	        player.options.areaSelectionEnabled = false;
	        player.options.updateTimeType = Player.DENSITY_BAR_UPDATE_TYPE_RELATIVE;
	        player.options.backButton = false;
	        player.options.forwardButton = false;
	        player.options.audioBar = false;
	        // player.options.backFunction= function(){if (confirm("This will delete your current recording. Are you sure?")) {goBack('<?php echo $postType?>');}};
	        // player.options.forwardFunction = function (){transcodeAjax('<?php echo basename($video) ?>', '<?php echo basename($outputVideoFile) ?>', <?php echo $keepVideoFile ?>, controls);};
	
	        player.options.playHeadImage = "{{ asset('bundles/imdcterptube/img/player/add.png') }}";
	        player.options.playHeadImageOnClick = function() { 
		        $("#post-comment-button").click();
	        };
	
	        player.createControls();

	    	//form inputs
	        var startTimeInput = $("#PostFormFromThread_startTime");
	        var endTimeInput   = $("#PostFormFromThread_endTime");
	    	
	        player.options.onAreaSelectionChanged = function(){
	        	startTimeInput.val( roundNumber(player.options.currentMinTimeSelected, 2));
	            endTimeInput.val( roundNumber(player.options.currentMaxTimeSelected, 2));
	        };
        </script>
    </div> <!-- /mediaFileWrap div -->

{% elseif mediaFile.type == 2 %}
{# -----------   if type of media is AUDIO   -------- #}
        <audio controls style="width: 100%">
            <source src="{{ asset(mediaFile.getResource.getWebPath) }}" />
            Your browser does not support the audio element, please upgrade to Google Chrome
        </audio>
    </div> <!-- /mediaFileWrap div -->
{% endif %}
       <div class="row-fluid">
           <div class="span12" id="maincontent">
               {{ thread.content }}
               Media ID: 
               {%  for m in thread.mediaIncluded %}
                   Media id: {{ m.getId }}
               {% endfor %}
           </div>
        </div>
        <div class="row-fluid" id="thread-creator-details">
            <div class="span12">
                {% include('IMDCTerpTubeBundle:Thread:smalluserinfo.html.twig') %}
           </div> <!-- /span12 -->
        </div> <!-- end of user-deets -->
   </div> <!-- end of leftsidecontent -->
    <div class="span6" id="rightsidecontent">
    <!-- right side content -->
    {# --------- post reply form --------------- #}
      <div class="row-fluid" id="reply-container">
           <div class="span12">
               <p>
                   <a class="btn btn-info" id="post-comment-button" href="#"><i class="icon-plus"></i> Reply</a>
                   <div id="comment-form-wrap" style="display:none;" class="row-fluid">
{#                    TWIG FORM START #}
    				
				    {{ form_start(form, { 'attr' : {'id' : 'postCommentForm'} }) }}
				        {{ form_errors(form) }}
				        <a class="btn btn-primary" id="selectFiles" href="#"><i class="icon-cloud-upload"></i> Select Files</a>
				        {{ form_widget(form.mediatextarea) }}{{ form_errors(form.mediatextarea) }}
				        <div id="files"></div>
				{#         <input type="textarea" disabled="true" id="file-textarea" />#}
				{#         {{ form_row(form.mediaID) }}#}
						<div class="row-fluid">
							<div class="span12">
					        {{ form_row(form.content) }}
					        </div>
				        </div>
				        <div class="row-fluid">
					        <div class="span6">
					        {{ form_label(form.startTime) }}{{ form_widget(form.startTime) }}{{ form_errors(form.startTime) }}
					        </div>
					        <div class="span6">
					        {{ form_label(form.endTime) }}{{ form_widget(form.endTime) }}{{ form_errors(form.endTime) }}
					        </div>
				        </div>
				        <div class="row-fluid">
{# 				        {{ form_widget(form.submit, {'attr' : {'class': 'btn btn-success',} }) }} <a class="btn btn-danger" href="#" id="cancelButton"><i class="icon-remove"></i> Cancel</a>#}
				        <a id="post-comment-submit-button" class="btn btn-success"><i class="icon-check"></i> Submit</a> <a class="btn btn-danger" href="#" id="cancelButton"><i class="icon-remove"></i> Cancel</a>
				        {{ form_widget(form.submit, {'attr' : {'class': 'btn btn-success',} }) }}
				        </div>
				    
				    {{ form_end(form) }}
                   
{#                    TWIG FORM END #}
                   </div>
               </p>
           </div>
       </div> <!-- end of reply-container -->
       
    {# --------- end of post reply form -------- #}
       
    {# ----------- start of replies --------------- #}
    <div class="row-fluid" id="thread-reply-container">
    <div class="span12">
        {% if threadposts|length > 0 %}
            {% for post in threadposts %}
            <p>
            <div class="row-fluid post-reply-wrap" id="post-{{ post.id }}" data-pid="{{ post.id }}">
                <div class="span2 post-reply-user-info-wrap">
                    <div class="row-fluid post-reply-user-avatar-wrap">
                        <img class="avatar" alt="avatar" title="" src="{{ post.author.getProfile.avatar ? asset(post.author.getProfile.avatar.getResource.getWebPath):asset('bundles/imdcterptube/img/no_avatar.jpg')}}" />
                    </div>
                    <div class="row-fluid text-center post-reply-user-info">
                        <a href="{{ path('imdc_terp_tube_user_profile_specific', {'userName':post.author.getUserName}) }}">{{ post.author }}</a>
                    </div>
                    <div class="row-fluid text-center post-reply-user-tools">
                        <ul class="unstyled inline thread-creator-tools-wrap">
                            <li>
                                {% if app.user.getId == post.author.getId %}
                                {% set thisistheuser = true %}
                                <i class="icon-envelope" style="color:gray"></i>
                                {% else %}
                                <a href="{{ path('imdc_message_user_specific', {'userid':post.author.getUserName()}) }}"><i class="icon-envelope"></i></a>
                                {% endif %}
                            </li>
                            <li>
                                {% if thisistheuser is defined %}
                                <i class="icon-heart" style="color:gray"></i>
                                {% elseif app.user.isUserOnFriendsList(post.author) %}
                                <i class="icon-heart" style="color:green" title="Already friends"></i>
                                {% else %}
                                <a href="{{ path('imdc_add_to_friends_list', {'userid':post.author.getId} ) }}"><i class="icon-heart"></i></a>
                                {% endif %}
                            </li>
                       </ul>
                    </div> <!-- /thread-creator-tools-wrap -->
                </div> <!-- /post-reply-user-info-wrap div -->
                <div class="span9 post-reply-avatar-content-wrap" id="post-{{ post.id }}" data-pid="{{ post.id }}">
                    <div class="row-fluid post-reply-date">
                        {{ post.created|date('o-m-N H:i') }}
                    </div>
                    <div class="row-fluid post-reply-content">
                    	{% if post.attachedFile is defined and post.attachedFile|length > 0 %}
						    {% set postMediaFile = post.attachedFile[0] %}
					    {% else %}
					    	{% set postMediaFile = none  %}
						{% endif %}
						    
						{# mediatype 0 = image 1 = video 2 = audio 9 = other #}
						{% if postMediaFile is not defined or postMediaFile is null %}
						    {# do nothing #}
						{% elseif postMediaFile.type == 0 %}
						{# -----------   if type of media is an IMAGE   -------- #}
						    <div class="row-fluid">
						    <img class="post-reply-image" src="{{ asset(postMediaFile.getResource.getWebPath) }}" />
						    </div>
						{# -----------   if type of media is a VIDEO   -------- #}
						{% elseif postMediaFile.type == 1 %}
					        <div class="row-fluid">
						        <video controls width="100%" id="{{ mediaFile.getID }}" preload="auto">
						        	<source src="{{ asset(postMediaFile.getResource.getWebPathWebm) }}"/>
						        	<source src="{{ asset(postMediaFile.getResource.getWebPath) }}"/>
						        </video>
					        </div>
						{% elseif postMediaFile.type == 2 %}
						{# -----------   if type of media is AUDIO   -------- #}
					        <div class="row-fluid">
						        <audio controls style="width: 100%">
						            <source src="{{ asset(postMediaFile.getResource.getWebPath) }}" />
						            Your browser does not support the audio element, please upgrade to Google Chrome
						        </audio>
					        </div>
						{% endif %}
                    	<div class="row-fluid">
                        {{ post.content|nl2br }}
                        </div>
                    </div>
                </div> <!-- /post-reply-avatar-content-wrap div -->
                <div class="span1 pull-right" id="post-reply-tools">
                    <div class="row-fluid">
                        <ul class="unstyled">
                        	{% if post.isTemporal %}
                            <li><i class="icon-time icon-large"></i></li>
                            {% endif %}
                            {% if post.author.getId == app.user.getId %}
{#                             <li><a data-pid="{{ post.getId }}" data-tid="{{ thread.getId }}" href="{{ path('imdc_post_delete_specific', {'postid':post.getId, 'threadid':thread.getid} ) }}"><i class="icon-trash"></i></a></li>#}
                            <li><a id="post-comment-delete" data-pid="{{ post.getId }}" data-tid="{{ thread.getId }}" href="#"><i class="icon-trash"></i></a></li>
                            {% endif %}
                        </ul>
                    </div>
                </div> <!-- /post-reply-tools -->
            </div>
            </p>
            {% endfor %}
        {% else %}
            <div class="span12">
                No posts yet!
            </div>
        {% endif %}
        </div>
        </div>
            {# ----------- end of replies --------------- #}
   </div> <!-- /rightsidecontent -->
</div> <!-- /thread-container -->

{% endblock underherounitrow1 %}
{% block underherounitrow2 %}
{% endblock underherounitrow2 %}


{% block javascripts %}
    {{ parent() }}
    <script type="text/javascript" src="{{ asset('bundles/imdcterptube/js/thread.js') }}"></script>
{% endblock javascripts %}