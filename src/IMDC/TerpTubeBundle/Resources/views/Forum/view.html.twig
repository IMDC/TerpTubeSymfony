{% extends 'IMDCTerpTubeBundle:Base:base.html.twig' %}

{% block title %}{{ forum.titleText }}{% endblock title %}

{% block header %}
    {{ parent() }}

    <script type="text/javascript">
        $(document).ready(function() {
            require(['main'], function() {
                var forum = new $tt.Controller.Forum({page: $tt.Controller.Forum.Page.VIEW});

                forum.bindUIEvents();
            });
        });
    </script>
{% endblock header %}

{% block sidebarlinks_pages %}class="active"{% endblock %}

{% block content %}
	<div class="col-md-12">
		<ol class="breadcrumb">
			<li><a href="{{ path('imdc_forum_list') }}">Forums</a></li>
			<li class="active">{{ forum.getTitleText|truncate(20) }}</li>
		</ol>
		<div class="row">
			<div class="col-md-offset-4 col-md-4">
				{% if orderedMedia is defined and orderedMedia|length > 0 %}
                    <div class="gallery-container" style="position: relative;">
                        <div class="text-center gallery-working" style="display: none;"><i class="fa fa-spinner fa-4x fa-spin"></i></div>
                        <div class="gallery-container-inner" style="display: none;">
                            <div class="gallery-content"></div>
                            <div class="gallery-arrow-left" style="left: 0; position: absolute; bottom: 0; line-height: 60px; cursor: pointer;"><i class="fa fa-chevron-left fa-3x"></i></div>
                            <div class="gallery-container-thumbs" style="overflow: hidden; position: relative; height: 90px; margin-left: 35px; margin-right: 35px;">
                                <ol style="width: 10000px; list-style: none; position: absolute; overflow: hidden; padding: 0px; left: 0;">
                                    {% for media in orderedMedia %}
                                        <li style="float: left; margin: 0; padding-right: 5px; cursor: pointer;" data-mid="{{ media.id }}"><img src="{{ asset(media.thumbnailPath) }}" style="width: 90px; height: 90px;"><li>
                                    {% endfor %}
                                </ol>
                            </div>
                            <div class="gallery-arrow-right" style="position: absolute; right: 0; bottom: 0; line-height: 60px; cursor: pointer;"><i class="fa fa-chevron-right fa-3x"></i></div>
                        </div>
                    </div>

					{#{% include 'IMDCTerpTubeBundle:Media:element.html.twig' with {'mediaFile': orderedMedia[0]} %}#}
				{% else %}
					<p>No media</p>
				{% endif %}
			</div>
		</div>
		<div class="row">
			<div class="col-md-12">
				<h1>{{ forum.titleText }}</h1>
				<h4>Created: {{ forum.getCreationDate|date('g:ia F j Y') }}</h4>
				<h5>Topics: {{ threads|length }}</h5>
			</div>
		</div>
		<div class="row">
			<div class="col-md-12">
				<p>
					<a class="btn btn-default" href="{{ path('imdc_thread_new', {'forumid': forum.id}) }}"><i class="fa fa-plus"></i> Create New Topic</a>
					{% if forum in app.user.getForums %}
						<a class="btn btn-default" href="{{ path('imdc_forum_edit', {'forumid': forum.id}) }}"><i class="fa fa-edit"></i> Edit Forum</a>
						<a class="btn btn-default" href="{{ path('imdc_forum_delete', {'forumid': forum.id}) }}"><i class="fa fa-times"></i> Delete Forum</a>
					{% endif %}
				</p>
			</div>
		</div>
		<!-- recent threads activity -->
		<div class="row">
			<div class="col-md-offset-1 col-md-10">
				<img class="img-responsive center-block" src="" />
			</div>
		</div>
		<div class="row">
			<div class="col-md-offset-1 col-md-10">
				<hr class="tt-separator-top" />
				{% if recentThreads|length > 0 %}
					{% include 'IMDCTerpTubeBundle:Thread:thumbnail.html.twig' with {'threads': recentThreads} %}
				{% else %}
					<p class="text-center" style="margin-bottom: 20px;">No recent threads</p>
				{% endif %}
				<hr class="tt-separator-bottom" />
			</div>
		</div>
		<!-- all threads -->
		<div class="row">
			<div class="col-md-offset-1 col-md-10">
				<img class="img-responsive center-block" src="" />
			</div>
		</div>
		<div class="row">
			<div class="col-md-offset-1 col-md-10">
				<hr class="tt-separator-top" />
				{% if threads|length > 0 %}
                    {% set pagParams = threads.getParams %}
                    <div class="btn-group" style="margin-bottom: 10px;">
                        <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
                            Sort by
                            {% if threads.isSorted('t.lastPostAt') %}Last Post
                            {% elseif threads.isSorted('t.title') %}Title
                            {% elseif threads.isSorted('t.creationDate') %}Date Created
                            {% endif %}
                            {% if 'asc' in pagParams %}(ascending)
                            {% elseif 'desc' in pagParams %}(descending)
                            {% endif %}
                            <span class="caret"></span>
                        </button>
                        <ul class="dropdown-menu" role="menu">
                            <li>{{ knp_pagination_sortable(threads, 'Last Post', 't.lastPostAt') }}</li>
                            <li>{{ knp_pagination_sortable(threads, 'Title', 't.title') }}</li>
                            <li>{{ knp_pagination_sortable(threads, 'Date Created', 't.creationDate') }}</li>
                        </ul>
                    </div>
					{% include 'IMDCTerpTubeBundle:Thread:thumbnail.html.twig' %}
				{% else %}
					<p class="text-center" style="margin-bottom: 20px;">No threads</p>
				{% endif %}
				<hr class="tt-separator-bottom" />
			</div>
		</div>
		<div class="row">
			<div class="col-md-offset-1 col-md-10">
				{{ knp_pagination_render(threads) }}
			</div>
		</div>
	</div>
{% endblock content %}

{% block outside_body %}
    {{ parent() }}

    {% if enableControls is not defined %}
        {% set enableControls = true %}
    {% endif %}

    <script type="text/html" id="mediaElementVideo">
        <video class="tt-media-video" id="{media.id}" {% if enableControls %}controls{% endif %} poster="{{ asset('') }}{media.thumbnail}" preload="none">
            <source src="{{ asset('') }}{media.resource.pathMPEG}" />
            <source src="{{ asset('') }}{media.resource.pathWebm}" />
        </video>
    </script>

    <script type="text/html" id="mediaElementAudio">
        <audio class="tt-media-audio" {% if enableControls %}controls{% endif %}>
            <source src="{{ asset('') }}{media.resource.pathMPEG}" />
            Your browser does not support the audio element, please upgrade to Google Chrome
        </audio>
    </script>

    <script type="text/html" id="mediaElementImage">
        <img class="img-responsive center-block tt-media-img" src="{{ asset('') }}{media.resource.pathMPEG}" alt="{media.title}" title="{media.title}" />
    </script>

    <script type="text/html" id="mediaElementOther">
        <div class="row">
            <div class="col-md-3 thumbnail text-center">
                <a href="{{ asset('') }}{media.resource.pathMPEG}">
                    <p><i class="fa fa-file fa-5x"></i></p>
                    <div>{media.title}</div>
                </a>
            </div>
        </div>
    </script>
{% endblock %}
