//     Underscore.js 1.8.3
//     http://underscorejs.org
//     (c) 2009-2015 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
//     Underscore may be freely distributed under the MIT license.

/*! dustjs-linkedin - v2.7.2
* http://dustjs.com/
* Copyright (c) 2015 Aleksander Williams; Released under the MIT License */

/*! dustjs-helpers - v1.7.2
* http://dustjs.com/
* Copyright (c) 2015 Aleksander Williams; Released under the MIT License */

/* sockjs-client v1.0.1 | http://sockjs.org | MIT license */

/*
   Stomp Over WebSocket http://www.jmesnil.net/stomp-websocket/doc/ | Apache License V2.0

   Copyright (C) 2010-2013 [Jeff Mesnil](http://jmesnil.net/)
   Copyright (C) 2012 [FuseSource, Inc.](http://fusesource.com)
 */

/*! Sortable 1.1.1 - MIT | git://github.com/rubaxa/Sortable.git */

/*!
 * version=#version
 */

(function(){function e(e){function t(t,n,r,i,s,o){for(;s>=0&&o>s;s+=e){var u=i?i[s]:s;r=n(r,t[u],u,t)}return r}return function(n,r,i,s){r=b(r,s,4);var o=!C(n)&&y.keys(n),u=(o||n).length,a=e>0?0:u-1;return arguments.length<3&&(i=n[o?o[a]:a],a+=e),t(n,r,i,o,a,u)}}function t(e){return function(t,n,r){n=w(n,r);for(var i=N(t),s=e>0?0:i-1;s>=0&&i>s;s+=e)if(n(t[s],s,t))return s;return-1}}function n(e,t,n){return function(r,i,s){var o=0,u=N(r);if("number"==typeof s)e>0?o=s>=0?s:Math.max(s+u,o):u=s>=0?Math.min(s+1,u):s+u+1;else if(n&&s&&u)return s=n(r,i),r[s]===i?s:-1;if(i!==i)return s=t(l.call(r,o,u),y.isNaN),s>=0?s+o:-1;for(s=e>0?o:u-1;s>=0&&u>s;s+=e)if(r[s]===i)return s;return-1}}function r(e,t){var n=M.length,r=e.constructor,i=y.isFunction(r)&&r.prototype||u,s="constructor";for(y.has(e,s)&&!y.contains(t,s)&&t.push(s);n--;)s=M[n],s in e&&e[s]!==i[s]&&!y.contains(t,s)&&t.push(s)}var i=this,s=i._,o=Array.prototype,u=Object.prototype,a=Function.prototype,f=o.push,l=o.slice,c=u.toString,h=u.hasOwnProperty,p=Array.isArray,d=Object.keys,v=a.bind,m=Object.create,g=function(){},y=function(e){return e instanceof y?e:this instanceof y?void (this._wrapped=e):new y(e)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=y),exports._=y):i._=y,y.VERSION="1.8.3";var b=function(e,t,n){if(t===void 0)return e;switch(null==n?3:n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)};case 4:return function(n,r,i,s){return e.call(t,n,r,i,s)}}return function(){return e.apply(t,arguments)}},w=function(e,t,n){return null==e?y.identity:y.isFunction(e)?b(e,t,n):y.isObject(e)?y.matcher(e):y.property(e)};y.iteratee=function(e,t){return w(e,t,1/0)};var E=function(e,t){return function(n){var r=arguments.length;if(2>r||null==n)return n;for(var i=1;r>i;i++)for(var s=arguments[i],o=e(s),u=o.length,a=0;u>a;a++){var f=o[a];t&&n[f]!==void 0||(n[f]=s[f])}return n}},S=function(e){if(!y.isObject(e))return{};if(m)return m(e);g.prototype=e;var t=new g;return g.prototype=null,t},x=function(e){return function(t){return null==t?void 0:t[e]}},T=Math.pow(2,53)-1,N=x("length"),C=function(e){var t=N(e);return"number"==typeof t&&t>=0&&T>=t};y.each=y.forEach=function(e,t,n){t=b(t,n);var r,i;if(C(e))for(r=0,i=e.length;i>r;r++)t(e[r],r,e);else{var s=y.keys(e);for(r=0,i=s.length;i>r;r++)t(e[s[r]],s[r],e)}return e},y.map=y.collect=function(e,t,n){t=w(t,n);for(var r=!C(e)&&y.keys(e),i=(r||e).length,s=Array(i),o=0;i>o;o++){var u=r?r[o]:o;s[o]=t(e[u],u,e)}return s},y.reduce=y.foldl=y.inject=e(1),y.reduceRight=y.foldr=e(-1),y.find=y.detect=function(e,t,n){var r;return r=C(e)?y.findIndex(e,t,n):y.findKey(e,t,n),r!==void 0&&r!==-1?e[r]:void 0},y.filter=y.select=function(e,t,n){var r=[];return t=w(t,n),y.each(e,function(e,n,i){t(e,n,i)&&r.push(e)}),r},y.reject=function(e,t,n){return y.filter(e,y.negate(w(t)),n)},y.every=y.all=function(e,t,n){t=w(t,n);for(var r=!C(e)&&y.keys(e),i=(r||e).length,s=0;i>s;s++){var o=r?r[s]:s;if(!t(e[o],o,e))return!1}return!0},y.some=y.any=function(e,t,n){t=w(t,n);for(var r=!C(e)&&y.keys(e),i=(r||e).length,s=0;i>s;s++){var o=r?r[s]:s;if(t(e[o],o,e))return!0}return!1},y.contains=y.includes=y.include=function(e,t,n,r){return C(e)||(e=y.values(e)),("number"!=typeof n||r)&&(n=0),y.indexOf(e,t,n)>=0},y.invoke=function(e,t){var n=l.call(arguments,2),r=y.isFunction(t);return y.map(e,function(e){var i=r?t:e[t];return null==i?i:i.apply(e,n)})},y.pluck=function(e,t){return y.map(e,y.property(t))},y.where=function(e,t){return y.filter(e,y.matcher(t))},y.findWhere=function(e,t){return y.find(e,y.matcher(t))},y.max=function(e,t,n){var r,i,s=-1/0,o=-1/0;if(null==t&&null!=e){e=C(e)?e:y.values(e);for(var u=0,a=e.length;a>u;u++)r=e[u],r>s&&(s=r)}else t=w(t,n),y.each(e,function(e,n,r){i=t(e,n,r),(i>o||i===-1/0&&s===-1/0)&&(s=e,o=i)});return s},y.min=function(e,t,n){var r,i,s=1/0,o=1/0;if(null==t&&null!=e){e=C(e)?e:y.values(e);for(var u=0,a=e.length;a>u;u++)r=e[u],s>r&&(s=r)}else t=w(t,n),y.each(e,function(e,n,r){i=t(e,n,r),(o>i||1/0===i&&1/0===s)&&(s=e,o=i)});return s},y.shuffle=function(e){for(var t,n=C(e)?e:y.values(e),r=n.length,i=Array(r),s=0;r>s;s++)t=y.random(0,s),t!==s&&(i[s]=i[t]),i[t]=n[s];return i},y.sample=function(e,t,n){return null==t||n?(C(e)||(e=y.values(e)),e[y.random(e.length-1)]):y.shuffle(e).slice(0,Math.max(0,t))},y.sortBy=function(e,t,n){return t=w(t,n),y.pluck(y.map(e,function(e,n,r){return{value:e,index:n,criteria:t(e,n,r)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||n===void 0)return 1;if(r>n||r===void 0)return-1}return e.index-t.index}),"value")};var k=function(e){return function(t,n,r){var i={};return n=w(n,r),y.each(t,function(r,s){var o=n(r,s,t);e(i,r,o)}),i}};y.groupBy=k(function(e,t,n){y.has(e,n)?e[n].push(t):e[n]=[t]}),y.indexBy=k(function(e,t,n){e[n]=t}),y.countBy=k(function(e,t,n){y.has(e,n)?e[n]++:e[n]=1}),y.toArray=function(e){return e?y.isArray(e)?l.call(e):C(e)?y.map(e,y.identity):y.values(e):[]},y.size=function(e){return null==e?0:C(e)?e.length:y.keys(e).length},y.partition=function(e,t,n){t=w(t,n);var r=[],i=[];return y.each(e,function(e,n,s){(t(e,n,s)?r:i).push(e)}),[r,i]},y.first=y.head=y.take=function(e,t,n){return null==e?void 0:null==t||n?e[0]:y.initial(e,e.length-t)},y.initial=function(e,t,n){return l.call(e,0,Math.max(0,e.length-(null==t||n?1:t)))},y.last=function(e,t,n){return null==e?void 0:null==t||n?e[e.length-1]:y.rest(e,Math.max(0,e.length-t))},y.rest=y.tail=y.drop=function(e,t,n){return l.call(e,null==t||n?1:t)},y.compact=function(e){return y.filter(e,y.identity)};var L=function(e,t,n,r){for(var i=[],s=0,o=r||0,u=N(e);u>o;o++){var a=e[o];if(C(a)&&(y.isArray(a)||y.isArguments(a))){t||(a=L(a,t,n));var f=0,l=a.length;for(i.length+=l;l>f;)i[s++]=a[f++]}else n||(i[s++]=a)}return i};y.flatten=function(e,t){return L(e,t,!1)},y.without=function(e){return y.difference(e,l.call(arguments,1))},y.uniq=y.unique=function(e,t,n,r){y.isBoolean(t)||(r=n,n=t,t=!1),null!=n&&(n=w(n,r));for(var i=[],s=[],o=0,u=N(e);u>o;o++){var a=e[o],f=n?n(a,o,e):a;t?(o&&s===f||i.push(a),s=f):n?y.contains(s,f)||(s.push(f),i.push(a)):y.contains(i,a)||i.push(a)}return i},y.union=function(){return y.uniq(L(arguments,!0,!0))},y.intersection=function(e){for(var t=[],n=arguments.length,r=0,i=N(e);i>r;r++){var s=e[r];if(!y.contains(t,s)){for(var o=1;n>o&&y.contains(arguments[o],s);o++);o===n&&t.push(s)}}return t},y.difference=function(e){var t=L(arguments,!0,!0,1);return y.filter(e,function(e){return!y.contains(t,e)})},y.zip=function(){return y.unzip(arguments)},y.unzip=function(e){for(var t=e&&y.max(e,N).length||0,n=Array(t),r=0;t>r;r++)n[r]=y.pluck(e,r);return n},y.object=function(e,t){for(var n={},r=0,i=N(e);i>r;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n},y.findIndex=t(1),y.findLastIndex=t(-1),y.sortedIndex=function(e,t,n,r){n=w(n,r,1);for(var i=n(t),s=0,o=N(e);o>s;){var u=Math.floor((s+o)/2);n(e[u])<i?s=u+1:o=u}return s},y.indexOf=n(1,y.findIndex,y.sortedIndex),y.lastIndexOf=n(-1,y.findLastIndex),y.range=function(e,t,n){null==t&&(t=e||0,e=0),n=n||1;for(var r=Math.max(Math.ceil((t-e)/n),0),i=Array(r),s=0;r>s;s++,e+=n)i[s]=e;return i};var A=function(e,t,n,r,i){if(r instanceof t){var s=S(e.prototype),o=e.apply(s,i);return y.isObject(o)?o:s}return e.apply(n,i)};y.bind=function(e,t){if(v&&e.bind===v)return v.apply(e,l.call(arguments,1));if(!y.isFunction(e))throw new TypeError("Bind must be called on a function");var n=l.call(arguments,2),r=function(){return A(e,r,t,this,n.concat(l.call(arguments)))};return r},y.partial=function(e){var t=l.call(arguments,1),n=function(){for(var r=0,i=t.length,s=Array(i),o=0;i>o;o++)s[o]=t[o]===y?arguments[r++]:t[o];for(;r<arguments.length;)s.push(arguments[r++]);return A(e,n,this,this,s)};return n},y.bindAll=function(e){var t,n,r=arguments.length;if(1>=r)throw new Error("bindAll must be passed function names");for(t=1;r>t;t++)n=arguments[t],e[n]=y.bind(e[n],e);return e},y.memoize=function(e,t){var n=function(r){var i=n.cache,s=""+(t?t.apply(this,arguments):r);return y.has(i,s)||(i[s]=e.apply(this,arguments)),i[s]};return n.cache={},n},y.delay=function(e,t){var n=l.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},y.defer=y.partial(y.delay,y,1),y.throttle=function(e,t,n){var r,i,s,o=null,u=0;n||(n={});var a=function(){u=n.leading===!1?0:y.now(),o=null,s=e.apply(r,i),o||(r=i=null)};return function(){var f=y.now();u||n.leading!==!1||(u=f);var l=t-(f-u);return r=this,i=arguments,0>=l||l>t?(o&&(clearTimeout(o),o=null),u=f,s=e.apply(r,i),o||(r=i=null)):o||n.trailing===!1||(o=setTimeout(a,l)),s}},y.debounce=function(e,t,n){var r,i,s,o,u,a=function(){var f=y.now()-o;t>f&&f>=0?r=setTimeout(a,t-f):(r=null,n||(u=e.apply(s,i),r||(s=i=null)))};return function(){s=this,i=arguments,o=y.now();var f=n&&!r;return r||(r=setTimeout(a,t)),f&&(u=e.apply(s,i),s=i=null),u}},y.wrap=function(e,t){return y.partial(t,e)},y.negate=function(e){return function(){return!e.apply(this,arguments)}},y.compose=function(){var e=arguments,t=e.length-1;return function(){for(var n=t,r=e[t].apply(this,arguments);n--;)r=e[n].call(this,r);return r}},y.after=function(e,t){return function(){return--e<1?t.apply(this,arguments):void 0}},y.before=function(e,t){var n;return function(){return--e>0&&(n=t.apply(this,arguments)),1>=e&&(t=null),n}},y.once=y.partial(y.before,2);var O=!{toString:null}.propertyIsEnumerable("toString"),M=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];y.keys=function(e){if(!y.isObject(e))return[];if(d)return d(e);var t=[];for(var n in e)y.has(e,n)&&t.push(n);return O&&r(e,t),t},y.allKeys=function(e){if(!y.isObject(e))return[];var t=[];for(var n in e)t.push(n);return O&&r(e,t),t},y.values=function(e){for(var t=y.keys(e),n=t.length,r=Array(n),i=0;n>i;i++)r[i]=e[t[i]];return r},y.mapObject=function(e,t,n){t=w(t,n);for(var r,i=y.keys(e),s=i.length,o={},u=0;s>u;u++)r=i[u],o[r]=t(e[r],r,e);return o},y.pairs=function(e){for(var t=y.keys(e),n=t.length,r=Array(n),i=0;n>i;i++)r[i]=[t[i],e[t[i]]];return r},y.invert=function(e){for(var t={},n=y.keys(e),r=0,i=n.length;i>r;r++)t[e[n[r]]]=n[r];return t},y.functions=y.methods=function(e){var t=[];for(var n in e)y.isFunction(e[n])&&t.push(n);return t.sort()},y.extend=E(y.allKeys),y.extendOwn=y.assign=E(y.keys),y.findKey=function(e,t,n){t=w(t,n);for(var r,i=y.keys(e),s=0,o=i.length;o>s;s++)if(r=i[s],t(e[r],r,e))return r},y.pick=function(e,t,n){var r,i,s={},o=e;if(null==o)return s;y.isFunction(t)?(i=y.allKeys(o),r=b(t,n)):(i=L(arguments,!1,!1,1),r=function(e,t,n){return t in n},o=Object(o));for(var u=0,a=i.length;a>u;u++){var f=i[u],l=o[f];r(l,f,o)&&(s[f]=l)}return s},y.omit=function(e,t,n){if(y.isFunction(t))t=y.negate(t);else{var r=y.map(L(arguments,!1,!1,1),String);t=function(e,t){return!y.contains(r,t)}}return y.pick(e,t,n)},y.defaults=E(y.allKeys,!0),y.create=function(e,t){var n=S(e);return t&&y.extendOwn(n,t),n},y.clone=function(e){return y.isObject(e)?y.isArray(e)?e.slice():y.extend({},e):e},y.tap=function(e,t){return t(e),e},y.isMatch=function(e,t){var n=y.keys(t),r=n.length;if(null==e)return!r;for(var i=Object(e),s=0;r>s;s++){var o=n[s];if(t[o]!==i[o]||!(o in i))return!1}return!0};var _=function(e,t,n,r){if(e===t)return 0!==e||1/e===1/t;if(null==e||null==t)return e===t;e instanceof y&&(e=e._wrapped),t instanceof y&&(t=t._wrapped);var i=c.call(e);if(i!==c.call(t))return!1;switch(i){case"[object RegExp]":case"[object String]":return""+e==""+t;case"[object Number]":return+e!==+e?+t!==+t:0===+e?1/+e===1/t:+e===+t;case"[object Date]":case"[object Boolean]":return+e===+t}var s="[object Array]"===i;if(!s){if("object"!=typeof e||"object"!=typeof t)return!1;var o=e.constructor,u=t.constructor;if(o!==u&&!(y.isFunction(o)&&o instanceof o&&y.isFunction(u)&&u instanceof u)&&"constructor"in e&&"constructor"in t)return!1}n=n||[],r=r||[];for(var a=n.length;a--;)if(n[a]===e)return r[a]===t;if(n.push(e),r.push(t),s){if(a=e.length,a!==t.length)return!1;for(;a--;)if(!_(e[a],t[a],n,r))return!1}else{var f,l=y.keys(e);if(a=l.length,y.keys(t).length!==a)return!1;for(;a--;)if(f=l[a],!y.has(t,f)||!_(e[f],t[f],n,r))return!1}return n.pop(),r.pop(),!0};y.isEqual=function(e,t){return _(e,t)},y.isEmpty=function(e){return null==e?!0:C(e)&&(y.isArray(e)||y.isString(e)||y.isArguments(e))?0===e.length:0===y.keys(e).length},y.isElement=function(e){return!!e&&1===e.nodeType},y.isArray=p||function(e){return"[object Array]"===c.call(e)},y.isObject=function(e){var t=typeof e;return"function"===t||"object"===t&&!!e},y.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(e){y["is"+e]=function(t){return c.call(t)==="[object "+e+"]"}}),y.isArguments(arguments)||(y.isArguments=function(e){return y.has(e,"callee")}),"function"!=typeof /./&&"object"!=typeof Int8Array&&(y.isFunction=function(e){return"function"==typeof e||!1}),y.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},y.isNaN=function(e){return y.isNumber(e)&&e!==+e},y.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"===c.call(e)},y.isNull=function(e){return null===e},y.isUndefined=function(e){return e===void 0},y.has=function(e,t){return null!=e&&h.call(e,t)},y.noConflict=function(){return i._=s,this},y.identity=function(e){return e},y.constant=function(e){return function(){return e}},y.noop=function(){},y.property=x,y.propertyOf=function(e){return null==e?function(){}:function(t){return e[t]}},y.matcher=y.matches=function(e){return e=y.extendOwn({},e),function(t){return y.isMatch(t,e)}},y.times=function(e,t,n){var r=Array(Math.max(0,e));t=b(t,n,1);for(var i=0;e>i;i++)r[i]=t(i);return r},y.random=function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))},y.now=Date.now||function(){return(new Date).getTime()};var D={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},P=y.invert(D),H=function(e){var t=function(t){return e[t]},n="(?:"+y.keys(e).join("|")+")",r=RegExp(n),i=RegExp(n,"g");return function(e){return e=null==e?"":""+e,r.test(e)?e.replace(i,t):e}};y.escape=H(D),y.unescape=H(P),y.result=function(e,t,n){var r=null==e?void 0:e[t];return r===void 0&&(r=n),y.isFunction(r)?r.call(e):r};var B=0;y.uniqueId=function(e){var t=++B+"";return e?e+t:t},y.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var j=/(.)^/,F={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},I=/\\|'|\r|\n|\u2028|\u2029/g,q=function(e){return"\\"+F[e]};y.template=function(e,t,n){!t&&n&&(t=n),t=y.defaults({},t,y.templateSettings);var r=RegExp([(t.escape||j).source,(t.interpolate||j).source,(t.evaluate||j).source].join("|")+"|$","g"),i=0,s="__p+='";e.replace(r,function(t,n,r,o,u){return s+=e.slice(i,u).replace(I,q),i=u+t.length,n?s+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":r?s+="'+\n((__t=("+r+"))==null?'':__t)+\n'":o&&(s+="';\n"+o+"\n__p+='"),t}),s+="';\n",t.variable||(s="with(obj||{}){\n"+s+"}\n"),s="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+s+"return __p;\n";try{var o=new Function(t.variable||"obj","_",s)}catch(u){throw u.source=s,u}var a=function(e){return o.call(this,e,y)},f=t.variable||"obj";return a.source="function("+f+"){\n"+s+"}",a},y.chain=function(e){var t=y(e);return t._chain=!0,t};var R=function(e,t){return e._chain?y(t).chain():t};y.mixin=function(e){y.each(y.functions(e),function(t){var n=y[t]=e[t];y.prototype[t]=function(){var e=[this._wrapped];return f.apply(e,arguments),R(this,n.apply(y,e))}})},y.mixin(y),y.each(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=o[e];y.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),"shift"!==e&&"splice"!==e||0!==n.length||delete n[0],R(this,n)}}),y.each(["concat","join","slice"],function(e){var t=o[e];y.prototype[e]=function(){return R(this,t.apply(this._wrapped,arguments))}}),y.prototype.value=function(){return this._wrapped},y.prototype.valueOf=y.prototype.toJSON=y.prototype.value,y.prototype.toString=function(){return""+this._wrapped},"function"==typeof define&&define.amd&&define("underscore",[],function(){return y})}).call(this),!function(e,t){"function"==typeof define&&define.amd&&define.amd.dust===!0?define("dust.core",[],t):"object"==typeof exports?module.exports=t():e.dust=t()}(this,function(){function getTemplate(e,t){return e?"function"==typeof e&&e.template?e.template:dust.isTemplateFn(e)?e:t!==!1?dust.cache[e]:void 0:void 0}function load(e,t,n){if(!e)return t.setError(new Error("No template or template name provided to render"));var r=getTemplate(e,dust.config.cache);return r?r(t,Context.wrap(n,r.templateName)):dust.onLoad?t.map(function(t){function r(e,r){var s;if(e)return t.setError(e);if(s=getTemplate(r,!1)||getTemplate(i,dust.config.cache),!s){if(!dust.compile)return t.setError(new Error("Dust compiler not available"));s=dust.loadSource(dust.compile(r,i))}s(t,Context.wrap(n,s.templateName)).end()}var i=e;3===dust.onLoad.length?dust.onLoad(i,n.options,r):dust.onLoad(i,r)}):t.setError(new Error("Template Not Found: "+e))}function Context(e,t,n,r,i){void 0===e||e instanceof Stack||(e=new Stack(e)),this.stack=e,this.global=t,this.options=n,this.blocks=r,this.templateName=i}function getWithResolvedData(e,t,n){return function(r){return e.push(r)._get(t,n)}}function Stack(e,t,n,r){this.tail=t,this.isObject=e&&"object"==typeof e,this.head=e,this.index=n,this.of=r}function Stub(e){this.head=new Chunk(this),this.callback=e,this.out=""}function Stream(){this.head=new Chunk(this)}function Chunk(e,t,n){this.root=e,this.next=t,this.data=[],this.flushable=!1,this.taps=n}function Tap(e,t){this.head=e,this.tail=t}var dust={version:"2.7.2"},NONE="NONE",ERROR="ERROR",WARN="WARN",INFO="INFO",DEBUG="DEBUG",EMPTY_FUNC=function(){};dust.config={whitespace:!1,amd:!1,cjs:!1,cache:!0},dust._aliases={write:"w",end:"e",map:"m",render:"r",reference:"f",section:"s",exists:"x",notexists:"nx",block:"b",partial:"p",helper:"h"},function(){var e,t,n={DEBUG:0,INFO:1,WARN:2,ERROR:3,NONE:4};"undefined"!=typeof console&&console.log?(e=console.log,t="function"==typeof e?function(){e.apply(console,arguments)}:function(){e(Array.prototype.slice.apply(arguments).join(" "))}):t=EMPTY_FUNC,dust.log=function(e,r){r=r||INFO,n[r]>=n[dust.debugLevel]&&t("[DUST:"+r+"]",e)},dust.debugLevel=NONE,"undefined"!=typeof process&&process.env&&/\bdust\b/.test(process.env.DEBUG)&&(dust.debugLevel=DEBUG)}(),dust.helpers={},dust.cache={},dust.register=function(e,t){e&&(t.templateName=e,dust.config.cache!==!1&&(dust.cache[e]=t))},dust.render=function(e,t,n){var r=(new Stub(n)).head;try{load(e,r,t).end()}catch(i){r.setError(i)}},dust.stream=function(e,t){var n=new Stream,r=n.head;return dust.nextTick(function(){try{load(e,r,t).end()}catch(n){r.setError(n)}}),n},dust.loadSource=function(source){return eval(source)},dust.isArray=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},dust.nextTick=function(){return function(e){setTimeout(e,0)}}(),dust.isEmpty=function(e){return 0===e?!1:dust.isArray(e)&&!e.length?!0:!e},dust.isEmptyObject=function(e){var t;if(null===e)return!1;if(void 0===e)return!1;if(e.length>0)return!1;for(t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0},dust.isTemplateFn=function(e){return"function"==typeof e&&e.__dustBody},dust.isThenable=function(e){return e&&"object"==typeof e&&"function"==typeof e.then},dust.isStreamable=function(e){return e&&"function"==typeof e.on&&"function"==typeof e.pipe},dust.filter=function(e,t,n,r){var i,s,o,u;if(n)for(i=0,s=n.length;s>i;i++)o=n[i],o.length&&(u=dust.filters[o],"s"===o?t=null:"function"==typeof u?e=u(e,r):dust.log("Invalid filter `"+o+"`",WARN));return t&&(e=dust.filters[t](e,r)),e},dust.filters={h:function(e){return dust.escapeHtml(e)},j:function(e){return dust.escapeJs(e)},u:encodeURI,uc:encodeURIComponent,js:function(e){return dust.escapeJSON(e)},jp:function(e){return JSON?JSON.parse(e):(dust.log("JSON is undefined; could not parse `"+e+"`",WARN),e)}},dust.makeBase=dust.context=function(e,t){return new Context(void 0,e,t)},Context.wrap=function(e,t){return e instanceof Context?e:new Context(e,{},{},null,t)},Context.prototype.get=function(e,t){return"string"==typeof e&&("."===e[0]&&(t=!0,e=e.substr(1)),e=e.split(".")),this._get(t,e)},Context.prototype._get=function(e,t){var n,r,i,s,o,u=this.stack||{},a=1;if(r=t[0],i=t.length,e&&0===i)s=u,u=u.head;else{if(e)u&&(u=u.head?u.head[r]:void 0);else{for(;u&&(!u.isObject||(s=u.head,n=u.head[r],void 0===n));)u=u.tail;u=void 0!==n?n:this.global&&this.global[r]}for(;u&&i>a;){if(dust.isThenable(u))return u.then(getWithResolvedData(this,e,t.slice(a)));s=u,u=u[t[a]],a++}}return"function"==typeof u?(o=function(){try{return u.apply(s,arguments)}catch(e){throw dust.log(e,ERROR),e}},o.__dustBody=!!u.__dustBody,o):(void 0===u&&dust.log("Cannot find reference `{"+t.join(".")+"}` in template `"+this.getTemplateName()+"`",INFO),u)},Context.prototype.getPath=function(e,t){return this._get(e,t)},Context.prototype.push=function(e,t,n){return void 0===e?(dust.log("Not pushing an undefined variable onto the context",INFO),this):this.rebase(new Stack(e,this.stack,t,n))},Context.prototype.pop=function(){var e=this.current();return this.stack=this.stack&&this.stack.tail,e},Context.prototype.rebase=function(e){return new Context(e,this.global,this.options,this.blocks,this.getTemplateName())},Context.prototype.clone=function(){var e=this.rebase();return e.stack=this.stack,e},Context.prototype.current=function(){return this.stack&&this.stack.head},Context.prototype.getBlock=function(e){var t,n,r;if("function"==typeof e&&(e=e(new Chunk,this).data.join("")),t=this.blocks,!t)return dust.log("No blocks for context `"+e+"` in template `"+this.getTemplateName()+"`",DEBUG),!1;for(n=t.length;n--;)if(r=t[n][e])return r;return dust.log("Malformed template `"+this.getTemplateName()+"` was missing one or more blocks."),!1},Context.prototype.shiftBlocks=function(e){var t,n=this.blocks;return e?(t=n?n.concat([e]):[e],new Context(this.stack,this.global,this.options,t,this.getTemplateName())):this},Context.prototype.resolve=function(e){var t;return"function"!=typeof e?e:(t=(new Chunk).render(e,this),t instanceof Chunk?t.data.join(""):t)},Context.prototype.getTemplateName=function(){return this.templateName},Stub.prototype.flush=function(){for(var e=this.head;e;){if(!e.flushable)return e.error?(this.callback(e.error),dust.log("Rendering failed with error `"+e.error+"`",ERROR),void (this.flush=EMPTY_FUNC)):void 0;this.out+=e.data.join(""),e=e.next,this.head=e}this.callback(null,this.out)},Stream.prototype.flush=function(){for(var e=this.head;e;){if(!e.flushable)return e.error?(this.emit("error",e.error),this.emit("end"),dust.log("Streaming failed with error `"+e.error+"`",ERROR),void (this.flush=EMPTY_FUNC)):void 0;this.emit("data",e.data.join("")),e=e.next,this.head=e}this.emit("end")},Stream.prototype.emit=function(e,t){var n,r,i=this.events||{},s=i[e]||[];if(!s.length)return dust.log("Stream broadcasting, but no listeners for `"+e+"`",DEBUG),!1;for(s=s.slice(0),n=0,r=s.length;r>n;n++)s[n](t);return!0},Stream.prototype.on=function(e,t){var n=this.events=this.events||{},r=n[e]=n[e]||[];return"function"!=typeof t?dust.log("No callback function provided for `"+e+"` event listener",WARN):r.push(t),this},Stream.prototype.pipe=function(e){if("function"!=typeof e.write||"function"!=typeof e.end)return dust.log("Incompatible stream passed to `pipe`",WARN),this;var t=!1;return"function"==typeof e.emit&&e.emit("pipe",this),"function"==typeof e.on&&e.on("error",function(){t=!0}),this.on("data",function(n){if(!t)try{e.write(n,"utf8")}catch(r){dust.log(r,ERROR)}}).on("end",function(){if(!t)try{e.end(),t=!0}catch(n){dust.log(n,ERROR)}})},Chunk.prototype.write=function(e){var t=this.taps;return t&&(e=t.go(e)),this.data.push(e),this},Chunk.prototype.end=function(e){return e&&this.write(e),this.flushable=!0,this.root.flush(),this},Chunk.prototype.map=function(e){var t=new Chunk(this.root,this.next,this.taps),n=new Chunk(this.root,t,this.taps);this.next=n,this.flushable=!0;try{e(n)}catch(r){dust.log(r,ERROR),n.setError(r)}return t},Chunk.prototype.tap=function(e){var t=this.taps;return this.taps=t?t.push(e):new Tap(e),this},Chunk.prototype.untap=function(){return this.taps=this.taps.tail,this},Chunk.prototype.render=function(e,t){return e(this,t)},Chunk.prototype.reference=function(e,t,n,r){return"function"==typeof e?(e=e.apply(t.current(),[this,t,null,{auto:n,filters:r}]),e instanceof Chunk?e:this.reference(e,t,n,r)):dust.isThenable(e)?this.await(e,t,null,n,r):dust.isStreamable(e)?this.stream(e,t,null,n,r):dust.isEmpty(e)?this:this.write(dust.filter(e,n,r,t))},Chunk.prototype.section=function(e,t,n,r){var i,s,o,u=n.block,a=n["else"],f=this;if("function"==typeof e&&!dust.isTemplateFn(e)){try{e=e.apply(t.current(),[this,t,n,r])}catch(l){return dust.log(l,ERROR),this.setError(l)}if(e instanceof Chunk)return e}if(dust.isEmptyObject(n))return f;if(dust.isEmptyObject(r)||(t=t.push(r)),dust.isArray(e)){if(u){if(s=e.length,s>0){for(o=t.stack&&t.stack.head||{},o.$len=s,i=0;s>i;i++)o.$idx=i,f=u(f,t.push(e[i],i,s));return o.$idx=void 0,o.$len=void 0,f}if(a)return a(this,t)}}else{if(dust.isThenable(e))return this.await(e,t,n);if(dust.isStreamable(e))return this.stream(e,t,n);if(e===!0){if(u)return u(this,t)}else if(e||0===e){if(u)return u(this,t.push(e))}else if(a)return a(this,t)}return dust.log("Section without corresponding key in template `"+t.getTemplateName()+"`",DEBUG),this},Chunk.prototype.exists=function(e,t,n){var r=n.block,i=n["else"];if(dust.isEmpty(e)){if(i)return i(this,t)}else{if(r)return r(this,t);dust.log("No block for exists check in template `"+t.getTemplateName()+"`",DEBUG)}return this},Chunk.prototype.notexists=function(e,t,n){var r=n.block,i=n["else"];if(dust.isEmpty(e)){if(r)return r(this,t);dust.log("No block for not-exists check in template `"+t.getTemplateName()+"`",DEBUG)}else if(i)return i(this,t);return this},Chunk.prototype.block=function(e,t,n){var r=e||n.block;return r?r(this,t):this},Chunk.prototype.partial=function(e,t,n,r){var i;return void 0===r&&(r=n,n=t),dust.isEmptyObject(r)||(n=n.clone(),i=n.pop(),n=n.push(r).push(i)),dust.isTemplateFn(e)?this.capture(e,t,function(e,t){n.templateName=e,load(e,t,n).end()}):(n.templateName=e,load(e,this,n))},Chunk.prototype.helper=function(e,t,n,r,i){var s,o=this,u=r.filters;if(void 0===i&&(i="h"),!dust.helpers[e])return dust.log("Helper `"+e+"` does not exist",WARN),o;try{return s=dust.helpers[e](o,t,n,r),s instanceof Chunk?s:("string"==typeof u&&(u=u.split("|")),dust.isEmptyObject(n)?o.reference(s,t,i,u):o.section(s,t,n,r))}catch(a){return dust.log("Error in helper `"+e+"`: "+a.message,ERROR),o.setError(a)}},Chunk.prototype.await=function(e,t,n,r,i){return this.map(function(s){e.then(function(e){s=n?s.section(e,t,n):s.reference(e,t,r,i),s.end()},function(e){var r=n&&n.error;r?s.render(r,t.push(e)).end():(dust.log("Unhandled promise rejection in `"+t.getTemplateName()+"`",INFO),s.end())})})},Chunk.prototype.stream=function(e,t,n,r,i){var s=n&&n.block,o=n&&n.error;return this.map(function(u){var l=!1;e.on("data",function(e){l||(s?u=u.map(function(n){n.render(s,t.push(e)).end()}):n||(u=u.reference(e,t,r,i)))}).on("error",function(e){l||(o?u.render(o,t.push(e)):dust.log("Unhandled stream error in `"+t.getTemplateName()+"`",INFO),l||(l=!0,u.end()))}).on("end",function(){l||(l=!0,u.end())})})},Chunk.prototype.capture=function(e,t,n){return this.map(function(r){var i=new Stub(function(e,t){e?r.setError(e):n(t,r)});e(i.head,t).end()})},Chunk.prototype.setError=function(e){return this.error=e,this.root.flush(),this};for(var f in Chunk.prototype)dust._aliases[f]&&(Chunk.prototype[dust._aliases[f]]=Chunk.prototype[f]);Tap.prototype.push=function(e){return new Tap(e,this)},Tap.prototype.go=function(e){for(var t=this;t;)e=t.head(e),t=t.tail;return e};var HCHARS=/[&<>"']/,AMP=/&/g,LT=/</g,GT=/>/g,QUOT=/\"/g,SQUOT=/\'/g;dust.escapeHtml=function(e){return"string"==typeof e||e&&"function"==typeof e.toString?("string"!=typeof e&&(e=e.toString()),HCHARS.test(e)?e.replace(AMP,"&amp;").replace(LT,"&lt;").replace(GT,"&gt;").replace(QUOT,"&quot;").replace(SQUOT,"&#39;"):e):e};var BS=/\\/g,FS=/\//g,CR=/\r/g,LS=/\u2028/g,PS=/\u2029/g,NL=/\n/g,LF=/\f/g,SQ=/'/g,DQ=/"/g,TB=/\t/g;return dust.escapeJs=function(e){return"string"==typeof e?e.replace(BS,"\\\\").replace(FS,"\\/").replace(DQ,'\\"').replace(SQ,"\\'").replace(CR,"\\r").replace(LS,"\\u2028").replace(PS,"\\u2029").replace(NL,"\\n").replace(LF,"\\f").replace(TB,"\\t"):e},dust.escapeJSON=function(e){return JSON?JSON.stringify(e).replace(LS,"\\u2028").replace(PS,"\\u2029").replace(LT,"\\u003c"):(dust.log("JSON is undefined; could not escape `"+e+"`",WARN),e)},dust}),function(e,t){"function"==typeof define&&define.amd&&define.amd.dust===!0?define("dust.parse",["dust.core"],function(e){return t(e).parse}):"object"==typeof exports?module.exports=t(require("./dust")):t(e.dust)}(this,function(e){var t=function(){function e(e,t){function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n}function t(e,t,n,r,i,s){this.message=e,this.expected=t,this.found=n,this.offset=r,this.line=i,this.column=s,this.name="SyntaxError"}function n(e){function n(){return s(Tr).line}function r(){return s(Tr).column}function i(e){throw u(e,null,Tr)}function s(t){function n(t,n,r){var i,s;for(i=n;r>i;i++)s=e.charAt(i),"\n"===s?(t.seenCR||t.line++,t.column=1,t.seenCR=!1):"\r"===s||"\u2028"===s||"\u2029"===s?(t.line++,t.column=1,t.seenCR=!0):(t.column++,t.seenCR=!1)}return Nr!==t&&(Nr>t&&(Nr=0,Cr={line:1,column:1,seenCR:!1}),n(Cr,Nr,t),Nr=t),Cr}function o(e){kr>xr||(xr>kr&&(kr=xr,Lr=[]),Lr.push(e))}function u(n,r,i){function o(e){var t=1;for(e.sort(function(e,t){return e.description<t.description?-1:e.description>t.description?1:0});t<e.length;)e[t-1]===e[t]?e.splice(t,1):t++}function u(e,t){function n(e){function t(e){return e.charCodeAt(0).toString(16).toUpperCase()}return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(e){return"\\x0"+t(e)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(e){return"\\x"+t(e)}).replace(/[\u0180-\u0FFF]/g,function(e){return"\\u0"+t(e)}).replace(/[\u1080-\uFFFF]/g,function(e){return"\\u"+t(e)})}var r,i,s,o=new Array(e.length);for(s=0;s<e.length;s++)o[s]=e[s].description;return r=e.length>1?o.slice(0,-1).join(", ")+" or "+o[e.length-1]:o[0],i=t?'"'+n(t)+'"':"end of input","Expected "+r+" but "+i+" found."}var a=s(i),f=i<e.length?e.charAt(i):null;return null!==r&&o(r),new t(null!==n?n:u(r,f),r,f,i,a.line,a.column)}function a(){var e;return e=f()}function f(){var e,t,n;for(e=xr,t=[],n=l();n!==Q;)t.push(n),n=l();return t!==Q&&(Tr=e,t=Z(t)),e=t}function l(){var e;return e=j(),e===Q&&(e=F(),e===Q&&(e=c(),e===Q&&(e=y(),e===Q&&(e=E(),e===Q&&(e=g(),e===Q&&(e=P())))))),e}function c(){var t,n,r,i,s,u,a,l;if(Ar++,t=xr,n=h(),n!==Q){for(r=[],i=X();i!==Q;)r.push(i),i=X();r!==Q?(i=R(),i!==Q?(s=f(),s!==Q?(u=m(),u!==Q?(a=p(),a===Q&&(a=nt),a!==Q?(Tr=xr,l=rt(n,s,u,a),l=l?it:tt,l!==Q?(Tr=t,n=st(n,s,u,a),t=n):(xr=t,t=tt)):(xr=t,t=tt)):(xr=t,t=tt)):(xr=t,t=tt)):(xr=t,t=tt)):(xr=t,t=tt)}else xr=t,t=tt;if(t===Q)if(t=xr,n=h(),n!==Q){for(r=[],i=X();i!==Q;)r.push(i),i=X();r!==Q?(47===e.charCodeAt(xr)?(i=ot,xr++):(i=Q,0===Ar&&o(ut)),i!==Q?(s=R(),s!==Q?(Tr=t,n=at(n),t=n):(xr=t,t=tt)):(xr=t,t=tt)):(xr=t,t=tt)}else xr=t,t=tt;return Ar--,t===Q&&(n=Q,0===Ar&&o(et)),t}function h(){var t,n,r,i,s,u,a;if(t=xr,n=q(),n!==Q)if(ft.test(e.charAt(xr))?(r=e.charAt(xr),xr++):(r=Q,0===Ar&&o(lt)),r!==Q){for(i=[],s=X();s!==Q;)i.push(s),s=X();i!==Q?(s=S(),s!==Q?(u=d(),u!==Q?(a=v(),a!==Q?(Tr=t,n=ct(r,s,u,a),t=n):(xr=t,t=tt)):(xr=t,t=tt)):(xr=t,t=tt)):(xr=t,t=tt)}else xr=t,t=tt;else xr=t,t=tt;return t}function p(){var t,n,r,i,s,u,a;if(Ar++,t=xr,n=q(),n!==Q)if(47===e.charCodeAt(xr)?(r=ot,xr++):(r=Q,0===Ar&&o(ut)),r!==Q){for(i=[],s=X();s!==Q;)i.push(s),s=X();if(i!==Q)if(s=S(),s!==Q){for(u=[],a=X();a!==Q;)u.push(a),a=X();u!==Q?(a=R(),a!==Q?(Tr=t,n=pt(s),t=n):(xr=t,t=tt)):(xr=t,t=tt)}else xr=t,t=tt;else xr=t,t=tt}else xr=t,t=tt;else xr=t,t=tt;return Ar--,t===Q&&(n=Q,0===Ar&&o(ht)),t}function d(){var t,n,r,i;return t=xr,n=xr,58===e.charCodeAt(xr)?(r=dt,xr++):(r=Q,0===Ar&&o(vt)),r!==Q?(i=S(),i!==Q?(Tr=n,r=mt(i),n=r):(xr=n,n=tt)):(xr=n,n=tt),n===Q&&(n=nt),n!==Q&&(Tr=t,n=gt(n)),t=n}function v(){var t,n,r,i,s,u,a;if(Ar++,t=xr,n=[],r=xr,i=[],s=X(),s!==Q)for(;s!==Q;)i.push(s),s=X();else i=tt;for(i!==Q?(s=A(),s!==Q?(61===e.charCodeAt(xr)?(u=bt,xr++):(u=Q,0===Ar&&o(wt)),u!==Q?(a=x(),a===Q&&(a=S(),a===Q&&(a=_())),a!==Q?(Tr=r,i=Et(s,a),r=i):(xr=r,r=tt)):(xr=r,r=tt)):(xr=r,r=tt)):(xr=r,r=tt);r!==Q;){if(n.push(r),r=xr,i=[],s=X(),s!==Q)for(;s!==Q;)i.push(s),s=X();else i=tt;i!==Q?(s=A(),s!==Q?(61===e.charCodeAt(xr)?(u=bt,xr++):(u=Q,0===Ar&&o(wt)),u!==Q?(a=x(),a===Q&&(a=S(),a===Q&&(a=_())),a!==Q?(Tr=r,i=Et(s,a),r=i):(xr=r,r=tt)):(xr=r,r=tt)):(xr=r,r=tt)):(xr=r,r=tt)}return n!==Q&&(Tr=t,n=St(n)),t=n,Ar--,t===Q&&(n=Q,0===Ar&&o(yt)),t}function m(){var t,n,r,i,s,u,a,l;for(Ar++,t=xr,n=[],r=xr,i=q(),i!==Q?(58===e.charCodeAt(xr)?(s=dt,xr++):(s=Q,0===Ar&&o(vt)),s!==Q?(u=A(),u!==Q?(a=R(),a!==Q?(l=f(),l!==Q?(Tr=r,i=Et(u,l),r=i):(xr=r,r=tt)):(xr=r,r=tt)):(xr=r,r=tt)):(xr=r,r=tt)):(xr=r,r=tt);r!==Q;)n.push(r),r=xr,i=q(),i!==Q?(58===e.charCodeAt(xr)?(s=dt,xr++):(s=Q,0===Ar&&o(vt)),s!==Q?(u=A(),u!==Q?(a=R(),a!==Q?(l=f(),l!==Q?(Tr=r,i=Et(u,l),r=i):(xr=r,r=tt)):(xr=r,r=tt)):(xr=r,r=tt)):(xr=r,r=tt)):(xr=r,r=tt);return n!==Q&&(Tr=t,n=Tt(n)),t=n,Ar--,t===Q&&(n=Q,0===Ar&&o(xt)),t}function g(){var e,t,n,r,i;return Ar++,e=xr,t=q(),t!==Q?(n=S(),n!==Q?(r=w(),r!==Q?(i=R(),i!==Q?(Tr=e,t=Ct(n,r),e=t):(xr=e,e=tt)):(xr=e,e=tt)):(xr=e,e=tt)):(xr=e,e=tt),Ar--,e===Q&&(t=Q,0===Ar&&o(Nt)),e}function y(){var t,n,r,i,s,u,a,f,l,c;if(Ar++,t=xr,n=q(),n!==Q)if(62===e.charCodeAt(xr)?(r=Lt,xr++):(r=Q,0===Ar&&o(At)),r===Q&&(43===e.charCodeAt(xr)?(r=Ot,xr++):(r=Q,0===Ar&&o(Mt))),r!==Q){for(i=[],s=X();s!==Q;)i.push(s),s=X();if(i!==Q)if(s=xr,u=A(),u!==Q&&(Tr=s,u=_t(u)),s=u,s===Q&&(s=_()),s!==Q)if(u=d(),u!==Q)if(a=v(),a!==Q){for(f=[],l=X();l!==Q;)f.push(l),l=X();f!==Q?(47===e.charCodeAt(xr)?(l=ot,xr++):(l=Q,0===Ar&&o(ut)),l!==Q?(c=R(),c!==Q?(Tr=t,n=Dt(r,s,u,a),t=n):(xr=t,t=tt)):(xr=t,t=tt)):(xr=t,t=tt)}else xr=t,t=tt;else xr=t,t=tt;else xr=t,t=tt;else xr=t,t=tt}else xr=t,t=tt;else xr=t,t=tt;return Ar--,t===Q&&(n=Q,0===Ar&&o(kt)),t}function w(){var t,n,r,i,s;for(Ar++,t=xr,n=[],r=xr,124===e.charCodeAt(xr)?(i=Ht,xr++):(i=Q,0===Ar&&o(Bt)),i!==Q?(s=A(),s!==Q?(Tr=r,i=mt(s),r=i):(xr=r,r=tt)):(xr=r,r=tt);r!==Q;)n.push(r),r=xr,124===e.charCodeAt(xr)?(i=Ht,xr++):(i=Q,0===Ar&&o(Bt)),i!==Q?(s=A(),s!==Q?(Tr=r,i=mt(s),r=i):(xr=r,r=tt)):(xr=r,r=tt);return n!==Q&&(Tr=t,n=jt(n)),t=n,Ar--,t===Q&&(n=Q,0===Ar&&o(Pt)),t}function E(){var t,n,r,i,s;return Ar++,t=xr,n=q(),n!==Q?(126===e.charCodeAt(xr)?(r=It,xr++):(r=Q,0===Ar&&o(qt)),r!==Q?(i=A(),i!==Q?(s=R(),s!==Q?(Tr=t,n=Rt(i),t=n):(xr=t,t=tt)):(xr=t,t=tt)):(xr=t,t=tt)):(xr=t,t=tt),Ar--,t===Q&&(n=Q,0===Ar&&o(Ft)),t}function S(){var e,t;return Ar++,e=xr,t=L(),t!==Q&&(Tr=e,t=zt(t)),e=t,e===Q&&(e=xr,t=A(),t!==Q&&(Tr=e,t=Wt(t)),e=t),Ar--,e===Q&&(t=Q,0===Ar&&o(Ut)),e}function x(){var e,t;return Ar++,e=xr,t=T(),t===Q&&(t=k()),t!==Q&&(Tr=e,t=Vt(t)),e=t,Ar--,e===Q&&(t=Q,0===Ar&&o(Xt)),e}function T(){var t,n,r,i;return Ar++,t=xr,n=k(),n!==Q?(46===e.charCodeAt(xr)?(r=Jt,xr++):(r=Q,0===Ar&&o(Kt)),r!==Q?(i=N(),i!==Q?(Tr=t,n=Qt(n,i),t=n):(xr=t,t=tt)):(xr=t,t=tt)):(xr=t,t=tt),Ar--,t===Q&&(n=Q,0===Ar&&o($t)),t}function N(){var t,n,r;if(Ar++,t=xr,n=[],Yt.test(e.charAt(xr))?(r=e.charAt(xr),xr++):(r=Q,0===Ar&&o(Zt)),r!==Q)for(;r!==Q;)n.push(r),Yt.test(e.charAt(xr))?(r=e.charAt(xr),xr++):(r=Q,0===Ar&&o(Zt));else n=tt;return n!==Q&&(Tr=t,n=en(n)),t=n,Ar--,t===Q&&(n=Q,0===Ar&&o(Gt)),t}function C(){var t,n,r;return Ar++,t=xr,45===e.charCodeAt(xr)?(n=nn,xr++):(n=Q,0===Ar&&o(rn)),n!==Q?(r=N(),r!==Q?(Tr=t,n=sn(n,r),t=n):(xr=t,t=tt)):(xr=t,t=tt),Ar--,t===Q&&(n=Q,0===Ar&&o(tn)),t}function k(){var e,t;return Ar++,e=C(),e===Q&&(e=N()),Ar--,e===Q&&(t=Q,0===Ar&&o(on)),e}function L(){var t,n,r,i;if(Ar++,t=xr,n=A(),n===Q&&(n=nt),n!==Q){if(r=[],i=M(),i===Q&&(i=O()),i!==Q)for(;i!==Q;)r.push(i),i=M(),i===Q&&(i=O());else r=tt;r!==Q?(Tr=t,n=an(n,r),t=n):(xr=t,t=tt)}else xr=t,t=tt;if(t===Q)if(t=xr,46===e.charCodeAt(xr)?(n=Jt,xr++):(n=Q,0===Ar&&o(Kt)),n!==Q){for(r=[],i=M(),i===Q&&(i=O());i!==Q;)r.push(i),i=M(),i===Q&&(i=O());r!==Q?(Tr=t,n=fn(r),t=n):(xr=t,t=tt)}else xr=t,t=tt;return Ar--,t===Q&&(n=Q,0===Ar&&o(un)),t}function A(){var t,n,r,i;if(Ar++,t=xr,cn.test(e.charAt(xr))?(n=e.charAt(xr),xr++):(n=Q,0===Ar&&o(hn)),n!==Q){for(r=[],pn.test(e.charAt(xr))?(i=e.charAt(xr),xr++):(i=Q,0===Ar&&o(dn));i!==Q;)r.push(i),pn.test(e.charAt(xr))?(i=e.charAt(xr),xr++):(i=Q,0===Ar&&o(dn));r!==Q?(Tr=t,n=vn(n,r),t=n):(xr=t,t=tt)}else xr=t,t=tt;return Ar--,t===Q&&(n=Q,0===Ar&&o(ln)),t}function O(){var t,n,r,i,s,u;if(Ar++,t=xr,n=xr,r=U(),r!==Q){if(i=xr,s=[],Yt.test(e.charAt(xr))?(u=e.charAt(xr),xr++):(u=Q,0===Ar&&o(Zt)),u!==Q)for(;u!==Q;)s.push(u),Yt.test(e.charAt(xr))?(u=e.charAt(xr),xr++):(u=Q,0===Ar&&o(Zt));else s=tt;s!==Q&&(Tr=i,s=gn(s)),i=s,i===Q&&(i=S()),i!==Q?(s=z(),s!==Q?(Tr=n,r=yn(i),n=r):(xr=n,n=tt)):(xr=n,n=tt)}else xr=n,n=tt;return n!==Q?(r=M(),r===Q&&(r=nt),r!==Q?(Tr=t,n=bn(n,r),t=n):(xr=t,t=tt)):(xr=t,t=tt),Ar--,t===Q&&(n=Q,0===Ar&&o(mn)),t}function M(){var t,n,r,i,s;if(Ar++,t=xr,n=[],r=xr,46===e.charCodeAt(xr)?(i=Jt,xr++):(i=Q,0===Ar&&o(Kt)),i!==Q?(s=A(),s!==Q?(Tr=r,i=En(s),r=i):(xr=r,r=tt)):(xr=r,r=tt),r!==Q)for(;r!==Q;)n.push(r),r=xr,46===e.charCodeAt(xr)?(i=Jt,xr++):(i=Q,0===Ar&&o(Kt)),i!==Q?(s=A(),s!==Q?(Tr=r,i=En(s),r=i):(xr=r,r=tt)):(xr=r,r=tt);else n=tt;return n!==Q?(r=O(),r===Q&&(r=nt),r!==Q?(Tr=t,n=Sn(n,r),t=n):(xr=t,t=tt)):(xr=t,t=tt),Ar--,t===Q&&(n=Q,0===Ar&&o(wn)),t}function _(){var t,n,r,i;if(Ar++,t=xr,34===e.charCodeAt(xr)?(n=Tn,xr++):(n=Q,0===Ar&&o(Nn)),n!==Q?(34===e.charCodeAt(xr)?(r=Tn,xr++):(r=Q,0===Ar&&o(Nn)),r!==Q?(Tr=t,n=Cn(),t=n):(xr=t,t=tt)):(xr=t,t=tt),t===Q&&(t=xr,34===e.charCodeAt(xr)?(n=Tn,xr++):(n=Q,0===Ar&&o(Nn)),n!==Q?(r=H(),r!==Q?(34===e.charCodeAt(xr)?(i=Tn,xr++):(i=Q,0===Ar&&o(Nn)),i!==Q?(Tr=t,n=kn(r),t=n):(xr=t,t=tt)):(xr=t,t=tt)):(xr=t,t=tt),t===Q))if(t=xr,34===e.charCodeAt(xr)?(n=Tn,xr++):(n=Q,0===Ar&&o(Nn)),n!==Q){if(r=[],i=D(),i!==Q)for(;i!==Q;)r.push(i),i=D();else r=tt;r!==Q?(34===e.charCodeAt(xr)?(i=Tn,xr++):(i=Q,0===Ar&&o(Nn)),i!==Q?(Tr=t,n=Ln(r),t=n):(xr=t,t=tt)):(xr=t,t=tt)}else xr=t,t=tt;return Ar--,t===Q&&(n=Q,0===Ar&&o(xn)),t}function D(){var e,t;return e=E(),e===Q&&(e=g(),e===Q&&(e=xr,t=H(),t!==Q&&(Tr=e,t=An(t)),e=t)),e}function P(){var t,n,r,i,s,u,a,f;if(Ar++,t=xr,n=W(),n!==Q){for(r=[],i=X();i!==Q;)r.push(i),i=X();r!==Q?(Tr=t,n=Mn(n,r),t=n):(xr=t,t=tt)}else xr=t,t=tt;if(t===Q){if(t=xr,n=[],r=xr,i=xr,Ar++,s=I(),Ar--,s===Q?i=it:(xr=i,i=tt),i!==Q?(s=xr,Ar++,u=j(),Ar--,u===Q?s=it:(xr=s,s=tt),s!==Q?(u=xr,Ar++,a=F(),Ar--,a===Q?u=it:(xr=u,u=tt),u!==Q?(a=xr,Ar++,f=W(),Ar--,f===Q?a=it:(xr=a,a=tt),a!==Q?(e.length>xr?(f=e.charAt(xr),xr++):(f=Q,0===Ar&&o(_n)),f!==Q?(Tr=r,i=Dn(f),r=i):(xr=r,r=tt)):(xr=r,r=tt)):(xr=r,r=tt)):(xr=r,r=tt)):(xr=r,r=tt),r!==Q)for(;r!==Q;)n.push(r),r=xr,i=xr,Ar++,s=I(),Ar--,s===Q?i=it:(xr=i,i=tt),i!==Q?(s=xr,Ar++,u=j(),Ar--,u===Q?s=it:(xr=s,s=tt),s!==Q?(u=xr,Ar++,a=F(),Ar--,a===Q?u=it:(xr=u,u=tt),u!==Q?(a=xr,Ar++,f=W(),Ar--,f===Q?a=it:(xr=a,a=tt),a!==Q?(e.length>xr?(f=e.charAt(xr),xr++):(f=Q,0===Ar&&o(_n)),f!==Q?(Tr=r,i=Dn(f),r=i):(xr=r,r=tt)):(xr=r,r=tt)):(xr=r,r=tt)):(xr=r,r=tt)):(xr=r,r=tt);else n=tt;n!==Q&&(Tr=t,n=Pn(n)),t=n}return Ar--,t===Q&&(n=Q,0===Ar&&o(On)),t}function H(){var t,n,r,i,s;if(Ar++,t=xr,n=[],r=xr,i=xr,Ar++,s=I(),Ar--,s===Q?i=it:(xr=i,i=tt),i!==Q?(s=B(),s===Q&&(Bn.test(e.charAt(xr))?(s=e.charAt(xr),xr++):(s=Q,0===Ar&&o(jn))),s!==Q?(Tr=r,i=Dn(s),r=i):(xr=r,r=tt)):(xr=r,r=tt),r!==Q)for(;r!==Q;)n.push(r),r=xr,i=xr,Ar++,s=I(),Ar--,s===Q?i=it:(xr=i,i=tt),i!==Q?(s=B(),s===Q&&(Bn.test(e.charAt(xr))?(s=e.charAt(xr),xr++):(s=Q,0===Ar&&o(jn))),s!==Q?(Tr=r,i=Dn(s),r=i):(xr=r,r=tt)):(xr=r,r=tt);else n=tt;return n!==Q&&(Tr=t,n=Fn(n)),t=n,Ar--,t===Q&&(n=Q,0===Ar&&o(Hn)),t}function B(){var t,n;return t=xr,e.substr(xr,2)===In?(n=In,xr+=2):(n=Q,0===Ar&&o(qn)),n!==Q&&(Tr=t,n=Rn()),t=n}function j(){var t,n,r,i,s,u;if(Ar++,t=xr,e.substr(xr,2)===zn?(n=zn,xr+=2):(n=Q,0===Ar&&o(Wn)),n!==Q){for(r=[],i=xr,s=xr,Ar++,e.substr(xr,2)===Xn?(u=Xn,xr+=2):(u=Q,0===Ar&&o(Vn)),Ar--,u===Q?s=it:(xr=s,s=tt),s!==Q?(e.length>xr?(u=e.charAt(xr),xr++):(u=Q,0===Ar&&o(_n)),u!==Q?(Tr=i,s=$n(u),i=s):(xr=i,i=tt)):(xr=i,i=tt);i!==Q;)r.push(i),i=xr,s=xr,Ar++,e.substr(xr,2)===Xn?(u=Xn,xr+=2):(u=Q,0===Ar&&o(Vn)),Ar--,u===Q?s=it:(xr=s,s=tt),s!==Q?(e.length>xr?(u=e.charAt(xr),xr++):(u=Q,0===Ar&&o(_n)),u!==Q?(Tr=i,s=$n(u),i=s):(xr=i,i=tt)):(xr=i,i=tt);r!==Q?(e.substr(xr,2)===Xn?(i=Xn,xr+=2):(i=Q,0===Ar&&o(Vn)),i!==Q?(Tr=t,n=Jn(r),t=n):(xr=t,t=tt)):(xr=t,t=tt)}else xr=t,t=tt;return Ar--,t===Q&&(n=Q,0===Ar&&o(Un)),t}function F(){var t,n,r,i,s,u;if(Ar++,t=xr,e.substr(xr,2)===Qn?(n=Qn,xr+=2):(n=Q,0===Ar&&o(Gn)),n!==Q){for(r=[],i=xr,s=xr,Ar++,e.substr(xr,2)===Yn?(u=Yn,xr+=2):(u=Q,0===Ar&&o(Zn)),Ar--,u===Q?s=it:(xr=s,s=tt),s!==Q?(e.length>xr?(u=e.charAt(xr),xr++):(u=Q,0===Ar&&o(_n)),u!==Q?(Tr=i,s=Dn(u),i=s):(xr=i,i=tt)):(xr=i,i=tt);i!==Q;)r.push(i),i=xr,s=xr,Ar++,e.substr(xr,2)===Yn?(u=Yn,xr+=2):(u=Q,0===Ar&&o(Zn)),Ar--,u===Q?s=it:(xr=s,s=tt),s!==Q?(e.length>xr?(u=e.charAt(xr),xr++):(u=Q,0===Ar&&o(_n)),u!==Q?(Tr=i,s=Dn(u),i=s):(xr=i,i=tt)):(xr=i,i=tt);r!==Q?(e.substr(xr,2)===Yn?(i=Yn,xr+=2):(i=Q,0===Ar&&o(Zn)),i!==Q?(Tr=t,n=er(r),t=n):(xr=t,t=tt)):(xr=t,t=tt)}else xr=t,t=tt;return Ar--,t===Q&&(n=Q,0===Ar&&o(Kn)),t}function I(){var t,n,r,i,s,u,a,f,l,c;if(t=xr,n=q(),n!==Q){for(r=[],i=X();i!==Q;)r.push(i),i=X();if(r!==Q)if(tr.test(e.charAt(xr))?(i=e.charAt(xr),xr++):(i=Q,0===Ar&&o(nr)),i!==Q){for(s=[],u=X();u!==Q;)s.push(u),u=X();if(s!==Q){if(u=[],a=xr,f=xr,Ar++,l=R(),Ar--,l===Q?f=it:(xr=f,f=tt),f!==Q?(l=xr,Ar++,c=W(),Ar--,c===Q?l=it:(xr=l,l=tt),l!==Q?(e.length>xr?(c=e.charAt(xr),xr++):(c=Q,0===Ar&&o(_n)),c!==Q?(f=[f,l,c],a=f):(xr=a,a=tt)):(xr=a,a=tt)):(xr=a,a=tt),a!==Q)for(;a!==Q;)u.push(a),a=xr,f=xr,Ar++,l=R(),Ar--,l===Q?f=it:(xr=f,f=tt),f!==Q?(l=xr,Ar++,c=W(),Ar--,c===Q?l=it:(xr=l,l=tt),l!==Q?(e.length>xr?(c=e.charAt(xr),xr++):(c=Q,0===Ar&&o(_n)),c!==Q?(f=[f,l,c],a=f):(xr=a,a=tt)):(xr=a,a=tt)):(xr=a,a=tt);else u=tt;if(u!==Q){for(a=[],f=X();f!==Q;)a.push(f),f=X();a!==Q?(f=R(),f!==Q?(n=[n,r,i,s,u,a,f],t=n):(xr=t,t=tt)):(xr=t,t=tt)}else xr=t,t=tt}else xr=t,t=tt}else xr=t,t=tt;else xr=t,t=tt}else xr=t,t=tt;return t===Q&&(t=g()),t}function q(){var t;return 123===e.charCodeAt(xr)?(t=rr,xr++):(t=Q,0===Ar&&o(ir)),t}function R(){var t;return 125===e.charCodeAt(xr)?(t=sr,xr++):(t=Q,0===Ar&&o(or)),t}function U(){var t;return 91===e.charCodeAt(xr)?(t=ur,xr++):(t=Q,0===Ar&&o(ar)),t}function z(){var t;return 93===e.charCodeAt(xr)?(t=fr,xr++):(t=Q,0===Ar&&o(lr)),t}function W(){var t;return 10===e.charCodeAt(xr)?(t=cr,xr++):(t=Q,0===Ar&&o(hr)),t===Q&&(e.substr(xr,2)===pr?(t=pr,xr+=2):(t=Q,0===Ar&&o(dr)),t===Q&&(13===e.charCodeAt(xr)?(t=vr,xr++):(t=Q,0===Ar&&o(mr)),t===Q&&(8232===e.charCodeAt(xr)?(t=gr,xr++):(t=Q,0===Ar&&o(yr)),t===Q&&(8233===e.charCodeAt(xr)?(t=br,xr++):(t=Q,0===Ar&&o(wr)))))),t}function X(){var t;return Er.test(e.charAt(xr))?(t=e.charAt(xr),xr++):(t=Q,0===Ar&&o(Sr)),t===Q&&(t=W()),t}function V(e){return parseInt(e.join(""),10)}function $(e){return e.concat([["line",n()],["col",r()]])}var J,K=arguments.length>1?arguments[1]:{},Q={},G={start:a},Y=a,Z=function(e){var t=["body"].concat(e);return $(t)},et={type:"other",description:"section"},tt=Q,nt=null,rt=function(e,t,n,r){return r&&e[1].text===r.text||i("Expected end tag for "+e[1].text+" but it was not found."),!0},it=void 0,st=function(e,t,n){return n.push(["param",["literal","block"],t]),e.push(n,["filters"]),$(e)},ot="/",ut={type:"literal",value:"/",description:'"/"'},at=function(e){return e.push(["bodies"],["filters"]),$(e)},ft=/^[#?\^<+@%]/,lt={type:"class",value:"[#?\\^<+@%]",description:"[#?\\^<+@%]"},ct=function(e,t,n,r){return[e,t,n,r]},ht={type:"other",description:"end tag"},pt=function(e){return e},dt=":",vt={type:"literal",value:":",description:'":"'},mt=function(e){return e},gt=function(e){return e?["context",e]:["context"]},yt={type:"other",description:"params"},bt="=",wt={type:"literal",value:"=",description:'"="'},Et=function(e,t){return["param",["literal",e],t]},St=function(e){return["params"].concat(e)},xt={type:"other",description:"bodies"},Tt=function(e){return["bodies"].concat(e)},Nt={type:"other",description:"reference"},Ct=function(e,t){return $(["reference",e,t])},kt={type:"other",description:"partial"},Lt=">",At={type:"literal",value:">",description:'">"'},Ot="+",Mt={type:"literal",value:"+",description:'"+"'},_t=function(e){return["literal",e]},Dt=function(e,t,n,r){var i=">"===e?"partial":e;return $([i,t,n,r])},Pt={type:"other",description:"filters"},Ht="|",Bt={type:"literal",value:"|",description:'"|"'},jt=function(e){return["filters"].concat(e)},Ft={type:"other",description:"special"},It="~",qt={type:"literal",value:"~",description:'"~"'},Rt=function(e){return $(["special",e])},Ut={type:"other",description:"identifier"},zt=function(e){var t=["path"].concat(e);return t.text=e[1].join(".").replace(/,line,\d+,col,\d+/g,""),t},Wt=function(e){var t=["key",e];return t.text=e,t},Xt={type:"other",description:"number"},Vt=function(e){return["literal",e]},$t={type:"other",description:"float"},Jt=".",Kt={type:"literal",value:".",description:'"."'},Qt=function(e,t){return parseFloat(e+"."+t)},Gt={type:"other",description:"unsigned_integer"},Yt=/^[0-9]/,Zt={type:"class",value:"[0-9]",description:"[0-9]"},en=function(e){return V(e)},tn={type:"other",description:"signed_integer"},nn="-",rn={type:"literal",value:"-",description:'"-"'},sn=function(e,t){return-1*t},on={type:"other",description:"integer"},un={type:"other",description:"path"},an=function(e,t){return t=t[0],e&&t?(t.unshift(e),$([!1,t])):$([!0,t])},fn=function(e){return $(e.length>0?[!0,e[0]]:[!0,[]])},ln={type:"other",description:"key"},cn=/^[a-zA-Z_$]/,hn={type:"class",value:"[a-zA-Z_$]",description:"[a-zA-Z_$]"},pn=/^[0-9a-zA-Z_$\-]/,dn={type:"class",value:"[0-9a-zA-Z_$\\-]",description:"[0-9a-zA-Z_$\\-]"},vn=function(e,t){return e+t.join("")},mn={type:"other",description:"array"},gn=function(e){return e.join("")},yn=function(e){return e},bn=function(e,t){return t?t.unshift(e):t=[e],t},wn={type:"other",description:"array_part"},En=function(e){return e},Sn=function(e,t){return t?e.concat(t):e},xn={type:"other",description:"inline"},Tn='"',Nn={type:"literal",value:'"',description:'"\\""'},Cn=function(){return $(["literal",""])},kn=function(e){return $(["literal",e])},Ln=function(e){return $(["body"].concat(e))},An=function(e){return["buffer",e]},On={type:"other",description:"buffer"},Mn=function(e,t){return $(["format",e,t.join("")])},_n={type:"any",description:"any character"},Dn=function(e){return e},Pn=function(e){return $(["buffer",e.join("")])},Hn={type:"other",description:"literal"},Bn=/^[^"]/,jn={type:"class",value:'[^"]',description:'[^"]'},Fn=function(e){return e.join("")},In='\\"',qn={type:"literal",value:'\\"',description:'"\\\\\\""'},Rn=function(){return'"'},Un={type:"other",description:"raw"},zn="{`",Wn={type:"literal",value:"{`",description:'"{`"'},Xn="`}",Vn={type:"literal",value:"`}",description:'"`}"'},$n=function(e){return e},Jn=function(e){return $(["raw",e.join("")])},Kn={type:"other",description:"comment"},Qn="{!",Gn={type:"literal",value:"{!",description:'"{!"'},Yn="!}",Zn={type:"literal",value:"!}",description:'"!}"'},er=function(e){return $(["comment",e.join("")])},tr=/^[#?\^><+%:@\/~%]/,nr={type:"class",value:"[#?\\^><+%:@\\/~%]",description:"[#?\\^><+%:@\\/~%]"},rr="{",ir={type:"literal",value:"{",description:'"{"'},sr="}",or={type:"literal",value:"}",description:'"}"'},ur="[",ar={type:"literal",value:"[",description:'"["'},fr="]",lr={type:"literal",value:"]",description:'"]"'},cr="\n",hr={type:"literal",value:"\n",description:'"\\n"'},pr="\r\n",dr={type:"literal",value:"\r\n",description:'"\\r\\n"'},vr="\r",mr={type:"literal",value:"\r",description:'"\\r"'},gr="\u2028",yr={type:"literal",value:"\u2028",description:'"\\u2028"'},br="\u2029",wr={type:"literal",value:"\u2029",description:'"\\u2029"'},Er=/^[\t\x0B\f \xA0\uFEFF]/,Sr={type:"class",value:"[\\t\\x0B\\f \\xA0\\uFEFF]",description:"[\\t\\x0B\\f \\xA0\\uFEFF]"},xr=0,Tr=0,Nr=0,Cr={line:1,column:1,seenCR:!1},kr=0,Lr=[],Ar=0;if("startRule"in K){if(!(K.startRule in G))throw new Error("Can't start parsing from rule \""+K.startRule+'".');Y=G[K.startRule]}if(J=Y(),J!==Q&&xr===e.length)return J;throw J!==Q&&xr<e.length&&o({type:"end",description:"end of input"}),u(null,Lr,kr)}return e(t,Error),{SyntaxError:t,parse:n}}();return e.parse=t.parse,t}),function(e,t){"function"==typeof define&&define.amd&&define.amd.dust===!0?define("dust.compile",["dust.core","dust.parse"],function(e,n){return t(n,e).compile}):"object"==typeof exports?module.exports=t(require("./parser").parse,require("./dust")):t(e.dust.parse,e.dust)}(this,function(e,t){function n(e){var t={};return y.filterNode(t,e)}function r(e,t){var n,r,i,s=[t[0]];for(n=1,r=t.length;r>n;n++)i=y.filterNode(e,t[n]),i&&s.push(i);return s}function i(e,t){var n,r,i,s,o=[t[0]];for(r=1,i=t.length;i>r;r++)s=y.filterNode(e,t[r]),s&&("buffer"===s[0]||"format"===s[0]?n?(n[0]="buffer"===s[0]?"buffer":n[0],n[1]+=s.slice(1,-2).join("")):(n=s,o.push(s)):(n=null,o.push(s)));return o}function s(e,t){return["buffer",w[t[1]],t[2],t[3]]}function o(e,t){return t}function u(){}function a(e,n){return t.config.whitespace?(n.splice(1,2,n.slice(1,-2).join("")),n):null}function f(e,n){var r,i={name:n,bodies:[],blocks:{},index:0,auto:"h"},s=t.escapeJs(n),o=n?'"'+s+'",':"",u="function(dust){",a=y.compileNode(i,e);return n&&(u+='dust.register("'+s+'",'+a+");"),u+=l(i)+c(i)+"return "+a+"}",r="("+u+"(dust));",t.config.amd?"define("+o+'["dust.core"],'+u+");":t.config.cjs?"module.exports=function(dust){var tmpl="+r+"var f="+g().toString()+";f.template=tmpl;return f}":r}function l(e){var t,n=[],r=e.blocks;for(t in r)n.push('"'+t+'":'+r[t]);return n.length?(e.blocks="ctx=ctx.shiftBlocks(blocks);","var blocks={"+n.join(",")+"};"):(e.blocks="",e.blocks)}function c(e){var t,n,r=[],i=e.bodies,s=e.blocks;for(t=0,n=i.length;n>t;t++)r[t]="function body_"+t+"(chk,ctx){"+s+"return chk"+i[t]+";}body_"+t+".__dustBody=!0;";return r.join("")}function h(e,t){var n,r,i="";for(n=1,r=t.length;r>n;n++)i+=y.compileNode(e,t[n]);return i}function p(e,n,r){return"."+(t._aliases[r]||r)+"("+y.compileNode(e,n[1])+","+y.compileNode(e,n[2])+","+y.compileNode(e,n[4])+","+y.compileNode(e,n[3])+")"}function d(e){return e.replace(E,"\\\\").replace(S,'\\"').replace(x,"\\f").replace(T,"\\n").replace(N,"\\r").replace(C,"\\t")}function v(e,n,r){var i=t.loadSource(t.compile(e));return g(i)(n,r)}function m(e,n){var r=t.loadSource(t.compile(e,n));return g(r)}function g(e){return function(n,r){var i=r?"render":"stream";return t[i](e,n,r)}}var y={},b=t.isArray;y.compile=function(t,r){try{var i=n(e(t));return f(i,r)}catch(s){throw!s.line||!s.column?s:new SyntaxError(s.message+" At line : "+s.line+", column : "+s.column)}},y.filterNode=function(e,t){return y.optimizers[t[0]](e,t)},y.optimizers={body:i,buffer:o,special:s,format:a,reference:r,"#":r,"?":r,"^":r,"<":r,"+":r,"@":r,"%":r,partial:r,context:r,params:r,bodies:r,param:r,filters:o,key:o,path:o,literal:o,raw:o,comment:u,line:u,col:u},y.pragmas={esc:function(e,t,n){var r,i=e.auto;return t||(t="h"),e.auto="s"===t?"":t,r=h(e,n.block),e.auto=i,r}};var w={s:" ",n:"\n",r:"\r",lb:"{",rb:"}"};y.compileNode=function(e,t){return y.nodes[t[0]](e,t)},y.nodes={body:function(e,t){var n=e.index++,r="body_"+n;return e.bodies[n]=h(e,t),r},buffer:function(e,t){return".w("+k(t[1])+")"},format:function(e,t){return".w("+k(t[1])+")"},reference:function(e,t){return".f("+y.compileNode(e,t[1])+",ctx,"+y.compileNode(e,t[2])+")"},"#":function(e,t){return p(e,t,"section")},"?":function(e,t){return p(e,t,"exists")},"^":function(e,t){return p(e,t,"notexists")},"<":function(e,t){for(var n=t[4],r=1,i=n.length;i>r;r++){var s=n[r],o=s[1][1];if("block"===o)return e.blocks[t[1].text]=y.compileNode(e,s[2]),""}return""},"+":function(e,t){return"undefined"==typeof t[1].text&&"undefined"==typeof t[4]?".b(ctx.getBlock("+y.compileNode(e,t[1])+",chk, ctx),"+y.compileNode(e,t[2])+", {},"+y.compileNode(e,t[3])+")":".b(ctx.getBlock("+k(t[1].text)+"),"+y.compileNode(e,t[2])+","+y.compileNode(e,t[4])+","+y.compileNode(e,t[3])+")"},"@":function(e,t){return".h("+k(t[1].text)+","+y.compileNode(e,t[2])+","+y.compileNode(e,t[4])+","+y.compileNode(e,t[3])+","+y.compileNode(e,t[5])+")"},"%":function(e,t){var n,r,i,s,o,u,a,f,l,c=t[1][1];if(!y.pragmas[c])return"";for(n=t[4],r={},f=1,l=n.length;l>f;f++)u=n[f],r[u[1][1]]=u[2];for(i=t[3],s={},f=1,l=i.length;l>f;f++)a=i[f],s[a[1][1]]=a[2][1];return o=t[2][1]?t[2][1].text:null,y.pragmas[c](e,o,r,s)},partial:function(e,t){return".p("+y.compileNode(e,t[1])+",ctx,"+y.compileNode(e,t[2])+","+y.compileNode(e,t[3])+")"},context:function(e,t){return t[1]?"ctx.rebase("+y.compileNode(e,t[1])+")":"ctx"},params:function(e,t){for(var n=[],r=1,i=t.length;i>r;r++)n.push(y.compileNode(e,t[r]));return n.length?"{"+n.join(",")+"}":"{}"},bodies:function(e,t){for(var n=[],r=1,i=t.length;i>r;r++)n.push(y.compileNode(e,t[r]));return"{"+n.join(",")+"}"},param:function(e,t){return y.compileNode(e,t[1])+":"+y.compileNode(e,t[2])},filters:function(e,t){for(var n=[],r=1,i=t.length;i>r;r++){var s=t[r];n.push('"'+s+'"')}return'"'+e.auto+'"'+(n.length?",["+n.join(",")+"]":"")},key:function(e,t){return'ctx.get(["'+t[1]+'"], false)'},path:function(e,t){for(var n=t[1],r=t[2],i=[],s=0,o=r.length;o>s;s++)i.push(b(r[s])?y.compileNode(e,r[s]):'"'+r[s]+'"');return"ctx.getPath("+n+", ["+i.join(",")+"])"},literal:function(e,t){return k(t[1])},raw:function(e,t){return".w("+k(t[1])+")"}};var E=/\\/g,S=/"/g,x=/\f/g,T=/\n/g,N=/\r/g,C=/\t/g,k="undefined"==typeof JSON?function(e){return'"'+d(e)+'"'}:JSON.stringify;return t.compiler=y,t.compile=t.compiler.compile,t.renderSource=v,t.compileFn=m,t.filterNode=y.filterNode,t.optimizers=y.optimizers,t.pragmas=y.pragmas,t.compileNode=y.compileNode,t.nodes=y.nodes,y}),"function"==typeof define&&define.amd&&define.amd.dust===!0&&define("dust",["require","dust.core","dust.compile"],function(e,t){return t.onLoad=function(t,n){e([t],function(){n()})},t}),!function(e,t){"function"==typeof define&&define.amd&&define.amd.dust===!0?define("dust-helpers",["dust.core"],t):"object"==typeof exports?module.exports=t(require("dustjs-linkedin")):t(e.dust)}(this,function(e){function t(t,n,r){r=r||"INFO",t=t?"{@"+t+"}: ":"",e.log(t+n,r)}function n(e){c[e]||(t(e,"Deprecation warning: "+e+" is deprecated and will be removed in a future version of dustjs-helpers","WARN"),t(null,"For help and a deprecation timeline, see https://github.com/linkedin/dustjs-helpers/wiki/Deprecated-Features#"+e.replace(/\W+/g,""),"WARN"),c[e]=!0)}function r(e){return e.stack.tail&&e.stack.tail.head&&"undefined"!=typeof e.stack.tail.head.__select__}function i(e){return r(e)&&e.get("__select__")}function s(e,t){var n,r=e.stack.head,i=e.rebase();e.stack&&e.stack.tail&&(i.stack=e.stack.tail);var s={isPending:!1,isResolved:!1,isDeferredComplete:!1,deferreds:[]};for(n in t)s[n]=t[n];return i.push({__select__:s}).push(r,e.stack.index,e.stack.of)}function o(e){var t,n;if(e.deferreds.length)for(e.isDeferredComplete=!0,t=0,n=e.deferreds.length;n>t;t++)e.deferreds[t]()}function u(e,t){return"function"==typeof t?t.toString().replace(/(^\s+|\s+$)/gm,"").replace(/\n/gm,"").replace(/,\s*/gm,", ").replace(/\)\{/gm,") {"):t}function a(e,t){return function(n,r,i,s){return f(n,r,i,s,e,t)}}function f(e,n,r,s,o,u){var a,f,c,h,p=r.block,v=r["else"],m=i(n)||{};if(m.isResolved)return e;if(s.hasOwnProperty("key"))f=s.key;else{if(!m.hasOwnProperty("key"))return t(o,"No key specified","WARN"),e;f=m.key}return h=s.type||m.type,f=l(n.resolve(f),h),c=l(n.resolve(s.value),h),u(f,c)?(m.isPending||(a=!0,m.isPending=!0),p&&(e=e.render(p,n)),a&&(m.isResolved=!0)):v&&(e=e.render(v,n)),e}function l(e,t){switch(t&&(t=t.toLowerCase()),t){case"number":return+e;case"string":return String(e);case"boolean":return e="false"===e?!1:e,Boolean(e);case"date":return new Date(e)}return e}var c={},h={tap:function(e,t,r){return n("tap"),r.resolve(e)},sep:function(e,t,n){var r=n.block;return t.stack.index===t.stack.of-1?e:r?r(e,t):e},first:function(e,t,n){return 0===t.stack.index?n.block(e,t):e},last:function(e,t,n){return t.stack.index===t.stack.of-1?n.block(e,t):e},contextDump:function(e,n,r,i){var s,o,a=n.resolve(i.to),f=n.resolve(i.key);switch(f){case"full":s=n.stack;break;default:s=n.stack.head}switch(o=JSON.stringify(s,u,2),a){case"console":t("contextDump",o);break;default:o=o.replace(/</g,"\\u003c"),e=e.write(o)}return e},math:function(e,n,r,u){var a,f=u.key,l=u.method,c=u.operand,h=u.round;if(!u.hasOwnProperty("key")||!u.method)return t("math","`key` or `method` was not provided","ERROR"),e;switch(f=parseFloat(n.resolve(f)),c=parseFloat(n.resolve(c)),l){case"mod":0===c&&t("math","Division by 0","ERROR"),a=f%c;break;case"add":a=f+c;break;case"subtract":a=f-c;break;case"multiply":a=f*c;break;case"divide":0===c&&t("math","Division by 0","ERROR"),a=f/c;break;case"ceil":case"floor":case"round":case"abs":a=Math[l](f);break;case"toint":a=parseInt(f,10);break;default:t("math","Method `"+l+"` is not supported","ERROR")}return"undefined"!=typeof a&&(h&&(a=Math.round(a)),r&&r.block?(n=s(n,{key:a}),e=e.render(r.block,n),o(i(n))):e=e.write(a)),e},select:function(e,n,r,u){var a=r.block,f={};return u.hasOwnProperty("key")&&(f.key=n.resolve(u.key)),u.hasOwnProperty("type")&&(f.type=u.type),a?(n=s(n,f),e=e.render(a,n),o(i(n))):t("select","Missing body block","WARN"),e},eq:a("eq",function(e,t){return e===t}),ne:a("ne",function(e,t){return e!==t}),lt:a("lt",function(e,t){return t>e}),lte:a("lte",function(e,t){return t>=e}),gt:a("gt",function(e,t){return e>t}),gte:a("gte",function(e,t){return e>=t}),any:function(e,n,r,s){var o=i(n);return o?o.isDeferredComplete?t("any","Must not be nested inside {@any} or {@none} block","ERROR"):e=e.map(function(e){o.deferreds.push(function(){o.isResolved&&(e=e.render(r.block,n)),e.end()})}):t("any","Must be used inside a {@select} block","ERROR"),e},none:function(e,n,r,s){var o=i(n);return o?o.isDeferredComplete?t("none","Must not be nested inside {@any} or {@none} block","ERROR"):e=e.map(function(e){o.deferreds.push(function(){o.isResolved||(e=e.render(r.block,n)),e.end()})}):t("none","Must be used inside a {@select} block","ERROR"),e},size:function(t,n,r,i){var s,o,u=i.key;if(u=n.resolve(i.key),u&&u!==!0)if(e.isArray(u))s=u.length;else if(!isNaN(parseFloat(u))&&isFinite(u))s=u;else if("object"==typeof u){s=0;for(o in u)u.hasOwnProperty(o)&&s++}else s=(u+"").length;else s=0;return t.write(s)}};for(var p in h)e.helpers[p]=h[p];return e}),!function(){function e(e,t){return e.write('<div class="tt-gallery-prev disabled gallery-prev"><i class="fa fa-chevron-left fa-3x"></i></div><div class="tt-gallery-item gallery-item"></div><div class="tt-gallery-next disabled gallery-next"><i class="fa fa-chevron-right fa-3x next"></i></div><div class="tt-gallery-carousel gallery-carousel"><div class="tt-gallery-left gallery-left"><i class="fa fa-chevron-left fa-2x"></i></div><div class="tt-gallery-thumbs gallery-thumbs"><div><ul></ul></div> </div><div class="tt-gallery-right gallery-right"><i class="fa fa-chevron-right fa-2x right"></i></div><div class="clear"></div></div><div class="tt-gallery-action gallery-action"><a title="Cut" data-action="4"><i class="fa fa-scissors fa-2x"></i></a><a title="Interpret" data-action="3"><i class="fa fa-video-camera fa-2x"></i></a><a data-action="2"><i class="fa fa-expand fa-2x"></i></a><a data-action="1"><i class="fa fa-times fa-2x"></i></a></div>')}return dust.register("gallery_common",e),e}(),!function(){function e(e,t){return e.write('<div id="').reference(t.get(["identifier"],!1),t,"h").write('" class="tt-gallery-inline gallery-inner">').partial("gallery_common",t,null).write("</div>")}return dust.register("gallery_inline",e),e}(),!function(){function e(e,t){return e.write('<div id="').reference(t.get(["identifier"],!1),t,"h").write('" class="tt-gallery-background gallery-inner"></div><div id="').reference(t.get(["identifier"],!1),t,"h").write('" class="tt-gallery-preview gallery-inner">').partial("gallery_common",t,null).write("</div>")}return dust.register("gallery_preview",e),e}(),!function(){function e(e,n){return e.section(n.get(["media"],!1),n,{block:t},null)}function t(e,t){return e.write('<li data-mid="').reference(t.getPath(!1,["data","id"]),t,"h").write('">').exists(t.get(["can_edit"],!1),t,{block:n},null).write("<div>").exists(t.getPath(!1,["data","thumbnail_path"]),t,{block:r},null).write("</div> </li>")}function n(e,t){return e.write('<span class="gallery-thumb-remove" title="Remove" data-mid="').reference(t.getPath(!1,["data","id"]),t,"h").write('"><i class="fa fa-times-circle"></i></span>')}function r(e,t){return e.write('<img src="').helper("generateUrl",t,{},{path:t.getPath(!1,["data","thumbnail_path"])}).write('" />')}return dust.register("gallery_thumbnail",e),e}(),!function(){function e(e,n){return e.helper("select",n,{block:t},{key:n.getPath(!1,["media","type"])})}function t(e,t){return e.helper("eq",t,{block:n},{value:1}).helper("eq",t,{block:l},{value:2}).helper("eq",t,{block:p},{value:0}).helper("eq",t,{block:d},{value:9})}function n(e,t){return e.exists(t.getPath(!1,["media","is_interpretation"]),t,{block:r},null).write('<video class="tt-media-video"').exists(t.get(["enable_controls"],!1),t,{block:u},null).exists(t.getPath(!1,["media","thumbnail_path"]),t,{block:a},null).write('preload="none">').section(t.getPath(!1,["media","resources"]),t,{block:f},null).write("</video>")}function r(e,t){return e.write('<video class="tt-media-pip-video"').exists(t.get(["enable_controls"],!1),t,{block:i},null).exists(t.getPath(!1,["media","source","thumbnail_path"]),t,{block:s},null).write('preload="none">').section(t.getPath(!1,["media","source","resources"]),t,{block:o},null).write("</video>")}function i(e,t){return e.write(" controls ")}function s(e,t){return e.write(' poster="').helper("generateUrl",t,{},{path:t.getPath(!1,["media","source","thumbnail_path"])}).write('" ')}function o(e,t){return e.write('<source src="').helper("generateUrl",t,{},{path:t.get(["web_path"],!1)}).write('" />')}function u(e,t){return e.write(" controls ")}function a(e,t){return e.write(' poster="').helper("generateUrl",t,{},{path:t.getPath(!1,["media","thumbnail_path"])}).write('" ')}function f(e,t){return e.write('<source src="').helper("generateUrl",t,{},{path:t.get(["web_path"],!1)}).write('" />')}function l(e,t){return e.write('<audio class="tt-media-audio"').exists(t.get(["enable_controls"],!1),t,{block:c},null).write(">").section(t.getPath(!1,["media","resources"]),t,{block:h},null).write("</audio>")}function c(e,t){return e.write(" controls")}function h(e,t){return e.write('<source src="').helper("generateUrl",t,{},{path:t.get(["web_path"],!1)}).write('" />')}function p(e,t){return e.write('<img class="img-responsive center-block tt-media-img" src="').helper("generateUrl",t,{},{path:t.getPath(!1,["media","source_resource","web_path"])}).write('" title="').reference(t.get(["title"],!1),t,"h").write('" alt="').reference(t.get(["title"],!1),t,"h").write('" />')}function d(e,t){return e.write('<div class="row"><div class="col-md-3 thumbnail text-center"><a href="').helper("generateUrl",t,{},{path:t.getPath(!1,["media","source_resource","web_path"])}).write('"><p><i class="fa fa-file fa-5x"></i></p><div>').reference(t.get(["title"],!1),t,"h").write("</div></a></div></div>")}return dust.register("media_element",e),e}(),!function(){function e(e,s){return e.write('<div class="col-md-3"><div class="thumbnail tt-grid-div-body"><div class="tt-grid-div-item"><input type="checkbox" class="table-component-item" data-mid="').reference(s.getPath(!1,["media","id"]),s,"h").write('" /></div><div class="tt-grid-div-thumbnail my-files-selector-file" data-mid="').reference(s.getPath(!1,["media","id"]),s,"h").write('" disabled><div><span class="fa-stack fa-lg"><i class="fa fa-file-o fa-stack-2x"></i><i class="fa fa-play-circle fa-stack-1x"></i></span></div></div><div class="tt-grid-div-primary"><span class="edit-title my-files-selector-file" title="').reference(s.get(["previewTitle"],!1),s,"h").write('" data-mid="').reference(s.getPath(!1,["media","id"]),s,"h").write('" data-type="text" data-title="').reference(s.get(["editTitle"],!1),s,"h").write('" disabled><i class="fa ').reference(s.getPath(!1,["mediaIcon","icon"]),s,"h").write(' fa-2x" title="').reference(s.getPath(!1,["mediaIcon","text"]),s,"h").write('"></i>').reference(s.getPath(!1,["media","title"]),s,"h").write('</span><span><button class="btn btn-default edit-title"><i class="fa fa-pencil"></i></button><div class="btn-group"><button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false"><i class="fa fa-download"></i> <span class="caret"></span></button><ul class="dropdown-menu" role="menu">').section(s.getPath(!1,["media","resources"]),s,{block:t},null).helper("if",s,{block:n},{cond:r}).exists(s.getPath(!1,["media","source_resource"]),s,{block:i},null).write('</ul></div><a class="btn btn-default" target="_blank" href="').reference(s.get(["shareUrl"],!1),s,"h").write('" title="').reference(s.get(["shareTitle"],!1),s,"h").write('"><i class="fa fa-share-square-o"></i></a></span></div></div></div>')}function t(e,t){return e.write('<li><a href="').helper("generateUrl",t,{},{path:t.get(["web_path"],!1)}).write(' download="').reference(t.getPath(!1,["media","title"]),t,"h").write(".").reference(t.get(["path"],!1),t,"h").write('">').reference(t.get(["path"],!1),t,"h").write("</a></li>\n")}function n(e,t){return e.write('<li class="divider"></li>')}function r(e,t){return e.write("'").reference(t.getPath(!1,["media","resources"]),t,"h").write("'.length > 0 && '").reference(t.getPath(!1,["media","source_resource"]),t,"h").write("'.length")}function i(e,t){return e.write('<li><a href="').helper("generateUrl",t,{},{path:t.getPath(!1,["media","source_resource","web_path"])}).write('" download="').reference(t.getPath(!1,["media","title"]),t,"h").write(".").reference(t.getPath(!1,["media","source_resource","path"]),t,"h").write('">Original</a></li>')}return dust.register("myFilesGridElement",e),e}(),!function(){function e(e,u){return e.write('<tr><td class="tt-list-table-col-item"><input type="checkbox" class="table-component-item" data-mid="').reference(u.getPath(!1,["media","id"]),u,"h").write('" /></td><td class="tt-list-table-col-thumbnail my-files-selector-file" data-mid="').reference(u.getPath(!1,["media","id"]),u,"h").write('" disabled ><div><span class="fa-stack fa-lg"><i class="fa fa-file-o fa-stack-2x"></i><i class="fa fa-play-circle fa-stack-1x"></i></span></div></td><td class="tt-list-table-col-primary tt-myFiles-nameColumn"><span class="edit-title my-files-selector-file" title="').reference(u.get(["previewTitle"],!1),u,"h").write('" data-mid="').reference(u.getPath(!1,["media","id"]),u,"h").write('" data-type="text" data-title="').reference(u.get(["editTitle"],!1),u,"h").write('" disabled >').reference(u.getPath(!1,["media","title"]),u,"h").write('</span><span><button class="btn btn-default edit-title"><i class="fa fa-pencil"></i></button><div class="btn-group"><button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false"><i class="fa fa-download"></i> <span class="caret"></span></button><ul class="dropdown-menu" role="menu">').section(u.getPath(!1,["media","resources"]),u,{block:t},null).helper("if",u,{block:n},{cond:r}).exists(u.getPath(!1,["media","source_resource"]),u,{block:i},null).write('</ul></div><a class="btn btn-default" target="_blank" href="').reference(u.get(["shareUrl"],!1),u,"h").write('" title="').reference(u.get(["shareTitle"],!1),u,"h").write('"><i class="fa fa-share-square-o"></i></a></span></td><td>').reference(u.get(["timeUploaded"],!1),u,"h").write('</td><td><i class="fa ').reference(u.getPath(!1,["mediaIcon","icon"]),u,"h").write(' fa-2x" title="').reference(u.getPath(!1,["mediaIcon","text"]),u,"h").write('"></i></td><td>').exists(u.get(["spinner"],!1),u,{"else":s,block:o},null).write("</td></tr>")}function t(e,t){return e.write('<li><a href="').helper("generateUrl",t,{},{path:t.get(["web_path"],!1)}).write(' download="').reference(t.getPath(!1,["media","title"]),t,"h").write(".").reference(t.get(["path"],!1),t,"h").write('">').reference(t.get(["path"],!1),t,"h").write("</a></li>\n")}function n(e,t){return e.write('<li class="divider"></li>')}function r(e,t){return e.write("'").reference(t.getPath(!1,["media","resources"]),t,"h").write("'.length > 0 && '").reference(t.getPath(!1,["media","source_resource"]),t,"h").write("'.length")}function i(e,t){return e.write('<li><a href="').helper("generateUrl",t,{},{path:t.getPath(!1,["media","source_resource","web_path"])}).write('" download="').reference(t.getPath(!1,["media","title"]),t,"h").write(".").reference(t.getPath(!1,["media","source_resource","path"]),t,"h").write('">Original</a></li>')}function s(e,t){return e.reference(t.get(["formattedSize"],!1),t,"h")}function o(e,t){return e.write('<i class="fa fa-spinner fa-spin fa-large"> </i>')}return dust.register("myFilesListElement",e),e}(),!function(){function e(e,t){return e.write('<div class="modal fade my-files-selector-modal"><div class="modal-dialog" style="width: 80%;"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button><h4 class="modal-title">Select from My Files</h4></div><div class="modal-body"><div class="text-center"><i class="fa fa-spinner fa-4x fa-spin"></i></div></div><div class="modal-footer"><a class="btn btn-default" data-dismiss="modal"><i class="fa fa-times"></i> Cancel</a><a class="btn btn-primary my-files-selector-select-selected" disabled="disabled" data-loading-text="<i class=&quot;fa fa-spinner fa-spin&quot;></i> Downloading data..."><i class="fa fa-check"></i> Select</a></div></div></div></div>')}return dust.register("myFilesSelector",e),e}(),!function(){function e(e,t){return t=t.shiftBlocks(i),e.partial("post_view",t,null)}function t(e,t){return t=t.shiftBlocks(i),e.write('<div class="row"><div class="col-md-12">').reference(t.get(["form"],!1),t,"h",["s"]).write("</div></div>")}function n(e,t){return t=t.shiftBlocks(i),e}function r(e,t){return t=t.shiftBlocks(i),e}dust.register("post_edit",e);var i={post_content:t,post_tools:n,post_reply:r};return e}(),!function(){function e(e,u){return e.write('<div class="row post-container').exists(u.get(["is_post_reply"],!1),u,{block:t},null).write('" data-pid="').reference(u.get(["id"],!1),u,"h").write('"><div class="').exists(u.get(["is_post_reply"],!1),u,{"else":n,block:r},null).write('">').exists(u.get(["is_post_reply"],!1),u,{block:i},null).reference(u.get(["form"],!1),u,"h",["s"]).exists(u.get(["is_post_reply"],!1),u,{block:s},null).write("</div></div>")}function t(e,t){return e.write(' tt-post-container tt-post-reply-container" style="margin-bottom: 15px;')}function n(e,t){return e.write("col-md-12")}function r(e,t){return e.write("col-md-offset-1 col-md-11")}function i(e,t){return e.write('<div class="row tt-post-container-inner tt-post-reply-container-inner"><div class="col-md-12">')}function s(e,t){return e.write("</div></div>")}return dust.register("post_new",e),e}(),!function(){function e(e,u){return e.write('<div class="row post-container tt-post-container').exists(u.get(["is_post_reply"],!1),u,{block:t},null).write('" style="margin-bottom: 15px;" data-pid="').reference(u.get(["id"],!1),u,"h").write('"').exists(u.get(["is_post_reply"],!1),u,{block:n},null).write('><div class="').exists(u.get(["is_post_reply"],!1),u,{"else":r,block:i},null).write('"><div class="row tt-post-container-inner').exists(u.get(["is_post_reply"],!1),u,{block:s},null).write('"><div class="col-md-2 text-center"><div class="row"><div class="col-md-12">').partial("user_avatar",u,{user:u.get(["author"],!1)}).partial("user_username",u,{user:u.get(["author"],!1)}).write('</div></div><div class="row"><div class="col-md-12">').partial("user_connect_tools",u,{user:u.get(["author"],!1)}).write('</div></div></div><div class="col-md-9 tt-post-content-container">').block(u.getBlock("post_content"),u,{block:o},null).write('</div><div class="col-md-1 pull-right">').block(u.getBlock("post_tools"),u,{block:l},null).write("</div></div>").notexists(u.get(["is_post_reply"],!1),u,{block:h},null).write("</div></div>")}function t(e,t){return e.write(" tt-post-reply-container")}function n(e,t){return e.write(' data-ppid="').reference(t.get(["parent_post_id"],!1),t,"h").write('"')}function r(e,t){return e.write("col-md-12")}function i(e,t){return e.write("col-md-offset-1 col-md-11")}function s(e,t){return e.write(" tt-post-reply-container-inner")}function o(e,t){return e.write('<div class="row"><div class="col-md-12"><div class="text-right tt-date">').reference(t.get(["created"],!1),t,"h").exists(t.get(["edited_by"],!1),t,{block:u},null).write('</div></div><div class="col-md-12">').exists(t.get(["is_temporal"],!1),t,{block:a},null).helper("gt",t,{block:f},{key:t.getPath(!1,["ordered_media","length"]),value:0}).write("<div><p>").reference(t.get(["content"],!1),t,"h",["nl2br","s"]).write("</p></div></div></div>")}function u(e,t){return e.write("(edited ").reference(t.get(["edited_at"],!1),t,"h").write(" by ").reference(t.getPath(!1,["edited_by","username"]),t,"h").write(")")}function a(e,t){return e.write('<div class="tt-post-timeline-container"><div class="tt-post-timeline"><div class="tt-post-timeline-keypoint post-timeline-keypoint"></div></div></div>')}function f(e,t){return e.write('<div class="row"><div class="col-md-12"><div class="post-gallery" style="margin-bottom: 10px; height: 400px; width: 100%;"></div></div></div>')}function l(e,t){return e.write('<ul class="list-unstyled">').exists(t.get(["is_temporal"],!1),t,{block:c},null).write('<li><a class="post-edit" href="#" title="Edit this post"><i class="fa fa-pencil"></i></a></li><li><a href="#" title="Delete this post" data-toggle="modal" data-target=".post-delete-modal[data-pid=').reference(t.get(["id"],!1),t,"h").write(']"><i class="fa fa-trash-o"></i></a></li></ul><div class="modal fade post-delete-modal" data-pid="').reference(t.get(["id"],!1),t,"h").write('"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button><h4 class="modal-title">Delete this post</h4></div><div class="modal-body text-center"><p>This post will be permanently deleted.<br />This action cannot be undone.<br />Are you sure?</p></div><div class="modal-footer"><a class="btn btn-default" data-dismiss="modal"><i class="fa fa-times"></i> Cancel</a><a class="btn btn-danger post-delete" data-loading-text="<i class=&quot;fa fa-spinner fa-spin&quot;></i> Deleting..."><i class="fa fa-trash-o"></i> Delete</a></div></div></div></div>')}function c(e,t){return e.write('<li><a class="post-timeline-keypoint" href="#" title="Jump to selected timeline region"><i class="fa fa-clock-o"></i></a></li>')}function h(e,t){return e.block(t.getBlock("post_reply"),t,{block:p},null)}function p(e,t){return e.write('<div class="row"><div class="col-md-1 col-md-offset-11"><p><a class="post-new" href="#" title="Reply to this post"><i class="fa fa-reply fa-rotate-180 fa-lg"></i></a></p></div></div>')}return dust.register("post_view",e),e}(),!function(){function e(e,t){return e.write('<div class="modal fade recorder-modal"><div class="modal-dialog modal-lg"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button><h4 class="modal-title">Recorder</h4></div><div class="modal-body"><ul class="nav nav-tabs" role="tablist"><li class="active"><a href=".recorder-normal" role="tab" data-toggle="tab">Normal</a></li><li><a href=".recorder-interp" role="tab" data-toggle="tab">Interpretation</a></li></ul><div class="tab-content" style="padding-top: 15px;"><div class="tab-pane active recorder-normal recorder-container-record"><div class="tt-media-preview-title"><input class="recorder-normal-title" type="text" value="My Recording"/></div><video class="recorder-normal-video" width="100%" preload="auto" muted="muted"></video></div><div class="tab-pane recorder-interp recorder-container-record"><div style="border: 2px dashed #ccc; line-height: 200px; height: 200px; text-align: center; display: none;"><button class="btn btn-primary btn-lg recorder-interp-select">Select a video to interpret</button></div><div class="row recorder-interp-main" style="display: none;"><div class="col-md-offset-6 col-md-6"><div class="tt-media-preview-title"><input class="recorder-interp-title" type="text" value="My Recording"/></div></div><div class="col-md-6"><video class="recorder-interp-video-p" width="100%" preload="auto"muted="muted"></video></div><div class="col-md-6"><video class="recorder-interp-video-r" width="100%" preload="auto"muted="muted"></video></div></div></div><div class="recorder-controls recorder-container-record"></div><div class="recorder-container-upload" style="display: none;"><label>Uploading...</label><div class="progress"><div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0"aria-valuemax="100" style="width: 0%;">0%</div></div></div></div></div></div></div></div>')}return dust.register("recorder",e),e}(),!function(){function e(e,n){return e.section(n.get(["resources"],!1),n,{block:t},null)}function t(e,t){return e.write('<source src="').helper("generateUrl",t,{},{path:t.get(["web_path"],!1)}).write('" />')}return dust.register("recorder_source",e),e}(),!function(){function e(e,r){return e.write('<div class="row"><div class="col-md-12">').section(r.get(["posts"],!1),r,{"else":t,block:n},null).write('<div class="thread-reply-spacer"></div></div></div>')}function t(e,t){return e.write('<div class="lead text-center" style="padding-top: 30px;">No replies yet!</div>')}function n(e,t){return e.notexists(t.get(["is_post_reply"],!1),t,{block:r},null)}function r(e,t){return e.partial("post_view",t,{post:t.getPath(!0,[])}).section(t.get(["replies"],!1),t,{block:i},null)}function i(e,t){return e.partial("post_view",t,{post:t.getPath(!0,[])})}return dust.register("thread_view_posts",e),e}(),!function(){function e(e,n){return e.section(n.get(["user"],!1),n,{block:t},null)}function t(e,t){return e.write('<a href="').helper("generateRouteUrl",t,{},{name:"imdc_profile_user",str_params:"userName:username"}).write('"><img class="img-responsive center-block tt-avatar" src="').exists(t.getPath(!1,["profile","avatar"]),t,{"else":n,block:r},null).write('" /></a>')}function n(e,t){return e.helper("generateUrl",t,{},{path:"bundles/imdcterptube/img/no_avatar.jpg"})}function r(e,t){return e.helper("generateUrl",t,{},{path:t.getPath(!1,["profile","avatar","source_resource","web_path"])})}return dust.register("user_avatar",e),e}(),!function(){function e(e,n){return e.section(n.get(["user"],!1),n,{block:t},null)}function t(e,t){return e.write('<ul class="list-unstyled list-inline"><li>').helper("isLoggedInUser",t,{"else":n,block:r},{id:t.get(["id"],!1)}).write("</li>&nbsp; <!-- match spaces that are still present between tags when rendering from twig --><li>").helper("isLoggedInUser",t,{"else":i,block:u},{id:t.get(["id"],!1)}).write("</li>").helper("isNotLoggedInUser",t,{block:a},{id:t.get(["id"],!1)}).write("</ul>")}function n(e,t){return e.write('<a href="').helper("generateRouteUrl",t,{},{name:"imdc_message_new",str_params:"userid:username"}).write('" title="Send a message to ').reference(t.get(["username"],!1),t,"h").write('"><i class="fa fa-envelope-o"></i></a>')}function r(e,t){return e.write('<i class="fa fa-envelope-o" style="color: lightgray;"></i>')}function i(e,t){return e.helper("isInUserOnList",t,{"else":s,block:o},{list:"Friends",username:t.get(["username"],!1)})}function s(e,t){return e.write('<a href="').helper("generateRouteUrl",t,{},{name:"imdc_member_friend_add",str_params:"userid:id"}).write('" title="Click to add ').reference(t.get(["username"],!1),t,"h").write(' to your friends list"><i class="fa fa-plus"></i></a>')}function o(e,t){return e.write('<a href="').helper("generateRouteUrl",t,{},{name:"imdc_member_friend_remove",str_params:"userid:id"}).write('" title="Remove ').reference(t.get(["username"],!1),t,"h").write(' from your friends list"><i class="fa fa-minus"></i></a>')}function u(e,t){return e.write('<i class="fa fa-user" style="color: lightgray;" title="This is you"></i>')}function a(e,t){return e.write("&nbsp;<li>").helper("isInUserOnList",t,{"else":f,block:h},{list:"Mentor",username:t.get(["username"],!1)}).write("</li>&nbsp;<li>").helper("isInUserOnList",t,{"else":p,block:m},{list:"Mentee",username:t.get(["username"],!1)}).write("</li>")}function f(e,t){return e.helper("isInUserOnList",t,{"else":l,block:c},{list:"InvitedMentor",username:t.get(["username"],!1)})}function l(e,t){return e.write('<a href="').helper("generateRouteUrl",t,{},{name:"imdc_invitation_mentor",str_params:"id:id"}).write('" title="Invite user to be your mentor"><i class="fa fa-inbox"></i></a>')}function c(e,t){return e.write('<i class="fa fa-inbox" title="Invitation for mentorship already sent"></i>')}function h(e,t){return e.write('<i class="fa fa-star" title="This user is your mentor"></i>')}function p(e,t){return e.helper("isInUserOnList",t,{"else":d,block:v},{list:"InvitedMentee",username:t.get(["username"],!1)})}function d(e,t){return e.write('<a href="').helper("generateRouteUrl",t,{},{name:"imdc_invitation_mentee",str_params:"id:id"}).write('" title="Invite user to be your mentee"><i class="fa fa-star-o"></i></a>')}function v(e,t){return e.write('<i class="fa fa-star-o" title="Invitation for menteeship already sent"></i>')}function m(e,t){return e.write('<i class="fa fa-star" title="This user is your mentee"></i>')}return dust.register("user_connect_tools",e),e}(),!function(){function e(e,n){return e.section(n.get(["user"],!1),n,{block:t},null)}function t(e,t){return e.write('<a href="').helper("generateRouteUrl",t,{},{name:"imdc_profile_user",str_params:"userName:username"}).write('" title="').reference(t.get(["username"],!1),t,"h").write('">').reference(t.get(["username"],!1),t,"h").write("</a>")}return dust.register("user_username",e),e}(),define("templates",["dust-helpers"],function(){}),Function.prototype.extend=function(){return function(e){var t=this;Object.keys(e).forEach(function(n){var r=e[n];_.isObject(r)?t[n]=_.clone(r):t[n]=r}),this.prototype=Object.create(e.prototype),this.prototype.constructor=this}}(),define("extra",function(){}),define("bootstrap",["underscore"],function(){"use strict";var e=function(e,t,n,r){_.isString(t)&&(t=require("controller/"+t+"Controller")),_.isString(n)&&(n=require("views/"+n+"View"));var i=new t(e,r),s=new n(i,r);_.isFunction(s.loadView)&&s.loadView(),i.onViewLoaded()};return e}),define("service",["require"],function(e){"use strict";var t=function(){};return t.get=function(t){if(!$tt._services[t]){var n=e("service/"+t+"Service");$tt._services[t]=new n}return $tt._services[t]},t}),define("core/helper",[],function(){"use strict";var e=function(){};return e.TAG="Helper",e.MEDIA_TYPE_IMAGE=0,e.MEDIA_TYPE_VIDEO=1,e.MEDIA_TYPE_AUDIO=2,e.MEDIA_TYPE_OTHER=9,e.isFullscreen=function(){return document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement?!0:!1},e.toggleFullScreen=function(t){console.log("%s: %s",e.TAG,"toggleFullScreen");var n=t[0];e.isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen():n.requestFullscreen?n.requestFullscreen():n.mozRequestFullScreen?n.mozRequestFullScreen():n.webkitRequestFullscreen?n.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT):n.msRequestFullscreen&&n.msRequestFullscreen()},e.updateProgressBar=function(e,t){var n=e.find(".progress-bar");n.attr("aria-valuenow",t),n.css("width",t+"%"),n.html(t+"%")},e.generateUrl=function(e,t){if(e.indexOf("://")>0||e.indexOf("blob:")==0)return e;t=typeof t!="undefined"?t:!1;var n=Routing.getBaseUrl()+"/";return t?n+e:n.replace(/\w+\.php\/$/gi,"")+e},e.formatSize=function(e){return e==-1?e:(Number(e)/1024/1024).toFixed(2)+" MB"},e.getTimeDateString=function(e){var t=new Date(e),n="am";t.getHours()>11&&(n="pm");var r=t.getHours()%12,i=t.getMinutes();r==0&&(r=12),r<10&&(r="0"+r),i<10&&(i="0"+i);var s=t.toDateString();return s=s.substring(s.indexOf(" ")+1),s+" "+r+":"+i+" "+n},e.getIconForMediaType=function(t){var n,r;switch(t){case e.MEDIA_TYPE_IMAGE:n="fa-file-photo-o",r="Image";break;case e.MEDIA_TYPE_VIDEO:n="fa-file-video-o",r="Video";break;case e.MEDIA_TYPE_AUDIO:n="fa-file-audio-o",r="Audio";break;case e.MEDIA_TYPE_OTHER:n="fa-file-o",r="Other"}return{icon:n,text:r}},e.autoSize=function(){$(".autosize").autosize({append:""})},e}),define("core/subscriber",["underscore"],function(){"use strict";var e=function(){this.subscriptions={}};return e.prototype._dispatch=function(e,t){var n={type:e};_.isObject(t)&&!_.isArray(t)&&!_.isFunction(t)&&_.each(t,function(e,t,r){n[t]=e}),_.each(this.subscriptions[e],function(e,t,r){_.isFunction(e)&&e.call(this,n)},this)},e.prototype.subscribe=function(e,t){_.has(this.subscriptions,e)||(this.subscriptions[e]=[]),_.contains(this.subscriptions[e],t)||this.subscriptions[e].push(t)},e.prototype.unsubscribe=function(e){_.each(this.subscriptions,function(t,n,r){if(_.contains(t,e)){var i=_.indexOf(t,e);t.splice(i,1)}})},e}),define("factory/contactFactory",[],function(){"use strict";var e={};return e.delete=function(e,t){var n=$.Deferred(),r={method:"DELETE",url:Routing.generate("imdc_delete_contact"),data:{userIds:e,contactList:t}};return $.ajax(r).then(function(e,t,r){n.resolve(e)},function(e,t,r){console.log(e.responseText),n.reject(e.responseJSON)}),n.promise()},e}),define("factory/forumFactory",[],function(){"use strict";var e={};return e.delete=function(e){var t=$.Deferred(),n={method:"DELETE",url:Routing.generate("imdc_delete_forum",{forumId:e.get("id")})};return $.ajax(n).then(function(e,n,r){t.resolve(e)},function(e,n,r){console.log(e.responseText),t.reject(e.responseJSON)}),t.promise()},e}),define("factory/groupFactory",[],function(){"use strict";var e={};return e.delete=function(e){var t=$.Deferred(),n={method:"DELETE",url:Routing.generate("imdc_delete_user_group",{groupId:e.get("id")})};return $.ajax(n).then(function(e,n,r){t.resolve(e)},function(e,n,r){console.log(e.responseText),t.reject(e.responseJSON)}),t.promise()},e}),define("model/model",["core/subscriber","extra","underscore"],function(e){"use strict";var t=function(t){e.prototype.constructor.apply(this),t=t||{};if(!_.isObject(t)||_.isArray(t)||_.isFunction(t))throw new Error("data must be an object");this.data=t};return t.extend(e),t.Event={CHANGE:"eventChange"},t._stringToKeyPath=function(e){return e.split(".")},t.prototype._findKeyPath=function(e,n){var r=t._stringToKeyPath(n);while(r.length!==0){var i=r.shift(),s=parseInt(i,10);i=_.isNumber(s)&&!_.isNaN(s)?s:i;if(!(_.isObject(e)&&_.has(e,i)&&e.hasOwnProperty(i)||_.isArray(e)&&_.contains(e,i)&&e[i]!==undefined))return undefined;e=e[i]}return e},t.prototype._setKeyPath=function(e,n,r){var i=t._stringToKeyPath(n);while(i.length>1){var s=i.shift(),o=parseInt(s,10);s=_.isNumber(o)&&!_.isNaN(o)?o:s;if(_.isObject(e)&&!_.has(e,s)&&!e.hasOwnProperty(s)||_.isArray(e)&&!_.contains(e,s)&&e[s]===undefined||_.isNull(e[s])){console.log("defining key: "+s);var u=parseInt(i[0],10);e[s]=_.isNumber(u)&&!_.isNaN(u)?[]:{}}e=e[s]}e[i.shift()]=r},t.prototype._dispatch=function(t,n,r){r=_.extend(r||{},{keyPath:n||"",model:this}),e.prototype._dispatch.call(this,t,r)},t.prototype.get=function(e,t){var n=this._findKeyPath(this.data,e);return typeof n!="undefined"?n:t},t.prototype.set=function(e,n,r){r=typeof r!="undefined"?r:!0;var i=this._findKeyPath(this.data,e);this._setKeyPath(this.data,e,n),r&&i!==n&&this._dispatch(t.Event.CHANGE,e)},t.prototype.update=function(e,t){_.each(e,function(e,n,r){var i=t?t+"."+n:n;_.isObject(e)||_.isArray(e)?(console.log("update: "+i),this.update(e,i)):(console.log("set: "+i+" to:"+e),this.set(i,e))},this)},t.prototype.forceChange=function(e,n){this._dispatch(t.Event.CHANGE,e,n)},t.prototype.find=function(e,t,n){return _.findIndex(n,function(n){return n.get(t)==e})},t}),define("model/mediaModel",["model/model","extra"],function(e){"use strict";var t=function(t){e.prototype.constructor.apply(this,arguments)};return t.extend(e),t}),define("factory/mediaFactory",["model/mediaModel","underscore"],function(e){"use strict";var t={};return t.list=function(t){var n=$.Deferred(),r={url:Routing.generate("imdc_cget_media"),data:{}};return t&&(r.data.id=t.join()),$.ajax(r).then(function(t,r,i){t.media.forEach(function(t,n,r){r[n]=new e(t)}),n.resolve(t)},function(e,t,r){console.log(e.responseText),n.reject(e.responseJSON)}),n.promise()},t.get=function(t){var n=$.Deferred(),r=_.isObject(t),i=r?t.get("id"):t,s={url:Routing.generate("imdc_get_media",{mediaId:i})};return $.ajax(s).then(function(i,s,o){r?(t.update(i.media),i.media=t):i.media=new e(i.media),n.resolve(i)},function(e,t,r){console.log(e.responseText),n.reject(e.responseJSON)}),n.promise()},t.edit=function(e){var t=$.Deferred(),n={method:"PUT",url:Routing.generate("imdc_edit_media",{mediaId:e.get("id")}),data:{media:JSON.stringify(e.data)}};return $.ajax(n).then(function(n,r,i){e.update(n.media),n.media=e,t.resolve(n)},function(e,n,r){console.log(e.responseText),t.reject(e.responseJSON)}),t.promise()},t.delete=function(e,t){var n=$.Deferred(),r={method:"DELETE",url:Routing.generate("imdc_delete_media",{mediaId:e.get("id")}),data:{confirm:t||!1}};return $.ajax(r).then(function(e,t,r){n.resolve(e)},function(e,t,r){console.log(e.responseText);var i=e.responseJSON,s=[];i.in_use.forEach(function(e,t,n){s.push(Translator.trans("filesGateway.deleteMediaInUseConfirmation."+e))}),i.confirmText=Translator.trans("filesGateway.deleteMediaInUseConfirmation.finalMessage",{mediaUsedLocations:s.join(", ")}),n.reject(i)}),n.promise()},t.trim=function(t,n,r){var i=$.Deferred(),s={method:"PATCH",url:Routing.generate("imdc_trim_media",{mediaId:t.get("id")}),data:{startTime:n,endTime:r}};return $.ajax(s).then(function(n,r,s){t=new e(n.media),i.resolve(n)},function(e,t,n){console.log(e.responseText),i.reject(e.responseJSON)}),i.promise()},t}),define("factory/messageFactory",[],function(){"use strict";var e={};return e.edit=function(e){var t=$.Deferred(),n={method:"POST",url:Routing.generate("imdc_message_mark_as_read",{messageid:e.get("id")})};return $.ajax(n).then(function(e,n,r){e.wasEdited?t.resolve(e):t.reject(e)},function(e,n,r){console.log(e.responseText),t.reject(e.responseJSON)}),t.promise()},e}),define("factory/myFilesFactory",["model/mediaModel"],function(e){"use strict";var t={};return t._prepForFormSubmit=function(e,t,n){t.type="POST",t.contentType=!1,e&&(t.data=new FormData(e)),t.processData=!1,t.xhr=function(){var e=$.ajaxSettings.xhr();return e.upload.addEventListener("progress",function(e){e.lengthComputable&&n.notify(Math.floor(e.loaded/e.total*100))},!1),e}},t.addRecording=function(n){var r=new FormData,i=!!navigator.mozGetUserMedia,s=$.Deferred(),o={url:Routing.generate("imdc_myfiles_add_recording")};return r.append("isFirefox",i),i||r.append("video-blob",n.video),r.append("audio-blob",n.audio),r.append("title",n.title),r.append("isInterpretation",n.isInterpretation),r.append("sourceStartTime",n.sourceStartTime),r.append("sourceId",n.sourceId),t._prepForFormSubmit(null,o,s),o.data=r,$.ajax(o).then(function(t,n,r){t.responseCode==200?(t.media=new e(t.media),s.resolve(t)):s.reject(t)},function(e,t,n){console.log(e.responseText),s.reject()}),s.promise()},t.add=function(n){var r=$.Deferred(),i={url:Routing.generate("imdc_myfiles_add")};return t._prepForFormSubmit(n,i,r),$.ajax(i).then(function(t,n,i){t.wasUploaded?(t.media=new e(t.media),r.resolve(t)):(console.error(t.error),r.reject(t))},function(e,t,n){console.log(e.responseText),r.reject()}),r.promise()},t}),define("model/postModel",["model/model","model/mediaModel","extra"],function(e,t){"use strict";var n=function(n){e.prototype.constructor.apply(this,arguments),this.data.keyPoint=null,this.data.ordered_media&&this.data.ordered_media.forEach(function(e,n,r){r[n]=new t(e)})};return n.extend(e),n.prototype.isNew=function(){return String(this.data.id).substr(0,1)==="0"},n}),define("factory/postFactory",["model/postModel"],function(e){"use strict";var t={};return t._prepForFormSubmit=function(e,t){t.contentType=!1,e&&(t.data=new FormData(e)),t.processData=!1},t._newPost=function(t,n,r){var i=$.Deferred();return $.ajax(n).then(function(t,n,r){t.post=new e(t.post),t.post.set("form",t.form),i.resolve(t)},function(e,n,s){console.log(e.responseText),r&&t.set("form",e.responseJSON.form),i.reject(e.responseJSON)}),i.promise()},t.new=function(e){var n={url:Routing.generate("imdc_new_post",{threadId:e.get("parent_thread_id"),parentPostId:e.get("parent_post_id")||e.get("id")})};return t._newPost(e,n,!1)},t.post=function(e,n){var r={method:"POST",url:Routing.generate("imdc_post_post",{threadId:e.get("parent_thread_id"),parentPostId:e.get("parent_post_id")||e.get("id")})};return t._prepForFormSubmit(n,r),t._newPost(e,r,!0)},t.get=function(e){var t=$.Deferred(),n={url:Routing.generate("imdc_get_post",{postId:e.get("id")})};return $.ajax(n).then(function(n,r,i){e.update(n.post),t.resolve(n)},function(e,n,r){console.log(e.responseText),t.reject(e.responseJSON)}),t.promise()},t._editPut=function(e,t,n){var r=$.Deferred();return $.ajax(t).then(function(t,n,i){e.update(t.post),e.set("form",t.form),e.set("keyPoint.startTime",e.get("start_time")),e.set("keyPoint.endTime",e.get("end_time")),r.resolve(t)},function(t,i,s){console.log(t.responseText),n&&e.set("form",t.responseJSON.form),r.reject(t.responseJSON)}),r.promise()},t.edit=function(e){var n={url:Routing.generate("imdc_edit_post",{postId:e.get("id")})};return t._editPut(e,n,!1)},t.put=function(e,n){var r={method:"POST",url:Routing.generate("imdc_put_post",{postId:e.get("id")})};return t._prepForFormSubmit(n,r),t._editPut(e,r,!0)},t.delete=function(e){var t=$.Deferred(),n={method:"DELETE",url:Routing.generate("imdc_delete_post",{postId:e.get("id")})};return $.ajax(n).then(function(e,n,r){t.resolve(e)},function(e,n,r){console.log(e.responseText),t.reject(e.responseJSON)}),t.promise()},t}),define("factory/threadFactory",[],function(){"use strict";var e={};return e.delete=function(e){var t=$.Deferred(),n={method:"DELETE",url:Routing.generate("imdc_delete_thread",{threadId:e.get("id")})};return $.ajax(n).then(function(e,n,r){t.resolve(e)},function(e,n,r){console.log(e.responseText),t.reject(e.responseJSON)}),t.promise()},e}),define("service/keyPointService",["underscore"],function(){"use strict";var e=function(){this.name="KeyPoint",this.keyPoints=[],this.subscriptions=[]};return e.Event={ADD:"eventAdd",DURATION:"eventDuration",SELECTION_TIMES:"eventSelectionTimes",HOVER:"eventHover",CLICK:"eventClick",EDIT:"eventEdit",REMOVE:"eventRemove"},e._kIndex=function(e){return _.isString(e)?e:"K"+e},e.prototype.register=function(t){var n=e._kIndex(t.id);_.isObject(t)&&(this.keyPoints[n]=t)},e.prototype.deregister=function(t){var n=e._kIndex(t);_.has(this.keyPoints,n)&&this.keyPoints.splice(n,1)},e.prototype.subscribe=function(t,n){var r=e._kIndex(t);_.has(this.subscriptions,r)||(this.subscriptions[r]=[]),_.contains(this.subscriptions[r],n)||this.subscriptions[r].push(n)},e.prototype.unsubscribe=function(t,n){var r=e._kIndex(t);if(_.has(this.subscriptions,r)){var i=this.subscriptions[r];if(_.contains(i,n)){var s=_.indexOf(i,n);i.splice(s,1)}}},e.prototype.dispatch=function(t,n,r){var i=e._kIndex(t);if(i!=="all"&&!_.has(this.keyPoints,i)||!_.contains(e.Event,n))return;var s=i==="all"?_.values(this.subscriptions):[this.subscriptions[i]],o=function(e,t,s){var o={type:n};i==="all"?o.keyPoints=this.keyPoints:o.keyPoint=this.keyPoints[i],_.isObject(r)&&_.each(r,function(e,t,n){o[t]=e}),_.each(e,function(e,t,n){_.isFunction(e)&&e.call(this,o)},this)};_.each(s,o,this),i!=="all"&&_.each([this.subscriptions.all],o,this)},e}),!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define("sockjs",[],e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.SockJS=e()}}(function(){var e;return function t(e,n,r){function i(o,u){if(!n[o]){if(!e[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(s)return s(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};e[o][0].call(l.exports,function(t){var n=e[o][1][t];return i(n?n:t)},l,l.exports,t,e,n,r)}return n[o].exports}for(var s="function"==typeof require&&require,o=0;o<r.length;o++)i(r[o]);return i}({1:[function(e,t){(function(n){"use strict";var r=e("./transport-list");t.exports=e("./main")(r),"_sockjs_onload"in n&&setTimeout(n._sockjs_onload,1)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./main":14,"./transport-list":16}],2:[function(e,t){"use strict";function n(){i.call(this),this.initEvent("close",!1,!1),this.wasClean=!1,this.code=0,this.reason=""}var r=e("inherits"),i=e("./event");r(n,i),t.exports=n},{"./event":4,inherits:54}],3:[function(e,t){"use strict";function n(){i.call(this)}var r=e("inherits"),i=e("./eventtarget");r(n,i),n.prototype.removeAllListeners=function(e){e?delete this._listeners[e]:this._listeners={}},n.prototype.once=function(e,t){function n(){r.removeListener(e,n),i||(i=!0,t.apply(this,arguments))}var r=this,i=!1;this.on(e,n)},n.prototype.emit=function(e){var t=this._listeners[e];if(t)for(var n=Array.prototype.slice.call(arguments,1),r=0;r<t.length;r++)t[r].apply(this,n)},n.prototype.on=n.prototype.addListener=i.prototype.addEventListener,n.prototype.removeListener=i.prototype.removeEventListener,t.exports.EventEmitter=n},{"./eventtarget":5,inherits:54}],4:[function(e,t){"use strict";function n(e){this.type=e}n.prototype.initEvent=function(e,t,n){return this.type=e,this.bubbles=t,this.cancelable=n,this.timeStamp=+(new Date),this},n.prototype.stopPropagation=function(){},n.prototype.preventDefault=function(){},n.CAPTURING_PHASE=1,n.AT_TARGET=2,n.BUBBLING_PHASE=3,t.exports=n},{}],5:[function(e,t){"use strict";function n(){this._listeners={}}n.prototype.addEventListener=function(e,t){e in this._listeners||(this._listeners[e]=[]);var n=this._listeners[e];-1===n.indexOf(t)&&(n=n.concat([t])),this._listeners[e]=n},n.prototype.removeEventListener=function(e,t){var n=this._listeners[e];if(n){var r=n.indexOf(t);return-1!==r?void (n.length>1?this._listeners[e]=n.slice(0,r).concat(n.slice(r+1)):delete this._listeners[e]):void 0}},n.prototype.dispatchEvent=function(e){var t=e.type,n=Array.prototype.slice.call(arguments,0);if(this["on"+t]&&this["on"+t].apply(this,n),t in this._listeners)for(var r=this._listeners[t],i=0;i<r.length;i++)r[i].apply(this,n)},t.exports=n},{}],6:[function(e,t){"use strict";function n(e){i.call(this),this.initEvent("message",!1,!1),this.data=e}var r=e("inherits"),i=e("./event");r(n,i),t.exports=n},{"./event":4,inherits:54}],7:[function(e,t){"use strict";function n(e){this._transport=e,e.on("message",this._transportMessage.bind(this)),e.on("close",this._transportClose.bind(this))}var r=e("json3"),i=e("./utils/iframe");n.prototype._transportClose=function(e,t){i.postMessage("c",r.stringify([e,t]))},n.prototype._transportMessage=function(e){i.postMessage("t",e)},n.prototype._send=function(e){this._transport.send(e)},n.prototype._close=function(){this._transport.close(),this._transport.removeAllListeners()},t.exports=n},{"./utils/iframe":47,json3:55}],8:[function(e,t){"use strict";var n=e("./utils/url"),r=e("./utils/event"),i=e("json3"),s=e("./facade"),o=e("./info-iframe-receiver"),u=e("./utils/iframe"),a=e("./location");t.exports=function(e,t){var f={};t.forEach(function(e){e.facadeTransport&&(f[e.facadeTransport.transportName]=e.facadeTransport)}),f[o.transportName]=o;var l;e.bootstrap_iframe=function(){var t;u.currentWindowId=a.hash.slice(1);var o=function(r){if(r.source===parent&&("undefined"==typeof l&&(l=r.origin),r.origin===l)){var o;try{o=i.parse(r.data)}catch(h){return}if(o.windowId===u.currentWindowId)switch(o.type){case"s":var p;try{p=i.parse(o.data)}catch(h){break}var d=p[0],v=p[1],m=p[2],g=p[3];if(d!==e.version)throw new Error('Incompatibile SockJS! Main site uses: "'+d+'", the iframe: "'+e.version+'".');if(!n.isOriginEqual(m,a.href)||!n.isOriginEqual(g,a.href))throw new Error("Can't connect to different domain from within an iframe. ("+a.href+", "+m+", "+g+")");t=new s(new f[v](m,g));break;case"m":t._send(o.data);break;case"c":t&&t._close(),t=null}}};r.attachEvent("message",o),u.postMessage("s")}}},{"./facade":7,"./info-iframe-receiver":10,"./location":13,"./utils/event":46,"./utils/iframe":47,"./utils/url":52,debug:void 0,json3:55}],9:[function(e,t){"use strict";function n(e,t){r.call(this);var n=this,i=+(new Date);this.xo=new t("GET",e),this.xo.once("finish",function(e,t){var r,u;if(200===e){if(u=+(new Date)-i,t)try{r=s.parse(t)}catch(a){}o.isObject(r)||(r={})}n.emit("finish",r,u),n.removeAllListeners()})}var r=e("events").EventEmitter,i=e("inherits"),s=e("json3"),o=e("./utils/object");i(n,r),n.prototype.close=function(){this.removeAllListeners(),this.xo.close()},t.exports=n},{"./utils/object":49,debug:void 0,events:3,inherits:54,json3:55}],10:[function(e,t){"use strict";function n(e,t){var n=this;i.call(this),this.ir=new u(t,o),this.ir.once("finish",function(e,t){n.ir=null,n.emit("message",s.stringify([e,t]))})}var r=e("inherits"),i=e("events").EventEmitter,s=e("json3"),o=e("./transport/sender/xhr-local"),u=e("./info-ajax");r(n,i),n.transportName="iframe-info-receiver",n.prototype.close=function(){this.ir&&(this.ir.close(),this.ir=null),this.removeAllListeners()},t.exports=n},{"./info-ajax":9,"./transport/sender/xhr-local":37,events:3,inherits:54,json3:55}],11:[function(e,t){(function(n){"use strict";function r(e,t){var r=this;i.call(this);var s=function(){var n=r.ifr=new a(f.transportName,t,e);n.once("message",function(e){if(e){var t;try{t=o.parse(e)}catch(n){return r.emit("finish"),void r.close()}var i=t[0],s=t[1];r.emit("finish",i,s)}r.close()}),n.once("close",function(){r.emit("finish"),r.close()})};n.document.body?s():u.attachEvent("load",s)}var i=e("events").EventEmitter,s=e("inherits"),o=e("json3"),u=e("./utils/event"),a=e("./transport/iframe"),f=e("./info-iframe-receiver");s(r,i),r.enabled=function(){return a.enabled()},r.prototype.close=function(){this.ifr&&this.ifr.close(),this.removeAllListeners(),this.ifr=null},t.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./info-iframe-receiver":10,"./transport/iframe":22,"./utils/event":46,debug:void 0,events:3,inherits:54,json3:55}],12:[function(e,t){"use strict";function n(e,t){var n=this;r.call(this),setTimeout(function(){n.doXhr(e,t)},0)}var r=e("events").EventEmitter,i=e("inherits"),s=e("./utils/url"),o=e("./transport/sender/xdr"),u=e("./transport/sender/xhr-cors"),a=e("./transport/sender/xhr-local"),f=e("./transport/sender/xhr-fake"),l=e("./info-iframe"),c=e("./info-ajax");i(n,r),n._getReceiver=function(e,t,n){return n.sameOrigin?new c(t,a):u.enabled?new c(t,u):o.enabled&&n.sameScheme?new c(t,o):l.enabled()?new l(e,t):new c(t,f)},n.prototype.doXhr=function(e,t){var r=this,i=s.addPath(e,"/info");this.xo=n._getReceiver(e,i,t),this.timeoutRef=setTimeout(function(){r._cleanup(!1),r.emit("finish")},n.timeout),this.xo.once("finish",function(e,t){r._cleanup(!0),r.emit("finish",e,t)})},n.prototype._cleanup=function(e){clearTimeout(this.timeoutRef),this.timeoutRef=null,!e&&this.xo&&this.xo.close(),this.xo=null},n.prototype.close=function(){this.removeAllListeners(),this._cleanup(!1)},n.timeout=8e3,t.exports=n},{"./info-ajax":9,"./info-iframe":11,"./transport/sender/xdr":34,"./transport/sender/xhr-cors":35,"./transport/sender/xhr-fake":36,"./transport/sender/xhr-local":37,"./utils/url":52,debug:void 0,events:3,inherits:54}],13:[function(e,t){(function(e){"use strict";t.exports=e.location||{origin:"http://localhost:80",protocol:"http",host:"localhost",port:80,href:"http://localhost/",hash:""}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],14:[function(e,t){(function(n){"use strict";function r(e,t,n){if(!(this instanceof r))return new r(e,t,n);if(arguments.length<1)throw new TypeError("Failed to construct 'SockJS: 1 argument required, but only 0 present");y.call(this),this.readyState=r.CONNECTING,this.extensions="",this.protocol="",n=n||{},n.protocols_whitelist&&m.warn("'protocols_whitelist' is DEPRECATED. Use 'transports' instead."),this._transportsWhitelist=n.transports;var i=n.sessionId||8;if("function"==typeof i)this._generateSessionId=i;else{if("number"!=typeof i)throw new TypeError("If sessionId is used in the options, it needs to be a number or a function.");this._generateSessionId=function(){return f.string(i)}}this._server=n.server||f.numberString(1e3);var s=new o(e);if(!s.host||!s.protocol)throw new SyntaxError("The URL '"+e+"' is invalid");if(s.hash)throw new SyntaxError("The URL must not contain a fragment");if("http:"!==s.protocol&&"https:"!==s.protocol)throw new SyntaxError("The URL's scheme must be either 'http:' or 'https:'. '"+s.protocol+"' is not allowed.");var u="https:"===s.protocol;if("https"===b.protocol&&!u)throw new Error("SecurityError: An insecure SockJS connection may not be initiated from a page loaded over HTTPS");t?Array.isArray(t)||(t=[t]):t=[];var a=t.sort();a.forEach(function(e,t){if(!e)throw new SyntaxError("The protocols entry '"+e+"' is invalid.");if(t<a.length-1&&e===a[t+1])throw new SyntaxError("The protocols entry '"+e+"' is duplicated.")});var l=c.getOrigin(b.href);this._origin=l?l.toLowerCase():null,s.set("pathname",s.pathname.replace(/\/+$/,"")),this.url=s.href,this._urlInfo={nullOrigin:!v.hasDomain(),sameOrigin:c.isOriginEqual(this.url,b.href),sameScheme:c.isSchemeEqual(this.url,b.href)},this._ir=new S(this.url,this._urlInfo),this._ir.once("finish",this._receiveInfo.bind(this))}function i(e){return 1e3===e||e>=3e3&&4999>=e}e("./shims");var s,o=e("url-parse"),u=e("inherits"),a=e("json3"),f=e("./utils/random"),l=e("./utils/escape"),c=e("./utils/url"),h=e("./utils/event"),p=e("./utils/transport"),d=e("./utils/object"),v=e("./utils/browser"),m=e("./utils/log"),g=e("./event/event"),y=e("./event/eventtarget"),b=e("./location"),w=e("./event/close"),E=e("./event/trans-message"),S=e("./info-receiver");u(r,y),r.prototype.close=function(e,t){if(e&&!i(e))throw new Error("InvalidAccessError: Invalid code");if(t&&t.length>123)throw new SyntaxError("reason argument has an invalid length");if(this.readyState!==r.CLOSING&&this.readyState!==r.CLOSED){var n=!0;this._close(e||1e3,t||"Normal closure",n)}},r.prototype.send=function(e){if("string"!=typeof e&&(e=""+e),this.readyState===r.CONNECTING)throw new Error("InvalidStateError: The connection has not been established yet");this.readyState===r.OPEN&&this._transport.send(l.quote(e))},r.version=e("./version"),r.CONNECTING=0,r.OPEN=1,r.CLOSING=2,r.CLOSED=3,r.prototype._receiveInfo=function(e,t){if(this._ir=null,!e)return void this._close(1002,"Cannot connect to server");this._rto=this.countRTO(t),this._transUrl=e.base_url?e.base_url:this.url,e=d.extend(e,this._urlInfo);var n=s.filterToEnabled(this._transportsWhitelist,e);this._transports=n.main,this._connect()},r.prototype._connect=function(){for(var e=this._transports.shift();e;e=this._transports.shift()){if(e.needBody&&(!n.document.body||"undefined"!=typeof n.document.readyState&&"complete"!==n.document.readyState&&"interactive"!==n.document.readyState))return this._transports.unshift(e),void h.attachEvent("load",this._connect.bind(this));var t=this._rto*e.roundTrips||5e3;this._transportTimeoutId=setTimeout(this._transportTimeout.bind(this),t);var r=c.addPath(this._transUrl,"/"+this._server+"/"+this._generateSessionId()),i=new e(r,this._transUrl);return i.on("message",this._transportMessage.bind(this)),i.once("close",this._transportClose.bind(this)),i.transportName=e.transportName,void (this._transport=i)}this._close(2e3,"All transports failed",!1)},r.prototype._transportTimeout=function(){this.readyState===r.CONNECTING&&this._transportClose(2007,"Transport timed out")},r.prototype._transportMessage=function(e){var t,n=this,r=e.slice(0,1),i=e.slice(1);switch(r){case"o":return void this._open();case"h":return void this.dispatchEvent(new g("heartbeat"))}if(i)try{t=a.parse(i)}catch(s){}if("undefined"!=typeof t)switch(r){case"a":Array.isArray(t)&&t.forEach(function(e){n.dispatchEvent(new E(e))});break;case"m":this.dispatchEvent(new E(t));break;case"c":Array.isArray(t)&&2===t.length&&this._close(t[0],t[1],!0)}},r.prototype._transportClose=function(e,t){return this._transport&&(this._transport.removeAllListeners(),this._transport=null,this.transport=null),i(e)||2e3===e||this.readyState!==r.CONNECTING?void this._close(e,t):void this._connect()},r.prototype._open=function(){this.readyState===r.CONNECTING?(this._transportTimeoutId&&(clearTimeout(this._transportTimeoutId),this._transportTimeoutId=null),this.readyState=r.OPEN,this.transport=this._transport.transportName,this.dispatchEvent(new g("open"))):this._close(1006,"Server lost session")},r.prototype._close=function(e,t,n){var i=!1;if(this._ir&&(i=!0,this._ir.close(),this._ir=null),this._transport&&(this._transport.close(),this._transport=null,this.transport=null),this.readyState===r.CLOSED)throw new Error("InvalidStateError: SockJS has already been closed");this.readyState=r.CLOSING,setTimeout(function(){this.readyState=r.CLOSED,i&&this.dispatchEvent(new g("error"));var s=new w("close");s.wasClean=n||!1,s.code=e||1e3,s.reason=t,this.dispatchEvent(s),this.onmessage=this.onclose=this.onerror=null}.bind(this),0)},r.prototype.countRTO=function(e){return e>100?4*e:300+e},t.exports=function(t){return s=p(t),e("./iframe-bootstrap")(r,t),r}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./event/close":2,"./event/event":4,"./event/eventtarget":5,"./event/trans-message":6,"./iframe-bootstrap":8,"./info-receiver":12,"./location":13,"./shims":15,"./utils/browser":44,"./utils/escape":45,"./utils/event":46,"./utils/log":48,"./utils/object":49,"./utils/random":50,"./utils/transport":51,"./utils/url":52,"./version":53,debug:void 0,inherits:54,json3:55,"url-parse":56}],15:[function(){"use strict";function e(e){var t=+e;return t!==t?t=0:0!==t&&t!==1/0&&t!==-1/0&&(t=(t>0||-1)*Math.floor(Math.abs(t))),t}function t(e){return e>>>0}function n(){}var r,i=Array.prototype,s=Object.prototype,o=Function.prototype,u=String.prototype,a=i.slice,f=s.toString,l=function(e){return"[object Function]"===s.toString.call(e)},c=function(e){return"[object Array]"===f.call(e)},h=function(e){return"[object String]"===f.call(e)},p=Object.defineProperty&&function(){try{return Object.defineProperty({},"x",{}),!0}catch(e){return!1}}();r=p?function(e,t,n,r){!r&&t in e||Object.defineProperty(e,t,{configurable:!0,enumerable:!1,writable:!0,value:n})}:function(e,t,n,r){!r&&t in e||(e[t]=n)};var d=function(e,t,n){for(var i in t)s.hasOwnProperty.call(t,i)&&r(e,i,t[i],n)},v=function(e){if(null==e)throw new TypeError("can't convert "+e+" to object");return Object(e)};d(o,{bind:function(e){var t=this;if(!l(t))throw new TypeError("Function.prototype.bind called on incompatible "+t);for(var r=a.call(arguments,1),i=function(){if(this instanceof f){var n=t.apply(this,r.concat(a.call(arguments)));return Object(n)===n?n:this}return t.apply(e,r.concat(a.call(arguments)))},s=Math.max(0,t.length-r.length),o=[],u=0;s>u;u++)o.push("$"+u);var f=Function("binder","return function ("+o.join(",")+"){ return binder.apply(this, arguments); }")(i);return t.prototype&&(n.prototype=t.prototype,f.prototype=new n,n.prototype=null),f}}),d(Array,{isArray:c});var m=Object("a"),g="a"!==m[0]||!(0 in m),y=function(e){var t=!0,n=!0;return e&&(e.call("foo",function(e,n,r){"object"!=typeof r&&(t=!1)}),e.call([1],function(){n="string"==typeof this},"x")),!!e&&t&&n};d(i,{forEach:function(e){var t=v(this),n=g&&h(this)?this.split(""):t,r=arguments[1],i=-1,s=n.length>>>0;if(!l(e))throw new TypeError;for(;++i<s;)i in n&&e.call(r,n[i],i,t)}},!y(i.forEach));var b=Array.prototype.indexOf&&-1!==[0,1].indexOf(1,2);d(i,{indexOf:function(t){var n=g&&h(this)?this.split(""):v(this),r=n.length>>>0;if(!r)return-1;var i=0;for(arguments.length>1&&(i=e(arguments[1])),i=i>=0?i:Math.max(0,r+i);r>i;i++)if(i in n&&n[i]===t)return i;return-1}},b);var w=u.split;2!=="ab".split(/(?:ab)*/).length||4!==".".split(/(.?)(.?)/).length||"t"==="tesst".split(/(s)*/)[1]||4!=="test".split(/(?:)/,-1).length||"".split(/.?/).length||".".split(/()()/).length>1?!function(){var e=void 0===/()??/.exec("")[1];u.split=function(n,r){var s=this;if(void 0===n&&0===r)return[];if("[object RegExp]"!==f.call(n))return w.call(this,n,r);var o,u,a,l,c=[],h=(n.ignoreCase?"i":"")+(n.multiline?"m":"")+(n.extended?"x":"")+(n.sticky?"y":""),p=0;for(n=new RegExp(n.source,h+"g"),s+="",e||(o=new RegExp("^"+n.source+"$(?!\\s)",h)),r=void 0===r?-1>>>0:t(r);(u=n.exec(s))&&(a=u.index+u[0].length,!(a>p&&(c.push(s.slice(p,u.index)),!e&&u.length>1&&u[0].replace(o,function(){for(var e=1;e<arguments.length-2;e++)void 0===arguments[e]&&(u[e]=void 0)}),u.length>1&&u.index<s.length&&i.push.apply(c,u.slice(1)),l=u[0].length,p=a,c.length>=r)));)n.lastIndex===u.index&&n.lastIndex++;return p===s.length?(l||!n.test(""))&&c.push(""):c.push(s.slice(p)),c.length>r?c.slice(0,r):c}}():"0".split(void 0,0).length&&(u.split=function(e,t){return void 0===e&&0===t?[]:w.call(this,e,t)});var E="	\n\f\r   ᠎             　\u2028\u2029﻿",S="​",x="["+E+"]",T=new RegExp("^"+x+x+"*"),N=new RegExp(x+x+"*$"),C=u.trim&&(E.trim()||!S.trim());d(u,{trim:function(){if(void 0===this||null===this)throw new TypeError("can't convert "+this+" to object");return String(this).replace(T,"").replace(N,"")}},C);var k=u.substr,L="".substr&&"b"!=="0b".substr(-1);d(u,{substr:function(e,t){return k.call(this,0>e&&(e=this.length+e)<0?0:e,t)}},L)},{}],16:[function(e,t){"use strict";t.exports=[e("./transport/websocket"),e("./transport/xhr-streaming"),e("./transport/xdr-streaming"),e("./transport/eventsource"),e("./transport/lib/iframe-wrap")(e("./transport/eventsource")),e("./transport/htmlfile"),e("./transport/lib/iframe-wrap")(e("./transport/htmlfile")),e("./transport/xhr-polling"),e("./transport/xdr-polling"),e("./transport/lib/iframe-wrap")(e("./transport/xhr-polling")),e("./transport/jsonp-polling")]},{"./transport/eventsource":20,"./transport/htmlfile":21,"./transport/jsonp-polling":23,"./transport/lib/iframe-wrap":26,"./transport/websocket":38,"./transport/xdr-polling":39,"./transport/xdr-streaming":40,"./transport/xhr-polling":41,"./transport/xhr-streaming":42}],17:[function(e,t){(function(n){"use strict";function r(e,t,n,r){var s=this;i.call(this),setTimeout(function(){s._start(e,t,n,r)},0)}var i=e("events").EventEmitter,s=e("inherits"),o=e("../../utils/event"),u=e("../../utils/url"),a=n.XMLHttpRequest;s(r,i),r.prototype._start=function(e,t,n,i){var s=this;try{this.xhr=new a}catch(f){}if(!this.xhr)return this.emit("finish",0,"no xhr support"),void this._cleanup();t=u.addQuery(t,"t="+ +(new Date)),this.unloadRef=o.unloadAdd(function(){s._cleanup(!0)});try{this.xhr.open(e,t,!0),this.timeout&&"timeout"in this.xhr&&(this.xhr.timeout=this.timeout,this.xhr.ontimeout=function(){s.emit("finish",0,""),s._cleanup(!1)})}catch(l){return this.emit("finish",0,""),void this._cleanup(!1)}if(i&&i.noCredentials||!r.supportsCORS||(this.xhr.withCredentials="true"),i&&i.headers)for(var c in i.headers)this.xhr.setRequestHeader(c,i.headers[c]);this.xhr.onreadystatechange=function(){if(s.xhr){var e,t,n=s.xhr;switch(n.readyState){case 3:try{t=n.status,e=n.responseText}catch(r){}1223===t&&(t=204),200===t&&e&&e.length>0&&s.emit("chunk",t,e);break;case 4:t=n.status,1223===t&&(t=204),(12005===t||12029===t)&&(t=0),s.emit("finish",t,n.responseText),s._cleanup(!1)}}};try{s.xhr.send(n)}catch(l){s.emit("finish",0,""),s._cleanup(!1)}},r.prototype._cleanup=function(e){if(this.xhr){if(this.removeAllListeners(),o.unloadDel(this.unloadRef),this.xhr.onreadystatechange=function(){},this.xhr.ontimeout&&(this.xhr.ontimeout=null),e)try{this.xhr.abort()}catch(t){}this.unloadRef=this.xhr=null}},r.prototype.close=function(){this._cleanup(!0)},r.enabled=!!a;var f=["Active"].concat("Object").join("X");!r.enabled&&f in n&&(a=function(){try{return new n[f]("Microsoft.XMLHTTP")}catch(e){return null}},r.enabled=!!(new a));var l=!1;try{l="withCredentials"in new a}catch(c){}r.supportsCORS=l,t.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../utils/event":46,"../../utils/url":52,debug:void 0,events:3,inherits:54}],18:[function(e,t){(function(e){t.exports=e.EventSource}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],19:[function(e,t){(function(e){t.exports=e.WebSocket||e.MozWebSocket}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],20:[function(e,t){"use strict";function n(e){if(!n.enabled())throw new Error("Transport created when disabled");i.call(this,e,"/eventsource",s,o)}var r=e("inherits"),i=e("./lib/ajax-based"),s=e("./receiver/eventsource"),o=e("./sender/xhr-cors"),u=e("eventsource");r(n,i),n.enabled=function(){return!!u},n.transportName="eventsource",n.roundTrips=2,t.exports=n},{"./lib/ajax-based":24,"./receiver/eventsource":29,"./sender/xhr-cors":35,eventsource:18,inherits:54}],21:[function(e,t){"use strict";function n(e){if(!i.enabled)throw new Error("Transport created when disabled");o.call(this,e,"/htmlfile",i,s)}var r=e("inherits"),i=e("./receiver/htmlfile"),s=e("./sender/xhr-local"),o=e("./lib/ajax-based");r(n,o),n.enabled=function(e){return i.enabled&&e.sameOrigin},n.transportName="htmlfile",n.roundTrips=2,t.exports=n},{"./lib/ajax-based":24,"./receiver/htmlfile":30,"./sender/xhr-local":37,inherits:54}],22:[function(e,t){"use strict";function n(e,t,r){if(!n.enabled())throw new Error("Transport created when disabled");s.call(this);var i=this;this.origin=u.getOrigin(r),this.baseUrl=r,this.transUrl=t,this.transport=e,this.windowId=l.string(8);var o=u.addPath(r,"/iframe.html")+"#"+this.windowId;this.iframeObj=a.createIframe(o,function(e){i.emit("close",1006,"Unable to load an iframe ("+e+")"),i.close()}),this.onmessageCallback=this._message.bind(this),f.attachEvent("message",this.onmessageCallback)}var r=e("inherits"),i=e("json3"),s=e("events").EventEmitter,o=e("../version"),u=e("../utils/url"),a=e("../utils/iframe"),f=e("../utils/event"),l=e("../utils/random");r(n,s),n.prototype.close=function(){if(this.removeAllListeners(),this.iframeObj){f.detachEvent("message",this.onmessageCallback);try{this.postMessage("c")}catch(e){}this.iframeObj.cleanup(),this.iframeObj=null,this.onmessageCallback=this.iframeObj=null}},n.prototype._message=function(e){if(u.isOriginEqual(e.origin,this.origin)){var t;try{t=i.parse(e.data)}catch(n){return}if(t.windowId===this.windowId)switch(t.type){case"s":this.iframeObj.loaded(),this.postMessage("s",i.stringify([o,this.transport,this.transUrl,this.baseUrl]));break;case"t":this.emit("message",t.data);break;case"c":var r;try{r=i.parse(t.data)}catch(n){return}this.emit("close",r[0],r[1]),this.close()}}},n.prototype.postMessage=function(e,t){this.iframeObj.post(i.stringify({windowId:this.windowId,type:e,data:t||""}),this.origin)},n.prototype.send=function(e){this.postMessage("m",e)},n.enabled=function(){return a.iframeEnabled},n.transportName="iframe",n.roundTrips=2,t.exports=n},{"../utils/event":46,"../utils/iframe":47,"../utils/random":50,"../utils/url":52,"../version":53,debug:void 0,events:3,inherits:54,json3:55}],23:[function(e,t){(function(n){"use strict";function r(e){if(!r.enabled())throw new Error("Transport created when disabled");s.call(this,e,"/jsonp",u,o)}var i=e("inherits"),s=e("./lib/sender-receiver"),o=e("./receiver/jsonp"),u=e("./sender/jsonp");i(r,s),r.enabled=function(){return!!n.document},r.transportName="jsonp-polling",r.roundTrips=1,r.needBody=!0,t.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./lib/sender-receiver":28,"./receiver/jsonp":31,"./sender/jsonp":33,inherits:54}],24:[function(e,t){"use strict";function n(e){return function(t,n,r){var i={};"string"==typeof n&&(i.headers={"Content-type":"text/plain"});var o=s.addPath(t,"/xhr_send"),u=new e("POST",o,n,i);return u.once("finish",function(e){return u=null,200!==e&&204!==e?r(new Error("http status "+e)):void r()}),function(){u.close(),u=null;var e=new Error("Aborted");e.code=1e3,r(e)}}}function r(e,t,r,i){o.call(this,e,t,n(i),r,i)}var i=e("inherits"),s=e("../../utils/url"),o=e("./sender-receiver");i(r,o),t.exports=r},{"../../utils/url":52,"./sender-receiver":28,debug:void 0,inherits:54}],25:[function(e,t){"use strict";function n(e,t){i.call(this),this.sendBuffer=[],this.sender=t,this.url=e}var r=e("inherits"),i=e("events").EventEmitter;r(n,i),n.prototype.send=function(e){this.sendBuffer.push(e),this.sendStop||this.sendSchedule()},n.prototype.sendScheduleWait=function(){var e,t=this;this.sendStop=function(){t.sendStop=null,clearTimeout(e)},e=setTimeout(function(){t.sendStop=null,t.sendSchedule()},25)},n.prototype.sendSchedule=function(){var e=this;if(this.sendBuffer.length>0){var t="["+this.sendBuffer.join(",")+"]";this.sendStop=this.sender(this.url,t,function(t){e.sendStop=null,t?(e.emit("close",t.code||1006,"Sending error: "+t),e._cleanup()):e.sendScheduleWait()}),this.sendBuffer=[]}},n.prototype._cleanup=function(){this.removeAllListeners()},n.prototype.stop=function(){this._cleanup(),this.sendStop&&(this.sendStop(),this.sendStop=null)},t.exports=n},{debug:void 0,events:3,inherits:54}],26:[function(e,t){(function(n){"use strict";var r=e("inherits"),i=e("../iframe"),s=e("../../utils/object");t.exports=function(e){function t(t,n){i.call(this,e.transportName,t,n)}return r(t,i),t.enabled=function(t,r){if(!n.document)return!1;var u=s.extend({},r);return u.sameOrigin=!0,e.enabled(u)&&i.enabled()},t.transportName="iframe-"+e.transportName,t.needBody=!0,t.roundTrips=i.roundTrips+e.roundTrips-1,t.facadeTransport=e,t}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../utils/object":49,"../iframe":22,inherits:54}],27:[function(e,t){"use strict";function n(e,t,n){i.call(this),this.Receiver=e,this.receiveUrl=t,this.AjaxObject=n,this._scheduleReceiver()}var r=e("inherits"),i=e("events").EventEmitter;r(n,i),n.prototype._scheduleReceiver=function(){var e=this,t=this.poll=new this.Receiver(this.receiveUrl,this.AjaxObject);t.on("message",function(t){e.emit("message",t)}),t.once("close",function(n,r){e.poll=t=null,e.pollIsClosing||("network"===r?e._scheduleReceiver():(e.emit("close",n||1006,r),e.removeAllListeners()))})},n.prototype.abort=function(){this.removeAllListeners(),this.pollIsClosing=!0,this.poll&&this.poll.abort()},t.exports=n},{debug:void 0,events:3,inherits:54}],28:[function(e,t){"use strict";function n(e,t,n,r,u){var a=i.addPath(e,t),f=this;s.call(this,e,n),this.poll=new o(r,a,u),this.poll.on("message",function(e){f.emit("message",e)}),this.poll.once("close",function(e,t){f.poll=null,f.emit("close",e,t),f.close()})}var r=e("inherits"),i=e("../../utils/url"),s=e("./buffered-sender"),o=e("./polling");r(n,s),n.prototype.close=function(){this.removeAllListeners(),this.poll&&(this.poll.abort(),this.poll=null),this.stop()},t.exports=n},{"../../utils/url":52,"./buffered-sender":25,"./polling":27,debug:void 0,inherits:54}],29:[function(e,t){"use strict";function n(e){i.call(this);var t=this,n=this.es=new s(e);n.onmessage=function(e){t.emit("message",decodeURI(e.data))},n.onerror=function(e){var r=2!==n.readyState?"network":"permanent";t._cleanup(),t._close(r)}}var r=e("inherits"),i=e("events").EventEmitter,s=e("eventsource");r(n,i),n.prototype.abort=function(){this._cleanup(),this._close("user")},n.prototype._cleanup=function(){var e=this.es;e&&(e.onmessage=e.onerror=null,e.close(),this.es=null)},n.prototype._close=function(e){var t=this;setTimeout(function(){t.emit("close",null,e),t.removeAllListeners()},200)},t.exports=n},{debug:void 0,events:3,eventsource:18,inherits:54}],30:[function(e,t){(function(n){"use strict";function r(e){u.call(this);var t=this;s.polluteGlobalNamespace(),this.id="a"+a.string(6),e=o.addQuery(e,"c="+decodeURIComponent(s.WPrefix+"."+this.id));var i=r.htmlfileEnabled?s.createHtmlfile:s.createIframe;n[s.WPrefix][this.id]={start:function(){t.iframeObj.loaded()},message:function(e){t.emit("message",e)},stop:function(){t._cleanup(),t._close("network")}},this.iframeObj=i(e,function(){t._cleanup(),t._close("permanent")})}var i=e("inherits"),s=e("../../utils/iframe"),o=e("../../utils/url"),u=e("events").EventEmitter,a=e("../../utils/random");i(r,u),r.prototype.abort=function(){this._cleanup(),this._close("user")},r.prototype._cleanup=function(){this.iframeObj&&(this.iframeObj.cleanup(),this.iframeObj=null),delete n[s.WPrefix][this.id]},r.prototype._close=function(e){this.emit("close",null,e),this.removeAllListeners()},r.htmlfileEnabled=!1;var f=["Active"].concat("Object").join("X");if(f in n)try{r.htmlfileEnabled=!!(new n[f]("htmlfile"))}catch(l){}r.enabled=r.htmlfileEnabled||s.iframeEnabled,t.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../utils/iframe":47,"../../utils/random":50,"../../utils/url":52,debug:void 0,events:3,inherits:54}],31:[function(e,t){(function(n){"use strict";function r(e){var t=this;f.call(this),i.polluteGlobalNamespace(),this.id="a"+s.string(6);var o=u.addQuery(e,"c="+encodeURIComponent(i.WPrefix+"."+this.id));n[i.WPrefix][this.id]=this._callback.bind(this),this._createScript(o),this.timeoutId=setTimeout(function(){t._abort(new Error("JSONP script loaded abnormally (timeout)"))},r.timeout)}var i=e("../../utils/iframe"),s=e("../../utils/random"),o=e("../../utils/browser"),u=e("../../utils/url"),a=e("inherits"),f=e("events").EventEmitter;a(r,f),r.prototype.abort=function(){if(n[i.WPrefix][this.id]){var e=new Error("JSONP user aborted read");e.code=1e3,this._abort(e)}},r.timeout=35e3,r.scriptErrorTimeout=1e3,r.prototype._callback=function(e){this._cleanup(),this.aborting||(e&&this.emit("message",e),this.emit("close",null,"network"),this.removeAllListeners())},r.prototype._abort=function(e){this._cleanup(),this.aborting=!0,this.emit("close",e.code,e.message),this.removeAllListeners()},r.prototype._cleanup=function(){if(clearTimeout(this.timeoutId),this.script2&&(this.script2.parentNode.removeChild(this.script2),this.script2=null),this.script){var e=this.script;e.parentNode.removeChild(e),e.onreadystatechange=e.onerror=e.onload=e.onclick=null,this.script=null}delete n[i.WPrefix][this.id]},r.prototype._scriptError=function(){var e=this;this.errorTimer||(this.errorTimer=setTimeout(function(){e.loadedOkay||e._abort(new Error("JSONP script loaded abnormally (onerror)"))},r.scriptErrorTimeout))},r.prototype._createScript=function(e){var t,r=this,i=this.script=n.document.createElement("script");if(i.id="a"+s.string(8),i.src=e,i.type="text/javascript",i.charset="UTF-8",i.onerror=this._scriptError.bind(this),i.onload=function(){r._abort(new Error("JSONP script loaded abnormally (onload)"))},i.onreadystatechange=function(){if(/loaded|closed/.test(i.readyState)){if(i&&i.htmlFor&&i.onclick){r.loadedOkay=!0;try{i.onclick()}catch(e){}}i&&r._abort(new Error("JSONP script loaded abnormally (onreadystatechange)"))}},"undefined"==typeof i.async&&n.document.attachEvent)if(o.isOpera())t=this.script2=n.document.createElement("script"),t.text="try{var a = document.getElementById('"+i.id+"'); if(a)a.onerror();}catch(x){};",i.async=t.async=!1;else{try{i.htmlFor=i.id,i.event="onclick"}catch(u){}i.async=!0}"undefined"!=typeof i.async&&(i.async=!0);var a=n.document.getElementsByTagName("head")[0];a.insertBefore(i,a.firstChild),t&&a.insertBefore(t,a.firstChild)},t.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../utils/browser":44,"../../utils/iframe":47,"../../utils/random":50,"../../utils/url":52,debug:void 0,events:3,inherits:54}],32:[function(e,t){"use strict";function n(e,t){i.call(this);var n=this;this.bufferPosition=0,this.xo=new t("POST",e,null),this.xo.on("chunk",this._chunkHandler.bind(this)),this.xo.once("finish",function(e,t){n._chunkHandler(e,t),n.xo=null;var r=200===e?"network":"permanent";n.emit("close",null,r),n._cleanup()})}var r=e("inherits"),i=e("events").EventEmitter;r(n,i),n.prototype._chunkHandler=function(e,t){if(200===e&&t)for(var n=-1;;this.bufferPosition+=n+1){var r=t.slice(this.bufferPosition);if(n=r.indexOf("\n"),-1===n)break;var i=r.slice(0,n);i&&this.emit("message",i)}},n.prototype._cleanup=function(){this.removeAllListeners()},n.prototype.abort=function(){this.xo&&(this.xo.close(),this.emit("close",null,"user"),this.xo=null),this._cleanup()},t.exports=n},{debug:void 0,events:3,inherits:54}],33:[function(e,t){(function(n){"use strict";function r(e){try{return n.document.createElement('<iframe name="'+e+'">')}catch(t){var r=n.document.createElement("iframe");return r.name=e,r}}function i(){s=n.document.createElement("form"),s.style.display="none",s.style.position="absolute",s.method="POST",s.enctype="application/x-www-form-urlencoded",s.acceptCharset="UTF-8",o=n.document.createElement("textarea"),o.name="d",s.appendChild(o),n.document.body.appendChild(s)}var s,o,u=e("../../utils/random"),a=e("../../utils/url");t.exports=function(e,t,n){s||i();var f="a"+u.string(8);s.target=f,s.action=a.addQuery(a.addPath(e,"/jsonp_send"),"i="+f);var l=r(f);l.id=f,l.style.display="none",s.appendChild(l);try{o.value=t}catch(c){}s.submit();var h=function(e){l.onerror&&(l.onreadystatechange=l.onerror=l.onload=null,setTimeout(function(){l.parentNode.removeChild(l),l=null},500),o.value="",n(e))};return l.onerror=function(){h()},l.onload=function(){h()},l.onreadystatechange=function(e){"complete"===l.readyState&&h()},function(){h(new Error("Aborted"))}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../utils/random":50,"../../utils/url":52,debug:void 0}],34:[function(e,t){(function(n){"use strict";function r(e,t,n){var r=this;i.call(this),setTimeout(function(){r._start(e,t,n)},0)}var i=e("events").EventEmitter,s=e("inherits"),o=e("../../utils/event"),u=e("../../utils/browser"),a=e("../../utils/url");s(r,i),r.prototype._start=function(e,t,r){var i=this,s=new n.XDomainRequest;t=a.addQuery(t,"t="+ +(new Date)),s.onerror=function(){i._error()},s.ontimeout=function(){i._error()},s.onprogress=function(){i.emit("chunk",200,s.responseText)},s.onload=function(){i.emit("finish",200,s.responseText),i._cleanup(!1)},this.xdr=s,this.unloadRef=o.unloadAdd(function(){i._cleanup(!0)});try{this.xdr.open(e,t),this.timeout&&(this.xdr.timeout=this.timeout),this.xdr.send(r)}catch(u){this._error()}},r.prototype._error=function(){this.emit("finish",0,""),this._cleanup(!1)},r.prototype._cleanup=function(e){if(this.xdr){if(this.removeAllListeners(),o.unloadDel(this.unloadRef),this.xdr.ontimeout=this.xdr.onerror=this.xdr.onprogress=this.xdr.onload=null,e)try{this.xdr.abort()}catch(t){}this.unloadRef=this.xdr=null}},r.prototype.close=function(){this._cleanup(!0)},r.enabled=!!n.XDomainRequest&&!!u.hasDomain(),t.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../utils/browser":44,"../../utils/event":46,"../../utils/url":52,debug:void 0,events:3,inherits:54}],35:[function(e,t){"use strict";function n(e,t,n,r){i.call(this,e,t,n,r)}var r=e("inherits"),i=e("../driver/xhr");r(n,i),n.enabled=i.enabled&&i.supportsCORS,t.exports=n},{"../driver/xhr":17,inherits:54}],36:[function(e,t){"use strict";function n(){var e=this;r.call(this),this.to=setTimeout(function(){e.emit("finish",200,"{}")},n.timeout)}var r=e("events").EventEmitter,i=e("inherits");i(n,r),n.prototype.close=function(){clearTimeout(this.to)},n.timeout=2e3,t.exports=n},{events:3,inherits:54}],37:[function(e,t){"use strict";function n(e,t,n){i.call(this,e,t,n,{noCredentials:!0})}var r=e("inherits"),i=e("../driver/xhr");r(n,i),n.enabled=i.enabled,t.exports=n},{"../driver/xhr":17,inherits:54}],38:[function(e,t){"use strict";function n(e){if(!n.enabled())throw new Error("Transport created when disabled");o.call(this);var t=this,s=i.addPath(e,"/websocket");s="https"===s.slice(0,5)?"wss"+s.slice(5):"ws"+s.slice(4),this.url=s,this.ws=new u(this.url),this.ws.onmessage=function(e){t.emit("message",e.data)},this.unloadRef=r.unloadAdd(function(){t.ws.close()}),this.ws.onclose=function(e){t.emit("close",e.code,e.reason),t._cleanup()},this.ws.onerror=function(e){t.emit("close",1006,"WebSocket connection broken"),t._cleanup()}}var r=e("../utils/event"),i=e("../utils/url"),s=e("inherits"),o=e("events").EventEmitter,u=e("./driver/websocket");s(n,o),n.prototype.send=function(e){var t="["+e+"]";this.ws.send(t)},n.prototype.close=function(){this.ws&&this.ws.close(),this._cleanup()},n.prototype._cleanup=function(){var e=this.ws;e&&(e.onmessage=e.onclose=e.onerror=null),r.unloadDel(this.unloadRef),this.unloadRef=this.ws=null,this.removeAllListeners()},n.enabled=function(){return!!u},n.transportName="websocket",n.roundTrips=2,t.exports=n},{"../utils/event":46,"../utils/url":52,"./driver/websocket":19,debug:void 0,events:3,inherits:54}],39:[function(e,t){"use strict";function n(e){if(!u.enabled)throw new Error("Transport created when disabled");i.call(this,e,"/xhr",o,u)}var r=e("inherits"),i=e("./lib/ajax-based"),s=e("./xdr-streaming"),o=e("./receiver/xhr"),u=e("./sender/xdr");r(n,i),n.enabled=s.enabled,n.transportName="xdr-polling",n.roundTrips=2,t.exports=n},{"./lib/ajax-based":24,"./receiver/xhr":32,"./sender/xdr":34,"./xdr-streaming":40,inherits:54}],40:[function(e,t){"use strict";function n(e){if(!o.enabled)throw new Error("Transport created when disabled");i.call(this,e,"/xhr_streaming",s,o)}var r=e("inherits"),i=e("./lib/ajax-based"),s=e("./receiver/xhr"),o=e("./sender/xdr");r(n,i),n.enabled=function(e){return e.cookie_needed||e.nullOrigin?!1:o.enabled&&e.sameScheme},n.transportName="xdr-streaming",n.roundTrips=2,t.exports=n},{"./lib/ajax-based":24,"./receiver/xhr":32,"./sender/xdr":34,inherits:54}],41:[function(e,t){"use strict";function n(e){if(!u.enabled&&!o.enabled)throw new Error("Transport created when disabled");i.call(this,e,"/xhr",s,o)}var r=e("inherits"),i=e("./lib/ajax-based"),s=e("./receiver/xhr"),o=e("./sender/xhr-cors"),u=e("./sender/xhr-local");r(n,i),n.enabled=function(e){return e.nullOrigin?!1:u.enabled&&e.sameOrigin?!0:o.enabled},n.transportName="xhr-polling",n.roundTrips=2,t.exports=n},{"./lib/ajax-based":24,"./receiver/xhr":32,"./sender/xhr-cors":35,"./sender/xhr-local":37,inherits:54}],42:[function(e,t){(function(n){"use strict";function r(e){if(!a.enabled&&!u.enabled)throw new Error("Transport created when disabled");s.call(this,e,"/xhr_streaming",o,u)}var i=e("inherits"),s=e("./lib/ajax-based"),o=e("./receiver/xhr"),u=e("./sender/xhr-cors"),a=e("./sender/xhr-local"),f=e("../utils/browser");i(r,s),r.enabled=function(e){return e.nullOrigin?!1:f.isOpera()?!1:u.enabled},r.transportName="xhr-streaming",r.roundTrips=2,r.needBody=!!n.document,t.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../utils/browser":44,"./lib/ajax-based":24,"./receiver/xhr":32,"./sender/xhr-cors":35,"./sender/xhr-local":37,inherits:54}],43:[function(e,t){(function(e){"use strict";t.exports.randomBytes=e.crypto&&e.crypto.getRandomValues?function(t){var n=new Uint8Array(t);return e.crypto.getRandomValues(n),n}:function(e){for(var t=new Array(e),n=0;e>n;n++)t[n]=Math.floor(256*Math.random());return t}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],44:[function(e,t){(function(e){"use strict";t.exports={isOpera:function(){return e.navigator&&/opera/i.test(e.navigator.userAgent)},isKonqueror:function(){return e.navigator&&/konqueror/i.test(e.navigator.userAgent)},hasDomain:function(){if(!e.document)return!0;try{return!!e.document.domain}catch(t){return!1}}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],45:[function(e,t){"use strict";var n,r=e("json3"),i=/[\x00-\x1f\ud800-\udfff\ufffe\uffff\u0300-\u0333\u033d-\u0346\u034a-\u034c\u0350-\u0352\u0357-\u0358\u035c-\u0362\u0374\u037e\u0387\u0591-\u05af\u05c4\u0610-\u0617\u0653-\u0654\u0657-\u065b\u065d-\u065e\u06df-\u06e2\u06eb-\u06ec\u0730\u0732-\u0733\u0735-\u0736\u073a\u073d\u073f-\u0741\u0743\u0745\u0747\u07eb-\u07f1\u0951\u0958-\u095f\u09dc-\u09dd\u09df\u0a33\u0a36\u0a59-\u0a5b\u0a5e\u0b5c-\u0b5d\u0e38-\u0e39\u0f43\u0f4d\u0f52\u0f57\u0f5c\u0f69\u0f72-\u0f76\u0f78\u0f80-\u0f83\u0f93\u0f9d\u0fa2\u0fa7\u0fac\u0fb9\u1939-\u193a\u1a17\u1b6b\u1cda-\u1cdb\u1dc0-\u1dcf\u1dfc\u1dfe\u1f71\u1f73\u1f75\u1f77\u1f79\u1f7b\u1f7d\u1fbb\u1fbe\u1fc9\u1fcb\u1fd3\u1fdb\u1fe3\u1feb\u1fee-\u1fef\u1ff9\u1ffb\u1ffd\u2000-\u2001\u20d0-\u20d1\u20d4-\u20d7\u20e7-\u20e9\u2126\u212a-\u212b\u2329-\u232a\u2adc\u302b-\u302c\uaab2-\uaab3\uf900-\ufa0d\ufa10\ufa12\ufa15-\ufa1e\ufa20\ufa22\ufa25-\ufa26\ufa2a-\ufa2d\ufa30-\ufa6d\ufa70-\ufad9\ufb1d\ufb1f\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufb4e\ufff0-\uffff]/g,s=function(e){var t,n={},r=[];for(t=0;65536>t;t++)r.push(String.fromCharCode(t));return e.lastIndex=0,r.join("").replace(e,function(e){return n[e]="\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4),""}),e.lastIndex=0,n};t.exports={quote:function(e){var t=r.stringify(e);return i.lastIndex=0,i.test(t)?(n||(n=s(i)),t.replace(i,function(e){return n[e]})):t}}},{json3:55}],46:[function(e,t){(function(n){"use strict";var r=e("./random"),i={},s=!1,o=n.chrome&&n.chrome.app&&n.chrome.app.runtime;t.exports={attachEvent:function(e,t){"undefined"!=typeof n.addEventListener?n.addEventListener(e,t,!1):n.document&&n.attachEvent&&(n.document.attachEvent("on"+e,t),n.attachEvent("on"+e,t))},detachEvent:function(e,t){"undefined"!=typeof n.addEventListener?n.removeEventListener(e,t,!1):n.document&&n.detachEvent&&(n.document.detachEvent("on"+e,t),n.detachEvent("on"+e,t))},unloadAdd:function(e){if(o)return null;var t=r.string(8);return i[t]=e,s&&setTimeout(this.triggerUnloadCallbacks,0),t},unloadDel:function(e){e in i&&delete i[e]},triggerUnloadCallbacks:function(){for(var e in i)i[e](),delete i[e]}};var u=function(){s||(s=!0,t.exports.triggerUnloadCallbacks())};o||t.exports.attachEvent("unload",u)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./random":50}],47:[function(e,t){(function(n){"use strict";var r=e("./event"),i=e("json3"),s=e("./browser");t.exports={WPrefix:"_jp",currentWindowId:null,polluteGlobalNamespace:function(){t.exports.WPrefix in n||(n[t.exports.WPrefix]={})},postMessage:function(e,r){n.parent!==n&&n.parent.postMessage(i.stringify({windowId:t.exports.currentWindowId,type:e,data:r||""}),"*")},createIframe:function(e,t){var i,s,o=n.document.createElement("iframe"),u=function(){clearTimeout(i);try{o.onload=null}catch(e){}o.onerror=null},a=function(){o&&(u(),setTimeout(function(){o&&o.parentNode.removeChild(o),o=null},0),r.unloadDel(s))},f=function(e){o&&(a(),t(e))},l=function(e,t){try{o&&o.contentWindow&&setTimeout(function(){o.contentWindow.postMessage(e,t)},0)}catch(n){}};return o.src=e,o.style.display="none",o.style.position="absolute",o.onerror=function(){f("onerror")},o.onload=function(){clearTimeout(i),i=setTimeout(function(){f("onload timeout")},2e3)},n.document.body.appendChild(o),i=setTimeout(function(){f("timeout")},15e3),s=r.unloadAdd(a),{post:l,cleanup:a,loaded:u}},createHtmlfile:function(e,i){var s,o,u,a=["Active"].concat("Object").join("X"),f=new n[a]("htmlfile"),l=function(){clearTimeout(s),u.onerror=null},c=function(){f&&(l(),r.unloadDel(o),u.parentNode.removeChild(u),u=f=null,CollectGarbage())},h=function(e){f&&(c(),i(e))},p=function(e,t){try{u&&u.contentWindow&&setTimeout(function(){u.contentWindow.postMessage(e,t)},0)}catch(n){}};f.open(),f.write('<html><script>document.domain="'+n.document.domain+'";</script></html>'),f.close(),f.parentWindow[t.exports.WPrefix]=n[t.exports.WPrefix];var d=f.createElement("div");return f.body.appendChild(d),u=f.createElement("iframe"),d.appendChild(u),u.src=e,u.onerror=function(){h("onerror")},s=setTimeout(function(){h("timeout")},15e3),o=r.unloadAdd(c),{post:p,cleanup:c,loaded:l}}},t.exports.iframeEnabled=!1,n.document&&(t.exports.iframeEnabled=("function"==typeof n.postMessage||"object"==typeof n.postMessage)&&!s.isKonqueror())}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./browser":44,"./event":46,debug:void 0,json3:55}],48:[function(e,t){(function(e){"use strict";var n={};["log","debug","warn"].forEach(function(t){var r=e.console&&e.console[t]&&e.console[t].apply;n[t]=r?function(){return e.console[t].apply(e.console,arguments)}:"log"===t?function(){}:n.log}),t.exports=n}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],49:[function(e,t){"use strict";t.exports={isObject:function(e){var t=typeof e;return"function"===t||"object"===t&&!!e},extend:function(e){if(!this.isObject(e))return e;for(var t,n,r=1,i=arguments.length;i>r;r++){t=arguments[r];for(n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e}}},{}],50:[function(e,t){"use strict";var n=e("crypto"),r="abcdefghijklmnopqrstuvwxyz012345";t.exports={string:function(e){for(var t=r.length,i=n.randomBytes(e),s=[],o=0;e>o;o++)s.push(r.substr(i[o]%t,1));return s.join("")},number:function(e){return Math.floor(Math.random()*e)},numberString:function(e){var t=(""+(e-1)).length,n=(new Array(t+1)).join("0");return(n+this.number(e)).slice(-t)}}},{crypto:43}],51:[function(e,t){"use strict";t.exports=function(e){return{filterToEnabled:function(t,n){var r={main:[],facade:[]};return t?"string"==typeof t&&(t=[t]):t=[],e.forEach(function(e){e&&("websocket"!==e.transportName||n.websocket!==!1)&&(t.length&&-1===t.indexOf(e.transportName)||e.enabled(n)&&(r.main.push(e),e.facadeTransport&&r.facade.push(e.facadeTransport)))}),r}}}},{debug:void 0}],52:[function(e,t){"use strict";var n=e("url-parse");t.exports={getOrigin:function(e){if(!e)return null;var t=new n(e);if("file:"===t.protocol)return null;var r=t.port;return r||(r="https:"===t.protocol?"443":"80"),t.protocol+"//"+t.hostname+":"+r},isOriginEqual:function(e,t){var n=this.getOrigin(e)===this.getOrigin(t);return n},isSchemeEqual:function(e,t){return e.split(":")[0]===t.split(":")[0]},addPath:function(e,t){var n=e.split("?");return n[0]+t+(n[1]?"?"+n[1]:"")},addQuery:function(e,t){return e+(-1===e.indexOf("?")?"?"+t:"&"+t)}}},{debug:void 0,"url-parse":56}],53:[function(e,t){t.exports="1.0.1"},{}],54:[function(e,t){t.exports="function"==typeof Object.create?function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},{}],55:[function(n,r,i){(function(n){(function(){function s(e,t){function n(e){if(n[e]!==m)return n[e];var s;if("bug-string-char-index"==e)s="a"!="a"[0];else if("json"==e)s=n("json-stringify")&&n("json-parse");else{var o,u='{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}';if("json-stringify"==e){var f=t.stringify,l="function"==typeof f&&b;if(l){(o=function(){return 1}).toJSON=o;try{l="0"===f(0)&&"0"===f(new r)&&'""'==f(new i)&&f(y)===m&&f(m)===m&&f()===m&&"1"===f(o)&&"[1]"==f([o])&&"[null]"==f([m])&&"null"==f(null)&&"[null,null,null]"==f([m,y,null])&&f({a:[o,!0,!1,null,"\0\b\n\f\r	"]})==u&&"1"===f(null,o)&&"[\n 1,\n 2\n]"==f([1,2],null,1)&&'"-271821-04-20T00:00:00.000Z"'==f(new a(-864e13))&&'"+275760-09-13T00:00:00.000Z"'==f(new a(864e13))&&'"-000001-01-01T00:00:00.000Z"'==f(new a(-621987552e5))&&'"1969-12-31T23:59:59.999Z"'==f(new a(-1))}catch(c){l=!1}}s=l}if("json-parse"==e){var h=t.parse;if("function"==typeof h)try{if(0===h("0")&&!h(!1)){o=h(u);var p=5==o.a.length&&1===o.a[0];if(p){try{p=!h('"	"')}catch(c){}if(p)try{p=1!==h("01")}catch(c){}if(p)try{p=1!==h("1.")}catch(c){}}}}catch(c){p=!1}s=p}}return n[e]=!!s}e||(e=f.Object()),t||(t=f.Object());var r=e.Number||f.Number,i=e.String||f.String,o=e.Object||f.Object,a=e.Date||f.Date,l=e.SyntaxError||f.SyntaxError,c=e.TypeError||f.TypeError,h=e.Math||f.Math,p=e.JSON||f.JSON;"object"==typeof p&&p&&(t.stringify=p.stringify,t.parse=p.parse);var d,v,m,g=o.prototype,y=g.toString,b=new a(-0xc782b5b800cec);try{b=-109252==b.getUTCFullYear()&&0===b.getUTCMonth()&&1===b.getUTCDate()&&10==b.getUTCHours()&&37==b.getUTCMinutes()&&6==b.getUTCSeconds()&&708==b.getUTCMilliseconds()}catch(w){}if(!n("json")){var E="[object Function]",S="[object Date]",x="[object Number]",T="[object String]",N="[object Array]",C="[object Boolean]",k=n("bug-string-char-index");if(!b)var L=h.floor,A=[0,31,59,90,120,151,181,212,243,273,304,334],O=function(e,t){return A[t]+365*(e-1970)+L((e-1969+(t=+(t>1)))/4)-L((e-1901+t)/100)+L((e-1601+t)/400)};if((d=g.hasOwnProperty)||(d=function(e){var t,n={};return(n.__proto__=null,n.__proto__={toString:1},n).toString!=y?d=function(e){var t=this.__proto__,n=e in(this.__proto__=null,this);return this.__proto__=t,n}:(t=n.constructor,d=function(e){var n=(this.constructor||t).prototype;return e in this&&!(e in n&&this[e]===n[e])}),n=null,d.call(this,e)}),v=function(e,t){var n,r,i,s=0;(n=function(){this.valueOf=0}).prototype.valueOf=0,r=new n;for(i in r)d.call(r,i)&&s++;return n=r=null,s?v=2==s?function(e,t){var n,r={},i=y.call(e)==E;for(n in e)i&&"prototype"==n||d.call(r,n)||!(r[n]=1)||!d.call(e,n)||t(n)}:function(e,t){var n,r,i=y.call(e)==E;for(n in e)i&&"prototype"==n||!d.call(e,n)||(r="constructor"===n)||t(n);(r||d.call(e,n="constructor"))&&t(n)}:(r=["valueOf","toString","toLocaleString","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","constructor"],v=function(e,t){var n,i,s=y.call(e)==E,o=!s&&"function"!=typeof e.constructor&&u[typeof e.hasOwnProperty]&&e.hasOwnProperty||d;for(n in e)s&&"prototype"==n||!o.call(e,n)||t(n);for(i=r.length;n=r[--i];o.call(e,n)&&t(n));}),v(e,t)},!n("json-stringify")){var M={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"},_="000000",D=function(e,t){return(_+(t||0)).slice(-e)},P="\\u00",H=function(e){for(var t='"',n=0,r=e.length,i=!k||r>10,s=i&&(k?e.split(""):e);r>n;n++){var o=e.charCodeAt(n);switch(o){case 8:case 9:case 10:case 12:case 13:case 34:case 92:t+=M[o];break;default:if(32>o){t+=P+D(2,o.toString(16));break}t+=i?s[n]:e.charAt(n)}}return t+'"'},B=function(e,t,n,r,i,s,o){var u,a,f,l,h,p,g,b,w,E,k,A,M,_,P,j;try{u=t[e]}catch(F){}if("object"==typeof u&&u)if(a=y.call(u),a!=S||d.call(u,"toJSON"))"function"==typeof u.toJSON&&(a!=x&&a!=T&&a!=N||d.call(u,"toJSON"))&&(u=u.toJSON(e));else if(u>-1/0&&1/0>u){if(O){for(h=L(u/864e5),f=L(h/365.2425)+1970-1;O(f+1,0)<=h;f++);for(l=L((h-O(f,0))/30.42);O(f,l+1)<=h;l++);h=1+h-O(f,l),p=(u%864e5+864e5)%864e5,g=L(p/36e5)%24,b=L(p/6e4)%60,w=L(p/1e3)%60,E=p%1e3}else f=u.getUTCFullYear(),l=u.getUTCMonth(),h=u.getUTCDate(),g=u.getUTCHours(),b=u.getUTCMinutes(),w=u.getUTCSeconds(),E=u.getUTCMilliseconds();u=(0>=f||f>=1e4?(0>f?"-":"+")+D(6,0>f?-f:f):D(4,f))+"-"+D(2,l+1)+"-"+D(2,h)+"T"+D(2,g)+":"+D(2,b)+":"+D(2,w)+"."+D(3,E)+"Z"}else u=null;if(n&&(u=n.call(t,e,u)),null===u)return"null";if(a=y.call(u),a==C)return""+u;if(a==x)return u>-1/0&&1/0>u?""+u:"null";if(a==T)return H(""+u);if("object"==typeof u){for(_=o.length;_--;)if(o[_]===u)throw c();if(o.push(u),k=[],P=s,s+=i,a==N){for(M=0,_=u.length;_>M;M++)A=B(M,u,n,r,i,s,o),k.push(A===m?"null":A);j=k.length?i?"[\n"+s+k.join(",\n"+s)+"\n"+P+"]":"["+k.join(",")+"]":"[]"}else v(r||u,function(e){var t=B(e,u,n,r,i,s,o);t!==m&&k.push(H(e)+":"+(i?" ":"")+t)}),j=k.length?i?"{\n"+s+k.join(",\n"+s)+"\n"+P+"}":"{"+k.join(",")+"}":"{}";return o.pop(),j}};t.stringify=function(e,t,n){var r,i,s,o;if(u[typeof t]&&t)if((o=y.call(t))==E)i=t;else if(o==N){s={};for(var a,f=0,l=t.length;l>f;a=t[f++],o=y.call(a),(o==T||o==x)&&(s[a]=1));}if(n)if((o=y.call(n))==x){if((n-=n%1)>0)for(r="",n>10&&(n=10);r.length<n;r+=" ");}else o==T&&(r=n.length<=10?n:n.slice(0,10));return B("",(a={},a[""]=e,a),i,s,r,"",[])}}if(!n("json-parse")){var j,F,I=i.fromCharCode,q={92:"\\",34:'"',47:"/",98:"\b",116:"	",110:"\n",102:"\f",114:"\r"},R=function(){throw j=F=null,l()},U=function(){for(var e,t,n,r,i,s=F,o=s.length;o>j;)switch(i=s.charCodeAt(j)){case 9:case 10:case 13:case 32:j++;break;case 123:case 125:case 91:case 93:case 58:case 44:return e=k?s.charAt(j):s[j],j++,e;case 34:for(e="@",j++;o>j;)if(i=s.charCodeAt(j),32>i)R();else if(92==i)switch(i=s.charCodeAt(++j)){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:e+=q[i],j++;break;case 117:for(t=++j,n=j+4;n>j;j++)i=s.charCodeAt(j),i>=48&&57>=i||i>=97&&102>=i||i>=65&&70>=i||R();e+=I("0x"+s.slice(t,j));break;default:R()}else{if(34==i)break;for(i=s.charCodeAt(j),t=j;i>=32&&92!=i&&34!=i;)i=s.charCodeAt(++j);e+=s.slice(t,j)}if(34==s.charCodeAt(j))return j++,e;R();default:if(t=j,45==i&&(r=!0,i=s.charCodeAt(++j)),i>=48&&57>=i){for(48==i&&(i=s.charCodeAt(j+1),i>=48&&57>=i)&&R(),r=!1;o>j&&(i=s.charCodeAt(j),i>=48&&57>=i);j++);if(46==s.charCodeAt(j)){for(n=++j;o>n&&(i=s.charCodeAt(n),i>=48&&57>=i);n++);n==j&&R(),j=n}if(i=s.charCodeAt(j),101==i||69==i){for(i=s.charCodeAt(++j),(43==i||45==i)&&j++,n=j;o>n&&(i=s.charCodeAt(n),i>=48&&57>=i);n++);n==j&&R(),j=n}return+s.slice(t,j)}if(r&&R(),"true"==s.slice(j,j+4))return j+=4,!0;if("false"==s.slice(j,j+5))return j+=5,!1;if("null"==s.slice(j,j+4))return j+=4,null;R()}return"$"},z=function(e){var t,n;if("$"==e&&R(),"string"==typeof e){if("@"==(k?e.charAt(0):e[0]))return e.slice(1);if("["==e){for(t=[];e=U(),"]"!=e;n||(n=!0))n&&(","==e?(e=U(),"]"==e&&R()):R()),","==e&&R(),t.push(z(e));return t}if("{"==e){for(t={};e=U(),"}"!=e;n||(n=!0))n&&(","==e?(e=U(),"}"==e&&R()):R()),(","==e||"string"!=typeof e||"@"!=(k?e.charAt(0):e[0])||":"!=U())&&R(),t[e.slice(1)]=z(U());return t}R()}return e},W=function(e,t,n){var r=X(e,t,n);r===m?delete e[t]:e[t]=r},X=function(e,t,n){var r,i=e[t];if("object"==typeof i&&i)if(y.call(i)==N)for(r=i.length;r--;)W(i,r,n);else v(i,function(e){W(i,e,n)});return n.call(e,t,i)};t.parse=function(e,t){var n,r;return j=0,F=""+e,n=z(U()),"$"!=U()&&R(),j=F=null,t&&y.call(t)==E?X((r={},r[""]=n,r),"",t):n}}}return t.runInContext=s,t}var o="function"==typeof e&&e.amd,u={"function":!0,object:!0},a=u[typeof i]&&i&&!i.nodeType&&i,f=u[typeof window]&&window||this,l=a&&u[typeof r]&&r&&!r.nodeType&&"object"==typeof n&&n;if(!l||l.global!==l&&l.window!==l&&l.self!==l||(f=l),a&&!o)s(f,a);else{var c=f.JSON,h=f.JSON3,p=!1,d=s(f,f.JSON3={noConflict:function(){return p||(p=!0,f.JSON=c,f.JSON3=h,c=h=null),d}});f.JSON={parse:d.parse,stringify:d.stringify}}o&&e(function(){return d})}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],56:[function(e,t){"use strict";function n(e,t,f){if(!(this instanceof n))return new n(e,t,f);var l,c,h,p,d=o.test(e),v=typeof t,m=this,g=0;for("object"!==v&&"string"!==v&&(f=t,t=null),f&&"function"!=typeof f&&(f=s.parse),t=i(t);g<u.length;g++)c=u[g],l=c[0],p=c[1],l!==l?m[p]=e:"string"==typeof l?~(h=e.indexOf(l))&&("number"==typeof c[2]?(m[p]=e.slice(0,h),e=e.slice(h+c[2])):(m[p]=e.slice(h),e=e.slice(0,h))):(h=l.exec(e))&&(m[p]=h[1],e=e.slice(0,e.length-h[0].length)),m[p]=m[p]||(c[3]||"port"===p&&d?t[p]||"":""),c[4]&&(m[p]=m[p].toLowerCase());f&&(m.query=f(m.query)),r(m.port,m.protocol)||(m.host=m.hostname,m.port=""),m.username=m.password="",m.auth&&(c=m.auth.split(":"),m.username=c[0]||"",m.password=c[1]||""),m.href=m.toString()}var r=e("requires-port"),i=e("./lolcation"),s=e("querystringify"),o=/^\/(?!\/)/,u=[["#","hash"],["?","query"],["//","protocol",2,1,1],["/","pathname"],["@","auth",1],[0/0,"host",void 0,1,1],[/\:(\d+)$/,"port"],[0/0,"hostname",void 0,1,1]];n.prototype.set=function(e,t,n){var i=this;return"query"===e?("string"==typeof t&&(t=(n||s.parse)(t)),i[e]=t):"port"===e?(i[e]=t,r(t,i.protocol)?t&&(i.host=i.hostname+":"+t):(i.host=i.hostname,i[e]="")):"hostname"===e?(i[e]=t,i.port&&(t+=":"+i.port),i.host=t):"host"===e?(i[e]=t,/\:\d+/.test(t)&&(t=t.split(":"),i.hostname=t[0],i.port=t[1])):i[e]=t,i.href=i.toString(),i},n.prototype.toString=function(e){e&&"function"==typeof e||(e=s.stringify);var t,n=this,r=n.protocol+"//";return n.username&&(r+=n.username,n.password&&(r+=":"+n.password),r+="@"),r+=n.hostname,n.port&&(r+=":"+n.port),r+=n.pathname,n.query&&(t="object"==typeof n.query?e(n.query):n.query,r+=("?"===t.charAt(0)?"":"?")+t),n.hash&&(r+=n.hash),r},n.qs=s,n.location=i,t.exports=n},{"./lolcation":57,querystringify:58,"requires-port":59}],57:[function(e,t){(function(n){"use strict";var r,i={hash:1,query:1};t.exports=function(t){t=t||n.location||{},r=r||e("./");var s,o={},u=typeof t;if("blob:"===t.protocol)o=new r(unescape(t.pathname),{});else if("string"===u){o=new r(t,{});for(s in i)delete o[s]}else if("object"===u)for(s in t)s in i||(o[s]=t[s]);return o}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./":56}],58:[function(e,t,n){"use strict";function r(e){for(var t,n=/([^=?&]+)=([^&]*)/g,r={};t=n.exec(e);r[decodeURIComponent(t[1])]=decodeURIComponent(t[2]));return r}function i(e,t){t=t||"";var n=[];"string"!=typeof t&&(t="?");for(var r in e)s.call(e,r)&&n.push(encodeURIComponent(r)+"="+encodeURIComponent(e[r]));return n.length?t+n.join("&"):""}var s=Object.prototype.hasOwnProperty;n.stringify=i,n.parse=r},{}],59:[function(e,t){"use strict";t.exports=function(e,t){if(t=t.split(":")[0],e=+e,!e)return!1;switch(t){case"http":case"ws":return 80!==e;case"https":case"wss":return 443!==e;case"ftp":return 22!==e;case"gopher":return 70!==e;case"file":return!1}return 0!==e}},{}]},{},[1])(1)}),function(){var e,t,n,r,i={}.hasOwnProperty,s=[].slice;e={LF:"\n",NULL:"\0"},n=function(){function n(e,t,n){this.command=e,this.headers=t!=null?t:{},this.body=n!=null?n:""}var t;return n.prototype.toString=function(){var t,r,s,o,u;t=[this.command],s=this.headers["content-length"]===!1?!0:!1,s&&delete this.headers["content-length"],u=this.headers;for(r in u){if(!i.call(u,r))continue;o=u[r],t.push(""+r+":"+o)}return this.body&&!s&&t.push("content-length:"+n.sizeOfUTF8(this.body)),t.push(e.LF+this.body),t.join(e.LF)},n.sizeOfUTF8=function(e){return e?encodeURI(e).match(/%..|./g).length:0},t=function(t){var r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b;o=t.search(RegExp(""+e.LF+e.LF)),u=t.substring(0,o).split(e.LF),s=u.shift(),a={},d=function(e){return e.replace(/^\s+|\s+$/g,"")},y=u.reverse();for(v=0,g=y.length;v<g;v++)h=y[v],l=h.indexOf(":"),a[d(h.substring(0,l))]=d(h.substring(l+1));r="",p=o+2;if(a["content-length"])c=parseInt(a["content-length"]),r=(""+t).substring(p,p+c);else{i=null;for(f=m=p,b=t.length;p<=b?m<b:m>b;f=p<=b?++m:--m){i=t.charAt(f);if(i===e.NULL)break;r+=i}}return new n(s,a,r)},n.unmarshall=function(n){var r,i,s,o;return i=n.split(RegExp(""+e.NULL+e.LF+"*")),o={frames:[],partial:""},o.frames=function(){var e,n,s,o;s=i.slice(0,-1),o=[];for(e=0,n=s.length;e<n;e++)r=s[e],o.push(t(r));return o}(),s=i.slice(-1)[0],s===e.LF||s.search(RegExp(""+e.NULL+e.LF+"*$"))!==-1?o.frames.push(t(s)):o.partial=s,o},n.marshall=function(t,r,i){var s;return s=new n(t,r,i),s.toString()+e.NULL},n}(),t=function(){function i(e){this.ws=e,this.ws.binaryType="arraybuffer",this.counter=0,this.connected=!1,this.heartbeat={outgoing:1e4,incoming:1e4},this.maxWebSocketFrameSize=16384,this.subscriptions={},this.partialData=""}var t;return i.prototype.debug=function(e){var t;return typeof window!="undefined"&&window!==null?(t=window.console)!=null?t.log(e):void 0:void 0},t=function(){return Date.now?Date.now():(new Date).valueOf},i.prototype._transmit=function(e,t,r){var i;i=n.marshall(e,t,r),typeof this.debug=="function"&&this.debug(">>> "+i);for(;;){if(!(i.length>this.maxWebSocketFrameSize))return this.ws.send(i);this.ws.send(i.substring(0,this.maxWebSocketFrameSize)),i=i.substring(this.maxWebSocketFrameSize),typeof this.debug=="function"&&this.debug("remaining = "+i.length)}},i.prototype._setupHeartbeat=function(n){var i,s,o,u,a,f;if((a=n.version)!==r.VERSIONS.V1_1&&a!==r.VERSIONS.V1_2)return;f=function(){var e,t,r,i;r=n["heart-beat"].split(","),i=[];for(e=0,t=r.length;e<t;e++)u=r[e],i.push(parseInt(u));return i}(),s=f[0],i=f[1],this.heartbeat.outgoing!==0&&i!==0&&(o=Math.max(this.heartbeat.outgoing,i),typeof this.debug=="function"&&this.debug("send PING every "+o+"ms"),this.pinger=r.setInterval(o,function(t){return function(){return t.ws.send(e.LF),typeof t.debug=="function"?t.debug(">>> PING"):void 0}}(this)));if(this.heartbeat.incoming!==0&&s!==0)return o=Math.max(this.heartbeat.incoming,s),typeof this.debug=="function"&&this.debug("check PONG every "+o+"ms"),this.ponger=r.setInterval(o,function(e){return function(){var n;n=t()-e.serverActivity;if(n>o*2)return typeof e.debug=="function"&&e.debug("did not receive server activity for the last "+n+"ms"),e.ws.close()}}(this))},i.prototype._parseConnect=function(){var e,t,n,r;e=1<=arguments.length?s.call(arguments,0):[],r={};switch(e.length){case 2:r=e[0],t=e[1];break;case 3:e[1]instanceof Function?(r=e[0],t=e[1],n=e[2]):(r.login=e[0],r.passcode=e[1],t=e[2]);break;case 4:r.login=e[0],r.passcode=e[1],t=e[2],n=e[3];break;default:r.login=e[0],r.passcode=e[1],t=e[2],n=e[3],r.host=e[4]}return[r,t,n]},i.prototype.connect=function(){var i,u,a,f;return i=1<=arguments.length?s.call(arguments,0):[],f=this._parseConnect.apply(this,i),a=f[0],this.connectCallback=f[1],u=f[2],typeof this.debug=="function"&&this.debug("Opening Web Socket..."),this.ws.onmessage=function(r){return function(i){var s,o,a,f,l,c,h,p,d,v,m,g,y;f=typeof ArrayBuffer!="undefined"&&i.data instanceof ArrayBuffer?(s=new Uint8Array(i.data),typeof r.debug=="function"?r.debug("--- got data length: "+s.length):void 0,function(){var e,t,n;n=[];for(e=0,t=s.length;e<t;e++)o=s[e],n.push(String.fromCharCode(o));return n}().join("")):i.data,r.serverActivity=t();if(f===e.LF){typeof r.debug=="function"&&r.debug("<<< PONG");return}typeof r.debug=="function"&&r.debug("<<< "+f),d=n.unmarshall(r.partialData+f),r.partialData=d.partial,g=d.frames,y=[];for(v=0,m=g.length;v<m;v++){l=g[v];switch(l.command){case"CONNECTED":typeof r.debug=="function"&&r.debug("connected to server "+l.headers.server),r.connected=!0,r._setupHeartbeat(l.headers),y.push(typeof r.connectCallback=="function"?r.connectCallback(l):void 0);break;case"MESSAGE":p=l.headers.subscription,h=r.subscriptions[p]||r.onreceive,h?(a=r,c=l.headers["message-id"],l.ack=function(e){return e==null&&(e={}),a.ack(c,p,e)},l.nack=function(e){return e==null&&(e={}),a.nack(c,p,e)},y.push(h(l))):y.push(typeof r.debug=="function"?r.debug("Unhandled received MESSAGE: "+l):void 0);break;case"RECEIPT":y.push(typeof r.onreceipt=="function"?r.onreceipt(l):void 0);break;case"ERROR":y.push(typeof u=="function"?u(l):void 0);break;default:y.push(typeof r.debug=="function"?r.debug("Unhandled frame: "+l):void 0)}}return y}}(this),this.ws.onclose=function(e){return function(){var t;return t="Whoops! Lost connection to "+e.ws.url,typeof e.debug=="function"&&e.debug(t),e._cleanUp(),typeof u=="function"?u(t):void 0}}(this),this.ws.onopen=function(e){return function(){return typeof e.debug=="function"&&e.debug("Web Socket Opened..."),a["accept-version"]=r.VERSIONS.supportedVersions(),a["heart-beat"]=[e.heartbeat.outgoing,e.heartbeat.incoming].join(","),e._transmit("CONNECT",a)}}(this)},i.prototype.disconnect=function(e,t){return t==null&&(t={}),this._transmit("DISCONNECT",t),this.ws.onclose=null,this.ws.close(),this._cleanUp(),typeof e=="function"?e():void 0},i.prototype._cleanUp=function(){this.connected=!1,this.pinger&&r.clearInterval(this.pinger);if(this.ponger)return r.clearInterval(this.ponger)},i.prototype.send=function(e,t,n){return t==null&&(t={}),n==null&&(n=""),t.destination=e,this._transmit("SEND",t,n)},i.prototype.subscribe=function(e,t,n){var r;return n==null&&(n={}),n.id||(n.id="sub-"+this.counter++),n.destination=e,this.subscriptions[n.id]=t,this._transmit("SUBSCRIBE",n),r=this,{id:n.id,unsubscribe:function(){return r.unsubscribe(n.id)}}},i.prototype.unsubscribe=function(e){return delete this.subscriptions[e],this._transmit("UNSUBSCRIBE",{id:e})},i.prototype.begin=function(e){var t,n;return n=e||"tx-"+this.counter++,this._transmit("BEGIN",{transaction:n}),t=this,{id:n,commit:function(){return t.commit(n)},abort:function(){return t.abort(n)}}},i.prototype.commit=function(e){return this._transmit("COMMIT",{transaction:e})},i.prototype.abort=function(e){return this._transmit("ABORT",{transaction:e})},i.prototype.ack=function(e,t,n){return n==null&&(n={}),n["message-id"]=e,n.subscription=t,this._transmit("ACK",n)},i.prototype.nack=function(e,t,n){return n==null&&(n={}),n["message-id"]=e,n.subscription=t,this._transmit("NACK",n)},i}(),r={VERSIONS:{V1_0:"1.0",V1_1:"1.1",V1_2:"1.2",supportedVersions:function(){return"1.1,1.0"}},client:function(e,n){var i,s;return n==null&&(n=["v10.stomp","v11.stomp"]),i=r.WebSocketClass||WebSocket,s=new i(e,n),new t(s)},over:function(e){return new t(e)},Frame:n},typeof exports!="undefined"&&exports!==null&&(exports.Stomp=r),typeof window!="undefined"&&window!==null?(r.setInterval=function(e,t){return window.setInterval(t,e)},r.clearInterval=function(e){return window.clearInterval(e)},window.Stomp=r):exports||(self.Stomp=r)}.call(this),define("stomp",function(e){return function(){var t,n;return t||e.Stomp}}(this)),define("service/rabbitmqWebStompService",["core/subscriber","sockjs","stomp"],function(e,t,n){"use strict";var r=function(){e.prototype.constructor.apply(this),this.ws=null,this.client=null,this.bind__messageCallback=this._messageCallback.bind(this)};return r.extend(e),r.Event={CONNECTED:"eventConnected",DISCONNECTED:"eventDisconnected",MESSAGE:"eventMessage"},r.prototype.isConnected=function(){return this.ws&&this.client},r.prototype.connect=function(){if(this.isConnected())return;this.ws=new t(window.location.protocol+"//"+window.location.hostname+"/stomp"),this.client=n.over(this.ws),this.client.heartbeat.incoming=0,this.client.heartbeat.outgoing=0;var e=function(){this._dispatch(r.Event.CONNECTED)}.bind(this),i=function(e){console.error(e)};this.client.connect("test","test",e,i,"/")},r.prototype.disconnect=function(){this.client.disconnect(function(){this._dispatch(r.Event.DISCONNECTED)}.bind(this)),this.client=null,this.ws=null},r.prototype._messageCallback=function(e){console.log(e),this._dispatch(r.Event.MESSAGE,{message:JSON.parse(e.body)})},r.prototype.subscribe=function(t,n,r){e.prototype.subscribe.call(this,n,r);if(!t)return;return this.client.subscribe(t,this.bind__messageCallback)},r.prototype.unsubscribe=function(t,n){e.prototype.unsubscribe.call(this,n),t&&this.client.unsubscribe(t.id)},r}),define("service/subscriberService",["core/subscriber"],function(e){"use strict";var t=function(){e.prototype.constructor.apply(this)};return t.extend(e),t.prototype.dispatch=function(t,n,r){r=r||{},r.tag=t,e.prototype._dispatch.call(this,n,r)},t}),define("service/threadPostService",["core/subscriber","underscore"],function(e){"use strict";var t=function(){e.prototype.constructor.apply(this),this.name="ThreadPost"};return t.extend(e),t.Event={ADD:"eventAdd",REPLACE:"eventUpdate",REMOVE:"eventRemove"},t.prototype.subscribe=function(n){_.each(t.Event,function(t,r,i){e.prototype.subscribe.call(this,t,n)}.bind(this))},t.prototype.dispatch=function(t,n){e.prototype._dispatch.call(this,t,n)},t}),define("model/forumModel",["model/model","model/mediaModel","extra"],function(e,t){"use strict";var n=function(n){e.prototype.constructor.apply(this,arguments),this.data.ordered_media&&this.data.ordered_media.forEach(function(e,n,r){r[n]=new t(e)})};return n.extend(e),n}),define("model/groupModel",["model/model","model/mediaModel","extra"],function(e,t){"use strict";var n=function(n){e.prototype.constructor.apply(this,arguments),this.data.ordered_media&&this.data.ordered_media.forEach(function(e,n,r){r[n]=new t(e)})};return n.extend(e),n}),define("model/messageModel",["model/model","model/mediaModel","extra"],function(e,t){"use strict";var n=function(n){e.prototype.constructor.apply(this,arguments),this.data.ordered_media&&this.data.ordered_media.forEach(function(e,n,r){r[n]=new t(e)})};return n.extend(e),n}),define("model/myFilesModel",["model/model","model/mediaModel","extra","underscore"],function(e,t){"use strict";var n=function(n){e.prototype.constructor.apply(this,arguments);if(this.data.media){var r=this.data.media;this.data.media=[],_.each(r,function(n,r,i){var s=new t(n);s.subscribe(e.Event.CHANGE,function(t){var n=_.findIndex(this.data.media,t.model);n>-1&&this._dispatch(e.Event.CHANGE,"media."+n)}.bind(this)),this.data.media.push(s)},this),r=null}};return n.extend(e),n.prototype.addMedia=function(n){var r=new t(n);r.subscribe(e.Event.CHANGE,function(t){var n=_.findIndex(this.data.media,t.model);n>-1&&this._dispatch(e.Event.CHANGE,"media."+n)}.bind(this)),this.data.media.push(r)},n.prototype.getMedia=function(e){return _.find(this.data.media,function(t){return t.get("id")==e})},n}),define("model/profileModel",["model/model","extra"],function(e){"use strict";var t=function(t){e.prototype.constructor.apply(this,arguments)};return t.extend(e),t}),define("model/threadModel",["model/model","model/postModel","extra","underscore"],function(e,t){"use strict";var n=function(n){e.prototype.constructor.apply(this,arguments),this.data.keyPoints=[],this.data.posts&&this.data.posts.forEach(function(e,n,r){r[n]=new t(e)})};return n.extend(e),n.prototype.addKeyPoint=function(t){this.removeKeyPoint(t.id),this.data.keyPoints.push(t),this._dispatch(e.Event.CHANGE,"keyPoints."+(this.data.keyPoints.length-1))},n.prototype._findKeyPoint=function(e){for(var t in this.data.keyPoints)if(this.data.keyPoints[t].id==e)return t},n.prototype.setKeyPointProperty=function(e,t,n,r){var i=this._findKeyPoint(e);i>-1&&this.set("keyPoints."+i+"."+t,n,r)},n.prototype.removeKeyPoint=function(t){var n=this._findKeyPoint(t);n>-1&&(this.data.keyPoints.splice(n,1),this._dispatch(e.Event.CHANGE,"keyPoints"))},n.prototype.forceChangeKeyPoint=function(e,t){var n=this._findKeyPoint(e);n>-1&&this.forceChange("keyPoints."+n+"."+t)},n.prototype.addPost=function(e,t){var n=this.get("posts",[]);this.set("posts."+n.length,e,!1),this.forceChange("posts."+(n.length-1),{isNew:!0,view:t})},n.prototype.removePost=function(e,t){var n=this.get("posts"),r=this.find(e.get("id"),"id",n);if(r>-1){n.splice(r,1);var i=[];_.each(n,function(t,n,r){t.get("parent_post_id")==e.get("id")&&i.push(t)}),this.set("posts",_.difference(n,i))}},n.prototype.forceChangePost=function(e,t){var n=this.find(e.get("id"),"id",this.get("posts"));n>-1&&this.forceChange("posts."+n,{view:t})},n}),define("model/userModel",["model/model","extra","underscore"],function(e){"use strict";var t=function(t){e.prototype.constructor.apply(this,arguments)};return t.extend(e),t.prototype.isUserOnFriendsList=function(e){return _.contains(this.get("friends_list"),e)},t.prototype.isUserOnMentorList=function(e){return _.contains(this.get("mentor_list"),e)},t.prototype.isUserOnMenteeList=function(e){return _.contains(this.get("mentee_list"),e)},t.prototype.isUserOnInvitedMentorList=function(e){var t=_.find(this.get("created_invitations"),function(t){return t.recipient==e&&!t.isMentor&&!t.isAccepted&&!t.isCancelled&&!t.isDeclined});return t!=="undefined"},t.prototype.isUserOnInvitedMenteeList=function(e){var t=_.find(this.get("created_invitations"),function(t){return t.recipient==e&&!t.isMentee&&!t.isAccepted&&!t.isCancelled&&!t.isDeclined});return t!=="undefined"},t}),define("controller/contactController",["factory/contactFactory"],function(e){"use strict";var t=function(e,n){console.log("%s: %s- model=%o, options=%o",t.TAG,"constructor",e,n),this.model=e,this.options=n,$tt._instances.push(this)};return t.TAG="Contact",t.prototype.onViewLoaded=function(){},t.prototype.delete=function(t,n){return e.delete(t,n).done(function(e){window.location.reload(!0)})},t}),define("controller/forumController",["factory/forumFactory"],function(e){"use strict";var t=function(e,n){console.log("%s: %s- model=%o, options=%o",t.TAG,"constructor",e,n),this.model=e,this.options=n,$tt._instances.push(this)};return t.TAG="Forum",t.prototype.onViewLoaded=function(){},t.prototype.delete=function(){return e.delete(this.model).done(function(e){window.location.assign(e.redirect_url)})},t}),define("controller/groupController",["factory/groupFactory"],function(e){"use strict";var t=function(e,n){console.log("%s: %s- model=%o, options=%o",t.TAG,"constructor",e,n),this.model=e,this.options=n,$tt._instances.push(this)};return t.TAG="Group",t.prototype.onViewLoaded=function(){},t.prototype.delete=function(){return e.delete(this.model).done(function(e){window.location.assign(e.redirect_url)})},t}),define("controller/messageController",["factory/messageFactory"],function(e){"use strict";var t=function(e,n){console.log("%s: %s- model=%o, options=%o",t.TAG,"constructor",e,n),this.model=e,this.options=n,$tt._instances.push(this)};return t.TAG="Message",t.prototype.onViewLoaded=function(){this.model.get("id")&&this.markAsRead()},t.prototype.markAsRead=function(){return e.edit(this.model)},t}),define("controller/myFilesController",["factory/mediaFactory"],function(e){"use strict";var t=function(e,n){console.log("%s: %s- model=%o, options=%o",t.TAG,"constructor",e,n),this.model=e,this.options=n,$tt._instances.push(this)};return t.TAG="MyFiles",t.prototype.onViewLoaded=function(){},t.prototype.edit=function(t,n){var r=this.model.getMedia(t);if(!r)throw new Error("media not found");return Object.keys(n).forEach(function(e,t,i){r.set(e,n[e])}),e.edit(r)},t.prototype.delete=function(t,n){var r=this.model.getMedia(t);if(!r)throw new Error("media not found");return e.delete(r,n)},t}),define("controller/postController",["factory/postFactory","service","service/keyPointService","service/threadPostService"],function(e,t,n,r){"use strict";var i=function(e,n){console.log("%s: %s- model=%o, options=%o",i.TAG,"constructor",e,n),this.model=e,this.options=n,this.keyPointService=t.get("keyPoint"),this.threadPostService=t.get("threadPost"),this.model.set("keyPoint",new KeyPoint(this.model.get("id"),this.model.get("start_time"),this.model.get("end_time"),"",{drawOnTimeLine:this.model.get("is_temporal",!1)})),this.bind__onKeyPointEvent=this._onKeyPointEvent.bind(this),this.bind__onThreadPostEvent=this._onThreadPostEvent.bind(this),$tt._instances.push(this)};return i.TAG="Post",i.prototype._onKeyPointEvent=function(e){switch(e.type){case n.Event.DURATION:this.model.set("keyPoint.videoDuration",e.duration);break;case n.Event.SELECTION_TIMES:this.model.set("keyPoint.selection",e.selection);break;case n.Event.HOVER:case n.Event.CLICK:this.model.forceChange()}},i.prototype._onThreadPostEvent=function(e){switch(e.type){case r.Event.REMOVE:e.post.get("id")<0&&e.post.get("parent_post_id")==this.model.get("id")&&this.model.forceChange()}},i.prototype.onViewLoaded=function(){this.addKeyPoint(),this.threadPostService.subscribe(this.bind__onThreadPostEvent)},i.prototype.addKeyPoint=function(){var e=this.model.get("keyPoint");this.keyPointService.register(e),this.keyPointService.subscribe(e.id,this.bind__onKeyPointEvent),this.keyPointService.dispatch(e.id,n.Event.ADD)},i.prototype.hoverKeyPoint=function(e){this.model.set("keyPoint.isHovering",e.isMouseOver),this.keyPointService.dispatch(this.model.get("keyPoint.id"),n.Event.HOVER,e)},i.prototype.clickKeyPoint=function(e){var t="keyPoint."+(e.isDblClick?"isPlaying":"isSeeking");this.model.set(t,!0),setTimeout(function(){this.model.set(t,!1,!1)}.bind(this),100),this.keyPointService.dispatch(this.model.get("keyPoint.id"),n.Event.CLICK,e)},i.prototype.editKeyPoint=function(e){this.keyPointService.dispatch(this.model.get("keyPoint.id"),n.Event.EDIT,e)},i.prototype.removeKeyPoint=function(){var e=this.model.get("keyPoint");this.keyPointService.dispatch(e.id,n.Event.REMOVE),this.keyPointService.unsubscribe(e.id,this.bind__onKeyPointEvent),this.keyPointService.deregister(e.id)},i.prototype.addToThread=function(e){this.threadPostService.dispatch(r.Event.ADD,{post:e})},i.prototype.updateInThread=function(e){this.threadPostService.dispatch(r.Event.REPLACE,{post:this.model,view:e})},i.prototype.removeFromThread=function(){this.threadPostService.dispatch(r.Event.REMOVE,{post:this.model})},i.prototype.new=function(){return e.new(this.model)},i.prototype.post=function(t){return e.post(this.model,t)},i.prototype.get=function(){return e.get(this.model)},i.prototype.edit=function(){return e.edit(this.model)},i.prototype.put=function(t){return e.put(this.model,t)},i.prototype.delete=function(){return e.delete(this.model).done(function(e){this.removeKeyPoint()}.bind(this))},i}),define("controller/profileController",[],function(){"use strict";var e=function(t,n){console.log("%s: %s- model=%o, options=%o",e.TAG,"constructor",t,n),this.model=t,this.options=n,$tt._instances.push(this)};return e.TAG="Profile",e.prototype.onViewLoaded=function(){},e}),define("controller/threadController",["factory/threadFactory","service","service/keyPointService","service/threadPostService"],function(e,t,n,r){"use strict";var i=function(e,n){console.log("%s: %s- model=%o, options=%o",i.TAG,"constructor",e,n),this.model=e,this.options=n,this.keyPointService=t.get("keyPoint"),this.threadPostService=t.get("threadPost"),this.videoSpeed=0,this.bind__onKeyPointEvent=this._onKeyPointEvent.bind(this),this.bind__onThreadPostEvent=this._onThreadPostEvent.bind(this),this.keyPointService.subscribe("all",this.bind__onKeyPointEvent),this.threadPostService.subscribe(this.bind__onThreadPostEvent),$tt._instances.push(this)};return i.TAG="Thread",i.prototype._onKeyPointEvent=function(e){switch(e.type){case n.Event.ADD:this.model.addKeyPoint(e.keyPoint);break;case n.Event.HOVER:case n.Event.CLICK:this.model.forceChangeKeyPoint(e.keyPoint.id);break;case n.Event.EDIT:if(!e.cancel){this.model.setKeyPointProperty(e.keyPoint.id,"options.drawOnTimeLine",!1),this.model.setKeyPointProperty(e.keyPoint.id,"isEditing",!0);break};case n.Event.REMOVE:this.model.setKeyPointProperty(e.keyPoint.id,"isEditing",!1),this.model.setKeyPointProperty(e.keyPoint.id,"options.drawOnTimeLine",!0),e.type==n.Event.REMOVE&&this.model.removeKeyPoint(e.keyPoint.id)}},i.prototype._onThreadPostEvent=function(e){switch(e.type){case r.Event.ADD:this.model.addPost(e.post,e.post.get("id")<0?"new":"view");break;case r.Event.REPLACE:this.model.forceChangePost(e.post,e.view);break;case r.Event.REMOVE:this.model.removePost(e.post)}},i.prototype.onViewLoaded=function(){},i.prototype.updateKeyPointDuration=function(e){isNaN(e)||this.keyPointService.dispatch("all",n.Event.DURATION,{duration:e})},i.prototype.updateKeyPointSelectionTimes=function(e){this.keyPointService.dispatch("all",n.Event.SELECTION_TIMES,{selection:{startTime:parseFloat(e.minTime).toFixed(2),endTime:parseFloat(e.maxTime).toFixed(2)}})},i.prototype.hoverKeyPoint=function(e,t){this.model.setKeyPointProperty(e,"isPlayerHovering",t.isMouseOver),this.keyPointService.dispatch(e,n.Event.HOVER,t)},i.prototype.rightClickKeyPoint=function(e){this.model.setKeyPointProperty(e,"isPlayerPlaying",!0),setTimeout(function(){this.model.setKeyPointProperty(e,"isPlayerPlaying",!1,!1)}.bind(this),100),this.keyPointService.dispatch(e,n.Event.CLICK,{which:"right"})},i.prototype.adjustVideoSpeed=function(){this.videoSpeed=(this.videoSpeed+1)%3;switch(this.videoSpeed){case 0:return{value:1,image:this.options.player.speedImages.normal};case 1:return{value:2,image:this.options.player.speedImages.fast};case 2:return{value:.5,image:this.options.player.speedImages.slow};default:return{value:1,image:this.options.player.speedImages.normal}}},i.prototype.delete=function(){return e.delete(this.model).done(function(e){window.location.assign(e.redirect_url)})},i}),define("component/accessTypeComponent",[],function(){"use strict";var e=function(e){this.options=e,this.typeToFieldMap=[{filter:'[value="4"]',fields:["accessType_data_users"]},{filter:'[value="6"]',fields:["group"]}],this.bind__onChangeAccessType=this._onChangeAccessType.bind(this),this.$container=this.options.$container,this.$accessTypes=this.$container.find("input:radio"),this.$accessTypes.on("change",this.bind__onChangeAccessType),this.$accessTypes.filter(":checked").trigger("change")};return e.TAG="AccessTypeComponent",e.prototype._getFormField=function(e){return this.$container.find('[id$="_'+e+'"]')},e.prototype._onChangeAccessType=function(e){var t=$(e.target),n=function(e,n){var r=n.parent();t.attr("id")==e.attr("id")?(r.find("label").addClass("required"),n.attr("required",!0),r.children().show()):(r.find("label").removeClass("required"),n.attr("required",!1),r.children().hide())};$.each(this.typeToFieldMap,function(e,t){var r=this.$accessTypes.filter(t.filter);$.each(t.fields,function(e,t){n(r,this._getFormField(t))}.bind(this))}.bind(this))},e.render=function(t,n){var r={};n=n||r;for(var i in r)n[i]=typeof n[i]!="undefined"?n[i]:r[i];return n.$container=t,new e(n)},e}),define("component/tableComponent",["core/subscriber","extra"],function(e){"use strict";var t=function(n){e.prototype.constructor.apply(this),this.options=n,this.bind__onClickToggleSelection=this._onClickToggleSelection.bind(this),this.bind__onClickBulkAction=this._onClickBulkAction.bind(this),this.bind__onChangeItems=this._onChangeItems.bind(this),this.$table=this.options.$table,this.$toggleSelection=this.$table.find(t.Binder.TOGGLE_SELECTION),this.$bulkActions=this.$table.find(t.Binder.BULK_ACTION),this.$items=this.$table.find(t.Binder.ITEM),this.setMultiSelect(this.options.multiSelect),this.$toggleSelection.on("click",this.bind__onClickToggleSelection),this.$bulkActions.on("click",this.bind__onClickBulkAction),this.$items.on("change",this.bind__onChangeItems)};return t.extend(e),t.TAG="TableComponent",t.Binder={TOGGLE_SELECTION:".table-component-toggle-selection",BULK_ACTION:".table-component-bulk-action",ITEM:"input.table-component-item:not([disabled])"},t.Event={SELECTION_CHANGE:"eventSelectionChange",CLICK_BULK_ACTION:"eventClickBulkAction"},t.prototype.updateElements=function(e){this.$items.off("change"),this.$table=e,this.$items=this.$table.find(t.Binder.ITEM),this.$items.on("change",this.bind__onChangeItems)},t.prototype._dispatchToggleEvent=function(e){var n=this.getSelection();this._dispatch(t.Event.SELECTION_CHANGE,{$selection:n,tableComponent:this,parentEvent:e})},t.prototype._onClickToggleSelection=function(e){this.$items.prop("checked",$(e.target).is('input[type="checkbox"]')?e.target.checked:this.getSelection().length==0),this._dispatchToggleEvent(e)},t.prototype._onClickBulkAction=function(e){var n=$(e.currentTarget);this._dispatch(t.Event.CLICK_BULK_ACTION,{$bulkAction:n,action:n.data("action"),$selection:this.getSelection(),tableComponent:this,parentEvent:e})},t.prototype._onChangeItems=function(e){var n=e.target.checked;this.options.multiSelect||this.$items.prop("checked",!1),e.target.checked=n;var r=this.getSelection();this._dispatch(t.Event.SELECTION_CHANGE,{$selection:r,tableComponent:this,parentEvent:e});var i=r.length==this.$items.length;this.$toggleSelection.prop("checked",i),i&&this._dispatchToggleEvent(e)},t.prototype.setMultiSelect=function(e){this.options.multiSelect=e,this.$toggleSelection.attr("disabled",!this.options.multiSelect)},t.prototype.getTable=function(){return this.$table},t.prototype.getBulkActions=function(){return this.$bulkActions},t.prototype.getSelection=function(){return this.$items.filter(":checked")},t.table=function(e,n){var r={multiSelect:!0};n=n||r;for(var i in r)n[i]=typeof n[i]!="undefined"?n[i]:r[i];return n.$table=e,new t(n)},t}),define("component/myFilesSelectorComponent",["core/subscriber","service","component/tableComponent","factory/mediaFactory","extra"],function(e,t,n,r){"use strict";var i=function(n){e.prototype.constructor.apply(this),this.options=n,this.bind__onShownModal=this._onShownModal.bind(this),this.bind__onHiddenModal=this._onHiddenModal.bind(this),this.bind__onLoadPageSuccess=this._onLoadPageSuccess.bind(this),this.bind__onLoadPageError=this._onLoadPageError.bind(this),this.bind__onClickSelectSelected=this._onClickSelectSelected.bind(this),this.bind__onMyFilesListViewViewLoaded=this._onMyFilesListViewViewLoaded.bind(this),this.bind__onSelectionChange=this._onSelectionChange.bind(this),this.$container=this.options.$container,this.$modalDialog=this.$container.find(i.Binder.MODAL_DIALOG),this.$selectSelected=this.$container.find(i.Binder.SELECT_SELECTED),this.$modalDialog.modal({backdrop:"static",show:!1}),this.$modalDialog.on("shown.bs.modal",this.bind__onShownModal),this.$modalDialog.on("hidden.bs.modal",this.bind__onHiddenModal),this.$selectSelected.on("click",this.bind__onClickSelectSelected);var r=t.get("subscriber");r.subscribe("onViewLoaded",this.bind__onMyFilesListViewViewLoaded)};return i.extend(e),i.TAG="MyFilesSelectorComponent",i.Binder={MODAL_DIALOG:".my-files-selector-modal",SELECT_SELECTED:".my-files-selector-select-selected"},i.Event={DONE:"eventDone",HIDDEN:"eventHidden"},i.prototype._onSelectionChange=function(e){this.$selectSelected.attr("disabled",e.$selection.length==0)},i.prototype._onMyFilesListViewViewLoaded=function(e){var t=require("views/myFiles/listView");if(e.tag!==t.TAG)return;this.tblCmp=e.view.getTableComponent(),this.tblCmp.setMultiSelect(this.options.multiSelect),this.tblCmp.subscribe(n.Event.SELECTION_CHANGE,this.bind__onSelectionChange);var r=function(e){e.preventDefault(),this._loadPage($(e.currentTarget).attr("href"))}.bind(this);this.$modalDialog.find(t.Binder.TOGGLE_STYLE).on("click",r),this.$modalDialog.find("ul.pagination li a").on("click",r)},i.prototype._onLoadPageSuccess=function(e,t,n){this.$modalDialog.find(".modal-body").html(e.page)},i.prototype._onLoadPageError=function(e,t,n){console.log(e)},i.prototype._makeUrl=function(e){if(typeof e=="undefined")return Routing.generate("imdc_myfiles_list",this.options.filter);for(var t in this.filter)e+=(e.substr("?")?"&":"?")+t+"="+this.options.filter[t];return e},i.prototype._loadPage=function(e){$.ajax({url:this._makeUrl(e),success:this.bind__onLoadPageSuccess,error:this.bind__onLoadPageError})},i.prototype._onShownModal=function(e){this._loadPage()},i.prototype._onHiddenModal=function(e){this._dispatch(i.Event.HIDDEN,{myFilesSelectorComponent:this})},i.prototype._onClickSelectSelected=function(e){e.preventDefault(),this.$selectSelected.button("loading");var t=this.tblCmp.getSelection(),n=[];this.options.multiSelect?t.each(function(e,t){n.push($(t).data("mid"))}):n.push(t.first().data("mid")),r.list(n).done(function(e){this._dispatch(i.Event.DONE,{media:e.media,myFilesSelectorComponent:this})}.bind(this)).fail(function(e){this.$selectSelected.button("reset"),console.error("%s: media factory list",i.TAG)}.bind(this))},i.prototype.show=function(){this.$modalDialog.modal("show")},i.prototype.hide=function(){this.$modalDialog.modal("hide")},i.prototype.destroy=function(){this.$modalDialog.remove()},i.render=function(e,t){var n={$container:$("body"),multiSelect:!0,filter:{}};e=e||n;for(var r in n)e[r]=typeof e[r]!="undefined"?e[r]:n[r];dust.render("myFilesSelector",{},function(n,r){e.$container.append(r);var s=new i(e);t.call(s,{myFilesSelectorComponent:s})})},i}),define("component/recorderComponent",["core/subscriber","service","component/myFilesSelectorComponent","model/mediaModel","factory/mediaFactory","factory/myFilesFactory","service/rabbitmqWebStompService","core/helper","extra"],function(e,t,n,r,i,s,o,u){"use strict";var a=function(n){e.prototype.constructor.apply(this),this.options=n,this.isOnNormalTab=this.options.tab==a.Tab.NORMAL,this.isOnInterpTab=this.options.tab==a.Tab.INTERPRETATION,this.isInRecordMode=this.options.mode==a.Mode.RECORD,this.isInEditMode=this.options.mode==a.Mode.PREVIEW,this.player=null,this.recorder=null,this.currentRecording=null,this.currentTrim=null,this.sourceMedia=null,this.recordedMedia=null,this.messages=[],this.rabbitmqWebStompService=t.get("rabbitmqWebStomp"),this.isDonePostponed=!1,this.doPost=!1,this.forwardButton='<button class="forwardButton"></button>',this.doneButton='<button class="doneButton"></button>',this.doneAndPostButton='<button class="doneAndPostButton"></button>',this.backButton='<button class="backButton"></button>',this.bind__onShownModal=this._onShownModal.bind(this),this.bind__onShowModal=this._onShowModal.bind(this),this.bind__onHiddenModal=this._onHiddenModal.bind(this),this.bind__onShowTab=this._onShowTab.bind(this),this.bind__onShownTab=this._onShownTab.bind(this),this.bind__onBlurPlayerTitle=this._onBlurPlayerTitle.bind(this),this.bind__onClickInterpSelect=this._onClickInterpSelect.bind(this),this.bind__onPageAnimate=this._onPageAnimate.bind(this),this.bind__onRecordingStarted=this._onRecordingStarted.bind(this),this.bind__onRecordingStopped=this._onRecordingStopped.bind(this),this.bind__preview=this._preview.bind(this),this.bind__cut=this._cut.bind(this),this.bind__back=this._back.bind(this),this.bind__done=this._done.bind(this),this.bind__doneAndPost=this._doneAndPost.bind(this),this.$container=this.options.$container,this.$modalDialog=this.$container.find(a.Binder.MODAL_DIALOG),this.$tabPanes=this.$container.find(a.Binder.TAB_PANES),this.$containerRecord=this.$container.find(a.Binder.CONTAINER_RECORD),this.$normalTitle=this.$container.find(a.Binder.NORMAL_TITLE),this.$normalVideo=this.$container.find(a.Binder.NORMAL_VIDEO),this.$interpSelect=this.$container.find(a.Binder.INTERP_SELECT),this.$interpMain=this.$container.find(a.Binder.INTERP_MAIN),this.$interpVideoP=this.$container.find(a.Binder.INTERP_VIDEO_P),this.$interpTitle=this.$container.find(a.Binder.INTERP_TITLE),this.$interpVideoR=this.$container.find(a.Binder.INTERP_VIDEO_R),this.$controls=this.$container.find(a.Binder.CONTROLS),this.$containerUpload=this.$container.find(a.Binder.CONTAINER_UPLOAD);var r=this.isOnNormalTab?a.Binder.NORMAL:a.Binder.INTERP;this.$modalDialog.find('a[href!="'+r+'"]').parent().removeClass("active"),this.$modalDialog.find('a[href="'+r+'"]').parent().addClass("active"),this.$modalDialog.find('.tab-pane:not("'+r+'")').removeClass("active"),this.$modalDialog.find(".tab-pane"+r).addClass("active"),this.$modalDialog.modal({backdrop:"static",show:!1}),this.$modalDialog.on("shown.bs.modal",this.bind__onShownModal),this.$modalDialog.on("show.bs.modal",this.bind__onShowModal),this.$modalDialog.on("hidden.bs.modal",this.bind__onHiddenModal),this.$tabPanes.on("show.bs.tab",this.bind__onShowTab),this.$tabPanes.on("shown.bs.tab",this.bind__onShownTab),this.$interpSelect.on("click",this.bind__onClickInterpSelect),this.isInEditMode&&(this.$normalTitle.blur(this.bind__onBlurPlayerTitle),this.$interpTitle.blur(this.bind__onBlurPlayerTitle)),this._clearCurrents(),this._setupRabbitmq(),this.isInEditMode&&this.$modalDialog.find('a[href="'+a.Binder.INTERP+'"]').hide()};return a.extend(e),a.TAG="RecorderComponent",a.MAX_RECORDING_TIME=720,a.Binder={MODAL_DIALOG:".recorder-modal",TAB_PANES:'a[data-toggle="tab"]',NORMAL:".recorder-normal",INTERP:".recorder-interp",CONTAINER_RECORD:".recorder-container-record",NORMAL_TITLE:".recorder-normal-title",NORMAL_VIDEO:".recorder-normal-video",INTERP_SELECT:".recorder-interp-select",INTERP_MAIN:".recorder-interp-main",INTERP_VIDEO_P:".recorder-interp-video-p",INTERP_TITLE:".recorder-interp-title",INTERP_VIDEO_R:".recorder-interp-video-r",CONTROLS:".recorder-controls",CONTAINER_UPLOAD:".recorder-container-upload"},a.Tab={NORMAL:0,INTERPRETATION:1},a.Mode={RECORD:0,PREVIEW:1},a.Event={DONE:"eventDone",HIDDEN:"eventHidden"},a.prototype._setupRabbitmq=function(){this.bind__onMessage=function(e){console.log(e.message),this.messages.push(e.message),this._checkMessages()}.bind(this),this.bind__onConnect=function(e){this.subscription=this.rabbitmqWebStompService.subscribe("/exchange/entity-status",o.Event.MESSAGE,this.bind__onMessage)}.bind(this),this.rabbitmqWebStompService.isConnected()?this.bind__onConnect(null):(this.rabbitmqWebStompService.subscribe(null,o.Event.CONNECTED,this.bind__onConnect),this.rabbitmqWebStompService.connect())},a.prototype._cleanupRabbitmq=function(){this.rabbitmqWebStompService.unsubscribe(this.subscription,this.bind__onMessage),this.rabbitmqWebStompService.unsubscribe(null,this.bind__onConnect)},a.prototype._createPlayer=function(e,t){console.log("%s: %s",a.TAG,"_createPlayer"),e=typeof e!="undefined"?e:!1,t=typeof t!="undefined"?t:!1;var n=[],r=[];if(this.isOnNormalTab||e)n.push(this.doneButton),r.push(e?this.bind__cut:this.bind__done);this.options.enableDoneAndPost&&e&&(n.push(this.doneAndPostButton),r.push(this.bind__doneAndPost));var i,s;e&&t&&(i=[this.backButton],s=[this.bind__back]);var o=this.isOnNormalTab?this.$normalVideo:e?this.$interpVideoR:this.$interpVideoP,u=new Player(o,{areaSelectionEnabled:e,audioBar:!1,updateTimeType:Player.DENSITY_BAR_UPDATE_TYPE_RELATIVE,controlBarElement:this.$controls,forwardButtons:n,forwardFunctions:r,backButtons:i,backFunctions:s,selectedRegionColor:"#0000ff"});u.createControls(),$(u.elementID).find(".videoControlsContainer.controlsBar.doneButton").eq(0).attr("title",Translator.trans("player.previewing.doneButton")),$(u.elementID).find(".videoControlsContainer.controlsBar.doneAndPostButton").eq(0).attr("title",Translator.trans("player.previewing.doneAndPostButton")),$(u.elementID).find(".videoControlsContainer.controlsBar.backButton").eq(0).attr("title",Translator.trans("player.previewing.backToRecordingButton")),e?this.recorder=u:this.player=u},a.prototype._cut=function(e){console.log("%s: %s",a.TAG,"_cut"),e.preventDefault();var t=this.recorder.getCurrentMinMaxTime(),n=this.recorder.getAreaSelectionTimes();this.recorder.setCurrentMinMaxTime(n.minTime,n.maxTime),console.log("Current Min/Max Times %s %s",n.minTime,n.maxTime),console.log("Cutting to Min/Max Times %s %s",n.minTime-t.minTime,n.maxTime-t.minTime),this.currentTrim={startTime:n.minTime-t.minTime,endTime:n.maxTime-t.minTime},this._done(e)},a.prototype._back=function(e){console.log("%s: %s",a.TAG,"_back"),e.preventDefault(),this._destroyPlayers(),this.setRecordedMedia(null),this.options.mode=a.Mode.RECORD,this.isOnInterpTab&&this._createPlayer(),this._createRecorder()},a.prototype._createRecorder=function(){console.log("%s: %s",a.TAG,"_createRecorder");var e=[this.forwardButton,this.doneButton],t=[this.bind__preview,this.bind__done];this.options.enableDoneAndPost&&(e.push(this.doneAndPostButton),t.push(this.bind__doneAndPost));var n=this.isOnNormalTab?this.$normalVideo:this.$interpVideoR;Player.prototype.postRecordings=function(){this.recording_recordingStopped(!0,{})},this.recorder=new Player(n,{areaSelectionEnabled:!1,audioBar:!1,updateTimeType:Player.DENSITY_BAR_UPDATE_TYPE_ABSOLUTE,controlBarElement:this.$controls,type:Player.DENSITY_BAR_TYPE_RECORDER,volumeControl:!1,maxRecordingTime:a.MAX_RECORDING_TIME,recordingSuccessFunction:function(){},recordingErrorFunction:function(){},forwardButtons:e,forwardFunctions:t}),$(this.recorder).on(Player.EVENT_RECORDING_STARTED,this.bind__onRecordingStarted),$(this.recorder).on(Player.EVENT_RECORDING_STOPPED,this.bind__onRecordingStopped),this.recorder.createControls(),$(this.recorder.elementID).find(".videoControlsContainer.controlsBar.videoControls.recordButton").eq(0).attr("title",Translator.trans("player.recording.recordingButton")),$(this.recorder.elementID).find(".videoControlsContainer.controlsBar.forwardButton").eq(0).attr("title",Translator.trans("player.recording.forwardButton")),$(this.recorder.elementID).find(".videoControlsContainer.controlsBar.doneButton").eq(0).attr("title",Translator.trans("player.recording.doneButton")),$(this.recorder.elementID).find(".videoControlsContainer.controlsBar.doneAndPostButton").eq(0).attr("title",Translator.trans("player.recording.doneAndPostButton"))},a.prototype._onRecordingStarted=function(){console.log("%s: %s",a.TAG,"_onRecordingStarted"),this._clearCurrents(),this.isOnInterpTab&&(this.currentRecording.sourceStartTime=this.player.getCurrentTime(),this.player.setControlsEnabled(!1),this.player.play())},a.prototype._onRecordingStopped=function(){this.currentRecording.video=this.recorder.recordVideo.getBlob(),this.currentRecording.audio=this.recorder.recordAudio.getBlob(),this.isOnInterpTab&&(this.player.pause(),this.player.setControlsEnabled(!0))},a.prototype._preview=function(e){console.log("%s: %s",a.TAG,"_preview"),e.preventDefault(),this._destroyPlayers(),this._injectCurrentRecording(this.isOnNormalTab?this.$normalVideo:this.$interpVideoR),this.isOnInterpTab&&this._createPlayer(),this.options.mode=a.Mode.PREVIEW,this._createPlayer(!0,!0)},a.prototype._checkMessages=function(){if(!this.tempMedia)return;while(this.messages.length>0){var e=this.messages.pop();e.who.indexOf("MultiplexConsumer")>-1&&(e.what.indexOf("Media")>-1||e.what.indexOf("Interpretation"))&&e.identifier==this.tempMedia.get("id")&&(e.status!="Done"?this.$containerUpload.find("label").eq(0).html(e.status+"..."):(console.log("done"),this.$containerUpload.find("label").eq(0).html("Cleaning up..."),i.get(this.tempMedia.get("id")).done(function(e){this.tempMedia=null,this.setRecordedMedia(e.media),this.isDonePostponed&&setTimeout(function(){this._dispatchDone()}.bind(this),2e3)}.bind(this)).fail(function(e){})))}},a.prototype._addRecording=function(){if(this.currentRecording.video==null&&this.currentRecording.audio==null)return null;var e={video:this.currentRecording.video,audio:this.currentRecording.audio,title:this._getCurrentTitleElement().val()};return this.isOnInterpTab&&(e.isInterpretation=!0,e.sourceStartTime=this.currentRecording.sourceStartTime,e.sourceId=this.sourceMedia.get("id")),this.$containerUpload.find("label").eq(0).html("Uploading recording..."),s.addRecording(e).progress(function(e){u.updateProgressBar(this.$containerUpload,e)}.bind(this)).done(function(e){console.log(e.media),e.media.get("state")==2?this.setRecordedMedia(e.media):(console.log("waiting for multiplex consumer"),this.$containerUpload.find(".progress-bar").eq(0).addClass("progress-bar-striped active").html(""),this.$containerUpload.find("label").eq(0).html("Processing..."),this.tempMedia=e.media,this._checkMessages())}.bind(this)).fail(function(){})},a.prototype._trim=function(e){return this.currentTrim.startTime==null||this.currentTrim.endTime==null?null:(this.$containerUpload.find("label").eq(0).html("Queuing trim..."),i.trim(e,this.currentTrim.startTime,this.currentTrim.endTime).fail(function(){}))},a.prototype._dispatchDone=function(){this._dispatch(a.Event.DONE,{media:this.recordedMedia,doPost:this.doPost,recorderComponent:this})},a.prototype._done=function(e){console.log("%s: %s",a.TAG,"_done"),e.preventDefault(),this.$containerRecord.hide(),this.$containerUpload.show(),this._destroyPlayers();var t=function(){this.$containerUpload.find("label").eq(0).html("Cleaning up..."),this.recordedMedia?setTimeout(function(){this._dispatchDone()}.bind(this),2e3):this.isDonePostponed=!0}.bind(this),n=function(e){var n=this._trim(e);if(!n){t();return}n.done(function(e){t()})}.bind(this),r=this._addRecording();if(!r){this.isInEditMode&&this.recordedMedia&&(u.updateProgressBar(this.$containerUpload,100),this.$containerUpload.find(".progress-bar").eq(0).addClass("progress-bar-striped active").html(""),n(this.recordedMedia));return}r.done(function(e){n(e.media)})},a.prototype._doneAndPost=function(e){this.doPost=!0,this._done(e)},a.prototype._clearCurrents=function(){this.currentRecording={video:null,audio:null,sourceStartTime:null},this.currentTrim={startTime:null,endTime:null}},a.prototype._destroyPlayers=function(){console.log("%s: %s",a.TAG,"_destroyPlayers");var e=function(e){var t=e.parent();e.removeAttr("src"),t.hide(),t.after(e.detach()),t.remove()}.bind(this);this.player!=null&&(this.player.destroyRecorder(),this.isOnNormalTab?e(this.$normalVideo):this.sourceMedia!=null&&e(this.$interpVideoP),this.player=null),this.recorder!=null&&(this.recorder.destroyRecorder(),this.isOnNormalTab?e(this.$normalVideo):this.sourceMedia!=null&&e(this.$interpVideoR),this.recorder=null),this.$controls.html("")},a.prototype._onPageAnimate=function(){try{if(this.isInEditMode&&this.recordedMedia!=null){if(this.isOnInterpTab&&this.sourceMedia!=null)return;this._createPlayer(!0)}else{if(this.isOnInterpTab){if(this.sourceMedia==null)return;this._createPlayer()}this._createRecorder()}}catch(e){console.error("%s: %s- err=%o",a.TAG,"_loadPage",e)}},a.prototype._loadPage=function(){this.isOnInterpTab&&(this.sourceMedia!=null?(this.$interpSelect.parent().hide(),this.$interpMain.show()):(this.$interpSelect.parent().show(),this.$interpMain.hide())),this.$modalDialog.find(".modal-dialog").animate({width:4*($(window).height()*.9-256)/3},{complete:this.bind__onPageAnimate})},a.prototype._onShownModal=function(e){this._destroyPlayers(),this._loadPage()},a.prototype._onShowModal=function(e){this.$modalDialog.find(".modal-dialog").width(4*($(window).height()*.9-256)/3)},a.prototype._onHiddenModal=function(e){this._destroyPlayers();if(this.paused)return;this._dispatch(a.Event.HIDDEN,{recorderComponent:this})},a.prototype._onShowTab=function(e){this._destroyPlayers(),this.options.tab=$(e.target).attr("href")==a.Binder.NORMAL?a.Tab.NORMAL:a.Tab.INTERPRETATION,this.isOnNormalTab=this.options.tab==a.Tab.NORMAL,this.isOnInterpTab=this.options.tab==a.Tab.INTERPRETATION,this._loadPage()},a.prototype._onShownTab=function(e){this.$interpVideoP[0].load()},a.prototype._onBlurPlayerTitle=function(e){console.log("updated title"),this.recordedMedia.set("title",$(e.target).val()),i.edit(this.recordedMedia)},a.prototype._onClickInterpSelect=function(e){e.preventDefault(),n.render({multiSelect:!1,filter:{type:1}},function(e){this.mfsCmp=e.myFilesSelectorComponent,this.mfsCmp.subscribe(n.Event.DONE,function(e){this.mfsCmp.hide(),this.setSourceMedia(e.media[0])}.bind(this)),this.mfsCmp.subscribe(n.Event.HIDDEN,function(e){this.mfsCmp.destroy(),this.show(),this.paused=!1}.bind(this)),this.paused=!0,this.hide(),this.mfsCmp.show()}.bind(this))},a.prototype.show=function(){this.$modalDialog.modal("show")},a.prototype.hide=function(){this.$modalDialog.modal("hide")},a.prototype.destroy=function(){this._clearCurrents(),this._cleanupRabbitmq(),this.$modalDialog.remove()},a.prototype._injectCurrentRecording=function(e){var t={resources:[{web_path:URL.createObjectURL(this.currentRecording.video)},{web_path:URL.createObjectURL(this.currentRecording.audio)}]};dust.render("recorder_source",t,function(t,n){e.html(n)})},a.prototype._injectMedia=function(e,t){var n={resources:this.isInRecordMode?[t.get("source_resource")]:t.get("resources")};dust.render("recorder_source",n,function(t,n){e.html(n)})},a.prototype._getCurrentTitleElement=function(){return this.isOnNormalTab?this.$normalTitle:this.$interpTitle},a.prototype.setSourceMedia=function(e){this.sourceMedia=e,this.sourceMedia!=null&&(this._injectMedia(this.$interpVideoP,this.sourceMedia),this._getCurrentTitleElement().val(this.sourceMedia.get("title"))),this._destroyPlayers(),this._loadPage()},a.prototype.setRecordedMedia=function(e){this.recordedMedia=e,this.recordedMedia!=null&&(this._injectMedia(this.isOnNormalTab?this.$normalVideo:this.$interpVideoR,this.recordedMedia),this._getCurrentTitleElement().val(this.recordedMedia.get("title")))},a.render=function(e,t){var n={$container:$("body"),tab:a.Tab.NORMAL,mode:a.Mode.RECORD,enableDoneAndPost:!1};e=e||n;for(var r in n)e[r]=typeof e[r]!="undefined"?e[r]:n[r];dust.render("recorder",{},function(n,r){e.$container.append(r);var i=new a(e);t.call(i,{recorderComponent:i})})},a}),!function(e){"use strict";"function"==typeof define&&define.amd?define("Sortable",e):"undefined"!=typeof module&&"undefined"!=typeof module.exports?module.exports=e():"undefined"!=typeof Package?Sortable=e():window.Sortable=e()}(function(){"use strict";function e(e,t){this.el=e,this.options=t=t||{};var r={group:Math.random(),sort:!0,disabled:!1,store:null,handle:null,scroll:!0,scrollSensitivity:30,scrollSpeed:10,draggable:/[uo]l/i.test(e.nodeName)?"li":">*",ghostClass:"sortable-ghost",ignore:"a, img",filter:null,animation:0,setData:function(e,t){e.setData("Text",t.textContent)},dropBubble:!1,dragoverBubble:!1};for(var i in r)!(i in t)&&(t[i]=r[i]);var o=t.group;o&&"object"==typeof o||(o=t.group={name:o}),["pull","put"].forEach(function(e){e in o||(o[e]=!0)}),F.forEach(function(r){t[r]=n(this,t[r]||I),s(e,r.substr(2).toLowerCase(),t[r])},this),t.groups=" "+o.name+(o.put.join?" "+o.put.join(" "):"")+" ",e[M]=t;for(var u in this)"_"===u.charAt(0)&&(this[u]=n(this,this[u]));s(e,"mousedown",this._onTapStart),s(e,"touchstart",this._onTapStart),s(e,"dragover",this),s(e,"dragenter",this),U.push(this._onDragOver),t.store&&this.sort(t.store.get(this))}function t(e){y&&y.state!==e&&(a(y,"display",e?"none":""),!e&&y.state&&b.insertBefore(y,m),y.state=e)}function n(e,t){var n=R.call(arguments,2);return t.bind?t.bind.apply(t,[e].concat(n)):function(){return t.apply(e,n.concat(R.call(arguments)))}}function r(e,t,n){if(e){n=n||D,t=t.split(".");var r=t.shift().toUpperCase(),i=new RegExp("\\s("+t.join("|")+")\\s","g");do if(">*"===r&&e.parentNode===n||(""===r||e.nodeName.toUpperCase()==r)&&(!t.length||((" "+e.className+" ").match(i)||[]).length==t.length))return e;while(e!==n&&(e=e.parentNode))}return null}function i(e){e.dataTransfer.dropEffect="move",e.preventDefault()}function s(e,t,n){e.addEventListener(t,n,!1)}function o(e,t,n){e.removeEventListener(t,n,!1)}function u(e,t,n){if(e)if(e.classList)e.classList[n?"add":"remove"](t);else{var r=(" "+e.className+" ").replace(/\s+/g," ").replace(" "+t+" ","");e.className=r+(n?" "+t:"")}}function a(e,t,n){var r=e&&e.style;if(r){if(void 0===n)return D.defaultView&&D.defaultView.getComputedStyle?n=D.defaultView.getComputedStyle(e,""):e.currentStyle&&(n=e.currentStyle),void 0===t?n:n[t];t in r||(t="-webkit-"+t),r[t]=n+("string"==typeof n?"":"px")}}function f(e,t,n){if(e){var r=e.getElementsByTagName(t),i=0,s=r.length;if(n)for(;s>i;i++)n(r[i],i);return r}return[]}function l(e){e.draggable=!1}function c(){B=!1}function h(e,t){var n=e.lastElementChild,r=n.getBoundingClientRect();return t.clientY-(r.top+r.height)>5&&n}function p(e){for(var t=e.tagName+e.className+e.src+e.href+e.textContent,n=t.length,r=0;n--;)r+=t.charCodeAt(n);return r.toString(36)}function d(e){for(var t=0;e&&(e=e.previousElementSibling);)"TEMPLATE"!==e.nodeName.toUpperCase()&&t++;return t}function v(e,t){var n,r;return function(){void 0===n&&(n=arguments,r=this,setTimeout(function(){1===n.length?e.call(r,n[0]):e.apply(r,n),n=void 0},t))}}var m,g,y,b,w,E,S,x,T,N,C,k,L,A,O={},M="Sortable"+(new Date).getTime(),_=window,D=_.document,P=_.parseInt,H="draggable"in D.createElement("div"),B=!1,j=function(e,t,n,r,i,s){var o=D.createEvent("Event");o.initEvent(t,!0,!0),o.item=n||e,o.from=r||e,o.clone=y,o.oldIndex=i,o.newIndex=s,e.dispatchEvent(o)},F="onAdd onUpdate onRemove onStart onEnd onFilter onSort".split(" "),I=function(){},q=Math.abs,R=[].slice,U=[],z=v(function(e,t,n){if(n&&t.scroll){var r,i,s,o,u=t.scrollSensitivity,a=t.scrollSpeed,f=e.clientX,l=e.clientY,c=window.innerWidth,h=window.innerHeight;if(S!==n&&(E=t.scroll,S=n,E===!0)){E=n;do if(E.offsetWidth<E.scrollWidth||E.offsetHeight<E.scrollHeight)break;while(E=E.parentNode)}E&&(r=E,i=E.getBoundingClientRect(),s=(q(i.right-f)<=u)-(q(i.left-f)<=u),o=(q(i.bottom-l)<=u)-(q(i.top-l)<=u)),s||o||(s=(u>=c-f)-(u>=f),o=(u>=h-l)-(u>=l),(s||o)&&(r=_)),(O.vx!==s||O.vy!==o||O.el!==r)&&(O.el=r,O.vx=s,O.vy=o,clearInterval(O.pid),r&&(O.pid=setInterval(function(){r===_?_.scrollTo(_.scrollX+s*a,_.scrollY+o*a):(o&&(r.scrollTop+=o*a),s&&(r.scrollLeft+=s*a))},24)))}},30);return e.prototype={constructor:e,_dragStarted:function(){b&&m&&(u(m,this.options.ghostClass,!0),e.active=this,j(b,"start",m,b,N))},_onTapStart:function(e){var t=e.type,n=e.touches&&e.touches[0],i=(n||e).target,o=i,u=this.options,a=this.el,c=u.filter;if(!("mousedown"===t&&0!==e.button||u.disabled)&&(i=r(i,u.draggable,a))){if(N=d(i),"function"==typeof c){if(c.call(this,e,i,this))return j(o,"filter",i,a,N),void e.preventDefault()}else if(c&&(c=c.split(",").some(function(e){return e=r(o,e.trim(),a),e?(j(e,"filter",i,a,N),!0):void 0})))return void e.preventDefault();if((!u.handle||r(o,u.handle,a))&&i&&!m&&i.parentNode===a){L=e,b=this.el,m=i,w=m.nextSibling,k=this.options.group,m.draggable=!0,u.ignore.split(",").forEach(function(e){f(i,e.trim(),l)}),n&&(L={target:i,clientX:n.clientX,clientY:n.clientY},this._onDragStart(L,"touch"),e.preventDefault()),s(D,"mouseup",this._onDrop),s(D,"touchend",this._onDrop),s(D,"touchcancel",this._onDrop),s(m,"dragend",this),s(b,"dragstart",this._onDragStart),H||this._onDragStart(L,!0);try{D.selection?D.selection.empty():window.getSelection().removeAllRanges()}catch(h){}}}},_emulateDragOver:function(){if(A){a(g,"display","none");var e=D.elementFromPoint(A.clientX,A.clientY),t=e,n=" "+this.options.group.name,r=U.length;if(t)do{if(t[M]&&t[M].groups.indexOf(n)>-1){for(;r--;)U[r]({clientX:A.clientX,clientY:A.clientY,target:e,rootEl:t});break}e=t}while(t=t.parentNode);a(g,"display","")}},_onTouchMove:function(e){if(L){var t=e.touches?e.touches[0]:e,n=t.clientX-L.clientX,r=t.clientY-L.clientY,i=e.touches?"translate3d("+n+"px,"+r+"px,0)":"translate("+n+"px,"+r+"px)";A=t,a(g,"webkitTransform",i),a(g,"mozTransform",i),a(g,"msTransform",i),a(g,"transform",i),e.preventDefault()}},_onDragStart:function(e,t){var n=e.dataTransfer,r=this.options;if(this._offUpEvents(),"clone"==k.pull&&(y=m.cloneNode(!0),a(y,"display","none"),b.insertBefore(y,m)),t){var i,o=m.getBoundingClientRect(),u=a(m);g=m.cloneNode(!0),a(g,"top",o.top-P(u.marginTop,10)),a(g,"left",o.left-P(u.marginLeft,10)),a(g,"width",o.width),a(g,"height",o.height),a(g,"opacity","0.8"),a(g,"position","fixed"),a(g,"zIndex","100000"),b.appendChild(g),i=g.getBoundingClientRect(),a(g,"width",2*o.width-i.width),a(g,"height",2*o.height-i.height),"touch"===t?(s(D,"touchmove",this._onTouchMove),s(D,"touchend",this._onDrop),s(D,"touchcancel",this._onDrop)):(s(D,"mousemove",this._onTouchMove),s(D,"mouseup",this._onDrop)),this._loopId=setInterval(this._emulateDragOver,150)}else n&&(n.effectAllowed="move",r.setData&&r.setData.call(this,n,m)),s(D,"drop",this);setTimeout(this._dragStarted,0)},_onDragOver:function(e){var n,i,s,o=this.el,u=this.options,f=u.group,l=f.put,p=k===f,d=u.sort;if(m&&(void 0!==e.preventDefault&&(e.preventDefault(),!u.dragoverBubble&&e.stopPropagation()),k&&!u.disabled&&(p?d||(s=!b.contains(m)):k.pull&&l&&(k.name===f.name||l.indexOf&&~l.indexOf(k.name)))&&(void 0===e.rootEl||e.rootEl===this.el))){if(z(e,u,this.el),B)return;if(n=r(e.target,u.draggable,o),i=m.getBoundingClientRect(),s)return t(!0),void (y||w?b.insertBefore(m,y||w):d||b.appendChild(m));if(0===o.children.length||o.children[0]===g||o===e.target&&(n=h(o,e))){if(n){if(n.animated)return;E=n.getBoundingClientRect()}t(p),o.appendChild(m),this._animate(i,m),n&&this._animate(E,n)}else if(n&&!n.animated&&n!==m&&void 0!==n.parentNode[M]){x!==n&&(x=n,T=a(n));var v,E=n.getBoundingClientRect(),S=E.right-E.left,N=E.bottom-E.top,C=/left|right|inline/.test(T.cssFloat+T.display),L=n.offsetWidth>m.offsetWidth,A=n.offsetHeight>m.offsetHeight,O=(C?(e.clientX-E.left)/S:(e.clientY-E.top)/N)>.5,_=n.nextElementSibling;B=!0,setTimeout(c,30),t(p),v=C?n.previousElementSibling===m&&!L||O&&L:_!==m&&!A||O&&A,v&&!_?o.appendChild(m):n.parentNode.insertBefore(m,v?_:n),this._animate(i,m),this._animate(E,n)}}},_animate:function(e,t){var n=this.options.animation;if(n){var r=t.getBoundingClientRect();a(t,"transition","none"),a(t,"transform","translate3d("+(e.left-r.left)+"px,"+(e.top-r.top)+"px,0)"),t.offsetWidth,a(t,"transition","all "+n+"ms"),a(t,"transform","translate3d(0,0,0)"),clearTimeout(t.animated),t.animated=setTimeout(function(){a(t,"transition",""),a(t,"transform",""),t.animated=!1},n)}},_offUpEvents:function(){o(D,"mouseup",this._onDrop),o(D,"touchmove",this._onTouchMove),o(D,"touchend",this._onDrop),o(D,"touchcancel",this._onDrop)},_onDrop:function(t){var n=this.el,r=this.options;clearInterval(this._loopId),clearInterval(O.pid),o(D,"drop",this),o(D,"mousemove",this._onTouchMove),o(n,"dragstart",this._onDragStart),this._offUpEvents(),t&&(t.preventDefault(),!r.dropBubble&&t.stopPropagation(),g&&g.parentNode.removeChild(g),m&&(o(m,"dragend",this),l(m),u(m,this.options.ghostClass,!1),b!==m.parentNode?(C=d(m),j(m.parentNode,"sort",m,b,N,C),j(b,"sort",m,b,N,C),j(m,"add",m,b,N,C),j(b,"remove",m,b,N,C)):(y&&y.parentNode.removeChild(y),m.nextSibling!==w&&(C=d(m),j(b,"update",m,b,N,C),j(b,"sort",m,b,N,C))),e.active&&j(b,"end",m,b,N,C)),b=m=g=w=y=E=S=L=A=x=T=k=e.active=null,this.save())},handleEvent:function(e){var t=e.type;"dragover"===t||"dragenter"===t?(this._onDragOver(e),i(e)):("drop"===t||"dragend"===t)&&this._onDrop(e)},toArray:function(){for(var e,t=[],n=this.el.children,i=0,s=n.length;s>i;i++)e=n[i],r(e,this.options.draggable,this.el)&&t.push(e.getAttribute("data-id")||p(e));return t},sort:function(e){var t={},n=this.el;this.toArray().forEach(function(e,i){var s=n.children[i];r(s,this.options.draggable,n)&&(t[e]=s)},this),e.forEach(function(e){t[e]&&(n.removeChild(t[e]),n.appendChild(t[e]))})},save:function(){var e=this.options.store;e&&e.set(this)},closest:function(e,t){return r(e,t||this.options.draggable,this.el)},option:function(e,t){var n=this.options;return void 0===t?n[e]:void (n[e]=t)},destroy:function(){var e=this.el,t=this.options;F.forEach(function(n){o(e,n.substr(2).toLowerCase(),t[n])}),o(e,"mousedown",this._onTapStart),o(e,"touchstart",this._onTapStart),o(e,"dragover",this),o(e,"dragenter",this),Array.prototype.forEach.call(e.querySelectorAll("[draggable]"),function(e){e.removeAttribute("draggable")}),U.splice(U.indexOf(this._onDragOver),1),this._onDrop(),this.el=null}},e.utils={on:s,off:o,css:a,find:f,bind:n,is:function(e,t){return!!r(e,t,e)},throttle:v,closest:r,toggleClass:u,dispatchEvent:j,index:d},e.version="1.1.1",e.create=function(t,n){return new e(t,n)},e}),define("component/galleryComponent",["core/subscriber","factory/mediaFactory","component/recorderComponent","core/helper","Sortable","extra"],function(e,t,n,r,i){"use strict";var s=function(n){e.prototype.constructor.apply(this),this.options=n,this.activeMedia=this.options.activeMedia,this.thumbsBounds={width:0,shiftWidth:0,thumbsWidth:0},this.bind__onClickItemContainer=this._onClickItemContainer.bind(this),this.bind__onClickPrevNext=this._onClickPrevNext.bind(this),this.bind__onClickAction=this._onClickAction.bind(this),this.bind__onClickLeftRight=this._onClickLeftRight.bind(this),this.bind__onClickThumbnail=this._onClickThumbnail.bind(this),this.bind__onClickThumbRemove=this._onClickThumbRemove.bind(this),this.bind__onRenderMedia=this._onRenderMedia.bind(this),this.bind__onRenderThumbnails=this._onRenderThumbnails.bind(this),this.bind__onWindowResize=this._onWindowResize.bind(this),this.$container=this.options.$container,this.$inner=this.$container.find('[id="'+this.options.identifier+'"]'+s.Binder.INNER),this.$item=this.$inner.find(s.Binder.ITEM),this.$prev=this.$inner.find(s.Binder.PREV),this.$next=this.$inner.find(s.Binder.NEXT),this.$actions=this.$inner.find(s.Binder.ACTION),this.$carousel=this.$inner.find(s.Binder.CAROUSEL),this.$thumbs=this.$inner.find(s.Binder.THUMBS),this.$left=this.$inner.find(s.Binder.LEFT),this.$right=this.$inner.find(s.Binder.RIGHT),this.$item.on("click",this.bind__onClickItemContainer),this.$prev.find("i.fa").on("click",this.bind__onClickPrevNext),this.$next.find("i.fa").on("click",this.bind__onClickPrevNext),this.$actions.on("click",this.bind__onClickAction),this.$left.find("i.fa").on("click",this.bind__onClickLeftRight),this.$right.find("i.fa").on("click",this.bind__onClickLeftRight),$(window).on("resize",this.bind__onWindowResize),this.options.canEdit&&(this.sortable=i.create(this.$thumbs.find("ul")[0],{onSort:function(e){var t=this.options.media[e.oldIndex],n=this.options.media[e.newIndex];this.options.media[e.newIndex]=t,this.options.media[e.oldIndex]=n,this._updateButtonStates(),this._dispatch(s.Event.CHANGE,{galleryComponent:this})}.bind(this)})),typeof this.options.mediaIds!="undefined"&&t.list(this.options.mediaIds).done(function(e){this.options.media=e.media,this._populate()}.bind(this)).fail(function(e){console.error("%s: media factory list",s.TAG)})};return s.extend(e),s.TAG="GalleryComponent",s.Mode={PREVIEW:0,INLINE:1},s.Event={CHANGE:"eventChange",REMOVED_MEDIA:"eventRemovedMedia",DONE:"eventDone",HIDDEN:"eventHidden"},s.Binder={INNER:".gallery-inner",ITEM:".gallery-item",PREV:".gallery-prev",NEXT:".gallery-next",ACTION:".gallery-action a",CAROUSEL:".gallery-carousel",THUMBS:".gallery-thumbs",THUMB_REMOVE:".gallery-thumb-remove",LEFT:".gallery-left",RIGHT:".gallery-right"},s.prototype._launchRecorder=function(e,t,r){n.render(e,function(e){this.recorderCmp=e.recorderComponent,this.recorderCmp.subscribe(n.Event.DONE,function(e){this.recorderCmp.hide(),e.doPost&&window.location.assign(Routing.generate("imdc_thread_new_from_media",{mediaId:e.media.get("id")}))}.bind(this)),this.recorderCmp.subscribe(n.Event.HIDDEN,function(e){this.recorderCmp.destroy(),this.options.mode==s.Mode.PREVIEW&&this.show(),this.paused=!1}.bind(this)),this.paused=!0,this.options.mode==s.Mode.PREVIEW&&this.hide(),t&&this.recorderCmp.setSourceMedia(this.activeMedia),r&&this.recorderCmp.setRecordedMedia(this.activeMedia),this.recorderCmp.show()}.bind(this))},s.prototype._onClickItemContainer=function(e){if(this.options.mode!=s.Mode.PREVIEW)return;e.target===this.$item[0]&&this.hide()},s.prototype._onClickPrevNext=function(e){e.preventDefault();var t=$(e.currentTarget).hasClass("next"),n=$.inArray(this.activeMedia,this.options.media);if(!t&&n-1<0||t&&n+1>=this.options.media.length)return;this.activeMedia=this.options.media[n+(t?1:-1)],this._renderMedia()},s.prototype._onClickAction=function(e){var t=$(e.currentTarget).data("action");switch(t){case 1:this.hide();break;case 2:r.toggleFullScreen(this.$item);break;case 3:this._launchRecorder({tab:n.Tab.INTERPRETATION,enableDoneAndPost:!0},!0);break;case 4:this._launchRecorder({tab:n.Tab.NORMAL,mode:n.Mode.PREVIEW},!1,!0)}},s.prototype._calcCarouselPosition=function(e){var t=Math.abs(parseInt(this.$thumbs.find("ul").css("left"),10)),n,r,i,s;return e?(n=t+this.thumbsBounds.width,r=t+(this.thumbsBounds.thumbsWidth-n),i=t+this.thumbsBounds.shiftWidth,s=-Math.min(i,n>=this.thumbsBounds.thumbsWidth?t:r)):(n=t-this.thumbsBounds.shiftWidth,s=Math.min(0,-n)),s},s.prototype._onClickLeftRight=function(e){e.preventDefault();var t=this._calcCarouselPosition($(e.currentTarget).hasClass("right"));this._updateButtonStates(t),this.$thumbs.find("ul").css({left:t})},s.prototype._onClickThumbnail=function(e){e.preventDefault();var t=$(e.currentTarget).data("mid");this.activeMedia=$.grep(this.options.media,function(e,n){return e.get("id")==t})[0],this._renderMedia()},s.prototype._onClickThumbRemove=function(e){e.preventDefault();var t=$(e.currentTarget).data("mid"),n=$.grep(this.options.media,function(e,n){return e.get("id")==t})[0];this.removeMedia(n),this._dispatch(s.Event.REMOVED_MEDIA,{media:n,galleryComponent:this})},s.prototype.clear=function(){for(var e in this.options.media){var t=this.options.media[e];this.removeMedia(t),this._dispatch(s.Event.REMOVED_MEDIA,{media:t,galleryComponent:this})}},s.prototype._updateButtonStates=function(e){var t=this.$thumbs.find('li[data-mid="'+this.activeMedia.get("id")+'"]');this.$thumbs.find("div").removeClass("selected");var n=this.$actions.filter('[data-action="1"]'),r=this.$actions.filter('[data-action="2"]'),i=this.$actions.filter('[data-action="3"]'),o=this.$actions.filter('[data-action="4"]'),u=this.options.mode==s.Mode.PREVIEW;n.toggle(u),r.show(),this.activeMedia.get("type")==1?(i.show(),o.toggle(u)):(i.hide(),o.hide()),this.$prev.toggleClass("disabled",t.is(":first-child")),this.$next.toggleClass("disabled",t.is(":last-child"));var e=Math.abs(e!==undefined?e:parseInt(this.$thumbs.find("ul").css("left"),10));this.$left.find("i.fa").toggleClass("disabled",e<=0),this.$right.find("i.fa").toggleClass("disabled",e+this.thumbsBounds.width>=this.thumbsBounds.thumbsWidth),t.find("div").addClass("selected")},s.prototype._focusSelectedThumbnail=function(){var e=this.$thumbs.find('li[data-mid="'+this.activeMedia.get("id")+'"]'),t=e.position();if(!t)return;var n=e.outerWidth(!0);t.right=t.left+n,t.center=t.left+n/2;var r=Math.abs(parseInt(this.$thumbs.find("ul").css("left"),10)),i={left:r,right:r+this.thumbsBounds.width,center:r+this.thumbsBounds.width/2},s=t.center>i.center,o=Math.abs(t.center-i.center),u=r+(s?o:-o);s?u=-Math.min(u,i.right>=this.thumbsBounds.thumbsWidth?i.left:this.thumbsBounds.thumbsWidth-this.thumbsBounds.width):u=Math.min(0,-u),this.$thumbs.find("ul").css({left:u}),this._updateButtonStates(u)},s.prototype._onWindowResize=function(e){var t=this.$container.prop("tagName").toLowerCase()==="body"?$(window):this.$container,n=r.isFullscreen()?$(window).height():t.height()-this.$carousel.outerHeight(!0),i=t.width()-(this.$left.outerWidth(!0)+this.$right.outerWidth(!0))-.5,s=function(e,t){return n/2-$(this).height()/2};this.$item.css({height:n,"line-height":n+"px"}),this.$thumbs.width(i),this.$prev.css("top",s),this.$next.css("top",s),this.$item.find(".tt-media-video").css({height:n}),this.$item.find(".tt-media-img").css({"max-height":n});var o=this.$thumbs.width(),u=this.$thumbs.find("li"),a=parseInt(u.eq(0).css("margin-left"),10),f=u.eq(0).outerWidth(!0)-a,l=Math.floor(o/f);this.thumbsBounds.width=o,this.thumbsBounds.shiftWidth=f*l,this.thumbsBounds.thumbsWidth=f*u.length+a;if(!this.activeMedia){this.$actions.hide(),this.$prev.addClass("disabled"),this.$next.addClass("disabled"),this.$left.find("i.fa").addClass("disabled"),this.$right.find("i.fa").addClass("disabled");return}this._focusSelectedThumbnail(),this.$item.toggleClass("fullscreen",r.isFullscreen())},s.prototype._onRenderMedia=function(e,t){this.$item.html(t),$(window).trigger("resize")},s.prototype._onRenderThumbnails=function(e,t){this.$thumbs.find("ul").html(t),this.$thumbs.find("li").on("click",this.bind__onClickThumbnail),this.$thumbs.find("li").find("span").on("click",this.bind__onClickThumbRemove),$(window).trigger("resize")},s.prototype._renderMedia=function(){dust.render("media_element",{media:this.activeMedia?this.activeMedia.data:null,enable_controls:!0,preload_media:!1},this.bind__onRenderMedia)},s.prototype._renderMediaAndThumbnails=function(){if(!this.activeMedia){this.$item.html(""),this.$thumbs.find("ul").html(""),$(window).trigger("resize");return}this._renderMedia(),dust.render("gallery_thumbnail",{media:this.options.media,can_edit:this.options.canEdit},this.bind__onRenderThumbnails)},s.prototype._populate=function(){this.activeMedia=this.options.media.length==0?null:this.activeMedia?this.activeMedia:this.options.media[0],this._renderMediaAndThumbnails()},s.prototype.show=function(e){e=e!==undefined?e:this.options.mode==s.Mode.PREVIEW,this.options.mode==s.Mode.PREVIEW&&this.$container.addClass("tt-gallery-modal");var t=function(){this._populate()}.bind(this);e?this.$inner.fadeIn().promise().done(t):this.$inner.show().promise().done(t)},s.prototype.hide=function(e){e=e!==undefined?e:this.options.mode==s.Mode.PREVIEW,this.options.mode==s.Mode.PREVIEW&&!this.paused&&this.$container.removeClass("tt-gallery-modal");var t=function(){if(this.paused)return;this._dispatch(s.Event.HIDDEN,{galleryComponent:this})}.bind(this);e?this.$inner.fadeOut().promise().done(t):this.$inner.show().promise().done(t)},s.prototype.destroy=function(){this.$inner.remove()},s.prototype.setMedia=function(e){this.options.media=e,this._populate()},s.prototype.addMedia=function(e){this.options.media.push(e),this._populate()},s.prototype.removeMedia=function(e){var t=$.inArray(e,this.options.media);if(t==-1)return;this.options.media.splice(t,1),this.options.media.length==0?this.activeMedia=null:(t>=this.options.media.length&&t--,this.activeMedia=this.options.media[t]),this._populate()},s.render=function(e,t){if(e.mode!=="undefined"&&e.mode==s.Mode.INLINE&&e.$container==="undefined")throw new Error("Inline mode requires the $container option to be set explicitly.");var n={$container:$("body"),identifier:Math.random(),mode:s.Mode.PREVIEW,canEdit:!1,media:[],activeMedia:null};e=e||n;for(var r in n)e[r]=typeof e[r]!="undefined"?e[r]:n[r];var i=e.mode==s.Mode.INLINE?"gallery_inline":"gallery_preview";dust.render(i,{identifier:e.identifier},function(n,r){e.$container.append(r);var i=new s(e);t.call(i,{galleryComponent:i})})},s}),define("component/mediaChooserComponent",["core/subscriber","factory/mediaFactory","factory/myFilesFactory","component/recorderComponent","component/myFilesSelectorComponent","component/galleryComponent","model/mediaModel","core/helper","extra"],function(e,t,n,r,i,s,o,u){"use strict";var a=function(t){e.prototype.constructor.apply(this),this.options=t,this.media=[],this.bind__onClickRecordVideo=this._onClickRecordVideo.bind(this),this.bind__onClickUploadFile=this._onClickUploadFile.bind(this),this.bind__onClickSelect=this._onClickSelect.bind(this),this.bind__onChangeResourceFile=this._onChangeResourceFile.bind(this),this.$container=this.options.$container,this.$containerUpload=this.$container.find(a.Binder.CONTAINER_UPLOAD),this.$uploadForm=$(this.$containerUpload.data("form")),this.$resourceFile=this._getFormField("source_resource_file"),this.$recordVideo=this.$container.find(a.Binder.RECORD_VIDEO),this.$uploadFile=this.$container.find(a.Binder.UPLOAD_FILE),this.$select=this.$container.find(a.Binder.SELECT),this.$uploadTitle=this.$container.find(a.Binder.UPLOAD_TITLE),this.$working=this.$container.find(a.Binder.WORKING),this.$gallery=this.$container.find(a.Binder.GALLERY),this.$resourceFile.on("change",this.bind__onChangeResourceFile),this.$recordVideo.on("click",this.bind__onClickRecordVideo),this.$uploadFile.on("click",this.bind__onClickUploadFile),this.$select.on("click",this.bind__onClickSelect),this.$gallery.length>0&&s.render({$container:this.$gallery,mode:s.Mode.INLINE,canEdit:!0},function(e){this.galleryCmp=e.galleryComponent,this.galleryCmp.subscribe(s.Event.CHANGE,function(e){this.media=this.galleryCmp.options.media,this._invokeSuccess()}.bind(this)),this.galleryCmp.subscribe(s.Event.REMOVED_MEDIA,function(e){e.galleryComponent.options.media.length==0&&(this.galleryCmp.hide(!0),this.$gallery.slideUp()),this._removeSelectedMedia(e.media),this._invokeSuccess()}.bind(this))}.bind(this))};return a.extend(e),a.TAG="MediaChooserComponent",a.Binder={RECORD_VIDEO:".mediachooser-record-video",UPLOAD_FILE:".mediachooser-upload-file",SELECT:".mediachooser-select",CONTAINER_UPLOAD:".mediachooser-container-upload",UPLOAD_TITLE:".mediachooser-upload-title",WORKING:".mediachooser-working",GALLERY:".mediachooser-gallery"},a.Event={UPLOAD_START:"eventUploadStart",SUCCESS:"eventSuccess",SUCCESS_AND_POST:"eventSuccessAndPost",REMOVE:"eventRemove",ERROR:"eventError",RESET:"eventReset"},a.FORM_NAME="media",a.prototype._getFormField=function(e){return this.$uploadForm.find("#"+a.FORM_NAME+"_"+e)},a.prototype._addSelectedMedia=function(e){for(var t in this.media){var n=this.media[t];if(n.get("id")==e.get("id"))return}this.media.push(e);if(this.$gallery.length==0)return;this.$gallery.slideDown(),this.galleryCmp.addMedia(e),this.galleryCmp.show(!0)},a.prototype._removeSelectedMedia=function(e){for(var t in this.media){var n=this.media[t];if(n.get("id")==e.get("id")){var e=this.media.splice(t,1);this.galleryCmp.removeMedia(t),this._dispatch(a.Event.REMOVE,{media:e,mediaChooserComponent:this})}}},a.prototype._resetUpload=function(){this.$containerUpload.hide(),this.$uploadTitle.html("")},a.prototype._invokeSuccess=function(e){this._resetUpload();var t=typeof e!="undefined"&&e==1?a.Event.SUCCESS_AND_POST:a.Event.SUCCESS,n={media:this.media,mediaChooserComponent:this};this._dispatch(t,n)},a.prototype._onClickRecordVideo=function(e){e.preventDefault(),r.render({enableDoneAndPost:this.options.enableDoneAndPost},function(e){this.recorderCmp=e.recorderComponent,this.recorderCmp.subscribe(r.Event.DONE,function(e){this.recorderCmp.hide(),this._addSelectedMedia(e.media),this._invokeSuccess(e.doPost)}.bind(this)),this.recorderCmp.subscribe(r.Event.HIDDEN,function(e){this.recorderCmp.destroy()}.bind(this)),this.recorderCmp.show()}.bind(this))},a.prototype._onClickUploadFile=function(e){e.preventDefault(),this.$resourceFile.click()},a.prototype._onClickSelect=function(e){e.preventDefault(),i.render({},function(e){this.mfsCmp=e.myFilesSelectorComponent,this.mfsCmp.subscribe(i.Event.DONE,function(e){this.mfsCmp.hide(),$.each(e.media,function(e,t){this._addSelectedMedia(t)}.bind(this)),this._invokeSuccess()}.bind(this)),this.mfsCmp.subscribe(i.Event.HIDDEN,function(e){this.mfsCmp.destroy()}.bind(this)),this.mfsCmp.show()}.bind(this))},a.prototype._onChangeResourceFile=function(e){e.preventDefault(),this._toggleForm(!0);var t=this.$resourceFile.data("maxsize"),r=this.$resourceFile[0].files[0].size;if(r>t){alert(Translator.trans("form.upload.maxFileSizeExceeded",{fileSize:(r/1048576).toFixed(1)+"MB",maxUploadSize:(t/1048576).toFixed(1)+"MB"})),this.$resourceFile.val(""),this._toggleForm(!1);return}n.add(this.$uploadForm[0]).progress(function(e){u.updateProgressBar(this.$containerUpload.show(),e)}.bind(this)).done(function(e){this._addSelectedMedia(e.media),this._invokeSuccess(),this._toggleForm(!1)}.bind(this)).fail(function(e){this._resetUpload(),this._dispatch(a.Event.ERROR,{mediaChooserComponent:this,error:e?e.error:"Unknown error"}),this._toggleForm(!1)}.bind(this)),this._dispatch(a.Event.UPLOAD_START,{mediaChooserComponent:this}),this.$resourceFile.val("")},a.prototype._toggleForm=function(e){this.$recordVideo.attr("disabled",e),this.$uploadFile.attr("disabled",e),this.$select.attr("disabled",e)},a.prototype.setMedia=function(e){console.log("%s: %s",a.TAG,"setMedia");if(typeof e=="undefined")return;this._toggleForm(!0),this.$working.show(),t.list(e).done(function(e){this.$working.hide(),this._toggleForm(!1),$.each(e.media,function(e,t){this._addSelectedMedia(t)}.bind(this)),this._invokeSuccess()}.bind(this)).fail(function(e){this.$working.hide(),this._toggleForm(!1),console.error("%s: media factory list",a.TAG)}.bind(this))},a.prototype.generateFormData=function(e){var t="";return $.each(this.media,function(n,r){var i=$(e.replace(/__name__/g,n));i.val(r.get("id")),t+=i[0].outerHTML}),t},a.prototype.reset=function(){console.log("%s: %s",a.TAG,"reset"),this._resetUpload(),this.galleryCmp.clear(),this._dispatch(a.Event.RESET,{mediaChooserComponent:this})},a.render=function(e,t){var n={enableDoneAndPost:!1};t=t||n;for(var r in n)t[r]=typeof t[r]!="undefined"?t[r]:n[r];return t.$container=e,new a(t)},a}),define("views/contact/listView",["component/tableComponent"],function(e){"use strict";var t=function(n,r){this.controller=n,this.bind__onSelectionChange=this._onSelectionChange.bind(this),this.bind__onClickBulkAction=this._onClickBulkAction.bind(this),this.$container=r.container,this.$form=this.$container.find("form[name^="+t.FORM_NAME+"]"),this.$tabPanes=this.$container.find(t.Binder.TAB_PANES),this.tabPaneTblCmps=[],this.$tabPanes.each(function(t,n){this.tabPaneTblCmps[n.id]=e.table($(n)),this.tabPaneTblCmps[n.id].subscribe(e.Event.SELECTION_CHANGE,this.bind__onSelectionChange),this.tabPaneTblCmps[n.id].subscribe(e.Event.CLICK_BULK_ACTION,this.bind__onClickBulkAction)}.bind(this)),$tt._instances.push(this)};return t.TAG="ContactListView",t.Binder={TAB_PANES:".tab-pane[id^=tab]"},t.FORM_NAME="users_select",t.prototype._getFormField=function(e,t){return e.find("#"+e.attr("name")+"_"+t)},t.prototype._onSelectionChange=function(e){var t=e.tableComponent.getBulkActions();t.attr("disabled",e.$selection.length==0)},t.prototype._updateUsersSelectForm=function(e){var t=this._getFormField(this.$form,"users");t.html(""),e.each(function(e,n){var r=t.data("prototype");r=$(r.replace(/__name__/g,e)),r.val($(n).data("uid")),t.append(r)})},t.prototype._onClickBulkAction=function(e){switch(e.action){case 1:var t=e.tableComponent.getTable().attr("id").replace(/^tab/,"").toLowerCase();if(t=="all"&&!confirm("This will delete the selected contacts from all lists. Continue?"))break;e.$bulkAction.attr("disabled",!0);var n=[];e.$selection.each(function(e,t){n.push($(t).data("uid"))}),this.controller.delete(n,t).fail(function(t){t?alert(t.message):alert("Something went wrong."),e.$bulkAction.attr("disabled",!1)});break;case 2:e.$bulkAction.attr("disabled",!0),this._updateUsersSelectForm(e.$selection),this.$form.attr("action",Routing.generate("imdc_group_new")),this.$form.submit();break;case 3:e.$bulkAction.attr("disabled",!0),this._updateUsersSelectForm(e.$selection),this.$form.attr("action",Routing.generate("imdc_message_new")),this.$form.submit()}},t}),define("views/forum/newView",["component/mediaChooserComponent","component/accessTypeComponent"],function(e,t){"use strict";var n=function(r,i){this.controller=r,this.bind__onSubmitForm=this._onSubmitForm.bind(this),this.bind__onUploadStart=this._onUploadStart.bind(this),this.bind__onSuccess=this._onSuccess.bind(this),this.bind__onRemove=this._onRemove.bind(this),this.bind__onReset=this._onReset.bind(this),this.bind__onError=this._onError.bind(this),this.$container=i.container,this.$form=this.$container.find("form[name^="+n.FORM_NAME+"]"),this.$submit=this.$container.find(n.Binder.SUBMIT),this.$form.on("submit",this.bind__onSubmitForm),this.atCmp=t.render(this.$form),this.mcCmp=e.render(this.$form),this.mcCmp.subscribe(e.Event.UPLOAD_START,this.bind__onUploadStart),this.mcCmp.subscribe(e.Event.SUCCESS,this.bind__onSuccess),this.mcCmp.subscribe(e.Event.REMOVE,this.bind__onRemove),this.mcCmp.subscribe(e.Event.RESET,this.bind__onReset),this.mcCmp.subscribe(e.Event.ERROR,this.bind__onError);var s=[];this._getFormField("titleMedia").children().each(function(e,t){s.push($(t).val())}),s.length>0&&(this.$submit.attr("disabled",!0),this.mcCmp.setMedia(s)),$tt._instances.push(this)};return n.TAG="ForumNewView",n.Binder={SUBMIT:".forum-submit"},n.FORM_NAME="forum",n.prototype._getFormField=function(e){return this.$form.find("#"+n.FORM_NAME+"_"+e)},n.prototype._onSubmitForm=function(e){this.$form[0].checkValidity()&&this.$submit.button("loading")},n.prototype._updateForm=function(){var e=this._getFormField("titleMedia");e.html(this.mcCmp.generateFormData(e.data("prototype"))),e=this._getFormField("titleText"),e.attr("required",this.mcCmp.media.length==0),e=e.parent().find("label"),this.mcCmp.media.length==0?e.addClass("required"):e.removeClass("required")},n.prototype._onUploadStart=function(e){this.$submit.attr("disabled",!0)},n.prototype._onSuccess=function(e){this._updateForm(),this.$submit.attr("disabled",!1)},n.prototype._onRemove=function(e){this._updateForm()},n.prototype._onReset=function(e){this._updateForm()},n.prototype._onError=function(e){alert("Error: "+e.error)},n}),define("views/forum/editView",["views/forum/newView"],function(e){"use strict";var t=function(n,r){e.prototype.constructor.apply(this,arguments),this.bind__onClickDelete=this._onClickDelete.bind(this),this.$deleteModal=this.$container.find(t.Binder.DELETE_MODAL),this.$delete=this.$container.find(t.Binder.DELETE),this.$delete.on("click",this.bind__onClickDelete)};return t.extend(e),t.TAG="ForumEditView",t.Binder.DELETE_MODAL=".forum-delete-modal",t.Binder.DELETE=".forum-delete",t.prototype._onClickDelete=function(e){e.preventDefault(),this.$delete.button("loading"),this.controller.delete().done(function(e){this.$deleteModal.find(".modal-body").html("Forum deleted successfully.")}.bind(this)).fail(function(){this.$container.find(".modal-body").prepend("Something went wrong. Try again."),this.$delete.button("reset")}.bind(this))},t}),define("views/forum/viewView",["component/galleryComponent"],function(e){"use strict";var t=function(n,r){this.controller=n,this.$container=r.container,this.$gallery=this.$container.find(t.Binder.GALLERY);var i=this.controller.model.get("ordered_media");i.length>0&&e.render({$container:this.$gallery,mode:e.Mode.INLINE,media:i},function(e){this.galleryCmp=e.galleryComponent,this.galleryCmp.show()}.bind(this)),$tt._instances.push(this)};return t.TAG="ForumViewView",t.Binder={GALLERY:".forum-gallery"},t}),define("views/group/newView",["component/mediaChooserComponent"],function(e){"use strict";var t=function(n,r){this.controller=n,this.bind__onSubmitForm=this._onSubmitForm.bind(this),this.bind__onUploadStart=this._onUploadStart.bind(this),this.bind__onSuccess=this._onSuccess.bind(this),this.bind__onReset=this._onReset.bind(this),this.bind__onError=this._onError.bind(this),this.$container=r.container,this.$form=this.$container.find("form[name^="+t.FORM_NAME+"]"),this.$submit=this.$container.find(t.Binder.SUBMIT),this.$form.on("submit",this.bind__onSubmitForm),this.mcCmp=e.render(this.$form),this.mcCmp.subscribe(e.Event.UPLOAD_START,this.bind__onUploadStart),this.mcCmp.subscribe(e.Event.SUCCESS,this.bind__onSuccess),this.mcCmp.subscribe(e.Event.RESET,this.bind__onReset),this.mcCmp.subscribe(e.Event.ERROR,this.bind__onError);var i=[];this._getFormField("media").children().each(function(e,t){i.push($(t).val())}),i.length>0&&(this.$submit.attr("disabled",!0),this.mcCmp.setMedia(i)),$tt._instances.push(this)};return t.TAG="GroupNewView",t.Binder={SUBMIT:".group-submit"},t.FORM_NAME="user_group",t.prototype._getFormField=function(e){return this.$form.find("#"+t.FORM_NAME+"_"+e)},t.prototype._onSubmitForm=function(e){this.$form[0].checkValidity()&&this.$submit.button("loading")},t.prototype._updateForm=function(){var e=this._getFormField("media");e.html(this.mcCmp.generateFormData(e.data("prototype")))},t.prototype._onUploadStart=function(e){this.$submit.attr("disabled",!0)},t.prototype._onSuccess=function(e){this._updateForm(),this.$submit.attr("disabled",!1)},t.prototype._onReset=function(e){this._updateForm()},t.prototype._onError=function(e){alert("Error: "+e.error)},t}),define("views/group/editView",["views/group/newView"],function(e){"use strict";var t=function(n,r){e.prototype.constructor.apply(this,arguments),this.bind__onClickDelete=this._onClickDelete.bind(this),this.$deleteModal=this.$container.find(t.Binder.DELETE_MODAL),this.$delete=this.$container.find(t.Binder.DELETE),this.$delete.on("click",this.bind__onClickDelete)};return t.extend(e),t.TAG="GroupEditView",t.Binder.DELETE_MODAL=".group-delete-modal",t.Binder.DELETE=".group-delete",t.prototype._onClickDelete=function(e){e.preventDefault(),this.$delete.button("loading"),this.controller.delete().done(function(e){this.$deleteModal.find(".modal-body").html("Group deleted successfully.")}.bind(this)).fail(function(){this.$container.find(".modal-body").prepend("Something went wrong. Try again."),this.$delete.button("reset")}.bind(this))},t}),define("views/group/viewView",["component/galleryComponent"],function(e){"use strict";var t=function(n,r){this.controller=n,this.$container=r.container,this.$gallery=this.$container.find(t.Binder.GALLERY);var i=this.controller.model.get("ordered_media");i.length>0&&e.render({$container:this.$gallery,mode:e.Mode.INLINE,media:i},function(e){this.galleryCmp=e.galleryComponent,this.galleryCmp.show()}.bind(this)),$tt._instances.push(this)};return t.TAG="GroupViewView",t.Binder={GALLERY:".group-gallery"},t}),define("views/group/manageView",["component/tableComponent"],function(e){"use strict";var t=function(n,r){this.controller=n,this.bind___onClickFormCheckboxLink=this._onClickFormCheckboxLink.bind(this),this.bind__onShownTab=this._onShownTab.bind(this),this.bind__onClickRemove=this._onClickRemove.bind(this),this.bind__onClickAdd=this._onClickAdd.bind(this),this.$container=r.container,this.$formSearch=this.$container.find("form[name^="+t.FORM_NAME_SEARCH+"]"),this.$formRemove=this.$container.find("form[name^="+t.FORM_NAME_REMOVE+"]"),this.$formAdd=this.$container.find("form[name^="+t.FORM_NAME_ADD+"]"),this.$formCheckboxLinks=this.$formSearch.find('label[class^="checkbox"] a'),this.$tabs=this.$container.find(t.Binder.TABS),this.$tabPanes=this.$container.find(t.Binder.TAB_PANES),this.$remove=this.$container.find(t.Binder.REMOVE),this.$add=this.$container.find(t.Binder.ADD),this.$formCheckboxLinks.on("click",this.bind___onClickFormCheckboxLink),this.$tabs.on("shown.bs.tab",this.bind__onShownTab),this.$remove.on("click",this.bind__onClickRemove),this.$add.on("click",this.bind__onClickAdd);var i=function(e){this.$remove.attr("disabled",e.$selection.length==0)}.bind(this),s=function(e){this.$add.attr("disabled",e.$selection.length==0)}.bind(this),o=function(e){return e=="remove"?i:s};this.tableCmps=[],this.$tabPanes.each(function(t,n){var r=$(n),i=o(r.data("type")),s=e.table(r);s.subscribe(e.Event.SELECTION_CHANGE,i),this.tableCmps.push(s)}.bind(this)),this.$tabs.filter('[href="'+(location.hash?"#tab"+location.hash.substr(1):"#tabMembers")+'"]').tab("show"),$tt._instances.push(this)};return t.TAG="GroupManageView",t.Binder={TABS:'a[data-toggle="tab"]',TAB_PANES:"[id^=tab]",REMOVE:".group-remove",ADD:".group-add"},t.FORM_NAME="ugm_",t.FORM_NAME_SEARCH=t.FORM_NAME+"search",t.FORM_NAME_REMOVE=t.FORM_NAME+"remove",t.FORM_NAME_ADD=t.FORM_NAME+"add",t.prototype._getFormField=function(e,t){return e.find("#"+e.attr("name")+"_"+t)},t.prototype._onClickFormCheckboxLink=function(e){e.preventDefault();var t=this.$formSearch.find('input[type="checkbox"]'),n=$(e.target).parent().find('input[type="checkbox"]'),r=n.prop("checked");t.prop("checked",!1),n.prop("checked",!r),this.$formSearch[0].submit()},t.prototype._onShownTab=function(e){var t="#"+$(e.target).attr("href").substr(4);history.pushState?history.pushState(null,null,t):location.hash=t,this.$tabPanes.find("ul.pagination li a").each(function(e,n){var r=$(n),i=r.attr("href"),e=i.lastIndexOf("#");e>0&&(i=i.substring(0,e)),r.attr("href",i+t)})},t.prototype._updateUsersSelectForm=function(e,t){var n=this._getFormField(e,"users");t.button("loading"),t.toggleClass("disabled"),n.html(""),$.each(this.tableCmps,function(e,t){t.getSelection().each(function(e,t){var r=n.data("prototype");r=$(r.replace(/__name__/g,e)),r.val($(t).data("uid")),n.append(r)})}.bind(this))},t.prototype._onClickRemove=function(e){e.preventDefault(),this._updateUsersSelectForm(this.$formRemove,this.$remove),this.$formRemove.submit()},t.prototype._onClickAdd=function(e){e.preventDefault(),this._updateUsersSelectForm(this.$formAdd,this.$add),this.$formAdd.submit()},t}),define("views/message/newView",["component/mediaChooserComponent"],function(e){"use strict";var t=function(n,r){this.controller=n,this.bind__onSubmitForm=this._onSubmitForm.bind(this),this.bind__onUploadStart=this._onUploadStart.bind(this),this.bind__onSuccess=this._onSuccess.bind(this),this.bind__onReset=this._onReset.bind(this),this.bind__onError=this._onError.bind(this),this.$container=r.container,this.$form=this.$container.find("form[name^="+t.FORM_NAME+"]"),this.$submit=this.$container.find(t.Binder.SUBMIT),this.$form.on("submit",this.bind__onSubmitForm),this.mcCmp=e.render(this.$form),this.mcCmp.subscribe(e.Event.UPLOAD_START,this.bind__onUploadStart),this.mcCmp.subscribe(e.Event.SUCCESS,this.bind__onSuccess),this.mcCmp.subscribe(e.Event.RESET,this.bind__onReset),this.mcCmp.subscribe(e.Event.ERROR,this.bind__onError);var i=[];this._getFormField("attachedMedia").children().each(function(e,t){i.push($(t).val())}),i.length>0&&(this.$submit.attr("disabled",!0),this.mcCmp.setMedia(i)),this._getFormField("recipients").tagit(),$tt._instances.push(this)};return t.TAG="MessageNewView",t.Binder={SUBMIT:".message-submit"},t.FORM_NAME="PrivateMessageForm",t.prototype._getFormField=function(e){return this.$form.find("#"+t.FORM_NAME+"_"+e)},t.prototype._onSubmitForm=function(e){this.$form[0].checkValidity()&&this.$submit.button("loading")},t.prototype._updateForm=function(){var e=this._getFormField("attachedMedia");e.html(this.mcCmp.generateFormData(e.data("prototype")))},t.prototype._onUploadStart=function(e){this.$submit.attr("disabled",!0)},t.prototype._onSuccess=function(e){this.$submit.attr("disabled",!1),this._updateForm()},t.prototype._onReset=function(e){this._updateForm()},t.prototype._onError=function(e){alert("Error: "+e.error)},t}),define("views/message/replyView",["views/message/newView"],function(e){"use strict";var t=function(t,n){e.prototype.constructor.apply(this,arguments)};return t.extend(e),t.TAG="MessageReplyView",t}),define("views/message/viewView",["component/galleryComponent"],function(e){"use strict";var t=function(n,r){this.controller=n,this.$container=r.container,this.$gallery=this.$container.find(t.Binder.GALLERY);var i=this.controller.model.get("ordered_media");i.length>0&&e.render({$container:this.$gallery,mode:e.Mode.INLINE,media:i},function(e){this.galleryCmp=e.galleryComponent,this.galleryCmp.show()}.bind(this)),$tt._instances.push(this)};return t.TAG="MessageViewView",t.Binder={GALLERY:".message-gallery"},t}),define("views/myFiles/listView",["service","model/model","component/tableComponent","component/mediaChooserComponent","component/galleryComponent","core/helper"],function(e,t,n,r,i,s){"use strict";var o=function(i,s){this.controller=i,this.bind__onClickBulkAction=this._onClickBulkAction.bind(this),this.bind__onClickFile=this._onClickFile.bind(this),this.bind__onSuccess=this._onSuccess.bind(this),this.bind__onError=this._onError.bind(this),this.bind__onAddGridElement=this._onAddGridElement.bind(this),this.bind__onAddListElement=this._onAddListElement.bind(this),this.$container=s.container,this.$filesList=this.$container.find(o.Binder.FILES_LIST),this.$fileButtons=this.$container.find(o.Binder.FILE_BUTTON),this.tblCmp=n.table(this.$filesList),this.tblCmp.subscribe(n.Event.CLICK_BULK_ACTION,this.bind__onClickBulkAction),this.$filesList.find("button.edit-title").on("click",function(e){e.stopPropagation(),$(this).parent().parent().parent().find("span.edit-title").editable("toggle")}),this.$fileButtons.not("[disabled]").on("click",this.bind__onClickFile),this.$filesList.children("div.table-responsive").length>0?this.style=o.Binder.STYLE_LIST:this.style=o.Binder.STYLE_GRID,this.mcCmp=r.render(this.$container),this.mcCmp.subscribe(r.Event.SUCCESS,this.bind__onSuccess),this.mcCmp.subscribe(r.Event.RESET,this.bind__onReset),this.mcCmp.subscribe(r.Event.ERROR,this.bind__onError),this.$filesList.find("span.edit-title").editable({toggle:"manual",unsavedclass:null,pk:function(){return $(this).data("mid")},url:function(e){return this.controller.edit(e.pk,{title:e.value})}.bind(this)});var u=e.get("subscriber");u.dispatch(o.TAG,"onViewLoaded",{view:this}),this.controller.model.subscribe(t.Event.CHANGE,function(e){var t=e.model.get(e.keyPath),n=this.$filesList.find('span.edit-title[data-mid="'+t.get("id")+'"]');n.html(t.get("title"))}.bind(this)),$tt._instances.push(this)};return o.TAG="MyFilesListView",o.Binder={TOGGLE_STYLE:".my-files-selector-toggle-style",FILES_LIST:".my-files-selector-files-list",FILE_BUTTON:".my-files-selector-file-button",STYLE_LIST:"list",STYLE_GRID:"grid"},o.MAX_PER_PAGE=24,o.MAX_PER_ROW=4,o.prototype._onClickBulkAction=function(e){switch(e.action){case 1:if(confirm(Translator.trans("filesGateway.deleteConfirmMessage"))){$.each(e.$selection,function(e,t){this.controller.delete($(t).data("mid"),!0);var n;this.style==o.Binder.STYLE_LIST?n=$(t).parents("tr"):n=$(t).parents("div.col-md-3"),n.fadeOut(1e3,function(){n.remove()}),$(t).prop("checked",!1)}.bind(this));var t=setInterval(function(){this.$filesList=this.$container.find(o.Binder.FILES_LIST),this.$fileButtons=this.$container.find(o.Binder.FILE_BUTTON);var e=$(this.$fileButtons).parent("div.thumbnail.tt-grid-div-body").parent();if(!$(e).is(":animated")){this.tblCmp.updateElements(this.$filesList),clearInterval(t);if(this.style==o.Binder.STYLE_GRID){var n=$(e).parent(),r=$(this.$fileButtons).parent("div.thumbnail.tt-grid-div-body").length;for(var i=1;i<r;i++)!$(e[i]).parent().is($(e[i-1]).parent())&&i%o.MAX_PER_ROW!=0&&$(e[i]).insertAfter($(e[i-1]));$.each($(n),function(e,t){$(t).children().length==0&&$(t).remove()})}}}.bind(this),200)}}},o.prototype._onClickFile=function(e){e.stopPropagation();var t=this.controller.model.getMedia($(e.currentTarget).data("mid"));if(!t)throw new Error("media not found");i.render({media:this.controller.model.get("media"),activeMedia:t},function(e){this.galleryCmp=e.galleryComponent,this.galleryCmp.subscribe(i.Event.HIDDEN,function(e){this.galleryCmp.destroy()}.bind(this)),this.galleryCmp.show()}.bind(this))},o.prototype.getTableComponent=function(){return this.tblCmp},o.prototype._onAddGridElement=function(e,t){var n=$(t),r=$(this.$fileButtons).parent("div.thumbnail.tt-grid-div-body").length,i=$(this.$fileButtons).parent("div.thumbnail.tt-grid-div-body").parent();if(r>=o.MAX_PER_PAGE){n.insertBefore(i[0]);for(var s=o.MAX_PER_ROW-1;s<r;s+=o.MAX_PER_ROW)$(i[s]).insertBefore($(i[s+1]));$(i[r-1]).remove()}else if(r%o.MAX_PER_ROW==0){var u=$("<div class='row'></div>"),a=$(this.$filesList.children("div.tt-myFiles-grid-div")[0]);if(r==0)a.empty(),u.append(n),a.append(u);else{n.insertBefore(i[0]);for(var s=o.MAX_PER_ROW-1;s<r;s+=o.MAX_PER_ROW)$(i[s]).insertBefore($(i[s+1]));a.append(u),u.append($(i[r-1]).detach())}}else{n.insertBefore(i[0]);for(var s=o.MAX_PER_ROW-1;s<r;s+=o.MAX_PER_ROW)$(i[s]).insertBefore($(i[s+1]))}n.find("button.edit-title").on("click",function(e){e.stopPropagation(),$(this).parent().parent().parent().find("span.edit-title").editable("toggle")}),n.find("span.edit-title").editable({toggle:"manual",unsavedclass:null,pk:function(){return $(this).data("mid")},url:function(e){return this.controller.edit(e.pk,{title:e.value})}.bind(this)}),n.find(".my-files-selector-file-click").not("[disabled]").on("click",this.bind__onClickFile),this.$filesList=this.$container.find(o.Binder.FILES_LIST),this.$fileButtons=this.$container.find(o.Binder.FILE_BUTTON),this.tblCmp.updateElements(this.$filesList)},o.prototype._onAddListElement=function(e,t){var n=$(t),r=$(this.$fileButtons).parent("tr").length,i=$(this.$fileButtons).parent("tr");r>=o.MAX_PER_PAGE?(n.insertBefore(i[0]),i[r-1].remove()):r==0?($(this.$filesList).find("div.table-responsive > div").remove(),i=$(this.$filesList).find("tbody > tr"),n.insertBefore(i[0]),$(i[0]).remove()):n.insertBefore(i[0]),n.find("button.edit-title").on("click",function(e){e.stopPropagation(),$(this).parent().parent().parent().find("span.edit-title").editable("toggle")}),n.find("span.edit-title").editable({toggle:"manual",unsavedclass:null,pk:function(){return $(this).data("mid")},url:function(e){return this.controller.edit(e.pk,{title:e.value})}.bind(this)}),n.find(".my-files-selector-file-click").not("[disabled]").on("click",this.bind__onClickFile),this.$filesList=this.$container.find(o.Binder.FILES_LIST),this.$fileButtons=this.$container.find(o.Binder.FILE_BUTTON),this.tblCmp.updateElements(this.$filesList)},o.prototype._onSuccess=function(e){console.log(e);var t=e.media[e.media.length-1].data;this.controller.model.addMedia(t);if(this.style==o.Binder.STYLE_GRID)dust.render("myFilesGridElement",{media:t,previewTitle:Translator.trans("filesGateway.previewLink"),editTitle:Translator.trans("form.media.title"),shareTitle:Translator.trans("filesGateway.shareLink"),shareUrl:Routing.generate("imdc_thread_new_from_media",{mediaId:t.id}),mediaIcon:s.getIconForMediaType(t.type)},this.bind__onAddGridElement);else{var n=s.formatSize(t.source_resource.meta_data.size),r=!1;n<0&&(r=!0),dust.render("myFilesListElement",{media:t,previewTitle:Translator.trans("filesGateway.previewLink"),editTitle:Translator.trans("form.media.title"),shareTitle:Translator.trans("filesGateway.shareLink"),shareUrl:Routing.generate("imdc_thread_new_from_media",{mediaId:t.id}),mediaIcon:s.getIconForMediaType(t.type),timeUploaded:s.getTimeDateString(t.source_resource.meta_data.time_created),spinner:r,formattedSize:n},this.bind__onAddListElement)}},o.prototype._onError=function(e){alert("Error: "+e.error)},o}),define("views/post/newView",["model/model","component/mediaChooserComponent"],function(e,t){"use strict";var n=function(r,i){this.controller=r,this.options=i,this.bind__onClickSubmit=this._onClickSubmit.bind(this),this.bind__onClickReset=this._onClickReset.bind(this),this.bind__onClickCancel=this._onClickCancel.bind(this),this.bind__onUploadStart=this._onUploadStart.bind(this),this.bind__onSuccess=this._onSuccess.bind(this),this.bind__onSuccessAndPost=this._onSuccessAndPost.bind(this),this.bind__onReset=this._onReset.bind(this),this.bind__onModelChange=this._onModelChange.bind(this),this.bind__onError=this._onError.bind(this),this.$container=$(n.Binder.CONTAINER+'[data-pid="'+this.controller.model.get("id")+'"]'),this.$form=this.$container.find("form[name^="+n.FORM_NAME+"]"),this.$submit=this.$container.find(n.Binder.SUBMIT),this.$reset=this.$container.find(n.Binder.RESET),this.$cancel=this.$container.find(n.Binder.CANCEL),this.$submit.on("click",this.bind__onClickSubmit),this.$reset.on("click",this.bind__onClickReset),this.$cancel.on("click",this.bind__onClickCancel),this.mcCmp=t.render(this.$form,{enableDoneAndPost:!0}),this.mcCmp.subscribe(t.Event.UPLOAD_START,this.bind__onUploadStart),this.mcCmp.subscribe(t.Event.SUCCESS,this.bind__onSuccess),this.mcCmp.subscribe(t.Event.SUCCESS_AND_POST,this.bind__onSuccessAndPost),this.mcCmp.subscribe(t.Event.RESET,this.bind__onReset),this.mcCmp.subscribe(t.Event.ERROR,this.bind__onError),this.controller.model.subscribe(e.Event.CHANGE,this.bind__onModelChange),$tt._instances.push(this)};return n.TAG="PostNewView",n.Binder={CONTAINER:".post-container",SUBMIT:".post-submit-new",RESET:".post-reset",CANCEL:".post-cancel-new"},n.FORM_NAME="post",n.prototype.loadView=function(){var e=[];this._getFormField("attachedFile").children().each(function(t,n){e.push($(n).val())}),e.length>0&&(this._toggleForm(!0),this.mcCmp.setMedia(e))},n.prototype._getFormField=function(e){return this.$form.find("#"+n.FORM_NAME+"_"+e)},n.prototype._toggleForm=function(e){this.$submit.button(e?"loading":"reset"),this.$reset.attr("disabled",e),this.$cancel.attr("disabled",e)},n.prototype._preSubmit=function(){return this._getFormField("content").val()==""&&this.mcCmp.media.length==0?(alert("Your post cannot be blank. You must either select a file or write a comment."),!1):(this._toggleForm(!0),!0)},n.prototype._reset=function(){this.mcCmp.reset(),this._getFormField("startTime").val(this.controller.model.get("keyPoint.startTime")),this._getFormField("endTime").val(this.controller.model.get("keyPoint.endTime")),this._getFormField("content").val(""),this.controller.editKeyPoint({cancel:!0})},n.prototype._destroy=function(){this.$container.remove(),this.controller.removeKeyPoint(),this.controller.removeFromThread()},n.prototype._onClickSubmit=function(e){e.preventDefault();if(!this._preSubmit())return;this.controller.post(this.$form[0]).done(function(e){this.controller.addToThread(e.post),this.options.is_permanent?(this._reset(),this._toggleForm(!1)):this._destroy()}.bind(this)).fail(function(e){this.controller.updateInThread("new")}.bind(this))},n.prototype._onClickReset=function(e){e.preventDefault(),this._reset()},n.prototype._onClickCancel=function(e){e.preventDefault(),this._destroy()},n.prototype._onSelectionTimes=function(e,t){this._getFormField("startTime").val(e),this._getFormField("endTime").val(t)},n.prototype._onModelChange=function(e){this._onSelectionTimes(e.model.get("keyPoint.selection.startTime",""),e.model.get("keyPoint.selection.endTime",""))},n.prototype._updateForm=function(){var e=this._getFormField("attachedFile");e.html(this.mcCmp.generateFormData(e.data("prototype")))},n.prototype._onUploadStart=function(e){this.$submit.attr("disabled",!0)},n.prototype._onSuccess=function(e){this._updateForm(),this.$submit.attr("disabled",!1),this._toggleForm(!1)},n.prototype._onSuccessAndPost=function(e){this._updateForm(),this.$submit.trigger("click")},n.prototype._onReset=function(e){this._updateForm()},n.prototype._onError=function(e){alert("Error: "+e.error)},n}),define("views/post/editView",["views/post/newView"],function(e){"use strict";var t=function(n,r){e.prototype.constructor.apply(this,arguments),this.bind__onClickSubmit=this._onClickSubmit.bind(this),this.bind__onClickCancel=this._onClickCancel.bind(this),this.$submit=this.$container.find(t.Binder.SUBMIT),this.$cancel=this.$container.find(t.Binder.CANCEL),this.$submit.on("click",this.bind__onClickSubmit),this.$cancel.on("click",this.bind__onClickCancel)};return t.extend(e),t.TAG="PostEditView",t.Binder.SUBMIT=".post-submit-edit",t.Binder.CANCEL=".post-cancel-edit",t.prototype._toggleForm=function(e){this.$submit.button(e?"loading":"reset"),this.$cancel.attr("disabled",e)},t.prototype._onClickSubmit=function(e){e.preventDefault();if(!this._preSubmit())return;this.controller.put(this.$form[0]).done(function(e){this.controller.updateInThread("view"),this.controller.model.get("is_temporal",!1)&&this.controller.editKeyPoint({cancel:!0})}.bind(this)).fail(function(e){this.controller.updateInThread("edit")}.bind(this))},t.prototype._onClickCancel=function(e){e.preventDefault(),this.controller.get().done(function(e){this.controller.updateInThread("view"),this.controller.model.get("is_temporal",!1)&&this.controller.editKeyPoint({cancel:!0})}.bind(this)).fail(function(e){})},t}),define("views/post/viewView",["model/model","component/galleryComponent"],function(e,t){"use strict";var n=function(r,i){this.controller=r,this.bind__onClickHoverKeyPoint=this._onClickHoverKeyPoint.bind(this),this.bind__onClickNew=this._onClickNew.bind(this),this.bind__onClickEdit=this._onClickEdit.bind(this),this.bind__onClickDelete=this._onClickDelete.bind(this),this.bind__onModelChange=this._onModelChange.bind(this),this.$container=$(n.Binder.CONTAINER+'[data-pid="'+this.controller.model.get("id")+'"]'),this.$timelineKeyPoint=this.$container.find(n.Binder.TIMELINE_KEYPOINT),this.$gallery=this.$container.find(n.Binder.GALLERY),this.$new=this.$container.find(n.Binder.NEW),this.$edit=this.$container.find(n.Binder.EDIT),this.$deleteModal=this.$container.find(n.Binder.DELETE_MODAL),this.$delete=this.$container.find(n.Binder.DELETE),this.$timelineKeyPoint.on("click",this.bind__onClickHoverKeyPoint),this.$timelineKeyPoint.on("dblclick",this.bind__onClickHoverKeyPoint),this.$timelineKeyPoint.hover(this.bind__onClickHoverKeyPoint,this.bind__onClickHoverKeyPoint),this.$new.on("click",this.bind__onClickNew),this.$edit.on("click",this.bind__onClickEdit),this.$delete.on("click",this.bind__onClickDelete),this.controller.model.subscribe(e.Event.CHANGE,this.bind__onModelChange);var s=this.controller.model.get("ordered_media");s&&s.length>0&&t.render({$container:this.$gallery,mode:t.Mode.INLINE,media:s},function(e){this.galleryCmp=e.galleryComponent,this.galleryCmp.show()}.bind(this)),$tt._instances.push(this)};return n.TAG="PostViewView",n.Binder={CONTAINER:".post-container",TIMELINE_KEYPOINT:".post-timeline-keypoint",GALLERY:".post-gallery",NEW:".post-new",EDIT:".post-edit",DELETE_MODAL:".post-delete-modal",DELETE:".post-delete"},n.prototype._onClickHoverKeyPoint=function(e){switch(e.type){case"mouseenter":case"mouseleave":this.controller.hoverKeyPoint({isMouseOver:e.type=="mouseenter"});break;case"click":case"dblclick":e.preventDefault(),this.controller.clickKeyPoint({isDblClick:e.type=="dblclick"})}},n.prototype._onClickNew=function(e){e.preventDefault(),this.$new.hide(),this.controller.new(null).done(function(e){this.controller.addToThread(e.post)}.bind(this)).fail(function(e){this.$new.show()}.bind(this))},n.prototype._onClickEdit=function(e){e.preventDefault(),this.controller.edit().done(function(e){this.controller.updateInThread("edit"),this.controller.model.get("is_temporal",!1)&&this.controller.editKeyPoint({cancel:!1})}.bind(this)).fail(function(e){})},n.prototype._onClickDelete=function(e){e.preventDefault(),this.$delete.button("loading"),this.controller.delete().done(function(e){this.$deleteModal.find(".modal-body").html("Post deleted successfully."),this.$deleteModal.data("bs.modal").isShown?(this.$deleteModal.on("hidden.bs.modal",function(e){this.controller.removeFromThread()}.bind(this)),this.$deleteModal.modal("hide")):this.controller.removeFromThread()}.bind(this)).fail(function(e){this.$container.find(".modal-body").prepend("Something went wrong. Try again."),this.$delete.button("reset")}.bind(this))},n.prototype._renderKeyPoint=function(e,t,r){console.log("%s: %s",n.TAG,"_renderKeyPoint");var i=(100*e/r).toFixed(2),s=(100*t/r).toFixed(2),o=(s-i).toFixed(2);this.$timelineKeyPoint.css({left:i+"%",width:o+"%"})},n.prototype._hoverKeyPoint=function(e){e?this.$container.addClass("tt-post-container-highlight"):this.$container.removeClass("tt-post-container-highlight")},n.prototype._clickKeyPoint=function(e){var t=this.$container.find("video")[0];t&&e&&(t.currentTime=0,t.play())},n.prototype._onModelChange=function(e){this._renderKeyPoint(e.model.get("keyPoint.startTime",""),e.model.get("keyPoint.endTime",""),e.model.get("keyPoint.videoDuration","")),this._hoverKeyPoint(e.model.get("keyPoint.isPlayerHovering",!1)),this._clickKeyPoint(e.model.get("keyPoint.isPlayerPlaying",!1)),this.$new.show()},n}),define("views/profile/editView",[],function(){"use strict";var e=function(t,n){this.controller=t,this.bind__onClickAddLanguage=this._onClickAddLanguage.bind(this),this.bind__onClickDeleteLanguage=this._onClickDeleteLanguage.bind(this),this.$container=n.container,this.$addLang=this.$container.find(e.Binder.ADD_LANGUAGE),this.$delLang=this.$container.find(e.Binder.DELETE_LANGUAGE),this.$addLang.on("click",this.bind__onClickAddLanguage),this.$delLang.on("click",this.bind__onClickDeleteLanguage),$tt._instances.push(this)};return e.TAG="ProfileEditView",e.Binder={ADD_LANGUAGE:".profile-add-lang",DELETE_LANGUAGE:".profile-del-lang"},e.prototype._onClickAddLanguage=function(e){e.preventDefault();var t=$("#foss_user_profile_form_languages"),n,r=t.data("delete-language-text"),i=t.data("prototype"),s=$("#foss_user_profile_form_languages > li").length;$("#no-languages").remove(),n=$('<button class="btn btn-danger btn-sm profile-del-lang"></a>').html(r),n.on("click",this.bind__onClickDeleteLanguage),i=i.replace(/__name__/g,s),s++;var o=$("<li></li>").html(i);o.append(n),$("#foss_user_profile_form_languages").append(o)},e.prototype._onClickDeleteLanguage=function(e){e.preventDefault();var t=$("#foss_user_profile_form_languages"),n=t.data("no-languages-text"),r=$('<span id="no-languages"></span>').html(n);$(e.target).parent().remove(),$("#foss_user_profile_form_languages > li").length==0&&$("#foss_user_profile_form_languages").append(r)},e}),define("views/thread/newView",["component/mediaChooserComponent","component/accessTypeComponent"],function(e,t){"use strict";var n=function(r,i){this.controller=r,this.bind__onSubmitForm=this._onSubmitForm.bind(this),this.bind__onUploadStart=this._onUploadStart.bind(this),this.bind__onSuccess=this._onSuccess.bind(this),this.bind__onRemove=this._onRemove.bind(this),this.bind__onReset=this._onReset.bind(this),this.bind__onError=this._onError.bind(this),this.$container=i.container,this.$form=this.$container.find("form[name^="+n.FORM_NAME+"]"),this.$submit=this.$container.find(n.Binder.SUBMIT),this.$form.on("submit",this.bind__onSubmitForm),this.atCmp=t.render(this.$form),this.mcCmp=e.render(this.$form),this.mcCmp.subscribe(e.Event.UPLOAD_START,this.bind__onUploadStart),this.mcCmp.subscribe(e.Event.SUCCESS,this.bind__onSuccess),this.mcCmp.subscribe(e.Event.REMOVE,this.bind__onRemove),this.mcCmp.subscribe(e.Event.RESET,this.bind__onReset),this.mcCmp.subscribe(e.Event.ERROR,this.bind__onError);var s=[];this._getFormField("mediaIncluded").children().each(function(e,t){s.push($(t).val())}),s.length>0&&(this.$submit.attr("disabled",!0),this.mcCmp.setMedia(s)),$tt._instances.push(this)};return n.TAG="ThreadNewView",n.Binder={SUBMIT:".thread-submit"},n.FORM_NAME="thread",n.prototype._getFormField=function(e){return this.$form.find("#"+n.FORM_NAME+"_"+e)},n.prototype._onSubmitForm=function(e){this.$form[0].checkValidity()&&this.$submit.button("loading")},n.prototype._updateForm=function(){var e=this._getFormField("mediaIncluded");e.html(this.mcCmp.generateFormData(e.data("prototype"))),e=this._getFormField("title"),e.attr("required",this.mcCmp.media.length==0),e=e.parent().find("label"),this.mcCmp.media.length==0?e.addClass("required"):e.removeClass("required")},n.prototype._onUploadStart=function(e){this.$submit.attr("disabled",!0)},n.prototype._onSuccess=function(e){this._updateForm(),this.$submit.attr("disabled",!1)},n.prototype._onRemove=function(e){this._updateForm()},n.prototype._onReset=function(e){this._updateForm()},n.prototype._onError=function(e){alert("Error: "+e.error)},n}),define("views/thread/editView",["views/thread/newView"],function(e){"use strict";var t=function(n,r){e.prototype.constructor.apply(this,arguments),this.bind__onClickDelete=this._onClickDelete.bind(this),this.$deleteModal=this.$container.find(t.Binder.DELETE_MODAL),this.$delete=this.$container.find(t.Binder.DELETE),this.$delete.on("click",this.bind__onClickDelete)};return t.extend(e),t.TAG="ThreadEditView",t.Binder.DELETE_MODAL=".thread-delete-modal",t.Binder.DELETE=".thread-delete",t.prototype._onClickDelete=function(e){e.preventDefault(),this.$delete.button("loading"),this.controller.delete().done(function(e){this.$deleteModal.find(".modal-body").html("Topic deleted successfully.")}.bind(this)).fail(function(){this.$container.find(".modal-body").prepend("Something went wrong. Try again."),this.$delete.button("reset")}.bind(this))},t}),define("views/thread/viewView",["model/model","core/helper","bootstrap"],function(e,t,n){"use strict";var r=function(t,n){this.controller=t,this.options=n,this.player=null,this.playingKeyPoint=null,this.bind__onClickVideoSpeed=this._onClickVideoSpeed.bind(this),this.bind__onClickClosedCaptions=this._onClickClosedCaptions.bind(this),this.bind__onAreaSelectionChanged=this._onAreaSelectionChanged.bind(this),this.bind__onMouseOverKeyPoint=this._onMouseOverKeyPoint.bind(this),this.bind__onMouseOutKeyPoint=this._onMouseOutKeyPoint.bind(this),this.bind__onRightClickKeyPoint=this._onRightClickKeyPoint.bind(this),this.bind__onEndKeyPoint=this._onEndKeyPoint.bind(this),this.bind__onPlaybackStarted=this._onPlaybackStarted.bind(this),this.bind__onPlaybackStopped=this._onPlaybackStopped.bind(this),this.bind__onSeek=this._onSeek.bind(this),this.bind__onModelChange=this._onModelChange.bind(this),this.$container=n.container,this.$opContainer=n.op_container,this.$postContainer=n.post_container;var i=this.$opContainer.find(r.Binder.MEDIA_ELEMENT+" video");this.$video=i.eq(i.length==2?1:0),this.$pipVideo=i.eq(i.length==2?0:1),$("#videoSpeed").on("click",this.bind__onClickVideoSpeed),$("#closedCaptions").on("click",this.bind__onClickClosedCaptions);if(this.controller.model.get("type")===1&&this.controller.model.get("ordered_media").length>0){this.$video.on("loadedmetadata",function(e){this.controller.updateKeyPointDuration(e.target.duration)}.bind(this)),this._createPlayer();var s=this.controller.model.get("ordered_media.0");s&&s.is_interpretation&&(this.$pipVideo[0].currentTime=s.source_start_time)}this.controller.model.subscribe(e.Event.CHANGE,this.bind__onModelChange),$tt._instances.push(this)};return r.TAG="ThreadViewView",r.DEFAULT_TEMPORAL_COMMENT_LENGTH=3,r.Binder={MEDIA_ELEMENT:".thread-media-element"},r.prototype.loadView=function(){var e=[];_.each(this.controller.model.get("posts"),function(t,n,r){e.push(t.data)}),e=_.filter(e,function(e){return e.id>0}),dust.render("thread_view_posts",{posts:e},function(e,t){this.$postContainer.html(t),_.each(this.controller.model.get("posts"),function(e,t,r){e.get("id")<0?n(e,"post","post/new",{is_permanent:!0}):n(e,"post","post/view",{})}),$(window).trigger("resize")}.bind(this))},r.prototype._createPlayer=function(){console.log("%s: %s",r.TAG,"_createPlayer"),this.player=new Player(this.$video,{areaSelectionEnabled:!1,updateTimeType:Player.DENSITY_BAR_UPDATE_TYPE_ABSOLUTE,audioBar:!1,overlayControls:!0,playHeadImage:this.options.player.playHeadImage,playHeadImageOnClick:function(){var e=this.player.getCurrentTime(),t=new KeyPoint(-1,e,e+r.DEFAULT_TEMPORAL_COMMENT_LENGTH,"",{drawOnTimeLine:!0});this._toggleTemporal(!1,t)}.bind(this)}),$(this.player).on(Player.EVENT_AREA_SELECTION_CHANGED,this.bind__onAreaSelectionChanged),$(this.player).on(Player.EVENT_KEYPOINT_MOUSE_OVER,this.bind__onMouseOverKeyPoint),$(this.player).on(Player.EVENT_KEYPOINT_MOUSE_OUT,this.bind__onMouseOutKeyPoint),$(this.player).on(Player.EVENT_KEYPOINT_RIGHT_CLICK,this.bind__onRightClickKeyPoint),$(this.player).on(Player.EVENT_KEYPOINT_END,this.bind__onEndKeyPoint),$(this.player).on(Player.EVENT_PLAYBACK_STARTED,this.bind__onPlaybackStarted),$(this.player).on(Player.EVENT_PLAYBACK_STOPPED,this.bind__onPlaybackStopped),$(this.player).on(Player.EVENT_SEEK,this.bind__onSeek),this.player.createControls()},r.prototype._onAreaSelectionChanged=function(e){console.log("%s: %s",r.TAG,Player.EVENT_AREA_SELECTION_CHANGED),this.controller.updateKeyPointSelectionTimes(this.player.getAreaSelectionTimes())},r.prototype._onMouseOverKeyPoint=function(e,t,n){console.log("%s: %s- keyPoint=%o, coords=%o",r.TAG,Player.EVENT_KEYPOINT_MOUSE_OVER,t,n),this.controller.hoverKeyPoint(t.id,{isMouseOver:!0}),this.$postContainer.is(":animated")||this.$postContainer.animate({scrollTop:$(".post-container[data-pid="+t.id+"]").position().top})},r.prototype._onMouseOutKeyPoint=function(e,t){console.log("%s: %s- keyPoint=%o",r.TAG,Player.EVENT_KEYPOINT_MOUSE_OUT,t),this.controller.hoverKeyPoint(t.id,{isMouseOver:!1})},r.prototype._onRightClickKeyPoint=function(e,t,n){console.log("%s: %s- keyPoint=%o, coords=%o",r.TAG,Player.EVENT_KEYPOINT_RIGHT_CLICK,t,n),this.controller.rightClickKeyPoint(t.id)},r.prototype._onEndKeyPoint=function(e,t){console.log("%s: %s- keyPoint=%o",r.TAG,Player.EVENT_KEYPOINT_END,t),this.playingKeyPoint&&this.playingKeyPoint.id==t.id&&this.player.pause()},r.prototype._onPlaybackStarted=function(e){console.log("%s: %s",r.TAG,Player.EVENT_PLAYBACK_STARTED);if(this.$pipVideo.length==0)return;this.$pipVideo[0].play()},r.prototype._onPlaybackStopped=function(e){console.log("%s: %s",r.TAG,Player.EVENT_PLAYBACK_STOPPED);if(this.$pipVideo.length==0)return;this.$pipVideo[0].pause()},r.prototype._onSeek=function(e,t){console.log("%s: %s- time=%s",r.TAG,Player.EVENT_SEEK,t);if(this.$pipVideo.length==0)return;this.$pipVideo[0].currentTime=Math.min(this.player.getCurrentTime()+this.controller.model.get("ordered_media.0.source_start_time"),this.$pipVideo[0].duration)},r.prototype._toggleTemporal=function(e,t){this.player.pause(),this.playingKeyPoint=null,!e&&t?(this.player.setPlayHeadImage(""),this.player.seek(t.startTime),this.player.setAreaSelectionStartTime(t.startTime),this.player.setAreaSelectionEndTime(t.endTime),this.player.setAreaSelectionEnabled(!0)):(this.player.setPlayHeadImage(this.options.player.playHeadImage),this.player.setAreaSelectionEnabled(!1))},r.prototype._onModelChange=function(e){if(e.keyPath.indexOf("posts.")==0&&e.view){var r=e.model.get(e.keyPath);e.view=="new"&&dust.render("post_new",r.data,function(e,i){var s=this.$container.find('.post-container[data-pid="'+r.get("id")+'"]');if(s.length>0)s.replaceWith(i),s=this.$container.find('.post-container[data-pid="'+r.get("id")+'"]');else{var s=this.$postContainer.find('.post-container[data-pid="'+r.get("parent_post_id")+'"]');s.after(i)}t.autoSize(),n(r,"post","post/new",{is_permanent:$.contains(this.$opContainer[0],s[0])}),$(window).trigger("resize")}.bind(this)),e.view=="edit"&&dust.render("post_edit",r.data,function(e,i){var s=this.$postContainer.find('.post-container[data-pid="'+r.get("id")+'"]');s.replaceWith(i),t.autoSize(),n(r,"post","post/edit",{}),$(window).trigger("resize")}.bind(this));if(e.view=="view"){var i=this.$postContainer.find(".post-container[data-pid]"),s=i.length==0?"thread_view_posts":"post_view",o=s=="thread_view_posts"?{posts:[r.data]}:r.data;dust.render(s,o,function(t,o){if(s=="thread_view_posts")this.$postContainer.html(o);else if(e.isNew)if(!r.get("is_post_reply"))i.last().after(o);else{var u=r.get("parent_post_id");a=i.filter('[data-ppid="'+u+'"]'),a.length==0&&(a=i.filter('[data-pid="'+u+'"]')),a.last().after(o)}else{var a=this.$postContainer.find('.post-container[data-pid="'+r.get("id")+'"]');a.replaceWith(o)}n(r,"post","post/view",{}),$(window).trigger("resize")}.bind(this))}}if(e.keyPath=="posts"){var i=this.$postContainer.find(".post-container[data-pid]"),u=[],a=[];_.each(e.model.get("posts"),function(e,t,n){u.push(e.get("id"))}),a=_.filter(i,function(e){var t=parseInt($(e).data("pid"),10);return t>0&&!_.contains(u,t)}),_.each(a,function(e,t,n){var r=$(e);r.fadeOut("slow",function(e){r.remove(),i.length==a.length&&(t==i.length-1?dust.render("thread_view_posts",{},function(e,t){this.$postContainer.html(t),$(window).trigger("resize")}.bind(this)):$(window).trigger("resize"))}.bind(this))}.bind(this))}if(!this.player)return;this.player.setKeyPoints(e.model.get("keyPoints",[])),this.controller.updateKeyPointDuration(this.$video[0].duration);if(e.keyPath.indexOf("keyPoints.")==0){var f=e.model.get(e.keyPath.substr(0,e.keyPath.lastIndexOf(".")));f instanceof KeyPoint&&(f.isEditing?this._toggleTemporal(!f.startTime||!f.endTime,f):this._toggleTemporal(!0),f.isSeeking&&(f.paintHighlightedTimeout=!0,f.paintHighlighted=!0,this.player.seek(f.startTime),this.player.redrawKeyPoints=!0,setTimeout(function(){f.paintHighlightedTimeout=!1,f.paintHighlighted=!1,this.player.redrawKeyPoints=!0,this.player.repaint()}.bind(this),3e3)),f.isPlaying?(this.playingKeyPoint=f,this.player.seek(f.startTime),this.player.play()):f.isHovering?(f.paintHighlighted=!0,this.player.redrawKeyPoints=!0):f.paintHighlightedTimeout||(f.paintHighlighted=!1,this.player.redrawKeyPoints=!0),this.player.repaint())}},r.prototype._onClickVideoSpeed=function(e){e.preventDefault();var t=this.controller.adjustVideoSpeed();this.$video[0].playbackRate=t.value,this.$pipVideo.length!=0&&(this.$pipVideo[0].playbackRate=t.value),$(e.target).attr("src",t.image)},r.prototype._onClickClosedCaptions=function(e){e.preventDefault();var t=$("#closed-caption-button img").attr("src");t=t==this.options.player.captionImages.on?this.options.player.captionImages.off:this.options.player.captionImages.on,$("#closed-caption-button img").attr("src",t)},r}),define("main",["bootstrap","service","core/helper","core/subscriber","factory/contactFactory","factory/forumFactory","factory/groupFactory","factory/mediaFactory","factory/messageFactory","factory/myFilesFactory","factory/postFactory","factory/threadFactory","service/keyPointService","service/rabbitmqWebStompService","service/subscriberService","service/threadPostService","model/forumModel","model/groupModel","model/mediaModel","model/messageModel","model/myFilesModel","model/postModel","model/profileModel","model/threadModel","model/userModel","controller/contactController","controller/forumController","controller/groupController","controller/messageController","controller/myFilesController","controller/postController","controller/profileController","controller/threadController","component/accessTypeComponent","component/galleryComponent","component/mediaChooserComponent","component/myFilesSelectorComponent","component/recorderComponent","component/tableComponent","views/contact/listView","views/forum/newView","views/forum/editView","views/forum/viewView","views/group/newView","views/group/editView","views/group/viewView","views/group/manageView","views/message/newView","views/message/replyView","views/message/viewView","views/myFiles/listView","views/post/newView","views/post/editView","views/post/viewView","views/profile/editView","views/thread/newView","views/thread/editView","views/thread/viewView"],function(){"use strict";var e={};e._services=[],e._instances=[],window.TerpTube=e,window.$tt=window.TerpTube;var t=require("core/helper");t.autoSize(),dust.helpers.generateUrl=function(e,n,r,i){return!i||!i.hasOwnProperty("path")?e:e.write(t.generateUrl(i.path))},dust.helpers.generateRouteUrl=function(e,t,n,r){if(!r||!r.hasOwnProperty("name")||!r.hasOwnProperty("str_params"))return e;var i=r.str_params.split("|"),s={};return i.forEach(function(e,n,r){var i=e.split(":");s[i[0]]=t.get(i[1])}),e.write(Routing.generate(r.name,s,r.absolute))},dust.helpers.sizeOf=function(e,t,n,r){var i;return this.size({write:function(e){i=e}},t,n,r),n&&n.block?e.render(n.block,t.push({key:i})):e=e.write(i),e},dust.helpers.isLoggedInUser=function(e,t,n,r){if(!r||!r.hasOwnProperty("id")||!window.user)return e;var i=r.id==window.user.get("id");return r.inverse&&(i=!i),n?(i&&n.block&&e.render(n.block,t),!i&&n.else&&e.render(n.else,t)):e=e.write(i?"Yes":"No"),e},dust.helpers.isNotLoggedInUser=function(e,t,n,r){return r.inverse=!0,this.isLoggedInUser(e,t,n,r)},dust.helpers.isInUserOnList=function(e,t,n,r){if(!r||!r.hasOwnProperty("list")||!r.hasOwnProperty("username")||!window.user)return e;var i=window.user["isUserOn"+r.list+"List"](r.username);return n?(i&&n.block&&e.render(n.block,t),!i&&n.else&&e.render(n.else,t)):e=e.write(i?"Yes":"No"),e},dust.filters.nl2br=function(e){return e.replace(/(?:\r\n|\r|\n)/g,"<br />")}}),require(["main"]);